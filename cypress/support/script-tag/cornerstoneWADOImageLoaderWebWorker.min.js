/*! cornerstone-wado-image-loader - 2.2.2 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWADOImageLoader */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstoneWADOImageLoaderWebWorker",[],t):"object"==typeof exports?exports.cornerstoneWADOImageLoaderWebWorker=t():e.cornerstoneWADOImageLoaderWebWorker=t()}(this,function(){return function(r){var a={};function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,r){"use strict";t.a=function(e){for(var t,r=e[0],a=e[0],n=e.length,i=1;i<n;i++)t=e[i],r=Math.min(r,t),a=Math.max(a,t);return{min:r,max:a}}},function(e,t,r){"use strict";var m;function a(){if("undefined"==typeof CharLS)throw new Error("No JPEG-LS decoder loaded");if(!(m||(m=CharLS())&&m._jpegls_decode))throw new Error("JPEG-LS failed to initialize")}r.d(t,"b",function(){return a}),t.a=function(e,t){a();var r=function(e,t){var r=m._malloc(e.length);m.writeArrayToMemory(e,r);var a=m._malloc(4),n=m._malloc(4),i=m._malloc(4),o=m._malloc(4),l=m._malloc(4),s=m._malloc(4),f=m._malloc(4),u=m._malloc(4),c=m._malloc(4),d={result:m.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[r,e.length,a,n,i,o,l,s,u,f,c]),width:m.getValue(i,"i32"),height:m.getValue(o,"i32"),bitsPerSample:m.getValue(l,"i32"),stride:m.getValue(s,"i32"),components:m.getValue(u,"i32"),allowedLossyError:m.getValue(f,"i32"),interleaveMode:m.getValue(c,"i32"),pixelData:void 0},p=m.getValue(a,"*");return d.bitsPerSample<=8?(d.pixelData=new Uint8Array(d.width*d.height*d.components),d.pixelData.set(new Uint8Array(m.HEAP8.buffer,p,d.pixelData.length))):t?(d.pixelData=new Int16Array(d.width*d.height*d.components),d.pixelData.set(new Int16Array(m.HEAP16.buffer,p,d.pixelData.length))):(d.pixelData=new Uint16Array(d.width*d.height*d.components),d.pixelData.set(new Uint16Array(m.HEAP16.buffer,p,d.pixelData.length))),m._free(r),m._free(p),m._free(a),m._free(n),m._free(i),m._free(o),m._free(l),m._free(s),m._free(u),m._free(c),d}(t,1===e.pixelRepresentation);if(0!==r.result&&6!==r.result)throw new Error("JPEG-LS decoder failed to decode frame (error code ".concat(r.result,")"));return e.columns=r.width,e.rows=r.height,e.pixelData=r.pixelData,e}},function(e,t,r){"use strict";var w;function n(e,t){var r=function(e,t,r){var a=w._malloc(e.length);w.writeArrayToMemory(e,a);var n=w._malloc(4),i=w._malloc(4),o=w._malloc(4),l=w._malloc(4),s=w._malloc(4),f=(new Date).getTime();if(0!==w.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[a,e.length,n,i,o,l,s]))return console.log("[opj_decode] decoding failed!"),w._free(a),w._free(w.getValue(n,"*")),w._free(o),w._free(l),w._free(i),void w._free(s);var u=w.getValue(n,"*"),c={length:w.getValue(i,"i32"),sx:w.getValue(o,"i32"),sy:w.getValue(l,"i32"),nbChannels:w.getValue(s,"i32"),perf_timetodecode:void 0,pixelData:void 0},d=c.sx*c.sy*c.nbChannels,p=new Int32Array(w.HEAP32.buffer,u,d);if(1===t)if(Uint8Array.from)c.pixelData=Uint8Array.from(p);else{c.pixelData=new Uint8Array(d);for(var m=0;m<d;m++)c.pixelData[m]=p[m]}else if(r)if(Int16Array.from)c.pixelData=Int16Array.from(p);else{c.pixelData=new Int16Array(d);for(var g=0;g<d;g++)c.pixelData[g]=p[g]}else if(Uint16Array.from)c.pixelData=Uint16Array.from(p);else{c.pixelData=new Uint16Array(d);for(var b=0;b<d;b++)c.pixelData[b]=p[b]}var x=(new Date).getTime();return c.perf_timetodecode=x-f,w._free(a),w._free(n),w._free(u),w._free(i),w._free(o),w._free(l),w._free(s),c}(t,e.bitsAllocated<=8?1:2,1===e.pixelRepresentation);return e.columns=r.sx,e.rows=r.sy,e.pixelData=r.pixelData,1<r.nbChannels&&(e.photometricInterpretation="RGB"),e}function i(e){if(!e.usePDFJS&&"undefined"==typeof OpenJPEG)throw new Error("OpenJPEG decoder not loaded");if(!(w||(w=OpenJPEG())&&w._jp2_decode))throw new Error("OpenJPEG failed to initialize")}r.d(t,"b",function(){return i}),t.a=function(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return i(r),a.usePDFJS||r.usePDFJS?function(e,t){var r=new JpxImage;r.parse(t);var a=r.tiles.length;if(1!==a)throw new Error("JPEG2000 decoder returned a tileCount of ".concat(a,", when 1 is expected"));return e.columns=r.width,e.rows=r.height,e.pixelData=r.tiles[0].items,e}(e,t):n(e,t)}},function(e,t,r){"use strict";t.a="2.2.2"},function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(0);function a(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=Object(n.a)(e.pixelData),a=!(i(e.smallestPixelValue)&&i(e.largestPixelValue));!0!==t||a?(e.smallestPixelValue=r.min,e.largestPixelValue=r.max):(e.smallestPixelValue!==r.min&&console.warn("Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably."),e.largestPixelValue!==r.max&&console.warn("Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably."))}function i(e){return"number"==typeof e}},function(e,t,r){"use strict";var u=function(e,t){var r=t.buffer,a=t.byteOffset,n=t.length;return 16===e.bitsAllocated?(a%2&&(r=r.slice(a),a=0),0===e.pixelRepresentation?e.pixelData=new Uint16Array(r,a,n/2):e.pixelData=new Int16Array(r,a,n/2)):8===e.bitsAllocated||1===e.bitsAllocated?e.pixelData=t:32===e.bitsAllocated&&(a%2&&(r=r.slice(a),a=0),e.pixelData=new Float32Array(r,a,n/4)),e};var c=function(e,t){if(16===e.bitsAllocated){var r=t.buffer,a=t.byteOffset,n=t.length;a%2&&(r=r.slice(a),a=0),0===e.pixelRepresentation?e.pixelData=new Uint16Array(r,a,n/2):e.pixelData=new Int16Array(r,a,n/2);for(var i=0;i<e.pixelData.length;i++)e.pixelData[i]=(255&(o=e.pixelData[i]))<<8|o>>8&255}else 8===e.bitsAllocated&&(e.pixelData=t);var o;return e};var d=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){for(var r=t,a=e.rows*e.columns,n=new ArrayBuffer(a*e.samplesPerPixel),i=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),l=new Int8Array(n),s=0,f=i.getInt32(0,!0),u=0;u<f;++u){s=u*a;var c=i.getInt32(4*(u+1),!0),d=i.getInt32(4*(u+2),!0);0===d&&(d=r.length);for(var p=a*f;c<d;){var m=o[c++];if(0<=m&&m<=127)for(var g=0;g<m+1&&s<p;++g)l[s]=o[c++],s++;else if(m<=-1&&-127<=m)for(var b=o[c++],x=0;x<1-m&&s<p;++x)l[s]=b,s++}}return e.pixelData=new Uint8Array(n),e}(e,t):function(e,t){for(var r=t,a=e.rows*e.columns,n=new ArrayBuffer(a*e.samplesPerPixel),i=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),l=new Int8Array(n),s=0,f=i.getInt32(0,!0),u=0;u<f;++u){s=u;var c=i.getInt32(4*(u+1),!0),d=i.getInt32(4*(u+2),!0);0===d&&(d=r.length);for(var p=a*f;c<d;){var m=o[c++];if(0<=m&&m<=127)for(var g=0;g<m+1&&s<p;++g)l[s]=o[c++],s+=e.samplesPerPixel;else if(m<=-1&&-127<=m)for(var b=o[c++],x=0;x<1-m&&s<p;++x)l[s]=b,s+=e.samplesPerPixel}}return e.pixelData=new Uint8Array(n),e}(e,t);if(16===e.bitsAllocated)return function(e,t){for(var r=t,a=e.rows*e.columns,n=new ArrayBuffer(a*e.samplesPerPixel*2),i=new DataView(r.buffer,r.byteOffset),o=new Int8Array(r.buffer,r.byteOffset),l=new Int8Array(n),s=i.getInt32(0,!0),f=0;f<s;++f){var u=0,c=0===f?1:0,d=i.getInt32(4*(f+1),!0),p=i.getInt32(4*(f+2),!0);for(0===p&&(p=r.length);d<p;){var m=o[d++];if(0<=m&&m<=127)for(var g=0;g<m+1&&u<a;++g)l[2*u+c]=o[d++],u++;else if(m<=-1&&-127<=m)for(var b=o[d++],x=0;x<1-m&&u<a;++x)l[2*u+c]=b,u++}}return 0===e.pixelRepresentation?e.pixelData=new Uint16Array(n):e.pixelData=new Int16Array(n),e}(e,t);throw new Error("unsupported pixel format for RLE")};var p=function(e,t){if("undefined"==typeof JpegImage)throw new Error("No JPEG Baseline decoder loaded");var r=new JpegImage;return r.parse(t),r.colorTransform=!1,8===e.bitsAllocated?(e.pixelData=r.getData(e.columns,e.rows),e):16===e.bitsAllocated?(e.pixelData=r.getData16(e.columns,e.rows),e):void 0};var m=function(e,t){if("undefined"==typeof jpeg||void 0===jpeg.lossless||void 0===jpeg.lossless.Decoder)throw new Error("No JPEG Lossless decoder loaded");var r=e.bitsAllocated<=8?1:2,a=t.buffer,n=(new jpeg.lossless.Decoder).decode(a,t.byteOffset,t.length,r);return 0===e.pixelRepresentation?16===e.bitsAllocated?e.pixelData=new Uint16Array(n.buffer):e.pixelData=new Uint8Array(n.buffer):e.pixelData=new Int16Array(n.buffer),e},g=r(1),b=r(2);t.a=function(e,t,r,a,n){var i=(new Date).getTime();if("1.2.840.10008.1.2"===t)e=u(e,r);else if("1.2.840.10008.1.2.1"===t)e=u(e,r);else if("1.2.840.10008.1.2.2"===t)e=c(e,r);else if("1.2.840.10008.1.2.1.99"===t)e=u(e,r);else if("1.2.840.10008.1.2.5"===t)e=d(e,r);else if("1.2.840.10008.1.2.4.50"===t)e=p(e,r);else if("1.2.840.10008.1.2.4.51"===t)e=p(e,r);else if("1.2.840.10008.1.2.4.57"===t)e=m(e,r);else if("1.2.840.10008.1.2.4.70"===t)e=m(e,r);else if("1.2.840.10008.1.2.4.80"===t)e=Object(g.a)(e,r);else if("1.2.840.10008.1.2.4.81"===t)e=Object(g.a)(e,r);else if("1.2.840.10008.1.2.4.90"===t)e=Object(b.a)(e,r,a,n);else{if("1.2.840.10008.1.2.4.91"!==t)throw new Error("no decoder for transfer syntax ".concat(t));e=Object(b.a)(e,r,a,n)}var o=void 0!==e.pixelRepresentation&&1===e.pixelRepresentation,l=o&&void 0!==e.bitsStored?32-e.bitsStored:void 0;if(o&&void 0!==l)for(var s=0;s<e.pixelData.length;s++)e.pixelData[s]=e.pixelData[s]<<l>>l;var f=(new Date).getTime();return e.decodeTimeInMS=f-i,e}},,function(e,t,r){"use strict";r.r(t);var a,n={},i=!1;function o(e){if(n[e.taskType])return console.log('attempt to register duplicate task handler "',e.taskType,'"'),!1;n[e.taskType]=e,i&&e.initialize(a.taskConfiguration)}self.onmessage=function(r){var e;{if("initialize"!==r.data.taskType)return"loadWebWorkerTask"===r.data.taskType?(e=r.data,a=e.config,void self.importScripts(e.sourcePath)):void(n[r.data.taskType]?n[r.data.taskType].handler(r.data,function(e,t){self.postMessage({taskType:r.data.taskType,status:"success",result:e,workerIndex:r.data.workerIndex},t)}):(console.log("no task handler for ",r.data.taskType),console.log(n),self.postMessage({taskType:r.data.taskType,status:"failed - no task handler registered",workerIndex:r.data.workerIndex})));!function(e){if(!i){if(a=e.config,e.config.webWorkerTaskPaths)for(var t=0;t<e.config.webWorkerTaskPaths.length;t++)self.importScripts(e.config.webWorkerTaskPaths[t]);Object.keys(n).forEach(function(e){n[e].initialize(a.taskConfiguration)}),self.postMessage({taskType:"initialize",status:"success",result:{},workerIndex:e.workerIndex}),i=!0}}(r.data)}};var l,s=r(2),f=r(1),u=r(4),c=r(5),d=!1;function p(e){d||(self.importScripts(e.decodeTask.codecsPath),d=!0,e.decodeTask.initializeCodecsOnStartup&&(Object(s.b)(e.decodeTask),Object(f.b)(e.decodeTask)))}var m={taskType:"decodeTask",handler:function(e,t){p(l);var r=l&&l.decodeTask&&l.decodeTask.strict,a=e.data.imageFrame,n=new Uint8Array(e.data.pixelData);if(Object(c.a)(a,e.data.transferSyntax,n,l.decodeTask,e.data.options),!a.pixelData)throw new Error("decodeTask: imageFrame.pixelData is undefined after decoding");Object(u.a)(a,r),a.pixelData=a.pixelData.buffer,t(a,[a.pixelData])},initialize:function(e){(l=e).decodeTask.loadCodecsOnStartup&&p(e)}},g=r(3);r.d(t,"registerTaskHandler",function(){return o}),r.d(t,"version",function(){return g.a}),o(m);var b={registerTaskHandler:o,version:g.a};t.default=b}])});
//# sourceMappingURL=cornerstoneWADOImageLoaderWebWorker.min.js.map