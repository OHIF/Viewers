(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('react'), require('react-dom')) :
  typeof define === 'function' && define.amd ? define(['exports', 'react', 'react-dom'], factory) :
  (global = global || self, factory(global.OHIFStandaloneViewer = {}, global.React, global.ReactDOM));
}(this, function (exports, React, reactDom) { 'use strict';

  var React__default = 'default' in React ? React['default'] : React;
  reactDom = reactDom && reactDom.hasOwnProperty('default') ? reactDom['default'] : reactDom;

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var classCallCheck = _classCallCheck;

  function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
  }

  var createClass = _createClass;

  var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

  function unwrapExports (x) {
  	return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x.default : x;
  }

  function createCommonjsModule(fn, module) {
  	return module = { exports: {} }, fn(module, module.exports), module.exports;
  }

  var _typeof_1 = createCommonjsModule(function (module) {
  function _typeof2(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof2(obj); }

  function _typeof(obj) {
    if (typeof Symbol === "function" && _typeof2(Symbol.iterator) === "symbol") {
      module.exports = _typeof = function _typeof(obj) {
        return _typeof2(obj);
      };
    } else {
      module.exports = _typeof = function _typeof(obj) {
        return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : _typeof2(obj);
      };
    }

    return _typeof(obj);
  }

  module.exports = _typeof;
  });

  function _assertThisInitialized(self) {
    if (self === void 0) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return self;
  }

  var assertThisInitialized = _assertThisInitialized;

  function _possibleConstructorReturn(self, call) {
    if (call && (_typeof_1(call) === "object" || typeof call === "function")) {
      return call;
    }

    return assertThisInitialized(self);
  }

  var possibleConstructorReturn = _possibleConstructorReturn;

  var getPrototypeOf = createCommonjsModule(function (module) {
  function _getPrototypeOf(o) {
    module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {
      return o.__proto__ || Object.getPrototypeOf(o);
    };
    return _getPrototypeOf(o);
  }

  module.exports = _getPrototypeOf;
  });

  var setPrototypeOf = createCommonjsModule(function (module) {
  function _setPrototypeOf(o, p) {
    module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
      o.__proto__ = p;
      return o;
    };

    return _setPrototypeOf(o, p);
  }

  module.exports = _setPrototypeOf;
  });

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function");
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        writable: true,
        configurable: true
      }
    });
    if (superClass) setPrototypeOf(subClass, superClass);
  }

  var inherits = _inherits;

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  var defineProperty = _defineProperty;

  /**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */

  /**
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */

  var __DEV__ = process.env.NODE_ENV !== 'production';

  var warning = function() {};

  if (__DEV__) {
    var printWarning = function printWarning(format, args) {
      var len = arguments.length;
      args = new Array(len > 2 ? len - 2 : 0);
      for (var key = 2; key < len; key++) {
        args[key - 2] = arguments[key];
      }
      var argIndex = 0;
      var message = 'Warning: ' +
        format.replace(/%s/g, function() {
          return args[argIndex++];
        });
      if (typeof console !== 'undefined') {
        console.error(message);
      }
      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };

    warning = function(condition, format, args) {
      var len = arguments.length;
      args = new Array(len > 2 ? len - 2 : 0);
      for (var key = 2; key < len; key++) {
        args[key - 2] = arguments[key];
      }
      if (format === undefined) {
        throw new Error(
            '`warning(condition, format, ...args)` requires a warning ' +
            'message argument'
        );
      }
      if (!condition) {
        printWarning.apply(null, [format].concat(args));
      }
    };
  }

  var warning_1 = warning;

  /*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */
  /* eslint-disable no-unused-vars */
  var getOwnPropertySymbols = Object.getOwnPropertySymbols;
  var hasOwnProperty = Object.prototype.hasOwnProperty;
  var propIsEnumerable = Object.prototype.propertyIsEnumerable;

  function toObject(val) {
  	if (val === null || val === undefined) {
  		throw new TypeError('Object.assign cannot be called with null or undefined');
  	}

  	return Object(val);
  }

  function shouldUseNative() {
  	try {
  		if (!Object.assign) {
  			return false;
  		}

  		// Detect buggy property enumeration order in older V8 versions.

  		// https://bugs.chromium.org/p/v8/issues/detail?id=4118
  		var test1 = new String('abc');  // eslint-disable-line no-new-wrappers
  		test1[5] = 'de';
  		if (Object.getOwnPropertyNames(test1)[0] === '5') {
  			return false;
  		}

  		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
  		var test2 = {};
  		for (var i = 0; i < 10; i++) {
  			test2['_' + String.fromCharCode(i)] = i;
  		}
  		var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
  			return test2[n];
  		});
  		if (order2.join('') !== '0123456789') {
  			return false;
  		}

  		// https://bugs.chromium.org/p/v8/issues/detail?id=3056
  		var test3 = {};
  		'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
  			test3[letter] = letter;
  		});
  		if (Object.keys(Object.assign({}, test3)).join('') !==
  				'abcdefghijklmnopqrst') {
  			return false;
  		}

  		return true;
  	} catch (err) {
  		// We don't expect any of the above to throw, but better to be safe.
  		return false;
  	}
  }

  var objectAssign = shouldUseNative() ? Object.assign : function (target, source) {
  	var from;
  	var to = toObject(target);
  	var symbols;

  	for (var s = 1; s < arguments.length; s++) {
  		from = Object(arguments[s]);

  		for (var key in from) {
  			if (hasOwnProperty.call(from, key)) {
  				to[key] = from[key];
  			}
  		}

  		if (getOwnPropertySymbols) {
  			symbols = getOwnPropertySymbols(from);
  			for (var i = 0; i < symbols.length; i++) {
  				if (propIsEnumerable.call(from, symbols[i])) {
  					to[symbols[i]] = from[symbols[i]];
  				}
  			}
  		}
  	}

  	return to;
  };

  /**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */

  var ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';

  var ReactPropTypesSecret_1 = ReactPropTypesSecret;

  var printWarning$1 = function() {};

  if (process.env.NODE_ENV !== 'production') {
    var ReactPropTypesSecret$1 = ReactPropTypesSecret_1;
    var loggedTypeFailures = {};

    printWarning$1 = function(text) {
      var message = 'Warning: ' + text;
      if (typeof console !== 'undefined') {
        console.error(message);
      }
      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };
  }

  /**
   * Assert that the values match with the type specs.
   * Error messages are memorized and will only be shown once.
   *
   * @param {object} typeSpecs Map of name to a ReactPropType
   * @param {object} values Runtime values that need to be type-checked
   * @param {string} location e.g. "prop", "context", "child context"
   * @param {string} componentName Name of the component for error messages.
   * @param {?Function} getStack Returns the component stack.
   * @private
   */
  function checkPropTypes(typeSpecs, values, location, componentName, getStack) {
    if (process.env.NODE_ENV !== 'production') {
      for (var typeSpecName in typeSpecs) {
        if (typeSpecs.hasOwnProperty(typeSpecName)) {
          var error;
          // Prop type validation may throw. In case they do, we don't want to
          // fail the render phase where it didn't fail before. So we log it.
          // After these have been cleaned up, we'll let them throw.
          try {
            // This is intentionally an invariant that gets caught. It's the same
            // behavior as without this statement except with a better message.
            if (typeof typeSpecs[typeSpecName] !== 'function') {
              var err = Error(
                (componentName || 'React class') + ': ' + location + ' type `' + typeSpecName + '` is invalid; ' +
                'it must be a function, usually from the `prop-types` package, but received `' + typeof typeSpecs[typeSpecName] + '`.'
              );
              err.name = 'Invariant Violation';
              throw err;
            }
            error = typeSpecs[typeSpecName](values, typeSpecName, componentName, location, null, ReactPropTypesSecret$1);
          } catch (ex) {
            error = ex;
          }
          if (error && !(error instanceof Error)) {
            printWarning$1(
              (componentName || 'React class') + ': type specification of ' +
              location + ' `' + typeSpecName + '` is invalid; the type checker ' +
              'function must return `null` or an `Error` but returned a ' + typeof error + '. ' +
              'You may have forgotten to pass an argument to the type checker ' +
              'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and ' +
              'shape all require an argument).'
            );

          }
          if (error instanceof Error && !(error.message in loggedTypeFailures)) {
            // Only monitor this failure once because there tends to be a lot of the
            // same error.
            loggedTypeFailures[error.message] = true;

            var stack = getStack ? getStack() : '';

            printWarning$1(
              'Failed ' + location + ' type: ' + error.message + (stack != null ? stack : '')
            );
          }
        }
      }
    }
  }

  var checkPropTypes_1 = checkPropTypes;

  var printWarning$2 = function() {};

  if (process.env.NODE_ENV !== 'production') {
    printWarning$2 = function(text) {
      var message = 'Warning: ' + text;
      if (typeof console !== 'undefined') {
        console.error(message);
      }
      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };
  }

  function emptyFunctionThatReturnsNull() {
    return null;
  }

  var factoryWithTypeCheckers = function(isValidElement, throwOnDirectAccess) {
    /* global Symbol */
    var ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;
    var FAUX_ITERATOR_SYMBOL = '@@iterator'; // Before Symbol spec.

    /**
     * Returns the iterator method function contained on the iterable object.
     *
     * Be sure to invoke the function with the iterable as context:
     *
     *     var iteratorFn = getIteratorFn(myIterable);
     *     if (iteratorFn) {
     *       var iterator = iteratorFn.call(myIterable);
     *       ...
     *     }
     *
     * @param {?object} maybeIterable
     * @return {?function}
     */
    function getIteratorFn(maybeIterable) {
      var iteratorFn = maybeIterable && (ITERATOR_SYMBOL && maybeIterable[ITERATOR_SYMBOL] || maybeIterable[FAUX_ITERATOR_SYMBOL]);
      if (typeof iteratorFn === 'function') {
        return iteratorFn;
      }
    }

    /**
     * Collection of methods that allow declaration and validation of props that are
     * supplied to React components. Example usage:
     *
     *   var Props = require('ReactPropTypes');
     *   var MyArticle = React.createClass({
     *     propTypes: {
     *       // An optional string prop named "description".
     *       description: Props.string,
     *
     *       // A required enum prop named "category".
     *       category: Props.oneOf(['News','Photos']).isRequired,
     *
     *       // A prop named "dialog" that requires an instance of Dialog.
     *       dialog: Props.instanceOf(Dialog).isRequired
     *     },
     *     render: function() { ... }
     *   });
     *
     * A more formal specification of how these methods are used:
     *
     *   type := array|bool|func|object|number|string|oneOf([...])|instanceOf(...)
     *   decl := ReactPropTypes.{type}(.isRequired)?
     *
     * Each and every declaration produces a function with the same signature. This
     * allows the creation of custom validation functions. For example:
     *
     *  var MyLink = React.createClass({
     *    propTypes: {
     *      // An optional string or URI prop named "href".
     *      href: function(props, propName, componentName) {
     *        var propValue = props[propName];
     *        if (propValue != null && typeof propValue !== 'string' &&
     *            !(propValue instanceof URI)) {
     *          return new Error(
     *            'Expected a string or an URI for ' + propName + ' in ' +
     *            componentName
     *          );
     *        }
     *      }
     *    },
     *    render: function() {...}
     *  });
     *
     * @internal
     */

    var ANONYMOUS = '<<anonymous>>';

    // Important!
    // Keep this list in sync with production version in `./factoryWithThrowingShims.js`.
    var ReactPropTypes = {
      array: createPrimitiveTypeChecker('array'),
      bool: createPrimitiveTypeChecker('boolean'),
      func: createPrimitiveTypeChecker('function'),
      number: createPrimitiveTypeChecker('number'),
      object: createPrimitiveTypeChecker('object'),
      string: createPrimitiveTypeChecker('string'),
      symbol: createPrimitiveTypeChecker('symbol'),

      any: createAnyTypeChecker(),
      arrayOf: createArrayOfTypeChecker,
      element: createElementTypeChecker(),
      instanceOf: createInstanceTypeChecker,
      node: createNodeChecker(),
      objectOf: createObjectOfTypeChecker,
      oneOf: createEnumTypeChecker,
      oneOfType: createUnionTypeChecker,
      shape: createShapeTypeChecker,
      exact: createStrictShapeTypeChecker,
    };

    /**
     * inlined Object.is polyfill to avoid requiring consumers ship their own
     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is
     */
    /*eslint-disable no-self-compare*/
    function is(x, y) {
      // SameValue algorithm
      if (x === y) {
        // Steps 1-5, 7-10
        // Steps 6.b-6.e: +0 != -0
        return x !== 0 || 1 / x === 1 / y;
      } else {
        // Step 6.a: NaN == NaN
        return x !== x && y !== y;
      }
    }
    /*eslint-enable no-self-compare*/

    /**
     * We use an Error-like object for backward compatibility as people may call
     * PropTypes directly and inspect their output. However, we don't use real
     * Errors anymore. We don't inspect their stack anyway, and creating them
     * is prohibitively expensive if they are created too often, such as what
     * happens in oneOfType() for any type before the one that matched.
     */
    function PropTypeError(message) {
      this.message = message;
      this.stack = '';
    }
    // Make `instanceof Error` still work for returned errors.
    PropTypeError.prototype = Error.prototype;

    function createChainableTypeChecker(validate) {
      if (process.env.NODE_ENV !== 'production') {
        var manualPropTypeCallCache = {};
        var manualPropTypeWarningCount = 0;
      }
      function checkType(isRequired, props, propName, componentName, location, propFullName, secret) {
        componentName = componentName || ANONYMOUS;
        propFullName = propFullName || propName;

        if (secret !== ReactPropTypesSecret_1) {
          if (throwOnDirectAccess) {
            // New behavior only for users of `prop-types` package
            var err = new Error(
              'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +
              'Use `PropTypes.checkPropTypes()` to call them. ' +
              'Read more at http://fb.me/use-check-prop-types'
            );
            err.name = 'Invariant Violation';
            throw err;
          } else if (process.env.NODE_ENV !== 'production' && typeof console !== 'undefined') {
            // Old behavior for people using React.PropTypes
            var cacheKey = componentName + ':' + propName;
            if (
              !manualPropTypeCallCache[cacheKey] &&
              // Avoid spamming the console because they are often not actionable except for lib authors
              manualPropTypeWarningCount < 3
            ) {
              printWarning$2(
                'You are manually calling a React.PropTypes validation ' +
                'function for the `' + propFullName + '` prop on `' + componentName  + '`. This is deprecated ' +
                'and will throw in the standalone `prop-types` package. ' +
                'You may be seeing this warning due to a third-party PropTypes ' +
                'library. See https://fb.me/react-warning-dont-call-proptypes ' + 'for details.'
              );
              manualPropTypeCallCache[cacheKey] = true;
              manualPropTypeWarningCount++;
            }
          }
        }
        if (props[propName] == null) {
          if (isRequired) {
            if (props[propName] === null) {
              return new PropTypeError('The ' + location + ' `' + propFullName + '` is marked as required ' + ('in `' + componentName + '`, but its value is `null`.'));
            }
            return new PropTypeError('The ' + location + ' `' + propFullName + '` is marked as required in ' + ('`' + componentName + '`, but its value is `undefined`.'));
          }
          return null;
        } else {
          return validate(props, propName, componentName, location, propFullName);
        }
      }

      var chainedCheckType = checkType.bind(null, false);
      chainedCheckType.isRequired = checkType.bind(null, true);

      return chainedCheckType;
    }

    function createPrimitiveTypeChecker(expectedType) {
      function validate(props, propName, componentName, location, propFullName, secret) {
        var propValue = props[propName];
        var propType = getPropType(propValue);
        if (propType !== expectedType) {
          // `propValue` being instance of, say, date/regexp, pass the 'object'
          // check, but we can offer a more precise error message here rather than
          // 'of type `object`'.
          var preciseType = getPreciseType(propValue);

          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + preciseType + '` supplied to `' + componentName + '`, expected ') + ('`' + expectedType + '`.'));
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createAnyTypeChecker() {
      return createChainableTypeChecker(emptyFunctionThatReturnsNull);
    }

    function createArrayOfTypeChecker(typeChecker) {
      function validate(props, propName, componentName, location, propFullName) {
        if (typeof typeChecker !== 'function') {
          return new PropTypeError('Property `' + propFullName + '` of component `' + componentName + '` has invalid PropType notation inside arrayOf.');
        }
        var propValue = props[propName];
        if (!Array.isArray(propValue)) {
          var propType = getPropType(propValue);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected an array.'));
        }
        for (var i = 0; i < propValue.length; i++) {
          var error = typeChecker(propValue, i, componentName, location, propFullName + '[' + i + ']', ReactPropTypesSecret_1);
          if (error instanceof Error) {
            return error;
          }
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createElementTypeChecker() {
      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];
        if (!isValidElement(propValue)) {
          var propType = getPropType(propValue);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected a single ReactElement.'));
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createInstanceTypeChecker(expectedClass) {
      function validate(props, propName, componentName, location, propFullName) {
        if (!(props[propName] instanceof expectedClass)) {
          var expectedClassName = expectedClass.name || ANONYMOUS;
          var actualClassName = getClassName(props[propName]);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + actualClassName + '` supplied to `' + componentName + '`, expected ') + ('instance of `' + expectedClassName + '`.'));
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createEnumTypeChecker(expectedValues) {
      if (!Array.isArray(expectedValues)) {
        process.env.NODE_ENV !== 'production' ? printWarning$2('Invalid argument supplied to oneOf, expected an instance of array.') : void 0;
        return emptyFunctionThatReturnsNull;
      }

      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];
        for (var i = 0; i < expectedValues.length; i++) {
          if (is(propValue, expectedValues[i])) {
            return null;
          }
        }

        var valuesString = JSON.stringify(expectedValues);
        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of value `' + propValue + '` ' + ('supplied to `' + componentName + '`, expected one of ' + valuesString + '.'));
      }
      return createChainableTypeChecker(validate);
    }

    function createObjectOfTypeChecker(typeChecker) {
      function validate(props, propName, componentName, location, propFullName) {
        if (typeof typeChecker !== 'function') {
          return new PropTypeError('Property `' + propFullName + '` of component `' + componentName + '` has invalid PropType notation inside objectOf.');
        }
        var propValue = props[propName];
        var propType = getPropType(propValue);
        if (propType !== 'object') {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected an object.'));
        }
        for (var key in propValue) {
          if (propValue.hasOwnProperty(key)) {
            var error = typeChecker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret_1);
            if (error instanceof Error) {
              return error;
            }
          }
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createUnionTypeChecker(arrayOfTypeCheckers) {
      if (!Array.isArray(arrayOfTypeCheckers)) {
        process.env.NODE_ENV !== 'production' ? printWarning$2('Invalid argument supplied to oneOfType, expected an instance of array.') : void 0;
        return emptyFunctionThatReturnsNull;
      }

      for (var i = 0; i < arrayOfTypeCheckers.length; i++) {
        var checker = arrayOfTypeCheckers[i];
        if (typeof checker !== 'function') {
          printWarning$2(
            'Invalid argument supplied to oneOfType. Expected an array of check functions, but ' +
            'received ' + getPostfixForTypeWarning(checker) + ' at index ' + i + '.'
          );
          return emptyFunctionThatReturnsNull;
        }
      }

      function validate(props, propName, componentName, location, propFullName) {
        for (var i = 0; i < arrayOfTypeCheckers.length; i++) {
          var checker = arrayOfTypeCheckers[i];
          if (checker(props, propName, componentName, location, propFullName, ReactPropTypesSecret_1) == null) {
            return null;
          }
        }

        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` supplied to ' + ('`' + componentName + '`.'));
      }
      return createChainableTypeChecker(validate);
    }

    function createNodeChecker() {
      function validate(props, propName, componentName, location, propFullName) {
        if (!isNode(props[propName])) {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` supplied to ' + ('`' + componentName + '`, expected a ReactNode.'));
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createShapeTypeChecker(shapeTypes) {
      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];
        var propType = getPropType(propValue);
        if (propType !== 'object') {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type `' + propType + '` ' + ('supplied to `' + componentName + '`, expected `object`.'));
        }
        for (var key in shapeTypes) {
          var checker = shapeTypes[key];
          if (!checker) {
            continue;
          }
          var error = checker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret_1);
          if (error) {
            return error;
          }
        }
        return null;
      }
      return createChainableTypeChecker(validate);
    }

    function createStrictShapeTypeChecker(shapeTypes) {
      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];
        var propType = getPropType(propValue);
        if (propType !== 'object') {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type `' + propType + '` ' + ('supplied to `' + componentName + '`, expected `object`.'));
        }
        // We need to check all keys in case some are required but missing from
        // props.
        var allKeys = objectAssign({}, props[propName], shapeTypes);
        for (var key in allKeys) {
          var checker = shapeTypes[key];
          if (!checker) {
            return new PropTypeError(
              'Invalid ' + location + ' `' + propFullName + '` key `' + key + '` supplied to `' + componentName + '`.' +
              '\nBad object: ' + JSON.stringify(props[propName], null, '  ') +
              '\nValid keys: ' +  JSON.stringify(Object.keys(shapeTypes), null, '  ')
            );
          }
          var error = checker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret_1);
          if (error) {
            return error;
          }
        }
        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function isNode(propValue) {
      switch (typeof propValue) {
        case 'number':
        case 'string':
        case 'undefined':
          return true;
        case 'boolean':
          return !propValue;
        case 'object':
          if (Array.isArray(propValue)) {
            return propValue.every(isNode);
          }
          if (propValue === null || isValidElement(propValue)) {
            return true;
          }

          var iteratorFn = getIteratorFn(propValue);
          if (iteratorFn) {
            var iterator = iteratorFn.call(propValue);
            var step;
            if (iteratorFn !== propValue.entries) {
              while (!(step = iterator.next()).done) {
                if (!isNode(step.value)) {
                  return false;
                }
              }
            } else {
              // Iterator will provide entry [k,v] tuples rather than values.
              while (!(step = iterator.next()).done) {
                var entry = step.value;
                if (entry) {
                  if (!isNode(entry[1])) {
                    return false;
                  }
                }
              }
            }
          } else {
            return false;
          }

          return true;
        default:
          return false;
      }
    }

    function isSymbol(propType, propValue) {
      // Native Symbol.
      if (propType === 'symbol') {
        return true;
      }

      // 19.4.3.5 Symbol.prototype[@@toStringTag] === 'Symbol'
      if (propValue['@@toStringTag'] === 'Symbol') {
        return true;
      }

      // Fallback for non-spec compliant Symbols which are polyfilled.
      if (typeof Symbol === 'function' && propValue instanceof Symbol) {
        return true;
      }

      return false;
    }

    // Equivalent of `typeof` but with special handling for array and regexp.
    function getPropType(propValue) {
      var propType = typeof propValue;
      if (Array.isArray(propValue)) {
        return 'array';
      }
      if (propValue instanceof RegExp) {
        // Old webkits (at least until Android 4.0) return 'function' rather than
        // 'object' for typeof a RegExp. We'll normalize this here so that /bla/
        // passes PropTypes.object.
        return 'object';
      }
      if (isSymbol(propType, propValue)) {
        return 'symbol';
      }
      return propType;
    }

    // This handles more types than `getPropType`. Only used for error messages.
    // See `createPrimitiveTypeChecker`.
    function getPreciseType(propValue) {
      if (typeof propValue === 'undefined' || propValue === null) {
        return '' + propValue;
      }
      var propType = getPropType(propValue);
      if (propType === 'object') {
        if (propValue instanceof Date) {
          return 'date';
        } else if (propValue instanceof RegExp) {
          return 'regexp';
        }
      }
      return propType;
    }

    // Returns a string that is postfixed to a warning about an invalid type.
    // For example, "undefined" or "of type array"
    function getPostfixForTypeWarning(value) {
      var type = getPreciseType(value);
      switch (type) {
        case 'array':
        case 'object':
          return 'an ' + type;
        case 'boolean':
        case 'date':
        case 'regexp':
          return 'a ' + type;
        default:
          return type;
      }
    }

    // Returns class name of the object, if any.
    function getClassName(propValue) {
      if (!propValue.constructor || !propValue.constructor.name) {
        return ANONYMOUS;
      }
      return propValue.constructor.name;
    }

    ReactPropTypes.checkPropTypes = checkPropTypes_1;
    ReactPropTypes.PropTypes = ReactPropTypes;

    return ReactPropTypes;
  };

  function emptyFunction() {}

  var factoryWithThrowingShims = function() {
    function shim(props, propName, componentName, location, propFullName, secret) {
      if (secret === ReactPropTypesSecret_1) {
        // It is still safe when called from React.
        return;
      }
      var err = new Error(
        'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +
        'Use PropTypes.checkPropTypes() to call them. ' +
        'Read more at http://fb.me/use-check-prop-types'
      );
      err.name = 'Invariant Violation';
      throw err;
    }  shim.isRequired = shim;
    function getShim() {
      return shim;
    }  // Important!
    // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.
    var ReactPropTypes = {
      array: shim,
      bool: shim,
      func: shim,
      number: shim,
      object: shim,
      string: shim,
      symbol: shim,

      any: shim,
      arrayOf: getShim,
      element: shim,
      instanceOf: getShim,
      node: shim,
      objectOf: getShim,
      oneOf: getShim,
      oneOfType: getShim,
      shape: getShim,
      exact: getShim
    };

    ReactPropTypes.checkPropTypes = emptyFunction;
    ReactPropTypes.PropTypes = ReactPropTypes;

    return ReactPropTypes;
  };

  var propTypes = createCommonjsModule(function (module) {
  /**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */

  if (process.env.NODE_ENV !== 'production') {
    var REACT_ELEMENT_TYPE = (typeof Symbol === 'function' &&
      Symbol.for &&
      Symbol.for('react.element')) ||
      0xeac7;

    var isValidElement = function(object) {
      return typeof object === 'object' &&
        object !== null &&
        object.$$typeof === REACT_ELEMENT_TYPE;
    };

    // By explicitly using `prop-types` you are opting into new development behavior.
    // http://fb.me/prop-types-in-prod
    var throwOnDirectAccess = true;
    module.exports = factoryWithTypeCheckers(isValidElement, throwOnDirectAccess);
  } else {
    // By explicitly using `prop-types` you are opting into new production behavior.
    // http://fb.me/prop-types-in-prod
    module.exports = factoryWithThrowingShims();
  }
  });

  /**
   * Copyright 2014-2015, Facebook, Inc.
   * All rights reserved.
   *
   * This source code is licensed under the BSD-style license found in the
   * LICENSE file in the root directory of this source tree. An additional grant
   * of patent rights can be found in the PATENTS file in the same directory.
   */

  /**
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */

  var __DEV__$1 = process.env.NODE_ENV !== 'production';

  var warning$1 = function() {};

  if (__DEV__$1) {
    warning$1 = function(condition, format, args) {
      var len = arguments.length;
      args = new Array(len > 2 ? len - 2 : 0);
      for (var key = 2; key < len; key++) {
        args[key - 2] = arguments[key];
      }
      if (format === undefined) {
        throw new Error(
          '`warning(condition, format, ...args)` requires a warning ' +
          'message argument'
        );
      }

      if (format.length < 10 || (/^[s\W]*$/).test(format)) {
        throw new Error(
          'The warning format should be able to uniquely identify this ' +
          'warning. Please, use a more descriptive format than: ' + format
        );
      }

      if (!condition) {
        var argIndex = 0;
        var message = 'Warning: ' +
          format.replace(/%s/g, function() {
            return args[argIndex++];
          });
        if (typeof console !== 'undefined') {
          console.error(message);
        }
        try {
          // This error was thrown as a convenience so that you can use this stack
          // to find the callsite that caused this warning to fire.
          throw new Error(message);
        } catch(x) {}
      }
    };
  }

  var warning_1$1 = warning$1;

  /**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */

  /**
   * Use invariant() to assert state which your program assumes to be true.
   *
   * Provide sprintf-style format (only %s is supported) and arguments
   * to provide information about what broke and what you were
   * expecting.
   *
   * The invariant message will be stripped in production, but the invariant
   * will remain to ensure logic does not differ in production.
   */

  var NODE_ENV = process.env.NODE_ENV;

  var invariant = function(condition, format, a, b, c, d, e, f) {
    if (NODE_ENV !== 'production') {
      if (format === undefined) {
        throw new Error('invariant requires an error message argument');
      }
    }

    if (!condition) {
      var error;
      if (format === undefined) {
        error = new Error(
          'Minified exception occurred; use the non-minified dev environment ' +
          'for the full error message and additional helpful warnings.'
        );
      } else {
        var args = [a, b, c, d, e, f];
        var argIndex = 0;
        error = new Error(
          format.replace(/%s/g, function() { return args[argIndex++]; })
        );
        error.name = 'Invariant Violation';
      }

      error.framesToPop = 1; // we don't care about invariant's own frame
      throw error;
    }
  };

  var invariant_1 = invariant;

  function isAbsolute(pathname) {
    return pathname.charAt(0) === '/';
  }

  // About 1.5x faster than the two-arg version of Array#splice()
  function spliceOne(list, index) {
    for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1) {
      list[i] = list[k];
    }

    list.pop();
  }

  // This implementation is based heavily on node's url.parse
  function resolvePathname(to) {
    var from = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

    var toParts = to && to.split('/') || [];
    var fromParts = from && from.split('/') || [];

    var isToAbs = to && isAbsolute(to);
    var isFromAbs = from && isAbsolute(from);
    var mustEndAbs = isToAbs || isFromAbs;

    if (to && isAbsolute(to)) {
      // to is absolute
      fromParts = toParts;
    } else if (toParts.length) {
      // to is relative, drop the filename
      fromParts.pop();
      fromParts = fromParts.concat(toParts);
    }

    if (!fromParts.length) return '/';

    var hasTrailingSlash = void 0;
    if (fromParts.length) {
      var last = fromParts[fromParts.length - 1];
      hasTrailingSlash = last === '.' || last === '..' || last === '';
    } else {
      hasTrailingSlash = false;
    }

    var up = 0;
    for (var i = fromParts.length; i >= 0; i--) {
      var part = fromParts[i];

      if (part === '.') {
        spliceOne(fromParts, i);
      } else if (part === '..') {
        spliceOne(fromParts, i);
        up++;
      } else if (up) {
        spliceOne(fromParts, i);
        up--;
      }
    }

    if (!mustEndAbs) for (; up--; up) {
      fromParts.unshift('..');
    }if (mustEndAbs && fromParts[0] !== '' && (!fromParts[0] || !isAbsolute(fromParts[0]))) fromParts.unshift('');

    var result = fromParts.join('/');

    if (hasTrailingSlash && result.substr(-1) !== '/') result += '/';

    return result;
  }

  var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

  function valueEqual(a, b) {
    if (a === b) return true;

    if (a == null || b == null) return false;

    if (Array.isArray(a)) {
      return Array.isArray(b) && a.length === b.length && a.every(function (item, index) {
        return valueEqual(item, b[index]);
      });
    }

    var aType = typeof a === 'undefined' ? 'undefined' : _typeof(a);
    var bType = typeof b === 'undefined' ? 'undefined' : _typeof(b);

    if (aType !== bType) return false;

    if (aType === 'object') {
      var aValue = a.valueOf();
      var bValue = b.valueOf();

      if (aValue !== a || bValue !== b) return valueEqual(aValue, bValue);

      var aKeys = Object.keys(a);
      var bKeys = Object.keys(b);

      if (aKeys.length !== bKeys.length) return false;

      return aKeys.every(function (key) {
        return valueEqual(a[key], b[key]);
      });
    }

    return false;
  }

  var addLeadingSlash = function addLeadingSlash(path) {
    return path.charAt(0) === '/' ? path : '/' + path;
  };

  var stripLeadingSlash = function stripLeadingSlash(path) {
    return path.charAt(0) === '/' ? path.substr(1) : path;
  };

  var hasBasename = function hasBasename(path, prefix) {
    return new RegExp('^' + prefix + '(\\/|\\?|#|$)', 'i').test(path);
  };

  var stripBasename = function stripBasename(path, prefix) {
    return hasBasename(path, prefix) ? path.substr(prefix.length) : path;
  };

  var stripTrailingSlash = function stripTrailingSlash(path) {
    return path.charAt(path.length - 1) === '/' ? path.slice(0, -1) : path;
  };

  var parsePath = function parsePath(path) {
    var pathname = path || '/';
    var search = '';
    var hash = '';

    var hashIndex = pathname.indexOf('#');
    if (hashIndex !== -1) {
      hash = pathname.substr(hashIndex);
      pathname = pathname.substr(0, hashIndex);
    }

    var searchIndex = pathname.indexOf('?');
    if (searchIndex !== -1) {
      search = pathname.substr(searchIndex);
      pathname = pathname.substr(0, searchIndex);
    }

    return {
      pathname: pathname,
      search: search === '?' ? '' : search,
      hash: hash === '#' ? '' : hash
    };
  };

  var createPath = function createPath(location) {
    var pathname = location.pathname,
        search = location.search,
        hash = location.hash;


    var path = pathname || '/';

    if (search && search !== '?') path += search.charAt(0) === '?' ? search : '?' + search;

    if (hash && hash !== '#') path += hash.charAt(0) === '#' ? hash : '#' + hash;

    return path;
  };

  var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  var createLocation = function createLocation(path, state, key, currentLocation) {
    var location = void 0;
    if (typeof path === 'string') {
      // Two-arg form: push(path, state)
      location = parsePath(path);
      location.state = state;
    } else {
      // One-arg form: push(location)
      location = _extends({}, path);

      if (location.pathname === undefined) location.pathname = '';

      if (location.search) {
        if (location.search.charAt(0) !== '?') location.search = '?' + location.search;
      } else {
        location.search = '';
      }

      if (location.hash) {
        if (location.hash.charAt(0) !== '#') location.hash = '#' + location.hash;
      } else {
        location.hash = '';
      }

      if (state !== undefined && location.state === undefined) location.state = state;
    }

    try {
      location.pathname = decodeURI(location.pathname);
    } catch (e) {
      if (e instanceof URIError) {
        throw new URIError('Pathname "' + location.pathname + '" could not be decoded. ' + 'This is likely caused by an invalid percent-encoding.');
      } else {
        throw e;
      }
    }

    if (key) location.key = key;

    if (currentLocation) {
      // Resolve incomplete/relative pathname relative to current location.
      if (!location.pathname) {
        location.pathname = currentLocation.pathname;
      } else if (location.pathname.charAt(0) !== '/') {
        location.pathname = resolvePathname(location.pathname, currentLocation.pathname);
      }
    } else {
      // When there is no prior location and pathname is empty, set it to /
      if (!location.pathname) {
        location.pathname = '/';
      }
    }

    return location;
  };

  var locationsAreEqual = function locationsAreEqual(a, b) {
    return a.pathname === b.pathname && a.search === b.search && a.hash === b.hash && a.key === b.key && valueEqual(a.state, b.state);
  };

  var createTransitionManager = function createTransitionManager() {
    var prompt = null;

    var setPrompt = function setPrompt(nextPrompt) {
      warning_1$1(prompt == null, 'A history supports only one prompt at a time');

      prompt = nextPrompt;

      return function () {
        if (prompt === nextPrompt) prompt = null;
      };
    };

    var confirmTransitionTo = function confirmTransitionTo(location, action, getUserConfirmation, callback) {
      // TODO: If another transition starts while we're still confirming
      // the previous one, we may end up in a weird state. Figure out the
      // best way to handle this.
      if (prompt != null) {
        var result = typeof prompt === 'function' ? prompt(location, action) : prompt;

        if (typeof result === 'string') {
          if (typeof getUserConfirmation === 'function') {
            getUserConfirmation(result, callback);
          } else {
            warning_1$1(false, 'A history needs a getUserConfirmation function in order to use a prompt message');

            callback(true);
          }
        } else {
          // Return false from a transition hook to cancel the transition.
          callback(result !== false);
        }
      } else {
        callback(true);
      }
    };

    var listeners = [];

    var appendListener = function appendListener(fn) {
      var isActive = true;

      var listener = function listener() {
        if (isActive) fn.apply(undefined, arguments);
      };

      listeners.push(listener);

      return function () {
        isActive = false;
        listeners = listeners.filter(function (item) {
          return item !== listener;
        });
      };
    };

    var notifyListeners = function notifyListeners() {
      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      listeners.forEach(function (listener) {
        return listener.apply(undefined, args);
      });
    };

    return {
      setPrompt: setPrompt,
      confirmTransitionTo: confirmTransitionTo,
      appendListener: appendListener,
      notifyListeners: notifyListeners
    };
  };

  var canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);

  var addEventListener = function addEventListener(node, event, listener) {
    return node.addEventListener ? node.addEventListener(event, listener, false) : node.attachEvent('on' + event, listener);
  };

  var removeEventListener = function removeEventListener(node, event, listener) {
    return node.removeEventListener ? node.removeEventListener(event, listener, false) : node.detachEvent('on' + event, listener);
  };

  var getConfirmation = function getConfirmation(message, callback) {
    return callback(window.confirm(message));
  }; // eslint-disable-line no-alert

  /**
   * Returns true if the HTML5 history API is supported. Taken from Modernizr.
   *
   * https://github.com/Modernizr/Modernizr/blob/master/LICENSE
   * https://github.com/Modernizr/Modernizr/blob/master/feature-detects/history.js
   * changed to avoid false negatives for Windows Phones: https://github.com/reactjs/react-router/issues/586
   */
  var supportsHistory = function supportsHistory() {
    var ua = window.navigator.userAgent;

    if ((ua.indexOf('Android 2.') !== -1 || ua.indexOf('Android 4.0') !== -1) && ua.indexOf('Mobile Safari') !== -1 && ua.indexOf('Chrome') === -1 && ua.indexOf('Windows Phone') === -1) return false;

    return window.history && 'pushState' in window.history;
  };

  /**
   * Returns true if browser fires popstate on hash change.
   * IE10 and IE11 do not.
   */
  var supportsPopStateOnHashChange = function supportsPopStateOnHashChange() {
    return window.navigator.userAgent.indexOf('Trident') === -1;
  };

  /**
   * Returns false if using go(n) with hash history causes a full page reload.
   */
  var supportsGoWithoutReloadUsingHash = function supportsGoWithoutReloadUsingHash() {
    return window.navigator.userAgent.indexOf('Firefox') === -1;
  };

  /**
   * Returns true if a given popstate event is an extraneous WebKit event.
   * Accounts for the fact that Chrome on iOS fires real popstate events
   * containing undefined state when pressing the back button.
   */
  var isExtraneousPopstateEvent = function isExtraneousPopstateEvent(event) {
    return event.state === undefined && navigator.userAgent.indexOf('CriOS') === -1;
  };

  var _typeof$1 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

  var _extends$1 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  var PopStateEvent = 'popstate';
  var HashChangeEvent = 'hashchange';

  var getHistoryState = function getHistoryState() {
    try {
      return window.history.state || {};
    } catch (e) {
      // IE 11 sometimes throws when accessing window.history.state
      // See https://github.com/ReactTraining/history/pull/289
      return {};
    }
  };

  /**
   * Creates a history object that uses the HTML5 history API including
   * pushState, replaceState, and the popstate event.
   */
  var createBrowserHistory = function createBrowserHistory() {
    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    invariant_1(canUseDOM, 'Browser history needs a DOM');

    var globalHistory = window.history;
    var canUseHistory = supportsHistory();
    var needsHashChangeListener = !supportsPopStateOnHashChange();

    var _props$forceRefresh = props.forceRefresh,
        forceRefresh = _props$forceRefresh === undefined ? false : _props$forceRefresh,
        _props$getUserConfirm = props.getUserConfirmation,
        getUserConfirmation = _props$getUserConfirm === undefined ? getConfirmation : _props$getUserConfirm,
        _props$keyLength = props.keyLength,
        keyLength = _props$keyLength === undefined ? 6 : _props$keyLength;

    var basename = props.basename ? stripTrailingSlash(addLeadingSlash(props.basename)) : '';

    var getDOMLocation = function getDOMLocation(historyState) {
      var _ref = historyState || {},
          key = _ref.key,
          state = _ref.state;

      var _window$location = window.location,
          pathname = _window$location.pathname,
          search = _window$location.search,
          hash = _window$location.hash;


      var path = pathname + search + hash;

      warning_1$1(!basename || hasBasename(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path "' + path + '" to begin with "' + basename + '".');

      if (basename) path = stripBasename(path, basename);

      return createLocation(path, state, key);
    };

    var createKey = function createKey() {
      return Math.random().toString(36).substr(2, keyLength);
    };

    var transitionManager = createTransitionManager();

    var setState = function setState(nextState) {
      _extends$1(history, nextState);

      history.length = globalHistory.length;

      transitionManager.notifyListeners(history.location, history.action);
    };

    var handlePopState = function handlePopState(event) {
      // Ignore extraneous popstate events in WebKit.
      if (isExtraneousPopstateEvent(event)) return;

      handlePop(getDOMLocation(event.state));
    };

    var handleHashChange = function handleHashChange() {
      handlePop(getDOMLocation(getHistoryState()));
    };

    var forceNextPop = false;

    var handlePop = function handlePop(location) {
      if (forceNextPop) {
        forceNextPop = false;
        setState();
      } else {
        var action = 'POP';

        transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
          if (ok) {
            setState({ action: action, location: location });
          } else {
            revertPop(location);
          }
        });
      }
    };

    var revertPop = function revertPop(fromLocation) {
      var toLocation = history.location;

      // TODO: We could probably make this more reliable by
      // keeping a list of keys we've seen in sessionStorage.
      // Instead, we just default to 0 for keys we don't know.

      var toIndex = allKeys.indexOf(toLocation.key);

      if (toIndex === -1) toIndex = 0;

      var fromIndex = allKeys.indexOf(fromLocation.key);

      if (fromIndex === -1) fromIndex = 0;

      var delta = toIndex - fromIndex;

      if (delta) {
        forceNextPop = true;
        go(delta);
      }
    };

    var initialLocation = getDOMLocation(getHistoryState());
    var allKeys = [initialLocation.key];

    // Public interface

    var createHref = function createHref(location) {
      return basename + createPath(location);
    };

    var push = function push(path, state) {
      warning_1$1(!((typeof path === 'undefined' ? 'undefined' : _typeof$1(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to push when the 1st ' + 'argument is a location-like object that already has state; it is ignored');

      var action = 'PUSH';
      var location = createLocation(path, state, createKey(), history.location);

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (!ok) return;

        var href = createHref(location);
        var key = location.key,
            state = location.state;


        if (canUseHistory) {
          globalHistory.pushState({ key: key, state: state }, null, href);

          if (forceRefresh) {
            window.location.href = href;
          } else {
            var prevIndex = allKeys.indexOf(history.location.key);
            var nextKeys = allKeys.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);

            nextKeys.push(location.key);
            allKeys = nextKeys;

            setState({ action: action, location: location });
          }
        } else {
          warning_1$1(state === undefined, 'Browser history cannot push state in browsers that do not support HTML5 history');

          window.location.href = href;
        }
      });
    };

    var replace = function replace(path, state) {
      warning_1$1(!((typeof path === 'undefined' ? 'undefined' : _typeof$1(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to replace when the 1st ' + 'argument is a location-like object that already has state; it is ignored');

      var action = 'REPLACE';
      var location = createLocation(path, state, createKey(), history.location);

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (!ok) return;

        var href = createHref(location);
        var key = location.key,
            state = location.state;


        if (canUseHistory) {
          globalHistory.replaceState({ key: key, state: state }, null, href);

          if (forceRefresh) {
            window.location.replace(href);
          } else {
            var prevIndex = allKeys.indexOf(history.location.key);

            if (prevIndex !== -1) allKeys[prevIndex] = location.key;

            setState({ action: action, location: location });
          }
        } else {
          warning_1$1(state === undefined, 'Browser history cannot replace state in browsers that do not support HTML5 history');

          window.location.replace(href);
        }
      });
    };

    var go = function go(n) {
      globalHistory.go(n);
    };

    var goBack = function goBack() {
      return go(-1);
    };

    var goForward = function goForward() {
      return go(1);
    };

    var listenerCount = 0;

    var checkDOMListeners = function checkDOMListeners(delta) {
      listenerCount += delta;

      if (listenerCount === 1) {
        addEventListener(window, PopStateEvent, handlePopState);

        if (needsHashChangeListener) addEventListener(window, HashChangeEvent, handleHashChange);
      } else if (listenerCount === 0) {
        removeEventListener(window, PopStateEvent, handlePopState);

        if (needsHashChangeListener) removeEventListener(window, HashChangeEvent, handleHashChange);
      }
    };

    var isBlocked = false;

    var block = function block() {
      var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

      var unblock = transitionManager.setPrompt(prompt);

      if (!isBlocked) {
        checkDOMListeners(1);
        isBlocked = true;
      }

      return function () {
        if (isBlocked) {
          isBlocked = false;
          checkDOMListeners(-1);
        }

        return unblock();
      };
    };

    var listen = function listen(listener) {
      var unlisten = transitionManager.appendListener(listener);
      checkDOMListeners(1);

      return function () {
        checkDOMListeners(-1);
        unlisten();
      };
    };

    var history = {
      length: globalHistory.length,
      action: 'POP',
      location: initialLocation,
      createHref: createHref,
      push: push,
      replace: replace,
      go: go,
      goBack: goBack,
      goForward: goForward,
      block: block,
      listen: listen
    };

    return history;
  };

  var _extends$2 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  var HashChangeEvent$1 = 'hashchange';

  var HashPathCoders = {
    hashbang: {
      encodePath: function encodePath(path) {
        return path.charAt(0) === '!' ? path : '!/' + stripLeadingSlash(path);
      },
      decodePath: function decodePath(path) {
        return path.charAt(0) === '!' ? path.substr(1) : path;
      }
    },
    noslash: {
      encodePath: stripLeadingSlash,
      decodePath: addLeadingSlash
    },
    slash: {
      encodePath: addLeadingSlash,
      decodePath: addLeadingSlash
    }
  };

  var getHashPath = function getHashPath() {
    // We can't use window.location.hash here because it's not
    // consistent across browsers - Firefox will pre-decode it!
    var href = window.location.href;
    var hashIndex = href.indexOf('#');
    return hashIndex === -1 ? '' : href.substring(hashIndex + 1);
  };

  var pushHashPath = function pushHashPath(path) {
    return window.location.hash = path;
  };

  var replaceHashPath = function replaceHashPath(path) {
    var hashIndex = window.location.href.indexOf('#');

    window.location.replace(window.location.href.slice(0, hashIndex >= 0 ? hashIndex : 0) + '#' + path);
  };

  var createHashHistory = function createHashHistory() {
    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    invariant_1(canUseDOM, 'Hash history needs a DOM');

    var globalHistory = window.history;
    var canGoWithoutReload = supportsGoWithoutReloadUsingHash();

    var _props$getUserConfirm = props.getUserConfirmation,
        getUserConfirmation = _props$getUserConfirm === undefined ? getConfirmation : _props$getUserConfirm,
        _props$hashType = props.hashType,
        hashType = _props$hashType === undefined ? 'slash' : _props$hashType;

    var basename = props.basename ? stripTrailingSlash(addLeadingSlash(props.basename)) : '';

    var _HashPathCoders$hashT = HashPathCoders[hashType],
        encodePath = _HashPathCoders$hashT.encodePath,
        decodePath = _HashPathCoders$hashT.decodePath;


    var getDOMLocation = function getDOMLocation() {
      var path = decodePath(getHashPath());

      warning_1$1(!basename || hasBasename(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path "' + path + '" to begin with "' + basename + '".');

      if (basename) path = stripBasename(path, basename);

      return createLocation(path);
    };

    var transitionManager = createTransitionManager();

    var setState = function setState(nextState) {
      _extends$2(history, nextState);

      history.length = globalHistory.length;

      transitionManager.notifyListeners(history.location, history.action);
    };

    var forceNextPop = false;
    var ignorePath = null;

    var handleHashChange = function handleHashChange() {
      var path = getHashPath();
      var encodedPath = encodePath(path);

      if (path !== encodedPath) {
        // Ensure we always have a properly-encoded hash.
        replaceHashPath(encodedPath);
      } else {
        var location = getDOMLocation();
        var prevLocation = history.location;

        if (!forceNextPop && locationsAreEqual(prevLocation, location)) return; // A hashchange doesn't always == location change.

        if (ignorePath === createPath(location)) return; // Ignore this change; we already setState in push/replace.

        ignorePath = null;

        handlePop(location);
      }
    };

    var handlePop = function handlePop(location) {
      if (forceNextPop) {
        forceNextPop = false;
        setState();
      } else {
        var action = 'POP';

        transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
          if (ok) {
            setState({ action: action, location: location });
          } else {
            revertPop(location);
          }
        });
      }
    };

    var revertPop = function revertPop(fromLocation) {
      var toLocation = history.location;

      // TODO: We could probably make this more reliable by
      // keeping a list of paths we've seen in sessionStorage.
      // Instead, we just default to 0 for paths we don't know.

      var toIndex = allPaths.lastIndexOf(createPath(toLocation));

      if (toIndex === -1) toIndex = 0;

      var fromIndex = allPaths.lastIndexOf(createPath(fromLocation));

      if (fromIndex === -1) fromIndex = 0;

      var delta = toIndex - fromIndex;

      if (delta) {
        forceNextPop = true;
        go(delta);
      }
    };

    // Ensure the hash is encoded properly before doing anything else.
    var path = getHashPath();
    var encodedPath = encodePath(path);

    if (path !== encodedPath) replaceHashPath(encodedPath);

    var initialLocation = getDOMLocation();
    var allPaths = [createPath(initialLocation)];

    // Public interface

    var createHref = function createHref(location) {
      return '#' + encodePath(basename + createPath(location));
    };

    var push = function push(path, state) {
      warning_1$1(state === undefined, 'Hash history cannot push state; it is ignored');

      var action = 'PUSH';
      var location = createLocation(path, undefined, undefined, history.location);

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (!ok) return;

        var path = createPath(location);
        var encodedPath = encodePath(basename + path);
        var hashChanged = getHashPath() !== encodedPath;

        if (hashChanged) {
          // We cannot tell if a hashchange was caused by a PUSH, so we'd
          // rather setState here and ignore the hashchange. The caveat here
          // is that other hash histories in the page will consider it a POP.
          ignorePath = path;
          pushHashPath(encodedPath);

          var prevIndex = allPaths.lastIndexOf(createPath(history.location));
          var nextPaths = allPaths.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);

          nextPaths.push(path);
          allPaths = nextPaths;

          setState({ action: action, location: location });
        } else {
          warning_1$1(false, 'Hash history cannot PUSH the same path; a new entry will not be added to the history stack');

          setState();
        }
      });
    };

    var replace = function replace(path, state) {
      warning_1$1(state === undefined, 'Hash history cannot replace state; it is ignored');

      var action = 'REPLACE';
      var location = createLocation(path, undefined, undefined, history.location);

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (!ok) return;

        var path = createPath(location);
        var encodedPath = encodePath(basename + path);
        var hashChanged = getHashPath() !== encodedPath;

        if (hashChanged) {
          // We cannot tell if a hashchange was caused by a REPLACE, so we'd
          // rather setState here and ignore the hashchange. The caveat here
          // is that other hash histories in the page will consider it a POP.
          ignorePath = path;
          replaceHashPath(encodedPath);
        }

        var prevIndex = allPaths.indexOf(createPath(history.location));

        if (prevIndex !== -1) allPaths[prevIndex] = path;

        setState({ action: action, location: location });
      });
    };

    var go = function go(n) {
      warning_1$1(canGoWithoutReload, 'Hash history go(n) causes a full page reload in this browser');

      globalHistory.go(n);
    };

    var goBack = function goBack() {
      return go(-1);
    };

    var goForward = function goForward() {
      return go(1);
    };

    var listenerCount = 0;

    var checkDOMListeners = function checkDOMListeners(delta) {
      listenerCount += delta;

      if (listenerCount === 1) {
        addEventListener(window, HashChangeEvent$1, handleHashChange);
      } else if (listenerCount === 0) {
        removeEventListener(window, HashChangeEvent$1, handleHashChange);
      }
    };

    var isBlocked = false;

    var block = function block() {
      var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

      var unblock = transitionManager.setPrompt(prompt);

      if (!isBlocked) {
        checkDOMListeners(1);
        isBlocked = true;
      }

      return function () {
        if (isBlocked) {
          isBlocked = false;
          checkDOMListeners(-1);
        }

        return unblock();
      };
    };

    var listen = function listen(listener) {
      var unlisten = transitionManager.appendListener(listener);
      checkDOMListeners(1);

      return function () {
        checkDOMListeners(-1);
        unlisten();
      };
    };

    var history = {
      length: globalHistory.length,
      action: 'POP',
      location: initialLocation,
      createHref: createHref,
      push: push,
      replace: replace,
      go: go,
      goBack: goBack,
      goForward: goForward,
      block: block,
      listen: listen
    };

    return history;
  };

  var _typeof$2 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

  var _extends$3 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  var clamp = function clamp(n, lowerBound, upperBound) {
    return Math.min(Math.max(n, lowerBound), upperBound);
  };

  /**
   * Creates a history object that stores locations in memory.
   */
  var createMemoryHistory = function createMemoryHistory() {
    var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var getUserConfirmation = props.getUserConfirmation,
        _props$initialEntries = props.initialEntries,
        initialEntries = _props$initialEntries === undefined ? ['/'] : _props$initialEntries,
        _props$initialIndex = props.initialIndex,
        initialIndex = _props$initialIndex === undefined ? 0 : _props$initialIndex,
        _props$keyLength = props.keyLength,
        keyLength = _props$keyLength === undefined ? 6 : _props$keyLength;


    var transitionManager = createTransitionManager();

    var setState = function setState(nextState) {
      _extends$3(history, nextState);

      history.length = history.entries.length;

      transitionManager.notifyListeners(history.location, history.action);
    };

    var createKey = function createKey() {
      return Math.random().toString(36).substr(2, keyLength);
    };

    var index = clamp(initialIndex, 0, initialEntries.length - 1);
    var entries = initialEntries.map(function (entry) {
      return typeof entry === 'string' ? createLocation(entry, undefined, createKey()) : createLocation(entry, undefined, entry.key || createKey());
    });

    // Public interface

    var createHref = createPath;

    var push = function push(path, state) {
      warning_1$1(!((typeof path === 'undefined' ? 'undefined' : _typeof$2(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to push when the 1st ' + 'argument is a location-like object that already has state; it is ignored');

      var action = 'PUSH';
      var location = createLocation(path, state, createKey(), history.location);

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (!ok) return;

        var prevIndex = history.index;
        var nextIndex = prevIndex + 1;

        var nextEntries = history.entries.slice(0);
        if (nextEntries.length > nextIndex) {
          nextEntries.splice(nextIndex, nextEntries.length - nextIndex, location);
        } else {
          nextEntries.push(location);
        }

        setState({
          action: action,
          location: location,
          index: nextIndex,
          entries: nextEntries
        });
      });
    };

    var replace = function replace(path, state) {
      warning_1$1(!((typeof path === 'undefined' ? 'undefined' : _typeof$2(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to replace when the 1st ' + 'argument is a location-like object that already has state; it is ignored');

      var action = 'REPLACE';
      var location = createLocation(path, state, createKey(), history.location);

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (!ok) return;

        history.entries[history.index] = location;

        setState({ action: action, location: location });
      });
    };

    var go = function go(n) {
      var nextIndex = clamp(history.index + n, 0, history.entries.length - 1);

      var action = 'POP';
      var location = history.entries[nextIndex];

      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {
        if (ok) {
          setState({
            action: action,
            location: location,
            index: nextIndex
          });
        } else {
          // Mimic the behavior of DOM histories by
          // causing a render after a cancelled POP.
          setState();
        }
      });
    };

    var goBack = function goBack() {
      return go(-1);
    };

    var goForward = function goForward() {
      return go(1);
    };

    var canGo = function canGo(n) {
      var nextIndex = history.index + n;
      return nextIndex >= 0 && nextIndex < history.entries.length;
    };

    var block = function block() {
      var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      return transitionManager.setPrompt(prompt);
    };

    var listen = function listen(listener) {
      return transitionManager.appendListener(listener);
    };

    var history = {
      length: entries.length,
      action: 'POP',
      location: entries[index],
      index: index,
      entries: entries,
      createHref: createHref,
      push: push,
      replace: replace,
      go: go,
      goBack: goBack,
      goForward: goForward,
      canGo: canGo,
      block: block,
      listen: listen
    };

    return history;
  };

  /**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */

  /**
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */

  var __DEV__$2 = process.env.NODE_ENV !== 'production';

  var warning$2 = function() {};

  if (__DEV__$2) {
    var printWarning$3 = function printWarning(format, args) {
      var len = arguments.length;
      args = new Array(len > 2 ? len - 2 : 0);
      for (var key = 2; key < len; key++) {
        args[key - 2] = arguments[key];
      }
      var argIndex = 0;
      var message = 'Warning: ' +
        format.replace(/%s/g, function() {
          return args[argIndex++];
        });
      if (typeof console !== 'undefined') {
        console.error(message);
      }
      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };

    warning$2 = function(condition, format, args) {
      var len = arguments.length;
      args = new Array(len > 2 ? len - 2 : 0);
      for (var key = 2; key < len; key++) {
        args[key - 2] = arguments[key];
      }
      if (format === undefined) {
        throw new Error(
            '`warning(condition, format, ...args)` requires a warning ' +
            'message argument'
        );
      }
      if (!condition) {
        printWarning$3.apply(null, [format].concat(args));
      }
    };
  }

  var warning_1$2 = warning$2;

  var _extends$4 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  function _classCallCheck$1(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$1(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$1(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for putting history on context.
   */

  var Router = function (_React$Component) {
    _inherits$1(Router, _React$Component);

    function Router() {
      var _temp, _this, _ret;

      _classCallCheck$1(this, Router);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$1(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.state = {
        match: _this.computeMatch(_this.props.history.location.pathname)
      }, _temp), _possibleConstructorReturn$1(_this, _ret);
    }

    Router.prototype.getChildContext = function getChildContext() {
      return {
        router: _extends$4({}, this.context.router, {
          history: this.props.history,
          route: {
            location: this.props.history.location,
            match: this.state.match
          }
        })
      };
    };

    Router.prototype.computeMatch = function computeMatch(pathname) {
      return {
        path: "/",
        url: "/",
        params: {},
        isExact: pathname === "/"
      };
    };

    Router.prototype.componentWillMount = function componentWillMount() {
      var _this2 = this;

      var _props = this.props,
          children = _props.children,
          history = _props.history;


      invariant_1(children == null || React__default.Children.count(children) === 1, "A <Router> may have only one child element");

      // Do this here so we can setState when a <Redirect> changes the
      // location in componentWillMount. This happens e.g. when doing
      // server rendering using a <StaticRouter>.
      this.unlisten = history.listen(function () {
        _this2.setState({
          match: _this2.computeMatch(history.location.pathname)
        });
      });
    };

    Router.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
      warning_1$2(this.props.history === nextProps.history, "You cannot change <Router history>");
    };

    Router.prototype.componentWillUnmount = function componentWillUnmount() {
      this.unlisten();
    };

    Router.prototype.render = function render() {
      var children = this.props.children;

      return children ? React__default.Children.only(children) : null;
    };

    return Router;
  }(React__default.Component);

  Router.propTypes = {
    history: propTypes.object.isRequired,
    children: propTypes.node
  };
  Router.contextTypes = {
    router: propTypes.object
  };
  Router.childContextTypes = {
    router: propTypes.object.isRequired
  };

  // Written in this round about way for babel-transform-imports

  function _classCallCheck$2(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$2(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$2(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for a <Router> that uses HTML5 history.
   */

  var BrowserRouter = function (_React$Component) {
    _inherits$2(BrowserRouter, _React$Component);

    function BrowserRouter() {
      var _temp, _this, _ret;

      _classCallCheck$2(this, BrowserRouter);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$2(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.history = createBrowserHistory(_this.props), _temp), _possibleConstructorReturn$2(_this, _ret);
    }

    BrowserRouter.prototype.componentWillMount = function componentWillMount() {
      warning_1(!this.props.history, "<BrowserRouter> ignores the history prop. To use a custom history, " + "use `import { Router }` instead of `import { BrowserRouter as Router }`.");
    };

    BrowserRouter.prototype.render = function render() {
      return React__default.createElement(Router, { history: this.history, children: this.props.children });
    };

    return BrowserRouter;
  }(React__default.Component);

  BrowserRouter.propTypes = {
    basename: propTypes.string,
    forceRefresh: propTypes.bool,
    getUserConfirmation: propTypes.func,
    keyLength: propTypes.number,
    children: propTypes.node
  };

  function _classCallCheck$3(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$3(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$3(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for a <Router> that uses window.location.hash.
   */

  var HashRouter = function (_React$Component) {
    _inherits$3(HashRouter, _React$Component);

    function HashRouter() {
      var _temp, _this, _ret;

      _classCallCheck$3(this, HashRouter);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$3(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.history = createHashHistory(_this.props), _temp), _possibleConstructorReturn$3(_this, _ret);
    }

    HashRouter.prototype.componentWillMount = function componentWillMount() {
      warning_1(!this.props.history, "<HashRouter> ignores the history prop. To use a custom history, " + "use `import { Router }` instead of `import { HashRouter as Router }`.");
    };

    HashRouter.prototype.render = function render() {
      return React__default.createElement(Router, { history: this.history, children: this.props.children });
    };

    return HashRouter;
  }(React__default.Component);

  HashRouter.propTypes = {
    basename: propTypes.string,
    getUserConfirmation: propTypes.func,
    hashType: propTypes.oneOf(["hashbang", "noslash", "slash"]),
    children: propTypes.node
  };

  var _extends$5 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

  function _classCallCheck$4(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$4(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$4(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  var isModifiedEvent = function isModifiedEvent(event) {
    return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);
  };

  /**
   * The public API for rendering a history-aware <a>.
   */

  var Link = function (_React$Component) {
    _inherits$4(Link, _React$Component);

    function Link() {
      var _temp, _this, _ret;

      _classCallCheck$4(this, Link);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$4(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.handleClick = function (event) {
        if (_this.props.onClick) _this.props.onClick(event);

        if (!event.defaultPrevented && // onClick prevented default
        event.button === 0 && // ignore everything but left clicks
        !_this.props.target && // let browser handle "target=_blank" etc.
        !isModifiedEvent(event) // ignore clicks with modifier keys
        ) {
            event.preventDefault();

            var history = _this.context.router.history;
            var _this$props = _this.props,
                replace = _this$props.replace,
                to = _this$props.to;


            if (replace) {
              history.replace(to);
            } else {
              history.push(to);
            }
          }
      }, _temp), _possibleConstructorReturn$4(_this, _ret);
    }

    Link.prototype.render = function render() {
      var _props = this.props,
          replace = _props.replace,
          to = _props.to,
          innerRef = _props.innerRef,
          props = _objectWithoutProperties(_props, ["replace", "to", "innerRef"]); // eslint-disable-line no-unused-vars

      invariant_1(this.context.router, "You should not use <Link> outside a <Router>");

      invariant_1(to !== undefined, 'You must specify the "to" property');

      var history = this.context.router.history;

      var location = typeof to === "string" ? createLocation(to, null, null, history.location) : to;

      var href = history.createHref(location);
      return React__default.createElement("a", _extends$5({}, props, { onClick: this.handleClick, href: href, ref: innerRef }));
    };

    return Link;
  }(React__default.Component);

  Link.propTypes = {
    onClick: propTypes.func,
    target: propTypes.string,
    replace: propTypes.bool,
    to: propTypes.oneOfType([propTypes.string, propTypes.object]).isRequired,
    innerRef: propTypes.oneOfType([propTypes.string, propTypes.func])
  };
  Link.defaultProps = {
    replace: false
  };
  Link.contextTypes = {
    router: propTypes.shape({
      history: propTypes.shape({
        push: propTypes.func.isRequired,
        replace: propTypes.func.isRequired,
        createHref: propTypes.func.isRequired
      }).isRequired
    }).isRequired
  };

  function _classCallCheck$5(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$5(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$5(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for a <Router> that stores location in memory.
   */

  var MemoryRouter = function (_React$Component) {
    _inherits$5(MemoryRouter, _React$Component);

    function MemoryRouter() {
      var _temp, _this, _ret;

      _classCallCheck$5(this, MemoryRouter);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$5(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.history = createMemoryHistory(_this.props), _temp), _possibleConstructorReturn$5(_this, _ret);
    }

    MemoryRouter.prototype.componentWillMount = function componentWillMount() {
      warning_1$2(!this.props.history, "<MemoryRouter> ignores the history prop. To use a custom history, " + "use `import { Router }` instead of `import { MemoryRouter as Router }`.");
    };

    MemoryRouter.prototype.render = function render() {
      return React__default.createElement(Router, { history: this.history, children: this.props.children });
    };

    return MemoryRouter;
  }(React__default.Component);

  MemoryRouter.propTypes = {
    initialEntries: propTypes.array,
    initialIndex: propTypes.number,
    getUserConfirmation: propTypes.func,
    keyLength: propTypes.number,
    children: propTypes.node
  };

  // Written in this round about way for babel-transform-imports

  var isarray = Array.isArray || function (arr) {
    return Object.prototype.toString.call(arr) == '[object Array]';
  };

  /**
   * Expose `pathToRegexp`.
   */
  var pathToRegexp_1 = pathToRegexp;
  var parse_1 = parse;
  var compile_1 = compile;
  var tokensToFunction_1 = tokensToFunction;
  var tokensToRegExp_1 = tokensToRegExp;

  /**
   * The main path matching regexp utility.
   *
   * @type {RegExp}
   */
  var PATH_REGEXP = new RegExp([
    // Match escaped characters that would otherwise appear in future matches.
    // This allows the user to escape special characters that won't transform.
    '(\\\\.)',
    // Match Express-style parameters and un-named parameters with a prefix
    // and optional suffixes. Matches appear as:
    //
    // "/:test(\\d+)?" => ["/", "test", "\d+", undefined, "?", undefined]
    // "/route(\\d+)"  => [undefined, undefined, undefined, "\d+", undefined, undefined]
    // "/*"            => ["/", undefined, undefined, undefined, undefined, "*"]
    '([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))'
  ].join('|'), 'g');

  /**
   * Parse a string for the raw tokens.
   *
   * @param  {string}  str
   * @param  {Object=} options
   * @return {!Array}
   */
  function parse (str, options) {
    var tokens = [];
    var key = 0;
    var index = 0;
    var path = '';
    var defaultDelimiter = options && options.delimiter || '/';
    var res;

    while ((res = PATH_REGEXP.exec(str)) != null) {
      var m = res[0];
      var escaped = res[1];
      var offset = res.index;
      path += str.slice(index, offset);
      index = offset + m.length;

      // Ignore already escaped sequences.
      if (escaped) {
        path += escaped[1];
        continue
      }

      var next = str[index];
      var prefix = res[2];
      var name = res[3];
      var capture = res[4];
      var group = res[5];
      var modifier = res[6];
      var asterisk = res[7];

      // Push the current path onto the tokens.
      if (path) {
        tokens.push(path);
        path = '';
      }

      var partial = prefix != null && next != null && next !== prefix;
      var repeat = modifier === '+' || modifier === '*';
      var optional = modifier === '?' || modifier === '*';
      var delimiter = res[2] || defaultDelimiter;
      var pattern = capture || group;

      tokens.push({
        name: name || key++,
        prefix: prefix || '',
        delimiter: delimiter,
        optional: optional,
        repeat: repeat,
        partial: partial,
        asterisk: !!asterisk,
        pattern: pattern ? escapeGroup(pattern) : (asterisk ? '.*' : '[^' + escapeString(delimiter) + ']+?')
      });
    }

    // Match any characters still remaining.
    if (index < str.length) {
      path += str.substr(index);
    }

    // If the path exists, push it onto the end.
    if (path) {
      tokens.push(path);
    }

    return tokens
  }

  /**
   * Compile a string to a template function for the path.
   *
   * @param  {string}             str
   * @param  {Object=}            options
   * @return {!function(Object=, Object=)}
   */
  function compile (str, options) {
    return tokensToFunction(parse(str, options))
  }

  /**
   * Prettier encoding of URI path segments.
   *
   * @param  {string}
   * @return {string}
   */
  function encodeURIComponentPretty (str) {
    return encodeURI(str).replace(/[\/?#]/g, function (c) {
      return '%' + c.charCodeAt(0).toString(16).toUpperCase()
    })
  }

  /**
   * Encode the asterisk parameter. Similar to `pretty`, but allows slashes.
   *
   * @param  {string}
   * @return {string}
   */
  function encodeAsterisk (str) {
    return encodeURI(str).replace(/[?#]/g, function (c) {
      return '%' + c.charCodeAt(0).toString(16).toUpperCase()
    })
  }

  /**
   * Expose a method for transforming tokens into the path function.
   */
  function tokensToFunction (tokens) {
    // Compile all the tokens into regexps.
    var matches = new Array(tokens.length);

    // Compile all the patterns before compilation.
    for (var i = 0; i < tokens.length; i++) {
      if (typeof tokens[i] === 'object') {
        matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$');
      }
    }

    return function (obj, opts) {
      var path = '';
      var data = obj || {};
      var options = opts || {};
      var encode = options.pretty ? encodeURIComponentPretty : encodeURIComponent;

      for (var i = 0; i < tokens.length; i++) {
        var token = tokens[i];

        if (typeof token === 'string') {
          path += token;

          continue
        }

        var value = data[token.name];
        var segment;

        if (value == null) {
          if (token.optional) {
            // Prepend partial segment prefixes.
            if (token.partial) {
              path += token.prefix;
            }

            continue
          } else {
            throw new TypeError('Expected "' + token.name + '" to be defined')
          }
        }

        if (isarray(value)) {
          if (!token.repeat) {
            throw new TypeError('Expected "' + token.name + '" to not repeat, but received `' + JSON.stringify(value) + '`')
          }

          if (value.length === 0) {
            if (token.optional) {
              continue
            } else {
              throw new TypeError('Expected "' + token.name + '" to not be empty')
            }
          }

          for (var j = 0; j < value.length; j++) {
            segment = encode(value[j]);

            if (!matches[i].test(segment)) {
              throw new TypeError('Expected all "' + token.name + '" to match "' + token.pattern + '", but received `' + JSON.stringify(segment) + '`')
            }

            path += (j === 0 ? token.prefix : token.delimiter) + segment;
          }

          continue
        }

        segment = token.asterisk ? encodeAsterisk(value) : encode(value);

        if (!matches[i].test(segment)) {
          throw new TypeError('Expected "' + token.name + '" to match "' + token.pattern + '", but received "' + segment + '"')
        }

        path += token.prefix + segment;
      }

      return path
    }
  }

  /**
   * Escape a regular expression string.
   *
   * @param  {string} str
   * @return {string}
   */
  function escapeString (str) {
    return str.replace(/([.+*?=^!:${}()[\]|\/\\])/g, '\\$1')
  }

  /**
   * Escape the capturing group by escaping special characters and meaning.
   *
   * @param  {string} group
   * @return {string}
   */
  function escapeGroup (group) {
    return group.replace(/([=!:$\/()])/g, '\\$1')
  }

  /**
   * Attach the keys as a property of the regexp.
   *
   * @param  {!RegExp} re
   * @param  {Array}   keys
   * @return {!RegExp}
   */
  function attachKeys (re, keys) {
    re.keys = keys;
    return re
  }

  /**
   * Get the flags for a regexp from the options.
   *
   * @param  {Object} options
   * @return {string}
   */
  function flags (options) {
    return options.sensitive ? '' : 'i'
  }

  /**
   * Pull out keys from a regexp.
   *
   * @param  {!RegExp} path
   * @param  {!Array}  keys
   * @return {!RegExp}
   */
  function regexpToRegexp (path, keys) {
    // Use a negative lookahead to match only capturing groups.
    var groups = path.source.match(/\((?!\?)/g);

    if (groups) {
      for (var i = 0; i < groups.length; i++) {
        keys.push({
          name: i,
          prefix: null,
          delimiter: null,
          optional: false,
          repeat: false,
          partial: false,
          asterisk: false,
          pattern: null
        });
      }
    }

    return attachKeys(path, keys)
  }

  /**
   * Transform an array into a regexp.
   *
   * @param  {!Array}  path
   * @param  {Array}   keys
   * @param  {!Object} options
   * @return {!RegExp}
   */
  function arrayToRegexp (path, keys, options) {
    var parts = [];

    for (var i = 0; i < path.length; i++) {
      parts.push(pathToRegexp(path[i], keys, options).source);
    }

    var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options));

    return attachKeys(regexp, keys)
  }

  /**
   * Create a path regexp from string input.
   *
   * @param  {string}  path
   * @param  {!Array}  keys
   * @param  {!Object} options
   * @return {!RegExp}
   */
  function stringToRegexp (path, keys, options) {
    return tokensToRegExp(parse(path, options), keys, options)
  }

  /**
   * Expose a function for taking tokens and returning a RegExp.
   *
   * @param  {!Array}          tokens
   * @param  {(Array|Object)=} keys
   * @param  {Object=}         options
   * @return {!RegExp}
   */
  function tokensToRegExp (tokens, keys, options) {
    if (!isarray(keys)) {
      options = /** @type {!Object} */ (keys || options);
      keys = [];
    }

    options = options || {};

    var strict = options.strict;
    var end = options.end !== false;
    var route = '';

    // Iterate over the tokens and create our regexp string.
    for (var i = 0; i < tokens.length; i++) {
      var token = tokens[i];

      if (typeof token === 'string') {
        route += escapeString(token);
      } else {
        var prefix = escapeString(token.prefix);
        var capture = '(?:' + token.pattern + ')';

        keys.push(token);

        if (token.repeat) {
          capture += '(?:' + prefix + capture + ')*';
        }

        if (token.optional) {
          if (!token.partial) {
            capture = '(?:' + prefix + '(' + capture + '))?';
          } else {
            capture = prefix + '(' + capture + ')?';
          }
        } else {
          capture = prefix + '(' + capture + ')';
        }

        route += capture;
      }
    }

    var delimiter = escapeString(options.delimiter || '/');
    var endsWithDelimiter = route.slice(-delimiter.length) === delimiter;

    // In non-strict mode we allow a slash at the end of match. If the path to
    // match already ends with a slash, we remove it for consistency. The slash
    // is valid at the end of a path match, not in the middle. This is important
    // in non-ending mode, where "/test/" shouldn't match "/test//route".
    if (!strict) {
      route = (endsWithDelimiter ? route.slice(0, -delimiter.length) : route) + '(?:' + delimiter + '(?=$))?';
    }

    if (end) {
      route += '$';
    } else {
      // In non-ending mode, we need the capturing groups to match as much as
      // possible by using a positive lookahead to the end or next path segment.
      route += strict && endsWithDelimiter ? '' : '(?=' + delimiter + '|$)';
    }

    return attachKeys(new RegExp('^' + route, flags(options)), keys)
  }

  /**
   * Normalize the given path string, returning a regular expression.
   *
   * An empty array can be passed in for the keys, which will hold the
   * placeholder key descriptions. For example, using `/user/:id`, `keys` will
   * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.
   *
   * @param  {(string|RegExp|Array)} path
   * @param  {(Array|Object)=}       keys
   * @param  {Object=}               options
   * @return {!RegExp}
   */
  function pathToRegexp (path, keys, options) {
    if (!isarray(keys)) {
      options = /** @type {!Object} */ (keys || options);
      keys = [];
    }

    options = options || {};

    if (path instanceof RegExp) {
      return regexpToRegexp(path, /** @type {!Array} */ (keys))
    }

    if (isarray(path)) {
      return arrayToRegexp(/** @type {!Array} */ (path), /** @type {!Array} */ (keys), options)
    }

    return stringToRegexp(/** @type {string} */ (path), /** @type {!Array} */ (keys), options)
  }
  pathToRegexp_1.parse = parse_1;
  pathToRegexp_1.compile = compile_1;
  pathToRegexp_1.tokensToFunction = tokensToFunction_1;
  pathToRegexp_1.tokensToRegExp = tokensToRegExp_1;

  var patternCache = {};
  var cacheLimit = 10000;
  var cacheCount = 0;

  var compilePath = function compilePath(pattern, options) {
    var cacheKey = "" + options.end + options.strict + options.sensitive;
    var cache = patternCache[cacheKey] || (patternCache[cacheKey] = {});

    if (cache[pattern]) return cache[pattern];

    var keys = [];
    var re = pathToRegexp_1(pattern, keys, options);
    var compiledPattern = { re: re, keys: keys };

    if (cacheCount < cacheLimit) {
      cache[pattern] = compiledPattern;
      cacheCount++;
    }

    return compiledPattern;
  };

  /**
   * Public API for matching a URL pathname to a path pattern.
   */
  var matchPath = function matchPath(pathname) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var parent = arguments[2];

    if (typeof options === "string") options = { path: options };

    var _options = options,
        path = _options.path,
        _options$exact = _options.exact,
        exact = _options$exact === undefined ? false : _options$exact,
        _options$strict = _options.strict,
        strict = _options$strict === undefined ? false : _options$strict,
        _options$sensitive = _options.sensitive,
        sensitive = _options$sensitive === undefined ? false : _options$sensitive;


    if (path == null) return parent;

    var _compilePath = compilePath(path, { end: exact, strict: strict, sensitive: sensitive }),
        re = _compilePath.re,
        keys = _compilePath.keys;

    var match = re.exec(pathname);

    if (!match) return null;

    var url = match[0],
        values = match.slice(1);

    var isExact = pathname === url;

    if (exact && !isExact) return null;

    return {
      path: path, // the path pattern used to match
      url: path === "/" && url === "" ? "/" : url, // the matched portion of the URL
      isExact: isExact, // whether or not we matched exactly
      params: keys.reduce(function (memo, key, index) {
        memo[key.name] = values[index];
        return memo;
      }, {})
    };
  };

  var _extends$6 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  function _classCallCheck$6(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$6(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$6(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  var isEmptyChildren = function isEmptyChildren(children) {
    return React__default.Children.count(children) === 0;
  };

  /**
   * The public API for matching a single path and rendering.
   */

  var Route = function (_React$Component) {
    _inherits$6(Route, _React$Component);

    function Route() {
      var _temp, _this, _ret;

      _classCallCheck$6(this, Route);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$6(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.state = {
        match: _this.computeMatch(_this.props, _this.context.router)
      }, _temp), _possibleConstructorReturn$6(_this, _ret);
    }

    Route.prototype.getChildContext = function getChildContext() {
      return {
        router: _extends$6({}, this.context.router, {
          route: {
            location: this.props.location || this.context.router.route.location,
            match: this.state.match
          }
        })
      };
    };

    Route.prototype.computeMatch = function computeMatch(_ref, router) {
      var computedMatch = _ref.computedMatch,
          location = _ref.location,
          path = _ref.path,
          strict = _ref.strict,
          exact = _ref.exact,
          sensitive = _ref.sensitive;

      if (computedMatch) return computedMatch; // <Switch> already computed the match for us

      invariant_1(router, "You should not use <Route> or withRouter() outside a <Router>");

      var route = router.route;

      var pathname = (location || route.location).pathname;

      return matchPath(pathname, { path: path, strict: strict, exact: exact, sensitive: sensitive }, route.match);
    };

    Route.prototype.componentWillMount = function componentWillMount() {
      warning_1$2(!(this.props.component && this.props.render), "You should not use <Route component> and <Route render> in the same route; <Route render> will be ignored");

      warning_1$2(!(this.props.component && this.props.children && !isEmptyChildren(this.props.children)), "You should not use <Route component> and <Route children> in the same route; <Route children> will be ignored");

      warning_1$2(!(this.props.render && this.props.children && !isEmptyChildren(this.props.children)), "You should not use <Route render> and <Route children> in the same route; <Route children> will be ignored");
    };

    Route.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps, nextContext) {
      warning_1$2(!(nextProps.location && !this.props.location), '<Route> elements should not change from uncontrolled to controlled (or vice versa). You initially used no "location" prop and then provided one on a subsequent render.');

      warning_1$2(!(!nextProps.location && this.props.location), '<Route> elements should not change from controlled to uncontrolled (or vice versa). You provided a "location" prop initially but omitted it on a subsequent render.');

      this.setState({
        match: this.computeMatch(nextProps, nextContext.router)
      });
    };

    Route.prototype.render = function render() {
      var match = this.state.match;
      var _props = this.props,
          children = _props.children,
          component = _props.component,
          render = _props.render;
      var _context$router = this.context.router,
          history = _context$router.history,
          route = _context$router.route,
          staticContext = _context$router.staticContext;

      var location = this.props.location || route.location;
      var props = { match: match, location: location, history: history, staticContext: staticContext };

      if (component) return match ? React__default.createElement(component, props) : null;

      if (render) return match ? render(props) : null;

      if (typeof children === "function") return children(props);

      if (children && !isEmptyChildren(children)) return React__default.Children.only(children);

      return null;
    };

    return Route;
  }(React__default.Component);

  Route.propTypes = {
    computedMatch: propTypes.object, // private, from <Switch>
    path: propTypes.string,
    exact: propTypes.bool,
    strict: propTypes.bool,
    sensitive: propTypes.bool,
    component: propTypes.func,
    render: propTypes.func,
    children: propTypes.oneOfType([propTypes.func, propTypes.node]),
    location: propTypes.object
  };
  Route.contextTypes = {
    router: propTypes.shape({
      history: propTypes.object.isRequired,
      route: propTypes.object.isRequired,
      staticContext: propTypes.object
    })
  };
  Route.childContextTypes = {
    router: propTypes.object.isRequired
  };

  // Written in this round about way for babel-transform-imports

  var _extends$7 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  var _typeof$3 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

  function _objectWithoutProperties$1(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

  /**
   * A <Link> wrapper that knows if it's "active" or not.
   */
  var NavLink = function NavLink(_ref) {
    var to = _ref.to,
        exact = _ref.exact,
        strict = _ref.strict,
        location = _ref.location,
        activeClassName = _ref.activeClassName,
        className = _ref.className,
        activeStyle = _ref.activeStyle,
        style = _ref.style,
        getIsActive = _ref.isActive,
        ariaCurrent = _ref["aria-current"],
        rest = _objectWithoutProperties$1(_ref, ["to", "exact", "strict", "location", "activeClassName", "className", "activeStyle", "style", "isActive", "aria-current"]);

    var path = (typeof to === "undefined" ? "undefined" : _typeof$3(to)) === "object" ? to.pathname : to;

    // Regex taken from: https://github.com/pillarjs/path-to-regexp/blob/master/index.js#L202
    var escapedPath = path && path.replace(/([.+*?=^!:${}()[\]|/\\])/g, "\\$1");

    return React__default.createElement(Route, {
      path: escapedPath,
      exact: exact,
      strict: strict,
      location: location,
      children: function children(_ref2) {
        var location = _ref2.location,
            match = _ref2.match;

        var isActive = !!(getIsActive ? getIsActive(match, location) : match);

        return React__default.createElement(Link, _extends$7({
          to: to,
          className: isActive ? [className, activeClassName].filter(function (i) {
            return i;
          }).join(" ") : className,
          style: isActive ? _extends$7({}, style, activeStyle) : style,
          "aria-current": isActive && ariaCurrent || null
        }, rest));
      }
    });
  };

  NavLink.propTypes = {
    to: Link.propTypes.to,
    exact: propTypes.bool,
    strict: propTypes.bool,
    location: propTypes.object,
    activeClassName: propTypes.string,
    className: propTypes.string,
    activeStyle: propTypes.object,
    style: propTypes.object,
    isActive: propTypes.func,
    "aria-current": propTypes.oneOf(["page", "step", "location", "date", "time", "true"])
  };

  NavLink.defaultProps = {
    activeClassName: "active",
    "aria-current": "page"
  };

  function _classCallCheck$7(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$7(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$7(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for prompting the user before navigating away
   * from a screen with a component.
   */

  var Prompt = function (_React$Component) {
    _inherits$7(Prompt, _React$Component);

    function Prompt() {
      _classCallCheck$7(this, Prompt);

      return _possibleConstructorReturn$7(this, _React$Component.apply(this, arguments));
    }

    Prompt.prototype.enable = function enable(message) {
      if (this.unblock) this.unblock();

      this.unblock = this.context.router.history.block(message);
    };

    Prompt.prototype.disable = function disable() {
      if (this.unblock) {
        this.unblock();
        this.unblock = null;
      }
    };

    Prompt.prototype.componentWillMount = function componentWillMount() {
      invariant_1(this.context.router, "You should not use <Prompt> outside a <Router>");

      if (this.props.when) this.enable(this.props.message);
    };

    Prompt.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
      if (nextProps.when) {
        if (!this.props.when || this.props.message !== nextProps.message) this.enable(nextProps.message);
      } else {
        this.disable();
      }
    };

    Prompt.prototype.componentWillUnmount = function componentWillUnmount() {
      this.disable();
    };

    Prompt.prototype.render = function render() {
      return null;
    };

    return Prompt;
  }(React__default.Component);

  Prompt.propTypes = {
    when: propTypes.bool,
    message: propTypes.oneOfType([propTypes.func, propTypes.string]).isRequired
  };
  Prompt.defaultProps = {
    when: true
  };
  Prompt.contextTypes = {
    router: propTypes.shape({
      history: propTypes.shape({
        block: propTypes.func.isRequired
      }).isRequired
    }).isRequired
  };

  // Written in this round about way for babel-transform-imports

  var patternCache$1 = {};
  var cacheLimit$1 = 10000;
  var cacheCount$1 = 0;

  var compileGenerator = function compileGenerator(pattern) {
    var cacheKey = pattern;
    var cache = patternCache$1[cacheKey] || (patternCache$1[cacheKey] = {});

    if (cache[pattern]) return cache[pattern];

    var compiledGenerator = pathToRegexp_1.compile(pattern);

    if (cacheCount$1 < cacheLimit$1) {
      cache[pattern] = compiledGenerator;
      cacheCount$1++;
    }

    return compiledGenerator;
  };

  /**
   * Public API for generating a URL pathname from a pattern and parameters.
   */
  var generatePath = function generatePath() {
    var pattern = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "/";
    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    if (pattern === "/") {
      return pattern;
    }
    var generator = compileGenerator(pattern);
    return generator(params, { pretty: true });
  };

  var _extends$8 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  function _classCallCheck$8(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$8(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$8(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for updating the location programmatically
   * with a component.
   */

  var Redirect = function (_React$Component) {
    _inherits$8(Redirect, _React$Component);

    function Redirect() {
      _classCallCheck$8(this, Redirect);

      return _possibleConstructorReturn$8(this, _React$Component.apply(this, arguments));
    }

    Redirect.prototype.isStatic = function isStatic() {
      return this.context.router && this.context.router.staticContext;
    };

    Redirect.prototype.componentWillMount = function componentWillMount() {
      invariant_1(this.context.router, "You should not use <Redirect> outside a <Router>");

      if (this.isStatic()) this.perform();
    };

    Redirect.prototype.componentDidMount = function componentDidMount() {
      if (!this.isStatic()) this.perform();
    };

    Redirect.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {
      var prevTo = createLocation(prevProps.to);
      var nextTo = createLocation(this.props.to);

      if (locationsAreEqual(prevTo, nextTo)) {
        warning_1$2(false, "You tried to redirect to the same route you're currently on: " + ("\"" + nextTo.pathname + nextTo.search + "\""));
        return;
      }

      this.perform();
    };

    Redirect.prototype.computeTo = function computeTo(_ref) {
      var computedMatch = _ref.computedMatch,
          to = _ref.to;

      if (computedMatch) {
        if (typeof to === "string") {
          return generatePath(to, computedMatch.params);
        } else {
          return _extends$8({}, to, {
            pathname: generatePath(to.pathname, computedMatch.params)
          });
        }
      }

      return to;
    };

    Redirect.prototype.perform = function perform() {
      var history = this.context.router.history;
      var push = this.props.push;

      var to = this.computeTo(this.props);

      if (push) {
        history.push(to);
      } else {
        history.replace(to);
      }
    };

    Redirect.prototype.render = function render() {
      return null;
    };

    return Redirect;
  }(React__default.Component);

  Redirect.propTypes = {
    computedMatch: propTypes.object, // private, from <Switch>
    push: propTypes.bool,
    from: propTypes.string,
    to: propTypes.oneOfType([propTypes.string, propTypes.object]).isRequired
  };
  Redirect.defaultProps = {
    push: false
  };
  Redirect.contextTypes = {
    router: propTypes.shape({
      history: propTypes.shape({
        push: propTypes.func.isRequired,
        replace: propTypes.func.isRequired
      }).isRequired,
      staticContext: propTypes.object
    }).isRequired
  };

  // Written in this round about way for babel-transform-imports

  var _extends$9 = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  function _objectWithoutProperties$2(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

  function _classCallCheck$9(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$9(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$9(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  var addLeadingSlash$1 = function addLeadingSlash(path) {
    return path.charAt(0) === "/" ? path : "/" + path;
  };

  var addBasename = function addBasename(basename, location) {
    if (!basename) return location;

    return _extends$9({}, location, {
      pathname: addLeadingSlash$1(basename) + location.pathname
    });
  };

  var stripBasename$1 = function stripBasename(basename, location) {
    if (!basename) return location;

    var base = addLeadingSlash$1(basename);

    if (location.pathname.indexOf(base) !== 0) return location;

    return _extends$9({}, location, {
      pathname: location.pathname.substr(base.length)
    });
  };

  var createURL = function createURL(location) {
    return typeof location === "string" ? location : createPath(location);
  };

  var staticHandler = function staticHandler(methodName) {
    return function () {
      invariant_1(false, "You cannot %s with <StaticRouter>", methodName);
    };
  };

  var noop = function noop() {};

  /**
   * The public top-level API for a "static" <Router>, so-called because it
   * can't actually change the current location. Instead, it just records
   * location changes in a context object. Useful mainly in testing and
   * server-rendering scenarios.
   */

  var StaticRouter = function (_React$Component) {
    _inherits$9(StaticRouter, _React$Component);

    function StaticRouter() {
      var _temp, _this, _ret;

      _classCallCheck$9(this, StaticRouter);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return _ret = (_temp = (_this = _possibleConstructorReturn$9(this, _React$Component.call.apply(_React$Component, [this].concat(args))), _this), _this.createHref = function (path) {
        return addLeadingSlash$1(_this.props.basename + createURL(path));
      }, _this.handlePush = function (location) {
        var _this$props = _this.props,
            basename = _this$props.basename,
            context = _this$props.context;

        context.action = "PUSH";
        context.location = addBasename(basename, createLocation(location));
        context.url = createURL(context.location);
      }, _this.handleReplace = function (location) {
        var _this$props2 = _this.props,
            basename = _this$props2.basename,
            context = _this$props2.context;

        context.action = "REPLACE";
        context.location = addBasename(basename, createLocation(location));
        context.url = createURL(context.location);
      }, _this.handleListen = function () {
        return noop;
      }, _this.handleBlock = function () {
        return noop;
      }, _temp), _possibleConstructorReturn$9(_this, _ret);
    }

    StaticRouter.prototype.getChildContext = function getChildContext() {
      return {
        router: {
          staticContext: this.props.context
        }
      };
    };

    StaticRouter.prototype.componentWillMount = function componentWillMount() {
      warning_1$2(!this.props.history, "<StaticRouter> ignores the history prop. To use a custom history, " + "use `import { Router }` instead of `import { StaticRouter as Router }`.");
    };

    StaticRouter.prototype.render = function render() {
      var _props = this.props,
          basename = _props.basename,
          context = _props.context,
          location = _props.location,
          props = _objectWithoutProperties$2(_props, ["basename", "context", "location"]);

      var history = {
        createHref: this.createHref,
        action: "POP",
        location: stripBasename$1(basename, createLocation(location)),
        push: this.handlePush,
        replace: this.handleReplace,
        go: staticHandler("go"),
        goBack: staticHandler("goBack"),
        goForward: staticHandler("goForward"),
        listen: this.handleListen,
        block: this.handleBlock
      };

      return React__default.createElement(Router, _extends$9({}, props, { history: history }));
    };

    return StaticRouter;
  }(React__default.Component);

  StaticRouter.propTypes = {
    basename: propTypes.string,
    context: propTypes.object.isRequired,
    location: propTypes.oneOfType([propTypes.string, propTypes.object])
  };
  StaticRouter.defaultProps = {
    basename: "",
    location: "/"
  };
  StaticRouter.childContextTypes = {
    router: propTypes.object.isRequired
  };

  // Written in this round about way for babel-transform-imports

  function _classCallCheck$a(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _possibleConstructorReturn$a(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

  function _inherits$a(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

  /**
   * The public API for rendering the first <Route> that matches.
   */

  var Switch = function (_React$Component) {
    _inherits$a(Switch, _React$Component);

    function Switch() {
      _classCallCheck$a(this, Switch);

      return _possibleConstructorReturn$a(this, _React$Component.apply(this, arguments));
    }

    Switch.prototype.componentWillMount = function componentWillMount() {
      invariant_1(this.context.router, "You should not use <Switch> outside a <Router>");
    };

    Switch.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
      warning_1$2(!(nextProps.location && !this.props.location), '<Switch> elements should not change from uncontrolled to controlled (or vice versa). You initially used no "location" prop and then provided one on a subsequent render.');

      warning_1$2(!(!nextProps.location && this.props.location), '<Switch> elements should not change from controlled to uncontrolled (or vice versa). You provided a "location" prop initially but omitted it on a subsequent render.');
    };

    Switch.prototype.render = function render() {
      var route = this.context.router.route;
      var children = this.props.children;

      var location = this.props.location || route.location;

      var match = void 0,
          child = void 0;
      React__default.Children.forEach(children, function (element) {
        if (match == null && React__default.isValidElement(element)) {
          var _element$props = element.props,
              pathProp = _element$props.path,
              exact = _element$props.exact,
              strict = _element$props.strict,
              sensitive = _element$props.sensitive,
              from = _element$props.from;

          var path = pathProp || from;

          child = element;
          match = matchPath(location.pathname, { path: path, exact: exact, strict: strict, sensitive: sensitive }, route.match);
        }
      });

      return match ? React__default.cloneElement(child, { location: location, computedMatch: match }) : null;
    };

    return Switch;
  }(React__default.Component);

  Switch.contextTypes = {
    router: propTypes.shape({
      route: propTypes.object.isRequired
    }).isRequired
  };
  Switch.propTypes = {
    children: propTypes.node,
    location: propTypes.object
  };

  // Written in this round about way for babel-transform-imports

  // Written in this round about way for babel-transform-imports

  // Written in this round about way for babel-transform-imports

  /**
   * Copyright 2015, Yahoo! Inc.
   * Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
   */
  var REACT_STATICS = {
      childContextTypes: true,
      contextTypes: true,
      defaultProps: true,
      displayName: true,
      getDefaultProps: true,
      getDerivedStateFromProps: true,
      mixins: true,
      propTypes: true,
      type: true
  };

  var KNOWN_STATICS = {
      name: true,
      length: true,
      prototype: true,
      caller: true,
      callee: true,
      arguments: true,
      arity: true
  };

  var defineProperty$1 = Object.defineProperty;
  var getOwnPropertyNames = Object.getOwnPropertyNames;
  var getOwnPropertySymbols$1 = Object.getOwnPropertySymbols;
  var getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;
  var getPrototypeOf$1 = Object.getPrototypeOf;
  var objectPrototype = getPrototypeOf$1 && getPrototypeOf$1(Object);

  function hoistNonReactStatics(targetComponent, sourceComponent, blacklist) {
      if (typeof sourceComponent !== 'string') { // don't hoist over string (html) components

          if (objectPrototype) {
              var inheritedComponent = getPrototypeOf$1(sourceComponent);
              if (inheritedComponent && inheritedComponent !== objectPrototype) {
                  hoistNonReactStatics(targetComponent, inheritedComponent, blacklist);
              }
          }

          var keys = getOwnPropertyNames(sourceComponent);

          if (getOwnPropertySymbols$1) {
              keys = keys.concat(getOwnPropertySymbols$1(sourceComponent));
          }

          for (var i = 0; i < keys.length; ++i) {
              var key = keys[i];
              if (!REACT_STATICS[key] && !KNOWN_STATICS[key] && (!blacklist || !blacklist[key])) {
                  var descriptor = getOwnPropertyDescriptor(sourceComponent, key);
                  try { // Avoid failures from read-only properties
                      defineProperty$1(targetComponent, key, descriptor);
                  } catch (e) {}
              }
          }

          return targetComponent;
      }

      return targetComponent;
  }

  var hoistNonReactStatics_cjs = hoistNonReactStatics;

  var _extends$a = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

  function _objectWithoutProperties$3(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

  /**
   * A public higher-order component to access the imperative API
   */
  var withRouter = function withRouter(Component) {
    var C = function C(props) {
      var wrappedComponentRef = props.wrappedComponentRef,
          remainingProps = _objectWithoutProperties$3(props, ["wrappedComponentRef"]);

      return React__default.createElement(Route, {
        children: function children(routeComponentProps) {
          return React__default.createElement(Component, _extends$a({}, remainingProps, routeComponentProps, {
            ref: wrappedComponentRef
          }));
        }
      });
    };

    C.displayName = "withRouter(" + (Component.displayName || Component.name) + ")";
    C.WrappedComponent = Component;
    C.propTypes = {
      wrappedComponentRef: propTypes.func
    };

    return hoistNonReactStatics_cjs(C, Component);
  };

  // Written in this round about way for babel-transform-imports

  function _inheritsLoose(subClass, superClass) {
    subClass.prototype = Object.create(superClass.prototype);
    subClass.prototype.constructor = subClass;
    subClass.__proto__ = superClass;
  }

  var ReactReduxContext = React__default.createContext(null);

  var Provider =
  /*#__PURE__*/
  function (_Component) {
    _inheritsLoose(Provider, _Component);

    function Provider(props) {
      var _this;

      _this = _Component.call(this, props) || this;
      var store = props.store;
      _this.state = {
        storeState: store.getState(),
        store: store
      };
      return _this;
    }

    var _proto = Provider.prototype;

    _proto.componentDidMount = function componentDidMount() {
      this._isMounted = true;
      this.subscribe();
    };

    _proto.componentWillUnmount = function componentWillUnmount() {
      if (this.unsubscribe) this.unsubscribe();
      this._isMounted = false;
    };

    _proto.componentDidUpdate = function componentDidUpdate(prevProps) {
      if (this.props.store !== prevProps.store) {
        if (this.unsubscribe) this.unsubscribe();
        this.subscribe();
      }
    };

    _proto.subscribe = function subscribe() {
      var _this2 = this;

      var store = this.props.store;
      this.unsubscribe = store.subscribe(function () {
        var newStoreState = store.getState();

        if (!_this2._isMounted) {
          return;
        }

        _this2.setState(function (providerState) {
          // If the value is the same, skip the unnecessary state update.
          if (providerState.storeState === newStoreState) {
            return null;
          }

          return {
            storeState: newStoreState
          };
        });
      }); // Actions might have been dispatched between render and mount - handle those

      var postMountStoreState = store.getState();

      if (postMountStoreState !== this.state.storeState) {
        this.setState({
          storeState: postMountStoreState
        });
      }
    };

    _proto.render = function render() {
      var Context = this.props.context || ReactReduxContext;
      return React__default.createElement(Context.Provider, {
        value: this.state
      }, this.props.children);
    };

    return Provider;
  }(React.Component);

  Provider.propTypes = {
    store: propTypes.shape({
      subscribe: propTypes.func.isRequired,
      dispatch: propTypes.func.isRequired,
      getState: propTypes.func.isRequired
    }),
    context: propTypes.object,
    children: propTypes.any
  };

  function _assertThisInitialized$1(self) {
    if (self === void 0) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return self;
  }

  function _extends$b() {
    _extends$b = Object.assign || function (target) {
      for (var i = 1; i < arguments.length; i++) {
        var source = arguments[i];

        for (var key in source) {
          if (Object.prototype.hasOwnProperty.call(source, key)) {
            target[key] = source[key];
          }
        }
      }

      return target;
    };

    return _extends$b.apply(this, arguments);
  }

  function _objectWithoutPropertiesLoose(source, excluded) {
    if (source == null) return {};
    var target = {};
    var sourceKeys = Object.keys(source);
    var key, i;

    for (i = 0; i < sourceKeys.length; i++) {
      key = sourceKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      target[key] = source[key];
    }

    return target;
  }

  var reactIs_production_min = createCommonjsModule(function (module, exports) {
  Object.defineProperty(exports,"__esModule",{value:!0});
  var b="function"===typeof Symbol&&Symbol.for,c=b?Symbol.for("react.element"):60103,d=b?Symbol.for("react.portal"):60106,e=b?Symbol.for("react.fragment"):60107,f=b?Symbol.for("react.strict_mode"):60108,g=b?Symbol.for("react.profiler"):60114,h=b?Symbol.for("react.provider"):60109,k=b?Symbol.for("react.context"):60110,l=b?Symbol.for("react.async_mode"):60111,m=b?Symbol.for("react.concurrent_mode"):60111,n=b?Symbol.for("react.forward_ref"):60112,p=b?Symbol.for("react.suspense"):60113,q=b?Symbol.for("react.memo"):
  60115,r=b?Symbol.for("react.lazy"):60116;function t(a){if("object"===typeof a&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type,a){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof,a){case k:case n:case h:return a;default:return u}}case r:case q:case d:return u}}}function v(a){return t(a)===m}exports.typeOf=t;exports.AsyncMode=l;exports.ConcurrentMode=m;exports.ContextConsumer=k;exports.ContextProvider=h;exports.Element=c;exports.ForwardRef=n;
  exports.Fragment=e;exports.Lazy=r;exports.Memo=q;exports.Portal=d;exports.Profiler=g;exports.StrictMode=f;exports.Suspense=p;exports.isValidElementType=function(a){return "string"===typeof a||"function"===typeof a||a===e||a===m||a===g||a===f||a===p||"object"===typeof a&&null!==a&&(a.$$typeof===r||a.$$typeof===q||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n)};exports.isAsyncMode=function(a){return v(a)||t(a)===l};exports.isConcurrentMode=v;exports.isContextConsumer=function(a){return t(a)===k};
  exports.isContextProvider=function(a){return t(a)===h};exports.isElement=function(a){return "object"===typeof a&&null!==a&&a.$$typeof===c};exports.isForwardRef=function(a){return t(a)===n};exports.isFragment=function(a){return t(a)===e};exports.isLazy=function(a){return t(a)===r};exports.isMemo=function(a){return t(a)===q};exports.isPortal=function(a){return t(a)===d};exports.isProfiler=function(a){return t(a)===g};exports.isStrictMode=function(a){return t(a)===f};
  exports.isSuspense=function(a){return t(a)===p};
  });

  unwrapExports(reactIs_production_min);
  var reactIs_production_min_1 = reactIs_production_min.typeOf;
  var reactIs_production_min_2 = reactIs_production_min.AsyncMode;
  var reactIs_production_min_3 = reactIs_production_min.ConcurrentMode;
  var reactIs_production_min_4 = reactIs_production_min.ContextConsumer;
  var reactIs_production_min_5 = reactIs_production_min.ContextProvider;
  var reactIs_production_min_6 = reactIs_production_min.Element;
  var reactIs_production_min_7 = reactIs_production_min.ForwardRef;
  var reactIs_production_min_8 = reactIs_production_min.Fragment;
  var reactIs_production_min_9 = reactIs_production_min.Lazy;
  var reactIs_production_min_10 = reactIs_production_min.Memo;
  var reactIs_production_min_11 = reactIs_production_min.Portal;
  var reactIs_production_min_12 = reactIs_production_min.Profiler;
  var reactIs_production_min_13 = reactIs_production_min.StrictMode;
  var reactIs_production_min_14 = reactIs_production_min.Suspense;
  var reactIs_production_min_15 = reactIs_production_min.isValidElementType;
  var reactIs_production_min_16 = reactIs_production_min.isAsyncMode;
  var reactIs_production_min_17 = reactIs_production_min.isConcurrentMode;
  var reactIs_production_min_18 = reactIs_production_min.isContextConsumer;
  var reactIs_production_min_19 = reactIs_production_min.isContextProvider;
  var reactIs_production_min_20 = reactIs_production_min.isElement;
  var reactIs_production_min_21 = reactIs_production_min.isForwardRef;
  var reactIs_production_min_22 = reactIs_production_min.isFragment;
  var reactIs_production_min_23 = reactIs_production_min.isLazy;
  var reactIs_production_min_24 = reactIs_production_min.isMemo;
  var reactIs_production_min_25 = reactIs_production_min.isPortal;
  var reactIs_production_min_26 = reactIs_production_min.isProfiler;
  var reactIs_production_min_27 = reactIs_production_min.isStrictMode;
  var reactIs_production_min_28 = reactIs_production_min.isSuspense;

  var reactIs_development = createCommonjsModule(function (module, exports) {



  if (process.env.NODE_ENV !== "production") {
    (function() {

  Object.defineProperty(exports, '__esModule', { value: true });

  // The Symbol used to tag the ReactElement-like types. If there is no native Symbol
  // nor polyfill, then a plain number is used for performance.
  var hasSymbol = typeof Symbol === 'function' && Symbol.for;

  var REACT_ELEMENT_TYPE = hasSymbol ? Symbol.for('react.element') : 0xeac7;
  var REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;
  var REACT_FRAGMENT_TYPE = hasSymbol ? Symbol.for('react.fragment') : 0xeacb;
  var REACT_STRICT_MODE_TYPE = hasSymbol ? Symbol.for('react.strict_mode') : 0xeacc;
  var REACT_PROFILER_TYPE = hasSymbol ? Symbol.for('react.profiler') : 0xead2;
  var REACT_PROVIDER_TYPE = hasSymbol ? Symbol.for('react.provider') : 0xeacd;
  var REACT_CONTEXT_TYPE = hasSymbol ? Symbol.for('react.context') : 0xeace;
  var REACT_ASYNC_MODE_TYPE = hasSymbol ? Symbol.for('react.async_mode') : 0xeacf;
  var REACT_CONCURRENT_MODE_TYPE = hasSymbol ? Symbol.for('react.concurrent_mode') : 0xeacf;
  var REACT_FORWARD_REF_TYPE = hasSymbol ? Symbol.for('react.forward_ref') : 0xead0;
  var REACT_SUSPENSE_TYPE = hasSymbol ? Symbol.for('react.suspense') : 0xead1;
  var REACT_MEMO_TYPE = hasSymbol ? Symbol.for('react.memo') : 0xead3;
  var REACT_LAZY_TYPE = hasSymbol ? Symbol.for('react.lazy') : 0xead4;

  function isValidElementType(type) {
    return typeof type === 'string' || typeof type === 'function' ||
    // Note: its typeof might be other than 'symbol' or 'number' if it's a polyfill.
    type === REACT_FRAGMENT_TYPE || type === REACT_CONCURRENT_MODE_TYPE || type === REACT_PROFILER_TYPE || type === REACT_STRICT_MODE_TYPE || type === REACT_SUSPENSE_TYPE || typeof type === 'object' && type !== null && (type.$$typeof === REACT_LAZY_TYPE || type.$$typeof === REACT_MEMO_TYPE || type.$$typeof === REACT_PROVIDER_TYPE || type.$$typeof === REACT_CONTEXT_TYPE || type.$$typeof === REACT_FORWARD_REF_TYPE);
  }

  /**
   * Forked from fbjs/warning:
   * https://github.com/facebook/fbjs/blob/e66ba20ad5be433eb54423f2b097d829324d9de6/packages/fbjs/src/__forks__/warning.js
   *
   * Only change is we use console.warn instead of console.error,
   * and do nothing when 'console' is not supported.
   * This really simplifies the code.
   * ---
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */

  var lowPriorityWarning = function () {};

  {
    var printWarning = function (format) {
      for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      var argIndex = 0;
      var message = 'Warning: ' + format.replace(/%s/g, function () {
        return args[argIndex++];
      });
      if (typeof console !== 'undefined') {
        console.warn(message);
      }
      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };

    lowPriorityWarning = function (condition, format) {
      if (format === undefined) {
        throw new Error('`lowPriorityWarning(condition, format, ...args)` requires a warning ' + 'message argument');
      }
      if (!condition) {
        for (var _len2 = arguments.length, args = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
          args[_key2 - 2] = arguments[_key2];
        }

        printWarning.apply(undefined, [format].concat(args));
      }
    };
  }

  var lowPriorityWarning$1 = lowPriorityWarning;

  function typeOf(object) {
    if (typeof object === 'object' && object !== null) {
      var $$typeof = object.$$typeof;
      switch ($$typeof) {
        case REACT_ELEMENT_TYPE:
          var type = object.type;

          switch (type) {
            case REACT_ASYNC_MODE_TYPE:
            case REACT_CONCURRENT_MODE_TYPE:
            case REACT_FRAGMENT_TYPE:
            case REACT_PROFILER_TYPE:
            case REACT_STRICT_MODE_TYPE:
            case REACT_SUSPENSE_TYPE:
              return type;
            default:
              var $$typeofType = type && type.$$typeof;

              switch ($$typeofType) {
                case REACT_CONTEXT_TYPE:
                case REACT_FORWARD_REF_TYPE:
                case REACT_PROVIDER_TYPE:
                  return $$typeofType;
                default:
                  return $$typeof;
              }
          }
        case REACT_LAZY_TYPE:
        case REACT_MEMO_TYPE:
        case REACT_PORTAL_TYPE:
          return $$typeof;
      }
    }

    return undefined;
  }

  // AsyncMode is deprecated along with isAsyncMode
  var AsyncMode = REACT_ASYNC_MODE_TYPE;
  var ConcurrentMode = REACT_CONCURRENT_MODE_TYPE;
  var ContextConsumer = REACT_CONTEXT_TYPE;
  var ContextProvider = REACT_PROVIDER_TYPE;
  var Element = REACT_ELEMENT_TYPE;
  var ForwardRef = REACT_FORWARD_REF_TYPE;
  var Fragment = REACT_FRAGMENT_TYPE;
  var Lazy = REACT_LAZY_TYPE;
  var Memo = REACT_MEMO_TYPE;
  var Portal = REACT_PORTAL_TYPE;
  var Profiler = REACT_PROFILER_TYPE;
  var StrictMode = REACT_STRICT_MODE_TYPE;
  var Suspense = REACT_SUSPENSE_TYPE;

  var hasWarnedAboutDeprecatedIsAsyncMode = false;

  // AsyncMode should be deprecated
  function isAsyncMode(object) {
    {
      if (!hasWarnedAboutDeprecatedIsAsyncMode) {
        hasWarnedAboutDeprecatedIsAsyncMode = true;
        lowPriorityWarning$1(false, 'The ReactIs.isAsyncMode() alias has been deprecated, ' + 'and will be removed in React 17+. Update your code to use ' + 'ReactIs.isConcurrentMode() instead. It has the exact same API.');
      }
    }
    return isConcurrentMode(object) || typeOf(object) === REACT_ASYNC_MODE_TYPE;
  }
  function isConcurrentMode(object) {
    return typeOf(object) === REACT_CONCURRENT_MODE_TYPE;
  }
  function isContextConsumer(object) {
    return typeOf(object) === REACT_CONTEXT_TYPE;
  }
  function isContextProvider(object) {
    return typeOf(object) === REACT_PROVIDER_TYPE;
  }
  function isElement(object) {
    return typeof object === 'object' && object !== null && object.$$typeof === REACT_ELEMENT_TYPE;
  }
  function isForwardRef(object) {
    return typeOf(object) === REACT_FORWARD_REF_TYPE;
  }
  function isFragment(object) {
    return typeOf(object) === REACT_FRAGMENT_TYPE;
  }
  function isLazy(object) {
    return typeOf(object) === REACT_LAZY_TYPE;
  }
  function isMemo(object) {
    return typeOf(object) === REACT_MEMO_TYPE;
  }
  function isPortal(object) {
    return typeOf(object) === REACT_PORTAL_TYPE;
  }
  function isProfiler(object) {
    return typeOf(object) === REACT_PROFILER_TYPE;
  }
  function isStrictMode(object) {
    return typeOf(object) === REACT_STRICT_MODE_TYPE;
  }
  function isSuspense(object) {
    return typeOf(object) === REACT_SUSPENSE_TYPE;
  }

  exports.typeOf = typeOf;
  exports.AsyncMode = AsyncMode;
  exports.ConcurrentMode = ConcurrentMode;
  exports.ContextConsumer = ContextConsumer;
  exports.ContextProvider = ContextProvider;
  exports.Element = Element;
  exports.ForwardRef = ForwardRef;
  exports.Fragment = Fragment;
  exports.Lazy = Lazy;
  exports.Memo = Memo;
  exports.Portal = Portal;
  exports.Profiler = Profiler;
  exports.StrictMode = StrictMode;
  exports.Suspense = Suspense;
  exports.isValidElementType = isValidElementType;
  exports.isAsyncMode = isAsyncMode;
  exports.isConcurrentMode = isConcurrentMode;
  exports.isContextConsumer = isContextConsumer;
  exports.isContextProvider = isContextProvider;
  exports.isElement = isElement;
  exports.isForwardRef = isForwardRef;
  exports.isFragment = isFragment;
  exports.isLazy = isLazy;
  exports.isMemo = isMemo;
  exports.isPortal = isPortal;
  exports.isProfiler = isProfiler;
  exports.isStrictMode = isStrictMode;
  exports.isSuspense = isSuspense;
    })();
  }
  });

  unwrapExports(reactIs_development);
  var reactIs_development_1 = reactIs_development.typeOf;
  var reactIs_development_2 = reactIs_development.AsyncMode;
  var reactIs_development_3 = reactIs_development.ConcurrentMode;
  var reactIs_development_4 = reactIs_development.ContextConsumer;
  var reactIs_development_5 = reactIs_development.ContextProvider;
  var reactIs_development_6 = reactIs_development.Element;
  var reactIs_development_7 = reactIs_development.ForwardRef;
  var reactIs_development_8 = reactIs_development.Fragment;
  var reactIs_development_9 = reactIs_development.Lazy;
  var reactIs_development_10 = reactIs_development.Memo;
  var reactIs_development_11 = reactIs_development.Portal;
  var reactIs_development_12 = reactIs_development.Profiler;
  var reactIs_development_13 = reactIs_development.StrictMode;
  var reactIs_development_14 = reactIs_development.Suspense;
  var reactIs_development_15 = reactIs_development.isValidElementType;
  var reactIs_development_16 = reactIs_development.isAsyncMode;
  var reactIs_development_17 = reactIs_development.isConcurrentMode;
  var reactIs_development_18 = reactIs_development.isContextConsumer;
  var reactIs_development_19 = reactIs_development.isContextProvider;
  var reactIs_development_20 = reactIs_development.isElement;
  var reactIs_development_21 = reactIs_development.isForwardRef;
  var reactIs_development_22 = reactIs_development.isFragment;
  var reactIs_development_23 = reactIs_development.isLazy;
  var reactIs_development_24 = reactIs_development.isMemo;
  var reactIs_development_25 = reactIs_development.isPortal;
  var reactIs_development_26 = reactIs_development.isProfiler;
  var reactIs_development_27 = reactIs_development.isStrictMode;
  var reactIs_development_28 = reactIs_development.isSuspense;

  var reactIs = createCommonjsModule(function (module) {

  if (process.env.NODE_ENV === 'production') {
    module.exports = reactIs_production_min;
  } else {
    module.exports = reactIs_development;
  }
  });
  var reactIs_1 = reactIs.isValidElementType;

  /**
   * Copyright 2015, Yahoo! Inc.
   * Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
   */

  var REACT_STATICS$1 = {
      childContextTypes: true,
      contextType: true,
      contextTypes: true,
      defaultProps: true,
      displayName: true,
      getDefaultProps: true,
      getDerivedStateFromError: true,
      getDerivedStateFromProps: true,
      mixins: true,
      propTypes: true,
      type: true
  };

  var KNOWN_STATICS$1 = {
      name: true,
      length: true,
      prototype: true,
      caller: true,
      callee: true,
      arguments: true,
      arity: true
  };

  var FORWARD_REF_STATICS = {
      '$$typeof': true,
      render: true,
      defaultProps: true,
      displayName: true,
      propTypes: true
  };

  var TYPE_STATICS = {};
  TYPE_STATICS[reactIs.ForwardRef] = FORWARD_REF_STATICS;

  var defineProperty$2 = Object.defineProperty;
  var getOwnPropertyNames$1 = Object.getOwnPropertyNames;
  var getOwnPropertySymbols$2 = Object.getOwnPropertySymbols;
  var getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;
  var getPrototypeOf$2 = Object.getPrototypeOf;
  var objectPrototype$1 = Object.prototype;

  function hoistNonReactStatics$1(targetComponent, sourceComponent, blacklist) {
      if (typeof sourceComponent !== 'string') {
          // don't hoist over string (html) components

          if (objectPrototype$1) {
              var inheritedComponent = getPrototypeOf$2(sourceComponent);
              if (inheritedComponent && inheritedComponent !== objectPrototype$1) {
                  hoistNonReactStatics$1(targetComponent, inheritedComponent, blacklist);
              }
          }

          var keys = getOwnPropertyNames$1(sourceComponent);

          if (getOwnPropertySymbols$2) {
              keys = keys.concat(getOwnPropertySymbols$2(sourceComponent));
          }

          var targetStatics = TYPE_STATICS[targetComponent['$$typeof']] || REACT_STATICS$1;
          var sourceStatics = TYPE_STATICS[sourceComponent['$$typeof']] || REACT_STATICS$1;

          for (var i = 0; i < keys.length; ++i) {
              var key = keys[i];
              if (!KNOWN_STATICS$1[key] && !(blacklist && blacklist[key]) && !(sourceStatics && sourceStatics[key]) && !(targetStatics && targetStatics[key])) {
                  var descriptor = getOwnPropertyDescriptor$1(sourceComponent, key);
                  try {
                      // Avoid failures from read-only properties
                      defineProperty$2(targetComponent, key, descriptor);
                  } catch (e) {}
              }
          }

          return targetComponent;
      }

      return targetComponent;
  }

  var hoistNonReactStatics_cjs$1 = hoistNonReactStatics$1;

  function connectAdvanced(
  /*
    selectorFactory is a func that is responsible for returning the selector function used to
    compute new props from state, props, and dispatch. For example:
       export default connectAdvanced((dispatch, options) => (state, props) => ({
        thing: state.things[props.thingId],
        saveThing: fields => dispatch(actionCreators.saveThing(props.thingId, fields)),
      }))(YourComponent)
     Access to dispatch is provided to the factory so selectorFactories can bind actionCreators
    outside of their selector as an optimization. Options passed to connectAdvanced are passed to
    the selectorFactory, along with displayName and WrappedComponent, as the second argument.
     Note that selectorFactory is responsible for all caching/memoization of inbound and outbound
    props. Do not use connectAdvanced directly without memoizing results between calls to your
    selector, otherwise the Connect component will re-render on every state or props change.
  */
  selectorFactory, // options object:
  _ref) {
    if (_ref === void 0) {
      _ref = {};
    }

    var _ref2 = _ref,
        _ref2$getDisplayName = _ref2.getDisplayName,
        getDisplayName = _ref2$getDisplayName === void 0 ? function (name) {
      return "ConnectAdvanced(" + name + ")";
    } : _ref2$getDisplayName,
        _ref2$methodName = _ref2.methodName,
        methodName = _ref2$methodName === void 0 ? 'connectAdvanced' : _ref2$methodName,
        _ref2$renderCountProp = _ref2.renderCountProp,
        renderCountProp = _ref2$renderCountProp === void 0 ? undefined : _ref2$renderCountProp,
        _ref2$shouldHandleSta = _ref2.shouldHandleStateChanges,
        shouldHandleStateChanges = _ref2$shouldHandleSta === void 0 ? true : _ref2$shouldHandleSta,
        _ref2$storeKey = _ref2.storeKey,
        storeKey = _ref2$storeKey === void 0 ? 'store' : _ref2$storeKey,
        _ref2$withRef = _ref2.withRef,
        withRef = _ref2$withRef === void 0 ? false : _ref2$withRef,
        _ref2$forwardRef = _ref2.forwardRef,
        forwardRef = _ref2$forwardRef === void 0 ? false : _ref2$forwardRef,
        _ref2$context = _ref2.context,
        context = _ref2$context === void 0 ? ReactReduxContext : _ref2$context,
        connectOptions = _objectWithoutPropertiesLoose(_ref2, ["getDisplayName", "methodName", "renderCountProp", "shouldHandleStateChanges", "storeKey", "withRef", "forwardRef", "context"]);

    invariant_1(renderCountProp === undefined, "renderCountProp is removed. render counting is built into the latest React dev tools profiling extension");
    invariant_1(!withRef, 'withRef is removed. To access the wrapped instance, use a ref on the connected component');
    var customStoreWarningMessage = 'To use a custom Redux store for specific components,  create a custom React context with ' + "React.createContext(), and pass the context object to React-Redux's Provider and specific components" + ' like:  <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. ' + 'You may also pass a {context : MyContext} option to connect';
    invariant_1(storeKey === 'store', 'storeKey has been removed and does not do anything. ' + customStoreWarningMessage);
    var Context = context;
    return function wrapWithConnect(WrappedComponent) {
      if (process.env.NODE_ENV !== 'production') {
        invariant_1(reactIs_1(WrappedComponent), "You must pass a component to the function returned by " + (methodName + ". Instead received " + JSON.stringify(WrappedComponent)));
      }

      var wrappedComponentName = WrappedComponent.displayName || WrappedComponent.name || 'Component';
      var displayName = getDisplayName(wrappedComponentName);

      var selectorFactoryOptions = _extends$b({}, connectOptions, {
        getDisplayName: getDisplayName,
        methodName: methodName,
        renderCountProp: renderCountProp,
        shouldHandleStateChanges: shouldHandleStateChanges,
        storeKey: storeKey,
        displayName: displayName,
        wrappedComponentName: wrappedComponentName,
        WrappedComponent: WrappedComponent
      });

      var pure = connectOptions.pure;
      var OuterBaseComponent = React.Component;
      var FinalWrappedComponent = WrappedComponent;

      if (pure) {
        OuterBaseComponent = React.PureComponent;
      }

      function makeDerivedPropsSelector() {
        var lastProps;
        var lastState;
        var lastDerivedProps;
        var lastStore;
        var sourceSelector;
        return function selectDerivedProps(state, props, store) {
          if (pure && lastProps === props && lastState === state) {
            return lastDerivedProps;
          }

          if (store !== lastStore) {
            lastStore = store;
            sourceSelector = selectorFactory(store.dispatch, selectorFactoryOptions);
          }

          lastProps = props;
          lastState = state;
          var nextProps = sourceSelector(state, props);

          if (lastDerivedProps === nextProps) {
            return lastDerivedProps;
          }

          lastDerivedProps = nextProps;
          return lastDerivedProps;
        };
      }

      function makeChildElementSelector() {
        var lastChildProps, lastForwardRef, lastChildElement;
        return function selectChildElement(childProps, forwardRef) {
          if (childProps !== lastChildProps || forwardRef !== lastForwardRef) {
            lastChildProps = childProps;
            lastForwardRef = forwardRef;
            lastChildElement = React__default.createElement(FinalWrappedComponent, _extends$b({}, childProps, {
              ref: forwardRef
            }));
          }

          return lastChildElement;
        };
      }

      var Connect =
      /*#__PURE__*/
      function (_OuterBaseComponent) {
        _inheritsLoose(Connect, _OuterBaseComponent);

        function Connect(props) {
          var _this;

          _this = _OuterBaseComponent.call(this, props) || this;
          invariant_1(forwardRef ? !props.wrapperProps[storeKey] : !props[storeKey], 'Passing redux store in props has been removed and does not do anything. ' + customStoreWarningMessage);
          _this.selectDerivedProps = makeDerivedPropsSelector();
          _this.selectChildElement = makeChildElementSelector();
          _this.renderWrappedComponent = _this.renderWrappedComponent.bind(_assertThisInitialized$1(_assertThisInitialized$1(_this)));
          return _this;
        }

        var _proto = Connect.prototype;

        _proto.renderWrappedComponent = function renderWrappedComponent(value) {
          invariant_1(value, "Could not find \"store\" in the context of " + ("\"" + displayName + "\". Either wrap the root component in a <Provider>, ") + "or pass a custom React context provider to <Provider> and the corresponding " + ("React context consumer to " + displayName + " in connect options."));
          var storeState = value.storeState,
              store = value.store;
          var wrapperProps = this.props;
          var forwardedRef;

          if (forwardRef) {
            wrapperProps = this.props.wrapperProps;
            forwardedRef = this.props.forwardedRef;
          }

          var derivedProps = this.selectDerivedProps(storeState, wrapperProps, store);
          return this.selectChildElement(derivedProps, forwardedRef);
        };

        _proto.render = function render() {
          var ContextToUse = this.props.context || Context;
          return React__default.createElement(ContextToUse.Consumer, null, this.renderWrappedComponent);
        };

        return Connect;
      }(OuterBaseComponent);

      Connect.WrappedComponent = WrappedComponent;
      Connect.displayName = displayName;

      if (forwardRef) {
        var forwarded = React__default.forwardRef(function forwardConnectRef(props, ref) {
          return React__default.createElement(Connect, {
            wrapperProps: props,
            forwardedRef: ref
          });
        });
        forwarded.displayName = displayName;
        forwarded.WrappedComponent = WrappedComponent;
        return hoistNonReactStatics_cjs$1(forwarded, WrappedComponent);
      }

      return hoistNonReactStatics_cjs$1(Connect, WrappedComponent);
    };
  }

  var hasOwn = Object.prototype.hasOwnProperty;

  function is(x, y) {
    if (x === y) {
      return x !== 0 || y !== 0 || 1 / x === 1 / y;
    } else {
      return x !== x && y !== y;
    }
  }

  function shallowEqual(objA, objB) {
    if (is(objA, objB)) return true;

    if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {
      return false;
    }

    var keysA = Object.keys(objA);
    var keysB = Object.keys(objB);
    if (keysA.length !== keysB.length) return false;

    for (var i = 0; i < keysA.length; i++) {
      if (!hasOwn.call(objB, keysA[i]) || !is(objA[keysA[i]], objB[keysA[i]])) {
        return false;
      }
    }

    return true;
  }

  function symbolObservablePonyfill(root) {
  	var result;
  	var Symbol = root.Symbol;

  	if (typeof Symbol === 'function') {
  		if (Symbol.observable) {
  			result = Symbol.observable;
  		} else {
  			result = Symbol('observable');
  			Symbol.observable = result;
  		}
  	} else {
  		result = '@@observable';
  	}

  	return result;
  }

  /* global window */

  var root;

  if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof global !== 'undefined') {
    root = global;
  } else if (typeof module !== 'undefined') {
    root = module;
  } else {
    root = Function('return this')();
  }

  var result = symbolObservablePonyfill(root);

  /**
   * These are private action types reserved by Redux.
   * For any unknown actions, you must return the current state.
   * If the current state is undefined, you must return the initial state.
   * Do not reference these action types directly in your code.
   */
  var randomString = function randomString() {
    return Math.random().toString(36).substring(7).split('').join('.');
  };

  var ActionTypes = {
    INIT: "@@redux/INIT" + randomString(),
    REPLACE: "@@redux/REPLACE" + randomString(),
    PROBE_UNKNOWN_ACTION: function PROBE_UNKNOWN_ACTION() {
      return "@@redux/PROBE_UNKNOWN_ACTION" + randomString();
    }
  };

  /**
   * @param {any} obj The object to inspect.
   * @returns {boolean} True if the argument appears to be a plain object.
   */
  function isPlainObject(obj) {
    if (typeof obj !== 'object' || obj === null) return false;
    var proto = obj;

    while (Object.getPrototypeOf(proto) !== null) {
      proto = Object.getPrototypeOf(proto);
    }

    return Object.getPrototypeOf(obj) === proto;
  }

  /**
   * Creates a Redux store that holds the state tree.
   * The only way to change the data in the store is to call `dispatch()` on it.
   *
   * There should only be a single store in your app. To specify how different
   * parts of the state tree respond to actions, you may combine several reducers
   * into a single reducer function by using `combineReducers`.
   *
   * @param {Function} reducer A function that returns the next state tree, given
   * the current state tree and the action to handle.
   *
   * @param {any} [preloadedState] The initial state. You may optionally specify it
   * to hydrate the state from the server in universal apps, or to restore a
   * previously serialized user session.
   * If you use `combineReducers` to produce the root reducer function, this must be
   * an object with the same shape as `combineReducers` keys.
   *
   * @param {Function} [enhancer] The store enhancer. You may optionally specify it
   * to enhance the store with third-party capabilities such as middleware,
   * time travel, persistence, etc. The only store enhancer that ships with Redux
   * is `applyMiddleware()`.
   *
   * @returns {Store} A Redux store that lets you read the state, dispatch actions
   * and subscribe to changes.
   */

  function createStore(reducer, preloadedState, enhancer) {
    var _ref2;

    if (typeof preloadedState === 'function' && typeof enhancer === 'function' || typeof enhancer === 'function' && typeof arguments[3] === 'function') {
      throw new Error('It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function');
    }

    if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {
      enhancer = preloadedState;
      preloadedState = undefined;
    }

    if (typeof enhancer !== 'undefined') {
      if (typeof enhancer !== 'function') {
        throw new Error('Expected the enhancer to be a function.');
      }

      return enhancer(createStore)(reducer, preloadedState);
    }

    if (typeof reducer !== 'function') {
      throw new Error('Expected the reducer to be a function.');
    }

    var currentReducer = reducer;
    var currentState = preloadedState;
    var currentListeners = [];
    var nextListeners = currentListeners;
    var isDispatching = false;

    function ensureCanMutateNextListeners() {
      if (nextListeners === currentListeners) {
        nextListeners = currentListeners.slice();
      }
    }
    /**
     * Reads the state tree managed by the store.
     *
     * @returns {any} The current state tree of your application.
     */


    function getState() {
      if (isDispatching) {
        throw new Error('You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.');
      }

      return currentState;
    }
    /**
     * Adds a change listener. It will be called any time an action is dispatched,
     * and some part of the state tree may potentially have changed. You may then
     * call `getState()` to read the current state tree inside the callback.
     *
     * You may call `dispatch()` from a change listener, with the following
     * caveats:
     *
     * 1. The subscriptions are snapshotted just before every `dispatch()` call.
     * If you subscribe or unsubscribe while the listeners are being invoked, this
     * will not have any effect on the `dispatch()` that is currently in progress.
     * However, the next `dispatch()` call, whether nested or not, will use a more
     * recent snapshot of the subscription list.
     *
     * 2. The listener should not expect to see all state changes, as the state
     * might have been updated multiple times during a nested `dispatch()` before
     * the listener is called. It is, however, guaranteed that all subscribers
     * registered before the `dispatch()` started will be called with the latest
     * state by the time it exits.
     *
     * @param {Function} listener A callback to be invoked on every dispatch.
     * @returns {Function} A function to remove this change listener.
     */


    function subscribe(listener) {
      if (typeof listener !== 'function') {
        throw new Error('Expected the listener to be a function.');
      }

      if (isDispatching) {
        throw new Error('You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');
      }

      var isSubscribed = true;
      ensureCanMutateNextListeners();
      nextListeners.push(listener);
      return function unsubscribe() {
        if (!isSubscribed) {
          return;
        }

        if (isDispatching) {
          throw new Error('You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');
        }

        isSubscribed = false;
        ensureCanMutateNextListeners();
        var index = nextListeners.indexOf(listener);
        nextListeners.splice(index, 1);
      };
    }
    /**
     * Dispatches an action. It is the only way to trigger a state change.
     *
     * The `reducer` function, used to create the store, will be called with the
     * current state tree and the given `action`. Its return value will
     * be considered the **next** state of the tree, and the change listeners
     * will be notified.
     *
     * The base implementation only supports plain object actions. If you want to
     * dispatch a Promise, an Observable, a thunk, or something else, you need to
     * wrap your store creating function into the corresponding middleware. For
     * example, see the documentation for the `redux-thunk` package. Even the
     * middleware will eventually dispatch plain object actions using this method.
     *
     * @param {Object} action A plain object representing what changed. It is
     * a good idea to keep actions serializable so you can record and replay user
     * sessions, or use the time travelling `redux-devtools`. An action must have
     * a `type` property which may not be `undefined`. It is a good idea to use
     * string constants for action types.
     *
     * @returns {Object} For convenience, the same action object you dispatched.
     *
     * Note that, if you use a custom middleware, it may wrap `dispatch()` to
     * return something else (for example, a Promise you can await).
     */


    function dispatch(action) {
      if (!isPlainObject(action)) {
        throw new Error('Actions must be plain objects. ' + 'Use custom middleware for async actions.');
      }

      if (typeof action.type === 'undefined') {
        throw new Error('Actions may not have an undefined "type" property. ' + 'Have you misspelled a constant?');
      }

      if (isDispatching) {
        throw new Error('Reducers may not dispatch actions.');
      }

      try {
        isDispatching = true;
        currentState = currentReducer(currentState, action);
      } finally {
        isDispatching = false;
      }

      var listeners = currentListeners = nextListeners;

      for (var i = 0; i < listeners.length; i++) {
        var listener = listeners[i];
        listener();
      }

      return action;
    }
    /**
     * Replaces the reducer currently used by the store to calculate the state.
     *
     * You might need this if your app implements code splitting and you want to
     * load some of the reducers dynamically. You might also need this if you
     * implement a hot reloading mechanism for Redux.
     *
     * @param {Function} nextReducer The reducer for the store to use instead.
     * @returns {void}
     */


    function replaceReducer(nextReducer) {
      if (typeof nextReducer !== 'function') {
        throw new Error('Expected the nextReducer to be a function.');
      }

      currentReducer = nextReducer;
      dispatch({
        type: ActionTypes.REPLACE
      });
    }
    /**
     * Interoperability point for observable/reactive libraries.
     * @returns {observable} A minimal observable of state changes.
     * For more information, see the observable proposal:
     * https://github.com/tc39/proposal-observable
     */


    function observable() {
      var _ref;

      var outerSubscribe = subscribe;
      return _ref = {
        /**
         * The minimal observable subscription method.
         * @param {Object} observer Any object that can be used as an observer.
         * The observer object should have a `next` method.
         * @returns {subscription} An object with an `unsubscribe` method that can
         * be used to unsubscribe the observable from the store, and prevent further
         * emission of values from the observable.
         */
        subscribe: function subscribe(observer) {
          if (typeof observer !== 'object' || observer === null) {
            throw new TypeError('Expected the observer to be an object.');
          }

          function observeState() {
            if (observer.next) {
              observer.next(getState());
            }
          }

          observeState();
          var unsubscribe = outerSubscribe(observeState);
          return {
            unsubscribe: unsubscribe
          };
        }
      }, _ref[result] = function () {
        return this;
      }, _ref;
    } // When a store is created, an "INIT" action is dispatched so that every
    // reducer returns their initial state. This effectively populates
    // the initial state tree.


    dispatch({
      type: ActionTypes.INIT
    });
    return _ref2 = {
      dispatch: dispatch,
      subscribe: subscribe,
      getState: getState,
      replaceReducer: replaceReducer
    }, _ref2[result] = observable, _ref2;
  }

  /**
   * Prints a warning in the console if it exists.
   *
   * @param {String} message The warning message.
   * @returns {void}
   */
  function warning$3(message) {
    /* eslint-disable no-console */
    if (typeof console !== 'undefined' && typeof console.error === 'function') {
      console.error(message);
    }
    /* eslint-enable no-console */


    try {
      // This error was thrown as a convenience so that if you enable
      // "break on all exceptions" in your console,
      // it would pause the execution at this line.
      throw new Error(message);
    } catch (e) {} // eslint-disable-line no-empty

  }

  function getUndefinedStateErrorMessage(key, action) {
    var actionType = action && action.type;
    var actionDescription = actionType && "action \"" + String(actionType) + "\"" || 'an action';
    return "Given " + actionDescription + ", reducer \"" + key + "\" returned undefined. " + "To ignore an action, you must explicitly return the previous state. " + "If you want this reducer to hold no value, you can return null instead of undefined.";
  }

  function getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {
    var reducerKeys = Object.keys(reducers);
    var argumentName = action && action.type === ActionTypes.INIT ? 'preloadedState argument passed to createStore' : 'previous state received by the reducer';

    if (reducerKeys.length === 0) {
      return 'Store does not have a valid reducer. Make sure the argument passed ' + 'to combineReducers is an object whose values are reducers.';
    }

    if (!isPlainObject(inputState)) {
      return "The " + argumentName + " has unexpected type of \"" + {}.toString.call(inputState).match(/\s([a-z|A-Z]+)/)[1] + "\". Expected argument to be an object with the following " + ("keys: \"" + reducerKeys.join('", "') + "\"");
    }

    var unexpectedKeys = Object.keys(inputState).filter(function (key) {
      return !reducers.hasOwnProperty(key) && !unexpectedKeyCache[key];
    });
    unexpectedKeys.forEach(function (key) {
      unexpectedKeyCache[key] = true;
    });
    if (action && action.type === ActionTypes.REPLACE) return;

    if (unexpectedKeys.length > 0) {
      return "Unexpected " + (unexpectedKeys.length > 1 ? 'keys' : 'key') + " " + ("\"" + unexpectedKeys.join('", "') + "\" found in " + argumentName + ". ") + "Expected to find one of the known reducer keys instead: " + ("\"" + reducerKeys.join('", "') + "\". Unexpected keys will be ignored.");
    }
  }

  function assertReducerShape(reducers) {
    Object.keys(reducers).forEach(function (key) {
      var reducer = reducers[key];
      var initialState = reducer(undefined, {
        type: ActionTypes.INIT
      });

      if (typeof initialState === 'undefined') {
        throw new Error("Reducer \"" + key + "\" returned undefined during initialization. " + "If the state passed to the reducer is undefined, you must " + "explicitly return the initial state. The initial state may " + "not be undefined. If you don't want to set a value for this reducer, " + "you can use null instead of undefined.");
      }

      if (typeof reducer(undefined, {
        type: ActionTypes.PROBE_UNKNOWN_ACTION()
      }) === 'undefined') {
        throw new Error("Reducer \"" + key + "\" returned undefined when probed with a random type. " + ("Don't try to handle " + ActionTypes.INIT + " or other actions in \"redux/*\" ") + "namespace. They are considered private. Instead, you must return the " + "current state for any unknown actions, unless it is undefined, " + "in which case you must return the initial state, regardless of the " + "action type. The initial state may not be undefined, but can be null.");
      }
    });
  }
  /**
   * Turns an object whose values are different reducer functions, into a single
   * reducer function. It will call every child reducer, and gather their results
   * into a single state object, whose keys correspond to the keys of the passed
   * reducer functions.
   *
   * @param {Object} reducers An object whose values correspond to different
   * reducer functions that need to be combined into one. One handy way to obtain
   * it is to use ES6 `import * as reducers` syntax. The reducers may never return
   * undefined for any action. Instead, they should return their initial state
   * if the state passed to them was undefined, and the current state for any
   * unrecognized action.
   *
   * @returns {Function} A reducer function that invokes every reducer inside the
   * passed object, and builds a state object with the same shape.
   */


  function combineReducers(reducers) {
    var reducerKeys = Object.keys(reducers);
    var finalReducers = {};

    for (var i = 0; i < reducerKeys.length; i++) {
      var key = reducerKeys[i];

      if (process.env.NODE_ENV !== 'production') {
        if (typeof reducers[key] === 'undefined') {
          warning$3("No reducer provided for key \"" + key + "\"");
        }
      }

      if (typeof reducers[key] === 'function') {
        finalReducers[key] = reducers[key];
      }
    }

    var finalReducerKeys = Object.keys(finalReducers);
    var unexpectedKeyCache;

    if (process.env.NODE_ENV !== 'production') {
      unexpectedKeyCache = {};
    }

    var shapeAssertionError;

    try {
      assertReducerShape(finalReducers);
    } catch (e) {
      shapeAssertionError = e;
    }

    return function combination(state, action) {
      if (state === void 0) {
        state = {};
      }

      if (shapeAssertionError) {
        throw shapeAssertionError;
      }

      if (process.env.NODE_ENV !== 'production') {
        var warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache);

        if (warningMessage) {
          warning$3(warningMessage);
        }
      }

      var hasChanged = false;
      var nextState = {};

      for (var _i = 0; _i < finalReducerKeys.length; _i++) {
        var _key = finalReducerKeys[_i];
        var reducer = finalReducers[_key];
        var previousStateForKey = state[_key];
        var nextStateForKey = reducer(previousStateForKey, action);

        if (typeof nextStateForKey === 'undefined') {
          var errorMessage = getUndefinedStateErrorMessage(_key, action);
          throw new Error(errorMessage);
        }

        nextState[_key] = nextStateForKey;
        hasChanged = hasChanged || nextStateForKey !== previousStateForKey;
      }

      return hasChanged ? nextState : state;
    };
  }

  function bindActionCreator(actionCreator, dispatch) {
    return function () {
      return dispatch(actionCreator.apply(this, arguments));
    };
  }
  /**
   * Turns an object whose values are action creators, into an object with the
   * same keys, but with every function wrapped into a `dispatch` call so they
   * may be invoked directly. This is just a convenience method, as you can call
   * `store.dispatch(MyActionCreators.doSomething())` yourself just fine.
   *
   * For convenience, you can also pass a single function as the first argument,
   * and get a function in return.
   *
   * @param {Function|Object} actionCreators An object whose values are action
   * creator functions. One handy way to obtain it is to use ES6 `import * as`
   * syntax. You may also pass a single function.
   *
   * @param {Function} dispatch The `dispatch` function available on your Redux
   * store.
   *
   * @returns {Function|Object} The object mimicking the original object, but with
   * every action creator wrapped into the `dispatch` call. If you passed a
   * function as `actionCreators`, the return value will also be a single
   * function.
   */


  function bindActionCreators(actionCreators, dispatch) {
    if (typeof actionCreators === 'function') {
      return bindActionCreator(actionCreators, dispatch);
    }

    if (typeof actionCreators !== 'object' || actionCreators === null) {
      throw new Error("bindActionCreators expected an object or a function, instead received " + (actionCreators === null ? 'null' : typeof actionCreators) + ". " + "Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?");
    }

    var keys = Object.keys(actionCreators);
    var boundActionCreators = {};

    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      var actionCreator = actionCreators[key];

      if (typeof actionCreator === 'function') {
        boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);
      }
    }

    return boundActionCreators;
  }

  /*
   * This is a dummy function to check if the function name has been altered by minification.
   * If the function has been minified and NODE_ENV !== 'production', warn the user.
   */

  function isCrushed() {}

  if (process.env.NODE_ENV !== 'production' && typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {
    warning$3('You are currently using minified code outside of NODE_ENV === "production". ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) ' + 'to ensure you have the correct code for your production build.');
  }

  /**
   * @param {any} obj The object to inspect.
   * @returns {boolean} True if the argument appears to be a plain object.
   */
  function isPlainObject$1(obj) {
    if (typeof obj !== 'object' || obj === null) return false;
    var proto = Object.getPrototypeOf(obj);
    if (proto === null) return true;
    var baseProto = proto;

    while (Object.getPrototypeOf(baseProto) !== null) {
      baseProto = Object.getPrototypeOf(baseProto);
    }

    return proto === baseProto;
  }

  /**
   * Prints a warning in the console if it exists.
   *
   * @param {String} message The warning message.
   * @returns {void}
   */
  function warning$4(message) {
    /* eslint-disable no-console */
    if (typeof console !== 'undefined' && typeof console.error === 'function') {
      console.error(message);
    }
    /* eslint-enable no-console */


    try {
      // This error was thrown as a convenience so that if you enable
      // "break on all exceptions" in your console,
      // it would pause the execution at this line.
      throw new Error(message);
      /* eslint-disable no-empty */
    } catch (e) {}
    /* eslint-enable no-empty */

  }

  function verifyPlainObject(value, displayName, methodName) {
    if (!isPlainObject$1(value)) {
      warning$4(methodName + "() in " + displayName + " must return a plain object. Instead received " + value + ".");
    }
  }

  function wrapMapToPropsConstant(getConstant) {
    return function initConstantSelector(dispatch, options) {
      var constant = getConstant(dispatch, options);

      function constantSelector() {
        return constant;
      }

      constantSelector.dependsOnOwnProps = false;
      return constantSelector;
    };
  } // dependsOnOwnProps is used by createMapToPropsProxy to determine whether to pass props as args
  // to the mapToProps function being wrapped. It is also used by makePurePropsSelector to determine
  // whether mapToProps needs to be invoked when props have changed.
  //
  // A length of one signals that mapToProps does not depend on props from the parent component.
  // A length of zero is assumed to mean mapToProps is getting args via arguments or ...args and
  // therefore not reporting its length accurately..

  function getDependsOnOwnProps(mapToProps) {
    return mapToProps.dependsOnOwnProps !== null && mapToProps.dependsOnOwnProps !== undefined ? Boolean(mapToProps.dependsOnOwnProps) : mapToProps.length !== 1;
  } // Used by whenMapStateToPropsIsFunction and whenMapDispatchToPropsIsFunction,
  // this function wraps mapToProps in a proxy function which does several things:
  //
  //  * Detects whether the mapToProps function being called depends on props, which
  //    is used by selectorFactory to decide if it should reinvoke on props changes.
  //
  //  * On first call, handles mapToProps if returns another function, and treats that
  //    new function as the true mapToProps for subsequent calls.
  //
  //  * On first call, verifies the first result is a plain object, in order to warn
  //    the developer that their mapToProps function is not returning a valid result.
  //

  function wrapMapToPropsFunc(mapToProps, methodName) {
    return function initProxySelector(dispatch, _ref) {
      var displayName = _ref.displayName;

      var proxy = function mapToPropsProxy(stateOrDispatch, ownProps) {
        return proxy.dependsOnOwnProps ? proxy.mapToProps(stateOrDispatch, ownProps) : proxy.mapToProps(stateOrDispatch);
      }; // allow detectFactoryAndVerify to get ownProps


      proxy.dependsOnOwnProps = true;

      proxy.mapToProps = function detectFactoryAndVerify(stateOrDispatch, ownProps) {
        proxy.mapToProps = mapToProps;
        proxy.dependsOnOwnProps = getDependsOnOwnProps(mapToProps);
        var props = proxy(stateOrDispatch, ownProps);

        if (typeof props === 'function') {
          proxy.mapToProps = props;
          proxy.dependsOnOwnProps = getDependsOnOwnProps(props);
          props = proxy(stateOrDispatch, ownProps);
        }

        if (process.env.NODE_ENV !== 'production') verifyPlainObject(props, displayName, methodName);
        return props;
      };

      return proxy;
    };
  }

  function whenMapDispatchToPropsIsFunction(mapDispatchToProps) {
    return typeof mapDispatchToProps === 'function' ? wrapMapToPropsFunc(mapDispatchToProps, 'mapDispatchToProps') : undefined;
  }
  function whenMapDispatchToPropsIsMissing(mapDispatchToProps) {
    return !mapDispatchToProps ? wrapMapToPropsConstant(function (dispatch) {
      return {
        dispatch: dispatch
      };
    }) : undefined;
  }
  function whenMapDispatchToPropsIsObject(mapDispatchToProps) {
    return mapDispatchToProps && typeof mapDispatchToProps === 'object' ? wrapMapToPropsConstant(function (dispatch) {
      return bindActionCreators(mapDispatchToProps, dispatch);
    }) : undefined;
  }
  var defaultMapDispatchToPropsFactories = [whenMapDispatchToPropsIsFunction, whenMapDispatchToPropsIsMissing, whenMapDispatchToPropsIsObject];

  function whenMapStateToPropsIsFunction(mapStateToProps) {
    return typeof mapStateToProps === 'function' ? wrapMapToPropsFunc(mapStateToProps, 'mapStateToProps') : undefined;
  }
  function whenMapStateToPropsIsMissing(mapStateToProps) {
    return !mapStateToProps ? wrapMapToPropsConstant(function () {
      return {};
    }) : undefined;
  }
  var defaultMapStateToPropsFactories = [whenMapStateToPropsIsFunction, whenMapStateToPropsIsMissing];

  function defaultMergeProps(stateProps, dispatchProps, ownProps) {
    return _extends$b({}, ownProps, stateProps, dispatchProps);
  }
  function wrapMergePropsFunc(mergeProps) {
    return function initMergePropsProxy(dispatch, _ref) {
      var displayName = _ref.displayName,
          pure = _ref.pure,
          areMergedPropsEqual = _ref.areMergedPropsEqual;
      var hasRunOnce = false;
      var mergedProps;
      return function mergePropsProxy(stateProps, dispatchProps, ownProps) {
        var nextMergedProps = mergeProps(stateProps, dispatchProps, ownProps);

        if (hasRunOnce) {
          if (!pure || !areMergedPropsEqual(nextMergedProps, mergedProps)) mergedProps = nextMergedProps;
        } else {
          hasRunOnce = true;
          mergedProps = nextMergedProps;
          if (process.env.NODE_ENV !== 'production') verifyPlainObject(mergedProps, displayName, 'mergeProps');
        }

        return mergedProps;
      };
    };
  }
  function whenMergePropsIsFunction(mergeProps) {
    return typeof mergeProps === 'function' ? wrapMergePropsFunc(mergeProps) : undefined;
  }
  function whenMergePropsIsOmitted(mergeProps) {
    return !mergeProps ? function () {
      return defaultMergeProps;
    } : undefined;
  }
  var defaultMergePropsFactories = [whenMergePropsIsFunction, whenMergePropsIsOmitted];

  function verify(selector, methodName, displayName) {
    if (!selector) {
      throw new Error("Unexpected value for " + methodName + " in " + displayName + ".");
    } else if (methodName === 'mapStateToProps' || methodName === 'mapDispatchToProps') {
      if (!selector.hasOwnProperty('dependsOnOwnProps')) {
        warning$4("The selector for " + methodName + " of " + displayName + " did not specify a value for dependsOnOwnProps.");
      }
    }
  }

  function verifySubselectors(mapStateToProps, mapDispatchToProps, mergeProps, displayName) {
    verify(mapStateToProps, 'mapStateToProps', displayName);
    verify(mapDispatchToProps, 'mapDispatchToProps', displayName);
    verify(mergeProps, 'mergeProps', displayName);
  }

  function impureFinalPropsSelectorFactory(mapStateToProps, mapDispatchToProps, mergeProps, dispatch) {
    return function impureFinalPropsSelector(state, ownProps) {
      return mergeProps(mapStateToProps(state, ownProps), mapDispatchToProps(dispatch, ownProps), ownProps);
    };
  }
  function pureFinalPropsSelectorFactory(mapStateToProps, mapDispatchToProps, mergeProps, dispatch, _ref) {
    var areStatesEqual = _ref.areStatesEqual,
        areOwnPropsEqual = _ref.areOwnPropsEqual,
        areStatePropsEqual = _ref.areStatePropsEqual;
    var hasRunAtLeastOnce = false;
    var state;
    var ownProps;
    var stateProps;
    var dispatchProps;
    var mergedProps;

    function handleFirstCall(firstState, firstOwnProps) {
      state = firstState;
      ownProps = firstOwnProps;
      stateProps = mapStateToProps(state, ownProps);
      dispatchProps = mapDispatchToProps(dispatch, ownProps);
      mergedProps = mergeProps(stateProps, dispatchProps, ownProps);
      hasRunAtLeastOnce = true;
      return mergedProps;
    }

    function handleNewPropsAndNewState() {
      stateProps = mapStateToProps(state, ownProps);
      if (mapDispatchToProps.dependsOnOwnProps) dispatchProps = mapDispatchToProps(dispatch, ownProps);
      mergedProps = mergeProps(stateProps, dispatchProps, ownProps);
      return mergedProps;
    }

    function handleNewProps() {
      if (mapStateToProps.dependsOnOwnProps) stateProps = mapStateToProps(state, ownProps);
      if (mapDispatchToProps.dependsOnOwnProps) dispatchProps = mapDispatchToProps(dispatch, ownProps);
      mergedProps = mergeProps(stateProps, dispatchProps, ownProps);
      return mergedProps;
    }

    function handleNewState() {
      var nextStateProps = mapStateToProps(state, ownProps);
      var statePropsChanged = !areStatePropsEqual(nextStateProps, stateProps);
      stateProps = nextStateProps;
      if (statePropsChanged) mergedProps = mergeProps(stateProps, dispatchProps, ownProps);
      return mergedProps;
    }

    function handleSubsequentCalls(nextState, nextOwnProps) {
      var propsChanged = !areOwnPropsEqual(nextOwnProps, ownProps);
      var stateChanged = !areStatesEqual(nextState, state);
      state = nextState;
      ownProps = nextOwnProps;
      if (propsChanged && stateChanged) return handleNewPropsAndNewState();
      if (propsChanged) return handleNewProps();
      if (stateChanged) return handleNewState();
      return mergedProps;
    }

    return function pureFinalPropsSelector(nextState, nextOwnProps) {
      return hasRunAtLeastOnce ? handleSubsequentCalls(nextState, nextOwnProps) : handleFirstCall(nextState, nextOwnProps);
    };
  } // TODO: Add more comments
  // If pure is true, the selector returned by selectorFactory will memoize its results,
  // allowing connectAdvanced's shouldComponentUpdate to return false if final
  // props have not changed. If false, the selector will always return a new
  // object and shouldComponentUpdate will always return true.

  function finalPropsSelectorFactory(dispatch, _ref2) {
    var initMapStateToProps = _ref2.initMapStateToProps,
        initMapDispatchToProps = _ref2.initMapDispatchToProps,
        initMergeProps = _ref2.initMergeProps,
        options = _objectWithoutPropertiesLoose(_ref2, ["initMapStateToProps", "initMapDispatchToProps", "initMergeProps"]);

    var mapStateToProps = initMapStateToProps(dispatch, options);
    var mapDispatchToProps = initMapDispatchToProps(dispatch, options);
    var mergeProps = initMergeProps(dispatch, options);

    if (process.env.NODE_ENV !== 'production') {
      verifySubselectors(mapStateToProps, mapDispatchToProps, mergeProps, options.displayName);
    }

    var selectorFactory = options.pure ? pureFinalPropsSelectorFactory : impureFinalPropsSelectorFactory;
    return selectorFactory(mapStateToProps, mapDispatchToProps, mergeProps, dispatch, options);
  }

  /*
    connect is a facade over connectAdvanced. It turns its args into a compatible
    selectorFactory, which has the signature:

      (dispatch, options) => (nextState, nextOwnProps) => nextFinalProps
    
    connect passes its args to connectAdvanced as options, which will in turn pass them to
    selectorFactory each time a Connect component instance is instantiated or hot reloaded.

    selectorFactory returns a final props selector from its mapStateToProps,
    mapStateToPropsFactories, mapDispatchToProps, mapDispatchToPropsFactories, mergeProps,
    mergePropsFactories, and pure args.

    The resulting final props selector is called by the Connect component instance whenever
    it receives new props or store state.
   */

  function match(arg, factories, name) {
    for (var i = factories.length - 1; i >= 0; i--) {
      var result = factories[i](arg);
      if (result) return result;
    }

    return function (dispatch, options) {
      throw new Error("Invalid value of type " + typeof arg + " for " + name + " argument when connecting component " + options.wrappedComponentName + ".");
    };
  }

  function strictEqual(a, b) {
    return a === b;
  } // createConnect with default args builds the 'official' connect behavior. Calling it with
  // different options opens up some testing and extensibility scenarios


  function createConnect(_temp) {
    var _ref = _temp === void 0 ? {} : _temp,
        _ref$connectHOC = _ref.connectHOC,
        connectHOC = _ref$connectHOC === void 0 ? connectAdvanced : _ref$connectHOC,
        _ref$mapStateToPropsF = _ref.mapStateToPropsFactories,
        mapStateToPropsFactories = _ref$mapStateToPropsF === void 0 ? defaultMapStateToPropsFactories : _ref$mapStateToPropsF,
        _ref$mapDispatchToPro = _ref.mapDispatchToPropsFactories,
        mapDispatchToPropsFactories = _ref$mapDispatchToPro === void 0 ? defaultMapDispatchToPropsFactories : _ref$mapDispatchToPro,
        _ref$mergePropsFactor = _ref.mergePropsFactories,
        mergePropsFactories = _ref$mergePropsFactor === void 0 ? defaultMergePropsFactories : _ref$mergePropsFactor,
        _ref$selectorFactory = _ref.selectorFactory,
        selectorFactory = _ref$selectorFactory === void 0 ? finalPropsSelectorFactory : _ref$selectorFactory;

    return function connect(mapStateToProps, mapDispatchToProps, mergeProps, _ref2) {
      if (_ref2 === void 0) {
        _ref2 = {};
      }

      var _ref3 = _ref2,
          _ref3$pure = _ref3.pure,
          pure = _ref3$pure === void 0 ? true : _ref3$pure,
          _ref3$areStatesEqual = _ref3.areStatesEqual,
          areStatesEqual = _ref3$areStatesEqual === void 0 ? strictEqual : _ref3$areStatesEqual,
          _ref3$areOwnPropsEqua = _ref3.areOwnPropsEqual,
          areOwnPropsEqual = _ref3$areOwnPropsEqua === void 0 ? shallowEqual : _ref3$areOwnPropsEqua,
          _ref3$areStatePropsEq = _ref3.areStatePropsEqual,
          areStatePropsEqual = _ref3$areStatePropsEq === void 0 ? shallowEqual : _ref3$areStatePropsEq,
          _ref3$areMergedPropsE = _ref3.areMergedPropsEqual,
          areMergedPropsEqual = _ref3$areMergedPropsE === void 0 ? shallowEqual : _ref3$areMergedPropsE,
          extraOptions = _objectWithoutPropertiesLoose(_ref3, ["pure", "areStatesEqual", "areOwnPropsEqual", "areStatePropsEqual", "areMergedPropsEqual"]);

      var initMapStateToProps = match(mapStateToProps, mapStateToPropsFactories, 'mapStateToProps');
      var initMapDispatchToProps = match(mapDispatchToProps, mapDispatchToPropsFactories, 'mapDispatchToProps');
      var initMergeProps = match(mergeProps, mergePropsFactories, 'mergeProps');
      return connectHOC(selectorFactory, _extends$b({
        // used in error messages
        methodName: 'connect',
        // used to compute Connect's displayName from the wrapped component's displayName.
        getDisplayName: function getDisplayName(name) {
          return "Connect(" + name + ")";
        },
        // if mapStateToProps is falsy, the Connect component doesn't subscribe to store state changes
        shouldHandleStateChanges: Boolean(mapStateToProps),
        // passed through to selectorFactory
        initMapStateToProps: initMapStateToProps,
        initMapDispatchToProps: initMapDispatchToProps,
        initMergeProps: initMergeProps,
        pure: pure,
        areStatesEqual: areStatesEqual,
        areOwnPropsEqual: areOwnPropsEqual,
        areStatePropsEqual: areStatePropsEqual,
        areMergedPropsEqual: areMergedPropsEqual
      }, extraOptions));
    };
  }
  var connect = createConnect();

  function _typeof$4(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof$4=function(obj){return typeof obj;};}else{_typeof$4=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof$4(obj);}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _classCallCheck$b(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties$1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass$1(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$1(Constructor.prototype,protoProps);if(staticProps)_defineProperties$1(Constructor,staticProps);return Constructor;}function _defineProperty$2(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _objectSpread$1(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty$2(target,key,source[key]);});}return target;}function _inherits$b(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _construct(Parent,args,Class){if(isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _assertThisInitialized$2(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _possibleConstructorReturn$b(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call;}return _assertThisInitialized$2(self);}var cornerstone$1=window.cornerstone;var cornerstoneTools=window.cornerstoneTools;var cornerstoneWADOImageLoader=window.cornerstoneWADOImageLoader;var cornerstoneMath=window.cornerstoneMath;var external={set cornerstone(cs){cornerstone$1=cs;},get cornerstone(){return cornerstone$1;},set cornerstoneTools(tools){cornerstoneTools=tools;},get cornerstoneTools(){return cornerstoneTools;},set cornerstoneWADOImageLoader(wado){cornerstoneWADOImageLoader=wado;},get cornerstoneWADOImageLoader(){return cornerstoneWADOImageLoader;},set cornerstoneMath(math){cornerstoneMath=math;},get cornerstoneMath(){return cornerstoneMath;}};function getBoundingBox(context,textLines,x,y,options){var cornerstoneTools=external.cornerstoneTools;if(Object.prototype.toString.call(textLines)!=='[object Array]'){textLines=[textLines];}var padding=5;var font=cornerstoneTools.textStyle.getFont();var fontSize=cornerstoneTools.textStyle.getFontSize();context.save();context.font=font;context.textBaseline='top';// Find the longest text width in the array of text data
  var maxWidth=0;textLines.forEach(function(text){// Get the text width in the current font
  var width=context.measureText(text).width;// Find the maximum with for all the text rows;
  maxWidth=Math.max(maxWidth,width);});// Calculate the bounding box for this text box
  var boundingBox={width:maxWidth+padding*2,height:padding+textLines.length*(fontSize+padding)};if(options&&options.centering&&options.centering.x===true){x-=boundingBox.width/2;}if(options&&options.centering&&options.centering.y===true){y-=boundingBox.height/2;}boundingBox.left=x;boundingBox.top=y;context.restore();// Return the bounding box so it can be used for pointNearHandle
  return boundingBox;}function pixelToPage(element,position){var cornerstone=external.cornerstone;var enabledElement=cornerstone.getEnabledElement(element);var result={x:0,y:0};// Stop here if the cornerstone element is not enabled or position is not an object
  if(!enabledElement||_typeof$4(position)!=='object'){return result;}var canvas=enabledElement.canvas;var canvasOffset=$(canvas).offset();result.x+=canvasOffset.left;result.y+=canvasOffset.top;var canvasPosition=cornerstone.pixelToCanvas(element,position);result.x+=canvasPosition.x;result.y+=canvasPosition.y;return result;}function repositionTextBox(eventData,measurementData,config){var cornerstone=external.cornerstone;// Stop here if it's not a measurement creating
  if(!measurementData.isCreating){return;}var element=eventData.element;var enabledElement=cornerstone.getEnabledElement(element);var image=enabledElement.image;var allowedBorders=OHIF.uiSettings.autoPositionMeasurementsTextCallOuts;var allow={T:!allowedBorders||allowedBorders.includes('T'),R:!allowedBorders||allowedBorders.includes('R'),B:!allowedBorders||allowedBorders.includes('B'),L:!allowedBorders||allowedBorders.includes('L')};var getAvailableBlankAreas=function getAvailableBlankAreas(enabledElement,labelWidth,labelHeight){var element=enabledElement.element,canvas=enabledElement.canvas,image=enabledElement.image;var topLeft=cornerstone.pixelToCanvas(element,{x:0,y:0});var bottomRight=cornerstone.pixelToCanvas(element,{x:image.width,y:image.height});var $canvas=$(canvas);var canvasWidth=$canvas.outerWidth();var canvasHeight=$canvas.outerHeight();var result={};result['x-1']=allow.L&&topLeft.x>labelWidth;result['y-1']=allow.T&&topLeft.y>labelHeight;result.x1=allow.R&&canvasWidth-bottomRight.x>labelWidth;result.y1=allow.B&&canvasHeight-bottomRight.y>labelHeight;return result;};var getRenderingInformation=function getRenderingInformation(limits,tool){var mid={};mid.x=limits.x/2;mid.y=limits.y/2;var directions={};directions.x=tool.x<mid.x?-1:1;directions.y=tool.y<mid.y?-1:1;var diffX=directions.x<0?tool.x:limits.x-tool.x;var diffY=directions.y<0?tool.y:limits.y-tool.y;var cornerAxis=diffY<diffX?'y':'x';var map={'x-1':'L','y-1':'T',x1:'R',y1:'B'};var current=0;while(current<4&&!allow[map[cornerAxis+directions[cornerAxis]]]){// Invert the direction for the next iteration
  directions[cornerAxis]*=-1;// Invert the tempCornerAxis
  cornerAxis=cornerAxis==='x'?'y':'x';current++;}return {directions:directions,cornerAxis:cornerAxis};};var calculateAxisCenter=function calculateAxisCenter(axis,start,end){var a=start[axis];var b=end[axis];var lowest=Math.min(a,b);var highest=Math.max(a,b);return lowest+(highest-lowest)/2;};var getTextBoxSizeInPixels=function getTextBoxSizeInPixels(element,bounds){var topLeft=cornerstone.pageToPixel(element,0,0);var bottomRight=cornerstone.pageToPixel(element,bounds.x,bounds.y);return {x:bottomRight.x-topLeft.x,y:bottomRight.y-topLeft.y};};function getTextBoxOffset(config,cornerAxis,toolAxis,boxSize){config=config||{};var centering=config.centering||{};var centerX=!!centering.x;var centerY=!!centering.y;var halfBoxSizeX=boxSize.x/2;var halfBoxSizeY=boxSize.y/2;var offset={x:[],y:[]};if(cornerAxis==='x'){var offsetY=centerY?0:halfBoxSizeY;offset.x[-1]=centerX?halfBoxSizeX:0;offset.x[1]=centerX?-halfBoxSizeX:-boxSize.x;offset.y[-1]=offsetY;offset.y[1]=offsetY;}else{var offsetX=centerX?0:halfBoxSizeX;offset.x[-1]=offsetX;offset.x[1]=offsetX;offset.y[-1]=centerY?halfBoxSizeY:0;offset.y[1]=centerY?-halfBoxSizeY:-boxSize.y;}return offset;}var handles=measurementData.handles;var textBox=handles.textBox;var $canvas=$(enabledElement.canvas);var canvasWidth=$canvas.outerWidth();var canvasHeight=$canvas.outerHeight();var offset=$canvas.offset();var canvasDimensions={x:canvasWidth,y:canvasHeight};var bounds={};bounds.x=textBox.boundingBox.width;bounds.y=textBox.boundingBox.height;var getHandlePosition=function getHandlePosition(key){var _handles$key=handles[key],x=_handles$key.x,y=_handles$key.y;return {x:x,y:y};};var start=getHandlePosition('start');var end=getHandlePosition('end');var tool={};tool.x=calculateAxisCenter('x',start,end);tool.y=calculateAxisCenter('y',start,end);var limits={};limits.x=image.width;limits.y=image.height;var _getRenderingInformat=getRenderingInformation(limits,tool),directions=_getRenderingInformat.directions,cornerAxis=_getRenderingInformat.cornerAxis;var availableAreas=getAvailableBlankAreas(enabledElement,bounds.x,bounds.y);var tempDirections=Object.assign({},directions);var tempCornerAxis=cornerAxis;var foundPlace=false;var current=0;while(current<4){if(availableAreas[tempCornerAxis+tempDirections[tempCornerAxis]]){foundPlace=true;break;}// Invert the direction for the next iteration
  tempDirections[tempCornerAxis]*=-1;// Invert the tempCornerAxis
  tempCornerAxis=tempCornerAxis==='x'?'y':'x';current++;}var cornerAxisPosition;if(foundPlace){directions=Object.assign({},directions,tempDirections);cornerAxis=tempCornerAxis;cornerAxisPosition=directions[cornerAxis]<0?0:limits[cornerAxis];}else{limits=Object.assign({},limits,canvasDimensions);var toolPositionOnCanvas=cornerstone.pixelToCanvas(element,tool);var renderingInformation=getRenderingInformation(limits,toolPositionOnCanvas);directions=renderingInformation.directions;cornerAxis=renderingInformation.cornerAxis;var position={x:directions.x<0?offset.left:offset.left+canvasWidth,y:directions.y<0?offset.top:offset.top+canvasHeight};var pixelPosition=cornerstone.pageToPixel(element,position.x,position.y);cornerAxisPosition=pixelPosition[cornerAxis];}var toolAxis=cornerAxis==='x'?'y':'x';var boxSize=getTextBoxSizeInPixels(element,bounds);textBox[cornerAxis]=cornerAxisPosition;textBox[toolAxis]=tool[toolAxis];// Adjust the text box position reducing its size from the corner axis
  var textBoxOffset=getTextBoxOffset(config,cornerAxis,toolAxis,boxSize);textBox[cornerAxis]+=textBoxOffset[cornerAxis][directions[cornerAxis]];// Preventing the text box from partially going outside the canvas area
  var topLeft=cornerstone.pixelToCanvas(element,textBox);var bottomRight={x:topLeft.x+bounds.x,y:topLeft.y+bounds.y};var canvasBorders={x0:offset.left,y0:offset.top,x1:offset.left+canvasWidth,y1:offset.top+canvasHeight};if(topLeft[toolAxis]<0){var x=canvasBorders.x0;var y=canvasBorders.y0;var _pixelPosition=cornerstone.pageToPixel(element,x,y);textBox[toolAxis]=_pixelPosition[toolAxis];}else if(bottomRight[toolAxis]>canvasDimensions[toolAxis]){var _x=canvasBorders.x1-bounds.x;var _y=canvasBorders.y1-bounds.y;var _pixelPosition2=cornerstone.pageToPixel(element,_x,_y);textBox[toolAxis]=_pixelPosition2[toolAxis];}}// TODO: Deprecate since we have the same thing in dcmjs?
  var NUMBER='number';var STRING='string';var REGEX_TAG=/^x[0-9a-fx]{8}$/;var DICOMTagDescriptions=Object.create(Object.prototype,{_descriptions:{configurable:false,enumerable:false,writable:false,value:Object.create(null)},tagNumberToString:{configurable:false,enumerable:true,writable:false,value:function tagNumberToString(tag){var string;// by default, undefined is returned...
  if(this.isValidTagNumber(tag)){// if it's a number, build its hexadecimal representation...
  string='x'+('00000000'+tag.toString(16)).substr(-8);}return string;}},isValidTagNumber:{configurable:false,enumerable:true,writable:false,value:function isValidTagNumber(tag){return _typeof$4(tag)===NUMBER&&tag>=0&&tag<=0xffffffff;}},isValidTag:{configurable:false,enumerable:true,writable:false,value:function isValidTag(tag){return _typeof$4(tag)===STRING?REGEX_TAG.test(tag):this.isValidTagNumber(tag);}},find:{configurable:false,enumerable:true,writable:false,value:function find(name){var description;// by default, undefined is returned...
  if(_typeof$4(name)!==STRING){// if it's a number, a tag string will be returned...
  name=this.tagNumberToString(name);}if(_typeof$4(name)===STRING){description=this._descriptions[name];}return description;}},init:{configurable:false,enumerable:true,writable:false,value:function init(descriptionMap){var _hasOwn=Object.prototype.hasOwnProperty;var _descriptions=this._descriptions;for(var tag in descriptionMap){if(_hasOwn.call(descriptionMap,tag)){if(!this.isValidTag(tag)){// Skip in case tag is not valid...
  console.info("DICOMTagDescriptions: Invalid tag \"".concat(tag,"\"..."));continue;}if(tag in _descriptions){// Skip in case the tag is duplicated...
  console.info("DICOMTagDescriptions: Duplicated tag \"".concat(tag,"\"..."));continue;}// Save keyword...
  var keyword=descriptionMap[tag];// Create a description entry and freeze it...
  var entry=Object.create(null);entry.tag=tag;entry.keyword=keyword;Object.freeze(entry);// Add tag references to entry...
  _descriptions[tag]=entry;// Add keyword references to entry (if not present already)...
  if(keyword in _descriptions){var currentEntry=_descriptions[keyword];console.info("DICOMTagDescriptions: Using <".concat(currentEntry.tag,",").concat(currentEntry.keyword,"> instead of <").concat(entry.tag,",").concat(entry.keyword,"> for keyword \"").concat(keyword,"\"..."));}else{_descriptions[keyword]=entry;}}}// Freeze internal description map...
  Object.freeze(_descriptions);// Freeze itself...
  Object.freeze(this);}}});/**
   * Map with DICOM Tag Descriptions
   */var initialTagDescriptionMap={x00020000:'FileMetaInfoGroupLength',x00020001:'FileMetaInfoVersion',x00020002:'MediaStorageSOPClassUID',x00020003:'MediaStorageSOPInstanceUID',x00020010:'TransferSyntaxUID',x00020012:'ImplementationClassUID',x00020013:'ImplementationVersionName',x00020016:'SourceApplicationEntityTitle',x00020100:'PrivateInformationCreatorUID',x00020102:'PrivateInformation',x00041130:'FileSetID',x00041141:'FileSetDescriptorFileID',x00041142:'SpecificCharacterSetOfFile',x00041200:'FirstDirectoryRecordOffset',x00041202:'LastDirectoryRecordOffset',x00041212:'FileSetConsistencyFlag',x00041220:'DirectoryRecordSequence',x00041400:'OffsetOfNextDirectoryRecord',x00041410:'RecordInUseFlag',x00041420:'LowerLevelDirectoryEntityOffset',x00041430:'DirectoryRecordType',x00041432:'PrivateRecordUID',x00041500:'ReferencedFileID',x00041504:'MRDRDirectoryRecordOffset',x00041510:'ReferencedSOPClassUIDInFile',x00041511:'ReferencedSOPInstanceUIDInFile',x00041512:'ReferencedTransferSyntaxUIDInFile',x0004151a:'ReferencedRelatedSOPClassUIDInFile',x00041600:'NumberOfReferences',x00080000:'IdentifyingGroupLength',x00080001:'LengthToEnd',x00080005:'SpecificCharacterSet',x00080006:'LanguageCodeSequence',x00080008:'ImageType',x00080010:'RecognitionCode',x00080012:'InstanceCreationDate',x00080013:'InstanceCreationTime',x00080014:'InstanceCreatorUID',x00080016:'SOPClassUID',x00080018:'SOPInstanceUID',x0008001a:'RelatedGeneralSOPClassUID',x0008001b:'OriginalSpecializedSOPClassUID',x00080020:'StudyDate',x00080021:'SeriesDate',x00080022:'AcquisitionDate',x00080023:'ContentDate',x00080024:'OverlayDate',x00080025:'CurveDate',x0008002a:'AcquisitionDateTime',x00080030:'StudyTime',x00080031:'SeriesTime',x00080032:'AcquisitionTime',x00080033:'ContentTime',x00080034:'OverlayTime',x00080035:'CurveTime',x00080040:'DataSetType',x00080041:'DataSetSubtype',x00080042:'NuclearMedicineSeriesType',x00080050:'AccessionNumber',x00080052:'QueryRetrieveLevel',x00080054:'RetrieveAETitle',x00080056:'InstanceAvailability',x00080058:'FailedSOPInstanceUIDList',x00080060:'Modality',x00080061:'ModalitiesInStudy',x00080062:'SOPClassesInStudy',x00080064:'ConversionType',x00080068:'PresentationIntentType',x00080070:'Manufacturer',x00080080:'InstitutionName',x00080081:'InstitutionAddress',x00080082:'InstitutionCodeSequence',x00080090:'ReferringPhysicianName',x00080092:'ReferringPhysicianAddress',x00080094:'ReferringPhysicianTelephoneNumber',x00080096:'ReferringPhysicianIDSequence',x00080100:'CodeValue',x00080102:'CodingSchemeDesignator',x00080103:'CodingSchemeVersion',x00080104:'CodeMeaning',x00080105:'MappingResource',x00080106:'ContextGroupVersion',x00080107:'ContextGroupLocalVersion',x0008010b:'ContextGroupExtensionFlag',x0008010c:'CodingSchemeUID',x0008010d:'ContextGroupExtensionCreatorUID',x0008010f:'ContextIdentifier',x00080110:'CodingSchemeIDSequence',x00080112:'CodingSchemeRegistry',x00080114:'CodingSchemeExternalID',x00080115:'CodingSchemeName',x00080116:'CodingSchemeResponsibleOrganization',x00080117:'ContextUID',x00080201:'TimezoneOffsetFromUTC',x00081000:'NetworkID',x00081010:'StationName',x00081030:'StudyDescription',x00081032:'ProcedureCodeSequence',x0008103e:'SeriesDescription',x00081040:'InstitutionalDepartmentName',x00081048:'PhysiciansOfRecord',x00081049:'PhysiciansOfRecordIDSequence',x00081050:'PerformingPhysicianName',x00081052:'PerformingPhysicianIDSequence',x00081060:'NameOfPhysicianReadingStudy',x00081062:'PhysicianReadingStudyIDSequence',x00081070:'OperatorsName',x00081072:'OperatorIDSequence',x00081080:'AdmittingDiagnosesDescription',x00081084:'AdmittingDiagnosesCodeSequence',x00081090:'ManufacturersModelName',x00081100:'ReferencedResultsSequence',x00081110:'ReferencedStudySequence',x00081111:'ReferencedPerformedProcedureStepSequence',x00081115:'ReferencedSeriesSequence',x00081120:'ReferencedPatientSequence',x00081125:'ReferencedVisitSequence',x00081130:'ReferencedOverlaySequence',x0008113a:'ReferencedWaveformSequence',x00081140:'ReferencedImageSequence',x00081145:'ReferencedCurveSequence',x0008114a:'ReferencedInstanceSequence',x00081150:'ReferencedSOPClassUID',x00081155:'ReferencedSOPInstanceUID',x0008115a:'SOPClassesSupported',x00081160:'ReferencedFrameNumber',x00081161:'SimpleFrameList',x00081162:'CalculatedFrameList',x00081163:'TimeRange',x00081164:'FrameExtractionSequence',x00081195:'TransactionUID',x00081197:'FailureReason',x00081198:'FailedSOPSequence',x00081199:'ReferencedSOPSequence',x00081200:'OtherReferencedStudiesSequence',x00081250:'RelatedSeriesSequence',x00082110:'LossyImageCompressionRetired',x00082111:'DerivationDescription',x00082112:'SourceImageSequence',x00082120:'StageName',x00082122:'StageNumber',x00082124:'NumberOfStages',x00082127:'ViewName',x00082128:'ViewNumber',x00082129:'NumberOfEventTimers',x0008212a:'NumberOfViewsInStage',x00082130:'EventElapsedTimes',x00082132:'EventTimerNames',x00082133:'EventTimerSequence',x00082134:'EventTimeOffset',x00082135:'EventCodeSequence',x00082142:'StartTrim',x00082143:'StopTrim',x00082144:'RecommendedDisplayFrameRate',x00082200:'TransducerPosition',x00082204:'TransducerOrientation',x00082208:'AnatomicStructure',x00082218:'AnatomicRegionSequence',x00082220:'AnatomicRegionModifierSequence',x00082228:'PrimaryAnatomicStructureSequence',x00082229:'AnatomicStructureOrRegionSequence',x00082230:'AnatomicStructureModifierSequence',x00082240:'TransducerPositionSequence',x00082242:'TransducerPositionModifierSequence',x00082244:'TransducerOrientationSequence',x00082246:'TransducerOrientationModifierSeq',x00082253:'AnatomicEntrancePortalCodeSeqTrial',x00082255:'AnatomicApproachDirCodeSeqTrial',x00082256:'AnatomicPerspectiveDescrTrial',x00082257:'AnatomicPerspectiveCodeSeqTrial',x00083001:'AlternateRepresentationSequence',x00083010:'IrradiationEventUID',x00084000:'IdentifyingComments',x00089007:'FrameType',x00089092:'ReferencedImageEvidenceSequence',x00089121:'ReferencedRawDataSequence',x00089123:'CreatorVersionUID',x00089124:'DerivationImageSequence',x00089154:'SourceImageEvidenceSequence',x00089205:'PixelPresentation',x00089206:'VolumetricProperties',x00089207:'VolumeBasedCalculationTechnique',x00089208:'ComplexImageComponent',x00089209:'AcquisitionContrast',x00089215:'DerivationCodeSequence',x00089237:'GrayscalePresentationStateSequence',x00089410:'ReferencedOtherPlaneSequence',x00089458:'FrameDisplaySequence',x00089459:'RecommendedDisplayFrameRateInFloat',x00089460:'SkipFrameRangeFlag',// x00091001: 'FullFidelity',
  // x00091002: 'SuiteID',
  // x00091004: 'ProductID',
  // x00091027: 'ImageActualDate',
  // x00091030: 'ServiceID',
  // x00091031: 'MobileLocationNumber',
  // x000910e3: 'EquipmentUID',
  // x000910e6: 'GenesisVersionNow',
  // x000910e7: 'ExamRecordChecksum',
  // x000910e9: 'ActualSeriesDataTimeStamp',
  x00100000:'PatientGroupLength',x00100010:'PatientName',x00100020:'PatientID',x00100021:'IssuerOfPatientID',x00100022:'TypeOfPatientID',x00100030:'PatientBirthDate',x00100032:'PatientBirthTime',x00100040:'PatientSex',x00100050:'PatientInsurancePlanCodeSequence',x00100101:'PatientPrimaryLanguageCodeSeq',x00100102:'PatientPrimaryLanguageCodeModSeq',x00101000:'OtherPatientIDs',x00101001:'OtherPatientNames',x00101002:'OtherPatientIDsSequence',x00101005:'PatientBirthName',x00101010:'PatientAge',x00101020:'PatientSize',x00101030:'PatientWeight',x00101040:'PatientAddress',x00101050:'InsurancePlanIdentification',x00101060:'PatientMotherBirthName',x00101080:'MilitaryRank',x00101081:'BranchOfService',x00101090:'MedicalRecordLocator',x00102000:'MedicalAlerts',x00102110:'Allergies',x00102150:'CountryOfResidence',x00102152:'RegionOfResidence',x00102154:'PatientTelephoneNumbers',x00102160:'EthnicGroup',x00102180:'Occupation',x001021a0:'SmokingStatus',x001021b0:'AdditionalPatientHistory',x001021c0:'PregnancyStatus',x001021d0:'LastMenstrualDate',x001021f0:'PatientReligiousPreference',x00102201:'PatientSpeciesDescription',x00102202:'PatientSpeciesCodeSequence',x00102203:'PatientSexNeutered',x00102210:'AnatomicalOrientationType',x00102292:'PatientBreedDescription',x00102293:'PatientBreedCodeSequence',x00102294:'BreedRegistrationSequence',x00102295:'BreedRegistrationNumber',x00102296:'BreedRegistryCodeSequence',x00102297:'ResponsiblePerson',x00102298:'ResponsiblePersonRole',x00102299:'ResponsibleOrganization',x00104000:'PatientComments',x00109431:'ExaminedBodyThickness',x00111010:'PatientStatus',x00120010:'ClinicalTrialSponsorName',x00120020:'ClinicalTrialProtocolID',x00120021:'ClinicalTrialProtocolName',x00120030:'ClinicalTrialSiteID',x00120031:'ClinicalTrialSiteName',x00120040:'ClinicalTrialSubjectID',x00120042:'ClinicalTrialSubjectReadingID',x00120050:'ClinicalTrialTimePointID',x00120051:'ClinicalTrialTimePointDescription',x00120060:'ClinicalTrialCoordinatingCenter',x00120062:'PatientIdentityRemoved',x00120063:'DeidentificationMethod',x00120064:'DeidentificationMethodCodeSequence',x00120071:'ClinicalTrialSeriesID',x00120072:'ClinicalTrialSeriesDescription',x00120084:'DistributionType',x00120085:'ConsentForDistributionFlag',x00180000:'AcquisitionGroupLength',x00180010:'ContrastBolusAgent',x00180012:'ContrastBolusAgentSequence',x00180014:'ContrastBolusAdministrationRoute',x00180015:'BodyPartExamined',x00180020:'ScanningSequence',x00180021:'SequenceVariant',x00180022:'ScanOptions',x00180023:'MRAcquisitionType',x00180024:'SequenceName',x00180025:'AngioFlag',x00180026:'InterventionDrugInformationSeq',x00180027:'InterventionDrugStopTime',x00180028:'InterventionDrugDose',x00180029:'InterventionDrugSequence',x0018002a:'AdditionalDrugSequence',x00180030:'Radionuclide',x00180031:'Radiopharmaceutical',x00180032:'EnergyWindowCenterline',x00180033:'EnergyWindowTotalWidth',x00180034:'InterventionDrugName',x00180035:'InterventionDrugStartTime',x00180036:'InterventionSequence',x00180037:'TherapyType',x00180038:'InterventionStatus',x00180039:'TherapyDescription',x0018003a:'InterventionDescription',x00180040:'CineRate',x00180042:'InitialCineRunState',x00180050:'SliceThickness',x00180060:'KVP',x00180070:'CountsAccumulated',x00180071:'AcquisitionTerminationCondition',x00180072:'EffectiveDuration',x00180073:'AcquisitionStartCondition',x00180074:'AcquisitionStartConditionData',x00180075:'AcquisitionEndConditionData',x00180080:'RepetitionTime',x00180081:'EchoTime',x00180082:'InversionTime',x00180083:'NumberOfAverages',x00180084:'ImagingFrequency',x00180085:'ImagedNucleus',x00180086:'EchoNumber',x00180087:'MagneticFieldStrength',x00180088:'SpacingBetweenSlices',x00180089:'NumberOfPhaseEncodingSteps',x00180090:'DataCollectionDiameter',x00180091:'EchoTrainLength',x00180093:'PercentSampling',x00180094:'PercentPhaseFieldOfView',x00180095:'PixelBandwidth',x00181000:'DeviceSerialNumber',x00181002:'DeviceUID',x00181003:'DeviceID',x00181004:'PlateID',x00181005:'GeneratorID',x00181006:'GridID',x00181007:'CassetteID',x00181008:'GantryID',x00181010:'SecondaryCaptureDeviceID',x00181011:'HardcopyCreationDeviceID',x00181012:'DateOfSecondaryCapture',x00181014:'TimeOfSecondaryCapture',x00181016:'SecondaryCaptureDeviceManufacturer',x00181017:'HardcopyDeviceManufacturer',x00181018:'SecondaryCaptureDeviceModelName',x00181019:'SecondaryCaptureDeviceSoftwareVers',x0018101a:'HardcopyDeviceSoftwareVersion',x0018101b:'HardcopyDeviceModelName',x00181020:'SoftwareVersion',x00181022:'VideoImageFormatAcquired',x00181023:'DigitalImageFormatAcquired',x00181030:'ProtocolName',x00181040:'ContrastBolusRoute',x00181041:'ContrastBolusVolume',x00181042:'ContrastBolusStartTime',x00181043:'ContrastBolusStopTime',x00181044:'ContrastBolusTotalDose',x00181045:'SyringeCounts',x00181046:'ContrastFlowRate',x00181047:'ContrastFlowDuration',x00181048:'ContrastBolusIngredient',x00181049:'ContrastBolusConcentration',x00181050:'SpatialResolution',x00181060:'TriggerTime',x00181061:'TriggerSourceOrType',x00181062:'NominalInterval',x00181063:'FrameTime',x00181064:'CardiacFramingType',x00181065:'FrameTimeVector',x00181066:'FrameDelay',x00181067:'ImageTriggerDelay',x00181068:'MultiplexGroupTimeOffset',x00181069:'TriggerTimeOffset',x0018106a:'SynchronizationTrigger',x0018106c:'SynchronizationChannel',x0018106e:'TriggerSamplePosition',x00181070:'RadiopharmaceuticalRoute',x00181071:'RadiopharmaceuticalVolume',x00181072:'RadiopharmaceuticalStartTime',x00181073:'RadiopharmaceuticalStopTime',x00181074:'RadionuclideTotalDose',x00181075:'RadionuclideHalfLife',x00181076:'RadionuclidePositronFraction',x00181077:'RadiopharmaceuticalSpecActivity',x00181078:'RadiopharmaceuticalStartDateTime',x00181079:'RadiopharmaceuticalStopDateTime',x00181080:'BeatRejectionFlag',x00181081:'LowRRValue',x00181082:'HighRRValue',x00181083:'IntervalsAcquired',x00181084:'IntervalsRejected',x00181085:'PVCRejection',x00181086:'SkipBeats',x00181088:'HeartRate',x00181090:'CardiacNumberOfImages',x00181094:'TriggerWindow',x00181100:'ReconstructionDiameter',x00181110:'DistanceSourceToDetector',x00181111:'DistanceSourceToPatient',x00181114:'EstimatedRadiographicMagnification',x00181120:'GantryDetectorTilt',x00181121:'GantryDetectorSlew',x00181130:'TableHeight',x00181131:'TableTraverse',x00181134:'TableMotion',x00181135:'TableVerticalIncrement',x00181136:'TableLateralIncrement',x00181137:'TableLongitudinalIncrement',x00181138:'TableAngle',x0018113a:'TableType',x00181140:'RotationDirection',x00181141:'AngularPosition',x00181142:'RadialPosition',x00181143:'ScanArc',x00181144:'AngularStep',x00181145:'CenterOfRotationOffset',x00181146:'RotationOffset',x00181147:'FieldOfViewShape',x00181149:'FieldOfViewDimensions',x00181150:'ExposureTime',x00181151:'XRayTubeCurrent',x00181152:'Exposure',x00181153:'ExposureInMicroAmpSec',x00181154:'AveragePulseWidth',x00181155:'RadiationSetting',x00181156:'RectificationType',x0018115a:'RadiationMode',x0018115e:'ImageAreaDoseProduct',x00181160:'FilterType',x00181161:'TypeOfFilters',x00181162:'IntensifierSize',x00181164:'ImagerPixelSpacing',x00181166:'Grid',x00181170:'GeneratorPower',x00181180:'CollimatorGridName',x00181181:'CollimatorType',x00181182:'FocalDistance',x00181183:'XFocusCenter',x00181184:'YFocusCenter',x00181190:'FocalSpots',x00181191:'AnodeTargetMaterial',x001811a0:'BodyPartThickness',x001811a2:'CompressionForce',x00181200:'DateOfLastCalibration',x00181201:'TimeOfLastCalibration',x00181210:'ConvolutionKernel',x00181240:'UpperLowerPixelValues',x00181242:'ActualFrameDuration',x00181243:'CountRate',x00181244:'PreferredPlaybackSequencing',x00181250:'ReceiveCoilName',x00181251:'TransmitCoilName',x00181260:'PlateType',x00181261:'PhosphorType',x00181300:'ScanVelocity',x00181301:'WholeBodyTechnique',x00181302:'ScanLength',x00181310:'AcquisitionMatrix',x00181312:'InPlanePhaseEncodingDirection',x00181314:'FlipAngle',x00181315:'VariableFlipAngleFlag',x00181316:'SAR',x00181318:'DB-Dt',x00181400:'AcquisitionDeviceProcessingDescr',x00181401:'AcquisitionDeviceProcessingCode',x00181402:'CassetteOrientation',x00181403:'CassetteSize',x00181404:'ExposuresOnPlate',x00181405:'RelativeXRayExposure',x00181450:'ColumnAngulation',x00181460:'TomoLayerHeight',x00181470:'TomoAngle',x00181480:'TomoTime',x00181490:'TomoType',x00181491:'TomoClass',x00181495:'NumberOfTomosynthesisSourceImages',x00181500:'PositionerMotion',x00181508:'PositionerType',x00181510:'PositionerPrimaryAngle',x00181511:'PositionerSecondaryAngle',x00181520:'PositionerPrimaryAngleIncrement',x00181521:'PositionerSecondaryAngleIncrement',x00181530:'DetectorPrimaryAngle',x00181531:'DetectorSecondaryAngle',x00181600:'ShutterShape',x00181602:'ShutterLeftVerticalEdge',x00181604:'ShutterRightVerticalEdge',x00181606:'ShutterUpperHorizontalEdge',x00181608:'ShutterLowerHorizontalEdge',x00181610:'CenterOfCircularShutter',x00181612:'RadiusOfCircularShutter',x00181620:'VerticesOfPolygonalShutter',x00181622:'ShutterPresentationValue',x00181623:'ShutterOverlayGroup',x00181624:'ShutterPresentationColorCIELabVal',x00181700:'CollimatorShape',x00181702:'CollimatorLeftVerticalEdge',x00181704:'CollimatorRightVerticalEdge',x00181706:'CollimatorUpperHorizontalEdge',x00181708:'CollimatorLowerHorizontalEdge',x00181710:'CenterOfCircularCollimator',x00181712:'RadiusOfCircularCollimator',x00181720:'VerticesOfPolygonalCollimator',x00181800:'AcquisitionTimeSynchronized',x00181801:'TimeSource',x00181802:'TimeDistributionProtocol',x00181803:'NTPSourceAddress',x00182001:'PageNumberVector',x00182002:'FrameLabelVector',x00182003:'FramePrimaryAngleVector',x00182004:'FrameSecondaryAngleVector',x00182005:'SliceLocationVector',x00182006:'DisplayWindowLabelVector',x00182010:'NominalScannedPixelSpacing',x00182020:'DigitizingDeviceTransportDirection',x00182030:'RotationOfScannedFilm',x00183100:'IVUSAcquisition',x00183101:'IVUSPullbackRate',x00183102:'IVUSGatedRate',x00183103:'IVUSPullbackStartFrameNumber',x00183104:'IVUSPullbackStopFrameNumber',x00183105:'LesionNumber',x00184000:'AcquisitionComments',x00185000:'OutputPower',x00185010:'TransducerData',x00185012:'FocusDepth',x00185020:'ProcessingFunction',x00185021:'PostprocessingFunction',x00185022:'MechanicalIndex',x00185024:'BoneThermalIndex',x00185026:'CranialThermalIndex',x00185027:'SoftTissueThermalIndex',x00185028:'SoftTissueFocusThermalIndex',x00185029:'SoftTissueSurfaceThermalIndex',x00185030:'DynamicRange',x00185040:'TotalGain',x00185050:'DepthOfScanField',x00185100:'PatientPosition',x00185101:'ViewPosition',x00185104:'ProjectionEponymousNameCodeSeq',x00185210:'ImageTransformationMatrix',x00185212:'ImageTranslationVector',x00186000:'Sensitivity',x00186011:'SequenceOfUltrasoundRegions',x00186012:'RegionSpatialFormat',x00186014:'RegionDataType',x00186016:'RegionFlags',x00186018:'RegionLocationMinX0',x0018601a:'RegionLocationMinY0',x0018601c:'RegionLocationMaxX1',x0018601e:'RegionLocationMaxY1',x00186020:'ReferencePixelX0',x00186022:'ReferencePixelY0',x00186024:'PhysicalUnitsXDirection',x00186026:'PhysicalUnitsYDirection',x00186028:'ReferencePixelPhysicalValueX',x0018602a:'ReferencePixelPhysicalValueY',x0018602c:'PhysicalDeltaX',x0018602e:'PhysicalDeltaY',x00186030:'TransducerFrequency',x00186031:'TransducerType',x00186032:'PulseRepetitionFrequency',x00186034:'DopplerCorrectionAngle',x00186036:'SteeringAngle',x00186038:'DopplerSampleVolumeXPosRetired',x00186039:'DopplerSampleVolumeXPosition',x0018603a:'DopplerSampleVolumeYPosRetired',x0018603b:'DopplerSampleVolumeYPosition',x0018603c:'TMLinePositionX0Retired',x0018603d:'TMLinePositionX0',x0018603e:'TMLinePositionY0Retired',x0018603f:'TMLinePositionY0',x00186040:'TMLinePositionX1Retired',x00186041:'TMLinePositionX1',x00186042:'TMLinePositionY1Retired',x00186043:'TMLinePositionY1',x00186044:'PixelComponentOrganization',x00186046:'PixelComponentMask',x00186048:'PixelComponentRangeStart',x0018604a:'PixelComponentRangeStop',x0018604c:'PixelComponentPhysicalUnits',x0018604e:'PixelComponentDataType',x00186050:'NumberOfTableBreakPoints',x00186052:'TableOfXBreakPoints',x00186054:'TableOfYBreakPoints',x00186056:'NumberOfTableEntries',x00186058:'TableOfPixelValues',x0018605a:'TableOfParameterValues',x00186060:'RWaveTimeVector',x00187000:'DetectorConditionsNominalFlag',x00187001:'DetectorTemperature',x00187004:'DetectorType',x00187005:'DetectorConfiguration',x00187006:'DetectorDescription',x00187008:'DetectorMode',x0018700a:'DetectorID',x0018700c:'DateOfLastDetectorCalibration',x0018700e:'TimeOfLastDetectorCalibration',x00187010:'DetectorExposuresSinceCalibration',x00187011:'DetectorExposuresSinceManufactured',x00187012:'DetectorTimeSinceLastExposure',x00187014:'DetectorActiveTime',x00187016:'DetectorActiveOffsetFromExposure',x0018701a:'DetectorBinning',x00187020:'DetectorElementPhysicalSize',x00187022:'DetectorElementSpacing',x00187024:'DetectorActiveShape',x00187026:'DetectorActiveDimensions',x00187028:'DetectorActiveOrigin',x0018702a:'DetectorManufacturerName',x0018702b:'DetectorManufacturersModelName',x00187030:'FieldOfViewOrigin',x00187032:'FieldOfViewRotation',x00187034:'FieldOfViewHorizontalFlip',x00187040:'GridAbsorbingMaterial',x00187041:'GridSpacingMaterial',x00187042:'GridThickness',x00187044:'GridPitch',x00187046:'GridAspectRatio',x00187048:'GridPeriod',x0018704c:'GridFocalDistance',x00187050:'FilterMaterial',x00187052:'FilterThicknessMinimum',x00187054:'FilterThicknessMaximum',x00187060:'ExposureControlMode',x00187062:'ExposureControlModeDescription',x00187064:'ExposureStatus',x00187065:'PhototimerSetting',x00188150:'ExposureTimeInMicroSec',x00188151:'XRayTubeCurrentInMicroAmps',x00189004:'ContentQualification',x00189005:'PulseSequenceName',x00189006:'MRImagingModifierSequence',x00189008:'EchoPulseSequence',x00189009:'InversionRecovery',x00189010:'FlowCompensation',x00189011:'MultipleSpinEcho',x00189012:'MultiPlanarExcitation',x00189014:'PhaseContrast',x00189015:'TimeOfFlightContrast',x00189016:'Spoiling',x00189017:'SteadyStatePulseSequence',x00189018:'EchoPlanarPulseSequence',x00189019:'TagAngleFirstAxis',x00189020:'MagnetizationTransfer',x00189021:'T2Preparation',x00189022:'BloodSignalNulling',x00189024:'SaturationRecovery',x00189025:'SpectrallySelectedSuppression',x00189026:'SpectrallySelectedExcitation',x00189027:'SpatialPresaturation',x00189028:'Tagging',x00189029:'OversamplingPhase',x00189030:'TagSpacingFirstDimension',x00189032:'GeometryOfKSpaceTraversal',x00189033:'SegmentedKSpaceTraversal',x00189034:'RectilinearPhaseEncodeReordering',x00189035:'TagThickness',x00189036:'PartialFourierDirection',x00189037:'CardiacSynchronizationTechnique',x00189041:'ReceiveCoilManufacturerName',x00189042:'MRReceiveCoilSequence',x00189043:'ReceiveCoilType',x00189044:'QuadratureReceiveCoil',x00189045:'MultiCoilDefinitionSequence',x00189046:'MultiCoilConfiguration',x00189047:'MultiCoilElementName',x00189048:'MultiCoilElementUsed',x00189049:'MRTransmitCoilSequence',x00189050:'TransmitCoilManufacturerName',x00189051:'TransmitCoilType',x00189052:'SpectralWidth',x00189053:'ChemicalShiftReference',x00189054:'VolumeLocalizationTechnique',x00189058:'MRAcquisitionFrequencyEncodeSteps',x00189059:'Decoupling',x00189060:'DecoupledNucleus',x00189061:'DecouplingFrequency',x00189062:'DecouplingMethod',x00189063:'DecouplingChemicalShiftReference',x00189064:'KSpaceFiltering',x00189065:'TimeDomainFiltering',x00189066:'NumberOfZeroFills',x00189067:'BaselineCorrection',x00189069:'ParallelReductionFactorInPlane',x00189070:'CardiacRRIntervalSpecified',x00189073:'AcquisitionDuration',x00189074:'FrameAcquisitionDateTime',x00189075:'DiffusionDirectionality',x00189076:'DiffusionGradientDirectionSequence',x00189077:'ParallelAcquisition',x00189078:'ParallelAcquisitionTechnique',x00189079:'InversionTimes',x00189080:'MetaboliteMapDescription',x00189081:'PartialFourier',x00189082:'EffectiveEchoTime',x00189083:'MetaboliteMapCodeSequence',x00189084:'ChemicalShiftSequence',x00189085:'CardiacSignalSource',x00189087:'DiffusionBValue',x00189089:'DiffusionGradientOrientation',x00189090:'VelocityEncodingDirection',x00189091:'VelocityEncodingMinimumValue',x00189093:'NumberOfKSpaceTrajectories',x00189094:'CoverageOfKSpace',x00189095:'SpectroscopyAcquisitionPhaseRows',x00189096:'ParallelReductFactorInPlaneRetired',x00189098:'TransmitterFrequency',x00189100:'ResonantNucleus',x00189101:'FrequencyCorrection',x00189103:'MRSpectroscopyFOV-GeometrySequence',x00189104:'SlabThickness',x00189105:'SlabOrientation',x00189106:'MidSlabPosition',x00189107:'MRSpatialSaturationSequence',x00189112:'MRTimingAndRelatedParametersSeq',x00189114:'MREchoSequence',x00189115:'MRModifierSequence',x00189117:'MRDiffusionSequence',x00189118:'CardiacTriggerSequence',x00189119:'MRAveragesSequence',x00189125:'MRFOV-GeometrySequence',x00189126:'VolumeLocalizationSequence',x00189127:'SpectroscopyAcquisitionDataColumns',x00189147:'DiffusionAnisotropyType',x00189151:'FrameReferenceDateTime',x00189152:'MRMetaboliteMapSequence',x00189155:'ParallelReductionFactorOutOfPlane',x00189159:'SpectroscopyOutOfPlanePhaseSteps',x00189166:'BulkMotionStatus',x00189168:'ParallelReductionFactSecondInPlane',x00189169:'CardiacBeatRejectionTechnique',x00189170:'RespiratoryMotionCompTechnique',x00189171:'RespiratorySignalSource',x00189172:'BulkMotionCompensationTechnique',x00189173:'BulkMotionSignalSource',x00189174:'ApplicableSafetyStandardAgency',x00189175:'ApplicableSafetyStandardDescr',x00189176:'OperatingModeSequence',x00189177:'OperatingModeType',x00189178:'OperatingMode',x00189179:'SpecificAbsorptionRateDefinition',x00189180:'GradientOutputType',x00189181:'SpecificAbsorptionRateValue',x00189182:'GradientOutput',x00189183:'FlowCompensationDirection',x00189184:'TaggingDelay',x00189185:'RespiratoryMotionCompTechDescr',x00189186:'RespiratorySignalSourceID',x00189195:'ChemicalShiftsMinIntegrateLimitHz',x00189196:'ChemicalShiftsMaxIntegrateLimitHz',x00189197:'MRVelocityEncodingSequence',x00189198:'FirstOrderPhaseCorrection',x00189199:'WaterReferencedPhaseCorrection',x00189200:'MRSpectroscopyAcquisitionType',x00189214:'RespiratoryCyclePosition',x00189217:'VelocityEncodingMaximumValue',x00189218:'TagSpacingSecondDimension',x00189219:'TagAngleSecondAxis',x00189220:'FrameAcquisitionDuration',x00189226:'MRImageFrameTypeSequence',x00189227:'MRSpectroscopyFrameTypeSequence',x00189231:'MRAcqPhaseEncodingStepsInPlane',x00189232:'MRAcqPhaseEncodingStepsOutOfPlane',x00189234:'SpectroscopyAcqPhaseColumns',x00189236:'CardiacCyclePosition',x00189239:'SpecificAbsorptionRateSequence',x00189240:'RFEchoTrainLength',x00189241:'GradientEchoTrainLength',x00189295:'ChemicalShiftsMinIntegrateLimitPPM',x00189296:'ChemicalShiftsMaxIntegrateLimitPPM',x00189301:'CTAcquisitionTypeSequence',x00189302:'AcquisitionType',x00189303:'TubeAngle',x00189304:'CTAcquisitionDetailsSequence',x00189305:'RevolutionTime',x00189306:'SingleCollimationWidth',x00189307:'TotalCollimationWidth',x00189308:'CTTableDynamicsSequence',x00189309:'TableSpeed',x00189310:'TableFeedPerRotation',x00189311:'SpiralPitchFactor',x00189312:'CTGeometrySequence',x00189313:'DataCollectionCenterPatient',x00189314:'CTReconstructionSequence',x00189315:'ReconstructionAlgorithm',x00189316:'ConvolutionKernelGroup',x00189317:'ReconstructionFieldOfView',x00189318:'ReconstructionTargetCenterPatient',x00189319:'ReconstructionAngle',x00189320:'ImageFilter',x00189321:'CTExposureSequence',x00189322:'ReconstructionPixelSpacing',x00189323:'ExposureModulationType',x00189324:'EstimatedDoseSaving',x00189325:'CTXRayDetailsSequence',x00189326:'CTPositionSequence',x00189327:'TablePosition',x00189328:'ExposureTimeInMilliSec',x00189329:'CTImageFrameTypeSequence',x00189330:'XRayTubeCurrentInMilliAmps',x00189332:'ExposureInMilliAmpSec',x00189333:'ConstantVolumeFlag',x00189334:'FluoroscopyFlag',x00189335:'SourceToDataCollectionCenterDist',x00189337:'ContrastBolusAgentNumber',x00189338:'ContrastBolusIngredientCodeSeq',x00189340:'ContrastAdministrationProfileSeq',x00189341:'ContrastBolusUsageSequence',x00189342:'ContrastBolusAgentAdministered',x00189343:'ContrastBolusAgentDetected',x00189344:'ContrastBolusAgentPhase',x00189345:'CTDIvol',x00189346:'CTDIPhantomTypeCodeSequence',x00189351:'CalciumScoringMassFactorPatient',x00189352:'CalciumScoringMassFactorDevice',x00189353:'EnergyWeightingFactor',x00189360:'CTAdditionalXRaySourceSequence',x00189401:'ProjectionPixelCalibrationSequence',x00189402:'DistanceSourceToIsocenter',x00189403:'DistanceObjectToTableTop',x00189404:'ObjectPixelSpacingInCenterOfBeam',x00189405:'PositionerPositionSequence',x00189406:'TablePositionSequence',x00189407:'CollimatorShapeSequence',x00189412:'XA-XRFFrameCharacteristicsSequence',x00189417:'FrameAcquisitionSequence',x00189420:'XRayReceptorType',x00189423:'AcquisitionProtocolName',x00189424:'AcquisitionProtocolDescription',x00189425:'ContrastBolusIngredientOpaque',x00189426:'DistanceReceptorPlaneToDetHousing',x00189427:'IntensifierActiveShape',x00189428:'IntensifierActiveDimensions',x00189429:'PhysicalDetectorSize',x00189430:'PositionOfIsocenterProjection',x00189432:'FieldOfViewSequence',x00189433:'FieldOfViewDescription',x00189434:'ExposureControlSensingRegionsSeq',x00189435:'ExposureControlSensingRegionShape',x00189436:'ExposureControlSensRegionLeftEdge',x00189437:'ExposureControlSensRegionRightEdge',x00189440:'CenterOfCircExposControlSensRegion',x00189441:'RadiusOfCircExposControlSensRegion',x00189447:'ColumnAngulationPatient',x00189449:'BeamAngle',x00189451:'FrameDetectorParametersSequence',x00189452:'CalculatedAnatomyThickness',x00189455:'CalibrationSequence',x00189456:'ObjectThicknessSequence',x00189457:'PlaneIdentification',x00189461:'FieldOfViewDimensionsInFloat',x00189462:'IsocenterReferenceSystemSequence',x00189463:'PositionerIsocenterPrimaryAngle',x00189464:'PositionerIsocenterSecondaryAngle',x00189465:'PositionerIsocenterDetRotAngle',x00189466:'TableXPositionToIsocenter',x00189467:'TableYPositionToIsocenter',x00189468:'TableZPositionToIsocenter',x00189469:'TableHorizontalRotationAngle',x00189470:'TableHeadTiltAngle',x00189471:'TableCradleTiltAngle',x00189472:'FrameDisplayShutterSequence',x00189473:'AcquiredImageAreaDoseProduct',x00189474:'CArmPositionerTabletopRelationship',x00189476:'XRayGeometrySequence',x00189477:'IrradiationEventIDSequence',x00189504:'XRay3DFrameTypeSequence',x00189506:'ContributingSourcesSequence',x00189507:'XRay3DAcquisitionSequence',x00189508:'PrimaryPositionerScanArc',x00189509:'SecondaryPositionerScanArc',x00189510:'PrimaryPositionerScanStartAngle',x00189511:'SecondaryPositionerScanStartAngle',x00189514:'PrimaryPositionerIncrement',x00189515:'SecondaryPositionerIncrement',x00189516:'StartAcquisitionDateTime',x00189517:'EndAcquisitionDateTime',x00189524:'ApplicationName',x00189525:'ApplicationVersion',x00189526:'ApplicationManufacturer',x00189527:'AlgorithmType',x00189528:'AlgorithmDescription',x00189530:'XRay3DReconstructionSequence',x00189531:'ReconstructionDescription',x00189538:'PerProjectionAcquisitionSequence',x00189601:'DiffusionBMatrixSequence',x00189602:'DiffusionBValueXX',x00189603:'DiffusionBValueXY',x00189604:'DiffusionBValueXZ',x00189605:'DiffusionBValueYY',x00189606:'DiffusionBValueYZ',x00189607:'DiffusionBValueZZ',x00189701:'DecayCorrectionDateTime',x00189715:'StartDensityThreshold',x00189722:'TerminationTimeThreshold',x00189725:'DetectorGeometry',x00189727:'AxialDetectorDimension',x00189735:'PETPositionSequence',x00189739:'NumberOfIterations',x00189740:'NumberOfSubsets',x00189751:'PETFrameTypeSequence',x00189756:'ReconstructionType',x00189758:'DecayCorrected',x00189759:'AttenuationCorrected',x00189760:'ScatterCorrected',x00189761:'DeadTimeCorrected',x00189762:'GantryMotionCorrected',x00189763:'PatientMotionCorrected',x00189765:'RandomsCorrected',x00189767:'SensitivityCalibrated',x00189801:'DepthsOfFocus',x00189804:'ExclusionStartDatetime',x00189805:'ExclusionDuration',x00189807:'ImageDataTypeSequence',x00189808:'DataType',x0018980b:'AliasedDataType',x0018a001:'ContributingEquipmentSequence',x0018a002:'ContributionDateTime',x0018a003:'ContributionDescription',// x00191002: 'NumberOfCellsIInDetector',
  // x00191003: 'CellNumberAtTheta',
  // x00191004: 'CellSpacing',
  // x0019100f: 'HorizFrameOfRef',
  // x00191011: 'SeriesContrast',
  // x00191012: 'LastPseq',
  // x00191013: 'StartNumberForBaseline',
  // x00191014: 'EndNumberForBaseline',
  // x00191015: 'StartNumberForEnhancedScans',
  // x00191016: 'EndNumberForEnhancedScans',
  // x00191017: 'SeriesPlane',
  // x00191018: 'FirstScanRas',
  // x00191019: 'FirstScanLocation',
  // x0019101a: 'LastScanRas',
  // x0019101b: 'LastScanLoc',
  // x0019101e: 'DisplayFieldOfView',
  // x00191023: 'TableSpeed',
  // x00191024: 'MidScanTime',
  // x00191025: 'MidScanFlag',
  // x00191026: 'DegreesOfAzimuth',
  // x00191027: 'GantryPeriod',
  // x0019102a: 'XRayOnPosition',
  // x0019102b: 'XRayOffPosition',
  // x0019102c: 'NumberOfTriggers',
  // x0019102e: 'AngleOfFirstView',
  // x0019102f: 'TriggerFrequency',
  // x00191039: 'ScanFOVType',
  // x00191040: 'StatReconFlag',
  // x00191041: 'ComputeType',
  // x00191042: 'SegmentNumber',
  // x00191043: 'TotalSegmentsRequested',
  // x00191044: 'InterscanDelay',
  // x00191047: 'ViewCompressionFactor',
  // x0019104a: 'TotalNoOfRefChannels',
  // x0019104b: 'DataSizeForScanData',
  // x00191052: 'ReconPostProcflag',
  // x00191057: 'CTWaterNumber',
  // x00191058: 'CTBoneNumber',
  // x0019105a: 'AcquisitionDuration',
  // x0019105e: 'NumberOfChannels',
  // x0019105f: 'IncrementBetweenChannels',
  // x00191060: 'StartingView',
  // x00191061: 'NumberOfViews',
  // x00191062: 'IncrementBetweenViews',
  // x0019106a: 'DependantOnNoViewsProcessed',
  // x0019106b: 'FieldOfViewInDetectorCells',
  // x00191070: 'ValueOfBackProjectionButton',
  // x00191071: 'SetIfFatqEstimatesWereUsed',
  // x00191072: 'ZChanAvgOverViews',
  // x00191073: 'AvgOfLeftRefChansOverViews',
  // x00191074: 'MaxLeftChanOverViews',
  // x00191075: 'AvgOfRightRefChansOverViews',
  // x00191076: 'MaxRightChanOverViews',
  // x0019107d: 'SecondEcho',
  // x0019107e: 'NumberOfEchoes',
  // x0019107f: 'TableDelta',
  // x00191081: 'Contiguous',
  // x00191084: 'PeakSAR',
  // x00191085: 'MonitorSAR',
  // x00191087: 'CardiacRepetitionTime',
  // x00191088: 'ImagesPerCardiacCycle',
  // x0019108a: 'ActualReceiveGainAnalog',
  // x0019108b: 'ActualReceiveGainDigital',
  // x0019108d: 'DelayAfterTrigger',
  // x0019108f: 'Swappf',
  // x00191090: 'PauseInterval',
  // x00191091: 'PulseTime',
  // x00191092: 'SliceOffsetOnFreqAxis',
  // x00191093: 'CenterFrequency',
  // x00191094: 'TransmitGain',
  // x00191095: 'AnalogReceiverGain',
  // x00191096: 'DigitalReceiverGain',
  // x00191097: 'BitmapDefiningCVs',
  // x00191098: 'CenterFreqMethod',
  // x0019109b: 'PulseSeqMode',
  // x0019109c: 'PulseSeqName',
  // x0019109d: 'PulseSeqDate',
  // x0019109e: 'InternalPulseSeqName',
  // x0019109f: 'TransmittingCoil',
  // x001910a0: 'SurfaceCoilType',
  // x001910a1: 'ExtremityCoilFlag',
  // x001910a2: 'RawDataRunNumber',
  // x001910a3: 'CalibratedFieldStrength',
  // x001910a4: 'SATFatWaterBone',
  // x001910a5: 'ReceiveBandwidth',
  // x001910a7: 'UserData01',
  // x001910a8: 'UserData02',
  // x001910a9: 'UserData03',
  // x001910aa: 'UserData04',
  // x001910ab: 'UserData05',
  // x001910ac: 'UserData06',
  // x001910ad: 'UserData07',
  // x001910ae: 'UserData08',
  // x001910af: 'UserData09',
  // x001910b0: 'UserData10',
  // x001910b1: 'UserData11',
  // x001910b2: 'UserData12',
  // x001910b3: 'UserData13',
  // x001910b4: 'UserData14',
  // x001910b5: 'UserData15',
  // x001910b6: 'UserData16',
  // x001910b7: 'UserData17',
  // x001910b8: 'UserData18',
  // x001910b9: 'UserData19',
  // x001910ba: 'UserData20',
  // x001910bb: 'UserData21',
  // x001910bc: 'UserData22',
  // x001910bd: 'UserData23',
  // x001910be: 'ProjectionAngle',
  // x001910c0: 'SaturationPlanes',
  // x001910c1: 'SurfaceCoilIntensity',
  // x001910c2: 'SATLocationR',
  // x001910c3: 'SATLocationL',
  // x001910c4: 'SATLocationA',
  // x001910c5: 'SATLocationP',
  // x001910c6: 'SATLocationH',
  // x001910c7: 'SATLocationF',
  // x001910c8: 'SATThicknessR-L',
  // x001910c9: 'SATThicknessA-P',
  // x001910ca: 'SATThicknessH-F',
  // x001910cb: 'PrescribedFlowAxis',
  // x001910cc: 'VelocityEncoding',
  // x001910cd: 'ThicknessDisclaimer',
  // x001910ce: 'PrescanType',
  // x001910cf: 'PrescanStatus',
  // x001910d0: 'RawDataType',
  // x001910d2: 'ProjectionAlgorithm',
  // x001910d3: 'ProjectionAlgorithm',
  // x001910d5: 'FractionalEcho',
  // x001910d6: 'PrepPulse',
  // x001910d7: 'CardiacPhases',
  // x001910d8: 'VariableEchoflag',
  // x001910d9: 'ConcatenatedSAT',
  // x001910da: 'ReferenceChannelUsed',
  // x001910db: 'BackProjectorCoefficient',
  // x001910dc: 'PrimarySpeedCorrectionUsed',
  // x001910dd: 'OverrangeCorrectionUsed',
  // x001910de: 'DynamicZAlphaValue',
  // x001910df: 'UserData',
  // x001910e0: 'UserData',
  // x001910e2: 'VelocityEncodeScale',
  // x001910f2: 'FastPhases',
  // x001910f9: 'TransmissionGain',
  x00200000:'RelationshipGroupLength',x0020000d:'StudyInstanceUID',x0020000e:'SeriesInstanceUID',x00200010:'StudyID',x00200011:'SeriesNumber',x00200012:'AcquisitionNumber',x00200013:'InstanceNumber',x00200014:'IsotopeNumber',x00200015:'PhaseNumber',x00200016:'IntervalNumber',x00200017:'TimeSlotNumber',x00200018:'AngleNumber',x00200019:'ItemNumber',x00200020:'PatientOrientation',x00200022:'OverlayNumber',x00200024:'CurveNumber',x00200026:'LookupTableNumber',x00200030:'ImagePosition',x00200032:'ImagePositionPatient',x00200035:'ImageOrientation',x00200037:'ImageOrientationPatient',x00200050:'Location',x00200052:'FrameOfReferenceUID',x00200060:'Laterality',x00200062:'ImageLaterality',x00200070:'ImageGeometryType',x00200080:'MaskingImage',x00200100:'TemporalPositionIdentifier',x00200105:'NumberOfTemporalPositions',x00200110:'TemporalResolution',x00200200:'SynchronizationFrameOfReferenceUID',x00201000:'SeriesInStudy',x00201001:'AcquisitionsInSeries',x00201002:'ImagesInAcquisition',x00201003:'ImagesInSeries',x00201004:'AcquisitionsInStudy',x00201005:'ImagesInStudy',x00201020:'Reference',x00201040:'PositionReferenceIndicator',x00201041:'SliceLocation',x00201070:'OtherStudyNumbers',x00201200:'NumberOfPatientRelatedStudies',x00201202:'NumberOfPatientRelatedSeries',x00201204:'NumberOfPatientRelatedInstances',x00201206:'NumberOfStudyRelatedSeries',x00201208:'NumberOfStudyRelatedInstances',x00201209:'NumberOfSeriesRelatedInstances',x002031xx:'SourceImageIDs',x00203401:'ModifyingDeviceID',x00203402:'ModifiedImageID',x00203403:'ModifiedImageDate',x00203404:'ModifyingDeviceManufacturer',x00203405:'ModifiedImageTime',x00203406:'ModifiedImageDescription',x00204000:'ImageComments',x00205000:'OriginalImageIdentification',x00205002:'OriginalImageIdentNomenclature',x00209056:'StackID',x00209057:'InStackPositionNumber',x00209071:'FrameAnatomySequence',x00209072:'FrameLaterality',x00209111:'FrameContentSequence',x00209113:'PlanePositionSequence',x00209116:'PlaneOrientationSequence',x00209128:'TemporalPositionIndex',x00209153:'TriggerDelayTime',x00209156:'FrameAcquisitionNumber',x00209157:'DimensionIndexValues',x00209158:'FrameComments',x00209161:'ConcatenationUID',x00209162:'InConcatenationNumber',x00209163:'InConcatenationTotalNumber',x00209164:'DimensionOrganizationUID',x00209165:'DimensionIndexPointer',x00209167:'FunctionalGroupPointer',x00209213:'DimensionIndexPrivateCreator',x00209221:'DimensionOrganizationSequence',x00209222:'DimensionIndexSequence',x00209228:'ConcatenationFrameOffsetNumber',x00209238:'FunctionalGroupPrivateCreator',x00209241:'NominalPercentageOfCardiacPhase',x00209245:'NominalPercentOfRespiratoryPhase',x00209246:'StartingRespiratoryAmplitude',x00209247:'StartingRespiratoryPhase',x00209248:'EndingRespiratoryAmplitude',x00209249:'EndingRespiratoryPhase',x00209250:'RespiratoryTriggerType',x00209251:'RRIntervalTimeNominal',x00209252:'ActualCardiacTriggerDelayTime',x00209253:'RespiratorySynchronizationSequence',x00209254:'RespiratoryIntervalTime',x00209255:'NominalRespiratoryTriggerDelayTime',x00209256:'RespiratoryTriggerDelayThreshold',x00209257:'ActualRespiratoryTriggerDelayTime',x00209301:'ImagePositionVolume',x00209302:'ImageOrientationVolume',x00209308:'ApexPosition',x00209421:'DimensionDescriptionLabel',x00209450:'PatientOrientationInFrameSequence',x00209453:'FrameLabel',x00209518:'AcquisitionIndex',x00209529:'ContributingSOPInstancesRefSeq',x00209536:'ReconstructionIndex',// x00211003: 'SeriesFromWhichPrescribed',
  // x00211005: 'GenesisVersionNow',
  // x00211007: 'SeriesRecordChecksum',
  // x00211018: 'GenesisVersionNow',
  // x00211019: 'AcqreconRecordChecksum',
  // x00211020: 'TableStartLocation',
  // x00211035: 'SeriesFromWhichPrescribed',
  // x00211036: 'ImageFromWhichPrescribed',
  // x00211037: 'ScreenFormat',
  // x0021104a: 'AnatomicalReferenceForScout',
  // x0021104f: 'LocationsInAcquisition',
  // x00211050: 'GraphicallyPrescribed',
  // x00211051: 'RotationFromSourceXRot',
  // x00211052: 'RotationFromSourceYRot',
  // x00211053: 'RotationFromSourceZRot',
  // x00211054: 'ImagePosition',
  // x00211055: 'ImageOrientation',
  // x00211056: 'IntegerSlop',
  // x00211057: 'IntegerSlop',
  // x00211058: 'IntegerSlop',
  // x00211059: 'IntegerSlop',
  // x0021105a: 'IntegerSlop',
  // x0021105b: 'FloatSlop',
  // x0021105c: 'FloatSlop',
  // x0021105d: 'FloatSlop',
  // x0021105e: 'FloatSlop',
  // x0021105f: 'FloatSlop',
  // x00211081: 'AutoWindowLevelAlpha',
  // x00211082: 'AutoWindowLevelBeta',
  // x00211083: 'AutoWindowLevelWindow',
  // x00211084: 'ToWindowLevelLevel',
  // x00211090: 'TubeFocalSpotPosition',
  // x00211091: 'BiopsyPosition',
  // x00211092: 'BiopsyTLocation',
  // x00211093: 'BiopsyRefLocation',
  x00220001:'LightPathFilterPassThroughWavelen',x00220002:'LightPathFilterPassBand',x00220003:'ImagePathFilterPassThroughWavelen',x00220004:'ImagePathFilterPassBand',x00220005:'PatientEyeMovementCommanded',x00220006:'PatientEyeMovementCommandCodeSeq',x00220007:'SphericalLensPower',x00220008:'CylinderLensPower',x00220009:'CylinderAxis',x0022000a:'EmmetropicMagnification',x0022000b:'IntraOcularPressure',x0022000c:'HorizontalFieldOfView',x0022000d:'PupilDilated',x0022000e:'DegreeOfDilation',x00220010:'StereoBaselineAngle',x00220011:'StereoBaselineDisplacement',x00220012:'StereoHorizontalPixelOffset',x00220013:'StereoVerticalPixelOffset',x00220014:'StereoRotation',x00220015:'AcquisitionDeviceTypeCodeSequence',x00220016:'IlluminationTypeCodeSequence',x00220017:'LightPathFilterTypeStackCodeSeq',x00220018:'ImagePathFilterTypeStackCodeSeq',x00220019:'LensesCodeSequence',x0022001a:'ChannelDescriptionCodeSequence',x0022001b:'RefractiveStateSequence',x0022001c:'MydriaticAgentCodeSequence',x0022001d:'RelativeImagePositionCodeSequence',x00220020:'StereoPairsSequence',x00220021:'LeftImageSequence',x00220022:'RightImageSequence',x00220030:'AxialLengthOfTheEye',x00220031:'OphthalmicFrameLocationSequence',x00220032:'ReferenceCoordinates',x00220035:'DepthSpatialResolution',x00220036:'MaximumDepthDistortion',x00220037:'AlongScanSpatialResolution',x00220038:'MaximumAlongScanDistortion',x00220039:'OphthalmicImageOrientation',x00220041:'DepthOfTransverseImage',x00220042:'MydriaticAgentConcUnitsSeq',x00220048:'AcrossScanSpatialResolution',x00220049:'MaximumAcrossScanDistortion',x0022004e:'MydriaticAgentConcentration',x00220055:'IlluminationWaveLength',x00220056:'IlluminationPower',x00220057:'IlluminationBandwidth',x00220058:'MydriaticAgentSequence',// x00231001: 'NumberOfSeriesInStudy',
  // x00231002: 'NumberOfUnarchivedSeries',
  // x00231010: 'ReferenceImageField',
  // x00231050: 'SummaryImage',
  // x00231070: 'StartTimeSecsInFirstAxial',
  // x00231074: 'NoofUpdatesToHeader',
  // x0023107d: 'IndicatesIfTheStudyHasCompleteInfo',
  // x00251006: 'LastPulseSequenceUsed',
  // x00251007: 'ImagesInSeries',
  // x00251010: 'LandmarkCounter',
  // x00251011: 'NumberOfAcquisitions',
  // x00251014: 'IndicatesNoofUpdatesToHeader',
  // x00251017: 'SeriesCompleteFlag',
  // x00251018: 'NumberOfImagesArchived',
  // x00251019: 'LastImageNumberUsed',
  // x0025101a: 'PrimaryReceiverSuiteAndHost',
  // x00271006: 'ImageArchiveFlag',
  // x00271010: 'ScoutType',
  // x0027101c: 'VmaMamp',
  // x0027101d: 'VmaPhase',
  // x0027101e: 'VmaMod',
  // x0027101f: 'VmaClip',
  // x00271020: 'SmartScanOnOffFlag',
  // x00271030: 'ForeignImageRevision',
  // x00271031: 'ImagingMode',
  // x00271032: 'PulseSequence',
  // x00271033: 'ImagingOptions',
  // x00271035: 'PlaneType',
  // x00271036: 'ObliquePlane',
  // x00271040: 'RASLetterOfImageLocation',
  // x00271041: 'ImageLocation',
  // x00271042: 'CenterRCoordOfPlaneImage',
  // x00271043: 'CenterACoordOfPlaneImage',
  // x00271044: 'CenterSCoordOfPlaneImage',
  // x00271045: 'NormalRCoord',
  // x00271046: 'NormalACoord',
  // x00271047: 'NormalSCoord',
  // x00271048: 'RCoordOfTopRightCorner',
  // x00271049: 'ACoordOfTopRightCorner',
  // x0027104a: 'SCoordOfTopRightCorner',
  // x0027104b: 'RCoordOfBottomRightCorner',
  // x0027104c: 'ACoordOfBottomRightCorner',
  // x0027104d: 'SCoordOfBottomRightCorner',
  // x00271050: 'TableStartLocation',
  // x00271051: 'TableEndLocation',
  // x00271052: 'RASLetterForSideOfImage',
  // x00271053: 'RASLetterForAnteriorPosterior',
  // x00271054: 'RASLetterForScoutStartLoc',
  // x00271055: 'RASLetterForScoutEndLoc',
  // x00271060: 'ImageDimensionX',
  // x00271061: 'ImageDimensionY',
  // x00271062: 'NumberOfExcitations',
  x00280000:'ImagePresentationGroupLength',x00280002:'SamplesPerPixel',x00280003:'SamplesPerPixelUsed',x00280004:'PhotometricInterpretation',x00280005:'ImageDimensions',x00280006:'PlanarConfiguration',x00280008:'NumberOfFrames',x00280009:'FrameIncrementPointer',x0028000a:'FrameDimensionPointer',x00280010:'Rows',x00280011:'Columns',x00280012:'Planes',x00280014:'UltrasoundColorDataPresent',x00280030:'PixelSpacing',x00280031:'ZoomFactor',x00280032:'ZoomCenter',x00280034:'PixelAspectRatio',x00280040:'ImageFormat',x00280050:'ManipulatedImage',x00280051:'CorrectedImage',x0028005f:'CompressionRecognitionCode',x00280060:'CompressionCode',x00280061:'CompressionOriginator',x00280062:'CompressionLabel',x00280063:'CompressionDescription',x00280065:'CompressionSequence',x00280066:'CompressionStepPointers',x00280068:'RepeatInterval',x00280069:'BitsGrouped',x00280070:'PerimeterTable',x00280071:'PerimeterValue',x00280080:'PredictorRows',x00280081:'PredictorColumns',x00280082:'PredictorConstants',x00280090:'BlockedPixels',x00280091:'BlockRows',x00280092:'BlockColumns',x00280093:'RowOverlap',x00280094:'ColumnOverlap',x00280100:'BitsAllocated',x00280101:'BitsStored',x00280102:'HighBit',x00280103:'PixelRepresentation',x00280104:'SmallestValidPixelValue',x00280105:'LargestValidPixelValue',x00280106:'SmallestImagePixelValue',x00280107:'LargestImagePixelValue',x00280108:'SmallestPixelValueInSeries',x00280109:'LargestPixelValueInSeries',x00280110:'SmallestImagePixelValueInPlane',x00280111:'LargestImagePixelValueInPlane',x00280120:'PixelPaddingValue',x00280121:'PixelPaddingRangeLimit',x00280200:'ImageLocation',x00280300:'QualityControlImage',x00280301:'BurnedInAnnotation',x00280400:'TransformLabel',x00280401:'TransformVersionNumber',x00280402:'NumberOfTransformSteps',x00280403:'SequenceOfCompressedData',x00280404:'DetailsOfCoefficients',x002804x2:'CoefficientCoding',x002804x3:'CoefficientCodingPointers',x00280700:'DCTLabel',x00280701:'DataBlockDescription',x00280702:'DataBlock',x00280710:'NormalizationFactorFormat',x00280720:'ZonalMapNumberFormat',x00280721:'ZonalMapLocation',x00280722:'ZonalMapFormat',x00280730:'AdaptiveMapFormat',x00280740:'CodeNumberFormat',x002808x0:'CodeLabel',x002808x2:'NumberOfTables',x002808x3:'CodeTableLocation',x002808x4:'BitsForCodeWord',x002808x8:'ImageDataLocation',x00280a02:'PixelSpacingCalibrationType',x00280a04:'PixelSpacingCalibrationDescription',x00281040:'PixelIntensityRelationship',x00281041:'PixelIntensityRelationshipSign',x00281050:'WindowCenter',x00281051:'WindowWidth',x00281052:'RescaleIntercept',x00281053:'RescaleSlope',x00281054:'RescaleType',x00281055:'WindowCenterAndWidthExplanation',x00281056:'VOI_LUTFunction',x00281080:'GrayScale',x00281090:'RecommendedViewingMode',x00281100:'GrayLookupTableDescriptor',x00281101:'RedPaletteColorTableDescriptor',x00281102:'GreenPaletteColorTableDescriptor',x00281103:'BluePaletteColorTableDescriptor',x00281111:'LargeRedPaletteColorTableDescr',x00281112:'LargeGreenPaletteColorTableDescr',x00281113:'LargeBluePaletteColorTableDescr',x00281199:'PaletteColorTableUID',x00281200:'GrayLookupTableData',x00281201:'RedPaletteColorTableData',x00281202:'GreenPaletteColorTableData',x00281203:'BluePaletteColorTableData',x00281211:'LargeRedPaletteColorTableData',x00281212:'LargeGreenPaletteColorTableData',x00281213:'LargeBluePaletteColorTableData',x00281214:'LargePaletteColorLookupTableUID',x00281221:'SegmentedRedColorTableData',x00281222:'SegmentedGreenColorTableData',x00281223:'SegmentedBlueColorTableData',x00281300:'BreastImplantPresent',x00281350:'PartialView',x00281351:'PartialViewDescription',x00281352:'PartialViewCodeSequence',x0028135a:'SpatialLocationsPreserved',x00281402:'DataPathAssignment',x00281404:'BlendingLUT1Sequence',x00281406:'BlendingWeightConstant',x00281408:'BlendingLookupTableData',x0028140c:'BlendingLUT2Sequence',x0028140e:'DataPathID',x0028140f:'RGBLUTTransferFunction',x00281410:'AlphaLUTTransferFunction',x00282000:'ICCProfile',x00282110:'LossyImageCompression',x00282112:'LossyImageCompressionRatio',x00282114:'LossyImageCompressionMethod',x00283000:'ModalityLUTSequence',x00283002:'LUTDescriptor',x00283003:'LUTExplanation',x00283004:'ModalityLUTType',x00283006:'LUTData',x00283010:'VOILUTSequence',x00283110:'SoftcopyVOILUTSequence',x00284000:'ImagePresentationComments',x00285000:'BiPlaneAcquisitionSequence',x00286010:'RepresentativeFrameNumber',x00286020:'FrameNumbersOfInterest',x00286022:'FrameOfInterestDescription',x00286023:'FrameOfInterestType',x00286030:'MaskPointers',x00286040:'RWavePointer',x00286100:'MaskSubtractionSequence',x00286101:'MaskOperation',x00286102:'ApplicableFrameRange',x00286110:'MaskFrameNumbers',x00286112:'ContrastFrameAveraging',x00286114:'MaskSubPixelShift',x00286120:'TIDOffset',x00286190:'MaskOperationExplanation',x00287fe0:'PixelDataProviderURL',x00289001:'DataPointRows',x00289002:'DataPointColumns',x00289003:'SignalDomainColumns',x00289099:'LargestMonochromePixelValue',x00289108:'DataRepresentation',x00289110:'PixelMeasuresSequence',x00289132:'FrameVOILUTSequence',x00289145:'PixelValueTransformationSequence',x00289235:'SignalDomainRows',x00289411:'DisplayFilterPercentage',x00289415:'FramePixelShiftSequence',x00289416:'SubtractionItemID',x00289422:'PixelIntensityRelationshipLUTSeq',x00289443:'FramePixelDataPropertiesSequence',x00289444:'GeometricalProperties',x00289445:'GeometricMaximumDistortion',x00289446:'ImageProcessingApplied',x00289454:'MaskSelectionMode',x00289474:'LUTFunction',x00289478:'MaskVisibilityPercentage',x00289501:'PixelShiftSequence',x00289502:'RegionPixelShiftSequence',x00289503:'VerticesOfTheRegion',x00289506:'PixelShiftFrameRange',x00289507:'LUTFrameRange',x00289520:'ImageToEquipmentMappingMatrix',x00289537:'EquipmentCoordinateSystemID',// x00291004: 'LowerRangeOfPixels1a',
  // x00291005: 'LowerRangeOfPixels1b',
  // x00291006: 'LowerRangeOfPixels1c',
  // x00291007: 'LowerRangeOfPixels1d',
  // x00291008: 'LowerRangeOfPixels1e',
  // x00291009: 'LowerRangeOfPixels1f',
  // x0029100a: 'LowerRangeOfPixels1g',
  // x00291015: 'LowerRangeOfPixels1h',
  // x00291016: 'LowerRangeOfPixels1i',
  // x00291017: 'LowerRangeOfPixels2',
  // x00291018: 'UpperRangeOfPixels2',
  // x0029101a: 'LenOfTotHdrInBytes',
  // x00291026: 'VersionOfTheHdrStruct',
  // x00291034: 'AdvantageCompOverflow',
  // x00291035: 'AdvantageCompUnderflow',
  x00320000:'StudyGroupLength',x0032000a:'StudyStatusID',x0032000c:'StudyPriorityID',x00320012:'StudyIDIssuer',x00320032:'StudyVerifiedDate',x00320033:'StudyVerifiedTime',x00320034:'StudyReadDate',x00320035:'StudyReadTime',x00321000:'ScheduledStudyStartDate',x00321001:'ScheduledStudyStartTime',x00321010:'ScheduledStudyStopDate',x00321011:'ScheduledStudyStopTime',x00321020:'ScheduledStudyLocation',x00321021:'ScheduledStudyLocationAETitle',x00321030:'ReasonForStudy',x00321031:'RequestingPhysicianIDSequence',x00321032:'RequestingPhysician',x00321033:'RequestingService',x00321040:'StudyArrivalDate',x00321041:'StudyArrivalTime',x00321050:'StudyCompletionDate',x00321051:'StudyCompletionTime',x00321055:'StudyComponentStatusID',x00321060:'RequestedProcedureDescription',x00321064:'RequestedProcedureCodeSequence',x00321070:'RequestedContrastAgent',x00324000:'StudyComments',x00380004:'ReferencedPatientAliasSequence',x00380008:'VisitStatusID',x00380010:'AdmissionID',x00380011:'IssuerOfAdmissionID',x00380016:'RouteOfAdmissions',x0038001a:'ScheduledAdmissionDate',x0038001b:'ScheduledAdmissionTime',x0038001c:'ScheduledDischargeDate',x0038001d:'ScheduledDischargeTime',x0038001e:'ScheduledPatientInstitResidence',x00380020:'AdmittingDate',x00380021:'AdmittingTime',x00380030:'DischargeDate',x00380032:'DischargeTime',x00380040:'DischargeDiagnosisDescription',x00380044:'DischargeDiagnosisCodeSequence',x00380050:'SpecialNeeds',x00380060:'ServiceEpisodeID',x00380061:'IssuerOfServiceEpisodeID',x00380062:'ServiceEpisodeDescription',x00380100:'PertinentDocumentsSequence',x00380300:'CurrentPatientLocation',x00380400:'PatientInstitutionResidence',x00380500:'PatientState',x00380502:'PatientClinicalTrialParticipSeq',x00384000:'VisitComments',x003a0004:'WaveformOriginality',x003a0005:'NumberOfWaveformChannels',x003a0010:'NumberOfWaveformSamples',x003a001a:'SamplingFrequency',x003a0020:'MultiplexGroupLabel',x003a0200:'ChannelDefinitionSequence',x003a0202:'WaveformChannelNumber',x003a0203:'ChannelLabel',x003a0205:'ChannelStatus',x003a0208:'ChannelSourceSequence',x003a0209:'ChannelSourceModifiersSequence',x003a020a:'SourceWaveformSequence',x003a020c:'ChannelDerivationDescription',x003a0210:'ChannelSensitivity',x003a0211:'ChannelSensitivityUnitsSequence',x003a0212:'ChannelSensitivityCorrectionFactor',x003a0213:'ChannelBaseline',x003a0214:'ChannelTimeSkew',x003a0215:'ChannelSampleSkew',x003a0218:'ChannelOffset',x003a021a:'WaveformBitsStored',x003a0220:'FilterLowFrequency',x003a0221:'FilterHighFrequency',x003a0222:'NotchFilterFrequency',x003a0223:'NotchFilterBandwidth',x003a0230:'WaveformDataDisplayScale',x003a0231:'WaveformDisplayBkgCIELabValue',x003a0240:'WaveformPresentationGroupSequence',x003a0241:'PresentationGroupNumber',x003a0242:'ChannelDisplaySequence',x003a0244:'ChannelRecommendDisplayCIELabValue',x003a0245:'ChannelPosition',x003a0246:'DisplayShadingFlag',x003a0247:'FractionalChannelDisplayScale',x003a0248:'AbsoluteChannelDisplayScale',x003a0300:'MultiplexAudioChannelsDescrCodeSeq',x003a0301:'ChannelIdentificationCode',x003a0302:'ChannelMode',x00400001:'ScheduledStationAETitle',x00400002:'ScheduledProcedureStepStartDate',x00400003:'ScheduledProcedureStepStartTime',x00400004:'ScheduledProcedureStepEndDate',x00400005:'ScheduledProcedureStepEndTime',x00400006:'ScheduledPerformingPhysiciansName',x00400007:'ScheduledProcedureStepDescription',x00400008:'ScheduledProtocolCodeSequence',x00400009:'ScheduledProcedureStepID',x0040000a:'StageCodeSequence',x0040000b:'ScheduledPerformingPhysicianIDSeq',x00400010:'ScheduledStationName',x00400011:'ScheduledProcedureStepLocation',x00400012:'PreMedication',x00400020:'ScheduledProcedureStepStatus',x00400031:'LocalNamespaceEntityID',x00400032:'UniversalEntityID',x00400033:'UniversalEntityIDType',x00400035:'IdentifierTypeCode',x00400036:'AssigningFacilitySequence',x00400100:'ScheduledProcedureStepSequence',x00400220:'ReferencedNonImageCompositeSOPSeq',x00400241:'PerformedStationAETitle',x00400242:'PerformedStationName',x00400243:'PerformedLocation',x00400244:'PerformedProcedureStepStartDate',x00400245:'PerformedProcedureStepStartTime',x00400250:'PerformedProcedureStepEndDate',x00400251:'PerformedProcedureStepEndTime',x00400252:'PerformedProcedureStepStatus',x00400253:'PerformedProcedureStepID',x00400254:'PerformedProcedureStepDescription',x00400255:'PerformedProcedureTypeDescription',x00400260:'PerformedProtocolCodeSequence',x00400261:'PerformedProtocolType',x00400270:'ScheduledStepAttributesSequence',x00400275:'RequestAttributesSequence',x00400280:'CommentsOnPerformedProcedureStep',x00400281:'ProcStepDiscontinueReasonCodeSeq',x00400293:'QuantitySequence',x00400294:'Quantity',x00400295:'MeasuringUnitsSequence',x00400296:'BillingItemSequence',x00400300:'TotalTimeOfFluoroscopy',x00400301:'TotalNumberOfExposures',x00400302:'EntranceDose',x00400303:'ExposedArea',x00400306:'DistanceSourceToEntrance',x00400307:'DistanceSourceToSupport',x0040030e:'ExposureDoseSequence',x00400310:'CommentsOnRadiationDose',x00400312:'XRayOutput',x00400314:'HalfValueLayer',x00400316:'OrganDose',x00400318:'OrganExposed',x00400320:'BillingProcedureStepSequence',x00400321:'FilmConsumptionSequence',x00400324:'BillingSuppliesAndDevicesSequence',x00400330:'ReferencedProcedureStepSequence',x00400340:'PerformedSeriesSequence',x00400400:'CommentsOnScheduledProcedureStep',x00400440:'ProtocolContextSequence',x00400441:'ContentItemModifierSequence',x0040050a:'SpecimenAccessionNumber',x00400512:'ContainerIdentifier',x0040051a:'ContainerDescription',x00400550:'SpecimenSequence',x00400551:'SpecimenIdentifier',x00400552:'SpecimenDescriptionSequenceTrial',x00400553:'SpecimenDescriptionTrial',x00400554:'SpecimenUID',x00400555:'AcquisitionContextSequence',x00400556:'AcquisitionContextDescription',x0040059a:'SpecimenTypeCodeSequence',x00400600:'SpecimenShortDescription',x004006fa:'SlideIdentifier',x0040071a:'ImageCenterPointCoordinatesSeq',x0040072a:'XOffsetInSlideCoordinateSystem',x0040073a:'YOffsetInSlideCoordinateSystem',x0040074a:'ZOffsetInSlideCoordinateSystem',x004008d8:'PixelSpacingSequence',x004008da:'CoordinateSystemAxisCodeSequence',x004008ea:'MeasurementUnitsCodeSequence',x004009f8:'VitalStainCodeSequenceTrial',x00401001:'RequestedProcedureID',x00401002:'ReasonForRequestedProcedure',x00401003:'RequestedProcedurePriority',x00401004:'PatientTransportArrangements',x00401005:'RequestedProcedureLocation',x00401006:'PlacerOrderNumber-Procedure',x00401007:'FillerOrderNumber-Procedure',x00401008:'ConfidentialityCode',x00401009:'ReportingPriority',x0040100a:'ReasonForRequestedProcedureCodeSeq',x00401010:'NamesOfIntendedRecipientsOfResults',x00401011:'IntendedRecipientsOfResultsIDSeq',x00401101:'PersonIdentificationCodeSequence',x00401102:'PersonAddress',x00401103:'PersonTelephoneNumbers',x00401400:'RequestedProcedureComments',x00402001:'ReasonForImagingServiceRequest',x00402004:'IssueDateOfImagingServiceRequest',x00402005:'IssueTimeOfImagingServiceRequest',x00402006:'PlacerOrderNumberImagingServiceRequestRetired',x00402007:'FillerOrderNumberImagingServiceRequestRetired',x00402008:'OrderEnteredBy',x00402009:'OrderEntererLocation',x00402010:'OrderCallbackPhoneNumber',x00402016:'PlacerOrderNum-ImagingServiceReq',x00402017:'FillerOrderNum-ImagingServiceReq',x00402400:'ImagingServiceRequestComments',x00403001:'ConfidentialityOnPatientDataDescr',x00404001:'GenPurposeScheduledProcStepStatus',x00404002:'GenPurposePerformedProcStepStatus',x00404003:'GenPurposeSchedProcStepPriority',x00404004:'SchedProcessingApplicationsCodeSeq',x00404005:'SchedProcedureStepStartDateAndTime',x00404006:'MultipleCopiesFlag',x00404007:'PerformedProcessingAppsCodeSeq',x00404009:'HumanPerformerCodeSequence',x00404010:'SchedProcStepModificationDateTime',x00404011:'ExpectedCompletionDateAndTime',x00404015:'ResultingGenPurposePerfProcStepSeq',x00404016:'RefGenPurposeSchedProcStepSeq',x00404018:'ScheduledWorkitemCodeSequence',x00404019:'PerformedWorkitemCodeSequence',x00404020:'InputAvailabilityFlag',x00404021:'InputInformationSequence',x00404022:'RelevantInformationSequence',x00404023:'RefGenPurSchedProcStepTransUID',x00404025:'ScheduledStationNameCodeSequence',x00404026:'ScheduledStationClassCodeSequence',x00404027:'SchedStationGeographicLocCodeSeq',x00404028:'PerformedStationNameCodeSequence',x00404029:'PerformedStationClassCodeSequence',x00404030:'PerformedStationGeogLocCodeSeq',x00404031:'RequestedSubsequentWorkItemCodeSeq',x00404032:'NonDICOMOutputCodeSequence',x00404033:'OutputInformationSequence',x00404034:'ScheduledHumanPerformersSequence',x00404035:'ActualHumanPerformersSequence',x00404036:'HumanPerformersOrganization',x00404037:'HumanPerformerName',x00404040:'RawDataHandling',x00408302:'EntranceDoseInMilliGy',x00409094:'RefImageRealWorldValueMappingSeq',x00409096:'RealWorldValueMappingSequence',x00409098:'PixelValueMappingCodeSequence',x00409210:'LUTLabel',x00409211:'RealWorldValueLastValueMapped',x00409212:'RealWorldValueLUTData',x00409216:'RealWorldValueFirstValueMapped',x00409224:'RealWorldValueIntercept',x00409225:'RealWorldValueSlope',x0040a010:'RelationshipType',x0040a027:'VerifyingOrganization',x0040a030:'VerificationDateTime',x0040a032:'ObservationDateTime',x0040a040:'ValueType',x0040a043:'ConceptNameCodeSequence',x0040a050:'ContinuityOfContent',x0040a073:'VerifyingObserverSequence',x0040a075:'VerifyingObserverName',x0040a078:'AuthorObserverSequence',x0040a07a:'ParticipantSequence',x0040a07c:'CustodialOrganizationSequence',x0040a080:'ParticipationType',x0040a082:'ParticipationDateTime',x0040a084:'ObserverType',x0040a088:'VerifyingObserverIdentCodeSequence',x0040a090:'EquivalentCDADocumentSequence',x0040a0b0:'ReferencedWaveformChannels',x0040a120:'DateTime',x0040a121:'Date',x0040a122:'Time',x0040a123:'PersonName',x0040a124:'UID',x0040a130:'TemporalRangeType',x0040a132:'ReferencedSamplePositions',x0040a136:'ReferencedFrameNumbers',x0040a138:'ReferencedTimeOffsets',x0040a13a:'ReferencedDateTime',x0040a160:'TextValue',x0040a168:'ConceptCodeSequence',x0040a170:'PurposeOfReferenceCodeSequence',x0040a180:'AnnotationGroupNumber',x0040a195:'ModifierCodeSequence',x0040a300:'MeasuredValueSequence',x0040a301:'NumericValueQualifierCodeSequence',x0040a30a:'NumericValue',x0040a353:'AddressTrial',x0040a354:'TelephoneNumberTrial',x0040a360:'PredecessorDocumentsSequence',x0040a370:'ReferencedRequestSequence',x0040a372:'PerformedProcedureCodeSequence',x0040a375:'CurrentRequestedProcEvidenceSeq',x0040a385:'PertinentOtherEvidenceSequence',x0040a390:'HL7StructuredDocumentRefSeq',x0040a491:'CompletionFlag',x0040a492:'CompletionFlagDescription',x0040a493:'VerificationFlag',x0040a494:'ArchiveRequested',x0040a496:'PreliminaryFlag',x0040a504:'ContentTemplateSequence',x0040a525:'IdenticalDocumentsSequence',x0040a730:'ContentSequence',x0040b020:'AnnotationSequence',x0040db00:'TemplateIdentifier',x0040db06:'TemplateVersion',x0040db07:'TemplateLocalVersion',x0040db0b:'TemplateExtensionFlag',x0040db0c:'TemplateExtensionOrganizationUID',x0040db0d:'TemplateExtensionCreatorUID',x0040db73:'ReferencedContentItemIdentifier',x0040e001:'HL7InstanceIdentifier',x0040e004:'HL7DocumentEffectiveTime',x0040e006:'HL7DocumentTypeCodeSequence',x0040e010:'RetrieveURI',x0040e011:'RetrieveLocationUID',x00420010:'DocumentTitle',x00420011:'EncapsulatedDocument',x00420012:'MIMETypeOfEncapsulatedDocument',x00420013:'SourceInstanceSequence',x00420014:'ListOfMIMETypes',// x00431001: 'BitmapOfPrescanOptions',
  // x00431002: 'GradientOffsetInX',
  // x00431003: 'GradientOffsetInY',
  // x00431004: 'GradientOffsetInZ',
  // x00431005: 'ImgIsOriginalOrUnoriginal',
  // x00431006: 'NumberOfEPIShots',
  // x00431007: 'ViewsPerSegment',
  // x00431008: 'RespiratoryRateBpm',
  // x00431009: 'RespiratoryTriggerPoint',
  // x0043100a: 'TypeOfReceiverUsed',
  // x0043100b: 'PeakRateOfChangeOfGradientField',
  // x0043100c: 'LimitsInUnitsOfPercent',
  // x0043100d: 'PSDEstimatedLimit',
  // x0043100e: 'PSDEstimatedLimitInTeslaPerSecond',
  // x0043100f: 'Saravghead',
  // x00431010: 'WindowValue',
  // x00431011: 'TotalInputViews',
  // x00431012: 'X-RayChain',
  // x00431013: 'DeconKernelParameters',
  // x00431014: 'CalibrationParameters',
  // x00431015: 'TotalOutputViews',
  // x00431016: 'NumberOfOverranges',
  // x00431017: 'IBHImageScaleFactors',
  // x00431018: 'BBHCoefficients',
  // x00431019: 'NumberOfBBHChainsToBlend',
  // x0043101a: 'StartingChannelNumber',
  // x0043101b: 'PpscanParameters',
  // x0043101c: 'GEImageIntegrity',
  // x0043101d: 'LevelValue',
  // x0043101e: 'DeltaStartTime',
  // x0043101f: 'MaxOverrangesInAView',
  // x00431020: 'AvgOverrangesAllViews',
  // x00431021: 'CorrectedAfterGlowTerms',
  // x00431025: 'ReferenceChannels',
  // x00431026: 'NoViewsRefChansBlocked',
  // x00431027: 'ScanPitchRatio',
  // x00431028: 'UniqueImageIden',
  // x00431029: 'HistogramTables',
  // x0043102a: 'UserDefinedData',
  // x0043102b: 'PrivateScanOptions',
  // x0043102c: 'EffectiveEchoSpacing',
  // x0043102d: 'StringSlopField1',
  // x0043102e: 'StringSlopField2',
  // x0043102f: 'RawDataType',
  // x00431030: 'RawDataType',
  // x00431031: 'RACordOfTargetReconCenter',
  // x00431032: 'RawDataType',
  // x00431033: 'NegScanspacing',
  // x00431034: 'OffsetFrequency',
  // x00431035: 'UserUsageTag',
  // x00431036: 'UserFillMapMSW',
  // x00431037: 'UserFillMapLSW',
  // x00431038: 'User25-48',
  // x00431039: 'SlopInt6-9',
  // x00431040: 'TriggerOnPosition',
  // x00431041: 'DegreeOfRotation',
  // x00431042: 'DASTriggerSource',
  // x00431043: 'DASFpaGain',
  // x00431044: 'DASOutputSource',
  // x00431045: 'DASAdInput',
  // x00431046: 'DASCalMode',
  // x00431047: 'DASCalFrequency',
  // x00431048: 'DASRegXm',
  // x00431049: 'DASAutoZero',
  // x0043104a: 'StartingChannelOfView',
  // x0043104b: 'DASXmPattern',
  // x0043104c: 'TGGCTriggerMode',
  // x0043104d: 'StartScanToXrayOnDelay',
  // x0043104e: 'DurationOfXrayOn',
  // x00431060: 'SlopInt10-17',
  // x00431061: 'ScannerStudyEntityUID',
  // x00431062: 'ScannerStudyID',
  // x0043106f: 'ScannerTableEntry',
  x00440001:'ProductPackageIdentifier',x00440002:'SubstanceAdministrationApproval',x00440003:'ApprovalStatusFurtherDescription',x00440004:'ApprovalStatusDateTime',x00440007:'ProductTypeCodeSequence',x00440008:'ProductName',x00440009:'ProductDescription',x0044000a:'ProductLotIdentifier',x0044000b:'ProductExpirationDateTime',x00440010:'SubstanceAdministrationDateTime',x00440011:'SubstanceAdministrationNotes',x00440012:'SubstanceAdministrationDeviceID',x00440013:'ProductParameterSequence',x00440019:'SubstanceAdminParameterSeq',// x00451001: 'NumberOfMacroRowsInDetector',
  // x00451002: 'MacroWidthAtISOCenter',
  // x00451003: 'DASType',
  // x00451004: 'DASGain',
  // x00451005: 'DASTemperature',
  // x00451006: 'TableDirectionInOrOut',
  // x00451007: 'ZSmoothingFactor',
  // x00451008: 'ViewWeightingMode',
  // x00451009: 'SigmaRowNumberWhichRowsWereUsed',
  // x0045100a: 'MinimumDasValueFoundInTheScanData',
  // x0045100b: 'MaximumOffsetShiftValueUsed',
  // x0045100c: 'NumberOfViewsShifted',
  // x0045100d: 'ZTrackingFlag',
  // x0045100e: 'MeanZError',
  // x0045100f: 'ZTrackingMaximumError',
  // x00451010: 'StartingViewForRow2a',
  // x00451011: 'NumberOfViewsInRow2a',
  // x00451012: 'StartingViewForRow1a',
  // x00451013: 'SigmaMode',
  // x00451014: 'NumberOfViewsInRow1a',
  // x00451015: 'StartingViewForRow2b',
  // x00451016: 'NumberOfViewsInRow2b',
  // x00451017: 'StartingViewForRow1b',
  // x00451018: 'NumberOfViewsInRow1b',
  // x00451019: 'AirFilterCalibrationDate',
  // x0045101a: 'AirFilterCalibrationTime',
  // x0045101b: 'PhantomCalibrationDate',
  // x0045101c: 'PhantomCalibrationTime',
  // x0045101d: 'ZSlopeCalibrationDate',
  // x0045101e: 'ZSlopeCalibrationTime',
  // x0045101f: 'CrosstalkCalibrationDate',
  // x00451020: 'CrosstalkCalibrationTime',
  // x00451021: 'IterboneOptionFlag',
  // x00451022: 'PeristalticFlagOption',
  x00460012:'LensDescription',x00460014:'RightLensSequence',x00460015:'LeftLensSequence',x00460018:'CylinderSequence',x00460028:'PrismSequence',x00460030:'HorizontalPrismPower',x00460032:'HorizontalPrismBase',x00460034:'VerticalPrismPower',x00460036:'VerticalPrismBase',x00460038:'LensSegmentType',x00460040:'OpticalTransmittance',x00460042:'ChannelWidth',x00460044:'PupilSize',x00460046:'CornealSize',x00460060:'DistancePupillaryDistance',x00460062:'NearPupillaryDistance',x00460064:'OtherPupillaryDistance',x00460075:'RadiusOfCurvature',x00460076:'KeratometricPower',x00460077:'KeratometricAxis',x00460092:'BackgroundColor',x00460094:'Optotype',x00460095:'OptotypePresentation',x00460100:'AddNearSequence',x00460101:'AddIntermediateSequence',x00460102:'AddOtherSequence',x00460104:'AddPower',x00460106:'ViewingDistance',x00460125:'ViewingDistanceType',x00460135:'VisualAcuityModifiers',x00460137:'DecimalVisualAcuity',x00460139:'OptotypeDetailedDefinition',x00460146:'SpherePower',x00460147:'CylinderPower',x00500004:'CalibrationImage',x00500010:'DeviceSequence',x00500014:'DeviceLength',x00500015:'ContainerComponentWidth',x00500016:'DeviceDiameter',x00500017:'DeviceDiameterUnits',x00500018:'DeviceVolume',x00500019:'InterMarkerDistance',x0050001b:'ContainerComponentID',x00500020:'DeviceDescription',x00540010:'EnergyWindowVector',x00540011:'NumberOfEnergyWindows',x00540012:'EnergyWindowInformationSequence',x00540013:'EnergyWindowRangeSequence',x00540014:'EnergyWindowLowerLimit',x00540015:'EnergyWindowUpperLimit',x00540016:'RadiopharmaceuticalInformationSeq',x00540017:'ResidualSyringeCounts',x00540018:'EnergyWindowName',x00540020:'DetectorVector',x00540021:'NumberOfDetectors',x00540022:'DetectorInformationSequence',x00540030:'PhaseVector',x00540031:'NumberOfPhases',x00540032:'PhaseInformationSequence',x00540033:'NumberOfFramesInPhase',x00540036:'PhaseDelay',x00540038:'PauseBetweenFrames',x00540039:'PhaseDescription',x00540050:'RotationVector',x00540051:'NumberOfRotations',x00540052:'RotationInformationSequence',x00540053:'NumberOfFramesInRotation',x00540060:'RRIntervalVector',x00540061:'NumberOfRRIntervals',x00540062:'GatedInformationSequence',x00540063:'DataInformationSequence',x00540070:'TimeSlotVector',x00540071:'NumberOfTimeSlots',x00540072:'TimeSlotInformationSequence',x00540073:'TimeSlotTime',x00540080:'SliceVector',x00540081:'NumberOfSlices',x00540090:'AngularViewVector',x00540100:'TimeSliceVector',x00540101:'NumberOfTimeSlices',x00540200:'StartAngle',x00540202:'TypeOfDetectorMotion',x00540210:'TriggerVector',x00540211:'NumberOfTriggersInPhase',x00540220:'ViewCodeSequence',x00540222:'ViewModifierCodeSequence',x00540300:'RadionuclideCodeSequence',x00540302:'AdministrationRouteCodeSequence',x00540304:'RadiopharmaceuticalCodeSequence',x00540306:'CalibrationDataSequence',x00540308:'EnergyWindowNumber',x00540400:'ImageID',x00540410:'PatientOrientationCodeSequence',x00540412:'PatientOrientationModifierCodeSeq',x00540414:'PatientGantryRelationshipCodeSeq',x00540500:'SliceProgressionDirection',x00541000:'SeriesType',x00541001:'Units',x00541002:'CountsSource',x00541004:'ReprojectionMethod',x00541100:'RandomsCorrectionMethod',x00541101:'AttenuationCorrectionMethod',x00541102:'DecayCorrection',x00541103:'ReconstructionMethod',x00541104:'DetectorLinesOfResponseUsed',x00541105:'ScatterCorrectionMethod',x00541200:'AxialAcceptance',x00541201:'AxialMash',x00541202:'TransverseMash',x00541203:'DetectorElementSize',x00541210:'CoincidenceWindowWidth',x00541220:'SecondaryCountsType',x00541300:'FrameReferenceTime',x00541310:'PrimaryCountsAccumulated',x00541311:'SecondaryCountsAccumulated',x00541320:'SliceSensitivityFactor',x00541321:'DecayFactor',x00541322:'DoseCalibrationFactor',x00541323:'ScatterFractionFactor',x00541324:'DeadTimeFactor',x00541330:'ImageIndex',x00541400:'CountsIncluded',x00541401:'DeadTimeCorrectionFlag',x00603000:'HistogramSequence',x00603002:'HistogramNumberOfBins',x00603004:'HistogramFirstBinValue',x00603006:'HistogramLastBinValue',x00603008:'HistogramBinWidth',x00603010:'HistogramExplanation',x00603020:'HistogramData',x00620001:'SegmentationType',x00620002:'SegmentSequence',x00620003:'SegmentedPropertyCategoryCodeSeq',x00620004:'SegmentNumber',x00620005:'SegmentLabel',x00620006:'SegmentDescription',x00620008:'SegmentAlgorithmType',x00620009:'SegmentAlgorithmName',x0062000a:'SegmentIdentificationSequence',x0062000b:'ReferencedSegmentNumber',x0062000c:'RecommendedDisplayGrayscaleValue',x0062000d:'RecommendedDisplayCIELabValue',x0062000e:'MaximumFractionalValue',x0062000f:'SegmentedPropertyTypeCodeSequence',x00620010:'SegmentationFractionalType',x00640002:'DeformableRegistrationSequence',x00640003:'SourceFrameOfReferenceUID',x00640005:'DeformableRegistrationGridSequence',x00640007:'GridDimensions',x00640008:'GridResolution',x00640009:'VectorGridData',x0064000f:'PreDeformationMatrixRegistSeq',x00640010:'PostDeformationMatrixRegistSeq',x00660001:'NumberOfSurfaces',x00660002:'SurfaceSequence',x00660003:'SurfaceNumber',x00660004:'SurfaceComments',x00660009:'SurfaceProcessing',x0066000a:'SurfaceProcessingRatio',x0066000e:'FiniteVolume',x00660010:'Manifold',x00660011:'SurfacePointsSequence',x00660015:'NumberOfSurfacePoints',x00660016:'PointCoordinatesData',x00660017:'PointPositionAccuracy',x00660018:'MeanPointDistance',x00660019:'MaximumPointDistance',x0066001b:'AxisOfRotation',x0066001c:'CenterOfRotation',x0066001e:'NumberOfVectors',x0066001f:'VectorDimensionality',x00660020:'VectorAccuracy',x00660021:'VectorCoordinateData',x00660023:'TrianglePointIndexList',x00660024:'EdgePointIndexList',x00660025:'VertexPointIndexList',x00660026:'TriangleStripSequence',x00660027:'TriangleFanSequence',x00660028:'LineSequence',x00660029:'PrimitivePointIndexList',x0066002a:'SurfaceCount',x0066002f:'AlgorithmFamilyCodeSequ',x00660031:'AlgorithmVersion',x00660032:'AlgorithmParameters',x00660034:'FacetSequence',x00660036:'AlgorithmName',x00700001:'GraphicAnnotationSequence',x00700002:'GraphicLayer',x00700003:'BoundingBoxAnnotationUnits',x00700004:'AnchorPointAnnotationUnits',x00700005:'GraphicAnnotationUnits',x00700006:'UnformattedTextValue',x00700008:'TextObjectSequence',x00700009:'GraphicObjectSequence',x00700010:'BoundingBoxTopLeftHandCorner',x00700011:'BoundingBoxBottomRightHandCorner',x00700012:'BoundingBoxTextHorizJustification',x00700014:'AnchorPoint',x00700015:'AnchorPointVisibility',x00700020:'GraphicDimensions',x00700021:'NumberOfGraphicPoints',x00700022:'GraphicData',x00700023:'GraphicType',x00700024:'GraphicFilled',x00700040:'ImageRotationRetired',x00700041:'ImageHorizontalFlip',x00700042:'ImageRotation',x00700050:'DisplayedAreaTopLeftTrial',x00700051:'DisplayedAreaBottomRightTrial',x00700052:'DisplayedAreaTopLeft',x00700053:'DisplayedAreaBottomRight',x0070005a:'DisplayedAreaSelectionSequence',x00700060:'GraphicLayerSequence',x00700062:'GraphicLayerOrder',x00700066:'GraphicLayerRecDisplayGraysclValue',x00700067:'GraphicLayerRecDisplayRGBValue',x00700068:'GraphicLayerDescription',x00700080:'ContentLabel',x00700081:'ContentDescription',x00700082:'PresentationCreationDate',x00700083:'PresentationCreationTime',x00700084:'ContentCreatorName',x00700086:'ContentCreatorIDCodeSequence',x00700100:'PresentationSizeMode',x00700101:'PresentationPixelSpacing',x00700102:'PresentationPixelAspectRatio',x00700103:'PresentationPixelMagRatio',x00700306:'ShapeType',x00700308:'RegistrationSequence',x00700309:'MatrixRegistrationSequence',x0070030a:'MatrixSequence',x0070030c:'FrameOfRefTransformationMatrixType',x0070030d:'RegistrationTypeCodeSequence',x0070030f:'FiducialDescription',x00700310:'FiducialIdentifier',x00700311:'FiducialIdentifierCodeSequence',x00700312:'ContourUncertaintyRadius',x00700314:'UsedFiducialsSequence',x00700318:'GraphicCoordinatesDataSequence',x0070031a:'FiducialUID',x0070031c:'FiducialSetSequence',x0070031e:'FiducialSequence',x00700401:'GraphicLayerRecomDisplayCIELabVal',x00700402:'BlendingSequence',x00700403:'RelativeOpacity',x00700404:'ReferencedSpatialRegistrationSeq',x00700405:'BlendingPosition',x00720002:'HangingProtocolName',x00720004:'HangingProtocolDescription',x00720006:'HangingProtocolLevel',x00720008:'HangingProtocolCreator',x0072000a:'HangingProtocolCreationDateTime',x0072000c:'HangingProtocolDefinitionSequence',x0072000e:'HangingProtocolUserIDCodeSequence',x00720010:'HangingProtocolUserGroupName',x00720012:'SourceHangingProtocolSequence',x00720014:'NumberOfPriorsReferenced',x00720020:'ImageSetsSequence',x00720022:'ImageSetSelectorSequence',x00720024:'ImageSetSelectorUsageFlag',x00720026:'SelectorAttribute',x00720028:'SelectorValueNumber',x00720030:'TimeBasedImageSetsSequence',x00720032:'ImageSetNumber',x00720034:'ImageSetSelectorCategory',x00720038:'RelativeTime',x0072003a:'RelativeTimeUnits',x0072003c:'AbstractPriorValue',x0072003e:'AbstractPriorCodeSequence',x00720040:'ImageSetLabel',x00720050:'SelectorAttributeVR',x00720052:'SelectorSequencePointer',x00720054:'SelectorSeqPointerPrivateCreator',x00720056:'SelectorAttributePrivateCreator',x00720060:'SelectorATValue',x00720062:'SelectorCSValue',x00720064:'SelectorISValue',x00720066:'SelectorLOValue',x00720068:'SelectorLTValue',x0072006a:'SelectorPNValue',x0072006c:'SelectorSHValue',x0072006e:'SelectorSTValue',x00720070:'SelectorUTValue',x00720072:'SelectorDSValue',x00720074:'SelectorFDValue',x00720076:'SelectorFLValue',x00720078:'SelectorULValue',x0072007a:'SelectorUSValue',x0072007c:'SelectorSLValue',x0072007e:'SelectorSSValue',x00720080:'SelectorCodeSequenceValue',x00720100:'NumberOfScreens',x00720102:'NominalScreenDefinitionSequence',x00720104:'NumberOfVerticalPixels',x00720106:'NumberOfHorizontalPixels',x00720108:'DisplayEnvironmentSpatialPosition',x0072010a:'ScreenMinimumGrayscaleBitDepth',x0072010c:'ScreenMinimumColorBitDepth',x0072010e:'ApplicationMaximumRepaintTime',x00720200:'DisplaySetsSequence',x00720202:'DisplaySetNumber',x00720203:'DisplaySetLabel',x00720204:'DisplaySetPresentationGroup',x00720206:'DisplaySetPresentationGroupDescr',x00720208:'PartialDataDisplayHandling',x00720210:'SynchronizedScrollingSequence',x00720212:'DisplaySetScrollingGroup',x00720214:'NavigationIndicatorSequence',x00720216:'NavigationDisplaySet',x00720218:'ReferenceDisplaySets',x00720300:'ImageBoxesSequence',x00720302:'ImageBoxNumber',x00720304:'ImageBoxLayoutType',x00720306:'ImageBoxTileHorizontalDimension',x00720308:'ImageBoxTileVerticalDimension',x00720310:'ImageBoxScrollDirection',x00720312:'ImageBoxSmallScrollType',x00720314:'ImageBoxSmallScrollAmount',x00720316:'ImageBoxLargeScrollType',x00720318:'ImageBoxLargeScrollAmount',x00720320:'ImageBoxOverlapPriority',x00720330:'CineRelativeToRealTime',x00720400:'FilterOperationsSequence',x00720402:'FilterByCategory',x00720404:'FilterByAttributePresence',x00720406:'FilterByOperator',x00720432:'SynchronizedImageBoxList',x00720434:'TypeOfSynchronization',x00720500:'BlendingOperationType',x00720510:'ReformattingOperationType',x00720512:'ReformattingThickness',x00720514:'ReformattingInterval',x00720516:'ReformattingOpInitialViewDir',x00720520:'RenderingType3D',x00720600:'SortingOperationsSequence',x00720602:'SortByCategory',x00720604:'SortingDirection',x00720700:'DisplaySetPatientOrientation',x00720702:'VOIType',x00720704:'PseudoColorType',x00720706:'ShowGrayscaleInverted',x00720710:'ShowImageTrueSizeFlag',x00720712:'ShowGraphicAnnotationFlag',x00720714:'ShowPatientDemographicsFlag',x00720716:'ShowAcquisitionTechniquesFlag',x00720717:'DisplaySetHorizontalJustification',x00720718:'DisplaySetVerticalJustification',x00741000:'UnifiedProcedureStepState',x00741002:'UPSProgressInformationSequence',x00741004:'UnifiedProcedureStepProgress',x00741006:'UnifiedProcedureStepProgressDescr',x00741008:'UnifiedProcedureStepComURISeq',x0074100a:'ContactURI',x0074100c:'ContactDisplayName',x00741020:'BeamTaskSequence',x00741022:'BeamTaskType',x00741024:'BeamOrderIndex',x00741030:'DeliveryVerificationImageSequence',x00741032:'VerificationImageTiming',x00741034:'DoubleExposureFlag',x00741036:'DoubleExposureOrdering',x00741038:'DoubleExposureMeterset',x0074103a:'DoubleExposureFieldDelta',x00741040:'RelatedReferenceRTImageSequence',x00741042:'GeneralMachineVerificationSequence',x00741044:'ConventionalMachineVerificationSeq',x00741046:'IonMachineVerificationSequence',x00741048:'FailedAttributesSequence',x0074104a:'OverriddenAttributesSequence',x0074104c:'ConventionalControlPointVerifySeq',x0074104e:'IonControlPointVerificationSeq',x00741050:'AttributeOccurrenceSequence',x00741052:'AttributeOccurrencePointer',x00741054:'AttributeItemSelector',x00741056:'AttributeOccurrencePrivateCreator',x00741200:'ScheduledProcedureStepPriority',x00741202:'StudyListLabel',x00741204:'ProcedureStepLabel',x00741210:'ScheduledProcessingParametersSeq',x00741212:'PerformedProcessingParametersSeq',x00741216:'UPSPerformedProcedureSequence',x00741220:'RelatedProcedureStepSequence',x00741222:'ProcedureStepRelationshipType',x00741230:'DeletionLock',x00741234:'ReceivingAE',x00741236:'RequestingAE',x00741238:'ReasonForCancellation',x00741242:'SCPStatus',x00741244:'SubscriptionListStatus',x00741246:'UPSListStatus',x00880130:'StorageMediaFileSetID',x00880140:'StorageMediaFileSetUID',x00880200:'IconImageSequence',x00880904:'TopicTitle',x00880906:'TopicSubject',x00880910:'TopicAuthor',x00880912:'TopicKeywords',x01000410:'SOPInstanceStatus',x01000420:'SOPAuthorizationDateAndTime',x01000424:'SOPAuthorizationComment',x01000426:'AuthorizationEquipmentCertNumber',x04000005:'MACIDNumber',x04000010:'MACCalculationTransferSyntaxUID',x04000015:'MACAlgorithm',x04000020:'DataElementsSigned',x04000100:'DigitalSignatureUID',x04000105:'DigitalSignatureDateTime',x04000110:'CertificateType',x04000115:'CertificateOfSigner',x04000120:'Signature',x04000305:'CertifiedTimestampType',x04000310:'CertifiedTimestamp',x04000401:'DigitalSignaturePurposeCodeSeq',x04000402:'ReferencedDigitalSignatureSeq',x04000403:'ReferencedSOPInstanceMACSeq',x04000404:'MAC',x04000500:'EncryptedAttributesSequence',x04000510:'EncryptedContentTransferSyntaxUID',x04000520:'EncryptedContent',x04000550:'ModifiedAttributesSequence',x04000561:'OriginalAttributesSequence',x04000562:'AttributeModificationDateTime',x04000563:'ModifyingSystem',x04000564:'SourceOfPreviousValues',x04000565:'ReasonForTheAttributeModification',x1000xxx0:'EscapeTriplet',x1000xxx1:'RunLengthTriplet',x1000xxx2:'HuffmanTableSize',x1000xxx3:'HuffmanTableTriplet',x1000xxx4:'ShiftTableSize',x1000xxx5:'ShiftTableTriplet',x1010xxxx:'ZonalMap',x20000010:'NumberOfCopies',x2000001e:'PrinterConfigurationSequence',x20000020:'PrintPriority',x20000030:'MediumType',x20000040:'FilmDestination',x20000050:'FilmSessionLabel',x20000060:'MemoryAllocation',x20000061:'MaximumMemoryAllocation',x20000062:'ColorImagePrintingFlag',x20000063:'CollationFlag',x20000065:'AnnotationFlag',x20000067:'ImageOverlayFlag',x20000069:'PresentationLUTFlag',x2000006a:'ImageBoxPresentationLUTFlag',x200000a0:'MemoryBitDepth',x200000a1:'PrintingBitDepth',x200000a2:'MediaInstalledSequence',x200000a4:'OtherMediaAvailableSequence',x200000a8:'SupportedImageDisplayFormatSeq',x20000500:'ReferencedFilmBoxSequence',x20000510:'ReferencedStoredPrintSequence',x20100010:'ImageDisplayFormat',x20100030:'AnnotationDisplayFormatID',x20100040:'FilmOrientation',x20100050:'FilmSizeID',x20100052:'PrinterResolutionID',x20100054:'DefaultPrinterResolutionID',x20100060:'MagnificationType',x20100080:'SmoothingType',x201000a6:'DefaultMagnificationType',x201000a7:'OtherMagnificationTypesAvailable',x201000a8:'DefaultSmoothingType',x201000a9:'OtherSmoothingTypesAvailable',x20100100:'BorderDensity',x20100110:'EmptyImageDensity',x20100120:'MinDensity',x20100130:'MaxDensity',x20100140:'Trim',x20100150:'ConfigurationInformation',x20100152:'ConfigurationInformationDescr',x20100154:'MaximumCollatedFilms',x2010015e:'Illumination',x20100160:'ReflectedAmbientLight',x20100376:'PrinterPixelSpacing',x20100500:'ReferencedFilmSessionSequence',x20100510:'ReferencedImageBoxSequence',x20100520:'ReferencedBasicAnnotationBoxSeq',x20200010:'ImageBoxPosition',x20200020:'Polarity',x20200030:'RequestedImageSize',x20200040:'RequestedDecimate-CropBehavior',x20200050:'RequestedResolutionID',x202000a0:'RequestedImageSizeFlag',x202000a2:'DecimateCropResult',x20200110:'BasicGrayscaleImageSequence',x20200111:'BasicColorImageSequence',x20200130:'ReferencedImageOverlayBoxSequence',x20200140:'ReferencedVOILUTBoxSequence',x20300010:'AnnotationPosition',x20300020:'TextString',x20400010:'ReferencedOverlayPlaneSequence',x20400011:'ReferencedOverlayPlaneGroups',x20400020:'OverlayPixelDataSequence',x20400060:'OverlayMagnificationType',x20400070:'OverlaySmoothingType',x20400072:'OverlayOrImageMagnification',x20400074:'MagnifyToNumberOfColumns',x20400080:'OverlayForegroundDensity',x20400082:'OverlayBackgroundDensity',x20400090:'OverlayMode',x20400100:'ThresholdDensity',x20400500:'ReferencedImageBoxSequenceRetired',x20500010:'PresentationLUTSequence',x20500020:'PresentationLUTShape',x20500500:'ReferencedPresentationLUTSequence',x21000010:'PrintJobID',x21000020:'ExecutionStatus',x21000030:'ExecutionStatusInfo',x21000040:'CreationDate',x21000050:'CreationTime',x21000070:'Originator',x21000140:'DestinationAE',x21000160:'OwnerID',x21000170:'NumberOfFilms',x21000500:'ReferencedPrintJobSequencePullStoredPrint',x21100010:'PrinterStatus',x21100020:'PrinterStatusInfo',x21100030:'PrinterName',x21100099:'PrintQueueID',x21200010:'QueueStatus',x21200050:'PrintJobDescriptionSequence',x21200070:'ReferencedPrintJobSequence',x21300010:'PrintManagementCapabilitiesSeq',x21300015:'PrinterCharacteristicsSequence',x21300030:'FilmBoxContentSequence',x21300040:'ImageBoxContentSequence',x21300050:'AnnotationContentSequence',x21300060:'ImageOverlayBoxContentSequence',x21300080:'PresentationLUTContentSequence',x213000a0:'ProposedStudySequence',x213000c0:'OriginalImageSequence',x22000001:'LabelFromInfoExtractedFromInstance',x22000002:'LabelText',x22000003:'LabelStyleSelection',x22000004:'MediaDisposition',x22000005:'BarcodeValue',x22000006:'BarcodeSymbology',x22000007:'AllowMediaSplitting',x22000008:'IncludeNonDICOMObjects',x22000009:'IncludeDisplayApplication',x2200000a:'SaveCompInstancesAfterMediaCreate',x2200000b:'TotalNumberMediaPiecesCreated',x2200000c:'RequestedMediaApplicationProfile',x2200000d:'ReferencedStorageMediaSequence',x2200000e:'FailureAttributes',x2200000f:'AllowLossyCompression',x22000020:'RequestPriority',x30020002:'RTImageLabel',x30020003:'RTImageName',x30020004:'RTImageDescription',x3002000a:'ReportedValuesOrigin',x3002000c:'RTImagePlane',x3002000d:'XRayImageReceptorTranslation',x3002000e:'XRayImageReceptorAngle',x30020010:'RTImageOrientation',x30020011:'ImagePlanePixelSpacing',x30020012:'RTImagePosition',x30020020:'RadiationMachineName',x30020022:'RadiationMachineSAD',x30020024:'RadiationMachineSSD',x30020026:'RTImageSID',x30020028:'SourceToReferenceObjectDistance',x30020029:'FractionNumber',x30020030:'ExposureSequence',x30020032:'MetersetExposure',x30020034:'DiaphragmPosition',x30020040:'FluenceMapSequence',x30020041:'FluenceDataSource',x30020042:'FluenceDataScale',x30020051:'FluenceMode',x30020052:'FluenceModeID',x30040001:'DVHType',x30040002:'DoseUnits',x30040004:'DoseType',x30040006:'DoseComment',x30040008:'NormalizationPoint',x3004000a:'DoseSummationType',x3004000c:'GridFrameOffsetVector',x3004000e:'DoseGridScaling',x30040010:'RTDoseROISequence',x30040012:'DoseValue',x30040014:'TissueHeterogeneityCorrection',x30040040:'DVHNormalizationPoint',x30040042:'DVHNormalizationDoseValue',x30040050:'DVHSequence',x30040052:'DVHDoseScaling',x30040054:'DVHVolumeUnits',x30040056:'DVHNumberOfBins',x30040058:'DVHData',x30040060:'DVHReferencedROISequence',x30040062:'DVHROIContributionType',x30040070:'DVHMinimumDose',x30040072:'DVHMaximumDose',x30040074:'DVHMeanDose',x30060002:'StructureSetLabel',x30060004:'StructureSetName',x30060006:'StructureSetDescription',x30060008:'StructureSetDate',x30060009:'StructureSetTime',x30060010:'ReferencedFrameOfReferenceSequence',x30060012:'RTReferencedStudySequence',x30060014:'RTReferencedSeriesSequence',x30060016:'ContourImageSequence',x30060020:'StructureSetROISequence',x30060022:'ROINumber',x30060024:'ReferencedFrameOfReferenceUID',x30060026:'ROIName',x30060028:'ROIDescription',x3006002a:'ROIDisplayColor',x3006002c:'ROIVolume',x30060030:'RTRelatedROISequence',x30060033:'RTROIRelationship',x30060036:'ROIGenerationAlgorithm',x30060038:'ROIGenerationDescription',x30060039:'ROIContourSequence',x30060040:'ContourSequence',x30060042:'ContourGeometricType',x30060044:'ContourSlabThickness',x30060045:'ContourOffsetVector',x30060046:'NumberOfContourPoints',x30060048:'ContourNumber',x30060049:'AttachedContours',x30060050:'ContourData',x30060080:'RTROIObservationsSequence',x30060082:'ObservationNumber',x30060084:'ReferencedROINumber',x30060085:'ROIObservationLabel',x30060086:'RTROIIdentificationCodeSequence',x30060088:'ROIObservationDescription',x300600a0:'RelatedRTROIObservationsSequence',x300600a4:'RTROIInterpretedType',x300600a6:'ROIInterpreter',x300600b0:'ROIPhysicalPropertiesSequence',x300600b2:'ROIPhysicalProperty',x300600b4:'ROIPhysicalPropertyValue',x300600b6:'ROIElementalCompositionSequence',x300600b7:'ROIElementalCompAtomicNumber',x300600b8:'ROIElementalCompAtomicMassFraction',x300600c0:'FrameOfReferenceRelationshipSeq',x300600c2:'RelatedFrameOfReferenceUID',x300600c4:'FrameOfReferenceTransformType',x300600c6:'FrameOfReferenceTransformMatrix',x300600c8:'FrameOfReferenceTransformComment',x30080010:'MeasuredDoseReferenceSequence',x30080012:'MeasuredDoseDescription',x30080014:'MeasuredDoseType',x30080016:'MeasuredDoseValue',x30080020:'TreatmentSessionBeamSequence',x30080021:'TreatmentSessionIonBeamSequence',x30080022:'CurrentFractionNumber',x30080024:'TreatmentControlPointDate',x30080025:'TreatmentControlPointTime',x3008002a:'TreatmentTerminationStatus',x3008002b:'TreatmentTerminationCode',x3008002c:'TreatmentVerificationStatus',x30080030:'ReferencedTreatmentRecordSequence',x30080032:'SpecifiedPrimaryMeterset',x30080033:'SpecifiedSecondaryMeterset',x30080036:'DeliveredPrimaryMeterset',x30080037:'DeliveredSecondaryMeterset',x3008003a:'SpecifiedTreatmentTime',x3008003b:'DeliveredTreatmentTime',x30080040:'ControlPointDeliverySequence',x30080041:'IonControlPointDeliverySequence',x30080042:'SpecifiedMeterset',x30080044:'DeliveredMeterset',x30080045:'MetersetRateSet',x30080046:'MetersetRateDelivered',x30080047:'ScanSpotMetersetsDelivered',x30080048:'DoseRateDelivered',x30080050:'TreatmentSummaryCalcDoseRefSeq',x30080052:'CumulativeDoseToDoseReference',x30080054:'FirstTreatmentDate',x30080056:'MostRecentTreatmentDate',x3008005a:'NumberOfFractionsDelivered',x30080060:'OverrideSequence',x30080061:'ParameterSequencePointer',x30080062:'OverrideParameterPointer',x30080063:'ParameterItemIndex',x30080064:'MeasuredDoseReferenceNumber',x30080065:'ParameterPointer',x30080066:'OverrideReason',x30080068:'CorrectedParameterSequence',x3008006a:'CorrectionValue',x30080070:'CalculatedDoseReferenceSequence',x30080072:'CalculatedDoseReferenceNumber',x30080074:'CalculatedDoseReferenceDescription',x30080076:'CalculatedDoseReferenceDoseValue',x30080078:'StartMeterset',x3008007a:'EndMeterset',x30080080:'ReferencedMeasuredDoseReferenceSeq',x30080082:'ReferencedMeasuredDoseReferenceNum',x30080090:'ReferencedCalculatedDoseRefSeq',x30080092:'ReferencedCalculatedDoseRefNumber',x300800a0:'BeamLimitingDeviceLeafPairsSeq',x300800b0:'RecordedWedgeSequence',x300800c0:'RecordedCompensatorSequence',x300800d0:'RecordedBlockSequence',x300800e0:'TreatmentSummaryMeasuredDoseRefSeq',x300800f0:'RecordedSnoutSequence',x300800f2:'RecordedRangeShifterSequence',x300800f4:'RecordedLateralSpreadingDeviceSeq',x300800f6:'RecordedRangeModulatorSequence',x30080100:'RecordedSourceSequence',x30080105:'SourceSerialNumber',x30080110:'TreatmentSessionAppSetupSeq',x30080116:'ApplicationSetupCheck',x30080120:'RecordedBrachyAccessoryDeviceSeq',x30080122:'ReferencedBrachyAccessoryDeviceNum',x30080130:'RecordedChannelSequence',x30080132:'SpecifiedChannelTotalTime',x30080134:'DeliveredChannelTotalTime',x30080136:'SpecifiedNumberOfPulses',x30080138:'DeliveredNumberOfPulses',x3008013a:'SpecifiedPulseRepetitionInterval',x3008013c:'DeliveredPulseRepetitionInterval',x30080140:'RecordedSourceApplicatorSequence',x30080142:'ReferencedSourceApplicatorNumber',x30080150:'RecordedChannelShieldSequence',x30080152:'ReferencedChannelShieldNumber',x30080160:'BrachyControlPointDeliveredSeq',x30080162:'SafePositionExitDate',x30080164:'SafePositionExitTime',x30080166:'SafePositionReturnDate',x30080168:'SafePositionReturnTime',x30080200:'CurrentTreatmentStatus',x30080202:'TreatmentStatusComment',x30080220:'FractionGroupSummarySequence',x30080223:'ReferencedFractionNumber',x30080224:'FractionGroupType',x30080230:'BeamStopperPosition',x30080240:'FractionStatusSummarySequence',x30080250:'TreatmentDate',x30080251:'TreatmentTime',x300a0002:'RTPlanLabel',x300a0003:'RTPlanName',x300a0004:'RTPlanDescription',x300a0006:'RTPlanDate',x300a0007:'RTPlanTime',x300a0009:'TreatmentProtocols',x300a000a:'PlanIntent',x300a000b:'TreatmentSites',x300a000c:'RTPlanGeometry',x300a000e:'PrescriptionDescription',x300a0010:'DoseReferenceSequence',x300a0012:'DoseReferenceNumber',x300a0013:'DoseReferenceUID',x300a0014:'DoseReferenceStructureType',x300a0015:'NominalBeamEnergyUnit',x300a0016:'DoseReferenceDescription',x300a0018:'DoseReferencePointCoordinates',x300a001a:'NominalPriorDose',x300a0020:'DoseReferenceType',x300a0021:'ConstraintWeight',x300a0022:'DeliveryWarningDose',x300a0023:'DeliveryMaximumDose',x300a0025:'TargetMinimumDose',x300a0026:'TargetPrescriptionDose',x300a0027:'TargetMaximumDose',x300a0028:'TargetUnderdoseVolumeFraction',x300a002a:'OrganAtRiskFullVolumeDose',x300a002b:'OrganAtRiskLimitDose',x300a002c:'OrganAtRiskMaximumDose',x300a002d:'OrganAtRiskOverdoseVolumeFraction',x300a0040:'ToleranceTableSequence',x300a0042:'ToleranceTableNumber',x300a0043:'ToleranceTableLabel',x300a0044:'GantryAngleTolerance',x300a0046:'BeamLimitingDeviceAngleTolerance',x300a0048:'BeamLimitingDeviceToleranceSeq',x300a004a:'BeamLimitingDevicePositionTol',x300a004b:'SnoutPositionTolerance',x300a004c:'PatientSupportAngleTolerance',x300a004e:'TableTopEccentricAngleTolerance',x300a004f:'TableTopPitchAngleTolerance',x300a0050:'TableTopRollAngleTolerance',x300a0051:'TableTopVerticalPositionTolerance',x300a0052:'TableTopLongitudinalPositionTol',x300a0053:'TableTopLateralPositionTolerance',x300a0055:'RTPlanRelationship',x300a0070:'FractionGroupSequence',x300a0071:'FractionGroupNumber',x300a0072:'FractionGroupDescription',x300a0078:'NumberOfFractionsPlanned',x300a0079:'NumberFractionPatternDigitsPerDay',x300a007a:'RepeatFractionCycleLength',x300a007b:'FractionPattern',x300a0080:'NumberOfBeams',x300a0082:'BeamDoseSpecificationPoint',x300a0084:'BeamDose',x300a0086:'BeamMeterset',x300a0088:'BeamDosePointDepth',x300a0089:'BeamDosePointEquivalentDepth',x300a008a:'BeamDosePointSSD',x300a00a0:'NumberOfBrachyApplicationSetups',x300a00a2:'BrachyAppSetupDoseSpecPoint',x300a00a4:'BrachyApplicationSetupDose',x300a00b0:'BeamSequence',x300a00b2:'TreatmentMachineName',x300a00b3:'PrimaryDosimeterUnit',x300a00b4:'SourceAxisDistance',x300a00b6:'BeamLimitingDeviceSequence',x300a00b8:'RTBeamLimitingDeviceType',x300a00ba:'SourceToBeamLimitingDeviceDistance',x300a00bb:'IsocenterToBeamLimitingDeviceDist',x300a00bc:'NumberOfLeafJawPairs',x300a00be:'LeafPositionBoundaries',x300a00c0:'BeamNumber',x300a00c2:'BeamName',x300a00c3:'BeamDescription',x300a00c4:'BeamType',x300a00c6:'RadiationType',x300a00c7:'HighDoseTechniqueType',x300a00c8:'ReferenceImageNumber',x300a00ca:'PlannedVerificationImageSequence',x300a00cc:'ImagingDeviceSpecificAcqParams',x300a00ce:'TreatmentDeliveryType',x300a00d0:'NumberOfWedges',x300a00d1:'WedgeSequence',x300a00d2:'WedgeNumber',x300a00d3:'WedgeType',x300a00d4:'WedgeID',x300a00d5:'WedgeAngle',x300a00d6:'WedgeFactor',x300a00d7:'TotalWedgeTrayWaterEquivThickness',x300a00d8:'WedgeOrientation',x300a00d9:'IsocenterToWedgeTrayDistance',x300a00da:'SourceToWedgeTrayDistance',x300a00db:'WedgeThinEdgePosition',x300a00dc:'BolusID',x300a00dd:'BolusDescription',x300a00e0:'NumberOfCompensators',x300a00e1:'MaterialID',x300a00e2:'TotalCompensatorTrayFactor',x300a00e3:'CompensatorSequence',x300a00e4:'CompensatorNumber',x300a00e5:'CompensatorID',x300a00e6:'SourceToCompensatorTrayDistance',x300a00e7:'CompensatorRows',x300a00e8:'CompensatorColumns',x300a00e9:'CompensatorPixelSpacing',x300a00ea:'CompensatorPosition',x300a00eb:'CompensatorTransmissionData',x300a00ec:'CompensatorThicknessData',x300a00ed:'NumberOfBoli',x300a00ee:'CompensatorType',x300a00f0:'NumberOfBlocks',x300a00f2:'TotalBlockTrayFactor',x300a00f3:'TotalBlockTrayWaterEquivThickness',x300a00f4:'BlockSequence',x300a00f5:'BlockTrayID',x300a00f6:'SourceToBlockTrayDistance',x300a00f7:'IsocenterToBlockTrayDistance',x300a00f8:'BlockType',x300a00f9:'AccessoryCode',x300a00fa:'BlockDivergence',x300a00fb:'BlockMountingPosition',x300a00fc:'BlockNumber',x300a00fe:'BlockName',x300a0100:'BlockThickness',x300a0102:'BlockTransmission',x300a0104:'BlockNumberOfPoints',x300a0106:'BlockData',x300a0107:'ApplicatorSequence',x300a0108:'ApplicatorID',x300a0109:'ApplicatorType',x300a010a:'ApplicatorDescription',x300a010c:'CumulativeDoseReferenceCoefficient',x300a010e:'FinalCumulativeMetersetWeight',x300a0110:'NumberOfControlPoints',x300a0111:'ControlPointSequence',x300a0112:'ControlPointIndex',x300a0114:'NominalBeamEnergy',x300a0115:'DoseRateSet',x300a0116:'WedgePositionSequence',x300a0118:'WedgePosition',x300a011a:'BeamLimitingDevicePositionSequence',x300a011c:'LeafJawPositions',x300a011e:'GantryAngle',x300a011f:'GantryRotationDirection',x300a0120:'BeamLimitingDeviceAngle',x300a0121:'BeamLimitingDeviceRotateDirection',x300a0122:'PatientSupportAngle',x300a0123:'PatientSupportRotationDirection',x300a0124:'TableTopEccentricAxisDistance',x300a0125:'TableTopEccentricAngle',x300a0126:'TableTopEccentricRotateDirection',x300a0128:'TableTopVerticalPosition',x300a0129:'TableTopLongitudinalPosition',x300a012a:'TableTopLateralPosition',x300a012c:'IsocenterPosition',x300a012e:'SurfaceEntryPoint',x300a0130:'SourceToSurfaceDistance',x300a0134:'CumulativeMetersetWeight',x300a0140:'TableTopPitchAngle',x300a0142:'TableTopPitchRotationDirection',x300a0144:'TableTopRollAngle',x300a0146:'TableTopRollRotationDirection',x300a0148:'HeadFixationAngle',x300a014a:'GantryPitchAngle',x300a014c:'GantryPitchRotationDirection',x300a014e:'GantryPitchAngleTolerance',x300a0180:'PatientSetupSequence',x300a0182:'PatientSetupNumber',x300a0183:'PatientSetupLabel',x300a0184:'PatientAdditionalPosition',x300a0190:'FixationDeviceSequence',x300a0192:'FixationDeviceType',x300a0194:'FixationDeviceLabel',x300a0196:'FixationDeviceDescription',x300a0198:'FixationDevicePosition',x300a0199:'FixationDevicePitchAngle',x300a019a:'FixationDeviceRollAngle',x300a01a0:'ShieldingDeviceSequence',x300a01a2:'ShieldingDeviceType',x300a01a4:'ShieldingDeviceLabel',x300a01a6:'ShieldingDeviceDescription',x300a01a8:'ShieldingDevicePosition',x300a01b0:'SetupTechnique',x300a01b2:'SetupTechniqueDescription',x300a01b4:'SetupDeviceSequence',x300a01b6:'SetupDeviceType',x300a01b8:'SetupDeviceLabel',x300a01ba:'SetupDeviceDescription',x300a01bc:'SetupDeviceParameter',x300a01d0:'SetupReferenceDescription',x300a01d2:'TableTopVerticalSetupDisplacement',x300a01d4:'TableTopLongitudinalSetupDisplace',x300a01d6:'TableTopLateralSetupDisplacement',x300a0200:'BrachyTreatmentTechnique',x300a0202:'BrachyTreatmentType',x300a0206:'TreatmentMachineSequence',x300a0210:'SourceSequence',x300a0212:'SourceNumber',x300a0214:'SourceType',x300a0216:'SourceManufacturer',x300a0218:'ActiveSourceDiameter',x300a021a:'ActiveSourceLength',x300a0222:'SourceEncapsulationNomThickness',x300a0224:'SourceEncapsulationNomTransmission',x300a0226:'SourceIsotopeName',x300a0228:'SourceIsotopeHalfLife',x300a0229:'SourceStrengthUnits',x300a022a:'ReferenceAirKermaRate',x300a022b:'SourceStrength',x300a022c:'SourceStrengthReferenceDate',x300a022e:'SourceStrengthReferenceTime',x300a0230:'ApplicationSetupSequence',x300a0232:'ApplicationSetupType',x300a0234:'ApplicationSetupNumber',x300a0236:'ApplicationSetupName',x300a0238:'ApplicationSetupManufacturer',x300a0240:'TemplateNumber',x300a0242:'TemplateType',x300a0244:'TemplateName',x300a0250:'TotalReferenceAirKerma',x300a0260:'BrachyAccessoryDeviceSequence',x300a0262:'BrachyAccessoryDeviceNumber',x300a0263:'BrachyAccessoryDeviceID',x300a0264:'BrachyAccessoryDeviceType',x300a0266:'BrachyAccessoryDeviceName',x300a026a:'BrachyAccessoryDeviceNomThickness',x300a026c:'BrachyAccessoryDevNomTransmission',x300a0280:'ChannelSequence',x300a0282:'ChannelNumber',x300a0284:'ChannelLength',x300a0286:'ChannelTotalTime',x300a0288:'SourceMovementType',x300a028a:'NumberOfPulses',x300a028c:'PulseRepetitionInterval',x300a0290:'SourceApplicatorNumber',x300a0291:'SourceApplicatorID',x300a0292:'SourceApplicatorType',x300a0294:'SourceApplicatorName',x300a0296:'SourceApplicatorLength',x300a0298:'SourceApplicatorManufacturer',x300a029c:'SourceApplicatorWallNomThickness',x300a029e:'SourceApplicatorWallNomTrans',x300a02a0:'SourceApplicatorStepSize',x300a02a2:'TransferTubeNumber',x300a02a4:'TransferTubeLength',x300a02b0:'ChannelShieldSequence',x300a02b2:'ChannelShieldNumber',x300a02b3:'ChannelShieldID',x300a02b4:'ChannelShieldName',x300a02b8:'ChannelShieldNominalThickness',x300a02ba:'ChannelShieldNominalTransmission',x300a02c8:'FinalCumulativeTimeWeight',x300a02d0:'BrachyControlPointSequence',x300a02d2:'ControlPointRelativePosition',x300a02d4:'ControlPoint3DPosition',x300a02d6:'CumulativeTimeWeight',x300a02e0:'CompensatorDivergence',x300a02e1:'CompensatorMountingPosition',x300a02e2:'SourceToCompensatorDistance',x300a02e3:'TotalCompTrayWaterEquivThickness',x300a02e4:'IsocenterToCompensatorTrayDistance',x300a02e5:'CompensatorColumnOffset',x300a02e6:'IsocenterToCompensatorDistances',x300a02e7:'CompensatorRelStoppingPowerRatio',x300a02e8:'CompensatorMillingToolDiameter',x300a02ea:'IonRangeCompensatorSequence',x300a02eb:'CompensatorDescription',x300a0302:'RadiationMassNumber',x300a0304:'RadiationAtomicNumber',x300a0306:'RadiationChargeState',x300a0308:'ScanMode',x300a030a:'VirtualSourceAxisDistances',x300a030c:'SnoutSequence',x300a030d:'SnoutPosition',x300a030f:'SnoutID',x300a0312:'NumberOfRangeShifters',x300a0314:'RangeShifterSequence',x300a0316:'RangeShifterNumber',x300a0318:'RangeShifterID',x300a0320:'RangeShifterType',x300a0322:'RangeShifterDescription',x300a0330:'NumberOfLateralSpreadingDevices',x300a0332:'LateralSpreadingDeviceSequence',x300a0334:'LateralSpreadingDeviceNumber',x300a0336:'LateralSpreadingDeviceID',x300a0338:'LateralSpreadingDeviceType',x300a033a:'LateralSpreadingDeviceDescription',x300a033c:'LateralSpreadingDevWaterEquivThick',x300a0340:'NumberOfRangeModulators',x300a0342:'RangeModulatorSequence',x300a0344:'RangeModulatorNumber',x300a0346:'RangeModulatorID',x300a0348:'RangeModulatorType',x300a034a:'RangeModulatorDescription',x300a034c:'BeamCurrentModulationID',x300a0350:'PatientSupportType',x300a0352:'PatientSupportID',x300a0354:'PatientSupportAccessoryCode',x300a0356:'FixationLightAzimuthalAngle',x300a0358:'FixationLightPolarAngle',x300a035a:'MetersetRate',x300a0360:'RangeShifterSettingsSequence',x300a0362:'RangeShifterSetting',x300a0364:'IsocenterToRangeShifterDistance',x300a0366:'RangeShifterWaterEquivThickness',x300a0370:'LateralSpreadingDeviceSettingsSeq',x300a0372:'LateralSpreadingDeviceSetting',x300a0374:'IsocenterToLateralSpreadingDevDist',x300a0380:'RangeModulatorSettingsSequence',x300a0382:'RangeModulatorGatingStartValue',x300a0384:'RangeModulatorGatingStopValue',x300a038a:'IsocenterToRangeModulatorDistance',x300a0390:'ScanSpotTuneID',x300a0392:'NumberOfScanSpotPositions',x300a0394:'ScanSpotPositionMap',x300a0396:'ScanSpotMetersetWeights',x300a0398:'ScanningSpotSize',x300a039a:'NumberOfPaintings',x300a03a0:'IonToleranceTableSequence',x300a03a2:'IonBeamSequence',x300a03a4:'IonBeamLimitingDeviceSequence',x300a03a6:'IonBlockSequence',x300a03a8:'IonControlPointSequence',x300a03aa:'IonWedgeSequence',x300a03ac:'IonWedgePositionSequence',x300a0401:'ReferencedSetupImageSequence',x300a0402:'SetupImageComment',x300a0410:'MotionSynchronizationSequence',x300a0412:'ControlPointOrientation',x300a0420:'GeneralAccessorySequence',x300a0421:'GeneralAccessoryID',x300a0422:'GeneralAccessoryDescription',x300a0423:'GeneralAccessoryType',x300a0424:'GeneralAccessoryNumber',x300c0002:'ReferencedRTPlanSequence',x300c0004:'ReferencedBeamSequence',x300c0006:'ReferencedBeamNumber',x300c0007:'ReferencedReferenceImageNumber',x300c0008:'StartCumulativeMetersetWeight',x300c0009:'EndCumulativeMetersetWeight',x300c000a:'ReferencedBrachyAppSetupSeq',x300c000c:'ReferencedBrachyAppSetupNumber',x300c000e:'ReferencedSourceNumber',x300c0020:'ReferencedFractionGroupSequence',x300c0022:'ReferencedFractionGroupNumber',x300c0040:'ReferencedVerificationImageSeq',x300c0042:'ReferencedReferenceImageSequence',x300c0050:'ReferencedDoseReferenceSequence',x300c0051:'ReferencedDoseReferenceNumber',x300c0055:'BrachyReferencedDoseReferenceSeq',x300c0060:'ReferencedStructureSetSequence',x300c006a:'ReferencedPatientSetupNumber',x300c0080:'ReferencedDoseSequence',x300c00a0:'ReferencedToleranceTableNumber',x300c00b0:'ReferencedBolusSequence',x300c00c0:'ReferencedWedgeNumber',x300c00d0:'ReferencedCompensatorNumber',x300c00e0:'ReferencedBlockNumber',x300c00f0:'ReferencedControlPointIndex',x300c00f2:'ReferencedControlPointSequence',x300c00f4:'ReferencedStartControlPointIndex',x300c00f6:'ReferencedStopControlPointIndex',x300c0100:'ReferencedRangeShifterNumber',x300c0102:'ReferencedLateralSpreadingDevNum',x300c0104:'ReferencedRangeModulatorNumber',x300e0002:'ApprovalStatus',x300e0004:'ReviewDate',x300e0005:'ReviewTime',x300e0008:'ReviewerName',x40000000:'TextGroupLength',x40000010:'Arbitrary',x40004000:'TextComments',x40080040:'ResultsID',x40080042:'ResultsIDIssuer',x40080050:'ReferencedInterpretationSequence',x40080100:'InterpretationRecordedDate',x40080101:'InterpretationRecordedTime',x40080102:'InterpretationRecorder',x40080103:'ReferenceToRecordedSound',x40080108:'InterpretationTranscriptionDate',x40080109:'InterpretationTranscriptionTime',x4008010a:'InterpretationTranscriber',x4008010b:'InterpretationText',x4008010c:'InterpretationAuthor',x40080111:'InterpretationApproverSequence',x40080112:'InterpretationApprovalDate',x40080113:'InterpretationApprovalTime',x40080114:'PhysicianApprovingInterpretation',x40080115:'InterpretationDiagnosisDescription',x40080117:'InterpretationDiagnosisCodeSeq',x40080118:'ResultsDistributionListSequence',x40080119:'DistributionName',x4008011a:'DistributionAddress',x40080200:'InterpretationID',x40080202:'InterpretationIDIssuer',x40080210:'InterpretationTypeID',x40080212:'InterpretationStatusID',x40080300:'Impressions',x40084000:'ResultsComments',x4ffe0001:'MACParametersSequence',x50xx0005:'CurveDimensions',x50xx0010:'NumberOfPoints',x50xx0020:'TypeOfData',x50xx0022:'CurveDescription',x50xx0030:'AxisUnits',x50xx0040:'AxisLabels',x50xx0103:'DataValueRepresentation',x50xx0104:'MinimumCoordinateValue',x50xx0105:'MaximumCoordinateValue',x50xx0106:'CurveRange',x50xx0110:'CurveDataDescriptor',x50xx0112:'CoordinateStartValue',x50xx0114:'CoordinateStepValue',x50xx1001:'CurveActivationLayer',x50xx2000:'AudioType',x50xx2002:'AudioSampleFormat',x50xx2004:'NumberOfChannels',x50xx2006:'NumberOfSamples',x50xx2008:'SampleRate',x50xx200a:'TotalTime',x50xx200c:'AudioSampleData',x50xx200e:'AudioComments',x50xx2500:'CurveLabel',x50xx2600:'CurveReferencedOverlaySequence',x50xx2610:'ReferencedOverlayGroup',x50xx3000:'CurveData',x52009229:'SharedFunctionalGroupsSequence',x52009230:'PerFrameFunctionalGroupsSequence',x54000100:'WaveformSequence',x54000110:'ChannelMinimumValue',x54000112:'ChannelMaximumValue',x54001004:'WaveformBitsAllocated',x54001006:'WaveformSampleInterpretation',x5400100a:'WaveformPaddingValue',x54001010:'WaveformData',x56000010:'FirstOrderPhaseCorrectionAngle',x56000020:'SpectroscopyData',x60000000:'OverlayGroupLength',x60xx0010:'OverlayRows',x60xx0011:'OverlayColumns',x60xx0012:'OverlayPlanes',x60xx0015:'NumberOfFramesInOverlay',x60xx0022:'OverlayDescription',x60xx0040:'OverlayType',x60xx0045:'OverlaySubtype',x60xx0050:'OverlayOrigin',x60xx0051:'ImageFrameOrigin',x60xx0052:'OverlayPlaneOrigin',x60xx0060:'OverlayCompressionCode',x60xx0061:'OverlayCompressionOriginator',x60xx0062:'OverlayCompressionLabel',x60xx0063:'OverlayCompressionDescription',x60xx0066:'OverlayCompressionStepPointers',x60xx0068:'OverlayRepeatInterval',x60xx0069:'OverlayBitsGrouped',x60xx0100:'OverlayBitsAllocated',x60xx0102:'OverlayBitPosition',x60xx0110:'OverlayFormat',x60xx0200:'OverlayLocation',x60xx0800:'OverlayCodeLabel',x60xx0802:'OverlayNumberOfTables',x60xx0803:'OverlayCodeTableLocation',x60xx0804:'OverlayBitsForCodeWord',x60xx1001:'OverlayActivationLayer',x60xx1100:'OverlayDescriptorGray',x60xx1101:'OverlayDescriptorRed',x60xx1102:'OverlayDescriptorGreen',x60xx1103:'OverlayDescriptorBlue',x60xx1200:'OverlaysGray',x60xx1201:'OverlaysRed',x60xx1202:'OverlaysGreen',x60xx1203:'OverlaysBlue',x60xx1301:'ROIArea',x60xx1302:'ROIMean',x60xx1303:'ROIStandardDeviation',x60xx1500:'OverlayLabel',x60xx3000:'OverlayData',x60xx4000:'OverlayComments',x7fxx0000:'PixelDataGroupLength',x7fxx0010:'PixelData',x7fxx0011:'VariableNextDataGroup',x7fxx0020:'VariableCoefficientsSDVN',x7fxx0030:'VariableCoefficientsSDHN',x7fxx0040:'VariableCoefficientsSDDN',xfffafffa:'DigitalSignaturesSequence',xfffcfffc:'DataSetTrailingPadding',xfffee000:'StartOfItem',xfffee00d:'EndOfItems',xfffee0dd:'EndOfSequence'};DICOMTagDescriptions.init(initialTagDescriptionMap);// Discard original map...
  initialTagDescriptionMap=null;/**
   * A small set of utilities to help parsing DICOM element values.
   * In the future the functionality provided by this library might
   * be incorporated into dicomParser library.
   */var parsingUtils={/**
     * Check if supplied argument is a valid instance of the dicomParser.DataSet class.
     * @param data {Object} An instance of the dicomParser.DataSet class.
     * @returns {Boolean} Returns true if data is a valid instance of the dicomParser.DataSet class.
     */isValidDataSet:function isValidDataSet(data){var dicomParser=external.dicomParser;return data instanceof dicomParser.DataSet;},/**
     * Parses an element tag according to the 'AT' VR definition.
     * @param data {Object} An instance of the dicomParser.DataSet class.
     * @param tag {String} A DICOM tag with in the format xGGGGEEEE.
     * @returns {String} A string representation of a data element tag or null if the field is not present or data is not long enough.
     */attributeTag:function attributeTag(data,tag){if(this.isValidDataSet(data)&&tag in data.elements){var element=data.elements[tag];if(element&&element.length===4){var parser=data.byteArrayParser.readUint16,bytes=data.byteArray,offset=element.dataOffset;return 'x'+('00000000'+(parser(bytes,offset)*256*256+parser(bytes,offset+2)).toString(16)).substr(-8);}}return null;},/**
     * Parses the string representation of a multi-valued element into an array of strings. If the parser
     * parameter is passed and is a function, it will be applied to each element of the resulting array.
     * @param data {Object} An instance of the dicomParser.DataSet class.
     * @param tag {String} A DICOM tag with in the format xGGGGEEEE.
     * @param parser {Function} An optional parser function that can be applied to each element of the array.
     * @returns {Array} An array of floating point numbers or null if the field is not present or data is not long enough.
     */multiValue:function multiValue(data,tag,parser){var dicomParser=external.dicomParser;if(this.isValidDataSet(data)&&tag in data.elements){var element=data.elements[tag];if(element&&element.length>0){var string=dicomParser.readFixedString(data.byteArray,element.dataOffset,element.length);if(typeof string==='string'&&string.length>0){if(typeof parser!=='function'){parser=null;}return string.split('\\').map(function(value){value=value.trim();return parser!==null?parser(value):value;});}}}return null;},/**
     * Parses a string to an array of floats for a multi-valued element.
     * @param data {Object} An instance of the dicomParser.DataSet class.
     * @param tag {String} A DICOM tag with in the format xGGGGEEEE.
     * @returns {Array} An array of floating point numbers or null if the field is not present or data is not long enough.
     */floatArray:function floatArray(data,tag){return this.multiValue(data,tag,parseFloat);}};/**
   * Returns the specified element as a dicom attribute group/element.
   *
   * @param element - The group/element of the element (e.g. '00280009')
   * @param [defaultValue] - The value to return if the element is not present
   * @returns {*}
   */function getAttribute(element,defaultValue){if(!element){return defaultValue;}// Value is not present if the attribute has a zero length value
  if(!element.Value){return defaultValue;}// Sanity check to make sure we have at least one entry in the array.
  if(!element.Value.length){return defaultValue;}return convertToInt(element.Value);}function convertToInt(input){function padFour(input){var l=input.length;if(l==0)return '0000';if(l==1)return '000'+input;if(l==2)return '00'+input;if(l==3)return '0'+input;return input;}var output='';for(var i=0;i<input.length;i++){for(var j=0;j<input[i].length;j++){output+=padFour(input[i].charCodeAt(j).toString(16));}}return parseInt(output,16);}var btoa=function btoa(val){return new Buffer(val).toString('base64');};// These should be overridden by the implementation
  var user={userLoggedIn:function userLoggedIn(){return false;},getUserId:function getUserId(){return null;},getName:function getName(){return null;},getAccessToken:function getAccessToken(){return null;},login:function login(){return new Promise(function(resolve,reject){return reject();});},logout:function logout(){return new Promise(function(resolve,reject){return reject();});},getData:function getData(key){return null;},setData:function setData(key,value){return null;}};/**
   * Returns the Authorization header as part of an Object.
   *
   * @returns {Object}
   */function getAuthorizationHeader(server){var headers={};// Check for OHIF.user since this can also be run on the server
  var accessToken=user&&user.getAccessToken&&user.getAccessToken();if(server&&server.requestOptions&&server.requestOptions.auth){// HTTP Basic Auth (user:password)
  headers.Authorization="Basic ".concat(btoa(server.requestOptions.auth));}else if(accessToken){headers.Authorization="Bearer ".concat(accessToken);}return headers;}function getModalities(modality,modalitiesInStudy){var modalities={};if(modality){modalities=modality;}if(modalitiesInStudy){// Find vr in modalities
  if(modalities.vr&&modalities.vr===modalitiesInStudy.vr){for(var i=0;i<modalitiesInStudy.Value.length;i++){var value=modalitiesInStudy.Value[i];if(modalities.Value.indexOf(value)===-1){modalities.Value.push(value);}}}else{modalities=modalitiesInStudy;}}return modalities;}/**
   * Returns the Alphabetic version of a PN
   *
   * @param element - The group/element of the element (e.g. '00200013')
   * @param [defaultValue] - The default value to return if the element is not found
   * @returns {*}
   */function getName(element,defaultValue){if(!element){return defaultValue;}// Value is not present if the attribute has a zero length value
  if(!element.Value){return defaultValue;}// Sanity check to make sure we have at least one entry in the array.
  if(!element.Value.length){return defaultValue;}// Return the Alphabetic component group
  if(element.Value[0].Alphabetic){return element.Value[0].Alphabetic;}// Orthanc does not return PN properly so this is a temporary workaround
  return element.Value[0];}/**
   * Returns the first string value as a Javascript Number
   * @param element - The group/element of the element (e.g. '00200013')
   * @param [defaultValue] - The default value to return if the element does not exist
   * @returns {*}
   */function getNumber(element,defaultValue){if(!element){return defaultValue;}// Value is not present if the attribute has a zero length value
  if(!element.Value){return defaultValue;}// Sanity check to make sure we have at least one entry in the array.
  if(!element.Value.length){return defaultValue;}return parseFloat(element.Value[0]);}/**
   * Returns the specified element as a string.  Multi-valued elements will be separated by a backslash
   *
   * @param element - The group/element of the element (e.g. '00200013')
   * @param [defaultValue] - The value to return if the element is not present
   * @returns {*}
   */function getString(element,defaultValue){if(!element){return defaultValue;}// Value is not present if the attribute has a zero length value
  if(!element.Value){return defaultValue;}// Sanity check to make sure we have at least one entry in the array.
  if(!element.Value.length){return defaultValue;}// Join the array together separated by backslash
  // NOTE: Orthanc does not correctly split values into an array so the join is a no-op
  return element.Value.join('\\');}var DICOMWeb={getAttribute:getAttribute,getAuthorizationHeader:getAuthorizationHeader,getModalities:getModalities,getName:getName,getNumber:getNumber,getString:getString};var commonjsGlobal$1=typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function unwrapExports$1(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,'default')?x.default:x;}function createCommonjsModule$1(fn,module){return module={exports:{}},fn(module,module.exports),module.exports;}var dicomwebClient=createCommonjsModule$1(function(module,exports){(function(global,factory){factory(exports);})(commonjsGlobal$1,function(exports){function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj;};}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}/**
     * Converts a Uint8Array to a String.
     * @param {Uint8Array} array that should be converted
     * @param {Number} offset array offset in case only subset of array items should be extracted (default: 0)
     * @param {Number} limit maximum number of array items that should be extracted (defaults to length of array)
     * @returns {String}
     */function uint8ArrayToString(arr,offset,limit){offset=offset||0;limit=limit||arr.length-offset;var str='';for(var i=offset;i<offset+limit;i++){str+=String.fromCharCode(arr[i]);}return str;}/**
     * Converts a String to a Uint8Array.
     * @param {String} str string that should be converted
     * @returns {Uint8Array}
     */function stringToUint8Array(str){var arr=new Uint8Array(str.length);for(var i=0,j=str.length;i<j;i++){arr[i]=str.charCodeAt(i);}return arr;}/**
     * Identifies the boundary in a multipart/related message header.
     * @param {String} header message header
     * @returns {String} boundary
     */function identifyBoundary(header){var parts=header.split('\r\n');for(var i=0;i<parts.length;i++){if(parts[i].substr(0,2)==='--'){return parts[i];}}}/**
     * Checks whether a given token is contained by a message at a given offset.
     * @param {Uint8Array} message message content
     * @param {Uint8Array} token substring that should be present
     * @param {String} offset offset in message content from where search should start
     * @returns {Boolean} whether message contains token at offset
     */function containsToken(message,token){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(message+token.length>message.length){return false;}var index=offset;for(var i=0;i<token.length;i++){if(token[i]!==message[index++]){return false;}}return true;}/**
     * Finds a given token in a message at a given offset.
     * @param {Uint8Array} message message content
     * @param {Uint8Array} token substring that should be found
     * @param {String} offset message body offset from where search should start
     * @returns {Boolean} whether message has a part at given offset or not
     */function findToken(message,token){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var messageLength=message.length;for(var i=offset;i<messageLength;i++){// If the first value of the message matches
  // the first value of the token, check if
  // this is the full token.
  if(message[i]===token[0]){if(containsToken(message,token,i)){return i;}}}return -1;}/**
     * @typedef {Object} MultipartEncodedData
     * @property {ArrayBuffer} data The encoded Multipart Data
     * @property {String} boundary The boundary used to divide pieces of the encoded data
     */ /**
     * Encode one or more DICOM datasets into a single body so it can be
     * sent using the Multipart Content-Type.
     *
     * @param {ArrayBuffer[]} datasets Array containing each file to be encoded in the multipart body, passed as ArrayBuffers.
     * @param {String} [boundary] Optional string to define a boundary between each part of the multipart body. If this is not specified, a random GUID will be generated.
     * @return {MultipartEncodedData} The Multipart encoded data returned as an Object. This contains both the data itself, and the boundary string used to divide it.
     */function multipartEncode(datasets){var boundary=arguments.length>1&&arguments[1]!==undefined?arguments[1]:guid();var contentType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'application/dicom';var contentTypeString="Content-Type: ".concat(contentType);var header="\r\n--".concat(boundary,"\r\n").concat(contentTypeString,"\r\n\r\n");var footer="\r\n--".concat(boundary,"--");var headerArray=stringToUint8Array(header);var footerArray=stringToUint8Array(footer);var headerLength=headerArray.length;var footerLength=footerArray.length;var length=0;// Calculate the total length for the final array
  var contentArrays=datasets.map(function(datasetBuffer){var contentArray=new Uint8Array(datasetBuffer);var contentLength=contentArray.length;length+=headerLength+contentLength+footerLength;return contentArray;});// Allocate the array
  var multipartArray=new Uint8Array(length);// Set the initial header
  multipartArray.set(headerArray,0);// Write each dataset into the multipart array
  var position=0;contentArrays.forEach(function(contentArray){var contentLength=contentArray.length;multipartArray.set(headerArray,position);multipartArray.set(contentArray,position+headerLength);position+=headerLength+contentArray.length;});multipartArray.set(footerArray,position);return {data:multipartArray.buffer,boundary:boundary};}/**
     * Decode a Multipart encoded ArrayBuffer and return the components as an Array.
     *
     * @param {ArrayBuffer} response Data encoded as a 'multipart/related' message
     * @returns {Array} The content
     */function multipartDecode(response){var message=new Uint8Array(response);// First look for the multipart mime header
  var separator=stringToUint8Array('\r\n\r\n');var headerIndex=findToken(message,separator);if(headerIndex===-1){throw new Error('Response message has no multipart mime header');}var header=uint8ArrayToString(message,0,headerIndex);var boundaryString=identifyBoundary(header);if(!boundaryString){throw new Error('Header of response message does not specify boundary');}var boundary=stringToUint8Array(boundaryString);var boundaryLength=boundary.length;var components=[];var offset=headerIndex+separator.length;// Loop until we cannot find any more boundaries
  var boundaryIndex;while(boundaryIndex!==-1){// Search for the next boundary in the message, starting
  // from the current offset position
  boundaryIndex=findToken(message,boundary,offset);// If no further boundaries are found, stop here.
  if(boundaryIndex===-1){break;}// Extract data from response message, excluding "\r\n"
  var spacingLength=2;var length=boundaryIndex-offset-spacingLength;var data=response.slice(offset,offset+length);// Add the data to the array of results
  components.push(data);// Move the offset to the end of the current section,
  // plus the identified boundary
  offset+=length+spacingLength+boundaryLength;}return components;}/**
     * Create a random GUID
     *
     * @return {string}
     */function guid(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}return s4()+s4()+'-'+s4()+'-'+s4()+'-'+s4()+'-'+s4()+s4()+s4();}function isEmptyObject(obj){return Object.keys(obj).length===0&&obj.constructor===Object;}var getFirstResult=function getFirstResult(result){return result[0];};var MIMETYPES={DICOM:'application/dicom',DICOM_JSON:'application/dicom+json',OCTET_STREAM:'application/octet-stream',JPEG:'image/jpeg',PNG:'image/png'};/**
    * Class for interacting with DICOMweb RESTful services.
    */var DICOMwebClient=/*#__PURE__*/function(){/**
      * @constructor
      * @param {Object} options (choices: "url", "username", "password", "headers")
      */function DICOMwebClient(options){_classCallCheck(this,DICOMwebClient);this.baseURL=options.url;if(!this.baseURL){console.error('no DICOMweb base url provided - calls will fail');}if('username'in options){this.username=options.username;if(!('password'in options)){console.error('no password provided to authenticate with DICOMweb service');}this.password=options.password;}if('qidoURLPrefix'in options){console.log("use URL prefix for QIDO-RS: ".concat(options.qidoURLPrefix));this.qidoURL=this.baseURL+'/'+options.qidoURLPrefix;}else{this.qidoURL=this.baseURL;}if('wadoURLPrefix'in options){console.log("use URL prefix for WADO-RS: ".concat(options.wadoURLPrefix));this.wadoURL=this.baseURL+'/'+options.wadoURLPrefix;}else{this.wadoURL=this.baseURL;}if('stowURLPrefix'in options){console.log("use URL prefix for STOW-RS: ".concat(options.stowURLPrefix));this.stowURL=this.baseURL+'/'+options.stowURLPrefix;}else{this.stowURL=this.baseURL;}this.headers=options.headers||{};}_createClass(DICOMwebClient,[{key:"_httpRequest",value:function _httpRequest(url,method,headers){var _this=this;var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return new Promise(function(resolve,reject){var request=new XMLHttpRequest();request.open(method,url,true);if('responseType'in options){request.responseType=options.responseType;}if(_typeof(headers)==='object'){Object.keys(headers).forEach(function(key){request.setRequestHeader(key,headers[key]);});}// now add custom headers from the user
  // (e.g. access tokens)
  var userHeaders=_this.headers;Object.keys(userHeaders).forEach(function(key){request.setRequestHeader(key,userHeaders[key]);});// Event triggered when upload starts
  request.onloadstart=function(event){//console.log('upload started: ', url)
  };// Event triggered when upload ends
  request.onloadend=function(event){//console.log('upload finished')
  };// Handle response message
  request.onreadystatechange=function(event){if(request.readyState===4){if(request.status===200){resolve(request.response);}else if(request.status===202){console.warn('some resources already existed: ',request);resolve(request.response);}else if(request.status===204){console.warn('empty response for request: ',request);resolve([]);}else{console.error('request failed: ',request);var error=new Error('request failed');error.request=request;error.response=request.response;error.status=request.status;console.error(error);console.error(error.response);reject(error);}}};// Event triggered while download progresses
  if('progressCallback'in options){if(typeof options.progressCallback==='function'){request.onprogress=options.progressCallback;}}// request.onprogress = function (event) {
  //   const loaded = progress.loaded;
  //   let total;
  //   let percentComplete;
  //   if (progress.lengthComputable) {
  //     total = progress.total;
  //     percentComplete = Math.round((loaded / total) * 100);
  //   j
  //   // console.log('download progress: ', percentComplete, ' %');
  //   return(percentComplete);
  // };
  if('data'in options){request.send(options.data);}else{request.send();}});}},{key:"_httpGet",value:function _httpGet(url,headers,responseType,progressCallback){return this._httpRequest(url,'get',headers,{responseType:responseType,progressCallback:progressCallback});}},{key:"_httpGetApplicationJson",value:function _httpGetApplicationJson(url){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var progressCallback=arguments.length>2?arguments[2]:undefined;if(_typeof(params)==='object'){if(!isEmptyObject(params)){url+=DICOMwebClient._parseQueryParameters(params);}}var headers={'Accept':MIMETYPES.DICOM_JSON};var responseType='json';return this._httpGet(url,headers,responseType,progressCallback);}},{key:"_httpGetByMimeType",value:function _httpGetByMimeType(url,mimeType,params){var responseType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'arraybuffer';var progressCallback=arguments.length>4?arguments[4]:undefined;if(_typeof(params)==='object'){if(!isEmptyObject(params)){url+=DICOMwebClient._parseQueryParameters(params);}}var headers={'Accept':"multipart/related; type=\"".concat(mimeType,"\"")};return this._httpGet(url,headers,responseType,progressCallback);}},{key:"_httpPost",value:function _httpPost(url,headers,data,progressCallback){return this._httpRequest(url,'post',headers,{data:data,progressCallback:progressCallback});}},{key:"_httpPostApplicationJson",value:function _httpPostApplicationJson(url,data,progressCallback){var headers={'Content-Type':MIMETYPES.DICOM_JSON};return this._httpPost(url,headers,data,progressCallback);}/**
         * Searches for DICOM studies.
         * @param {Object} options options object
         * @return {Array} study representations (http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_6.7.html#table_6.7.1-2)
         */},{key:"searchForStudies",value:function searchForStudies(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};console.log('search for studies');var url=this.qidoURL+'/studies';if('queryParams'in options){url+=DICOMwebClient._parseQueryParameters(options.queryParams);}return this._httpGetApplicationJson(url);}/**
         * Retrieves metadata for a DICOM study.
         * @param {Object} options options object
         * @returns {Array} metadata elements in DICOM JSON format for each instance belonging to the study
         */},{key:"retrieveStudyMetadata",value:function retrieveStudyMetadata(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required for retrieval of study metadata');}console.log("retrieve metadata of study ".concat(options.studyInstanceUID));var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/metadata';return this._httpGetApplicationJson(url);}/**
         * Searches for DICOM series.
         * @param {Object} options options object
         * @returns {Array} series representations (http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_6.7.html#table_6.7.1-2a)
         */},{key:"searchForSeries",value:function searchForSeries(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var url=this.qidoURL;if('studyInstanceUID'in options){console.log("search series of study ".concat(options.studyInstanceUID));url+='/studies/'+options.studyInstanceUID;}url+='/series';if('queryParams'in options){url+=DICOMwebClient._parseQueryParameters(options.queryParams);}return this._httpGetApplicationJson(url);}/**
         * Retrieves metadata for a DICOM series.
         * @param {Object} options options object
         * @returns {Array} metadata elements in DICOM JSON format for each instance belonging to the series
         */},{key:"retrieveSeriesMetadata",value:function retrieveSeriesMetadata(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required for retrieval of series metadata');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required for retrieval of series metadata');}console.log("retrieve metadata of series ".concat(options.seriesInstanceUID));var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/series/'+options.seriesInstanceUID+'/metadata';return this._httpGetApplicationJson(url);}/**
         * Searches for DICOM instances.
         * @param {Object} options options object
         * @returns {Array} instance representations (http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_6.7.html#table_6.7.1-2b)
         */},{key:"searchForInstances",value:function searchForInstances(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var url=this.qidoURL;if('studyInstanceUID'in options){url+='/studies/'+options.studyInstanceUID;if('seriesInstanceUID'in options){console.log("search for instances of series ".concat(options.seriesInstanceUID));url+='/series/'+options.seriesInstanceUID;}else{console.log("search for instances of study ".concat(options.studyInstanceUID));}}else{console.log('search for instances');}url+='/instances';if('queryParams'in options){url+=DICOMwebClient._parseQueryParameters(options.queryParams);}return this._httpGetApplicationJson(url);}/** Returns a WADO-URI URL for an instance
         * @param {Object} options options object
         * @returns {String} WADO-URI URL
         */},{key:"buildInstanceWadoURIUrl",value:function buildInstanceWadoURIUrl(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required.');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required.');}if(!('sopInstanceUID'in options)){throw new Error('SOP Instance UID is required.');}var contentType=options.contentType||MIMETYPES.DICOM;var transferSyntax=options.transferSyntax||'*';var params=[];params.push('requestType=WADO');params.push("studyUID=".concat(options.studyInstanceUID));params.push("seriesUID=".concat(options.seriesInstanceUID));params.push("objectUID=".concat(options.sopInstanceUID));params.push("contentType=".concat(contentType));params.push("transferSyntax=".concat(transferSyntax));var paramString=params.join('&');return "".concat(this.wadoURL,"?").concat(paramString);}/**
         * Retrieves metadata for a DICOM instance.
         *
         * @param {Object} options object
         * @returns {Object} metadata elements in DICOM JSON format
         */},{key:"retrieveInstanceMetadata",value:function retrieveInstanceMetadata(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required for retrieval of instance metadata');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required for retrieval of instance metadata');}if(!('sopInstanceUID'in options)){throw new Error('SOP Instance UID is required for retrieval of instance metadata');}console.log("retrieve metadata of instance ".concat(options.sopInstanceUID));var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/series/'+options.seriesInstanceUID+'/instances/'+options.sopInstanceUID+'/metadata';return this._httpGetApplicationJson(url);}/**
         * Retrieves frames for a DICOM instance.
         * @param {Object} options options object
         * @returns {Array} frame items as byte arrays of the pixel data element
         */},{key:"retrieveInstanceFrames",value:function retrieveInstanceFrames(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required for retrieval of instance frames');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required for retrieval of instance frames');}if(!('sopInstanceUID'in options)){throw new Error('SOP Instance UID is required for retrieval of instance frames');}if(!('frameNumbers'in options)){throw new Error('frame numbers are required for retrieval of instance frames');}console.log("retrieve frames ".concat(options.frameNumbers.toString()," of instance ").concat(options.sopInstanceUID));var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/series/'+options.seriesInstanceUID+'/instances/'+options.sopInstanceUID+'/frames/'+options.frameNumbers.toString();var mimeType=options.mimeType?"".concat(options.mimeType):MIMETYPES.OCTET_STREAM;return this._httpGetByMimeType(url,mimeType).then(multipartDecode);}/**
         * Retrieves rendered frames for a DICOM instance.
         * @param {Object} options options object
         * @returns {Array} frame items as byte arrays of the pixel data element
         */},{key:"retrieveInstanceFramesRendered",value:function retrieveInstanceFramesRendered(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required for retrieval of rendered instance frames');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required for retrieval of rendered instance frames');}if(!('sopInstanceUID'in options)){throw new Error('SOP Instance UID is required for retrieval of rendered instance frames');}if(!('frameNumbers'in options)){throw new Error('frame numbers are required for retrieval of rendered instance frames');}console.log("retrieve rendered frames ".concat(options.frameNumbers.toString()," of instance ").concat(options.sopInstanceUID));var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/series/'+options.seriesInstanceUID+'/instances/'+options.sopInstanceUID+'/frames/'+options.frameNumbers.toString()+'/rendered';var headers={};// The choice of an acceptable media type depends on a variety of things:
  // http://dicom.nema.org/medical/dicom/current/output/chtml/part18/chapter_6.html#table_6.1.1-3
  if('mimeType'in options){headers['Accept']=options.mimeType;}var responseType='arraybuffer';return this._httpGet(url,headers,responseType);}/**
         * Retrieves a DICOM instance.
         * @param {Object} options options object
         * @returns {Arraybuffer} DICOM Part 10 file as Arraybuffer
         */},{key:"retrieveInstance",value:function retrieveInstance(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required');}if(!('sopInstanceUID'in options)){throw new Error('SOP Instance UID is required');}var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/series/'+options.seriesInstanceUID+'/instances/'+options.sopInstanceUID;return this._httpGetByMimeType(url,MIMETYPES.DICOM).then(multipartDecode).then(getFirstResult);}/**
         * Retrieves a set of DICOM instance for a series.
         * @param {Object} options options object
         * @returns {Arraybuffer[]} Array of DICOM Part 10 files as Arraybuffers
         */},{key:"retrieveSeries",value:function retrieveSeries(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required');}if(!('seriesInstanceUID'in options)){throw new Error('Series Instance UID is required');}var url=this.wadoURL+'/studies/'+options.studyInstanceUID+'/series/'+options.seriesInstanceUID;return this._httpGetByMimeType(url,MIMETYPES.DICOM).then(multipartDecode);}/**
         * Retrieves a set of DICOM instance for a study.
         * @param {Object} options options object
         * @returns {Arraybuffer[]} Array of DICOM Part 10 files as Arraybuffers
         */},{key:"retrieveStudy",value:function retrieveStudy(options){if(!('studyInstanceUID'in options)){throw new Error('Study Instance UID is required');}var url=this.wadoURL+'/studies/'+options.studyInstanceUID;return this._httpGetByMimeType(url,MIMETYPES.DICOM).then(multipartDecode);}/**
         * Retrieves and parses BulkData from a BulkDataURI location.
         * Decodes the multipart encoded data and returns the resulting data
         * as an ArrayBuffer.
         *
         * See http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_6.5.5.html
         *
         * @param {Object} options options object
         * @return {Promise}
         */},{key:"retrieveBulkData",value:function retrieveBulkData(options){if(!('BulkDataURI'in options)){throw new Error('BulkDataURI is required.');}return this._httpGetByMimeType(options.BulkDataURI,MIMETYPES.OCTET_STREAM).then(multipartDecode).then(getFirstResult);}/**
         * Stores DICOM instances.
         *
         * @param {Object} options options object
         */},{key:"storeInstances",value:function storeInstances(options){if(!('datasets'in options)){throw new Error('datasets are required for storing');}var url="".concat(this.stowURL,"/studies");if('studyInstanceUID'in options){url+="/".concat(options.studyInstanceUID);}var _multipartEncode=multipartEncode(options.datasets),data=_multipartEncode.data,boundary=_multipartEncode.boundary;var headers={'Content-Type':"multipart/related; type=application/dicom; boundary=".concat(boundary)};return this._httpPost(url,headers,data,options.progressCallback);}}],[{key:"_parseQueryParameters",value:function _parseQueryParameters(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var queryString='?';Object.keys(params).forEach(function(key,index){if(index!==0){queryString+='&';}queryString+=key+'='+encodeURIComponent(params[key]);});return queryString;}}]);return DICOMwebClient;}();function findSubstring(str,before,after){var beforeIndex=str.lastIndexOf(before)+before.length;if(beforeIndex<before.length){return null;}if(after!==undefined){var afterIndex=str.lastIndexOf(after);if(afterIndex<0){return null;}else{return str.substring(beforeIndex,afterIndex);}}return str.substring(beforeIndex);}function getStudyInstanceUIDFromUri(uri){var uid=findSubstring(uri,"studies/","/series");if(!uid){uid=findSubstring(uri,"studies/");}if(!uid){console.debug('Study Instance UID could not be dertermined from URI "'+uri+'"');}return uid;}function getSeriesInstanceUIDFromUri(uri){var uid=findSubstring(uri,"series/","/instances");if(!uid){uid=findSubstring(uri,"series/");}if(!uid){console.debug('Series Instance UID could not be dertermined from URI "'+uri+'"');}return uid;}function getSOPInstanceUIDFromUri(uri){var uid=findSubstring(uri,"/instances/","/frames");if(!uid){uid=findSubstring(uri,"/instances/","/metadata");}if(!uid){uid=findSubstring(uri,"/instances/");}if(!uid){console.debug('SOP Instance UID could not be dertermined from URI"'+uri+'"');}return uid;}function getFrameNumbersFromUri(uri){var numbers=findSubstring(uri,"/frames/","/rendered");if(!numbers){numbers=findSubstring(uri,"/frames/");}if(numbers===undefined){console.debug('Frames Numbers could not be dertermined from URI"'+uri+'"');}return numbers.split(',');}var version='0.3.2';var api={DICOMwebClient:DICOMwebClient};var utils={getStudyInstanceUIDFromUri:getStudyInstanceUIDFromUri,getSeriesInstanceUIDFromUri:getSeriesInstanceUIDFromUri,getSOPInstanceUIDFromUri:getSOPInstanceUIDFromUri,getFrameNumbersFromUri:getFrameNumbersFromUri};exports.api=api;exports.utils=utils;exports.version=version;Object.defineProperty(exports,'__esModule',{value:true});});});var DICOMwebClient=unwrapExports$1(dicomwebClient);/**
   * Parses data returned from a QIDO search and transforms it into
   * an array of series that are present in the study
   *
   * @param server The DICOM server
   * @param studyInstanceUid
   * @param resultData
   * @returns {Array} Series List
   */function resultDataToStudyMetadata(server,studyInstanceUid,resultData){var seriesMap={};var seriesList=[];resultData.forEach(function(instance){// Use seriesMap to cache series data
  // If the series instance UID has already been used to
  // process series data, continue using that series
  var seriesInstanceUid=DICOMWeb.getString(instance['0020000E']);var series=seriesMap[seriesInstanceUid];// If no series data exists in the seriesMap cache variable,
  // process any available series data
  if(!series){series={seriesInstanceUid:seriesInstanceUid,seriesNumber:DICOMWeb.getString(instance['00200011']),instances:[]};// Save this data in the seriesMap cache variable
  seriesMap[seriesInstanceUid]=series;seriesList.push(series);}// The uri for the dicomweb
  // NOTE: DCM4CHEE seems to return the data zipped
  // NOTE: Orthanc returns the data with multi-part mime which cornerstoneWADOImageLoader doesn't
  //       know how to parse yet
  //var uri = DICOMWeb.getString(instance['00081190']);
  //uri = uri.replace('wado-rs', 'dicom-web');
  // manually create a WADO-URI from the UIDs
  // NOTE: Haven't been able to get Orthanc's WADO-URI to work yet - maybe its not configured?
  var sopInstanceUid=DICOMWeb.getString(instance['00080018']);var uri=server.wadoUriRoot+'?requestType=WADO&studyUID='+studyInstanceUid+'&seriesUID='+seriesInstanceUid+'&objectUID='+sopInstanceUid+'&contentType=application%2Fdicom';// Add this instance to the current series
  series.instances.push({sopClassUid:DICOMWeb.getString(instance['00080016']),sopInstanceUid:sopInstanceUid,uri:uri,instanceNumber:DICOMWeb.getString(instance['00200013'])});});return seriesList;}/**
   * Retrieve a set of instances using a QIDO call
   * @param server
   * @param studyInstanceUid
   * @throws ECONNREFUSED
   * @returns {{wadoUriRoot: String, studyInstanceUid: String, seriesList: Array}}
   */function Instances(server,studyInstanceUid){// TODO: Are we using this function anywhere?? Can we remove it?
  var config={url:server.qidoRoot,headers:DICOMWeb.getAuthorizationHeader(server)};var dicomWeb=new DICOMwebClient.api.DICOMwebClient(config);var queryParams=getQIDOQueryParams(filter,server.qidoSupportsIncludeField);var options={studyInstanceUID:studyInstanceUid};return dicomWeb.searchForInstances(options).then(function(result){return {wadoUriRoot:server.wadoUriRoot,studyInstanceUid:studyInstanceUid,seriesList:resultDataToStudyMetadata(server,studyInstanceUid,result.data)};});}/**
   * Creates a QIDO date string for a date range query
   * Assumes the year is positive, at most 4 digits long.
   *
   * @param date The Date object to be formatted
   * @returns {string} The formatted date string
   */function dateToString(date){if(!date)return '';var year=date.getFullYear().toString();var month=(date.getMonth()+1).toString();var day=date.getDate().toString();year='0'.repeat(4-year.length).concat(year);month='0'.repeat(2-month.length).concat(month);day='0'.repeat(2-day.length).concat(day);return ''.concat(year,month,day);}/**
   * Produces a QIDO URL given server details and a set of specified search filter
   * items
   *
   * @param filter
   * @param serverSupportsQIDOIncludeField
   * @returns {string} The URL with encoded filter query data
   */function getQIDOQueryParams$1(filter,serverSupportsQIDOIncludeField){var commaSeparatedFields=['00081030',// Study Description
  '00080060'//Modality
  // Add more fields here if you want them in the result
  ].join(',');var parameters={PatientName:filter.patientName,PatientID:filter.patientId,AccessionNumber:filter.accessionNumber,StudyDescription:filter.studyDescription,ModalitiesInStudy:filter.modalitiesInStudy,limit:filter.limit,offset:filter.offset,includefield:serverSupportsQIDOIncludeField?commaSeparatedFields:'all'};// build the StudyDate range parameter
  if(filter.studyDateFrom||filter.studyDateTo){var dateFrom=dateToString(new Date(filter.studyDateFrom));var dateTo=dateToString(new Date(filter.studyDateTo));parameters.StudyDate="".concat(dateFrom,"-").concat(dateTo);}// Build the StudyInstanceUID parameter
  if(filter.studyInstanceUid){var studyUids=filter.studyInstanceUid;studyUids=Array.isArray(studyUids)?studyUids.join():studyUids;studyUids=studyUids.replace(/[^0-9.]+/g,'\\');parameters.StudyInstanceUID=studyUids;}// Clean query params of undefined values.
  var params={};Object.keys(parameters).forEach(function(key){if(parameters[key]!==undefined&&parameters[key]!==""){params[key]=parameters[key];}});return params;}/**
   * Parses resulting data from a QIDO call into a set of Study MetaData
   *
   * @param resultData
   * @returns {Array} An array of Study MetaData objects
   */function resultDataToStudies(resultData){var studies=[];if(!resultData||!resultData.length)return;resultData.forEach(function(study){return studies.push({studyInstanceUid:DICOMWeb.getString(study['0020000D']),// 00080005 = SpecificCharacterSet
  studyDate:DICOMWeb.getString(study['00080020']),studyTime:DICOMWeb.getString(study['00080030']),accessionNumber:DICOMWeb.getString(study['00080050']),referringPhysicianName:DICOMWeb.getString(study['00080090']),// 00081190 = URL
  patientName:DICOMWeb.getName(study['00100010']),patientId:DICOMWeb.getString(study['00100020']),patientBirthdate:DICOMWeb.getString(study['00100030']),patientSex:DICOMWeb.getString(study['00100040']),studyId:DICOMWeb.getString(study['00200010']),numberOfStudyRelatedSeries:DICOMWeb.getString(study['00201206']),numberOfStudyRelatedInstances:DICOMWeb.getString(study['00201208']),studyDescription:DICOMWeb.getString(study['00081030']),// modality: DICOMWeb.getString(study['00080060']),
  // modalitiesInStudy: DICOMWeb.getString(study['00080061']),
  modalities:DICOMWeb.getString(DICOMWeb.getModalities(study['00080060'],study['00080061']))});});return studies;}function Studies(server,filter){var config={url:server.qidoRoot,headers:DICOMWeb.getAuthorizationHeader(server)};var dicomWeb=new DICOMwebClient.api.DICOMwebClient(config);var queryParams=getQIDOQueryParams$1(filter,server.qidoSupportsIncludeField);var options={queryParams:queryParams};return dicomWeb.searchForStudies(options).then(resultDataToStudies);}var runtime=createCommonjsModule$1(function(module){/**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */!function(global){var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;// More compressible than void 0.
  var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";var runtime=global.regeneratorRuntime;if(runtime){{// If regeneratorRuntime is defined globally and we're in a module,
  // make the exports object identical to regeneratorRuntime.
  module.exports=runtime;}// Don't bother evaluating the rest of this file if the runtime was
  // already defined globally.
  return;}// Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime=global.regeneratorRuntime=module.exports;function wrap(innerFn,outerFn,self,tryLocsList){// If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
  var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);// The ._invoke method unifies the implementations of the .next,
  // .throw, and .return methods.
  generator._invoke=makeInvokeMethod(innerFn,self,context);return generator;}runtime.wrap=wrap;// Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn,obj,arg){try{return {type:"normal",arg:fn.call(obj,arg)};}catch(err){return {type:"throw",arg:err};}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";// Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel={};// Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}// This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this;};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){// This environment has a native %IteratorPrototype%; use it instead
  // of the polyfill.
  IteratorPrototype=NativeIteratorPrototype;}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction";// Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg);};});}runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||// For the native GeneratorFunction constructor, the best we can
  // do is to check its .name property.
  (ctor.displayName||ctor.name)==="GeneratorFunction":false;};runtime.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype);}else{genFun.__proto__=GeneratorFunctionPrototype;if(!(toStringTagSymbol in genFun)){genFun[toStringTagSymbol]="GeneratorFunction";}}genFun.prototype=Object.create(Gp);return genFun;};// Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  runtime.awrap=function(arg){return {__await:arg};};function AsyncIterator(generator){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg);}else{var result=record.arg;var value=result.value;if(value&&typeof value==="object"&&hasOwn.call(value,"__await")){return Promise.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);});}return Promise.resolve(value).then(function(unwrapped){// When a yielded Promise is resolved, its final value becomes
  // the .value of the Promise<{value,done}> result for the
  // current iteration.
  result.value=unwrapped;resolve(result);},function(error){// If a rejected Promise was yielded, throw the rejection back
  // into the async generator function so it can be handled there.
  return invoke("throw",error,resolve,reject);});}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=// If enqueue has been called before, then we want to wait until
  // all previous Promises have been resolved before calling invoke,
  // so that results are always delivered in the correct order. If
  // enqueue has not been called before, then it is important to
  // call invoke immediately, without waiting on a callback to fire,
  // so that the async generator function has the opportunity to do
  // any necessary setup in a predictable way. This predictability
  // is why the Promise constructor synchronously invokes its
  // executor callback, and why async functions synchronously
  // execute code before the first await. Since we implement simple
  // async functions in terms of async generators, it is especially
  // important to get this right, even though it requires care.
  previousPromise?previousPromise.then(callInvokeWithMethodAndArg,// Avoid propagating failures to Promises returned by later
  // invocations of the iterator.
  callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}// Define the unified helper method that is used to implement .next,
  // .throw, and .return (see defineIteratorMethods).
  this._invoke=enqueue;}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this;};runtime.AsyncIterator=AsyncIterator;// Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter// If outerFn is a generator, return the full iterator.
  :iter.next().then(function(result){return result.done?result.value:iter.next();});};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running");}if(state===GenStateCompleted){if(method==="throw"){throw arg;}// Be forgiving, per 25.3.3.3.3 of the spec:
  // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
  return doneResult();}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if(context.method==="next"){// Setting context._sent for legacy support of Babel's
  // function.sent implementation.
  context.sent=context._sent=context.arg;}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg;}context.dispatchException(context.arg);}else if(context.method==="return"){context.abrupt("return",context.arg);}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){// If an exception is thrown from innerFn, we leave state ===
  // GenStateExecuting and loop back for another invocation.
  state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue;}return {value:record.arg,done:context.done};}else if(record.type==="throw"){state=GenStateCompleted;// Dispatch the exception by looping back around to the
  // context.dispatchException(context.arg) call above.
  context.method="throw";context.arg=record.arg;}}};}// Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){// A .throw or .return when the delegate iterator has no .throw
  // method always terminates the yield* loop.
  context.delegate=null;if(context.method==="throw"){if(delegate.iterator.return){// If the delegate iterator has a return method, give it a
  // chance to clean up.
  context.method="return";context.arg=undefined;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){// If maybeInvokeDelegate(context) changed context.method from
  // "return" to "throw", let that override the TypeError below.
  return ContinueSentinel;}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method");}return ContinueSentinel;}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel;}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel;}if(info.done){// Assign the result of the finished delegate to the temporary
  // variable specified by delegate.resultName (see delegateYield).
  context[delegate.resultName]=info.value;// Resume execution at the desired location (see delegateYield).
  context.next=delegate.nextLoc;// If context.method was "throw" but the delegate handled the
  // exception, let the outer generator proceed normally. If
  // context.method was "next", forget context.arg since it has been
  // "consumed" by the delegate iterator. If context.method was
  // "return", allow the original .return call to continue in the
  // outer generator.
  if(context.method!=="return"){context.method="next";context.arg=undefined;}}else{// Re-yield the result returned by the delegate method.
  return info;}// The delegate iterator is finished, so forget it and continue with
  // the outer generator.
  context.delegate=null;return ContinueSentinel;}// Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);Gp[toStringTagSymbol]="Generator";// A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol]=function(){return this;};Gp.toString=function(){return "[object Generator]";};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1];}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3];}this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record;}function Context(tryLocsList){// The root entry object (effectively a try statement without a catch
  // or a finally block) gives us a place to store values thrown from
  // locations where there is no enclosing try statement.
  this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true);}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key);}keys.reverse();// Rather than returning an object with a next method, we keep
  // things simple and return the next function itself.
  return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next;}}// To avoid creating an additional object, we just hang the .value
  // and .done properties off the next function object itself. This
  // also ensures that the minifier will not anonymize the function.
  next.done=true;return next;};};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable);}if(typeof iterable.next==="function"){return iterable;}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next;}}next.value=undefined;next.done=true;return next;};return next.next=next;}}// Return an iterator with no values.
  return {next:doneResult};}runtime.values=values;function doneResult(){return {value:undefined,done:true};}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;// Resetting context._sent for legacy support of Babel's
  // function.sent implementation.
  this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.method="next";this.arg=undefined;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){// Not sure about the optimal order of these conditions:
  if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined;}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg;}return this.rval;},dispatchException:function(exception){if(this.done){throw exception;}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){// If the dispatched exception was caught by a catch block,
  // then let that catch block handle the exception normally.
  context.method="next";context.arg=undefined;}return !!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){// Exception thrown outside of any try block that could handle
  // it, so set the completion value of the entire function to
  // throw the exception.
  return handle("end");}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else{throw new Error("try statement without catch or finally");}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){// Ignore the finally entry if control is not jumping to a
  // location outside the try/catch block.
  finallyEntry=null;}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel;}return this.complete(record);},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg;}if(record.type==="break"||record.type==="continue"){this.next=record.arg;}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end";}else if(record.type==="normal"&&afterLoc){this.next=afterLoc;}return ContinueSentinel;},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel;}}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}// The context.catch method must only be called with a location
  // argument that corresponds to a known catch block.
  throw new Error("illegal catch attempt");},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){// Deliberately forget the last sent value so that we don't
  // accidentally pass it on to the delegate.
  this.arg=undefined;}return ContinueSentinel;}};}(// In sloppy mode, unbound `this` refers to the global object, fallback to
  // Function constructor if we're in global strict mode. That is sadly a form
  // of indirect eval which violates Content Security Policy.
  function(){return this||typeof self==="object"&&self;}()||Function("return this")());});/**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */ // This method of obtaining a reference to the global object needs to be
  // kept identical to the way it is obtained in runtime.js
  var g=function(){return this||typeof self==="object"&&self;}()||Function("return this")();// Use `getOwnPropertyNames` because not all browsers support calling
  // `hasOwnProperty` on the global `self` object in a worker. See #183.
  var hadRuntime=g.regeneratorRuntime&&Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime")>=0;// Save the old regeneratorRuntime in case it needs to be restored later.
  var oldRuntime=hadRuntime&&g.regeneratorRuntime;// Force reevalutation of runtime.js.
  g.regeneratorRuntime=undefined;var runtimeModule=runtime;if(hadRuntime){// Restore the original runtime.
  g.regeneratorRuntime=oldRuntime;}else{// Remove the global property added by runtime.js.
  try{delete g.regeneratorRuntime;}catch(e){g.regeneratorRuntime=undefined;}}var regenerator=runtimeModule;var WADOProxy={convertURL:function convertURL(url,server){// TODO: Remove all WADOProxy stuff from this file
  return url;}};function parseFloatArray(obj){var result=[];if(!obj){return result;}var objs=obj.split('\\');for(var i=0;i<objs.length;i++){result.push(parseFloat(objs[i]));}return result;}/**
   * Simple cache schema for retrieved color palettes.
   */var paletteColorCache={count:0,maxAge:24*60*60*1000,// 24h cache?
  entries:{},isValidUID:function isValidUID(paletteUID){return typeof paletteUID==='string'&&paletteUID.length>0;},get:function get(paletteUID){var entry=null;if(this.entries.hasOwnProperty(paletteUID)){entry=this.entries[paletteUID];// check how the entry is...
  if(Date.now()-entry.time>this.maxAge){// entry is too old... remove entry.
  delete this.entries[paletteUID];this.count--;entry=null;}}return entry;},add:function add(entry){if(this.isValidUID(entry.uid)){var paletteUID=entry.uid;if(this.entries.hasOwnProperty(paletteUID)!==true){this.count++;// increment cache entry count...
  }entry.time=Date.now();this.entries[paletteUID]=entry;// @TODO: Add logic to get rid of old entries and reduce memory usage...
  }}};/** Returns a WADO url for an instance
   *
   * @param studyInstanceUid
   * @param seriesInstanceUid
   * @param sopInstanceUid
   * @returns  {string}
   */function buildInstanceWadoUrl(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid){// TODO: This can be removed, since DICOMWebClient has the same function. Not urgent, though
  var params=[];params.push('requestType=WADO');params.push("studyUID=".concat(studyInstanceUid));params.push("seriesUID=".concat(seriesInstanceUid));params.push("objectUID=".concat(sopInstanceUid));params.push('contentType=application/dicom');params.push('transferSyntax=*');var paramString=params.join('&');return "".concat(server.wadoUriRoot,"?").concat(paramString);}function buildInstanceWadoRsUri(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid){return "".concat(server.wadoRoot,"/studies/").concat(studyInstanceUid,"/series/").concat(seriesInstanceUid,"/instances/").concat(sopInstanceUid);}function buildInstanceFrameWadoRsUri(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid,frame){var baseWadoRsUri=buildInstanceWadoRsUri(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid);frame=frame!=null||1;return "".concat(baseWadoRsUri,"/frames/").concat(frame);}/**
   * Parses the SourceImageSequence, if it exists, in order
   * to return a ReferenceSOPInstanceUID. The ReferenceSOPInstanceUID
   * is used to refer to this image in any accompanying DICOM-SR documents.
   *
   * @param instance
   * @returns {String} The ReferenceSOPInstanceUID
   */function getSourceImageInstanceUid(instance){// TODO= Parse the whole Source Image Sequence
  // This is a really poor workaround for now.
  // Later we should probably parse the whole sequence.
  var SourceImageSequence=instance['00082112'];if(SourceImageSequence&&SourceImageSequence.Value&&SourceImageSequence.Value.length){return SourceImageSequence.Value[0]['00081155'].Value[0];}}function getPaletteColor(server,instance,tag,lutDescriptor){var numLutEntries=lutDescriptor[0];var bits=lutDescriptor[2];var uri=WADOProxy.convertURL(instance[tag].BulkDataURI,server);// TODO: Workaround for dcm4chee behind SSL-terminating proxy returning
  // incorrect bulk data URIs
  if(server.wadoRoot.indexOf('https')===0&&!uri.includes('https')){uri=uri.replace('http','https');}var config={url:server.wadoRoot,//BulkDataURI is absolute, so this isn't used
  headers:DICOMWeb.getAuthorizationHeader(server)};var dicomWeb=new DICOMwebClient.api.DICOMwebClient(config);var options={BulkDataURI:uri};var readUInt16=function readUInt16(byteArray,position){return byteArray[position]+byteArray[position+1]*256;};var arrayBufferToPaletteColorLUT=function arrayBufferToPaletteColorLUT(arraybuffer){var byteArray=new Uint8Array(arraybuffer);var lut=[];for(var i=0;i<numLutEntries;i++){if(bits===16){lut[i]=readUInt16(byteArray,i*2);}else{lut[i]=byteArray[i];}}return lut;};return dicomWeb.retrieveBulkData(options).then(arrayBufferToPaletteColorLUT);}/**
   * Fetch palette colors for instances with "PALETTE COLOR" photometricInterpretation.
   *
   * @param server {Object} Current server;
   * @param instance {Object} The retrieved instance metadata;
   * @returns {String} The ReferenceSOPInstanceUID
   */function getPaletteColors(_x,_x2,_x3){return _getPaletteColors.apply(this,arguments);}function _getPaletteColors(){_getPaletteColors=_asyncToGenerator(/*#__PURE__*/regenerator.mark(function _callee(server,instance,lutDescriptor){var paletteUID;return regenerator.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:paletteUID=DICOMWeb.getString(instance['00281199']);return _context.abrupt("return",new Promise(function(resolve,reject){if(paletteColorCache.isValidUID(paletteUID)){var _entry=paletteColorCache.get(paletteUID);if(_entry){return resolve(_entry);}}// no entry in cache... Fetch remote data.
  var r=getPaletteColor(server,instance,'00281201',lutDescriptor);var g=getPaletteColor(server,instance,'00281202',lutDescriptor);var b=getPaletteColor(server,instance,'00281203',lutDescriptor);var promises=[r,g,b];Promise.all(promises).then(function(args){entry={red:args[0],green:args[1],blue:args[2]};// when paletteUID is present, the entry can be cached...
  entry.uid=paletteUID;paletteColorCache.add(entry);resolve(entry);});}));case 2:case"end":return _context.stop();}}},_callee,this);}));return _getPaletteColors.apply(this,arguments);}function getFrameIncrementPointer(element){var frameIncrementPointerNames={'00181065':'frameTimeVector','00181063':'frameTime'};if(!element||!element.Value||!element.Value.length){return;}var value=element.Value[0];return frameIncrementPointerNames[value];}function getRadiopharmaceuticalInfo(instance){var modality=DICOMWeb.getString(instance['00080060']);if(modality!=='PT'){return;}var radiopharmaceuticalInfo=instance['00540016'];if(radiopharmaceuticalInfo===undefined||!radiopharmaceuticalInfo.Value||!radiopharmaceuticalInfo.Value.length){return;}var firstPetRadiopharmaceuticalInfo=radiopharmaceuticalInfo.Value[0];return {radiopharmaceuticalStartTime:DICOMWeb.getString(firstPetRadiopharmaceuticalInfo['00181072']),radionuclideTotalDose:DICOMWeb.getNumber(firstPetRadiopharmaceuticalInfo['00181074']),radionuclideHalfLife:DICOMWeb.getNumber(firstPetRadiopharmaceuticalInfo['00181075'])};}/**
   * Parses result data from a WADO search into Study MetaData
   * Returns an object populated with study metadata, including the
   * series list.
   *
   * @param server
   * @param studyInstanceUid
   * @param resultData
   * @returns {{seriesList: Array, patientName: *, patientId: *, accessionNumber: *, studyDate: *, modalities: *, studyDescription: *, imageCount: *, studyInstanceUid: *}}
   */function resultDataToStudyMetadata$1(_x4,_x5,_x6){return _resultDataToStudyMetadata.apply(this,arguments);}/**
   * Retrieve Study MetaData from a DICOM server using a WADO call
   *
   * @param server
   * @param studyInstanceUid
   * @returns {Promise}
   */function _resultDataToStudyMetadata(){_resultDataToStudyMetadata=_asyncToGenerator(/*#__PURE__*/regenerator.mark(function _callee3(server,studyInstanceUid,resultData){var _studyData;var anInstance,studyData,seriesMap;return regenerator.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(resultData.length){_context3.next=2;break;}return _context3.abrupt("return");case 2:anInstance=resultData[0];if(anInstance){_context3.next=5;break;}return _context3.abrupt("return");case 5:studyData=(_studyData={seriesList:[],studyInstanceUid:studyInstanceUid,wadoUriRoot:server.wadoUriRoot,patientName:DICOMWeb.getName(anInstance['00100010']),patientId:DICOMWeb.getString(anInstance['00100020']),patientAge:DICOMWeb.getNumber(anInstance['00101010']),patientSize:DICOMWeb.getNumber(anInstance['00101020']),patientWeight:DICOMWeb.getNumber(anInstance['00101030']),accessionNumber:DICOMWeb.getString(anInstance['00080050']),studyDate:DICOMWeb.getString(anInstance['00080020']),modalities:DICOMWeb.getString(anInstance['00080061']),studyDescription:DICOMWeb.getString(anInstance['00081030']),imageCount:DICOMWeb.getString(anInstance['00201208'])},_defineProperty$2(_studyData,"studyInstanceUid",DICOMWeb.getString(anInstance['0020000D'])),_defineProperty$2(_studyData,"institutionName",DICOMWeb.getString(anInstance['00080080'])),_studyData);seriesMap={};_context3.next=9;return Promise.all(resultData.map(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/regenerator.mark(function _callee2(instance){var seriesInstanceUid,series,sopInstanceUid,wadouri,baseWadoRsUri,wadorsuri,instanceSummary,redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor,palettes;return regenerator.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:seriesInstanceUid=DICOMWeb.getString(instance['0020000E']);series=seriesMap[seriesInstanceUid];if(!series){series={seriesDescription:DICOMWeb.getString(instance['0008103E']),modality:DICOMWeb.getString(instance['00080060']),seriesInstanceUid:seriesInstanceUid,seriesNumber:DICOMWeb.getNumber(instance['00200011']),seriesDate:DICOMWeb.getString(instance['00080021']),seriesTime:DICOMWeb.getString(instance['00080031']),instances:[]};seriesMap[seriesInstanceUid]=series;studyData.seriesList.push(series);}sopInstanceUid=DICOMWeb.getString(instance['00080018']);wadouri=buildInstanceWadoUrl(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid);baseWadoRsUri=buildInstanceWadoRsUri(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid);wadorsuri=buildInstanceFrameWadoRsUri(server,studyInstanceUid,seriesInstanceUid,sopInstanceUid);instanceSummary={imageType:DICOMWeb.getString(instance['00080008']),sopClassUid:DICOMWeb.getString(instance['00080016']),modality:DICOMWeb.getString(instance['00080060']),sopInstanceUid:sopInstanceUid,instanceNumber:DICOMWeb.getNumber(instance['00200013']),imagePositionPatient:DICOMWeb.getString(instance['00200032']),imageOrientationPatient:DICOMWeb.getString(instance['00200037']),frameOfReferenceUID:DICOMWeb.getString(instance['00200052']),sliceLocation:DICOMWeb.getNumber(instance['00201041']),samplesPerPixel:DICOMWeb.getNumber(instance['00280002']),photometricInterpretation:DICOMWeb.getString(instance['00280004']),planarConfiguration:DICOMWeb.getNumber(instance['00280006']),rows:DICOMWeb.getNumber(instance['00280010']),columns:DICOMWeb.getNumber(instance['00280011']),pixelSpacing:DICOMWeb.getString(instance['00280030']),pixelAspectRatio:DICOMWeb.getString(instance['00280034']),bitsAllocated:DICOMWeb.getNumber(instance['00280100']),bitsStored:DICOMWeb.getNumber(instance['00280101']),highBit:DICOMWeb.getNumber(instance['00280102']),pixelRepresentation:DICOMWeb.getNumber(instance['00280103']),smallestPixelValue:DICOMWeb.getNumber(instance['00280106']),largestPixelValue:DICOMWeb.getNumber(instance['00280107']),windowCenter:DICOMWeb.getString(instance['00281050']),windowWidth:DICOMWeb.getString(instance['00281051']),rescaleIntercept:DICOMWeb.getNumber(instance['00281052']),rescaleSlope:DICOMWeb.getNumber(instance['00281053']),rescaleType:DICOMWeb.getNumber(instance['00281054']),sourceImageInstanceUid:getSourceImageInstanceUid(instance),laterality:DICOMWeb.getString(instance['00200062']),viewPosition:DICOMWeb.getString(instance['00185101']),acquisitionDateTime:DICOMWeb.getString(instance['0008002A']),numberOfFrames:DICOMWeb.getNumber(instance['00280008']),frameIncrementPointer:getFrameIncrementPointer(instance['00280009']),frameTime:DICOMWeb.getNumber(instance['00181063']),frameTimeVector:parseFloatArray(DICOMWeb.getString(instance['00181065'])),sliceThickness:DICOMWeb.getNumber(instance['00180050']),lossyImageCompression:DICOMWeb.getString(instance['00282110']),derivationDescription:DICOMWeb.getString(instance['00282111']),lossyImageCompressionRatio:DICOMWeb.getString(instance['00282112']),lossyImageCompressionMethod:DICOMWeb.getString(instance['00282114']),echoNumber:DICOMWeb.getString(instance['00180086']),contrastBolusAgent:DICOMWeb.getString(instance['00180010']),radiopharmaceuticalInfo:getRadiopharmaceuticalInfo(instance),baseWadoRsUri:baseWadoRsUri,wadouri:WADOProxy.convertURL(wadouri,server),wadorsuri:WADOProxy.convertURL(wadorsuri,server),imageRendering:server.imageRendering,thumbnailRendering:server.thumbnailRendering};// Get additional information if the instance uses "PALETTE COLOR" photometric interpretation
  if(!(instanceSummary.photometricInterpretation==='PALETTE COLOR')){_context2.next=16;break;}redPaletteColorLookupTableDescriptor=parseFloatArray(DICOMWeb.getString(instance['00281101']));greenPaletteColorLookupTableDescriptor=parseFloatArray(DICOMWeb.getString(instance['00281102']));bluePaletteColorLookupTableDescriptor=parseFloatArray(DICOMWeb.getString(instance['00281103']));_context2.next=14;return getPaletteColors(server,instance,redPaletteColorLookupTableDescriptor);case 14:palettes=_context2.sent;if(palettes){if(palettes.uid){instanceSummary.paletteColorLookupTableUID=palettes.uid;}instanceSummary.redPaletteColorLookupTableData=palettes.red;instanceSummary.greenPaletteColorLookupTableData=palettes.green;instanceSummary.bluePaletteColorLookupTableData=palettes.blue;instanceSummary.redPaletteColorLookupTableDescriptor=redPaletteColorLookupTableDescriptor;instanceSummary.greenPaletteColorLookupTableDescriptor=greenPaletteColorLookupTableDescriptor;instanceSummary.bluePaletteColorLookupTableDescriptor=bluePaletteColorLookupTableDescriptor;}case 16:series.instances.push(instanceSummary);case 17:case"end":return _context2.stop();}}},_callee2,this);}));return function(_x9){return _ref.apply(this,arguments);};}()));case 9:return _context3.abrupt("return",studyData);case 10:case"end":return _context3.stop();}}},_callee3,this);}));return _resultDataToStudyMetadata.apply(this,arguments);}function RetrieveMetadata(_x7,_x8){return _RetrieveMetadata.apply(this,arguments);}function _RetrieveMetadata(){_RetrieveMetadata=_asyncToGenerator(/*#__PURE__*/regenerator.mark(function _callee4(server,studyInstanceUid){var config,dicomWeb,options;return regenerator.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:config={url:server.wadoRoot,headers:DICOMWeb.getAuthorizationHeader(server)};dicomWeb=new DICOMwebClient.api.DICOMwebClient(config);options={studyInstanceUID:studyInstanceUid};return _context4.abrupt("return",dicomWeb.retrieveStudyMetadata(options).then(function(result){return resultDataToStudyMetadata$1(server,studyInstanceUid,result);}));case 4:case"end":return _context4.stop();}}},_callee4,this);}));return _RetrieveMetadata.apply(this,arguments);}// DICOMWeb instance, study, and metadata retrieval
  var WADO={RetrieveMetadata:RetrieveMetadata};var QIDO={Studies:Studies,Instances:Instances};var log$1={error:console.error,warn:console.warn,info:console.log,debug:console.debug,time:console.time,timeEnd:console.timeEnd};// promises and prevent unnecessary subsequent calls to the server
  var StudyMetaDataPromises=new Map();/**
   * Delete the cached study metadata retrieval promise to ensure that the browser will
   * re-retrieve the study metadata when it is next requested
   *
   * @param {String} studyInstanceUid The UID of the Study to be removed from cache
   *
   */function deleteStudyMetadataPromise(studyInstanceUid){if(StudyMetaDataPromises.has(studyInstanceUid)){StudyMetaDataPromises.delete(studyInstanceUid);}}/**
   * Retrieves study metadata using a server call
   *
   * @param {String} studyInstanceUid The UID of the Study to be retrieved
   * @returns {Promise} that will be resolved with the metadata or rejected with the error
   */function retrieveStudyMetadata(server,studyInstanceUid,seriesInstanceUids){// @TODO: Whenever a study metadata request has failed, its related promise will be rejected once and for all
  // and further requests for that metadata will always fail. On failure, we probably need to remove the
  // corresponding promise from the "StudyMetaDataPromises" map...
  // If the StudyMetaDataPromises cache already has a pending or resolved promise related to the
  // given studyInstanceUid, then that promise is returned
  if(StudyMetaDataPromises.has(studyInstanceUid)){return StudyMetaDataPromises.get(studyInstanceUid);}var seriesKeys=Array.isArray(seriesInstanceUids)?'|'+seriesInstanceUids.join('|'):'';var timingKey="retrieveStudyMetadata[".concat(studyInstanceUid).concat(seriesKeys,"]");log$1.time(timingKey);// Create a promise to handle the data retrieval
  var promise=new Promise(function(resolve,reject){// If no study metadata is in the cache variable, we need to retrieve it from
  // the server with a call.
  if(server.type==='dicomWeb'&&server.requestOptions.requestFromBrowser===true){RetrieveMetadata(server,studyInstanceUid).then(function(data){resolve(data);},reject);}});// Store the promise in cache
  StudyMetaDataPromises.set(studyInstanceUid,promise);return promise;}/**
   * Constants
   */var STRING$1='string';var NUMBER$1='number';var FUNCTION='function';var OBJECT='object';/**
   * Class Definition
   */var Metadata=/*#__PURE__*/function(){/**
     * Constructor and Instance Methods
     */function Metadata(data,uid){_classCallCheck$b(this,Metadata);// Define the main "_data" private property as an immutable property.
  // IMPORTANT: This property can only be set during instance construction.
  Object.defineProperty(this,'_data',{configurable:false,enumerable:false,writable:false,value:data});// Define the main "_uid" private property as an immutable property.
  // IMPORTANT: This property can only be set during instance construction.
  Object.defineProperty(this,'_uid',{configurable:false,enumerable:false,writable:false,value:uid});// Define "_custom" properties as an immutable property.
  // IMPORTANT: This property can only be set during instance construction.
  Object.defineProperty(this,'_custom',{configurable:false,enumerable:false,writable:false,value:Object.create(null)});}_createClass$1(Metadata,[{key:"getData",value:function getData(){return this._data;}},{key:"getDataProperty",value:function getDataProperty(propertyName){var propertyValue;var _data=this._data;if(_data instanceof Object||_typeof$4(_data)===OBJECT&&_data!==null){propertyValue=_data[propertyName];}return propertyValue;}/**
       * Get unique object ID
       */},{key:"getObjectID",value:function getObjectID(){return this._uid;}/**
       * Set custom attribute value
       * @param {String} attribute Custom attribute name
       * @param {Any} value     Custom attribute value
       */},{key:"setCustomAttribute",value:function setCustomAttribute(attribute,value){this._custom[attribute]=value;}/**
       * Get custom attribute value
       * @param  {String} attribute Custom attribute name
       * @return {Any}              Custom attribute value
       */},{key:"getCustomAttribute",value:function getCustomAttribute(attribute){return this._custom[attribute];}/**
       * Check if a custom attribute exists
       * @param  {String} attribute Custom attribute name
       * @return {Boolean}          True if custom attribute exists or false if not
       */},{key:"customAttributeExists",value:function customAttributeExists(attribute){return attribute in this._custom;}/**
       * Set custom attributes in batch mode.
       * @param {Object} attributeMap An object whose own properties will be used as custom attributes.
       */},{key:"setCustomAttributes",value:function setCustomAttributes(attributeMap){var _hasOwn=Object.prototype.hasOwnProperty;var _custom=this._custom;for(var attribute in attributeMap){if(_hasOwn.call(attributeMap,attribute)){_custom[attribute]=attributeMap[attribute];}}}/**
       * Static Methods
       */}],[{key:"isValidUID",value:function isValidUID(uid){return _typeof$4(uid)===STRING$1&&uid.length>0;}},{key:"isValidIndex",value:function isValidIndex(index){return _typeof$4(index)===NUMBER$1&&index>=0&&(index|0)===index;}},{key:"isValidCallback",value:function isValidCallback(callback){return _typeof$4(callback)===FUNCTION;}}]);return Metadata;}();// @TODO: improve this object
  /**
   * Objects to be used to throw errors
   */var OHIFError=/*#__PURE__*/function(_Error){_inherits$b(OHIFError,_Error);function OHIFError(message){var _this;_classCallCheck$b(this,OHIFError);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(OHIFError).call(this));_this.message=message;_this.stack=new Error().stack;_this.name=_this.constructor.name;return _this;}return OHIFError;}(_wrapNativeSuper(Error));/**
   * ATTENTION! This class should never depend on StudyMetadata or SeriesMetadata classes as this could
   * possibly cause circular dependency issues.
   */var UNDEFINED='undefined';var STRING$2='string';var STUDY_INSTANCE_UID='x0020000d';var SERIES_INSTANCE_UID='x0020000e';var InstanceMetadata=/*#__PURE__*/function(_Metadata){_inherits$b(InstanceMetadata,_Metadata);function InstanceMetadata(data,uid){var _this;_classCallCheck$b(this,InstanceMetadata);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(InstanceMetadata).call(this,data,uid));// Initialize Private Properties
  Object.defineProperties(_assertThisInitialized$2(_assertThisInitialized$2(_this)),{_sopInstanceUID:{configurable:true,// configurable so that it can be redefined in sub-classes...
  enumerable:false,writable:true,value:null},_imageId:{configurable:true,// configurable so that it can be redefined in sub-classes...
  enumerable:false,writable:true,value:null}});// Initialize Public Properties
  _this._definePublicProperties();return _this;}/**
     * Private Methods
     */ /**
     * Define Public Properties
     * This method should only be called during initialization (inside the class constructor)
     */_createClass$1(InstanceMetadata,[{key:"_definePublicProperties",value:function _definePublicProperties(){/**
         * Property: this.sopInstanceUID
         * Same as this.getSOPInstanceUID()
         * It's specially useful in contexts where a method call is not suitable like in search criteria. For example:
         * sopInstanceCollection.findBy({
         *   sopInstanceUID: '1.2.3.4.5.6.77777.8888888.99999999999.0'
         * });
         */Object.defineProperty(this,'sopInstanceUID',{configurable:false,enumerable:false,get:function get(){return this.getSOPInstanceUID();}});}/**
       * Public Methods
       */ /**
       * Returns the StudyInstanceUID of the current instance. This method is basically a shorthand the full "getTagValue" method call.
       */},{key:"getStudyInstanceUID",value:function getStudyInstanceUID(){return this.getTagValue(STUDY_INSTANCE_UID,null);}/**
       * Returns the SeriesInstanceUID of the current instance. This method is basically a shorthand the full "getTagValue" method call.
       */},{key:"getSeriesInstanceUID",value:function getSeriesInstanceUID(){return this.getTagValue(SERIES_INSTANCE_UID,null);}/**
       * Returns the SOPInstanceUID of the current instance.
       */},{key:"getSOPInstanceUID",value:function getSOPInstanceUID(){return this._sopInstanceUID;}// @TODO: Improve this... (E.g.: blob data)
  },{key:"getStringValue",value:function getStringValue(tagOrProperty,index,defaultValue){var value=this.getTagValue(tagOrProperty,defaultValue);if(_typeof$4(value)!==STRING$2&&_typeof$4(value)!==UNDEFINED){value=value.toString();}return InstanceMetadata.getIndexedValue(value,index,defaultValue);}// @TODO: Improve this... (E.g.: blob data)
  },{key:"getFloatValue",value:function getFloatValue(tagOrProperty,index,defaultValue){var value=this.getTagValue(tagOrProperty,defaultValue);value=InstanceMetadata.getIndexedValue(value,index,defaultValue);if(value instanceof Array){value.forEach(function(val,idx){value[idx]=parseFloat(val);});return value;}return _typeof$4(value)===STRING$2?parseFloat(value):value;}// @TODO: Improve this... (E.g.: blob data)
  },{key:"getIntValue",value:function getIntValue(tagOrProperty,index,defaultValue){var value=this.getTagValue(tagOrProperty,defaultValue);value=InstanceMetadata.getIndexedValue(value,index,defaultValue);if(value instanceof Array){value.forEach(function(val,idx){value[idx]=parseFloat(val);});return value;}return _typeof$4(value)===STRING$2?parseInt(value):value;}/**
       * @deprecated Please use getTagValue instead.
       */},{key:"getRawValue",value:function getRawValue(tagOrProperty,defaultValue){return this.getTagValue(tagOrProperty,defaultValue);}/**
       * This function should be overriden by specialized classes in order to allow client libraries or viewers to take advantage of the Study Metadata API.
       */},{key:"getTagValue",value:function getTagValue(tagOrProperty,defaultValue){/**
         * Please override this method on a specialized class.
         */throw new OHIFError('InstanceMetadata::getTagValue is not overriden. Please, override it in a specialized class. See OHIFInstanceMetadata for example');}/**
       * Compares the current instance with another one.
       * @param {InstanceMetadata} instance An instance of the InstanceMetadata class.
       * @returns {boolean} Returns true if both instances refer to the same instance.
       */},{key:"equals",value:function equals(instance){var self=this;return instance===self||instance instanceof InstanceMetadata&&instance.getSOPInstanceUID()===self.getSOPInstanceUID();}/**
       * Check if the tagOrProperty exists
       * @param  {String} tagOrProperty tag or property be checked
       * @return {Boolean}   True if the tag or property exists or false if doesn't
       */},{key:"tagExists",value:function tagExists(tagOrProperty){/**
         * Please override this method
         */throw new OHIFError('InstanceMetadata::tagExists is not overriden. Please, override it in a specialized class. See OHIFInstanceMetadata for example');}/**
       * Get custom image id of a sop instance
       * @return {Any}          sop instance image id
       */},{key:"getImageId",value:function getImageId(frame){/**
         * Please override this method
         */throw new OHIFError('InstanceMetadata::getImageId is not overriden. Please, override it in a specialized class. See OHIFInstanceMetadata for example');}/**
       * Static Methods
       */ /**
       * Get an value based that can be index based. This function is called by all getters. See above functions.
       *     - If value is a String and has indexes:
       *         - If undefined index: returns an array of the split values.
       *         - If defined index:
       *             - If invalid: returns defaultValue
       *             - If valid: returns the indexed value
       *      - If value is not a String, returns default value.
       */}],[{key:"getIndexedValue",value:function getIndexedValue(value,index,defaultValue){var result=defaultValue;if(_typeof$4(value)===STRING$2){var hasIndexValues=value.indexOf('\\')!==-1;result=value;if(hasIndexValues){var splitValues=value.split('\\');if(Metadata.isValidIndex(index)){var indexedValue=splitValues[index];result=_typeof$4(indexedValue)!==STRING$2?defaultValue:indexedValue;}else{result=splitValues;}}}return result;}}]);return InstanceMetadata;}(Metadata);var SeriesMetadata=/*#__PURE__*/function(_Metadata){_inherits$b(SeriesMetadata,_Metadata);function SeriesMetadata(data,uid){var _this;_classCallCheck$b(this,SeriesMetadata);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(SeriesMetadata).call(this,data,uid));// Initialize Private Properties
  Object.defineProperties(_assertThisInitialized$2(_assertThisInitialized$2(_this)),{_seriesInstanceUID:{configurable:true,// configurable so that it can be redefined in sub-classes...
  enumerable:false,writable:true,value:null},_instances:{configurable:false,enumerable:false,writable:false,value:[]},_firstInstance:{configurable:false,enumerable:false,writable:true,value:null}});// Initialize Public Properties
  _this._definePublicProperties();return _this;}/**
     * Private Methods
     */ /**
     * Define Public Properties
     * This method should only be called during initialization (inside the class constructor)
     */_createClass$1(SeriesMetadata,[{key:"_definePublicProperties",value:function _definePublicProperties(){/**
         * Property: this.seriesInstanceUID
         * Same as this.getSeriesInstanceUID()
         * It's specially useful in contexts where a method call is not suitable like in search criteria. For example:
         * seriesCollection.findBy({
         *   seriesInstanceUID: '1.2.3.4.5.6.77777.8888888.99999999999.0'
         * });
         */Object.defineProperty(this,'seriesInstanceUID',{configurable:false,enumerable:false,get:function get(){return this.getSeriesInstanceUID();}});}/**
       * Public Methods
       */ /**
       * Returns the SeriesInstanceUID of the current series.
       */},{key:"getSeriesInstanceUID",value:function getSeriesInstanceUID(){return this._seriesInstanceUID;}/**
       * Append an instance to the current series.
       * @param {InstanceMetadata} instance The instance to be added to the current series.
       * @returns {boolean} Returns true on success, false otherwise.
       */},{key:"addInstance",value:function addInstance(instance){var result=false;if(instance instanceof InstanceMetadata&&this.getInstanceByUID(instance.getSOPInstanceUID())===void 0){this._instances.push(instance);result=true;}return result;}/**
       * Get the first instance of the current series retaining a consistent result across multiple calls.
       * @return {InstanceMetadata} An instance of the InstanceMetadata class or null if it does not exist.
       */},{key:"getFirstInstance",value:function getFirstInstance(){var instance=this._firstInstance;if(!(instance instanceof InstanceMetadata)){instance=null;var found=this.getInstanceByIndex(0);if(found instanceof InstanceMetadata){this._firstInstance=found;instance=found;}}return instance;}/**
       * Find an instance by index.
       * @param {number} index An integer representing a list index.
       * @returns {InstanceMetadata} Returns a InstanceMetadata instance when found or undefined otherwise.
       */},{key:"getInstanceByIndex",value:function getInstanceByIndex(index){var found;// undefined by default...
  if(Metadata.isValidIndex(index)){found=this._instances[index];}return found;}/**
       * Find an instance by SOPInstanceUID.
       * @param {string} uid An UID string.
       * @returns {InstanceMetadata} Returns a InstanceMetadata instance when found or undefined otherwise.
       */},{key:"getInstanceByUID",value:function getInstanceByUID(uid){var found;// undefined by default...
  if(Metadata.isValidUID(uid)){found=this._instances.find(function(instance){return instance.getSOPInstanceUID()===uid;});}return found;}/**
       * Retrieve the number of instances within the current series.
       * @returns {number} The number of instances in the current series.
       */},{key:"getInstanceCount",value:function getInstanceCount(){return this._instances.length;}/**
       * Invokes the supplied callback for each instance in the current series passing
       * two arguments: instance (an InstanceMetadata instance) and index (the integer
       * index of the instance within the current series)
       * @param {function} callback The callback function which will be invoked for each instance in the series.
       * @returns {undefined} Nothing is returned.
       */},{key:"forEachInstance",value:function forEachInstance(callback){if(Metadata.isValidCallback(callback)){this._instances.forEach(function(instance,index){callback.call(null,instance,index);});}}/**
       * Find the index of an instance inside the series.
       * @param {InstanceMetadata} instance An instance of the SeriesMetadata class.
       * @returns {number} The index of the instance inside the series or -1 if not found.
       */},{key:"indexOfInstance",value:function indexOfInstance(instance){return this._instances.indexOf(instance);}/**
       * Search the associated instances using the supplied callback as criteria. The callback is passed
       * two arguments: instance (a InstanceMetadata instance) and index (the integer
       * index of the instance within its series)
       * @param {function} callback The callback function which will be invoked for each instance.
       * @returns {InstanceMetadata|undefined} If an instance is found based on callback criteria it
       *                                     returns a InstanceMetadata. "undefined" is returned otherwise
       */},{key:"findInstance",value:function findInstance(callback){if(Metadata.isValidCallback(callback)){return this._instances.find(function(instance,index){return callback.call(null,instance,index);});}}/**
       * Compares the current series with another one.
       * @param {SeriesMetadata} series An instance of the SeriesMetadata class.
       * @returns {boolean} Returns true if both instances refer to the same series.
       */},{key:"equals",value:function equals(series){var self=this;return series===self||series instanceof SeriesMetadata&&series.getSeriesInstanceUID()===self.getSeriesInstanceUID();}}]);return SeriesMetadata;}(Metadata);/**
   * Create a random GUID
   *
   * @return {string}
   */function guid(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}return s4()+s4()+'-'+s4()+'-'+s4()+'-'+s4()+'-'+s4()+s4()+s4();}var OBJECT$1='object';/**
   * This class defines an ImageSet object which will be used across the viewer. This object represents
   * a list of images that are associated by any arbitrary criteria being thus content agnostic. Besides the
   * main attributes (images and uid) it allows additional attributes to be appended to it (currently
   * indiscriminately, but this should be changed).
   */var ImageSet=/*#__PURE__*/function(){function ImageSet(images){_classCallCheck$b(this,ImageSet);if(Array.isArray(images)!==true){throw new OHIFError('ImageSet expects an array of images');}// @property "images"
  Object.defineProperty(this,'images',{enumerable:false,configurable:false,writable:false,value:images});// @property "uid"
  Object.defineProperty(this,'uid',{enumerable:false,configurable:false,writable:false,value:guid()// Unique ID of the instance
  });}_createClass$1(ImageSet,[{key:"getUID",value:function getUID(){return this.uid;}},{key:"setAttribute",value:function setAttribute(attribute,value){this[attribute]=value;}},{key:"getAttribute",value:function getAttribute(attribute){return this[attribute];}},{key:"setAttributes",value:function setAttributes(attributes){if(_typeof$4(attributes)===OBJECT$1&&attributes!==null){var imageSet=this,hasOwn=Object.prototype.hasOwnProperty;for(var attribute in attributes){if(hasOwn.call(attributes,attribute)){imageSet[attribute]=attributes[attribute];}}}}},{key:"getImage",value:function getImage(index){return this.images[index];}},{key:"sortBy",value:function sortBy(sortingCallback){return this.images.sort(sortingCallback);}}]);return ImageSet;}();var StudyMetadata=/*#__PURE__*/function(_Metadata){_inherits$b(StudyMetadata,_Metadata);function StudyMetadata(data,uid){var _this;_classCallCheck$b(this,StudyMetadata);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(StudyMetadata).call(this,data,uid));// Initialize Private Properties
  Object.defineProperties(_assertThisInitialized$2(_assertThisInitialized$2(_this)),{_studyInstanceUID:{configurable:true,// configurable so that it can be redefined in sub-classes...
  enumerable:false,writable:true,value:null},_series:{configurable:false,enumerable:false,writable:false,value:[]},_displaySets:{configurable:false,enumerable:false,writable:false,value:[]},_firstSeries:{configurable:false,enumerable:false,writable:true,value:null},_firstInstance:{configurable:false,enumerable:false,writable:true,value:null}});// Initialize Public Properties
  _this._definePublicProperties();return _this;}/**
     * Private Methods
     */ /**
     * Define Public Properties
     * This method should only be called during initialization (inside the class constructor)
     */_createClass$1(StudyMetadata,[{key:"_definePublicProperties",value:function _definePublicProperties(){/**
         * Property: this.studyInstanceUID
         * Same as this.getStudyInstanceUID()
         * It's specially useful in contexts where a method call is not suitable like in search criteria. For example:
         * studyCollection.findBy({
         *   studyInstanceUID: '1.2.3.4.5.6.77777.8888888.99999999999.0'
         * });
         */Object.defineProperty(this,'studyInstanceUID',{configurable:false,enumerable:false,get:function get(){return this.getStudyInstanceUID();}});}/**
       * Public Methods
       */ /**
       * Getter for displaySets
       * @return {Array} Array of display set object
       */},{key:"getDisplaySets",value:function getDisplaySets(){return this._displaySets.slice();}/**
       * Set display sets
       * @param {Array} displaySets Array of display sets (ImageSet[])
       */},{key:"setDisplaySets",value:function setDisplaySets(displaySets){var _this2=this;displaySets.forEach(function(displaySet){return _this2.addDisplaySet(displaySet);});}/**
       * Add a single display set to the list
       * @param {Object} displaySet Display set object
       * @returns {boolean} True on success, false on failure.
       */},{key:"addDisplaySet",value:function addDisplaySet(displaySet){if(displaySet instanceof ImageSet){this._displaySets.push(displaySet);return true;}return false;}/**
       * Invokes the supplied callback for each display set in the current study passing
       * two arguments: display set (a ImageSet instance) and index (the integer
       * index of the display set within the current study)
       * @param {function} callback The callback function which will be invoked for each display set instance.
       * @returns {undefined} Nothing is returned.
       */},{key:"forEachDisplaySet",value:function forEachDisplaySet(callback){if(Metadata.isValidCallback(callback)){this._displaySets.forEach(function(displaySet,index){callback.call(null,displaySet,index);});}}/**
       * Search the associated display sets using the supplied callback as criteria. The callback is passed
       * two arguments: display set (an ImageSet instance) and index (the integer
       * index of the display set within the current study)
       * @param {function} callback The callback function which will be invoked for each display set instance.
       * @returns {undefined} Nothing is returned.
       */},{key:"findDisplaySet",value:function findDisplaySet(callback){if(Metadata.isValidCallback(callback)){return this._displaySets.find(function(displaySet,index){return callback.call(null,displaySet,index);});}}/**
       * Retrieve the number of display sets within the current study.
       * @returns {number} The number of display sets in the current study.
       */},{key:"getDisplaySetCount",value:function getDisplaySetCount(){return this._displaySets.length;}/**
       * Returns the StudyInstanceUID of the current study.
       */},{key:"getStudyInstanceUID",value:function getStudyInstanceUID(){return this._studyInstanceUID;}/**
       * Getter for series
       * @return {Array} Array of SeriesMetadata object
       */},{key:"getSeries",value:function getSeries(){return this._series.slice();}/**
       * Append a series to the current study.
       * @param {SeriesMetadata} series The series to be added to the current study.
       * @returns {boolean} Returns true on success, false otherwise.
       */},{key:"addSeries",value:function addSeries(series){var result=false;if(series instanceof SeriesMetadata&&this.getSeriesByUID(series.getSeriesInstanceUID())===void 0){this._series.push(series);result=true;}return result;}/**
       * Find a series by index.
       * @param {number} index An integer representing a list index.
       * @returns {SeriesMetadata} Returns a SeriesMetadata instance when found or undefined otherwise.
       */},{key:"getSeriesByIndex",value:function getSeriesByIndex(index){var found;// undefined by default...
  if(Metadata.isValidIndex(index)){found=this._series[index];}return found;}/**
       * Find a series by SeriesInstanceUID.
       * @param {string} uid An UID string.
       * @returns {SeriesMetadata} Returns a SeriesMetadata instance when found or undefined otherwise.
       */},{key:"getSeriesByUID",value:function getSeriesByUID(uid){var found;// undefined by default...
  if(Metadata.isValidUID(uid)){found=this._series.find(function(series){return series.getSeriesInstanceUID()===uid;});}return found;}/**
       * Retrieve the number of series within the current study.
       * @returns {number} The number of series in the current study.
       */},{key:"getSeriesCount",value:function getSeriesCount(){return this._series.length;}/**
       * Retrieve the number of instances within the current study.
       * @returns {number} The number of instances in the current study.
       */},{key:"getInstanceCount",value:function getInstanceCount(){return this._series.reduce(function(sum,series){return sum+series.getInstanceCount();},0);}/**
       * Invokes the supplied callback for each series in the current study passing
       * two arguments: series (a SeriesMetadata instance) and index (the integer
       * index of the series within the current study)
       * @param {function} callback The callback function which will be invoked for each series instance.
       * @returns {undefined} Nothing is returned.
       */},{key:"forEachSeries",value:function forEachSeries(callback){if(Metadata.isValidCallback(callback)){this._series.forEach(function(series,index){callback.call(null,series,index);});}}/**
       * Find the index of a series inside the study.
       * @param {SeriesMetadata} series An instance of the SeriesMetadata class.
       * @returns {number} The index of the series inside the study or -1 if not found.
       */},{key:"indexOfSeries",value:function indexOfSeries(series){return this._series.indexOf(series);}/**
       * It sorts the series based on display sets order. Each series must be an instance
       * of SeriesMetadata and each display sets must be an instance of ImageSet.
       * Useful example of usage:
       *     Study data provided by backend does not sort series at all and client-side
       *     needs series sorted by the same criteria used for sorting display sets.
       */},{key:"sortSeriesByDisplaySets",value:function sortSeriesByDisplaySets(){var _this3=this;// Object for mapping display sets' index by seriesInstanceUid
  var displaySetsMapping={};// Loop through each display set to create the mapping
  this.forEachDisplaySet(function(displaySet,index){if(!(displaySet instanceof ImageSet)){throw new OHIFError("StudyMetadata::sortSeriesByDisplaySets display set at index ".concat(index," is not an instance of ImageSet"));}// In case of multiframe studies, just get the first index occurence
  if(displaySetsMapping[displaySet.seriesInstanceUid]===void 0){displaySetsMapping[displaySet.seriesInstanceUid]=index;}});// Clone of actual series
  var actualSeries=this.getSeries();actualSeries.forEach(function(series,index){if(!(series instanceof SeriesMetadata)){throw new OHIFError("StudyMetadata::sortSeriesByDisplaySets series at index ".concat(index," is not an instance of SeriesMetadata"));}// Get the new series index
  var seriesIndex=displaySetsMapping[series.getSeriesInstanceUID()];// Update the series object with the new series position
  _this3._series[seriesIndex]=series;});}/**
       * Compares the current study instance with another one.
       * @param {StudyMetadata} study An instance of the StudyMetadata class.
       * @returns {boolean} Returns true if both instances refer to the same study.
       */},{key:"equals",value:function equals(study){var self=this;return study===self||study instanceof StudyMetadata&&study.getStudyInstanceUID()===self.getStudyInstanceUID();}/**
       * Get the first series of the current study retaining a consistent result across multiple calls.
       * @return {SeriesMetadata} An instance of the SeriesMetadata class or null if it does not exist.
       */},{key:"getFirstSeries",value:function getFirstSeries(){var series=this._firstSeries;if(!(series instanceof SeriesMetadata)){series=null;var found=this.getSeriesByIndex(0);if(found instanceof SeriesMetadata){this._firstSeries=found;series=found;}}return series;}/**
       * Get the first instance of the current study retaining a consistent result across multiple calls.
       * @return {InstanceMetadata} An instance of the InstanceMetadata class or null if it does not exist.
       */},{key:"getFirstInstance",value:function getFirstInstance(){var instance=this._firstInstance;if(!(instance instanceof InstanceMetadata)){instance=null;var firstSeries=this.getFirstSeries();if(firstSeries instanceof SeriesMetadata){var found=firstSeries.getFirstInstance();if(found instanceof InstanceMetadata){this._firstInstance=found;instance=found;}}}return instance;}/**
       * Search the associated series to find an specific instance using the supplied callback as criteria.
       * The callback is passed two arguments: instance (a InstanceMetadata instance) and index (the integer
       * index of the instance within the current series)
       * @param {function} callback The callback function which will be invoked for each instance instance.
       * @returns {Object} Result object containing series (SeriesMetadata) and instance (InstanceMetadata)
       *                   objects or an empty object if not found.
       */},{key:"findSeriesAndInstanceByInstance",value:function findSeriesAndInstanceByInstance(callback){var result;if(Metadata.isValidCallback(callback)){var instance;var series=this._series.find(function(series){instance=series.findInstance(callback);return instance instanceof InstanceMetadata;});// No series found
  if(series instanceof SeriesMetadata){result={series:series,instance:instance};}}return result||{};}/**
       * Find series by instance using the supplied callback as criteria. The callback is passed
       * two arguments: instance (a InstanceMetadata instance) and index (the integer index of
       * the instance within its series)
       * @param {function} callback The callback function which will be invoked for each instance.
       * @returns {SeriesMetadata|undefined} If a series is found based on callback criteria it
       *                                     returns a SeriesMetadata. "undefined" is returned otherwise
       */},{key:"findSeriesByInstance",value:function findSeriesByInstance(callback){var result=this.findSeriesAndInstanceByInstance(callback);return result.series;}/**
       * Find an instance using the supplied callback as criteria. The callback is passed
       * two arguments: instance (a InstanceMetadata instance) and index (the integer index of
       * the instance within its series)
       * @param {function} callback The callback function which will be invoked for each instance.
       * @returns {InstanceMetadata|undefined} If an instance is found based on callback criteria it
       *                                     returns a InstanceMetadata. "undefined" is returned otherwise
       */},{key:"findInstance",value:function findInstance(callback){var result=this.findSeriesAndInstanceByInstance(callback);return result.instance;}}]);return StudyMetadata;}(Metadata);var WadoRsMetaDataBuilder=/*#__PURE__*/function(){function WadoRsMetaDataBuilder(){_classCallCheck$b(this,WadoRsMetaDataBuilder);this.tags={};}_createClass$1(WadoRsMetaDataBuilder,[{key:"addTag",value:function addTag(tag,value,multi){this.tags[tag]={tag:tag,value:value,multi:multi};return this;}},{key:"toJSON",value:function toJSON(){var _this=this;var json={};var keys=Object.keys(this.tags);keys.forEach(function(key){if(!_this.tags.hasOwnProperty(key)){return;}var tag=_this.tags[key];var multi=!!tag.multi;var value=tag.value;if(value==null||value.length===1&&value[0]==null){return;}if(typeof value==='string'&&multi){value=value.split('\\');}if(!Array.isArray(value)){value=[value];}json[key]={Value:value};});return json;}}]);return WadoRsMetaDataBuilder;}();function getWADORSImageUrl(instance,frame){var wadorsuri=instance.wadorsuri;if(!wadorsuri){return;}// We need to sum 1 because WADO-RS frame number is 1-based
  frame=(frame||0)+1;// Replaces /frame/1 by /frame/{frame}
  wadorsuri=wadorsuri.replace(/(%2Fframes%2F)(\d+)/,"$1".concat(frame));return wadorsuri;}/**
   * Obtain an imageId for Cornerstone based on the WADO-RS scheme
   *
   * @param {object} instanceMetada metadata object (InstanceMetadata)
   * @returns {string} The imageId to be used by Cornerstone
   */function getWADORSImageId(instance,frame){var uri=getWADORSImageUrl(instance,frame);if(!uri){return;}return "wadors:".concat(uri);}function getRadiopharmaceuticalInfoMetaData(instance){var radiopharmaceuticalInfo=instance.radiopharmaceuticalInfo;if(instance.modality!=='PT'||!radiopharmaceuticalInfo){return;}return new WadoRsMetaDataBuilder().addTag('00181072',radiopharmaceuticalInfo.radiopharmaceuticalStartTime).addTag('00181074',radiopharmaceuticalInfo.radionuclideTotalDose).addTag('00181075',radiopharmaceuticalInfo.radionuclideHalfLife).toJSON();}var getWadoRsInstanceMetaData=function getWadoRsInstanceMetaData(study,series,instance){return new WadoRsMetaDataBuilder().addTag('00080016',instance.sopClassUid).addTag('00080018',instance.sopInstanceUid).addTag('00080021',series.seriesDate).addTag('00080031',series.seriesTime).addTag('00080060',instance.modality).addTag('00101010',study.patientAge).addTag('00101020',study.patientSize).addTag('00101030',study.patientWeight).addTag('00180050',instance.sliceThickness).addTag('0020000e',series.seriesInstanceUid).addTag('00200011',series.seriesNumber).addTag('0020000d',study.studyInstanceUid).addTag('00200013',instance.instanceNumber).addTag('00200032',instance.imagePositionPatient,true).addTag('00200037',instance.imageOrientationPatient,true).addTag('00200052',instance.frameOfReferenceUID).addTag('00201041',instance.sliceLocation).addTag('00280002',instance.samplesPerPixel).addTag('00280004',instance.photometricInterpretation).addTag('00280006',instance.planarConfiguration).addTag('00280010',instance.rows).addTag('00280011',instance.columns).addTag('00280030',instance.pixelSpacing,true).addTag('00280034',instance.pixelAspectRatio,true).addTag('00280100',instance.bitsAllocated).addTag('00280101',instance.bitsStored).addTag('00280102',instance.highBit).addTag('00280103',instance.pixelRepresentation).addTag('00280106',instance.smallestPixelValue).addTag('00280107',instance.largestPixelValue).addTag('00281050',instance.windowCenter,true).addTag('00281051',instance.windowWidth,true).addTag('00281052',instance.rescaleIntercept).addTag('00281053',instance.rescaleSlope).addTag('00281054',instance.rescaleType).addTag('00281101',instance.redPaletteColorLookupTableDescriptor).addTag('00281102',instance.greenPaletteColorLookupTableDescriptor).addTag('00281103',instance.bluePaletteColorLookupTableDescriptor).addTag('00281201',instance.redPaletteColorLookupTableData).addTag('00281202',instance.greenPaletteColorLookupTableData).addTag('00281203',instance.bluePaletteColorLookupTableData).addTag('00540016',getRadiopharmaceuticalInfoMetaData(instance)).toJSON();};function updateMetaDataManager(study){study.seriesList.forEach(function(series){series.instances.forEach(function(instance){// Cache just images that are going to be loaded via WADO-RS
  if(instance.imageRendering!=='wadors'&&instance.thumbnailRendering!=='wadors'){return;}var metaData=getWadoRsInstanceMetaData(study,series,instance);var numberOfFrames=instance.numberOfFrames||1;// We can share the same metaData with all frames because it doesn't have
  // any frame specific data, such as frameNumber, pixelData, offset, etc.
  // WADO-RS frame number is 1-based
  for(var frameNumber=0;frameNumber<numberOfFrames;frameNumber++){var imageId=getWADORSImageId(instance,frameNumber);// TODO Drop dependency on this
  external.cornerstoneWADOImageLoader.wadors.metaDataManager.add(imageId,metaData);}});});}/**
   * Retrieves metaData for multiple studies at once.
   *
   * This function calls retrieveStudyMetadata several times, asynchronously,
   * and waits for all of the results to be returned.
   *
   * @param studyInstanceUids The UIDs of the Studies to be retrieved
   * @return Promise
   */function retrieveStudiesMetadata(server,studyInstanceUids,seriesInstanceUids){// Create an empty array to store the Promises for each metaData retrieval call
  var promises=[];// Loop through the array of studyInstanceUids
  studyInstanceUids.forEach(function(studyInstanceUid){// Send the call and resolve or reject the related promise based on its outcome
  var promise=retrieveStudyMetadata(server,studyInstanceUid,seriesInstanceUids);// Add the current promise to the array of promises
  promises.push(promise);});// When all of the promises are complete, this callback runs
  var promise=Promise.all(promises);// Warn the error on console if some retrieval failed
  promise.catch(function(error){return log$1.warn(error);});return promise;}/**
   * Overridable namespace to allow getting study boxes data externally.
   *
   * The function must handle the first parameter as a studyInformation object containing at least the
   * studyInstanceUid attribute.
   *
   * Shall return a promise that will be resolved with an object containing those attributes:
   * - studyInstanceUid {String}: copy of studyInformation.studyInstanceUid
   * - modalities {String}: 2 uppercase letters for each modality split by any non-alphabetical char(s)
   * - studyDate {String}: date formatted as YYYYMMDD
   * - studyDescription {String}: study description string
   */ // TODO: What is this for?
  var getStudyBoxData=false;/**
   * Creates a QIDO date string for a date range query
   * Assumes the year is positive, at most 4 digits long.
   *
   * @param date The Date object to be formatted
   * @returns {string} The formatted date string
   */function dateToString$1(date){if(!date)return '';var year=date.getFullYear().toString();var month=(date.getMonth()+1).toString();var day=date.getDate().toString();year='0'.repeat(4-year.length).concat(year);month='0'.repeat(2-month.length).concat(month);day='0'.repeat(2-day.length).concat(day);return ''.concat(year,month,day);}/**
   * Produces a QIDO URL given server details and a set of specified search filter
   * items
   *
   * @param filter
   * @param serverSupportsQIDOIncludeField
   * @returns {string} The URL with encoded filter query data
   */function getQIDOQueryParams$2(filter,serverSupportsQIDOIncludeField){var commaSeparatedFields=['00081030',// Study Description
  '00080060'//Modality
  // Add more fields here if you want them in the result
  ].join(',');var parameters={PatientName:filter.patientName,PatientID:filter.patientId,AccessionNumber:filter.accessionNumber,StudyDescription:filter.studyDescription,ModalitiesInStudy:filter.modalitiesInStudy,limit:filter.limit,offset:filter.offset,includefield:serverSupportsQIDOIncludeField?commaSeparatedFields:'all'};// build the StudyDate range parameter
  if(filter.studyDateFrom||filter.studyDateTo){var dateFrom=dateToString$1(new Date(filter.studyDateFrom));var dateTo=dateToString$1(new Date(filter.studyDateTo));parameters.StudyDate="".concat(dateFrom,"-").concat(dateTo);}// Build the StudyInstanceUID parameter
  if(filter.studyInstanceUid){var studyUids=filter.studyInstanceUid;studyUids=Array.isArray(studyUids)?studyUids.join():studyUids;studyUids=studyUids.replace(/[^0-9.]+/g,'\\');parameters.StudyInstanceUID=studyUids;}// Clean query params of undefined values.
  var params={};Object.keys(parameters).forEach(function(key){if(parameters[key]!==undefined&&parameters[key]!==""){params[key]=parameters[key];}});return params;}/**
   * Parses resulting data from a QIDO call into a set of Study MetaData
   *
   * @param resultData
   * @returns {Array} An array of Study MetaData objects
   */function resultDataToStudies$1(resultData){var studies=[];if(!resultData||!resultData.length)return;resultData.forEach(function(study){return studies.push({studyInstanceUid:DICOMWeb.getString(study['0020000D']),// 00080005 = SpecificCharacterSet
  studyDate:DICOMWeb.getString(study['00080020']),studyTime:DICOMWeb.getString(study['00080030']),accessionNumber:DICOMWeb.getString(study['00080050']),referringPhysicianName:DICOMWeb.getString(study['00080090']),// 00081190 = URL
  patientName:DICOMWeb.getName(study['00100010']),patientId:DICOMWeb.getString(study['00100020']),patientBirthdate:DICOMWeb.getString(study['00100030']),patientSex:DICOMWeb.getString(study['00100040']),studyId:DICOMWeb.getString(study['00200010']),numberOfStudyRelatedSeries:DICOMWeb.getString(study['00201206']),numberOfStudyRelatedInstances:DICOMWeb.getString(study['00201208']),studyDescription:DICOMWeb.getString(study['00081030']),// modality: DICOMWeb.getString(study['00080060']),
  // modalitiesInStudy: DICOMWeb.getString(study['00080061']),
  modalities:DICOMWeb.getString(DICOMWeb.getModalities(study['00080060'],study['00080061']))});});return studies;}function Studies$1(server,filter){var config={url:server.qidoRoot,headers:DICOMWeb.getAuthorizationHeader(server)};var dicomWeb=new DICOMwebClient.api.DICOMwebClient(config);var queryParams=getQIDOQueryParams$2(filter,server.qidoSupportsIncludeField);var options={queryParams:queryParams};return dicomWeb.searchForStudies(options).then(resultDataToStudies$1);}var studySearchPromises=new Map();/**
   * Search for studies information by the given filter
   *
   * @param {Object} filter Filter that will be used on search
   * @returns {Promise} resolved with an array of studies information or rejected with an error
   */function searchStudies(server,filter){var promiseKey=JSON.stringify(filter);if(studySearchPromises.has(promiseKey)){return studySearchPromises.get(promiseKey);}else{var promise=Studies$1(server,filter);studySearchPromises.set(promiseKey,promise);return promise;}}var studies={services:{QIDO:QIDO,WADO:WADO},loadingDict:{},retrieveStudyMetadata:retrieveStudyMetadata,deleteStudyMetadataPromise:deleteStudyMetadataPromise,retrieveStudiesMetadata:retrieveStudiesMetadata,getStudyBoxData:getStudyBoxData,searchStudies:searchStudies};function isFunction(subject){return typeof subject==='function';}var CommandsManager=/*#__PURE__*/function(){function CommandsManager(){_classCallCheck$b(this,CommandsManager);this.contexts={};// Enable reactivity by storing the last executed command
  //this.last = new ReactiveVar('');
  }_createClass$1(CommandsManager,[{key:"getContext",value:function getContext(contextName){var context=this.contexts[contextName];if(!context){return log$1.warn("No context found with name \"".concat(contextName,"\""));}return context;}},{key:"getCurrentContext",value:function getCurrentContext(){var contextName=OHIF.context.get();if(!contextName){return log$1.warn('There is no selected context');}return this.getContext(contextName);}},{key:"createContext",value:function createContext(contextName){if(!contextName)return;if(this.contexts[contextName]){return this.clear(contextName);}this.contexts[contextName]={};}},{key:"set",value:function set(contextName,definitions){var extend=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(_typeof$4(definitions)!=='object')return;var context=this.getContext(contextName);if(!context)return;if(!extend){this.clear(contextName);}Object.keys(definitions).forEach(function(command){return context[command]=definitions[command];});}},{key:"register",value:function register(contextName,command,definition){if(_typeof$4(definition)!=='object')return;var context=this.getContext(contextName);if(!context)return;context[command]=definition;}},{key:"setDisabledFunction",value:function setDisabledFunction(contextName,command,func){if(!command||typeof func!=='function')return;var context=this.getContext(contextName);if(!context)return;var definition=context[command];if(!definition){return log$1.warn("Trying to set a disabled function to a command \"".concat(command,"\" that was not yet defined"));}definition.disabled=func;}},{key:"clear",value:function clear(contextName){if(!contextName)return;this.contexts[contextName]={};}},{key:"getDefinition",value:function getDefinition(command){var context=this.getCurrentContext();if(!context)return;return context[command];}},{key:"isDisabled",value:function isDisabled(command){var definition=this.getDefinition(command);if(!definition)return false;var disabled=definition.disabled;if(isFunction(disabled)&&disabled())return true;if(!isFunction(disabled)&&disabled)return true;return false;}},{key:"run",value:function run(command){var definition=this.getDefinition(command);if(!definition){return log$1.warn("Command \"".concat(command,"\" not found in current context"));}var action=definition.action,params=definition.params;if(this.isDisabled(command))return;if(typeof action!=='function'){return log$1.warn("No action was defined for command \"".concat(command,"\""));}else{var result=action(params);/*if (this.last.get() === command) {
            this.last.dep.changed();
          } else {
            this.last.set(command);
          }*/return result;}}}]);return CommandsManager;}();var commands=new CommandsManager();// Export relevant objects
  var HotkeysContext=/*#__PURE__*/function(){function HotkeysContext(name,definitions,enabled){_classCallCheck$b(this,HotkeysContext);this.name=name;this.definitions=Object.assign({},definitions);this.enabled=enabled;}_createClass$1(HotkeysContext,[{key:"extend",value:function extend(){var _this=this;var definitions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(_typeof$4(definitions)!=='object')return;this.definitions=Object.assign({},definitions);Object.keys(definitions).forEach(function(command){var hotkey=definitions[command];_this.unregister(command);if(hotkey){_this.register(command,hotkey);}_this.definitions[command]=hotkey;});}},{key:"register",value:function register(command,hotkey){var _this2=this;if(!hotkey){return;}if(!command){return log$1.warn("No command was defined for hotkey \"".concat(hotkey,"\""));}var bindingKey="keydown.hotkey.".concat(this.name,".").concat(command);var bind=function bind(hotkey){return $(document).bind(bindingKey,hotkey,function(event){if(!_this2.enabled.get())return;OHIF.commands.run(command);event.preventDefault();});};if(hotkey instanceof Array){hotkey.forEach(function(hotkey){return bind(hotkey);});}else{bind(hotkey);}}},{key:"unregister",value:function unregister(command){var bindingKey="keydown.hotkey.".concat(this.name,".").concat(command);if(this.definitions[command]){$(document).unbind(bindingKey);delete this.definitions[command];}}},{key:"initialize",value:function initialize(){var _this3=this;Object.keys(this.definitions).forEach(function(command){var hotkey=_this3.definitions[command];_this3.register(command,hotkey);});}},{key:"destroy",value:function destroy(){$(document).unbind("keydown.hotkey.".concat(this.name));}}]);return HotkeysContext;}();var HotkeysManager=/*#__PURE__*/function(){function HotkeysManager(){_classCallCheck$b(this,HotkeysManager);this.contexts={};this.defaults={};this.currentContextName=null;this.enabled=true;this.retrieveFunction=null;this.storeFunction=null;}_createClass$1(HotkeysManager,[{key:"setRetrieveFunction",value:function setRetrieveFunction(retrieveFunction){this.retrieveFunction=retrieveFunction;}},{key:"setStoreFunction",value:function setStoreFunction(storeFunction){this.storeFunction=storeFunction;}},{key:"store",value:function store(contextName,definitions){var _this=this;var storageKey="hotkeysDefinitions.".concat(contextName);return new Promise(function(resolve,reject){if(_this.storeFunction){_this.storeFunction.call(_this,storageKey,definitions).then(resolve).catch(reject);//} else if (OHIF.user.userLoggedIn()) {
  //    OHIF.user.setData(storageKey, definitions).then(resolve).catch(reject);
  }else{var definitionsJSON=JSON.stringify(definitions);localStorage.setItem(storageKey,definitionsJSON);resolve();}});}},{key:"retrieve",value:function retrieve(contextName){var _this2=this;var storageKey="hotkeysDefinitions.".concat(contextName);return new Promise(function(resolve,reject){if(_this2.retrieveFunction){_this2.retrieveFunction(contextName).then(resolve).catch(reject);}else if(OHIF.user.userLoggedIn()){try{resolve(OHIF.user.getData(storageKey));}catch(error){reject(error);}}else{var definitionsJSON=localStorage.getItem(storageKey)||'';var definitions=JSON.parse(definitionsJSON)||undefined;resolve(definitions);}});}},{key:"disable",value:function disable(){this.enabled.set(false);}},{key:"enable",value:function enable(){this.enabled.set(true);}},{key:"getContext",value:function getContext(contextName){return this.contexts[contextName];}},{key:"getCurrentContext",value:function getCurrentContext(){return this.getContext(this.currentContextName);}},{key:"load",value:function load(contextName){var _this3=this;return new Promise(function(resolve,reject){var context=_this3.getContext(contextName);if(!context)return reject();_this3.retrieve(contextName).then(function(defs){var definitions=defs||_this3.defaults[contextName];if(!definitions){_this3.changeObserver.changed();return reject();}context.destroy();context.definitions=definitions;context.initialize();_this3.changeObserver.changed();resolve(definitions);}).catch(reject);});}},{key:"set",value:function set(contextName,contextDefinitions){var isDefaultDefinitions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var enabled=this.enabled;var context=new HotkeysContext(contextName,contextDefinitions,enabled);var currentContext=this.getCurrentContext();if(currentContext&&currentContext.name===contextName){currentContext.destroy();context.initialize();}this.contexts[contextName]=context;if(isDefaultDefinitions){this.defaults[contextName]=contextDefinitions;}}},{key:"register",value:function register(contextName,command,hotkey){if(!command||!hotkey)return;var context=this.getContext(contextName);if(!context){this.set(contextName,{});}context.register(command,hotkey);}},{key:"unsetContext",value:function unsetContext(contextName){if(contextName===this.currentContextName){this.getCurrentContext().destroy();}delete this.contexts[contextName];delete this.defaults[contextName];}},{key:"resetDefaults",value:function resetDefaults(contextName){var context=this.getContext(contextName);var definitions=this.defaults[contextName];if(!context||!definitions)return;context.extend(definitions);return this.store(contextName,definitions);}},{key:"switchToContext",value:function switchToContext(contextName){var currentContext=this.getCurrentContext();if(currentContext){currentContext.destroy();}var newContext=this.contexts[contextName];if(!newContext)return;this.currentContextName=contextName;newContext.initialize();this.load(contextName).catch(function(){});}}]);return HotkeysManager;}();//import 'jquery.hotkeys';
  // Create hotkeys namespace using a HotkeysManager class instance
  var hotkeys=new HotkeysManager();// Export relevant objects
  var FUNCTION$1='function';var STRING$3='string';var WILDCARD='*';// "*" is a special name which means "all children".
  var SEPARATOR='.';/**
   * Main Namespace Component Class
   */var Node=/*#__PURE__*/function(){function Node(){_classCallCheck$b(this,Node);this.value=0;this.children={};this.handlers={};}_createClass$1(Node,[{key:"getPathComponents",value:function getPathComponents(path){return _typeof$4(path)===STRING$3?path.split(SEPARATOR):null;}},{key:"getNodeUpToIndex",value:function getNodeUpToIndex(path,index){var node=this;for(var i=0;i<index;++i){var item=path[i];if(node.children.hasOwnProperty(item)){node=node.children[item];}else{node=null;break;}}return node;}},{key:"append",value:function append(name,value){var children=this.children;var node=null;if(children.hasOwnProperty(name)){node=children[name];}else if(_typeof$4(name)===STRING$3&&name!==WILDCARD){node=new Node();children[name]=node;}if(node!==null){node.value+=value>0?parseInt(value):0;}return node;}},{key:"probe",value:function probe(recursively){var value=this.value;// Calculate entire tree value recursively?
  if(recursively===true){var children=this.children;for(var item in children){if(children.hasOwnProperty(item)){value+=children[item].probe(recursively);}}}return value;}},{key:"clear",value:function clear(recursively){this.value=0;// Clear entire tree recursively?
  if(recursively===true){var children=this.children;for(var item in children){if(children.hasOwnProperty(item)){children[item].clear(recursively);}}}}},{key:"appendPath",value:function appendPath(path,value){path=this.getPathComponents(path);if(path!==null){var last=path.length-1;var node=this;for(var i=0;i<last;++i){node=node.append(path[i],0);if(node===null){return false;}}return node.append(path[last],value)!==null;}return false;}},{key:"clearPath",value:function clearPath(path,recursively){path=this.getPathComponents(path);if(path!==null){var last=path.length-1;var node=this.getNodeUpToIndex(path,last);if(node!==null){var item=path[last];if(item!==WILDCARD){if(node.children.hasOwnProperty(item)){node.children[item].clear(recursively);return true;}}else{var children=node.children;for(item in children){if(children.hasOwnProperty(item)){children[item].clear(recursively);}}return true;}}}return false;}},{key:"probePath",value:function probePath(path,recursively){path=this.getPathComponents(path);if(path!==null){var last=path.length-1;var node=this.getNodeUpToIndex(path,last);if(node!==null){var item=path[last];if(item!==WILDCARD){if(node.children.hasOwnProperty(item)){return node.children[item].probe(recursively);}}else{var children=node.children;var value=0;for(item in children){if(children.hasOwnProperty(item)){value+=children[item].probe(recursively);}}return value;}}}return 0;}},{key:"attachHandler",value:function attachHandler(type,handler){var result=false;if(_typeof$4(type)===STRING$3&&_typeof$4(handler)===FUNCTION$1){var handlers=this.handlers;var list=handlers.hasOwnProperty(type)?handlers[type]:handlers[type]=[];var length=list.length;var notFound=true;for(var i=0;i<length;++i){if(handler===list[i]){notFound=false;break;}}if(notFound){list[length]=handler;result=true;}}return result;}},{key:"removeHandler",value:function removeHandler(type,handler){var result=false;if(_typeof$4(type)===STRING$3&&_typeof$4(handler)===FUNCTION$1){var handlers=this.handlers;if(handlers.hasOwnProperty(type)){var list=handlers[type];var length=list.length;for(var i=0;i<length;++i){if(handler===list[i]){list.splice(i,1);result=true;break;}}}}return result;}},{key:"trigger",value:function trigger(type,nonRecursively){if(_typeof$4(type)===STRING$3){var handlers=this.handlers;if(handlers.hasOwnProperty(type)){var list=handlers[type];var length=list.length;for(var i=0;i<length;++i){list[i].call(null);}}if(nonRecursively!==true){var children=this.children;for(var item in children){if(children.hasOwnProperty(item)){children[item].trigger(type);}}}}}},{key:"attachHandlerForPath",value:function attachHandlerForPath(path,type,handler){path=this.getPathComponents(path);if(path!==null){var node=this.getNodeUpToIndex(path,path.length);if(node!==null){return node.attachHandler(type,handler);}}return false;}},{key:"removeHandlerForPath",value:function removeHandlerForPath(path,type,handler){path=this.getPathComponents(path);if(path!==null){var node=this.getNodeUpToIndex(path,path.length);if(node!==null){return node.removeHandler(type,handler);}}return false;}},{key:"triggerHandlersForPath",value:function triggerHandlersForPath(path,type,nonRecursively){path=this.getPathComponents(path);if(path!==null){var node=this.getNodeUpToIndex(path,path.length);if(node!==null){node.trigger(type,nonRecursively);}}}}]);return Node;}();/**
   * Root Namespace Node and API
   */var rootNode=new Node();function handleError(error){var title=error.title,message=error.message;if(!title){if(error instanceof Error){title=error.name;}}if(!message){if(error instanceof Error){message=error.message;}}var data=Object.assign({title:title,message:message,class:'themed',hideConfirm:true,cancelLabel:'Dismiss',cancelClass:'btn-secondary'},error||{});log$1.error(error);// TODO: Find a better way to handle errors instead of displaying a dialog for all of them.
  // OHIF.ui.showDialog('dialogForm', data);
  }/**
   * Check if the pressed key combination will result in a character input
   * Got from https://stackoverflow.com/questions/4179708/how-to-detect-if-the-pressed-key-will-produce-a-character-inside-an-input-text
   *
   * @returns {Boolean} Whether the pressed key combination will input a character or not
   */function isCharacterKeyPress(event){if(typeof event.which==='undefined'){// This is IE, which only fires keypress events for printable keys
  return true;}else if(typeof event.which==='number'&&event.which>0){// In other browsers except old versions of WebKit, event.which is
  // only greater than zero if the keypress is a printable key.
  // We need to filter out backspace and ctrl/alt/meta key combinations
  return !event.ctrlKey&&!event.metaKey&&!event.altKey&&event.which!==8;}return false;}/**
   * Get the offset for the given element
   *
   * @param {Object} element DOM element which will have the offser calculated
   * @returns {Object} Object containing the top and left offset
   */function getOffset(element){var top=0;var left=0;if(element.offsetParent){do{left+=element.offsetLeft;top+=element.offsetTop;}while(element=element.offsetParent);}return {left:left,top:top};}/**
   * Get the vertical and horizontal scrollbar sizes
   * Got from https://stackoverflow.com/questions/986937/how-can-i-get-the-browsers-scrollbar-sizes
   *
   * @returns {Array} Array containing the scrollbar horizontal and vertical sizes
   */function getScrollbarSize(){var inner=document.createElement('p');inner.style.width='100%';inner.style.height='100%';var outer=document.createElement('div');outer.style.position='absolute';outer.style.top='0px';outer.style.left='0px';outer.style.visibility='hidden';outer.style.width='100px';outer.style.height='100px';outer.style.overflow='hidden';outer.appendChild(inner);document.body.appendChild(outer);var w1=inner.offsetWidth;var h1=inner.offsetHeight;outer.style.overflow='scroll';var w2=inner.offsetWidth;var h2=inner.offsetHeight;if(w1===w2){w2=outer.clientWidth;}if(h1===h2){h2=outer.clientHeight;}document.body.removeChild(outer);return [w1-w2,h1-h2];}var ui={getScrollbarSize:getScrollbarSize,getOffset:getOffset,isCharacterKeyPress:isCharacterKeyPress,handleError:handleError};//import Dropdown from './ui/dropdown/class.js';
  /*
   * Defines the base OHIF header object
   */ //const dropdown = new OHIF.ui.Dropdown();
  var header={};var ObjectPath=/*#__PURE__*/function(){function ObjectPath(){_classCallCheck$b(this,ObjectPath);}_createClass$1(ObjectPath,null,[{key:"set",/**
       * Set an object property based on "path" (namespace) supplied creating
       * ... intermediary objects if they do not exist.
       * @param object {Object} An object where the properties specified on path should be set.
       * @param path {String} A string representing the property to be set, e.g. "user.study.series.timepoint".
       * @param value {Any} The value of the property that will be set.
       * @return {Boolean} Returns "true" on success, "false" if any intermediate component of the supplied path
       * ... is not a valid Object, in which case the property cannot be set. No excpetions are thrown.
       */value:function set(object,path,value){var components=ObjectPath.getPathComponents(path),length=components!==null?components.length:0,result=false;if(length>0&&ObjectPath.isValidObject(object)){var i=0,last=length-1,currentObject=object;while(i<last){var field=components[i];if(field in currentObject){if(!ObjectPath.isValidObject(currentObject[field])){break;}}else{currentObject[field]={};}currentObject=currentObject[field];i++;}if(i===last){currentObject[components[last]]=value;result=true;}}return result;}/**
       * Get an object property based on "path" (namespace) supplied traversing the object
       * ... tree as necessary.
       * @param object {Object} An object where the properties specified might exist.
       * @param path {String} A string representing the property to be searched for, e.g. "user.study.series.timepoint".
       * @return {Any} The value of the property if found. By default, returns the special type "undefined".
       */},{key:"get",value:function get(object,path){var found,// undefined by default
  components=ObjectPath.getPathComponents(path),length=components!==null?components.length:0;if(length>0&&ObjectPath.isValidObject(object)){var i=0,last=length-1,currentObject=object;while(i<last){var field=components[i];var isValid=ObjectPath.isValidObject(currentObject[field]);if(field in currentObject&&isValid){currentObject=currentObject[field];i++;}else{break;}}if(i===last&&components[last]in currentObject){found=currentObject[components[last]];}}return found;}/**
       * Check if the supplied argument is a real JavaScript Object instance.
       * @param object {Any} The subject to be tested.
       * @return {Boolean} Returns "true" if the object is a real Object instance and "false" otherwise.
       */},{key:"isValidObject",value:function isValidObject(object){return _typeof$4(object)==='object'&&object!==null&&object instanceof Object;}},{key:"getPathComponents",value:function getPathComponents(path){return typeof path==='string'?path.split('.'):null;}}]);return ObjectPath;}();function absoluteUrl(path){var absolutePath='/';// TODO: Find another way to get root url
  var absoluteUrl=window.location.origin;var absoluteUrlParts=absoluteUrl.split('/');if(absoluteUrlParts.length>4){var rootUrlPrefixIndex=absoluteUrl.indexOf(absoluteUrlParts[3]);absolutePath+=absoluteUrl.substring(rootUrlPrefixIndex)+path;}else{absolutePath+=path;}return absolutePath.replace(/\/\/+/g,'/');}// TODO: figure out where else to put this function
  function addServers(servers,store){Object.keys(servers).forEach(function(serverType){var endpoints=servers[serverType];endpoints.forEach(function(endpoint){var server=Object.assign({},endpoint);server.type=serverType;store.dispatch({type:'ADD_SERVER',server:server});});});}// Return the array sorting function for its object's properties
  function sortBy(){var fields=[].slice.call(arguments),n_fields=fields.length;return function(A,B){var a,b,field,key,reverse,result,i;for(i=0;i<n_fields;i++){result=0;field=fields[i];key=typeof field==='string'?field:field.name;a=A[key];b=B[key];if(typeof field.primer!=='undefined'){a=field.primer(a);b=field.primer(b);}reverse=field.reverse?-1:1;if(a<b){result=reverse*-1;}if(a>b){result=reverse*1;}if(result!==0){break;}}return result;};}/* jshint -W060 */function writeScript(fileName,callback){var script=document.createElement('script');script.src=absoluteUrl(fileName);script.onload=function(){if(typeof callback==='function'){callback(script);}};document.body.appendChild(script);}function updateQueryStringParameter(uri,key,value){var regex=new RegExp('([?&])'+key+'=.*?(&|$)','i');var separator=uri.indexOf('?')!==-1?'&':'?';if(uri.match(regex)){return uri.replace(regex,'$1'+key+'='+value+'$2');}else{return uri+separator+key+'='+value;}}/**
   * Obtain an imageId for Cornerstone from an image instance
   *
   * @param instance
   * @param frame
   * @param thumbnail
   * @returns {string} The imageId to be used by Cornerstone
   */function getImageId(instance,frame){var thumbnail=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!instance){return;}if(typeof instance.getImageId==='function'){return instance.getImageId();}if(instance.url){if(frame!==undefined){instance.url=updateQueryStringParameter(instance.url,'frame',frame);}return instance.url;}var renderingAttr=thumbnail?'thumbnailRendering':'imageRendering';if(!instance[renderingAttr]||instance[renderingAttr]==='wadouri'||!instance.wadorsuri){var imageId='dicomweb:'+instance.wadouri;if(frame!==undefined){imageId+='&frame='+frame;}return imageId;}else{return getWADORSImageId(instance,frame,thumbnail);// WADO-RS Retrieve Frame
  }}var stackMap={};var configuration={};var stackManagerMetaDataProvider;var stackUpdatedCallbacks=[];/**
   * Loop through the current series and add metadata to the
   * Cornerstone meta data provider. This will be used to fill information
   * into the viewport overlays, and to calculate reference lines and orientation markers
   * @param  {Object} stackMap              stackMap object
   * @param  {Object} study                 Study object
   * @param  {Object} displaySet            The set of images to make the stack from
   * @return {Array}                        Array with image IDs
   */function createAndAddStack(stackMap,study,displaySet,stackUpdatedCallbacks,metadataProvider){var numImages=displaySet.images.length;var imageIds=[];var imageId;displaySet.images.forEach(function(instance,imageIndex){var image=instance.getData();var metaData={instance:image,// in this context, instance will be the data of the InstanceMetadata object...
  series:displaySet,// TODO: Check this
  study:study,numImages:numImages,imageIndex:imageIndex+1};var numberOfFrames=image.numberOfFrames;if(numberOfFrames>1){OHIF.log.info('Multiframe image detected');for(var i=0;i<numberOfFrames;i++){metaData.frameNumber=i;imageId=getImageId(image,i);imageIds.push(imageId);metadataProvider.addMetadata(imageId,metaData);}}else{metaData.frameNumber=1;imageId=getImageId(image);imageIds.push(imageId);metadataProvider.addMetadata(imageId,metaData);}});var stack={studyInstanceUid:study.studyInstanceUid,displaySetInstanceUid:displaySet.displaySetInstanceUid,imageIds:imageIds,frameRate:displaySet.frameRate,isClip:displaySet.isClip};stackMap[displaySet.displaySetInstanceUid]=stack;return stack;}configuration={createAndAddStack:createAndAddStack};/**
   * This object contains all the functions needed for interacting with the stack manager.
   * Generally, findStack is the only function used. If you want to know when new stacks
   * come in, you can register a callback with addStackUpdatedCallback.
   */var StackManager={setMetadataProvider:function setMetadataProvider(provider){stackManagerMetaDataProvider=provider;},/**
     * Removes all current stacks
     */clearStacks:function clearStacks(){stackMap={};},/**
     * Create a stack from an image set, as well as add in the metadata on a per image bases.
     * @param study The study who's metadata will be added
     * @param displaySet The set of images to make the stack from
     * @return {Array} Array with image IDs
     */makeAndAddStack:function makeAndAddStack(study,displaySet){if(!stackManagerMetaDataProvider){throw new Error('Please call StackManager.setMetadataProvider(provider) first.');}return configuration.createAndAddStack(stackMap,study,displaySet,stackUpdatedCallbacks,stackManagerMetaDataProvider);},/**
     * Find a stack from the currently created stacks.
     * @param displaySetInstanceUid The UID of the stack to find.
     * @returns {*} undefined if not found, otherwise the stack object is returned.
     */findStack:function findStack(displaySetInstanceUid){return stackMap[displaySetInstanceUid];},/**
     * Find a stack or reate one if it has not been created yet
     * @param study The study who's metadata will be added
     * @param displaySet The set of images to make the stack from
     * @return {Array} Array with image IDs
     */findOrCreateStack:function findOrCreateStack(study,displaySet){var stack=this.findStack(displaySet.displaySetInstanceUid);if(!stack||!stack.imageIds){stack=this.makeAndAddStack(study,displaySet);}return stack;},/**
     * Gets the underlying map of displaySetInstanceUid to stack object.
     * WARNING: Do not change this object. It directly affects the manager.
     * @returns {{}} map of displaySetInstanceUid -> stack.
     */getAllStacks:function getAllStacks(){return stackMap;},/**
     * Adds in a callback to be called on a stack being added / updated.
     * @param callback must accept at minimum one argument,
     * which is the stack that was added / updated.
     */addStackUpdatedCallback:function addStackUpdatedCallback(callback){if(typeof callback!=='function'){throw new OHIFError('callback must be provided as a function');}stackUpdatedCallbacks.push(callback);},/**
     * Return configuration
     */getConfiguration:function getConfiguration(){return configuration;},/**
     * Set configuration, in order to provide compatibility
     * with other systems by overriding this functions
     * @param {Object} config object with functions to be overrided
     *
     * For now, only makeAndAddStack can be overrided
     */setConfiguration:function setConfiguration(config){configuration=config;}};// TODO: Deprecate since we have the same thing in dcmjs?
  var sopClassDictionary={ComputedRadiographyImageStorage:'1.2.840.10008.5.1.4.1.1.1',DigitalXRayImageStorageForPresentation:'1.2.840.10008.5.1.4.1.1.1.1',DigitalXRayImageStorageForProcessing:'1.2.840.10008.5.1.4.1.1.1.1.1',DigitalMammographyXRayImageStorageForPresentation:'1.2.840.10008.5.1.4.1.1.1.2',DigitalMammographyXRayImageStorageForProcessing:'1.2.840.10008.5.1.4.1.1.1.2.1',DigitalIntraOralXRayImageStorageForPresentation:'1.2.840.10008.5.1.4.1.1.1.3',DigitalIntraOralXRayImageStorageForProcessing:'1.2.840.10008.5.1.4.1.1.1.3.1',CTImageStorage:'1.2.840.10008.5.1.4.1.1.2',EnhancedCTImageStorage:'1.2.840.10008.5.1.4.1.1.2.1',LegacyConvertedEnhancedCTImageStorage:'1.2.840.10008.5.1.4.1.1.2.2',UltrasoundMultiframeImageStorage:'1.2.840.10008.5.1.4.1.1.3.1',MRImageStorage:'1.2.840.10008.5.1.4.1.1.4',EnhancedMRImageStorage:'1.2.840.10008.5.1.4.1.1.4.1',MRSpectroscopyStorage:'1.2.840.10008.5.1.4.1.1.4.2',EnhancedMRColorImageStorage:'1.2.840.10008.5.1.4.1.1.4.3',LegacyConvertedEnhancedMRImageStorage:'1.2.840.10008.5.1.4.1.1.4.4',UltrasoundImageStorage:'1.2.840.10008.5.1.4.1.1.6.1',EnhancedUSVolumeStorage:'1.2.840.10008.5.1.4.1.1.6.2',SecondaryCaptureImageStorage:'1.2.840.10008.5.1.4.1.1.7',MultiframeSingleBitSecondaryCaptureImageStorage:'1.2.840.10008.5.1.4.1.1.7.1',MultiframeGrayscaleByteSecondaryCaptureImageStorage:'1.2.840.10008.5.1.4.1.1.7.2',MultiframeGrayscaleWordSecondaryCaptureImageStorage:'1.2.840.10008.5.1.4.1.1.7.3',MultiframeTrueColorSecondaryCaptureImageStorage:'1.2.840.10008.5.1.4.1.1.7.4',Sop12LeadECGWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.1.1',GeneralECGWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.1.2',AmbulatoryECGWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.1.3',HemodynamicWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.2.1',CardiacElectrophysiologyWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.3.1',BasicVoiceAudioWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.4.1',GeneralAudioWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.4.2',ArterialPulseWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.5.1',RespiratoryWaveformStorage:'1.2.840.10008.5.1.4.1.1.9.6.1',GrayscaleSoftcopyPresentationStateStorage:'1.2.840.10008.5.1.4.1.1.11.1',ColorSoftcopyPresentationStateStorage:'1.2.840.10008.5.1.4.1.1.11.2',PseudoColorSoftcopyPresentationStateStorage:'1.2.840.10008.5.1.4.1.1.11.3',BlendingSoftcopyPresentationStateStorage:'1.2.840.10008.5.1.4.1.1.11.4',XAXRFGrayscaleSoftcopyPresentationStateStorage:'1.2.840.10008.5.1.4.1.1.11.5',XRayAngiographicImageStorage:'1.2.840.10008.5.1.4.1.1.12.1',EnhancedXAImageStorage:'1.2.840.10008.5.1.4.1.1.12.1.1',XRayRadiofluoroscopicImageStorage:'1.2.840.10008.5.1.4.1.1.12.2',EnhancedXRFImageStorage:'1.2.840.10008.5.1.4.1.1.12.2.1',XRay3DAngiographicImageStorage:'1.2.840.10008.5.1.4.1.1.13.1.1',XRay3DCraniofacialImageStorage:'1.2.840.10008.5.1.4.1.1.13.1.2',BreastTomosynthesisImageStorage:'1.2.840.10008.5.1.4.1.1.13.1.3',BreastProjectionXRayImageStorageForPresentation:'1.2.840.10008.5.1.4.1.1.13.1.4',BreastProjectionXRayImageStorageForProcessing:'1.2.840.10008.5.1.4.1.1.13.1.5',IntravascularOpticalCoherenceTomographyImageStorageForPresentation:'1.2.840.10008.5.1.4.1.1.14.1',IntravascularOpticalCoherenceTomographyImageStorageForProcessing:'1.2.840.10008.5.1.4.1.1.14.2',NuclearMedicineImageStorage:'1.2.840.10008.5.1.4.1.1.20',RawDataStorage:'1.2.840.10008.5.1.4.1.1.66',SpatialRegistrationStorage:'1.2.840.10008.5.1.4.1.1.66.1',SpatialFiducialsStorage:'1.2.840.10008.5.1.4.1.1.66.2',DeformableSpatialRegistrationStorage:'1.2.840.10008.5.1.4.1.1.66.3',SegmentationStorage:'1.2.840.10008.5.1.4.1.1.66.4',SurfaceSegmentationStorage:'1.2.840.10008.5.1.4.1.1.66.5',RealWorldValueMappingStorage:'1.2.840.10008.5.1.4.1.1.67',SurfaceScanMeshStorage:'1.2.840.10008.5.1.4.1.1.68.1',SurfaceScanPointCloudStorage:'1.2.840.10008.5.1.4.1.1.68.2',VLEndoscopicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.1',VideoEndoscopicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.1.1',VLMicroscopicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.2',VideoMicroscopicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.2.1',VLSlideCoordinatesMicroscopicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.3',VLPhotographicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.4',VideoPhotographicImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.4.1',OphthalmicPhotography8BitImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.5.1',OphthalmicPhotography16BitImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.5.2',StereometricRelationshipStorage:'1.2.840.10008.5.1.4.1.1.77.1.5.3',OphthalmicTomographyImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.5.4',VLWholeSlideMicroscopyImageStorage:'1.2.840.10008.5.1.4.1.1.77.1.6',LensometryMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.78.1',AutorefractionMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.78.2',KeratometryMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.78.3',SubjectiveRefractionMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.78.4',VisualAcuityMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.78.5',SpectaclePrescriptionReportStorage:'1.2.840.10008.5.1.4.1.1.78.6',OphthalmicAxialMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.78.7',IntraocularLensCalculationsStorage:'1.2.840.10008.5.1.4.1.1.78.8',MacularGridThicknessandVolumeReport:'1.2.840.10008.5.1.4.1.1.79.1',OphthalmicVisualFieldStaticPerimetryMeasurementsStorage:'1.2.840.10008.5.1.4.1.1.80.1',OphthalmicThicknessMapStorage:'1.2.840.10008.5.1.4.1.1.81.1',CornealTopographyMapStorage:'1.2.840.10008.5.1.4.1.1.82.1',BasicTextSR:'1.2.840.10008.5.1.4.1.1.88.11',EnhancedSR:'1.2.840.10008.5.1.4.1.1.88.22',ComprehensiveSR:'1.2.840.10008.5.1.4.1.1.88.33',Comprehensive3DSR:'1.2.840.10008.5.1.4.1.1.88.34',ProcedureLog:'1.2.840.10008.5.1.4.1.1.88.40',MammographyCADSR:'1.2.840.10008.5.1.4.1.1.88.50',KeyObjectSelection:'1.2.840.10008.5.1.4.1.1.88.59',ChestCADSR:'1.2.840.10008.5.1.4.1.1.88.65',XRayRadiationDoseSR:'1.2.840.10008.5.1.4.1.1.88.67',RadiopharmaceuticalRadiationDoseSR:'1.2.840.10008.5.1.4.1.1.88.68',ColonCADSR:'1.2.840.10008.5.1.4.1.1.88.69',ImplantationPlanSRDocumentStorage:'1.2.840.10008.5.1.4.1.1.88.70',EncapsulatedPDFStorage:'1.2.840.10008.5.1.4.1.1.104.1',EncapsulatedCDAStorage:'1.2.840.10008.5.1.4.1.1.104.2',PositronEmissionTomographyImageStorage:'1.2.840.10008.5.1.4.1.1.128',EnhancedPETImageStorage:'1.2.840.10008.5.1.4.1.1.130',LegacyConvertedEnhancedPETImageStorage:'1.2.840.10008.5.1.4.1.1.128.1',BasicStructuredDisplayStorage:'1.2.840.10008.5.1.4.1.1.131',RTImageStorage:'1.2.840.10008.5.1.4.1.1.481.1',RTDoseStorage:'1.2.840.10008.5.1.4.1.1.481.2',RTStructureSetStorage:'1.2.840.10008.5.1.4.1.1.481.3',RTBeamsTreatmentRecordStorage:'1.2.840.10008.5.1.4.1.1.481.4',RTPlanStorage:'1.2.840.10008.5.1.4.1.1.481.5',RTBrachyTreatmentRecordStorage:'1.2.840.10008.5.1.4.1.1.481.6',RTTreatmentSummaryRecordStorage:'1.2.840.10008.5.1.4.1.1.481.7',RTIonPlanStorage:'1.2.840.10008.5.1.4.1.1.481.8',RTIonBeamsTreatmentRecordStorage:'1.2.840.10008.5.1.4.1.1.481.9',RTBeamsDeliveryInstructionStorage:'1.2.840.10008.5.1.4.34.7',GenericImplantTemplateStorage:'1.2.840.10008.5.1.4.43.1',ImplantAssemblyTemplateStorage:'1.2.840.10008.5.1.4.44.1',ImplantTemplateGroupStorage:'1.2.840.10008.5.1.4.45.1'};/**
   * Checks whether dicom files with specified SOP Class UID have image data
   * @param {string} sopClassUid - SOP Class UID to be checked
   * @returns {boolean} - true if it has image data
   */function isImage(sopClassUid){if(sopClassUid===sopClassDictionary.ComputedRadiographyImageStorage||sopClassUid===sopClassDictionary.DigitalXRayImageStorageForPresentation||sopClassUid===sopClassDictionary.DigitalXRayImageStorageForProcessing||sopClassUid===sopClassDictionary.DigitalMammographyXRayImageStorageForPresentation||sopClassUid===sopClassDictionary.DigitalMammographyXRayImageStorageForProcessing||sopClassUid===sopClassDictionary.DigitalIntraOralXRayImageStorageForPresentation||sopClassUid===sopClassDictionary.DigitalIntraOralXRayImageStorageForProcessing||sopClassUid===sopClassDictionary.CTImageStorage||sopClassUid===sopClassDictionary.EnhancedCTImageStorage||sopClassUid===sopClassDictionary.LegacyConvertedEnhancedCTImageStorage||sopClassUid===sopClassDictionary.UltrasoundMultiframeImageStorage||sopClassUid===sopClassDictionary.MRImageStorage||sopClassUid===sopClassDictionary.EnhancedMRImageStorage||sopClassUid===sopClassDictionary.EnhancedMRColorImageStorage||sopClassUid===sopClassDictionary.LegacyConvertedEnhancedMRImageStorage||sopClassUid===sopClassDictionary.UltrasoundImageStorage||sopClassUid===sopClassDictionary.SecondaryCaptureImageStorage||sopClassUid===sopClassDictionary.MultiframeSingleBitSecondaryCaptureImageStorage||sopClassUid===sopClassDictionary.MultiframeGrayscaleByteSecondaryCaptureImageStorage||sopClassUid===sopClassDictionary.MultiframeGrayscaleWordSecondaryCaptureImageStorage||sopClassUid===sopClassDictionary.MultiframeTrueColorSecondaryCaptureImageStorage||sopClassUid===sopClassDictionary.XRayAngiographicImageStorage||sopClassUid===sopClassDictionary.EnhancedXAImageStorage||sopClassUid===sopClassDictionary.XRayRadiofluoroscopicImageStorage||sopClassUid===sopClassDictionary.EnhancedXRFImageStorage||sopClassUid===sopClassDictionary.XRay3DAngiographicImageStorage||sopClassUid===sopClassDictionary.XRay3DCraniofacialImageStorage||sopClassUid===sopClassDictionary.BreastTomosynthesisImageStorage||sopClassUid===sopClassDictionary.BreastProjectionXRayImageStorageForPresentation||sopClassUid===sopClassDictionary.BreastProjectionXRayImageStorageForProcessing||sopClassUid===sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForPresentation||sopClassUid===sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForProcessing||sopClassUid===sopClassDictionary.NuclearMedicineImageStorage||sopClassUid===sopClassDictionary.VLEndoscopicImageStorage||sopClassUid===sopClassDictionary.VideoEndoscopicImageStorage||sopClassUid===sopClassDictionary.VLMicroscopicImageStorage||sopClassUid===sopClassDictionary.VideoMicroscopicImageStorage||sopClassUid===sopClassDictionary.VLSlideCoordinatesMicroscopicImageStorage||sopClassUid===sopClassDictionary.VLPhotographicImageStorage||sopClassUid===sopClassDictionary.VideoPhotographicImageStorage||sopClassUid===sopClassDictionary.OphthalmicPhotography8BitImageStorage||sopClassUid===sopClassDictionary.OphthalmicPhotography16BitImageStorage||sopClassUid===sopClassDictionary.OphthalmicTomographyImageStorage||sopClassUid===sopClassDictionary.VLWholeSlideMicroscopyImageStorage||sopClassUid===sopClassDictionary.PositronEmissionTomographyImageStorage||sopClassUid===sopClassDictionary.EnhancedPETImageStorage||sopClassUid===sopClassDictionary.LegacyConvertedEnhancedPETImageStorage||sopClassUid===sopClassDictionary.RTImageStorage){return true;}return false;}var isMultiFrame=function isMultiFrame(instance){// NumberOfFrames (0028,0008)
  return instance.getRawValue('x00280008')>1;};var makeDisplaySet=function makeDisplaySet(series,instances){var instance=instances[0];var imageSet=new ImageSet(instances);var seriesData=series.getData();// set appropriate attributes to image set...
  imageSet.setAttributes({displaySetInstanceUid:imageSet.uid,// create a local alias for the imageSet UID
  seriesDate:seriesData.seriesDate,seriesTime:seriesData.seriesTime,seriesInstanceUid:series.getSeriesInstanceUID(),seriesNumber:instance.getRawValue('x00200011'),seriesDescription:instance.getRawValue('x0008103e'),numImageFrames:instances.length,frameRate:instance.getRawValue('x00181063'),modality:instance.getRawValue('x00080060'),isMultiFrame:isMultiFrame(instance)});// Sort the images in this series if needed
  {imageSet.sortBy(function(a,b){// Sort by InstanceNumber (0020,0013)
  return (parseInt(a.getRawValue('x00200013',0))||0)-(parseInt(b.getRawValue('x00200013',0))||0);});}// Include the first image instance number (after sorted)
  imageSet.setAttribute('instanceNumber',imageSet.getImage(0).getRawValue('x00200013'));return imageSet;};var isSingleImageModality=function isSingleImageModality(modality){return modality==='CR'||modality==='MG'||modality==='DX';};/**
   * Creates a set of series to be placed in the Study Metadata
   * The series that appear in the Study Metadata must represent
   * imaging modalities.
   *
   * Furthermore, for drag/drop functionality,
   * it is easiest if the stack objects also contain information about
   * which study they are linked to.
   *
   * @param study The study instance metadata to be used
   * @returns {Array} An array of series to be placed in the Study Metadata
   */function createStacks(study){// Define an empty array of display sets
  var displaySets=[];if(!study||!study.getSeriesCount()){return displaySets;}// Loop through the series (SeriesMetadata)
  study.forEachSeries(function(series){// If the series has no instances, skip it
  if(!series.getInstanceCount()){return;}// Search through the instances (InstanceMetadata object) of this series
  // Split Multi-frame instances and Single-image modalities
  // into their own specific display sets. Place the rest of each
  // series into another display set.
  var stackableInstances=[];series.forEachInstance(function(instance){// All imaging modalities must have a valid value for sopClassUid (x00080016) or rows (x00280010)
  if(!isImage(instance.getRawValue('x00080016'))&&!instance.getRawValue('x00280010')){return;}var displaySet;if(isMultiFrame(instance)){displaySet=makeDisplaySet(series,[instance]);displaySet.setAttributes({isClip:true,studyInstanceUid:study.getStudyInstanceUID(),// Include the study instance Uid for drag/drop purposes
  numImageFrames:instance.getRawValue('x00280008'),// Override the default value of instances.length
  instanceNumber:instance.getRawValue('x00200013'),// Include the instance number
  acquisitionDatetime:instance.getRawValue('x0008002a')// Include the acquisition datetime
  });displaySets.push(displaySet);}else if(isSingleImageModality(instance.modality)){displaySet=makeDisplaySet(series,[instance]);displaySet.setAttributes({studyInstanceUid:study.getStudyInstanceUID(),// Include the study instance Uid
  instanceNumber:instance.getRawValue('x00200013'),// Include the instance number
  acquisitionDatetime:instance.getRawValue('x0008002a')// Include the acquisition datetime
  });displaySets.push(displaySet);}else{stackableInstances.push(instance);}});if(stackableInstances.length){var displaySet=makeDisplaySet(series,stackableInstances);displaySet.setAttribute('studyInstanceUid',study.getStudyInstanceUID());displaySets.push(displaySet);}});return displaySets;}var OHIFInstanceMetadata=/*#__PURE__*/function(_InstanceMetadata){_inherits$b(OHIFInstanceMetadata,_InstanceMetadata);/**
     * @param {Object} Instance object.
     */function OHIFInstanceMetadata(data,series,study,uid){var _this;_classCallCheck$b(this,OHIFInstanceMetadata);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(OHIFInstanceMetadata).call(this,data,uid));_this.init(series,study);return _this;}_createClass$1(OHIFInstanceMetadata,[{key:"init",value:function init(series,study){var instance=this.getData();// Initialize Private Properties
  Object.defineProperties(this,{_sopInstanceUID:{configurable:false,enumerable:false,writable:false,value:instance.sopInstanceUid},_study:{configurable:false,enumerable:false,writable:false,value:study},_series:{configurable:false,enumerable:false,writable:false,value:series},_instance:{configurable:false,enumerable:false,writable:false,value:instance},_cache:{configurable:false,enumerable:false,writable:false,value:Object.create(null)}});}// Override
  },{key:"getTagValue",value:function getTagValue(tagOrProperty,defaultValue,bypassCache){// check if this property has been cached...
  if(tagOrProperty in this._cache&&bypassCache!==true){return this._cache[tagOrProperty];}var propertyName=OHIFInstanceMetadata.getPropertyName(tagOrProperty);// Search property value in the whole study metadata chain...
  var rawValue;if(propertyName in this._instance){rawValue=this._instance[propertyName];}else if(propertyName in this._series){rawValue=this._series[propertyName];}else if(propertyName in this._study){rawValue=this._study[propertyName];}if(rawValue!==void 0){// if rawValue value is not undefined, cache result...
  this._cache[tagOrProperty]=rawValue;return rawValue;}return defaultValue;}// Override
  },{key:"tagExists",value:function tagExists(tagOrProperty){var propertyName=OHIFInstanceMetadata.getPropertyName(tagOrProperty);return propertyName in this._instance||propertyName in this._series||propertyName in this._study;}// Override
  },{key:"getImageId",value:function getImageId$$1(frame,thumbnail){// If _imageID is not cached, create it
  if(this._imageId===null){this._imageId=getImageId(this.getData(),frame,thumbnail);}return this._imageId;}/**
       * Static methods
       */ // @TODO: The current mapping of standard DICOM property names to local property names is not optimal.
  // The inconsistency in property naming makes this function increasingly complex.
  // A possible solution to improve this would be adapt retriveMetadata names to use DICOM standard names as in dicomTagDescriptions.js
  }],[{key:"getPropertyName",value:function getPropertyName(tagOrProperty){var propertyName;var tagInfo=DICOMTagDescriptions.find(tagOrProperty);if(tagInfo!==void 0){// This function tries to translate standard DICOM property names into local naming convention.
  propertyName=tagInfo.keyword.replace(/^SOP/,'sop').replace(/UID$/,'Uid').replace(/ID$/,'Id');propertyName=propertyName.charAt(0).toLowerCase()+propertyName.substr(1);}return propertyName;}}]);return OHIFInstanceMetadata;}(InstanceMetadata);var OHIFSeriesMetadata=/*#__PURE__*/function(_SeriesMetadata){_inherits$b(OHIFSeriesMetadata,_SeriesMetadata);/**
     * @param {Object} Series object.
     */function OHIFSeriesMetadata(data,study,uid){var _this;_classCallCheck$b(this,OHIFSeriesMetadata);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(OHIFSeriesMetadata).call(this,data,uid));_this.init(study);return _this;}_createClass$1(OHIFSeriesMetadata,[{key:"init",value:function init(study){var _this2=this;var series=this.getData();// define "_seriesInstanceUID" protected property...
  Object.defineProperty(this,'_seriesInstanceUID',{configurable:false,enumerable:false,writable:false,value:series.seriesInstanceUid});// populate internal list of instances...
  series.instances.forEach(function(instance){_this2.addInstance(new OHIFInstanceMetadata(instance,series,study));});}}]);return OHIFSeriesMetadata;}(SeriesMetadata);var OHIFStudyMetadata=/*#__PURE__*/function(_StudyMetadata){_inherits$b(OHIFStudyMetadata,_StudyMetadata);/**
     * @param {Object} Study object.
     */function OHIFStudyMetadata(data,uid){var _this;_classCallCheck$b(this,OHIFStudyMetadata);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(OHIFStudyMetadata).call(this,data,uid));_this.init();return _this;}_createClass$1(OHIFStudyMetadata,[{key:"init",value:function init(){var _this2=this;var study=this.getData();// define "_studyInstanceUID" protected property
  Object.defineProperty(this,'_studyInstanceUID',{configurable:false,enumerable:false,writable:false,value:study.studyInstanceUid});// populate internal list of series
  study.seriesList.forEach(function(series){_this2.addSeries(new OHIFSeriesMetadata(series,study));});}}]);return OHIFStudyMetadata;}(StudyMetadata);var getDisplaySets=function getDisplaySets(studyMetadata,seriesNumber,iteratorFunction){var iteratorFn=typeof iteratorFunction!=='function'?createStacks:iteratorFunction;return iteratorFn(studyMetadata,seriesNumber);};var sortingManager={getDisplaySets:getDisplaySets};function createDisplaySets(studies){// Define the OHIF.viewer.data global object
  // TODO: Save all data that is currently in OHIF.viewer in redux instead
  //OHIF.viewer.data = OHIF.viewer.data || {};
  // @TypeSafeStudies
  // Clears OHIF.viewer.Studies collection
  //OHIF.viewer.Studies.removeAll();
  // @TypeSafeStudies
  // Clears OHIF.viewer.StudyMetadataList collection
  //OHIF.viewer.StudyMetadataList.removeAll();
  //OHIF.viewer.data.studyInstanceUids = [];
  var updatedStudies=studies.map(function(study){var studyMetadata=new OHIFStudyMetadata(study,study.studyInstanceUid);var displaySets=study.displaySets;if(!study.displaySets){displaySets=sortingManager.getDisplaySets(studyMetadata);study.displaySets=displaySets;}studyMetadata.setDisplaySets(displaySets);//OHIF.viewer.Studies.insert(study);
  //OHIF.viewer.StudyMetadataList.insert(studyMetadata);
  //OHIF.viewer.data.studyInstanceUids.push(study.studyInstanceUid);
  // Updates WADO-RS metaDataManager
  updateMetaDataManager(study);return study;});return updatedStudies;}var utils={guid:guid,ObjectPath:ObjectPath,absoluteUrl:absoluteUrl,addServers:addServers,sortBy:sortBy,writeScript:writeScript,StackManager:StackManager,createStacks:createStacks,createDisplaySets:createDisplaySets};var metadata={Metadata:Metadata,WadoRsMetaDataBuilder:WadoRsMetaDataBuilder,StudyMetadata:StudyMetadata,SeriesMetadata:SeriesMetadata,InstanceMetadata:InstanceMetadata,OHIFStudyMetadata:OHIFStudyMetadata,OHIFSeriesMetadata:OHIFSeriesMetadata,OHIFInstanceMetadata:OHIFInstanceMetadata};var FUNCTION$2='function';var MetadataProvider=/*#__PURE__*/function(){function MetadataProvider(){_classCallCheck$b(this,MetadataProvider);// Define the main "metadataLookup" private property as an immutable property.
  Object.defineProperty(this,'metadataLookup',{configurable:false,enumerable:false,writable:false,value:new Map()});// Local reference to provider function bound to current instance.
  Object.defineProperty(this,'_provider',{configurable:false,enumerable:false,writable:true,value:null});}/**
     * Cornerstone Metadata provider to store image meta data
     * Data from instances, series, and studies are associated with
     * imageIds to facilitate usage of this information by Cornerstone's Tools
     *
     * e.g. the imagePlane metadata object contains instance information about
     * row/column pixel spacing, patient position, and patient orientation. It
     * is used in CornerstoneTools to position reference lines and orientation markers.
     *
     * @param {String} imageId The Cornerstone ImageId
     * @param {Object} data An object containing instance, series, and study metadata
     */_createClass$1(MetadataProvider,[{key:"addMetadata",value:function addMetadata(imageId,data){var instanceMetadata=data.instance;var seriesMetadata=data.series;var studyMetadata=data.study;var numImages=data.numImages;var metadata={};metadata.frameNumber=data.frameNumber;metadata.study={accessionNumber:studyMetadata.accessionNumber,patientId:studyMetadata.patientId,studyInstanceUid:studyMetadata.studyInstanceUid,studyDate:studyMetadata.studyDate,studyTime:studyMetadata.studyTime,studyDescription:studyMetadata.studyDescription,institutionName:studyMetadata.institutionName,patientHistory:studyMetadata.patientHistory};metadata.series={seriesDescription:seriesMetadata.seriesDescription,seriesNumber:seriesMetadata.seriesNumber,seriesDate:seriesMetadata.seriesDate,seriesTime:seriesMetadata.seriesTime,modality:seriesMetadata.modality,seriesInstanceUid:seriesMetadata.seriesInstanceUid,numImages:numImages};metadata.instance=instanceMetadata;metadata.patient={name:studyMetadata.patientName,id:studyMetadata.patientId,birthDate:studyMetadata.patientBirthDate,sex:studyMetadata.patientSex,age:studyMetadata.patientAge};// If there is sufficient information, populate
  // the imagePlane object for easier use in the Viewer
  metadata.imagePlane=this.getImagePlane(instanceMetadata);// Add the metadata to the imageId lookup object
  this.metadataLookup.set(imageId,metadata);}/**
       * Return the metadata for the given imageId
       * @param {String} imageId The Cornerstone ImageId
       * @returns image metadata
       */},{key:"getMetadata",value:function getMetadata(imageId){return this.metadataLookup.get(imageId);}/**
       * Adds a set of metadata to the Cornerstone metadata provider given a specific
       * imageId, type, and dataset
       *
       * @param imageId
       * @param type (e.g. series, instance, tagDisplay)
       * @param data
       */},{key:"addSpecificMetadata",value:function addSpecificMetadata(imageId,type,data){var metadata={};metadata[type]=data;var oldMetadata=this.metadataLookup.get(imageId);this.metadataLookup.set(imageId,Object.assign(oldMetadata,metadata));}},{key:"getFromImage",value:function getFromImage(image,type,tag,attrName,defaultValue){var value;if(image.data){value=this.getFromDataSet(image.data,type,tag);}else{value=image.instance[attrName];}return value===null?defaultValue:value;}},{key:"getFromDataSet",value:function getFromDataSet(dataSet,type,tag){if(!dataSet){return;}var fn=dataSet[type];if(!fn){return;}return fn.call(dataSet,tag);}},{key:"getFrameIncrementPointer",value:function getFrameIncrementPointer(image){var dataSet=image.data;var frameInstancePointer='';if(parsingUtils.isValidDataSet(dataSet)){var frameInstancePointerNames={x00181063:'frameTime',x00181065:'frameTimeVector'};// (0028,0009) = Frame Increment Pointer
  var frameInstancePointerTag=parsingUtils.attributeTag(dataSet,'x00280009');frameInstancePointer=frameInstancePointerNames[frameInstancePointerTag];}else{frameInstancePointer=image.instance.frameIncrementPointer;}return frameInstancePointer||'';}},{key:"getFrameTimeVector",value:function getFrameTimeVector(image){var dataSet=image.data;if(parsingUtils.isValidDataSet(dataSet)){// Frame Increment Pointer points to Frame Time Vector (0018,1065) field
  return parsingUtils.floatArray(dataSet,'x00181065');}return image.instance.frameTimeVector;}},{key:"getFrameTime",value:function getFrameTime(image){var dataSet=image.data;if(parsingUtils.isValidDataSet(dataSet)){// Frame Increment Pointer points to Frame Time (0018,1063) field or is not defined (for addtional flexibility).
  // Yet another value is possible for this field (5200,9230 for Multi-frame Functional Groups)
  // but that case is currently not supported.
  return dataSet.floatString('x00181063',-1);}return image.instance.frameTime;}/**
       * Updates the related metadata for missing fields given a specified image
       *
       * @param image
       */},{key:"updateMetadata",value:function updateMetadata(image){var imageMetadata=this.metadataLookup.get(image.imageId);if(!imageMetadata){return;}imageMetadata.patient.age=imageMetadata.patient.age||this.getFromDataSet(image.data,'string','x00101010');imageMetadata.instance.rows=imageMetadata.instance.rows||image.rows;imageMetadata.instance.columns=imageMetadata.instance.columns||image.columns;imageMetadata.instance.sopClassUid=imageMetadata.instance.sopClassUid||this.getFromDataSet(image.data,'string','x00080016');imageMetadata.instance.sopInstanceUid=imageMetadata.instance.sopInstanceUid||this.getFromDataSet(image.data,'string','x00080018');imageMetadata.instance.pixelSpacing=imageMetadata.instance.pixelSpacing||this.getFromDataSet(image.data,'string','x00280030');imageMetadata.instance.frameOfReferenceUID=imageMetadata.instance.frameOfReferenceUID||this.getFromDataSet(image.data,'string','x00200052');imageMetadata.instance.imageOrientationPatient=imageMetadata.instance.imageOrientationPatient||this.getFromDataSet(image.data,'string','x00200037');imageMetadata.instance.imagePositionPatient=imageMetadata.instance.imagePositionPatient||this.getFromDataSet(image.data,'string','x00200032');imageMetadata.instance.sliceThickness=imageMetadata.instance.sliceThickness||this.getFromDataSet(image.data,'string','x00180050');imageMetadata.instance.sliceLocation=imageMetadata.instance.sliceLocation||this.getFromDataSet(image.data,'string','x00201041');imageMetadata.instance.tablePosition=imageMetadata.instance.tablePosition||this.getFromDataSet(image.data,'string','x00189327');imageMetadata.instance.spacingBetweenSlices=imageMetadata.instance.spacingBetweenSlices||this.getFromDataSet(image.data,'string','x00180088');imageMetadata.instance.lossyImageCompression=imageMetadata.instance.lossyImageCompression||this.getFromDataSet(image.data,'string','x00282110');imageMetadata.instance.lossyImageCompressionRatio=imageMetadata.instance.lossyImageCompressionRatio||this.getFromDataSet(image.data,'string','x00282112');imageMetadata.instance.frameIncrementPointer=imageMetadata.instance.frameIncrementPointer||this.getFromDataSet(image.data,'string','x00280009');imageMetadata.instance.frameTime=imageMetadata.instance.frameTime||this.getFromDataSet(image.data,'string','x00181063');imageMetadata.instance.frameTimeVector=imageMetadata.instance.frameTimeVector||this.getFromDataSet(image.data,'string','x00181065');if((image.data||image.instance)&&!imageMetadata.instance.multiframeMetadata){imageMetadata.instance.multiframeMetadata=this.getMultiframeModuleMetadata(image);}imageMetadata.imagePlane=imageMetadata.imagePlane||this.getImagePlane(imageMetadata.instance);}/**
       * Constructs and returns the imagePlane given the metadata instance
       *
       * @param metadataInstance The metadata instance (InstanceMetadata class) containing information to construct imagePlane
       * @returns imagePlane The constructed imagePlane to be used in viewer easily
       */},{key:"getImagePlane",value:function getImagePlane(instance){if(!instance.rows||!instance.columns||!instance.pixelSpacing||!instance.frameOfReferenceUID||!instance.imageOrientationPatient||!instance.imagePositionPatient){return;}var imageOrientation=instance.imageOrientationPatient.split('\\');var imagePosition=instance.imagePositionPatient.split('\\');var columnPixelSpacing=1.0;var rowPixelSpacing=1.0;if(instance.pixelSpacing){var split=instance.pixelSpacing.split('\\');rowPixelSpacing=parseFloat(split[0]);columnPixelSpacing=parseFloat(split[1]);}var cornerstoneMath=external.cornerstoneMath;return {frameOfReferenceUID:instance.frameOfReferenceUID,rows:instance.rows,columns:instance.columns,rowCosines:new cornerstoneMath.Vector3(parseFloat(imageOrientation[0]),parseFloat(imageOrientation[1]),parseFloat(imageOrientation[2])),columnCosines:new cornerstoneMath.Vector3(parseFloat(imageOrientation[3]),parseFloat(imageOrientation[4]),parseFloat(imageOrientation[5])),imagePositionPatient:new cornerstoneMath.Vector3(parseFloat(imagePosition[0]),parseFloat(imagePosition[1]),parseFloat(imagePosition[2])),rowPixelSpacing:rowPixelSpacing,columnPixelSpacing:columnPixelSpacing};}/**
       * This function extracts miltiframe information from a dicomParser.DataSet object.
       *
       * @param dataSet {Object} An instance of dicomParser.DataSet object where multiframe information can be found.
       * @return {Object} An object containing multiframe image metadata (frameIncrementPointer, frameTime, frameTimeVector, etc).
       */},{key:"getMultiframeModuleMetadata",value:function getMultiframeModuleMetadata(image){var imageInfo={isMultiframeImage:false,frameIncrementPointer:null,numberOfFrames:0,frameTime:0,frameTimeVector:null,averageFrameRate:0// backwards compatibility only... it might be useless in the future
  };var frameTime;var numberOfFrames=this.getFromImage(image,'intString','x00280008','numberOfFrames',-1);if(numberOfFrames>0){// set multi-frame image indicator
  imageInfo.isMultiframeImage=true;imageInfo.numberOfFrames=numberOfFrames;// (0028,0009) = Frame Increment Pointer
  var frameIncrementPointer=this.getFrameIncrementPointer(image);if(frameIncrementPointer==='frameTimeVector'){// Frame Increment Pointer points to Frame Time Vector (0018,1065) field
  var frameTimeVector=this.getFrameTimeVector(image);if(frameTimeVector instanceof Array&&frameTimeVector.length>0){imageInfo.frameIncrementPointer=frameIncrementPointer;imageInfo.frameTimeVector=frameTimeVector;frameTime=frameTimeVector.reduce(function(a,b){return a+b;})/frameTimeVector.length;imageInfo.averageFrameRate=1000/frameTime;}}else if(frameIncrementPointer==='frameTime'||frameIncrementPointer===''){frameTime=this.getFrameTime(image);if(frameTime>0){imageInfo.frameIncrementPointer=frameIncrementPointer;imageInfo.frameTime=frameTime;imageInfo.averageFrameRate=1000/frameTime;}}}return imageInfo;}/**
       * Get a bound reference to the provider function.
       */},{key:"getProvider",value:function getProvider(){var provider=this._provider;if(_typeof$4(this._provider)!==FUNCTION$2){provider=this.provider.bind(this);this._provider=provider;}return provider;}/**
       * Looks up metadata for Cornerstone Tools given a specified type and imageId
       * A type may be, e.g. 'study', or 'patient', or 'imagePlane'. These types
       * are keys in the stored metadata objects.
       *
       * @param type
       * @param imageId
       * @returns {Object} Relevant metadata of the specified type
       */},{key:"provider",value:function provider(type,imageId){// TODO: Cornerstone Tools use 'imagePlaneModule', but OHIF use 'imagePlane'. It must be consistent.
  if(type==='imagePlaneModule'){type='imagePlane';}var imageMetadata=this.metadataLookup.get(imageId);if(!imageMetadata){return;}if(imageMetadata.hasOwnProperty(type)){return imageMetadata[type];}}}]);return MetadataProvider;}();var cornerstone$1$1={MetadataProvider:MetadataProvider,getBoundingBox:getBoundingBox,pixelToPage:pixelToPage,repositionTextBox:repositionTextBox};var StudyPrefetcher=/*#__PURE__*/function(){function StudyPrefetcher(studies){var _this=this;_classCallCheck$b(this,StudyPrefetcher);_defineProperty$2(this,"cacheFullHandler",function(){log$1.warn('Cache full');_this.stopPrefetching();});this.studies=studies||[];this.prefetchDisplaySetsTimeout=300;this.lastActiveViewportElement=null;external.cornerstone.events.addEventListener('cornerstoneimagecachefull.StudyPrefetcher',this.cacheFullHandler);}_createClass$1(StudyPrefetcher,[{key:"destroy",value:function destroy(){this.stopPrefetching();external.cornerstone.events.removeEventListener('cornerstoneimagecachefull.StudyPrefetcher',this.cacheFullHandler);}},{key:"setStudies",value:function setStudies(studies){this.stopPrefetching();this.studies=studies;}},{key:"prefetch",value:function prefetch(){if(!this.studies||!this.studies.length){return;}this.stopPrefetching();this.prefetchDisplaySets();}},{key:"stopPrefetching",value:function stopPrefetching(){external.cornerstoneTools.requestPoolManager.clearRequestStack('prefetch');}},{key:"prefetchDisplaySetsAsync",value:function prefetchDisplaySetsAsync(timeout){var _this2=this;timeout=timeout||this.prefetchDisplaySetsTimeout;clearTimeout(this.prefetchDisplaySetsHandler);this.prefetchDisplaySetsHandler=setTimeout(function(){_this2.prefetchDisplaySets();},timeout);}},{key:"prefetchDisplaySets",value:function prefetchDisplaySets(){// TODO: Allow passing in config
  var config={order:'closest',displaySetCount:1};var displaySetsToPrefetch=this.getDisplaySetsToPrefetch(config);var imageIds=this.getImageIdsFromDisplaySets(displaySetsToPrefetch);this.prefetchImageIds(imageIds);}},{key:"prefetchImageIds",value:function prefetchImageIds(imageIds){var nonCachedImageIds=this.filterCachedImageIds(imageIds);var requestPoolManager=external.cornerstoneTools.requestPoolManager;var requestType='prefetch';var preventCache=false;var noop=function noop(){};nonCachedImageIds.forEach(function(imageId){requestPoolManager.addRequest({},imageId,requestType,preventCache,noop,noop);});requestPoolManager.startGrabbing();}},{key:"getStudy",value:function getStudy(image){var studyMetadata=external.cornerstone.metaData.get('study',image.imageId);return OHIF.viewer.Studies.find(function(study){return study.studyInstanceUid===studyMetadata.studyInstanceUid;});}},{key:"getSeries",value:function getSeries(study,image){var seriesMetadata=external.cornerstone.metaData.get('series',image.imageId);var studyMetadata=OHIF.viewerbase.getStudyMetadata(study);return studyMetadata.getSeriesByUID(seriesMetadata.seriesInstanceUid);}},{key:"getInstance",value:function getInstance(series,image){var instanceMetadata=external.cornerstone.metaData.get('instance',image.imageId);return series.getInstanceByUID(instanceMetadata.sopInstanceUid);}},{key:"getActiveDisplaySet",value:function getActiveDisplaySet(displaySets,instance){return displaySets.find(function(displaySet){return displaySet.images.some(function(displaySetImage){return displaySetImage.sopInstanceUid===instance.sopInstanceUid;});});}},{key:"getDisplaySetsToPrefetch",value:function getDisplaySetsToPrefetch(config){var image=this.getActiveViewportImage();if(!image||!config||!config.displaySetCount){return [];}/*const study = this.getStudy(image);
        const series = this.getSeries(study, image);
        const instance = this.getInstance(series, image);*/var displaySets=study.displaySets;var activeDisplaySet=null;//this.getActiveDisplaySet(displaySets, instance);
  var prefetchMethodMap={topdown:'getFirstDisplaySets',downward:'getNextDisplaySets',closest:'getClosestDisplaySets'};var prefetchOrder=config.order;var methodName=prefetchMethodMap[prefetchOrder];var getDisplaySets=this[methodName];if(!getDisplaySets){if(prefetchOrder){log$1.warn("Invalid prefetch order configuration (".concat(prefetchOrder,")"));}return [];}return getDisplaySets.call(this,displaySets,activeDisplaySet,config.displaySetCount);}},{key:"getFirstDisplaySets",value:function getFirstDisplaySets(displaySets,activeDisplaySet,displaySetCount){var length=displaySets.length;var selectedDisplaySets=[];for(var i=0;i<length&&displaySetCount;i++){var displaySet=displaySets[i];if(displaySet!==activeDisplaySet){selectedDisplaySets.push(displaySet);displaySetCount--;}}return selectedDisplaySets;}},{key:"getNextDisplaySets",value:function getNextDisplaySets(displaySets,activeDisplaySet,displaySetCount){var activeDisplaySetIndex=displaySets.indexOf(activeDisplaySet);var begin=activeDisplaySetIndex+1;var end=Math.min(begin+displaySetCount,displaySets.length);return displaySets.slice(begin,end);}},{key:"getClosestDisplaySets",value:function getClosestDisplaySets(displaySets,activeDisplaySet,displaySetCount){var activeDisplaySetIndex=displaySets.indexOf(activeDisplaySet);var length=displaySets.length;var selectedDisplaySets=[];var left=activeDisplaySetIndex-1;var right=activeDisplaySetIndex+1;while((left>=0||right<length)&&displaySetCount){if(left>=0){selectedDisplaySets.push(displaySets[left]);displaySetCount--;left--;}if(right<length&&displaySetCount){selectedDisplaySets.push(displaySets[right]);displaySetCount--;right++;}}return selectedDisplaySets;}},{key:"getImageIdsFromDisplaySets",value:function getImageIdsFromDisplaySets(displaySets){var _this3=this;var imageIds=[];displaySets.forEach(function(displaySet){imageIds=imageIds.concat(_this3.getImageIdsFromDisplaySet(displaySet));});return imageIds;}},{key:"getImageIdsFromDisplaySet",value:function getImageIdsFromDisplaySet(displaySet){var imageIds=[];// TODO: This duplicates work done by the stack manager
  displaySet.images.forEach(function(image){var numFrames=image.numFrames;if(numFrames>1){for(var i=0;i<numFrames;i++){var imageId=getImageId(image,i);imageIds.push(imageId);}}else{var _imageId=getImageId(image);imageIds.push(_imageId);}});return imageIds;}},{key:"filterCachedImageIds",value:function filterCachedImageIds(imageIds){var _this4=this;return imageIds.filter(function(imageId){return !_this4.isImageCached(imageId);});}},{key:"isImageCached",value:function isImageCached(imageId){var image=external.cornerstone.imageCache.imageCache[imageId];return image&&image.sizeInBytes;}}],[{key:"getInstance",value:function getInstance(){if(!StudyPrefetcher.instance){StudyPrefetcher.instance=new StudyPrefetcher([]);}return StudyPrefetcher.instance;}}]);return StudyPrefetcher;}();var setToolActive=function setToolActive(tool){return {type:'SET_TOOL_ACTIVE',tool:tool};};var setViewportActive=function setViewportActive(viewportIndex){return {type:'SET_VIEWPORT_ACTIVE',viewportIndex:viewportIndex};};var setLayout=function setLayout(layout){return {type:'SET_LAYOUT',layout:layout};};var setStudyLoadingProgress=function setStudyLoadingProgress(progressId,progressData){return {type:'SET_STUDY_LOADING_PROGRESS',progressId:progressId,progressData:progressData};};var clearStudyLoadingProgress=function clearStudyLoadingProgress(progressId){return {type:'CLEAR_STUDY_LOADING_PROGRESS',progressId:progressId};};var setViewportSpecificData=function setViewportSpecificData(viewportIndex,data){return {type:'SET_VIEWPORT_SPECIFIC_DATA',viewportIndex:viewportIndex,data:data};};var clearViewportSpecificData=function clearViewportSpecificData(viewportIndex){return {type:'CLEAR_VIEWPORT_SPECIFIC_DATA',viewportIndex:viewportIndex};};var addPlugin=function addPlugin(plugin){return {type:"ADD_PLUGIN",plugin:plugin};};var setAvailableButtons=function setAvailableButtons(buttons){return {type:'SET_AVAILABLE_BUTTONS',buttons:buttons};};var actions={setToolActive:setToolActive,setViewportActive:setViewportActive,setLayout:setLayout,setStudyLoadingProgress:setStudyLoadingProgress,clearStudyLoadingProgress:clearStudyLoadingProgress,setViewportSpecificData:setViewportSpecificData,clearViewportSpecificData:clearViewportSpecificData,addPlugin:addPlugin,setAvailableButtons:setAvailableButtons};var BaseLoadingListener=/*#__PURE__*/function(){function BaseLoadingListener(stack){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck$b(this,BaseLoadingListener);this.id=BaseLoadingListener.getNewId();this.stack=stack;this.startListening();this.statsItemsLimit=options.statsItemsLimit||2;this.stats={items:[],total:0,elapsedTime:0,speed:0};this._setProgressData=options._setProgressData;this._clearProgressById=options._clearProgressById;// Register the start point to make it possible to calculate
  // bytes/s or frames/s when the first byte or frame is received
  this._addStatsData(0);// Update the progress before starting the download
  // to make it possible to update the UI
  this._updateProgress();}_createClass$1(BaseLoadingListener,[{key:"_addStatsData",value:function _addStatsData(value){var date=new Date();var stats=this.stats;var items=stats.items;var newItem={value:value,date:date};items.push(newItem);stats.total+=newItem.value;// Remove items until it gets below the limit
  while(items.length>this.statsItemsLimit){var item=items.shift();stats.total-=item.value;}// Update the elapsedTime (seconds) based on first and last
  // elements and recalculate the speed (bytes/s or frames/s)
  if(items.length>1){var oldestItem=items[0];stats.elapsedTime=(newItem.date.getTime()-oldestItem.date.getTime())/1000;stats.speed=(stats.total-oldestItem.value)/stats.elapsedTime;}}},{key:"_getProgressId",value:function _getProgressId(){var displaySetInstanceUid=this.stack.displaySetInstanceUid;return 'StackProgress:'+displaySetInstanceUid;}},{key:"_clearProgress",value:function _clearProgress(){var progressId=this._getProgressId();this._clearProgressById(progressId);}},{key:"startListening",value:function startListening(){throw new Error('`startListening` must be implemented by child classes');}},{key:"stopListening",value:function stopListening(){throw new Error('`stopListening` must be implemented by child classes');}},{key:"destroy",value:function destroy(){this.stopListening();this._clearProgress();}}],[{key:"getNewId",value:function getNewId(){var timeSlice=new Date().getTime().toString().slice(-8);var randomNumber=parseInt(Math.random()*1000000000);return timeSlice.toString()+randomNumber.toString();}}]);return BaseLoadingListener;}();var DICOMFileLoadingListener=/*#__PURE__*/function(_BaseLoadingListener){_inherits$b(DICOMFileLoadingListener,_BaseLoadingListener);function DICOMFileLoadingListener(stack,options){var _this;_classCallCheck$b(this,DICOMFileLoadingListener);_this=_possibleConstructorReturn$b(this,_getPrototypeOf(DICOMFileLoadingListener).call(this,stack,options));_defineProperty$2(_assertThisInitialized$2(_assertThisInitialized$2(_this)),"_imageLoadProgressEventHandler",function(e){var eventData=e.detail;var dataSetUrl=_this._convertImageIdToDataSetUrl(eventData.imageId);var bytesDiff=eventData.loaded-_this._lastLoaded;if(!_this._dataSetUrl===dataSetUrl){return;}// Add the bytes downloaded to the stats
  _this._addStatsData(bytesDiff);// Update the download progress
  _this._updateProgress(eventData);// Cache the last eventData.loaded value
  _this._lastLoaded=eventData.loaded;});_this._dataSetUrl=_this._getDataSetUrl(stack);_this._lastLoaded=0;// Check how many instances has already been download (cached)
  _this._checkCachedData();return _this;}_createClass$1(DICOMFileLoadingListener,[{key:"_checkCachedData",value:function _checkCachedData(){var dataSet=external.cornerstoneWADOImageLoader.wadouri.dataSetCacheManager.get(this._dataSetUrl);if(dataSet){var dataSetLength=dataSet.byteArray.length;this._updateProgress({percentComplete:100,loaded:dataSetLength,total:dataSetLength});}}},{key:"_getImageLoadProgressEventName",value:function _getImageLoadProgressEventName(){// TODO: Add this event as a constant in Cornerstone
  return 'cornerstoneimageloadprogress.'+this.id;}},{key:"startListening",value:function startListening(){var imageLoadProgressEventName=this._getImageLoadProgressEventName();this.imageLoadProgressEventHandler=this._imageLoadProgressEventHandle.bind(this);this.stopListening();external.cornerstone.events.addEventListener(imageLoadProgressEventName,this.imageLoadProgressEventHandle);}},{key:"stopListening",value:function stopListening(){var imageLoadProgressEventName=this._getImageLoadProgressEventName();external.cornerstone.events.removeEventListener(imageLoadProgressEventName,this.imageLoadProgressEventHandle);}},{key:"_updateProgress",value:function _updateProgress(eventData){var progressId=this._getProgressId();eventData=eventData||{};var progressData={multiFrame:false,percentComplete:eventData.percentComplete,bytesLoaded:eventData.loaded,bytesTotal:eventData.total,bytesPerSecond:this.stats.speed};this._setProgressData(progressId,progressData);}},{key:"_convertImageIdToDataSetUrl",value:function _convertImageIdToDataSetUrl(imageId){// Remove the prefix ("dicomweb:" or "wadouri:"")
  imageId=imageId.replace(/^(dicomweb:|wadouri:)/i,'');// Remove "frame=999&" from the imageId
  imageId=imageId.replace(/frame=\d+&?/i,'');// Remove the last "&" like in "http://...?foo=1&bar=2&"
  imageId=imageId.replace(/&$/,'');return imageId;}},{key:"_getDataSetUrl",value:function _getDataSetUrl(stack){var imageId=stack.imageIds[0];return this._convertImageIdToDataSetUrl(imageId);}}]);return DICOMFileLoadingListener;}(BaseLoadingListener);var StackLoadingListener=/*#__PURE__*/function(_BaseLoadingListener2){_inherits$b(StackLoadingListener,_BaseLoadingListener2);function StackLoadingListener(stack){var _this2;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck$b(this,StackLoadingListener);options.statsItemsLimit=20;_this2=_possibleConstructorReturn$b(this,_getPrototypeOf(StackLoadingListener).call(this,stack,options));_this2.imageDataMap=_this2._convertImageIdsArrayToMap(stack.imageIds);_this2.framesStatus=_this2._createArray(stack.imageIds.length,false);_this2.loadedCount=0;// Check how many instances has already been download (cached)
  _this2._checkCachedData();return _this2;}_createClass$1(StackLoadingListener,[{key:"_convertImageIdsArrayToMap",value:function _convertImageIdsArrayToMap(imageIds){var imageIdsMap=new Map();for(var i=0;i<imageIds.length;i++){imageIdsMap.set(imageIds[i],{index:i,loaded:false});}return imageIdsMap;}},{key:"_createArray",value:function _createArray(length,defaultValue){// `new Array(length)` is an anti-pattern in javascript because its
  // funny API. Otherwise I would go for `new Array(length).fill(false)`
  var array=[];for(var i=0;i<length;i++){array[i]=defaultValue;}return array;}},{key:"_checkCachedData",value:function _checkCachedData(){// const imageIds = this.stack.imageIds;
  // TODO: No way to check status of Promise.
  /*for(let i = 0; i < imageIds.length; i++) {
                const imageId = imageIds[i];
                 const imagePromise = cornerstone.imageCache.getImageLoadObject(imageId).promise;
                 if (imagePromise && (imagePromise.state() === 'resolved')) {
                    this._updateFrameStatus(imageId, true);
                }
            }*/}},{key:"_getImageLoadedEventName",value:function _getImageLoadedEventName(){return "".concat(external.cornerstone.EVENTS.IMAGE_LOADED,".").concat(this.id);}},{key:"_getImageCachePromiseRemoveEventName",value:function _getImageCachePromiseRemoveEventName(){return "".concat(external.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,".").concat(this.id);}},{key:"_imageLoadedEventHandler",value:function _imageLoadedEventHandler(e){this._updateFrameStatus(e.detail.image.imageId,true);}},{key:"_imageCachePromiseRemovedEventHandler",value:function _imageCachePromiseRemovedEventHandler(e){this._updateFrameStatus(e.detail.imageId,false);}},{key:"startListening",value:function startListening(){var imageLoadedEventName=this._getImageLoadedEventName();var imageCachePromiseRemovedEventName=this._getImageCachePromiseRemoveEventName();this.imageLoadedEventHandler=this._imageLoadedEventHandler.bind(this);this.imageCachePromiseRemovedEventHandler=this._imageCachePromiseRemovedEventHandler.bind(this);this.stopListening();external.cornerstone.events.addEventListener(imageLoadedEventName,this.imageLoadedEventHandler);external.cornerstone.events.addEventListener(imageCachePromiseRemovedEventName,this.imageCachePromiseRemovedEventHandler);}},{key:"stopListening",value:function stopListening(){var imageLoadedEventName=this._getImageLoadedEventName();var imageCachePromiseRemovedEventName=this._getImageCachePromiseRemoveEventName();external.cornerstone.events.removeEventListener(imageLoadedEventName,this.imageLoadedEventHandler);external.cornerstone.events.removeEventListener(imageCachePromiseRemovedEventName,this.imageCachePromiseRemovedEventHandler);}},{key:"_updateFrameStatus",value:function _updateFrameStatus(imageId,loaded){var imageData=this.imageDataMap.get(imageId);if(!imageData||imageData.loaded===loaded){return;}// Add one more frame to the stats
  if(loaded){this._addStatsData(1);}imageData.loaded=loaded;this.framesStatus[imageData.index]=loaded;this.loadedCount+=loaded?1:-1;this._updateProgress();}},{key:"_setProgressData",value:function _setProgressData(progressId,progressData){// TODO: This method (and _clearProgressById) need to access
  // the Redux store and should therefore be provided from the
  // application. I've added a workaround to pass this in through
  // the 'options' variable on instantiation, but this is really ugly.
  // We could consider making the StudyLoadingListener a higher-order
  // component which would set this stuff itself.
  throw new Error("The _setProgressData function must be provided in StudyLoadingListener's options");}},{key:"_clearProgressById",value:function _clearProgressById(progressId){throw new Error("The _clearProgressById function must be provided in StudyLoadingListener's options");}},{key:"_updateProgress",value:function _updateProgress(){var totalFramesCount=this.stack.imageIds.length;var loadedFramesCount=this.loadedCount;var loadingFramesCount=totalFramesCount-loadedFramesCount;var percentComplete=Math.round(loadedFramesCount/totalFramesCount*100);var progressId=this._getProgressId();var progressData={multiFrame:true,totalFramesCount:totalFramesCount,loadedFramesCount:loadedFramesCount,loadingFramesCount:loadingFramesCount,percentComplete:percentComplete,framesPerSecond:this.stats.speed,framesStatus:this.framesStatus};this._setProgressData(progressId,progressData);}},{key:"_logProgress",value:function _logProgress(){var totalFramesCount=this.stack.imageIds.length;var displaySetInstanceUid=this.stack.displaySetInstanceUid;var progressBar='[';for(var i=0;i<totalFramesCount;i++){var ch=this.framesStatus[i]?'|':'.';progressBar+="".concat(ch);}progressBar+=']';log.info("".concat(displaySetInstanceUid,": ").concat(progressBar));}}]);return StackLoadingListener;}(BaseLoadingListener);var StudyLoadingListener=/*#__PURE__*/function(){function StudyLoadingListener(options){_classCallCheck$b(this,StudyLoadingListener);this.listeners={};this.options=options;}_createClass$1(StudyLoadingListener,[{key:"addStack",value:function addStack(stack,stackMetaData){var displaySetInstanceUid=stack.displaySetInstanceUid;if(!this.listeners[displaySetInstanceUid]){var listener=this._createListener(stack,stackMetaData);if(listener){this.listeners[displaySetInstanceUid]=listener;}}}},{key:"addStudy",value:function addStudy(study){var _this3=this;study.displaySets.forEach(function(displaySet){var stack=StackManager.findOrCreateStack(study,displaySet);_this3.addStack(stack,{isMultiFrame:displaySet.isMultiFrame});});}},{key:"addStudies",value:function addStudies(studies){var _this4=this;if(!studies||!studies.length){return;}studies.forEach(function(study){return _this4.addStudy(study);});}},{key:"clear",value:function clear(){var displaySetInstanceUids=Object.keys(this.listeners);var length=displaySetInstanceUids.length;for(var i=0;i<length;i++){var displaySetInstanceUid=displaySetInstanceUids[i];var displaySet=this.listeners[displaySetInstanceUid];displaySet.destroy();}this.listeners={};}},{key:"_createListener",value:function _createListener(stack,stackMetaData){var schema=this._getSchema(stack);// A StackLoadingListener can be created if it's wadors or not a multiframe
  // wadouri instance (single file) that means "N" files will have to be
  // downloaded where "N" is the number of frames. DICOMFileLoadingListener
  // is created only if it's a single DICOM file and there's no way to know
  // how many frames has already been loaded (bytes/s instead of frames/s).
  if(schema==='wadors'||!stackMetaData.isMultiFrame){return new StackLoadingListener(stack,this.options);}else{return new DICOMFileLoadingListener(stack,this.options);}}},{key:"_getSchema",value:function _getSchema(stack){var imageId=stack.imageIds[0];var colonIndex=imageId.indexOf(':');return imageId.substring(0,colonIndex);}// Singleton
  }],[{key:"getInstance",value:function getInstance(options){if(!StudyLoadingListener._instance){StudyLoadingListener._instance=new StudyLoadingListener(options);}return StudyLoadingListener._instance;}}]);return StudyLoadingListener;}();/**
   * Constants
   */var PROPERTY_SEPARATOR='.';var ORDER_ASC='asc';var ORDER_DESC='desc';var MIN_COUNT=0x00000000;var MAX_COUNT=0x7fffffff;/**
   * Class Definition
   */var TypeSafeCollection=/*#__PURE__*/function(){function TypeSafeCollection(){_classCallCheck$b(this,TypeSafeCollection);this._operationCount=MIN_COUNT;this._elementList=[];this._handlers=Object.create(null);}/**
     * Private Methods
     */_createClass$1(TypeSafeCollection,[{key:"_invalidate",value:function _invalidate(){var count=this._operationCount;this._operationCount=count<MAX_COUNT?count+1:MIN_COUNT;}},{key:"_elements",value:function _elements(silent){silent===true||this._operationCount;return this._elementList;}},{key:"_elementWithPayload",value:function _elementWithPayload(payload,silent){return this._elements(silent).find(function(item){return item.payload===payload;});}},{key:"_elementWithId",value:function _elementWithId(id,silent){return this._elements(silent).find(function(item){return item.id===id;});}},{key:"_trigger",value:function _trigger(event,data){var handlers=this._handlers;if(event in handlers){handlers=handlers[event];if(!(handlers instanceof Array)){return;}for(var i=0,limit=handlers.length;i<limit;++i){var handler=handlers[i];if(_isFunction(handler)){handler.call(null,data);}}}}/**
       * Public Methods
       */},{key:"onInsert",value:function onInsert(callback){if(_isFunction(callback)){var handlers=this._handlers.insert;if(!(handlers instanceof Array)){handlers=[];this._handlers.insert=handlers;}handlers.push(callback);}}/**
       * Update the payload associated with the given ID to be the new supplied payload.
       * @param {string} id The ID of the entry that will be updated.
       * @param {any} payload The element that will replace the previous payload.
       * @returns {boolean} Returns true if the given ID is present in the collection, false otherwise.
       */},{key:"updateById",value:function updateById(id,payload){var result=false,found=this._elementWithPayload(payload,true);if(found){// nothing to do since the element is already in the collection...
  if(found.id===id){// set result to true since the ids match...
  result=true;this._invalidate();}}else{found=this._elementWithId(id,true);if(found){found.payload=payload;result=true;this._invalidate();}}return result;}/**
       * Signal that the given element has been changed by notifying reactive data-source observers.
       * This method is basically a means to invalidate the inernal reactive data-source.
       * @param {any} payload The element that has been altered.
       * @returns {boolean} Returns true if the element is present in the collection, false otherwise.
       */},{key:"update",value:function update(payload){var result=false,found=this._elementWithPayload(payload,true);if(found){// nothing to do since the element is already in the collection...
  result=true;this._invalidate();}return result;}/**
       * Insert an element in the collection. On success, the element ID (a unique string) is returned. On failure, returns null.
       * A failure scenario only happens when the given payload is already present in the collection. Note that NO exceptions are thrown!
       * @param {any} payload The element to be stored.
       * @returns {string} The ID of the inserted element or null if the element already exists...
       */},{key:"insert",value:function insert(payload){var id=null,found=this._elementWithPayload(payload,true);if(!found){id=OHIF.utils.guid();this._elements(true).push({id:id,payload:payload});this._invalidate();this._trigger('insert',{id:id,data:payload});}return id;}/**
       * Remove all elements from the collection.
       * @returns {void} No meaningful value is returned.
       */},{key:"removeAll",value:function removeAll(){var all=this._elements(true),length=all.length;for(var i=length-1;i>=0;i--){var item=all[i];delete item.id;delete item.payload;all[i]=null;}all.splice(0,length);this._invalidate();}/**
       * Remove elements from the collection that match the criteria given in the property map.
       * @param {Object} propertyMap A property map that will be macthed against all collection elements.
       * @returns {Array} A list with all removed elements.
       */},{key:"remove",value:function remove(propertyMap){var found=this.findAllEntriesBy(propertyMap),foundCount=found.length,removed=[];if(foundCount>0){var all=this._elements(true);for(var i=foundCount-1;i>=0;i--){var item=found[i];all.splice(item[2],1);removed.push(item[0]);}this._invalidate();}return removed;}/**
       * Provides the ID of the given element inside the collection.
       * @param {any} payload The element being searched for.
       * @returns {string} The ID of the given element or undefined if the element is not present.
       */},{key:"getElementId",value:function getElementId(payload){var found=this._elementWithPayload(payload);return found&&found.id;}/**
       * Provides the position of the given element in the internal list returning -1 if the element is not present.
       * @param {any} payload The element being searched for.
       * @returns {number} The position of the given element in the internal list. If the element is not present -1 is returned.
       */},{key:"findById",value:function findById(id){var found=this._elementWithId(id);return found&&found.payload;}/**
       * Provides the position of the given element in the internal list returning -1 if the element is not present.
       * @param {any} payload The element being searched for.
       * @returns {number} The position of the given element in the internal list. If the element is not present -1 is returned.
       */},{key:"indexOfElement",value:function indexOfElement(payload){return this._elements().indexOf(this._elementWithPayload(payload,true));}/**
       * Provides the position of the element associated with the given ID in the internal list returning -1 if the element is not present.
       * @param {string} id The index of the element.
       * @returns {number} The position of the element associated with the given ID in the internal list. If the element is not present -1 is returned.
       */},{key:"indexOfId",value:function indexOfId(id){return this._elements().indexOf(this._elementWithId(id,true));}/**
       * Provides a list-like approach to the collection returning an element by index.
       * @param {number} index The index of the element.
       * @returns {any} If out of bounds, undefined is returned. Otherwise the element in the given position is returned.
       */},{key:"getElementByIndex",value:function getElementByIndex(index){var found=this._elements()[index>=0?index:-1];return found&&found.payload;}/**
       * Find an element by a criteria defined by the given callback function.
       * Attention!!! The reactive source will not be notified if no valid callback is supplied...
       * @param {function} callback A callback function which will define the search criteria. The callback
       * function will be passed the collection element, its ID and its index in this very order. The callback
       * shall return true when its criterea has been fulfilled.
       * @returns {any} The matched element or undefined if not match was found.
       */},{key:"find",value:function find(callback){var _this=this;var found;if(_isFunction(callback)){found=this._elements().find(function(item,index){return callback.call(_this,item.payload,item.id,index);});}return found&&found.payload;}/**
       * Find the first element that strictly matches the specified property map.
       * @param {Object} propertyMap A property map that will be macthed against all collection elements.
       * @param {Object} options A set of options. Currently only "options.sort" option is supported.
       * @param {Object.SortingSpecifier} options.sort An optional sorting specifier. If a sorting specifier is supplied
       * but is not valid, an exception will be thrown.
       * @returns {Any} The matched element or undefined if not match was found.
       */},{key:"findBy",value:function findBy(propertyMap,options){var found;if(_isObject(options)){// if the "options" argument is provided and is a valid object,
  // it must be applied to the dataset before search...
  var all=this.all(options);if(all.length>0){if(_isObject(propertyMap)){found=all.find(function(item){return _compareToPropertyMapStrict(propertyMap,item);});}else{found=all[0];// simply extract the first element...
  }}}else if(_isObject(propertyMap)){found=this._elements().find(function(item){return _compareToPropertyMapStrict(propertyMap,item.payload);});if(found){found=found.payload;}}return found;}/**
       * Find all elements that strictly match the specified property map.
       * Attention!!! The reactive source will not be notified if no valid property map is supplied...
       * @param {Object} propertyMap A property map that will be macthed against all collection elements.
       * @returns {Array} An array of entries of all elements that match the given criteria. Each set in
       * in the array has the following format: [ elementData, elementId, elementIndex ].
       */},{key:"findAllEntriesBy",value:function findAllEntriesBy(propertyMap){var found=[];if(_isObject(propertyMap)){this._elements().forEach(function(item,index){if(_compareToPropertyMapStrict(propertyMap,item.payload)){// Match! Add it to the found list...
  found.push([item.payload,item.id,index]);}});}return found;}/**
       * Find all elements that match a specified property map.
       * Attention!!! The reactive source will not be notified if no valid property map is supplied...
       * @param {Object} propertyMap A property map that will be macthed against all collection elements.
       * @param {Object} options A set of options. Currently only "options.sort" option is supported.
       * @param {Object.SortingSpecifier} options.sort An optional sorting specifier. If a sorting specifier is supplied
       * but is not valid, an exception will be thrown.
       * @returns {Array} An array with all elements that match the given criteria and sorted in the specified sorting order.
       */},{key:"findAllBy",value:function findAllBy(propertyMap,options){var found=this.findAllEntriesBy(propertyMap).map(function(item){return item[0];});// Only payload is relevant...
  if(_isObject(options)){if('sort'in options){_sortListBy(found,options.sort);}}return found;}/**
       * Executes the supplied callback function for each element of the collection.
       * Attention!!! The reactive source will not be notified if no valid property map is supplied...
       * @param {function} callback The callback function to be executed. The callback is passed the element,
       * its ID and its index in this very order.
       * @returns {void} Nothing is returned.
       */},{key:"forEach",value:function forEach(callback){var _this2=this;if(_isFunction(callback)){this._elements().forEach(function(item,index){callback.call(_this2,item.payload,item.id,index);});}}/**
       * Count the number of elements currently in the collection.
       * @returns {number} The current number of elements in the collection.
       */},{key:"count",value:function count(){return this._elements().length;}/**
       * Returns a list with all elements of the collection optionally sorted by a sorting specifier criteria.
       * @param {Object} options A set of options. Currently only "options.sort" option is supported.
       * @param {Object.SortingSpecifier} options.sort An optional sorting specifier. If a sorting specifier is supplied
       * but is not valid, an exception will be thrown.
       * @returns {Array} An array with all elements stored in the collection.
       */},{key:"all",value:function all(options){var list=this._elements().map(function(item){return item.payload;});if(_isObject(options)){if('sort'in options){_sortListBy(list,options.sort);}}return list;}}]);return TypeSafeCollection;}();/**
   * Utility Functions
   */ /**
   * Test if supplied argument is a valid object for current class purposes.
   * Atention! The underscore version of this function should not be used for performance reasons.
   */function _isObject(subject){return subject instanceof Object||_typeof$4(subject)==='object'&&subject!==null;}/**
   * Test if supplied argument is a valid string for current class purposes.
   * Atention! The underscore version of this function should not be used for performance reasons.
   */function _isString(subject){return typeof subject==='string';}/**
   * Test if supplied argument is a valid function for current class purposes.
   * Atention! The underscore version of this function should not be used for performance reasons.
   */function _isFunction(subject){return typeof subject==='function';}/**
   * Shortcut for Object's prototype "hasOwnProperty" method.
   */var _hasOwnProperty=Object.prototype.hasOwnProperty;/**
   * Retrieve an object's property value by name. Composite property names (e.g., 'address.country.name') are accepted.
   * @param {Object} targetObject The object we want read the property from...
   * @param {String} propertyName The property to be read (e.g., 'address.street.name' or 'address.street.number'
   * to read object.address.street.name or object.address.street.number, respectively);
   * @returns {Any} Returns whatever the property holds or undefined if the property cannot be read or reached.
   */function _getPropertyValue(targetObject,propertyName){var propertyValue;// undefined (the default return value)
  if(_isObject(targetObject)&&_isString(propertyName)){var fragments=propertyName.split(PROPERTY_SEPARATOR);var fragmentCount=fragments.length;if(fragmentCount>0){var firstFragment=fragments[0];var remainingFragments=fragmentCount>1?fragments.slice(1).join(PROPERTY_SEPARATOR):null;propertyValue=targetObject[firstFragment];if(remainingFragments!==null){propertyValue=_getPropertyValue(propertyValue,remainingFragments);}}}return propertyValue;}/**
   * Compare a property map with a target object using strict comparison.
   * @param {Object} propertyMap The property map whose properties will be used for comparison. Composite
   * property names (e.g., 'address.country.name') will be tested against the "resolved" properties from the target object.
   * @param {Object} targetObject The target object whose properties will be tested.
   * @returns {boolean} Returns true if the properties match, false otherwise.
   */function _compareToPropertyMapStrict(propertyMap,targetObject){var result=false;// "for in" loops do not thown exceptions for invalid data types...
  for(var propertyName in propertyMap){if(_hasOwnProperty.call(propertyMap,propertyName)){if(propertyMap[propertyName]!==_getPropertyValue(targetObject,propertyName)){result=false;break;}else if(result!==true){result=true;}}}return result;}/**
   * Checks if a sorting specifier is valid.
   * A valid sorting specifier consists of an array of arrays being each subarray a pair
   * in the format ["property name", "sorting order"].
   * The following exemple can be used to sort studies by "date"" and use "time" to break ties in descending order.
   * [ [ 'study.date', 'desc' ], [ 'study.time', 'desc' ] ]
   * @param {Array} specifiers The sorting specifier to be tested.
   * @returns {boolean} Returns true if the specifiers are valid, false otherwise.
   */function _isValidSortingSpecifier(specifiers){var result=true;if(specifiers instanceof Array&&specifiers.length>0){for(var i=specifiers.length-1;i>=0;i--){var item=specifiers[i];if(item instanceof Array){var property=item[0];var order=item[1];if(_isString(property)&&(order===ORDER_ASC||order===ORDER_DESC)){continue;}}result=false;break;}}return result;}/**
   * Sorts an array based on sorting specifier options.
   * @param {Array} list The that needs to be sorted.
   * @param {Array} specifiers An array of specifiers. Please read isValidSortingSpecifier method definition for further details.
   * @returns {void} No value is returned. The array is sorted in place.
   */function _sortListBy(list,specifiers){if(list instanceof Array&&_isValidSortingSpecifier(specifiers)){var specifierCount=specifiers.length;list.sort(function _sortListByCallback(a,b){// callback name for stack traces...
  var index=0;while(index<specifierCount){var specifier=specifiers[index];var property=specifier[0];var order=specifier[1]===ORDER_DESC?-1:1;var aValue=_getPropertyValue(a,property);var bValue=_getPropertyValue(b,property);// @TODO: should we check for the types being compared, like:
  // ~~ if (typeof aValue !== typeof bValue) continue;
  // Not sure because dates, for example, can be correctly compared to numbers...
  if(aValue<bValue){return order*-1;}if(aValue>bValue){return order*1;}if(++index>=specifierCount){return 0;}}});}else{throw new Error('Invalid Arguments');}}/**
   * Abstract class to fetch study metadata.
   */var StudyMetadataSource=/*#__PURE__*/function(){function StudyMetadataSource(){_classCallCheck$b(this,StudyMetadataSource);}_createClass$1(StudyMetadataSource,[{key:"getByInstanceUID",/**
       * Get study metadata for a study with given study InstanceUID.
       * @param {String} studyInstanceUID Study InstanceUID.
       */value:function getByInstanceUID(studyInstanceUID){/**
         * Please override this method on a specialized class.
         */throw new OHIFError('StudyMetadataSource::getByInstanceUID is not overriden. Please, override it in a specialized class. See OHIFStudyMetadataSource for example');}/**
       * Load study info and study metadata for a given study into the viewer.
       * @param {StudySummary|StudyMetadata} study of StudySummary or StudyMetadata object.
       */},{key:"loadStudy",value:function loadStudy(study){/**
         * Please override this method on a specialized class.
         */throw new OHIFError('StudyMetadataSource::loadStudy is not overriden. Please, override it in a specialized class. See OHIFStudyMetadataSource for example');}}]);return StudyMetadataSource;}();var classes={MetadataProvider:MetadataProvider,CommandsManager:CommandsManager,HotkeysContext:HotkeysContext,HotkeysManager:HotkeysManager,ImageSet:ImageSet,StudyPrefetcher:StudyPrefetcher,StudyLoadingListener:StudyLoadingListener,StackLoadingListener:StackLoadingListener,DICOMFileLoadingListener:DICOMFileLoadingListener,StudyMetadata:StudyMetadata,SeriesMetadata:SeriesMetadata,InstanceMetadata:InstanceMetadata,//StudySummary,
  TypeSafeCollection:TypeSafeCollection,OHIFError:OHIFError,StudyMetadataSource:StudyMetadataSource};var defaultButtons=[{command:'Pan',type:'tool',text:'Pan',svgUrl:'/icons.svg#icon-tools-pan',active:false},{command:'Zoom',type:'tool',text:'Zoom',svgUrl:'/icons.svg#icon-tools-zoom',active:false},{command:'Bidirectional',type:'tool',text:'Bidirectional',svgUrl:'/icons.svg#icon-tools-measure-target',active:false},{command:'StackScroll',type:'tool',text:'Stack Scroll',svgUrl:'/icons.svg#icon-tools-stack-scroll',active:false},{command:'reset',type:'command',text:'Reset',svgUrl:'/icons.svg#icon-tools-reset',active:false},{command:'Wwwc',type:'tool',text:'Manual',svgUrl:'/icons.svg#icon-tools-levels',active:true},{command:'setWLPresetSoftTissue',type:'command',text:'Soft Tissue',svgUrl:'/icons.svg#icon-wl-soft-tissue',active:false},{command:'setWLPresetLung',type:'command',text:'Lung',svgUrl:'/icons.svg#icon-wl-lung',active:false},{command:'setWLPresetLiver',type:'command',text:'Liver',svgUrl:'/icons.svg#icon-wl-liver',active:false},{command:'setWLPresetBrain',type:'command',text:'Brain',svgUrl:'/icons.svg#icon-wl-brain',active:false}];var tools=function tools(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{buttons:defaultButtons};var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'SET_TOOL_ACTIVE':var item=state.buttons.find(function(button){return button.command===action.tool;});var buttons=[];if(item.type==='tool'){buttons=state.buttons.map(function(button){if(button.command===action.tool){button.active=true;}else if(button.type==='tool'){button.active=false;}return button;});}return {buttons:buttons};case'SET_AVAILABLE_BUTTONS':return {buttons:action.buttons};default:return state;}};var lodash_clonedeep=createCommonjsModule$1(function(module,exports){/**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */ /** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE=200;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED='__lodash_hash_undefined__';/** Used as references for various `Number` constants. */var MAX_SAFE_INTEGER=9007199254740991;/** `Object#toString` result references. */var argsTag='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',genTag='[object GeneratorFunction]',mapTag='[object Map]',numberTag='[object Number]',objectTag='[object Object]',promiseTag='[object Promise]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',symbolTag='[object Symbol]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',dataViewTag='[object DataView]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';/**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;/** Used to match `RegExp` flags from their coerced string values. */var reFlags=/\w*$/;/** Used to detect host constructors (Safari). */var reIsHostCtor=/^\[object .+?Constructor\]$/;/** Used to detect unsigned integer values. */var reIsUint=/^(?:0|[1-9]\d*)$/;/** Used to identify `toStringTag` values supported by `_.clone`. */var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;/** Detect free variable `global` from Node.js. */var freeGlobal=typeof commonjsGlobal$1=='object'&&commonjsGlobal$1&&commonjsGlobal$1.Object===Object&&commonjsGlobal$1;/** Detect free variable `self`. */var freeSelf=typeof self=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root=freeGlobal||freeSelf||Function('return this')();/** Detect free variable `exports`. */var freeExports=exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&'object'=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/**
   * Adds the key-value `pair` to `map`.
   *
   * @private
   * @param {Object} map The map to modify.
   * @param {Array} pair The key-value pair to add.
   * @returns {Object} Returns `map`.
   */function addMapEntry(map,pair){// Don't return `map.set` because it's not chainable in IE 11.
  map.set(pair[0],pair[1]);return map;}/**
   * Adds `value` to `set`.
   *
   * @private
   * @param {Object} set The set to modify.
   * @param {*} value The value to add.
   * @returns {Object} Returns `set`.
   */function addSetEntry(set,value){// Don't return `set.add` because it's not chainable in IE 11.
  set.add(value);return set;}/**
   * A specialized version of `_.forEach` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */function arrayEach(array,iteratee){var index=-1,length=array?array.length:0;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}return array;}/**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}return array;}/**
   * A specialized version of `_.reduce` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the first element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;if(initAccum&&length){accumulator=array[++index];}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}return accumulator;}/**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}return result;}/**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */function getValue(object,key){return object==null?undefined:object[key];}/**
   * Checks if `value` is a host object in IE < 9.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
   */function isHostObject(value){// Many host objects are `Object` objects that can coerce to strings
  // despite having improperly defined `toString` methods.
  var result=false;if(value!=null&&typeof value.toString!='function'){try{result=!!(value+'');}catch(e){}}return result;}/**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value];});return result;}/**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */function overArg(func,transform){return function(arg){return func(transform(arg));};}/**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value;});return result;}/** Used for built-in method references. */var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;/** Used to detect overreaching core-js shims. */var coreJsData=root['__core-js_shared__'];/** Used to detect methods masquerading as native. */var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||'');return uid?'Symbol(src)_1.'+uid:'';}();/** Used to resolve the decompiled source of functions. */var funcToString=funcProto.toString;/** Used to check objects for own properties. */var hasOwnProperty=objectProto.hasOwnProperty;/**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */var objectToString=objectProto.toString;/** Used to detect if a method is native. */var reIsNative=RegExp('^'+funcToString.call(hasOwnProperty).replace(reRegExpChar,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');/** Built-in value references. */var Buffer=moduleExports?root.Buffer:undefined,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeKeys=overArg(Object.keys,Object);/* Built-in method references that are verified to be native. */var DataView=getNative(root,'DataView'),Map=getNative(root,'Map'),Promise=getNative(root,'Promise'),Set=getNative(root,'Set'),WeakMap=getNative(root,'WeakMap'),nativeCreate=getNative(Object,'create');/** Used to detect maps, sets, and weakmaps. */var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);/** Used to convert symbols to primitives and strings. */var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;/**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};}/**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function hashDelete(key){return this.has(key)&&delete this.__data__[key];}/**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result;}return hasOwnProperty.call(data,key)?data[key]:undefined;}/**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key);}/**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this;}// Add methods to `Hash`.
  Hash.prototype.clear=hashClear;Hash.prototype['delete']=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;/**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */function listCacheClear(){this.__data__=[];}/**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false;}var lastIndex=data.length-1;if(index==lastIndex){data.pop();}else{splice.call(data,index,1);}return true;}/**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1];}/**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1;}/**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value]);}else{data[index][1]=value;}return this;}// Add methods to `ListCache`.
  ListCache.prototype.clear=listCacheClear;ListCache.prototype['delete']=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;/**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */function mapCacheClear(){this.__data__={'hash':new Hash(),'map':new(Map||ListCache)(),'string':new Hash()};}/**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function mapCacheDelete(key){return getMapData(this,key)['delete'](key);}/**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function mapCacheGet(key){return getMapData(this,key).get(key);}/**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function mapCacheHas(key){return getMapData(this,key).has(key);}/**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this;}// Add methods to `MapCache`.
  MapCache.prototype.clear=mapCacheClear;MapCache.prototype['delete']=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;/**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Stack(entries){this.__data__=new ListCache(entries);}/**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */function stackClear(){this.__data__=new ListCache();}/**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function stackDelete(key){return this.__data__['delete'](key);}/**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function stackGet(key){return this.__data__.get(key);}/**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function stackHas(key){return this.__data__.has(key);}/**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);return this;}cache=this.__data__=new MapCache(pairs);}cache.set(key,value);return this;}// Add methods to `Stack`.
  Stack.prototype.clear=stackClear;Stack.prototype['delete']=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;/**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */function arrayLikeKeys(value,inherited){// Safari 8.1 makes `arguments.callee` enumerable in strict mode.
  // Safari 9 makes `arguments.length` enumerable in strict mode.
  var result=isArray(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=='length'||isIndex(key,length)))){result.push(key);}}return result;}/**
   * Assigns `value` to `key` of `object` if the existing value is not equivalent
   * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons.
   *
   * @private
   * @param {Object} object The object to modify.
   * @param {string} key The key of the property to assign.
   * @param {*} value The value to assign.
   */function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value;}}/**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length;}}return -1;}/**
   * The base implementation of `_.assign` without support for multiple sources
   * or `customizer` functions.
   *
   * @private
   * @param {Object} object The destination object.
   * @param {Object} source The source object.
   * @returns {Object} Returns `object`.
   */function baseAssign(object,source){return object&&copyObject(source,keys(source),object);}/**
   * The base implementation of `_.clone` and `_.cloneDeep` which tracks
   * traversed objects.
   *
   * @private
   * @param {*} value The value to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @param {boolean} [isFull] Specify a clone including symbols.
   * @param {Function} [customizer] The function to customize cloning.
   * @param {string} [key] The key of `value`.
   * @param {Object} [object] The parent object of `value`.
   * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
   * @returns {*} Returns the cloned value.
   */function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value);}if(result!==undefined){return result;}if(!isObject(value)){return value;}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result);}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep);}if(tag==objectTag||tag==argsTag||isFunc&&!object){if(isHostObject(value)){return object?value:{};}result=initCloneObject(isFunc?{}:value);if(!isDeep){return copySymbols(value,baseAssign(result,value));}}else{if(!cloneableTags[tag]){return object?value:{};}result=initCloneByTag(value,tag,baseClone,isDeep);}}// Check for circular references and return its corresponding clone.
  stack||(stack=new Stack());var stacked=stack.get(value);if(stacked){return stacked;}stack.set(value,result);if(!isArr){var props=isFull?getAllKeys(value):keys(value);}arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key];}// Recursively populate clone (susceptible to call stack limits).
  assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack));});return result;}/**
   * The base implementation of `_.create` without support for assigning
   * properties to the created object.
   *
   * @private
   * @param {Object} prototype The object to inherit from.
   * @returns {Object} Returns the new object.
   */function baseCreate(proto){return isObject(proto)?objectCreate(proto):{};}/**
   * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
   * `keysFunc` and `symbolsFunc` to get the enumerable property names and
   * symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Function} keysFunc The function to get the keys of `object`.
   * @param {Function} symbolsFunc The function to get the symbols of `object`.
   * @returns {Array} Returns the array of property names and symbols.
   */function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object));}/**
   * The base implementation of `getTag`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */function baseGetTag(value){return objectToString.call(value);}/**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false;}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value));}/**
   * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object);}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!='constructor'){result.push(key);}}return result;}/**
   * Creates a clone of  `buffer`.
   *
   * @private
   * @param {Buffer} buffer The buffer to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Buffer} Returns the cloned buffer.
   */function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice();}var result=new buffer.constructor(buffer.length);buffer.copy(result);return result;}/**
   * Creates a clone of `arrayBuffer`.
   *
   * @private
   * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
   * @returns {ArrayBuffer} Returns the cloned array buffer.
   */function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result;}/**
   * Creates a clone of `dataView`.
   *
   * @private
   * @param {Object} dataView The data view to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned data view.
   */function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength);}/**
   * Creates a clone of `map`.
   *
   * @private
   * @param {Object} map The map to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned map.
   */function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),true):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor());}/**
   * Creates a clone of `regexp`.
   *
   * @private
   * @param {Object} regexp The regexp to clone.
   * @returns {Object} Returns the cloned regexp.
   */function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result;}/**
   * Creates a clone of `set`.
   *
   * @private
   * @param {Object} set The set to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned set.
   */function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),true):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor());}/**
   * Creates a clone of the `symbol` object.
   *
   * @private
   * @param {Object} symbol The symbol object to clone.
   * @returns {Object} Returns the cloned symbol object.
   */function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{};}/**
   * Creates a clone of `typedArray`.
   *
   * @private
   * @param {Object} typedArray The typed array to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned typed array.
   */function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length);}/**
   * Copies the values of `source` to `array`.
   *
   * @private
   * @param {Array} source The array to copy values from.
   * @param {Array} [array=[]] The array to copy values to.
   * @returns {Array} Returns `array`.
   */function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}return array;}/**
   * Copies properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy properties from.
   * @param {Array} props The property identifiers to copy.
   * @param {Object} [object={}] The object to copy properties to.
   * @param {Function} [customizer] The function to customize copied values.
   * @returns {Object} Returns `object`.
   */function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue);}return object;}/**
   * Copies own symbol properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy symbols from.
   * @param {Object} [object={}] The object to copy symbols to.
   * @returns {Object} Returns `object`.
   */function copySymbols(source,object){return copyObject(source,getSymbols(source),object);}/**
   * Creates an array of own enumerable property names and symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names and symbols.
   */function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols);}/**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=='string'?'string':'hash']:data.map;}/**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined;}/**
   * Creates an array of the own enumerable symbol properties of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of symbols.
   */var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):stubArray;/**
   * Gets the `toStringTag` of `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */var getTag=baseGetTag;// Fallback for data views, maps, sets, and weak maps in IE 11,
  // for data views in Edge < 14, and promises in Node.js.
  if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map())!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set())!=setTag||WeakMap&&getTag(new WeakMap())!=weakMapTag){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):undefined;if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag;}}return result;};}/**
   * Initializes an array clone.
   *
   * @private
   * @param {Array} array The array to clone.
   * @returns {Array} Returns the initialized clone.
   */function initCloneArray(array){var length=array.length,result=array.constructor(length);// Add properties assigned by `RegExp#exec`.
  if(length&&typeof array[0]=='string'&&hasOwnProperty.call(array,'index')){result.index=array.index;result.input=array.input;}return result;}/**
   * Initializes an object clone.
   *
   * @private
   * @param {Object} object The object to clone.
   * @returns {Object} Returns the initialized clone.
   */function initCloneObject(object){return typeof object.constructor=='function'&&!isPrototype(object)?baseCreate(getPrototype(object)):{};}/**
   * Initializes an object clone based on its `toStringTag`.
   *
   * **Note:** This function only supports cloning values with tags of
   * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
   *
   * @private
   * @param {Object} object The object to clone.
   * @param {string} tag The `toStringTag` of the object to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the initialized clone.
   */function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object);}}/**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return !!length&&(typeof value=='number'||reIsUint.test(value))&&value>-1&&value%1==0&&value<length;}/**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */function isKeyable(value){var type=typeof value;return type=='string'||type=='number'||type=='symbol'||type=='boolean'?value!=='__proto__':value===null;}/**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */function isMasked(func){return !!maskSrcKey&&maskSrcKey in func;}/**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=='function'&&Ctor.prototype||objectProto;return value===proto;}/**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to process.
   * @returns {string} Returns the source code.
   */function toSource(func){if(func!=null){try{return funcToString.call(func);}catch(e){}try{return func+'';}catch(e){}}return '';}/**
   * This method is like `_.clone` except that it recursively clones `value`.
   *
   * @static
   * @memberOf _
   * @since 1.0.0
   * @category Lang
   * @param {*} value The value to recursively clone.
   * @returns {*} Returns the deep cloned value.
   * @see _.clone
   * @example
   *
   * var objects = [{ 'a': 1 }, { 'b': 2 }];
   *
   * var deep = _.cloneDeep(objects);
   * console.log(deep[0] === objects[0]);
   * // => false
   */function cloneDeep(value){return baseClone(value,true,true);}/**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */function eq(value,other){return value===other||value!==value&&other!==other;}/**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */function isArguments(value){// Safari 8.1 makes `arguments.callee` enumerable in strict mode.
  return isArrayLikeObject(value)&&hasOwnProperty.call(value,'callee')&&(!propertyIsEnumerable.call(value,'callee')||objectToString.call(value)==argsTag);}/**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */var isArray=Array.isArray;/**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value);}/**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value);}/**
   * Checks if `value` is a buffer.
   *
   * @static
   * @memberOf _
   * @since 4.3.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
   * @example
   *
   * _.isBuffer(new Buffer(2));
   * // => true
   *
   * _.isBuffer(new Uint8Array(2));
   * // => false
   */var isBuffer=nativeIsBuffer||stubFalse;/**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */function isFunction(value){// The use of `Object#toString` avoids issues with the `typeof` operator
  // in Safari 8-9 which returns 'object' for typed array and other constructors.
  var tag=isObject(value)?objectToString.call(value):'';return tag==funcTag||tag==genTag;}/**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}/**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */function isObject(value){var type=typeof value;return !!value&&(type=='object'||type=='function');}/**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */function isObjectLike(value){return !!value&&typeof value=='object';}/**
   * Creates an array of the own enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects. See the
   * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * for more details.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keys(new Foo);
   * // => ['a', 'b'] (iteration order is not guaranteed)
   *
   * _.keys('hi');
   * // => ['0', '1']
   */function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object);}/**
   * This method returns a new empty array.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {Array} Returns the new empty array.
   * @example
   *
   * var arrays = _.times(2, _.stubArray);
   *
   * console.log(arrays);
   * // => [[], []]
   *
   * console.log(arrays[0] === arrays[1]);
   * // => false
   */function stubArray(){return [];}/**
   * This method returns `false`.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {boolean} Returns `false`.
   * @example
   *
   * _.times(2, _.stubFalse);
   * // => [false, false]
   */function stubFalse(){return false;}module.exports=cloneDeep;});var lodash_merge=createCommonjsModule$1(function(module,exports){/**
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright JS Foundation and other contributors <https://js.foundation/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */ /** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE=200;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED='__lodash_hash_undefined__';/** Used to detect hot functions by number of calls within a span of milliseconds. */var HOT_COUNT=800,HOT_SPAN=16;/** Used as references for various `Number` constants. */var MAX_SAFE_INTEGER=9007199254740991;/** `Object#toString` result references. */var argsTag='[object Arguments]',arrayTag='[object Array]',asyncTag='[object AsyncFunction]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',genTag='[object GeneratorFunction]',mapTag='[object Map]',numberTag='[object Number]',nullTag='[object Null]',objectTag='[object Object]',proxyTag='[object Proxy]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',undefinedTag='[object Undefined]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',dataViewTag='[object DataView]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';/**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;/** Used to detect host constructors (Safari). */var reIsHostCtor=/^\[object .+?Constructor\]$/;/** Used to detect unsigned integer values. */var reIsUint=/^(?:0|[1-9]\d*)$/;/** Used to identify `toStringTag` values of typed arrays. */var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;/** Detect free variable `global` from Node.js. */var freeGlobal=typeof commonjsGlobal$1=='object'&&commonjsGlobal$1&&commonjsGlobal$1.Object===Object&&commonjsGlobal$1;/** Detect free variable `self`. */var freeSelf=typeof self=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root=freeGlobal||freeSelf||Function('return this')();/** Detect free variable `exports`. */var freeExports=exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&'object'=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/** Detect free variable `process` from Node.js. */var freeProcess=moduleExports&&freeGlobal.process;/** Used to access faster Node.js helpers. */var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding('util');}catch(e){}}();/* Node.js helper references. */var nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;/**
   * A faster alternative to `Function#apply`, this function invokes `func`
   * with the `this` binding of `thisArg` and the arguments of `args`.
   *
   * @private
   * @param {Function} func The function to invoke.
   * @param {*} thisArg The `this` binding of `func`.
   * @param {Array} args The arguments to invoke `func` with.
   * @returns {*} Returns the result of `func`.
   */function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2]);}return func.apply(thisArg,args);}/**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}return result;}/**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */function baseUnary(func){return function(value){return func(value);};}/**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */function getValue(object,key){return object==null?undefined:object[key];}/**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */function overArg(func,transform){return function(arg){return func(transform(arg));};}/**
   * Gets the value at `key`, unless `key` is "__proto__".
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */function safeGet(object,key){return key=='__proto__'?undefined:object[key];}/** Used for built-in method references. */var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;/** Used to detect overreaching core-js shims. */var coreJsData=root['__core-js_shared__'];/** Used to resolve the decompiled source of functions. */var funcToString=funcProto.toString;/** Used to check objects for own properties. */var hasOwnProperty=objectProto.hasOwnProperty;/** Used to detect methods masquerading as native. */var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||'');return uid?'Symbol(src)_1.'+uid:'';}();/**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */var nativeObjectToString=objectProto.toString;/** Used to infer the `Object` constructor. */var objectCtorString=funcToString.call(Object);/** Used to detect if a method is native. */var reIsNative=RegExp('^'+funcToString.call(hasOwnProperty).replace(reRegExpChar,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');/** Built-in value references. */var Buffer=moduleExports?root.Buffer:undefined,Symbol=root.Symbol,Uint8Array=root.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,symToStringTag=Symbol?Symbol.toStringTag:undefined;var defineProperty=function(){try{var func=getNative(Object,'defineProperty');func({},'',{});return func;}catch(e){}}();/* Built-in method references for those with the same name as other `lodash` methods. */var nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeMax=Math.max,nativeNow=Date.now;/* Built-in method references that are verified to be native. */var Map=getNative(root,'Map'),nativeCreate=getNative(Object,'create');/**
   * The base implementation of `_.create` without support for assigning
   * properties to the created object.
   *
   * @private
   * @param {Object} proto The object to inherit from.
   * @returns {Object} Returns the new object.
   */var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return {};}if(objectCreate){return objectCreate(proto);}object.prototype=proto;var result=new object();object.prototype=undefined;return result;};}();/**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0;}/**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result;}/**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result;}return hasOwnProperty.call(data,key)?data[key]:undefined;}/**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key);}/**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this;}// Add methods to `Hash`.
  Hash.prototype.clear=hashClear;Hash.prototype['delete']=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;/**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */function listCacheClear(){this.__data__=[];this.size=0;}/**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false;}var lastIndex=data.length-1;if(index==lastIndex){data.pop();}else{splice.call(data,index,1);}--this.size;return true;}/**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1];}/**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1;}/**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value]);}else{data[index][1]=value;}return this;}// Add methods to `ListCache`.
  ListCache.prototype.clear=listCacheClear;ListCache.prototype['delete']=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;/**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */function mapCacheClear(){this.size=0;this.__data__={'hash':new Hash(),'map':new(Map||ListCache)(),'string':new Hash()};}/**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function mapCacheDelete(key){var result=getMapData(this,key)['delete'](key);this.size-=result?1:0;return result;}/**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function mapCacheGet(key){return getMapData(this,key).get(key);}/**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function mapCacheHas(key){return getMapData(this,key).has(key);}/**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this;}// Add methods to `MapCache`.
  MapCache.prototype.clear=mapCacheClear;MapCache.prototype['delete']=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;/**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size;}/**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */function stackClear(){this.__data__=new ListCache();this.size=0;}/**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function stackDelete(key){var data=this.__data__,result=data['delete'](key);this.size=data.size;return result;}/**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function stackGet(key){return this.__data__.get(key);}/**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function stackHas(key){return this.__data__.has(key);}/**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this;}data=this.__data__=new MapCache(pairs);}data.set(key,value);this.size=data.size;return this;}// Add methods to `Stack`.
  Stack.prototype.clear=stackClear;Stack.prototype['delete']=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;/**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(// Safari 9 has enumerable `arguments.length` in strict mode.
  key=='length'||// Node.js 0.10 has enumerable non-index properties on buffers.
  isBuff&&(key=='offset'||key=='parent')||// PhantomJS 2 has enumerable non-index properties on typed arrays.
  isType&&(key=='buffer'||key=='byteLength'||key=='byteOffset')||// Skip index properties.
  isIndex(key,length)))){result.push(key);}}return result;}/**
   * This function is like `assignValue` except that it doesn't assign
   * `undefined` values.
   *
   * @private
   * @param {Object} object The object to modify.
   * @param {string} key The key of the property to assign.
   * @param {*} value The value to assign.
   */function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value);}}/**
   * Assigns `value` to `key` of `object` if the existing value is not equivalent
   * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons.
   *
   * @private
   * @param {Object} object The object to modify.
   * @param {string} key The key of the property to assign.
   * @param {*} value The value to assign.
   */function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value);}}/**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length;}}return -1;}/**
   * The base implementation of `assignValue` and `assignMergeValue` without
   * value checks.
   *
   * @private
   * @param {Object} object The object to modify.
   * @param {string} key The key of the property to assign.
   * @param {*} value The value to assign.
   */function baseAssignValue(object,key,value){if(key=='__proto__'&&defineProperty){defineProperty(object,key,{'configurable':true,'enumerable':true,'value':value,'writable':true});}else{object[key]=value;}}/**
   * The base implementation of `baseForOwn` which iterates over `object`
   * properties returned by `keysFunc` and invokes `iteratee` for each property.
   * Iteratee functions may exit iteration early by explicitly returning `false`.
   *
   * @private
   * @param {Object} object The object to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {Function} keysFunc The function to get the keys of `object`.
   * @returns {Object} Returns `object`.
   */var baseFor=createBaseFor();/**
   * The base implementation of `getTag` without fallbacks for buggy environments.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag;}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value);}/**
   * The base implementation of `_.isArguments`.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   */function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag;}/**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false;}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value));}/**
   * The base implementation of `_.isTypedArray` without Node.js optimizations.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   */function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)];}/**
   * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object);}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=='constructor'&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key);}}return result;}/**
   * The base implementation of `_.merge` without support for multiple sources.
   *
   * @private
   * @param {Object} object The destination object.
   * @param {Object} source The source object.
   * @param {number} srcIndex The index of `source`.
   * @param {Function} [customizer] The function to customize merged values.
   * @param {Object} [stack] Tracks traversed source values and their merged
   *  counterparts.
   */function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return;}baseFor(source,function(srcValue,key){if(isObject(srcValue)){stack||(stack=new Stack());baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);}else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+'',object,source,stack):undefined;if(newValue===undefined){newValue=srcValue;}assignMergeValue(object,key,newValue);}},keysIn);}/**
   * A specialized version of `baseMerge` for arrays and objects which performs
   * deep merges and tracks traversed objects enabling objects with circular
   * references to be merged.
   *
   * @private
   * @param {Object} object The destination object.
   * @param {Object} source The source object.
   * @param {string} key The key of the value to merge.
   * @param {number} srcIndex The index of `source`.
   * @param {Function} mergeFunc The function to merge values.
   * @param {Function} [customizer] The function to customize assigned values.
   * @param {Object} [stack] Tracks traversed source values and their merged
   *  counterparts.
   */function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return;}var newValue=customizer?customizer(objValue,srcValue,key+'',object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue;}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue);}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true);}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true);}else{newValue=[];}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue);}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){newValue=initCloneObject(srcValue);}}else{isCommon=false;}}if(isCommon){// Recursively merge objects and arrays (susceptible to call stack limits).
  stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack['delete'](srcValue);}assignMergeValue(object,key,newValue);}/**
   * The base implementation of `_.rest` which doesn't validate or coerce arguments.
   *
   * @private
   * @param {Function} func The function to apply a rest parameter to.
   * @param {number} [start=func.length-1] The start position of the rest parameter.
   * @returns {Function} Returns the new function.
   */function baseRest(func,start){return setToString(overRest(func,start,identity),func+'');}/**
   * The base implementation of `setToString` without support for hot loop shorting.
   *
   * @private
   * @param {Function} func The function to modify.
   * @param {Function} string The `toString` result.
   * @returns {Function} Returns `func`.
   */var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,'toString',{'configurable':true,'enumerable':false,'value':constant(string),'writable':true});};/**
   * Creates a clone of  `buffer`.
   *
   * @private
   * @param {Buffer} buffer The buffer to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Buffer} Returns the cloned buffer.
   */function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice();}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result;}/**
   * Creates a clone of `arrayBuffer`.
   *
   * @private
   * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
   * @returns {ArrayBuffer} Returns the cloned array buffer.
   */function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result;}/**
   * Creates a clone of `typedArray`.
   *
   * @private
   * @param {Object} typedArray The typed array to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned typed array.
   */function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length);}/**
   * Copies the values of `source` to `array`.
   *
   * @private
   * @param {Array} source The array to copy values from.
   * @param {Array} [array=[]] The array to copy values to.
   * @returns {Array} Returns `array`.
   */function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}return array;}/**
   * Copies properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy properties from.
   * @param {Array} props The property identifiers to copy.
   * @param {Object} [object={}] The object to copy properties to.
   * @param {Function} [customizer] The function to customize copied values.
   * @returns {Object} Returns `object`.
   */function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key];}if(isNew){baseAssignValue(object,key,newValue);}else{assignValue(object,key,newValue);}}return object;}/**
   * Creates a function like `_.assign`.
   *
   * @private
   * @param {Function} assigner The function to assign values.
   * @returns {Function} Returns the new assigner function.
   */function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=='function'?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1;}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer);}}return object;});}/**
   * Creates a base function for methods like `_.forIn` and `_.forOwn`.
   *
   * @private
   * @param {boolean} [fromRight] Specify iterating from right to left.
   * @returns {Function} Returns the new base function.
   */function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break;}}return object;};}/**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=='string'?'string':'hash']:data.map;}/**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined;}/**
   * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the raw `toStringTag`.
   */function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;}catch(e){}var result=nativeObjectToString.call(value);{if(isOwn){value[symToStringTag]=tag;}else{delete value[symToStringTag];}}return result;}/**
   * Initializes an object clone.
   *
   * @private
   * @param {Object} object The object to clone.
   * @returns {Object} Returns the initialized clone.
   */function initCloneObject(object){return typeof object.constructor=='function'&&!isPrototype(object)?baseCreate(getPrototype(object)):{};}/**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */function isIndex(value,length){var type=typeof value;length=length==null?MAX_SAFE_INTEGER:length;return !!length&&(type=='number'||type!='symbol'&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length;}/**
   * Checks if the given arguments are from an iteratee call.
   *
   * @private
   * @param {*} value The potential iteratee value argument.
   * @param {*} index The potential iteratee index or key argument.
   * @param {*} object The potential iteratee object argument.
   * @returns {boolean} Returns `true` if the arguments are from an iteratee call,
   *  else `false`.
   */function isIterateeCall(value,index,object){if(!isObject(object)){return false;}var type=typeof index;if(type=='number'?isArrayLike(object)&&isIndex(index,object.length):type=='string'&&index in object){return eq(object[index],value);}return false;}/**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */function isKeyable(value){var type=typeof value;return type=='string'||type=='number'||type=='symbol'||type=='boolean'?value!=='__proto__':value===null;}/**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */function isMasked(func){return !!maskSrcKey&&maskSrcKey in func;}/**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=='function'&&Ctor.prototype||objectProto;return value===proto;}/**
   * This function is like
   * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * except that it includes inherited enumerable properties.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key);}}return result;}/**
   * Converts `value` to a string using `Object.prototype.toString`.
   *
   * @private
   * @param {*} value The value to convert.
   * @returns {string} Returns the converted string.
   */function objectToString(value){return nativeObjectToString.call(value);}/**
   * A specialized version of `baseRest` which transforms the rest array.
   *
   * @private
   * @param {Function} func The function to apply a rest parameter to.
   * @param {number} [start=func.length-1] The start position of the rest parameter.
   * @param {Function} transform The rest array transform.
   * @returns {Function} Returns the new function.
   */function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index];}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index];}otherArgs[start]=transform(array);return apply(func,this,otherArgs);};}/**
   * Sets the `toString` method of `func` to return `string`.
   *
   * @private
   * @param {Function} func The function to modify.
   * @param {Function} string The `toString` result.
   * @returns {Function} Returns `func`.
   */var setToString=shortOut(baseSetToString);/**
   * Creates a function that'll short out and invoke `identity` instead
   * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`
   * milliseconds.
   *
   * @private
   * @param {Function} func The function to restrict.
   * @returns {Function} Returns the new shortable function.
   */function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0];}}else{count=0;}return func.apply(undefined,arguments);};}/**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to convert.
   * @returns {string} Returns the source code.
   */function toSource(func){if(func!=null){try{return funcToString.call(func);}catch(e){}try{return func+'';}catch(e){}}return '';}/**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */function eq(value,other){return value===other||value!==value&&other!==other;}/**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */var isArguments=baseIsArguments(function(){return arguments;}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee');};/**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */var isArray=Array.isArray;/**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value);}/**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value);}/**
   * Checks if `value` is a buffer.
   *
   * @static
   * @memberOf _
   * @since 4.3.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
   * @example
   *
   * _.isBuffer(new Buffer(2));
   * // => true
   *
   * _.isBuffer(new Uint8Array(2));
   * // => false
   */var isBuffer=nativeIsBuffer||stubFalse;/**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */function isFunction(value){if(!isObject(value)){return false;}// The use of `Object#toString` avoids issues with the `typeof` operator
  // in Safari 9 which returns 'object' for typed arrays and other constructors.
  var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag;}/**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}/**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */function isObject(value){var type=typeof value;return value!=null&&(type=='object'||type=='function');}/**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */function isObjectLike(value){return value!=null&&typeof value=='object';}/**
   * Checks if `value` is a plain object, that is, an object created by the
   * `Object` constructor or one with a `[[Prototype]]` of `null`.
   *
   * @static
   * @memberOf _
   * @since 0.8.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   * }
   *
   * _.isPlainObject(new Foo);
   * // => false
   *
   * _.isPlainObject([1, 2, 3]);
   * // => false
   *
   * _.isPlainObject({ 'x': 0, 'y': 0 });
   * // => true
   *
   * _.isPlainObject(Object.create(null));
   * // => true
   */function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false;}var proto=getPrototype(value);if(proto===null){return true;}var Ctor=hasOwnProperty.call(proto,'constructor')&&proto.constructor;return typeof Ctor=='function'&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString;}/**
   * Checks if `value` is classified as a typed array.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   * @example
   *
   * _.isTypedArray(new Uint8Array);
   * // => true
   *
   * _.isTypedArray([]);
   * // => false
   */var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;/**
   * Converts `value` to a plain object flattening inherited enumerable string
   * keyed properties of `value` to own properties of the plain object.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Lang
   * @param {*} value The value to convert.
   * @returns {Object} Returns the converted plain object.
   * @example
   *
   * function Foo() {
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.assign({ 'a': 1 }, new Foo);
   * // => { 'a': 1, 'b': 2 }
   *
   * _.assign({ 'a': 1 }, _.toPlainObject(new Foo));
   * // => { 'a': 1, 'b': 2, 'c': 3 }
   */function toPlainObject(value){return copyObject(value,keysIn(value));}/**
   * Creates an array of the own and inherited enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keysIn(new Foo);
   * // => ['a', 'b', 'c'] (iteration order is not guaranteed)
   */function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object);}/**
   * This method is like `_.assign` except that it recursively merges own and
   * inherited enumerable string keyed properties of source objects into the
   * destination object. Source properties that resolve to `undefined` are
   * skipped if a destination value exists. Array and plain object properties
   * are merged recursively. Other objects and value types are overridden by
   * assignment. Source objects are applied from left to right. Subsequent
   * sources overwrite property assignments of previous sources.
   *
   * **Note:** This method mutates `object`.
   *
   * @static
   * @memberOf _
   * @since 0.5.0
   * @category Object
   * @param {Object} object The destination object.
   * @param {...Object} [sources] The source objects.
   * @returns {Object} Returns `object`.
   * @example
   *
   * var object = {
   *   'a': [{ 'b': 2 }, { 'd': 4 }]
   * };
   *
   * var other = {
   *   'a': [{ 'c': 3 }, { 'e': 5 }]
   * };
   *
   * _.merge(object, other);
   * // => { 'a': [{ 'b': 2, 'c': 3 }, { 'd': 4, 'e': 5 }] }
   */var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex);});/**
   * Creates a function that returns `value`.
   *
   * @static
   * @memberOf _
   * @since 2.4.0
   * @category Util
   * @param {*} value The value to return from the new function.
   * @returns {Function} Returns the new constant function.
   * @example
   *
   * var objects = _.times(2, _.constant({ 'a': 1 }));
   *
   * console.log(objects);
   * // => [{ 'a': 1 }, { 'a': 1 }]
   *
   * console.log(objects[0] === objects[1]);
   * // => true
   */function constant(value){return function(){return value;};}/**
   * This method returns the first argument it receives.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Util
   * @param {*} value Any value.
   * @returns {*} Returns `value`.
   * @example
   *
   * var object = { 'a': 1 };
   *
   * console.log(_.identity(object) === object);
   * // => true
   */function identity(value){return value;}/**
   * This method returns `false`.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {boolean} Returns `false`.
   * @example
   *
   * _.times(2, _.stubFalse);
   * // => [false, false]
   */function stubFalse(){return false;}module.exports=merge;});var defaultState={activeViewportIndex:0,layout:{viewports:[{height:'100%',width:'100%'}]},viewportSpecificData:{}};var viewports=function viewports(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:defaultState;var action=arguments.length>1?arguments[1]:undefined;var viewportSpecificData;switch(action.type){case'SET_VIEWPORT_ACTIVE':return Object.assign({},state,{activeViewportIndex:action.viewportIndex});case'SET_LAYOUT':return Object.assign({},state,{layout:action.layout});case'SET_VIEWPORT_SPECIFIC_DATA':var currentData=lodash_clonedeep(state.viewportSpecificData[action.viewportIndex])||{};viewportSpecificData=lodash_clonedeep(state.viewportSpecificData);viewportSpecificData[action.viewportIndex]=lodash_merge({},currentData,action.data);return Object.assign({},state,{viewportSpecificData:viewportSpecificData});case'CLEAR_VIEWPORT_SPECIFIC_DATA':viewportSpecificData=lodash_clonedeep(state.viewportSpecificData);viewportSpecificData[action.viewportIndex]={};return Object.assign({},state,{viewportSpecificData:viewportSpecificData});default:return state;}};var defaultState$1={servers:[]};var servers=function servers(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:defaultState$1;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'ADD_SERVER':var _servers=state.servers;var alreadyExists=_servers.find(function(server){return server.id===action.server.id;});if(alreadyExists){return state;}_servers.push(action.server);if(_servers.length===1){_servers[0].active=true;}return Object.assign({},state,{servers:_servers});default:return state;}};var defaultState$2={progress:{},lastUpdated:null};var loading=function loading(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:defaultState$2;var action=arguments.length>1?arguments[1]:undefined;var progress;var lastUpdated;switch(action.type){case'SET_STUDY_LOADING_PROGRESS':progress=lodash_clonedeep(state).progress;progress[action.progressId]=action.progressData;// This is a workaround so we can easily identify changes
  // to the progress object without doing deep comparison.
  lastUpdated=new Date().getTime();return Object.assign({},state,{progress:progress,lastUpdated:lastUpdated});case'CLEAR_STUDY_LOADING_PROGRESS':progress=lodash_clonedeep(state).progress;delete progress[action.progressId];lastUpdated=new Date().getTime();return Object.assign({},state,{progress:progress,lastUpdated:lastUpdated});default:return state;}};var PLUGIN_TYPES={VIEWPORT:'viewport'};var plugins={PLUGIN_TYPES:PLUGIN_TYPES,availablePlugins:[]};var defaultState$3={availablePlugins:[]};var plugins$1=function plugins$$1(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:defaultState$3;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'ADD_PLUGIN':var availablePlugins=state.availablePlugins;var alreadyExists=availablePlugins.find(function(plugin){return plugin.id===action.plugin.id;});if(alreadyExists){return state;}availablePlugins.push({id:action.plugin.id,type:action.plugin.type});// Not sure where else to put this. We shouldn't store functions in Redux, so I'll do this instead
  plugins.availablePlugins.push(action.plugin);return Object.assign({},state,{availablePlugins:availablePlugins});default:return state;}};var reducers={tools:tools,viewports:viewports,servers:servers,loading:loading,plugins:plugins$1};var redux={reducers:reducers,actions:actions};// TODO: This is duplicated in TypeSafeCollection
  function isObject(subject){return subject instanceof Object||_typeof$4(subject)==='object'&&subject!==null;}// TODO: This is duplicated in TypeSafeCollection
  function isString(subject){return typeof subject==='string';}// Search for some string inside any object or array
  function search(object,query){var property=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var result=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];// Create the search pattern
  var pattern=new RegExp(query.trim(),'i');Object.keys(object).forEach(function(key){var item=object[key];// Stop here if item is empty
  if(!item){return;}// Get the value to be compared
  var value=isString(property)?item[property]:item;// Check if the value match the pattern
  if(isString(value)&&pattern.test(value)){// Add the current item to the result
  result.push(item);}if(isObject(item)){// Search recursively the item if the current item is an object
  search(item,query,property,result);}});// Return the found items
  return result;}// Encode any string into a safe format for HTML id attribute
  function encodeId(input){var string=input&&input.toString?input.toString():input;// Return an underscore if the given string is empty or if it's not a string
  if(string===''||typeof string!=='string'){return '_';}// Create a converter to replace non accepted chars
  var converter=function converter(match){return '_'+match[0].charCodeAt(0).toString(16)+'_';};// Encode the given string and return it
  return string.replace(/[^a-zA-Z0-9-]/g,converter);}var string={search:search,encodeId:encodeId};// Transforms a shallow object with keys separated by "." into a nested object
  function getNestedObject(shallowObject){var nestedObject={};for(var key in shallowObject){if(!shallowObject.hasOwnProperty(key))continue;var value=shallowObject[key];var propertyArray=key.split('.');var currentObject=nestedObject;while(propertyArray.length){var currentProperty=propertyArray.shift();if(!propertyArray.length){currentObject[currentProperty]=value;}else{if(!currentObject[currentProperty]){currentObject[currentProperty]={};}currentObject=currentObject[currentProperty];}}}return nestedObject;}function getShallowObject(nestedObject){var shallowObject={};var putValues=function putValues(baseKey,nestedObject,resultObject){for(var key in nestedObject){if(!nestedObject.hasOwnProperty(key))continue;var currentKey=baseKey?"".concat(baseKey,".").concat(key):key;var currentValue=nestedObject[key];if(_typeof$4(currentValue)==='object'){if(currentValue instanceof Array){currentKey+='[]';}putValues(currentKey,currentValue,resultObject);}else{resultObject[currentKey]=currentValue;}}};putValues('',nestedObject,shallowObject);return shallowObject;}var object={getNestedObject:getNestedObject,getShallowObject:getShallowObject};var validate=createCommonjsModule$1(function(module,exports){/*!
   * validate.js 0.12.0
   *
   * (c) 2013-2017 Nicklas Ansman, 2013 Wrapp
   * Validate.js may be freely distributed under the MIT license.
   * For all details and documentation:
   * http://validatejs.org/
   */(function(exports,module,define){// The main function that calls the validators specified by the constraints.
  // The options are the following:
  //   - format (string) - An option that controls how the returned value is formatted
  //     * flat - Returns a flat array of just the error messages
  //     * grouped - Returns the messages grouped by attribute (default)
  //     * detailed - Returns an array of the raw validation data
  //   - fullMessages (boolean) - If `true` (default) the attribute name is prepended to the error.
  //
  // Please note that the options are also passed to each validator.
  var validate=function(attributes,constraints,options){options=v.extend({},v.options,options);var results=v.runValidations(attributes,constraints,options);if(results.some(function(r){return v.isPromise(r.error);})){throw new Error("Use validate.async if you want support for promises");}return validate.processValidationResults(results,options);};var v=validate;// Copies over attributes from one or more sources to a single destination.
  // Very much similar to underscore's extend.
  // The first argument is the target object and the remaining arguments will be
  // used as sources.
  v.extend=function(obj){[].slice.call(arguments,1).forEach(function(source){for(var attr in source){obj[attr]=source[attr];}});return obj;};v.extend(validate,{// This is the version of the library as a semver.
  // The toString function will allow it to be coerced into a string
  version:{major:0,minor:12,patch:0,metadata:null,toString:function(){var version=v.format("%{major}.%{minor}.%{patch}",v.version);if(!v.isEmpty(v.version.metadata)){version+="+"+v.version.metadata;}return version;}},// Below is the dependencies that are used in validate.js
  // The constructor of the Promise implementation.
  // If you are using Q.js, RSVP or any other A+ compatible implementation
  // override this attribute to be the constructor of that promise.
  // Since jQuery promises aren't A+ compatible they won't work.
  Promise:typeof Promise!=="undefined"?Promise:/* istanbul ignore next */null,EMPTY_STRING_REGEXP:/^\s*$/,// Runs the validators specified by the constraints object.
  // Will return an array of the format:
  //     [{attribute: "<attribute name>", error: "<validation result>"}, ...]
  runValidations:function(attributes,constraints,options){var results=[],attr,validatorName,value,validators,validator,validatorOptions,error;if(v.isDomElement(attributes)||v.isJqueryElement(attributes)){attributes=v.collectFormValues(attributes);}// Loops through each constraints, finds the correct validator and run it.
  for(attr in constraints){value=v.getDeepObjectValue(attributes,attr);// This allows the constraints for an attribute to be a function.
  // The function will be called with the value, attribute name, the complete dict of
  // attributes as well as the options and constraints passed in.
  // This is useful when you want to have different
  // validations depending on the attribute value.
  validators=v.result(constraints[attr],value,attributes,attr,options,constraints);for(validatorName in validators){validator=v.validators[validatorName];if(!validator){error=v.format("Unknown validator %{name}",{name:validatorName});throw new Error(error);}validatorOptions=validators[validatorName];// This allows the options to be a function. The function will be
  // called with the value, attribute name, the complete dict of
  // attributes as well as the options and constraints passed in.
  // This is useful when you want to have different
  // validations depending on the attribute value.
  validatorOptions=v.result(validatorOptions,value,attributes,attr,options,constraints);if(!validatorOptions){continue;}results.push({attribute:attr,value:value,validator:validatorName,globalOptions:options,attributes:attributes,options:validatorOptions,error:validator.call(validator,value,validatorOptions,attr,attributes,options)});}}return results;},// Takes the output from runValidations and converts it to the correct
  // output format.
  processValidationResults:function(errors,options){errors=v.pruneEmptyErrors(errors,options);errors=v.expandMultipleErrors(errors,options);errors=v.convertErrorMessages(errors,options);var format=options.format||"grouped";if(typeof v.formatters[format]==='function'){errors=v.formatters[format](errors);}else{throw new Error(v.format("Unknown format %{format}",options));}return v.isEmpty(errors)?undefined:errors;},// Runs the validations with support for promises.
  // This function will return a promise that is settled when all the
  // validation promises have been completed.
  // It can be called even if no validations returned a promise.
  async:function(attributes,constraints,options){options=v.extend({},v.async.options,options);var WrapErrors=options.wrapErrors||function(errors){return errors;};// Removes unknown attributes
  if(options.cleanAttributes!==false){attributes=v.cleanAttributes(attributes,constraints);}var results=v.runValidations(attributes,constraints,options);return new v.Promise(function(resolve,reject){v.waitForResults(results).then(function(){var errors=v.processValidationResults(results,options);if(errors){reject(new WrapErrors(errors,options,attributes,constraints));}else{resolve(attributes);}},function(err){reject(err);});});},single:function(value,constraints,options){options=v.extend({},v.single.options,options,{format:"flat",fullMessages:false});return v({single:value},{single:constraints},options);},// Returns a promise that is resolved when all promises in the results array
  // are settled. The promise returned from this function is always resolved,
  // never rejected.
  // This function modifies the input argument, it replaces the promises
  // with the value returned from the promise.
  waitForResults:function(results){// Create a sequence of all the results starting with a resolved promise.
  return results.reduce(function(memo,result){// If this result isn't a promise skip it in the sequence.
  if(!v.isPromise(result.error)){return memo;}return memo.then(function(){return result.error.then(function(error){result.error=error||null;});});},new v.Promise(function(r){r();}));// A resolved promise
  },// If the given argument is a call: function the and: function return the value
  // otherwise just return the value. Additional arguments will be passed as
  // arguments to the function.
  // Example:
  // ```
  // result('foo') // 'foo'
  // result(Math.max, 1, 2) // 2
  // ```
  result:function(value){var args=[].slice.call(arguments,1);if(typeof value==='function'){value=value.apply(null,args);}return value;},// Checks if the value is a number. This function does not consider NaN a
  // number like many other `isNumber` functions do.
  isNumber:function(value){return typeof value==='number'&&!isNaN(value);},// Returns false if the object is not a function
  isFunction:function(value){return typeof value==='function';},// A simple check to verify that the value is an integer. Uses `isNumber`
  // and a simple modulo check.
  isInteger:function(value){return v.isNumber(value)&&value%1===0;},// Checks if the value is a boolean
  isBoolean:function(value){return typeof value==='boolean';},// Uses the `Object` function to check if the given argument is an object.
  isObject:function(obj){return obj===Object(obj);},// Simply checks if the object is an instance of a date
  isDate:function(obj){return obj instanceof Date;},// Returns false if the object is `null` of `undefined`
  isDefined:function(obj){return obj!==null&&obj!==undefined;},// Checks if the given argument is a promise. Anything with a `then`
  // function is considered a promise.
  isPromise:function(p){return !!p&&v.isFunction(p.then);},isJqueryElement:function(o){return o&&v.isString(o.jquery);},isDomElement:function(o){if(!o){return false;}if(!o.querySelectorAll||!o.querySelector){return false;}if(v.isObject(document)&&o===document){return true;}// http://stackoverflow.com/a/384380/699304
  /* istanbul ignore else */if(typeof HTMLElement==="object"){return o instanceof HTMLElement;}else{return o&&typeof o==="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName==="string";}},isEmpty:function(value){var attr;// Null and undefined are empty
  if(!v.isDefined(value)){return true;}// functions are non empty
  if(v.isFunction(value)){return false;}// Whitespace only strings are empty
  if(v.isString(value)){return v.EMPTY_STRING_REGEXP.test(value);}// For arrays we use the length property
  if(v.isArray(value)){return value.length===0;}// Dates have no attributes but aren't empty
  if(v.isDate(value)){return false;}// If we find at least one property we consider it non empty
  if(v.isObject(value)){for(attr in value){return false;}return true;}return false;},// Formats the specified strings with the given values like so:
  // ```
  // format("Foo: %{foo}", {foo: "bar"}) // "Foo bar"
  // ```
  // If you want to write %{...} without having it replaced simply
  // prefix it with % like this `Foo: %%{foo}` and it will be returned
  // as `"Foo: %{foo}"`
  format:v.extend(function(str,vals){if(!v.isString(str)){return str;}return str.replace(v.format.FORMAT_REGEXP,function(m0,m1,m2){if(m1==='%'){return "%{"+m2+"}";}else{return String(vals[m2]);}});},{// Finds %{key} style patterns in the given string
  FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),// "Prettifies" the given string.
  // Prettifying means replacing [.\_-] with spaces as well as splitting
  // camel case words.
  prettify:function(str){if(v.isNumber(str)){// If there are more than 2 decimals round it to two
  if(str*100%1===0){return ""+str;}else{return parseFloat(Math.round(str*100)/100).toFixed(2);}}if(v.isArray(str)){return str.map(function(s){return v.prettify(s);}).join(", ");}if(v.isObject(str)){return str.toString();}// Ensure the string is actually a string
  str=""+str;return str// Splits keys separated by periods
  .replace(/([^\s])\.([^\s])/g,'$1 $2')// Removes backslashes
  .replace(/\\+/g,'')// Replaces - and - with space
  .replace(/[_-]/g,' ')// Splits camel cased words
  .replace(/([a-z])([A-Z])/g,function(m0,m1,m2){return ""+m1+" "+m2.toLowerCase();}).toLowerCase();},stringifyValue:function(value,options){var prettify=options&&options.prettify||v.prettify;return prettify(value);},isString:function(value){return typeof value==='string';},isArray:function(value){return {}.toString.call(value)==='[object Array]';},// Checks if the object is a hash, which is equivalent to an object that
  // is neither an array nor a function.
  isHash:function(value){return v.isObject(value)&&!v.isArray(value)&&!v.isFunction(value);},contains:function(obj,value){if(!v.isDefined(obj)){return false;}if(v.isArray(obj)){return obj.indexOf(value)!==-1;}return value in obj;},unique:function(array){if(!v.isArray(array)){return array;}return array.filter(function(el,index,array){return array.indexOf(el)==index;});},forEachKeyInKeypath:function(object,keypath,callback){if(!v.isString(keypath)){return undefined;}var key="",i,escape=false;for(i=0;i<keypath.length;++i){switch(keypath[i]){case'.':if(escape){escape=false;key+='.';}else{object=callback(object,key,false);key="";}break;case'\\':if(escape){escape=false;key+='\\';}else{escape=true;}break;default:escape=false;key+=keypath[i];break;}}return callback(object,key,true);},getDeepObjectValue:function(obj,keypath){if(!v.isObject(obj)){return undefined;}return v.forEachKeyInKeypath(obj,keypath,function(obj,key){if(v.isObject(obj)){return obj[key];}});},// This returns an object with all the values of the form.
  // It uses the input name as key and the value as value
  // So for example this:
  // <input type="text" name="email" value="foo@bar.com" />
  // would return:
  // {email: "foo@bar.com"}
  collectFormValues:function(form,options){var values={},i,j,input,inputs,option,value;if(v.isJqueryElement(form)){form=form[0];}if(!form){return values;}options=options||{};inputs=form.querySelectorAll("input[name], textarea[name]");for(i=0;i<inputs.length;++i){input=inputs.item(i);if(v.isDefined(input.getAttribute("data-ignored"))){continue;}name=input.name.replace(/\./g,"\\\\.");value=v.sanitizeFormValue(input.value,options);if(input.type==="number"){value=value?+value:null;}else if(input.type==="checkbox"){if(input.attributes.value){if(!input.checked){value=values[name]||null;}}else{value=input.checked;}}else if(input.type==="radio"){if(!input.checked){value=values[name]||null;}}values[name]=value;}inputs=form.querySelectorAll("select[name]");for(i=0;i<inputs.length;++i){input=inputs.item(i);if(v.isDefined(input.getAttribute("data-ignored"))){continue;}if(input.multiple){value=[];for(j in input.options){option=input.options[j];if(option&&option.selected){value.push(v.sanitizeFormValue(option.value,options));}}}else{var _val=typeof input.options[input.selectedIndex]!=='undefined'?input.options[input.selectedIndex].value:'';value=v.sanitizeFormValue(_val,options);}values[input.name]=value;}return values;},sanitizeFormValue:function(value,options){if(options.trim&&v.isString(value)){value=value.trim();}if(options.nullify!==false&&value===""){return null;}return value;},capitalize:function(str){if(!v.isString(str)){return str;}return str[0].toUpperCase()+str.slice(1);},// Remove all errors who's error attribute is empty (null or undefined)
  pruneEmptyErrors:function(errors){return errors.filter(function(error){return !v.isEmpty(error.error);});},// In
  // [{error: ["err1", "err2"], ...}]
  // Out
  // [{error: "err1", ...}, {error: "err2", ...}]
  //
  // All attributes in an error with multiple messages are duplicated
  // when expanding the errors.
  expandMultipleErrors:function(errors){var ret=[];errors.forEach(function(error){// Removes errors without a message
  if(v.isArray(error.error)){error.error.forEach(function(msg){ret.push(v.extend({},error,{error:msg}));});}else{ret.push(error);}});return ret;},// Converts the error mesages by prepending the attribute name unless the
  // message is prefixed by ^
  convertErrorMessages:function(errors,options){options=options||{};var ret=[],prettify=options.prettify||v.prettify;errors.forEach(function(errorInfo){var error=v.result(errorInfo.error,errorInfo.value,errorInfo.attribute,errorInfo.options,errorInfo.attributes,errorInfo.globalOptions);if(!v.isString(error)){ret.push(errorInfo);return;}if(error[0]==='^'){error=error.slice(1);}else if(options.fullMessages!==false){error=v.capitalize(prettify(errorInfo.attribute))+" "+error;}error=error.replace(/\\\^/g,"^");error=v.format(error,{value:v.stringifyValue(errorInfo.value,options)});ret.push(v.extend({},errorInfo,{error:error}));});return ret;},// In:
  // [{attribute: "<attributeName>", ...}]
  // Out:
  // {"<attributeName>": [{attribute: "<attributeName>", ...}]}
  groupErrorsByAttribute:function(errors){var ret={};errors.forEach(function(error){var list=ret[error.attribute];if(list){list.push(error);}else{ret[error.attribute]=[error];}});return ret;},// In:
  // [{error: "<message 1>", ...}, {error: "<message 2>", ...}]
  // Out:
  // ["<message 1>", "<message 2>"]
  flattenErrorsToArray:function(errors){return errors.map(function(error){return error.error;}).filter(function(value,index,self){return self.indexOf(value)===index;});},cleanAttributes:function(attributes,whitelist){function whitelistCreator(obj,key,last){if(v.isObject(obj[key])){return obj[key];}return obj[key]=last?true:{};}function buildObjectWhitelist(whitelist){var ow={},attr;for(attr in whitelist){if(!whitelist[attr]){continue;}v.forEachKeyInKeypath(ow,attr,whitelistCreator);}return ow;}function cleanRecursive(attributes,whitelist){if(!v.isObject(attributes)){return attributes;}var ret=v.extend({},attributes),w,attribute;for(attribute in attributes){w=whitelist[attribute];if(v.isObject(w)){ret[attribute]=cleanRecursive(ret[attribute],w);}else if(!w){delete ret[attribute];}}return ret;}if(!v.isObject(whitelist)||!v.isObject(attributes)){return {};}whitelist=buildObjectWhitelist(whitelist);return cleanRecursive(attributes,whitelist);},exposeModule:function(validate,root,exports,module,define){if(exports){if(module&&module.exports){exports=module.exports=validate;}exports.validate=validate;}else{root.validate=validate;if(validate.isFunction(define)&&define.amd){define([],function(){return validate;});}}},warn:function(msg){if(typeof console!=="undefined"&&console.warn){console.warn("[validate.js] "+msg);}},error:function(msg){if(typeof console!=="undefined"&&console.error){console.error("[validate.js] "+msg);}}});validate.validators={// Presence validates that the value isn't empty
  presence:function(value,options){options=v.extend({},this.options,options);if(options.allowEmpty!==false?!v.isDefined(value):v.isEmpty(value)){return options.message||this.message||"can't be blank";}},length:function(value,options,attribute){// Empty values are allowed
  if(!v.isDefined(value)){return;}options=v.extend({},this.options,options);var is=options.is,maximum=options.maximum,minimum=options.minimum,tokenizer=options.tokenizer||function(val){return val;},err,errors=[];value=tokenizer(value);var length=value.length;if(!v.isNumber(length)){v.error(v.format("Attribute %{attr} has a non numeric value for `length`",{attr:attribute}));return options.message||this.notValid||"has an incorrect length";}// Is checks
  if(v.isNumber(is)&&length!==is){err=options.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)";errors.push(v.format(err,{count:is}));}if(v.isNumber(minimum)&&length<minimum){err=options.tooShort||this.tooShort||"is too short (minimum is %{count} characters)";errors.push(v.format(err,{count:minimum}));}if(v.isNumber(maximum)&&length>maximum){err=options.tooLong||this.tooLong||"is too long (maximum is %{count} characters)";errors.push(v.format(err,{count:maximum}));}if(errors.length>0){return options.message||errors;}},numericality:function(value,options,attribute,attributes,globalOptions){// Empty values are fine
  if(!v.isDefined(value)){return;}options=v.extend({},this.options,options);var errors=[],name,count,checks={greaterThan:function(v,c){return v>c;},greaterThanOrEqualTo:function(v,c){return v>=c;},equalTo:function(v,c){return v===c;},lessThan:function(v,c){return v<c;},lessThanOrEqualTo:function(v,c){return v<=c;},divisibleBy:function(v,c){return v%c===0;}},prettify=options.prettify||globalOptions&&globalOptions.prettify||v.prettify;// Strict will check that it is a valid looking number
  if(v.isString(value)&&options.strict){var pattern="^-?(0|[1-9]\\d*)";if(!options.onlyInteger){pattern+="(\\.\\d+)?";}pattern+="$";if(!new RegExp(pattern).test(value)){return options.message||options.notValid||this.notValid||this.message||"must be a valid number";}}// Coerce the value to a number unless we're being strict.
  if(options.noStrings!==true&&v.isString(value)&&!v.isEmpty(value)){value=+value;}// If it's not a number we shouldn't continue since it will compare it.
  if(!v.isNumber(value)){return options.message||options.notValid||this.notValid||this.message||"is not a number";}// Same logic as above, sort of. Don't bother with comparisons if this
  // doesn't pass.
  if(options.onlyInteger&&!v.isInteger(value)){return options.message||options.notInteger||this.notInteger||this.message||"must be an integer";}for(name in checks){count=options[name];if(v.isNumber(count)&&!checks[name](value,count)){// This picks the default message if specified
  // For example the greaterThan check uses the message from
  // this.notGreaterThan so we capitalize the name and prepend "not"
  var key="not"+v.capitalize(name);var msg=options[key]||this[key]||this.message||"must be %{type} %{count}";errors.push(v.format(msg,{count:count,type:prettify(name)}));}}if(options.odd&&value%2!==1){errors.push(options.notOdd||this.notOdd||this.message||"must be odd");}if(options.even&&value%2!==0){errors.push(options.notEven||this.notEven||this.message||"must be even");}if(errors.length){return options.message||errors;}},datetime:v.extend(function(value,options){if(!v.isFunction(this.parse)||!v.isFunction(this.format)){throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");}// Empty values are fine
  if(!v.isDefined(value)){return;}options=v.extend({},this.options,options);var err,errors=[],earliest=options.earliest?this.parse(options.earliest,options):NaN,latest=options.latest?this.parse(options.latest,options):NaN;value=this.parse(value,options);// 86400000 is the number of milliseconds in a day, this is used to remove
  // the time from the date
  if(isNaN(value)||options.dateOnly&&value%86400000!==0){err=options.notValid||options.message||this.notValid||"must be a valid date";return v.format(err,{value:arguments[0]});}if(!isNaN(earliest)&&value<earliest){err=options.tooEarly||options.message||this.tooEarly||"must be no earlier than %{date}";err=v.format(err,{value:this.format(value,options),date:this.format(earliest,options)});errors.push(err);}if(!isNaN(latest)&&value>latest){err=options.tooLate||options.message||this.tooLate||"must be no later than %{date}";err=v.format(err,{date:this.format(latest,options),value:this.format(value,options)});errors.push(err);}if(errors.length){return v.unique(errors);}},{parse:null,format:null}),date:function(value,options){options=v.extend({},options,{dateOnly:true});return v.validators.datetime.call(v.validators.datetime,value,options);},format:function(value,options){if(v.isString(options)||options instanceof RegExp){options={pattern:options};}options=v.extend({},this.options,options);var message=options.message||this.message||"is invalid",pattern=options.pattern,match;// Empty values are allowed
  if(!v.isDefined(value)){return;}if(!v.isString(value)){return message;}if(v.isString(pattern)){pattern=new RegExp(options.pattern,options.flags);}match=pattern.exec(value);if(!match||match[0].length!=value.length){return message;}},inclusion:function(value,options){// Empty values are fine
  if(!v.isDefined(value)){return;}if(v.isArray(options)){options={within:options};}options=v.extend({},this.options,options);if(v.contains(options.within,value)){return;}var message=options.message||this.message||"^%{value} is not included in the list";return v.format(message,{value:value});},exclusion:function(value,options){// Empty values are fine
  if(!v.isDefined(value)){return;}if(v.isArray(options)){options={within:options};}options=v.extend({},this.options,options);if(!v.contains(options.within,value)){return;}var message=options.message||this.message||"^%{value} is restricted";return v.format(message,{value:value});},email:v.extend(function(value,options){options=v.extend({},this.options,options);var message=options.message||this.message||"is not a valid email";// Empty values are fine
  if(!v.isDefined(value)){return;}if(!v.isString(value)){return message;}if(!this.PATTERN.exec(value)){return message;}},{PATTERN:/^[a-z0-9\u007F-\uffff!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9\u007F-\uffff!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,}$/i}),equality:function(value,options,attribute,attributes,globalOptions){if(!v.isDefined(value)){return;}if(v.isString(options)){options={attribute:options};}options=v.extend({},this.options,options);var message=options.message||this.message||"is not equal to %{attribute}";if(v.isEmpty(options.attribute)||!v.isString(options.attribute)){throw new Error("The attribute must be a non empty string");}var otherValue=v.getDeepObjectValue(attributes,options.attribute),comparator=options.comparator||function(v1,v2){return v1===v2;},prettify=options.prettify||globalOptions&&globalOptions.prettify||v.prettify;if(!comparator(value,otherValue,options,attribute,attributes)){return v.format(message,{attribute:prettify(options.attribute)});}},// A URL validator that is used to validate URLs with the ability to
  // restrict schemes and some domains.
  url:function(value,options){if(!v.isDefined(value)){return;}options=v.extend({},this.options,options);var message=options.message||this.message||"is not a valid url",schemes=options.schemes||this.schemes||['http','https'],allowLocal=options.allowLocal||this.allowLocal||false;if(!v.isString(value)){return message;}// https://gist.github.com/dperini/729294
  var regex="^"+// protocol identifier
  "(?:(?:"+schemes.join("|")+")://)"+// user:pass authentication
  "(?:\\S+(?::\\S*)?@)?"+"(?:";var tld="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(allowLocal){tld+="?";}else{regex+=// IP address exclusion
  // private & local networks
  "(?!(?:10|127)(?:\\.\\d{1,3}){3})"+"(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})"+"(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})";}regex+=// IP address dotted notation octets
  // excludes loopback network 0.0.0.0
  // excludes reserved space >= 224.0.0.0
  // excludes network & broacast addresses
  // (first & last IP address of each class)
  "(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))"+"|"+// host name
  "(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+// domain name
  "(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+tld+")"+// port number
  "(?::\\d{2,5})?"+// resource path
  "(?:[/?#]\\S*)?"+"$";var PATTERN=new RegExp(regex,'i');if(!PATTERN.exec(value)){return message;}}};validate.formatters={detailed:function(errors){return errors;},flat:v.flattenErrorsToArray,grouped:function(errors){var attr;errors=v.groupErrorsByAttribute(errors);for(attr in errors){errors[attr]=v.flattenErrorsToArray(errors[attr]);}return errors;},constraint:function(errors){var attr;errors=v.groupErrorsByAttribute(errors);for(attr in errors){errors[attr]=errors[attr].map(function(result){return result.validator;}).sort();}return errors;}};validate.exposeModule(validate,this,exports,module,define);}).call(commonjsGlobal$1,exports,module,null);});validate.validators.equals=function(value,options,key,attributes){if(options&&value!==options.value){return key+'must equal '+options.value;}};validate.validators.doesNotEqual=function(value,options,key){if(options&&value===options.value){return key+'cannot equal '+options.value;}};validate.validators.contains=function(value,options,key){if(options&&value.indexOf&&value.indexOf(options.value)===-1){return key+'must contain '+options.value;}};validate.validators.doesNotContain=function(value,options,key){if(options&&value.indexOf&&value.indexOf(options.value)!==-1){return key+'cannot contain '+options.value;}};validate.validators.startsWith=function(value,options,key){if(options&&value.startsWith&&!value.startsWith(options.value)){return key+'must start with '+options.value;}};validate.validators.endsWith=function(value,options,key){if(options&&value.endsWith&&!value.endsWith(options.value)){return key+'must end with '+options.value;}};/**
   * Import Constants
   */var StudySummary=metadata.StudySummary,InstanceMetadata$1=metadata.InstanceMetadata;/**
   * Match a Metadata instance against rules using Validate.js for validation.
   * @param  {StudySummary|InstanceMetadata} metadataInstance Metadata instance object
   * @param  {Array} rules Array of MatchingRules instances (StudyMatchingRule|SeriesMatchingRule|ImageMatchingRule) for the match
   * @return {Object}      Matching Object with score and details (which rule passed or failed)
   */var match$1=function match(metadataInstance,rules){// Make sure the supplied data is valid.
  if(!(metadataInstance instanceof StudySummary||metadataInstance instanceof InstanceMetadata$1)){throw new OHIFError('HPMatcher::match metadataInstance must be an instance of StudySummary or InstanceMetadata');}var options={format:'grouped'};var details={passed:[],failed:[]};var requiredFailed=false;var score=0;rules.forEach(function(rule){var attribute=rule.attribute;var customAttributeExists=metadataInstance.customAttributeExists(attribute);// If the metadataInstance we are testing (e.g. study, series, or instance MetadataInstance) do
  // not contain the attribute specified in the rule, check whether or not they have been
  // defined in the CustomAttributeRetrievalCallbacks Object.
  if(!customAttributeExists&&HP.CustomAttributeRetrievalCallbacks.hasOwnProperty(attribute)){var customAttribute=HP.CustomAttributeRetrievalCallbacks[attribute];metadataInstance.setCustomAttribute(attribute,customAttribute.callback(metadataInstance));customAttributeExists=true;}// Format the constraint as required by Validate.js
  var testConstraint=_defineProperty$2({},attribute,rule.constraint);// Create a single attribute object to be validated, since metadataInstance is an
  // instance of Metadata (StudyMetadata, SeriesMetadata or InstanceMetadata)
  var attributeValue=customAttributeExists?metadataInstance.getCustomAttribute(attribute):metadataInstance.getTagValue(attribute);var attributeMap=_defineProperty$2({},attribute,attributeValue);// Use Validate.js to evaluate the constraints on the specified metadataInstance
  var errorMessages;try{errorMessages=validate(attributeMap,testConstraint,[options]);}catch(e){errorMessages=['Something went wrong during validation.',e];}if(!errorMessages){// If no errorMessages were returned, then validation passed.
  // Add the rule's weight to the total score
  score+=parseInt(rule.weight,10);// Log that this rule passed in the matching details object
  details.passed.push({rule:rule});}else{// If errorMessages were present, then validation failed
  // If the rule that failed validation was Required, then
  // mark that a required Rule has failed
  if(rule.required){requiredFailed=true;}// Log that this rule failed in the matching details object
  // and include any error messages
  details.failed.push({rule:rule,errorMessages:errorMessages});}});// If a required Rule has failed Validation, set the matching score to zero
  if(requiredFailed){score=0;}return {score:score,details:details,requiredFailed:requiredFailed};};var HPMatcher={match:match$1};// Sorts an array by score
  var sortByScore=function sortByScore(arr){arr.sort(function(a,b){return b.score-a.score;});};/**
   * Import Constants
   */var StudyMetadata$1=metadata.StudyMetadata,InstanceMetadata$2=metadata.InstanceMetadata,StudySummary$1=metadata.StudySummary;var ABSTRACT_PRIOR_VALUE='abstractPriorValue';/*Meteor.startup(() => {
      HP.addCustomViewportSetting('wlPreset', 'Window/Level Preset', Object.create(null), (element, optionValue) => {
          if (_.findWhere(OHIF.viewer.wlPresets, { id: optionValue })) {
              OHIF.viewerbase.wlPresets.applyWLPreset(optionValue, element);
          }
      });
  });*/ // TODO:
  // Should have ProtocolStore as an input to constructor
  // Something to update current HP and current stage 'globally'
  //
  //
  // Should allow user to provide:
  // functions for adding /
  var ProtocolEngine=/*#__PURE__*/function(){/**
     * Constructor
     * @param  {Array} studies        Array of study metadata
     * @param  {Map} priorStudies Map of prior studies
     * @param  {Object} studyMetadataSource Instance of StudyMetadataSource (ohif-viewerbase) Object to get study metadata
     */function ProtocolEngine(studies,priorStudies,studyMetadataSource){_classCallCheck$b(this,ProtocolEngine);_defineProperty$2(this,"matchedProtocols",new Set());_defineProperty$2(this,"matchedProtocolScores",new Map());// -----------
  // Type Validations
  if(!(studyMetadataSource instanceof StudyMetadataSource)){throw new OHIFError('ProtocolEngine::constructor studyMetadataSource is not an instance of StudyMetadataSource');}if(!(studies instanceof Array)&&!studies.every(function(study){return study instanceof StudyMetadata$1;})){throw new OHIFError("ProtocolEngine::constructor studies is not an array or it's items are not instances of StudyMetadata");}// --------------
  // Initialization
  this.studies=studies;this.priorStudies=priorStudies instanceof Map?priorStudies:new Map();this.studyMetadataSource=studyMetadataSource;// Put protocol engine in a known state
  this.reset();// Create an array for new stage ids to be stored
  // while editing a stage
  this.newStageIds=[];}/**
     * Resets the ProtocolEngine to the best match
     */_createClass$1(ProtocolEngine,[{key:"reset",value:function reset(){var protocol=this.getBestProtocolMatch();this.setHangingProtocol(protocol);}/**
       * Retrieves the current Stage from the current Protocol and stage index
       *
       * @returns {*} The Stage model for the currently displayed Stage
       */},{key:"getCurrentStageModel",value:function getCurrentStageModel(){return this.protocol.stages[this.stage];}/**
       * Finds the best protocols from Protocol Store, matching each protocol matching rules
       * with the given study. The best protocol are orded by score and returned in an array
       * @param  {Object} study StudyMetadata instance object
       * @return {Array}       Array of match objects or an empty array if no match was found
       *                       Each match object has the score of the matching and the matched
       *                       protocol
       */},{key:"findMatchByStudy",value:function findMatchByStudy(study){log$1.trace('ProtocolEngine::findMatchByStudy');var matched=[];var studyInstance=study.getFirstInstance();// Set custom attribute for study metadata
  var numberOfAvailablePriors=this.getNumberOfAvailablePriors(study.getObjectID());HP.ProtocolStore.getProtocol().forEach(function(protocol){// Clone the protocol's protocolMatchingRules array
  // We clone it so that we don't accidentally add the
  // numberOfPriorsReferenced rule to the Protocol itself.
  var rules=protocol.protocolMatchingRules.slice();if(!rules){return;}// Check if the study has the minimun number of priors used by the protocol.
  var numberOfPriorsReferenced=protocol.getNumberOfPriorsReferenced();if(numberOfPriorsReferenced>numberOfAvailablePriors){return;}// Run the matcher and get matching details
  var matchedDetails=HPMatcher.match(studyInstance,rules);var score=matchedDetails.score;// The protocol matched some rule, add it to the matched list
  if(score>0){matched.push({score:score,protocol:protocol});}});// If no matches were found, select the default protocol
  if(!matched.length){var defaultProtocol=HP.ProtocolStore.getProtocol('defaultProtocol');return [{score:1,protocol:defaultProtocol}];}// Sort the matched list by score
  sortByScore(matched);log$1.trace('ProtocolEngine::findMatchByStudy matched',matched);return matched;}},{key:"_clearMatchedProtocols",value:function _clearMatchedProtocols(){this.matchedProtocols.clear();this.matchedProtocolScores.clear();}/**
       * Populates the MatchedProtocols Collection by running the matching procedure
       */},{key:"updateProtocolMatches",value:function updateProtocolMatches(){var _this=this;log$1.trace('ProtocolEngine::updateProtocolMatches');// Clear all data currently in matchedProtocols
  this._clearMatchedProtocols();// For each study, find the matching protocols
  this.studies.forEach(function(study){var matched=_this.findMatchByStudy(study);// For each matched protocol, check if it is already in MatchedProtocols
  matched.forEach(function(matchedDetail){var protocol=matchedDetail.protocol;if(!protocol){return;}// If it is not already in the MatchedProtocols Collection, insert it with its score
  if(!_this.matchedProtocols.has(protocol)){log$1.trace('ProtocolEngine::updateProtocolMatches inserting protocol match',matchedDetail);_this.matchedProtocols.add(protocol);_this.matchedProtocolScores[protocol.id]=matchedDetail.score;}});});}},{key:"_getHighestScoringProtocol",value:function _getHighestScoringProtocol(){var highestScoringProtocolId=ProtocolEngine._largestKeyByValue(this.matchedProtocolScores);return this.matchedProtocols[highestScoringProtocolId];}/**
       * Return the best matched Protocol to the current study or set of studies
       * @returns {*}
       */},{key:"getBestProtocolMatch",value:function getBestProtocolMatch(){// Run the matching to populate matchedProtocols Set and Map
  this.updateProtocolMatches();// Retrieve the highest scoring Protocol
  var bestMatch=this._getHighestScoringProtocol();log$1.trace('ProtocolEngine::getBestProtocolMatch bestMatch',bestMatch);return bestMatch;}/**
       * Get the number of prior studies supplied in the priorStudies map property.
       *
       * @param {String} studyObjectID The study object ID of the study whose priors are needed
       * @returns {number} The number of available prior studies with the same PatientID
       */},{key:"getNumberOfAvailablePriors",value:function getNumberOfAvailablePriors(studyObjectID){return this.getAvailableStudyPriors(studyObjectID).length;}/**
       * Get the array of prior studies from a specific study.
       *
       * @param {String} studyObjectID The study object ID of the study whose priors are needed
       * @returns {Array} The array of available priors or an empty array
       */},{key:"getAvailableStudyPriors",value:function getAvailableStudyPriors(studyObjectID){var priors=this.priorStudies.get(studyObjectID);return priors instanceof Array?priors:[];}// Match images given a list of Studies and a Viewport's image matching reqs
  },{key:"matchImages",value:function matchImages(viewport,viewportIndex){var _this2=this;log$1.trace('ProtocolEngine::matchImages');var studyMatchingRules=viewport.studyMatchingRules,seriesMatchingRules=viewport.seriesMatchingRules,instanceMatchingRules=viewport.imageMatchingRules;var matchingScores=[];var currentStudy=this.studies[0];// @TODO: Should this be: this.studies[this.currentStudy] ???
  var firstInstance=currentStudy.getFirstInstance();var highestStudyMatchingScore=0;var highestSeriesMatchingScore=0;// Set custom attribute for study metadata and it's first instance
  currentStudy.setCustomAttribute(ABSTRACT_PRIOR_VALUE,0);if(firstInstance instanceof InstanceMetadata$2){firstInstance.setCustomAttribute(ABSTRACT_PRIOR_VALUE,0);}// Only used if study matching rules has abstract prior values defined...
  var priorStudies;studyMatchingRules.forEach(function(rule){if(rule.attribute===ABSTRACT_PRIOR_VALUE){var validatorType=Object.keys(rule.constraint)[0];var validator=Object.keys(rule.constraint[validatorType])[0];var abstractPriorValue=rule.constraint[validatorType][validator];abstractPriorValue=parseInt(abstractPriorValue,10);// TODO: Restrict or clarify validators for abstractPriorValue?
  // No need to call it more than once...
  if(!priorStudies){priorStudies=_this2.getAvailableStudyPriors(currentStudy.getObjectID());}// TODO: Revisit this later: What about two studies with the same
  // study date?
  var priorStudy;if(abstractPriorValue===-1){priorStudy=priorStudies[priorStudies.length-1];}else{var studyIndex=Math.max(abstractPriorValue-1,0);priorStudy=priorStudies[studyIndex];}// Invalid data
  if(!(priorStudy instanceof StudyMetadata$1)&&!(priorStudy instanceof StudySummary$1)){return;}var priorStudyObjectID=priorStudy.getObjectID();// Check if study metadata is already in studies list
  if(_this2.studies.find(function(study){return study.getObjectID()===priorStudyObjectID;})){return;}// Get study metadata if necessary and load study in the viewer (each viewer should provide it's own load study method)
  _this2.studyMetadataSource.loadStudy(priorStudy).then(function(studyMetadata){// Set the custom attribute abstractPriorValue for the study metadata
  studyMetadata.setCustomAttribute(ABSTRACT_PRIOR_VALUE,abstractPriorValue);// Also add custom attribute
  var firstInstance=studyMetadata.getFirstInstance();if(firstInstance instanceof InstanceMetadata$2){firstInstance.setCustomAttribute(ABSTRACT_PRIOR_VALUE,abstractPriorValue);}// Insert the new study metadata
  _this2.studies.push(studyMetadata);// Update the viewport to refresh layout manager with new study
  _this2.updateViewports(viewportIndex);},function(error){log$1.warn(error);throw new OHIFError("ProtocolEngine::matchImages could not get study metadata for the Study with the following ObjectID: ".concat(priorStudyObjectID));});}// TODO: Add relative Date / time
  });this.studies.forEach(function(study){var studyMatchDetails=HPMatcher.match(study.getFirstInstance(),studyMatchingRules);// Prevent bestMatch from being updated if the matchDetails' required attribute check has failed
  if(studyMatchDetails.requiredFailed===true||studyMatchDetails.score<highestStudyMatchingScore){return;}highestStudyMatchingScore=studyMatchDetails.score;study.forEachSeries(function(series){var seriesMatchDetails=HPMatcher.match(series.getFirstInstance(),seriesMatchingRules);// Prevent bestMatch from being updated if the matchDetails' required attribute check has failed
  if(seriesMatchDetails.requiredFailed===true||seriesMatchDetails.score<highestSeriesMatchingScore){return;}highestSeriesMatchingScore=seriesMatchDetails.score;series.forEachInstance(function(instance,index){// This tests to make sure there is actually image data in this instance
  // TODO: Change this when we add PDF and MPEG support
  // See https://ohiforg.atlassian.net/browse/LT-227
  // sopClassUid = x00080016
  // rows = x00280010
  if(!isImage(instance.getTagValue('x00080016'))&&!instance.getTagValue('x00280010')){return;}var instanceMatchDetails=HPMatcher.match(instance,instanceMatchingRules);// Prevent bestMatch from being updated if the matchDetails' required attribute check has failed
  if(instanceMatchDetails.requiredFailed===true){return;}var matchDetails={passed:[],failed:[]};matchDetails.passed=matchDetails.passed.concat(instanceMatchDetails.details.passed);matchDetails.passed=matchDetails.passed.concat(seriesMatchDetails.details.passed);matchDetails.passed=matchDetails.passed.concat(studyMatchDetails.details.passed);matchDetails.failed=matchDetails.failed.concat(instanceMatchDetails.details.failed);matchDetails.failed=matchDetails.failed.concat(seriesMatchDetails.details.failed);matchDetails.failed=matchDetails.failed.concat(studyMatchDetails.details.failed);var totalMatchScore=instanceMatchDetails.score+seriesMatchDetails.score+studyMatchDetails.score;var currentSOPInstanceUID=instance.getSOPInstanceUID();var imageDetails={studyInstanceUid:study.getStudyInstanceUID(),seriesInstanceUid:series.getSeriesInstanceUID(),sopInstanceUid:currentSOPInstanceUID,currentImageIdIndex:index,matchingScore:totalMatchScore,matchDetails:matchDetails,sortingInfo:{score:totalMatchScore,study:instance.getTagValue('x00080020')+instance.getTagValue('x00080030'),// StudyDate = x00080020 StudyTime = x00080030
  series:parseInt(instance.getTagValue('x00200011')),// TODO: change for seriesDateTime SeriesNumber = x00200011
  instance:parseInt(instance.getTagValue('x00200013'))// TODO: change for acquisitionTime InstanceNumber = x00200013
  }};// Find the displaySet
  var displaySet=study.findDisplaySet(function(displaySet){return displaySet.images.find(function(image){return image.getSOPInstanceUID()===currentSOPInstanceUID;});});// If the instance was found, set the displaySet ID
  if(displaySet){imageDetails.displaySetInstanceUid=displaySet.getUID();imageDetails.imageId=instance.getImageId();}matchingScores.push(imageDetails);});});});// Sort the matchingScores
  var sortingFunction=sortBy({name:'score',reverse:true},{name:'study',reverse:true},{name:'instance'},{name:'series'});matchingScores.sort(function(a,b){return sortingFunction(a.sortingInfo,b.sortingInfo);});var bestMatch=matchingScores[0];log$1.trace('ProtocolEngine::matchImages bestMatch',bestMatch);return {bestMatch:bestMatch,matchingScores:matchingScores};}/**
       * Rerenders viewports that are part of the current ProtocolEngine's LayoutManager
       * using the matching rules internal to each viewport.
       *
       * If this function is provided the index of a viewport, only the specified viewport
       * is rerendered.
       *
       * @param viewportIndex
       */},{key:"updateViewports",value:function updateViewports(viewportIndex){var _this3=this;log$1.trace("ProtocolEngine::updateViewports viewportIndex: ".concat(viewportIndex));// Make sure we have an active protocol with a non-empty array of display sets
  if(!this.getNumProtocolStages()){return;}// Retrieve the current stage
  var stageModel=this.getCurrentStageModel();// If the current stage does not fulfill the requirements to be displayed,
  // stop here.
  if(!stageModel||!stageModel.viewportStructure||!stageModel.viewports||!stageModel.viewports.length){return;}// Retrieve the layoutTemplate associated with the current display set's viewport structure
  // If no such template name exists, stop here.
  var layoutTemplateName=stageModel.viewportStructure.getLayoutTemplateName();if(!layoutTemplateName){return;}// Retrieve the properties associated with the current display set's viewport structure template
  // If no such layout properties exist, stop here.
  var layoutProps=stageModel.viewportStructure.properties;if(!layoutProps){return;}// Create an empty array to store the output viewportData
  var viewportData=[];// Empty the matchDetails associated with the ProtocolEngine.
  // This will be used to store the pass/fail details and score
  // for each of the viewport matching procedures
  this.matchDetails=[];// Loop through each viewport
  stageModel.viewports.forEach(function(viewport,viewportIndex){var details=_this3.matchImages(viewport,viewportIndex);_this3.matchDetails[viewportIndex]=details;// Convert any YES/NO values into true/false for Cornerstone
  var cornerstoneViewportParams={};// Cache viewportSettings keys
  var viewportSettingsKeys=Object.keys(viewport.viewportSettings);viewportSettingsKeys.forEach(function(key){var value=viewport.viewportSettings[key];if(value==='YES'){value=true;}else if(value==='NO'){value=false;}cornerstoneViewportParams[key]=value;});// imageViewerViewports occasionally needs relevant layout data in order to set
  // the element style of the viewport in question
  var currentViewportData=_objectSpread$1({viewportIndex:viewportIndex,viewport:cornerstoneViewportParams},layoutProps);var customSettings=[];viewportSettingsKeys.forEach(function(id){var setting=HP.CustomViewportSettings[id];if(!setting){return;}customSettings.push({id:id,value:viewport.viewportSettings[id]});});currentViewportData.renderedCallback=function(element){//console.log('renderedCallback for ' + element.id);
  customSettings.forEach(function(customSetting){log$1.trace("ProtocolEngine::currentViewportData.renderedCallback Applying custom setting: ".concat(customSetting.id));log$1.trace("ProtocolEngine::currentViewportData.renderedCallback with value: ".concat(customSetting.value));var setting=HP.CustomViewportSettings[customSetting.id];setting.callback(element,customSetting.value);});};var currentMatch=details.bestMatch;var currentPosition=1;var scoresLength=details.matchingScores.length;while(currentPosition<scoresLength&&viewportData.find(function(a){return a.imageId===currentMatch.imageId;})){currentMatch=details.matchingScores[currentPosition];currentPosition++;}if(currentMatch&&currentMatch.imageId){currentViewportData.studyInstanceUid=currentMatch.studyInstanceUid;currentViewportData.seriesInstanceUid=currentMatch.seriesInstanceUid;currentViewportData.sopInstanceUid=currentMatch.sopInstanceUid;currentViewportData.currentImageIdIndex=currentMatch.currentImageIdIndex;currentViewportData.displaySetInstanceUid=currentMatch.displaySetInstanceUid;currentViewportData.imageId=currentMatch.imageId;}// @TODO Why should we throw an exception when a best match is not found? This was aborting the whole process.
  // if (!currentViewportData.displaySetInstanceUid) {
  //     throw new OHIFError('ProtocolEngine::updateViewports No matching display set found?');
  // }
  viewportData.push(currentViewportData);});this.LayoutManager.layoutTemplateName=layoutTemplateName;this.LayoutManager.layoutProps=layoutProps;this.LayoutManager.viewportData=viewportData;if(viewportIndex!==undefined&&viewportData[viewportIndex]){this.LayoutManager.rerenderViewportWithNewDisplaySet(viewportIndex,viewportData[viewportIndex]);}else{this.LayoutManager.updateViewports();}}/**
       * Sets the current Hanging Protocol to the specified Protocol
       * An optional argument can also be used to prevent the updating of the Viewports
       *
       * @param newProtocol
       * @param updateViewports
       */},{key:"setHangingProtocol",value:function setHangingProtocol(newProtocol){var updateViewports=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;log$1.trace('ProtocolEngine::setHangingProtocol newProtocol',newProtocol);log$1.trace("ProtocolEngine::setHangingProtocol updateViewports = ".concat(updateViewports));// Reset the array of newStageIds
  this.newStageIds=[];if(HP.Protocol.prototype.isPrototypeOf(newProtocol)){this.protocol=newProtocol;}else{this.protocol=new HP.Protocol();this.protocol.fromObject(newProtocol);}this.stage=0;// Update viewports by default
  if(updateViewports){this.updateViewports();}//Session.set('HangingProtocolName', this.protocol.name);
  //Session.set('HangingProtocolStage', this.stage);
  }/**
       * Check if the next stage is available
       * @return {Boolean} True if next stage is available or false otherwise
       */},{key:"isNextStageAvailable",value:function isNextStageAvailable(){var numberOfStages=this.getNumProtocolStages();return this.stage+1<numberOfStages;}/**
       * Check if the previous stage is available
       * @return {Boolean} True if previous stage is available or false otherwise
       */},{key:"isPreviousStageAvailable",value:function isPreviousStageAvailable(){return this.stage-1>=0;}/**
       * Changes the current stage to a new stage index in the display set sequence.
       * It checks if the next stage exists.
       *
       * @param {Integer} stageAction An integer value specifying wheater next (1) or previous (-1) stage
       * @return {Boolean} True if new stage has set or false, otherwise
       */},{key:"setCurrentProtocolStage",value:function setCurrentProtocolStage(stageAction){// Check if previous or next stage is available
  if(stageAction===-1&&!this.isPreviousStageAvailable()){return false;}else if(stageAction===1&&!this.isNextStageAvailable()){return false;}// Sets the new stage
  this.stage+=stageAction;// Log the new stage
  log$1.trace("ProtocolEngine::setCurrentProtocolStage stage = ".concat(this.stage));// Set stage Session variable for reactivity
  //Session.set('HangingProtocolStage', this.stage);
  // Since stage has changed, we need to update the viewports
  // and redo matchings
  this.updateViewports();// Everything went well
  return true;}/**
       * Retrieves the number of Stages in the current Protocol or
       * undefined if no protocol or stages are set
       */},{key:"getNumProtocolStages",value:function getNumProtocolStages(){if(!this.protocol||!this.protocol.stages||!this.protocol.stages.length){return;}return this.protocol.stages.length;}/**
       * Switches to the next protocol stage in the display set sequence
       */},{key:"nextProtocolStage",value:function nextProtocolStage(){log$1.trace('ProtocolEngine::nextProtocolStage');if(!this.setCurrentProtocolStage(1)){log$1.trace('ProtocolEngine::nextProtocolStage failed');}}/**
       * Switches to the previous protocol stage in the display set sequence
       */},{key:"previousProtocolStage",value:function previousProtocolStage(){log$1.trace('ProtocolEngine::previousProtocolStage');if(!this.setCurrentProtocolStage(-1)){log$1.trace('ProtocolEngine::previousProtocolStage failed');}}}]);return ProtocolEngine;}();var viewer={};var OHIF$1={viewer:viewer,utils:utils,studies:studies,redux:redux,classes:classes,metadata:metadata,hotkeys:hotkeys,header:header,cornerstone:cornerstone$1$1,string:string,ui:ui,user:user,object:object,commands:commands,log:log$1,external:external,DICOMWeb:DICOMWeb,plugins:plugins};

  var dicomParser_min = createCommonjsModule(function (module, exports) {
  /*! dicom-parser - 1.8.2 - 2018-12-05 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
  !function(e,t){module.exports=t();}(commonjsGlobal,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n});},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0});},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=79)}([function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0, eval)("this");}catch(e){"object"==typeof window&&(r=window);}e.exports=r;},function(e,t,r){(function(e){
  /*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
   * @license  MIT
   */
  var n=r(73),i=r(72),a=r(38);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return f(this,e,t,r)}function f(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return "undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|c(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return "number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=s(e,t<0?0:0|c(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|c(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function c(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return j(e).length;default:if(n)return Z(e).length;t=(""+t).toLowerCase(),n=!0;}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n;}function m(e,t,r,n,i){if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return -1;r=e.length-1;}else if(r<0){if(!i)return -1;r=0;}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:_(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;o=2,s/=2,l/=2,r/=2;}function f(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=r;a<s;a++)if(f(e,a)===f(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1;}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(f(e,a+d)!==f(t,d)){h=!1;break}if(h)return a}return -1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s;}return o}function b(e,t,r,n){return C(Z(t,e.length-r),e,r,n)}function v(e,t,r,n){return C(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return v(e,t,r,n)}function E(e,t,r,n){return C(j(t),e,r,n)}function x(e,t,r,n){return C(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function S(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function k(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,f=e[i],u=null,h=f>239?4:f>223?3:f>191?2:1;if(i+h<=r)switch(h){case 1:f<128&&(u=f);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&f)<<6|63&a)>127&&(u=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&f)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&f)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l);}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h;}return function(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return !1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return f(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return !(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return !0;default:return !1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length;}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return "";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return "";if((r>>>=0)<=(t>>>=0))return "";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return k(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0;}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var a=i-n,o=r-t,s=Math.min(a,o),f=this.slice(n,i),u=e.slice(t,r),h=0;h<s;++h)if(f[h]!==u[h]){a=f[h],o=u[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0);}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return v(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0;}},l.prototype.toJSON=function(){return {type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function D(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=z(e[a]);return i}function O(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function L(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i);}function F(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255;}function B(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(e,t,r,n,a){return a||B(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function M(e,t,r,n,a){return a||B(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e];}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):F(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i);}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i);}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):F(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return U(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return U(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return M(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return M(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i);}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:Z(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s];}return this};var N=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function Z(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320);}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r);}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128);}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128);}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128);}}return a}function j(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return "";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(0));},function(e,t,r){var n=r(10),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=h;var a=r(6);a.inherits=r(5);var o=r(35),s=r(18);a.inherits(h,o);for(var l=i(s.prototype),f=0;f<l.length;f++){var u=l[f];h.prototype[u]||(h.prototype[u]=s.prototype[u]);}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d);}function d(){this.allowHalfOpen||this._writableState.ended||n.nextTick(c,this);}function c(e){e.end();}Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e);}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e);};},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a;}catch(e){r=a;}try{n="function"==typeof clearTimeout?clearTimeout:o;}catch(e){n=o;}}();var l,f=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?f=l.concat(f):h=-1,f.length&&c());}function c(){if(!u){var e=s(d);u=!0;for(var t=f.length;t;){for(l=f,f=[];++h<t;)l&&l[h].run();h=-1,t=f.length;}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e);}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e);}}function p(e,t){this.fun=e,this.array=t;}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new p(e,t)),1!==f.length||u||s(c);},p.prototype.run=function(){this.fun.apply(null,this.array);},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return []},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return "/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,r=e.readUint16();return "x"+("00000000"+(t+r).toString(16)).substr(-8)};},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e;};},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return "boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return "number"==typeof e},t.isString=function(e){return "string"==typeof e},t.isSymbol=function(e){return "symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return "[object RegExp]"===r(e)},t.isObject=function(e){return "object"==typeof e&&null!==e},t.isDate=function(e){return "[object Date]"===r(e)},t.isError=function(e){return "[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return "function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer;}).call(this,r(1).Buffer);},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n);}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=r,this.elements=n;}return n(e,[{key:"uint16",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readUint16(this.byteArray,r.dataOffset+2*t)}},{key:"int16",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readInt16(this.byteArray,r.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readUint32(this.byteArray,r.dataOffset+4*t)}},{key:"int32",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readInt32(this.byteArray,r.dataOffset+4*t)}},{key:"float",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readFloat(this.byteArray,r.dataOffset+4*t)}},{key:"double",value:function(e,t){var r=this.elements[e];if(t=void 0!==t?t:0,r&&0!==r.length)return a(r,this.byteArrayParser).readDouble(this.byteArray,r.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var r=(0, i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===r?1:r.length+1}}},{key:"string",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){var n=(0, i.readFixedString)(this.byteArray,r.dataOffset,r.length);return t>=0?n.split("\\")[t].trim():n.trim()}}},{key:"text",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){var n=(0, i.readFixedString)(this.byteArray,r.dataOffset,r.length);return t>=0?n.split("\\")[t].replace(/ +$/,""):n.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){t=void 0!==t?t:0;var n=this.string(e,t);if(void 0!==n)return parseFloat(n)}}},{key:"intString",value:function(e,t){var r=this.elements[e];if(r&&r.length>0){t=void 0!==t?t:0;var n=this.string(e,t);if(void 0!==n)return parseInt(n)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var r=a(t,this.byteArrayParser).readUint16,n=this.byteArray,i=t.dataOffset;return "x"+("00000000"+(256*r(n,i)*256+r(n,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o;},function(e,t,r){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n]);}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a];},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a];},flattenChunks:function(e){return [].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o));},t.setTyped(n);},function(e,t,r){var n=r(1),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r];}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)};},function(e,t,r){(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,r);});case 3:return t.nextTick(function(){e.call(null,r,n);});case 4:return t.nextTick(function(){e.call(null,r,n,i);});default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick(function(){e.apply(null,a);})}}}:e.exports=t;}).call(this,r(3));},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r,n){if(void 0!==e&&t instanceof e)return t.slice(r,r+n);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+r,n);throw"dicomParser.from: unknown type for byteArray"};}).call(this,r(1).Buffer);},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n);}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(11),o=(n=a)&&n.__esModule?n:{default:n},s=r(14);var l=function(){function t(r,n,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==!1&&n instanceof e==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=r,this.byteArray=n,this.position=i||0,this.warnings=[];}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e;}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var r=(0, o.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,r)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0, s.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=l;}).call(this,r(1).Buffer);},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0, a.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var n,i=r(4),a=(n=i)&&n.__esModule?n:{default:n};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,r){if(r<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+r>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var n,i="",a=0;a<r;a++){if(0===(n=e[t+a]))return t+=r,i;i+=String.fromCharCode(n);}return i};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0, o.default)(e),vr:e.readFixedString(2)};2===f(l.vr)?(l.length=e.readUint16(),l.dataOffset=e.position):(e.seek(2),l.length=e.readUint32(),l.dataOffset=e.position);4294967295===l.length&&(l.hadUndefinedLength=!0);if(l.tag===r)return l;if("SQ"===l.vr)return (0, s.default)(e,l,t),l;if(4294967295===l.length)return "x7fe00010"===l.tag?((0, n.default)(e,l,t),l):"UN"===l.vr?((0, i.default)(e,l),l):((0, a.default)(e,l),l);return e.seek(l.length),l};var n=l(r(42)),i=l(r(41)),a=l(r(24)),o=l(r(4)),s=l(r(40));function l(e){return e&&e.__esModule?e:{default:e}}var f=function(e){return "OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?t.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";var a=e.elements;for(;t.position<r;){var o=(0, n.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>r)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?e.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";var a=e.elements;for(;t.position<r;){var o=(0, i.default)(t,n.untilTag,n.vrCallback);if(a[o.tag]=o,o.tag===n.untilTag)return}};var n=a(r(15)),i=a(r(23));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s,f){if(s=s||1,f=f||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(r>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(r+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var u=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),h=(0, a.default)(u);if("xfffee000"!==h.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";u.seek(h.length);var d=u.position;if(1===s)return (0, o.default)(u.byteArray,d+f[r].offset+8,f[r].length);for(var c=l(f,r,s),p=(0, n.default)(u.byteArray,c),g=0,m=r;m<r+s;m++)for(var _=d+f[m].offset+8,y=0;y<f[m].length;y++)p[g++]=u.byteArray[_++];return p};var n=s(r(22)),i=s(r(12)),a=s(r(13)),o=s(r(11));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e,t,r){for(var n=0,i=t;i<t+r;i++)n+=e[i].length;return n};},function(e,t,r){(function(t,n,i){var a=r(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next;}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e;}(t,e);};}e.exports=y;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:a.nextTick;y.WritableState=_;var f=r(6);f.inherits=r(5);var u={deprecate:r(61)},h=r(34),d=r(9).Buffer,c=i.Uint8Array||function(){};var p,g=r(33);function m(){}function _(e,t){s=s||r(2),e=e||{};var n=t instanceof s;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,f=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(f||0===f)?f:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0;}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(a.nextTick(i,n),a.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),S(e,t));}(e,r,n,t,i);else{var o=E(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),n?l(v,e,r,o,i):v(e,r,o,i);}}(t,e);},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this);}function y(e){if(s=s||r(2),!(p.call(y,this)||this instanceof s))return new y(e);this._writableState=new _(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),h.call(this);}function b(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1;}function v(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"));}(e,t),t.pendingcb--,n(),S(e,t);}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),a=t.corkedRequestsFree;a.entry=r;for(var s=0,l=!0;r;)i[s]=r,r.isBuf||(l=!1),r=r.next,s+=1;i.allBuffers=l,b(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0;}else{for(;r;){var f=r.chunk,u=r.encoding,h=r.callback;if(b(e,t,!1,t.objectMode?1:f.length,f,u,h),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null);}t.bufferedRequest=r,t.bufferProcessing=!1;}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final(function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),S(e,t);});}function S(e,t){var r=E(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")));}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}f.inherits(y,h),_.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(_.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")});}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return !!p.call(this,e)||this===y&&(e&&e._writableState instanceof _)}})):p=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"));},y.prototype.write=function(e,t,r){var n,i=this._writableState,o=!1,s=!i.objectMode&&(n=e,d.isBuffer(n)||n instanceof c);return s&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=m),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),a.nextTick(t,r);}(this,r):(s||function(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(n,o),i=!1),i}(this,i,e,r))&&(i.pendingcb++,o=function(e,t,r,n,i,a){if(!r){var o=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,r));return t}(t,n,i);n!==o&&(r=!0,i="buffer",n=o);}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var f=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},f?f.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1;}else b(e,t,!1,s,n,i,a);return l}(this,i,s,e,t,r)),o},y.prototype.cork=function(){this._writableState.corked++;},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e));},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},y.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"));},y.prototype._writev=null,y.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&void 0!==e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,S(e,t),r&&(t.finished?a.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1;}(this,n,r);},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e);}}),y.prototype.destroy=g.destroy,y.prototype._undestroy=g.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e);};}).call(this,r(3),r(63).setImmediate,r(0));},function(e,t,r){(t=e.exports=r(35)).Stream=t,t.Readable=t,t.Writable=r(18),t.Duplex=r(2),t.Transform=r(31),t.PassThrough=r(60);},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0;}function n(e){return "function"==typeof e}function i(e){return "object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,o,s,l,f;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(a(r=this._events[e]))return !1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s);}else if(i(r))for(s=Array.prototype.slice.call(arguments,1),o=(f=r.slice()).length,l=0;l<o;l++)f[l].apply(this,s);return !0},r.prototype.addListener=function(e,t){var o;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments));}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,a,o,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,a=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(s=o;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){a=s;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t);}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var r=e[t]+(e[t+1]<<8);return 32768&r&&(r=r-65535-1),r},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],new Float64Array(r.buffer)[0]}};},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r){if(void 0!==e&&t instanceof e)return e.alloc(r);if(t instanceof Uint8Array)return new Uint8Array(r);throw"dicomParser.alloc: unknown type for byteArray"};}).call(this,r(1).Buffer);},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var o={tag:(0, a.default)(e),length:e.readUint32(),dataOffset:e.position};4294967295===o.length&&(o.hadUndefinedLength=!0);if(o.tag===t)return o;if(s(o,e,r))return (0, i.default)(e,o),o;if(o.hadUndefinedLength)return (0, n.default)(e,o),o;return e.seek(o.length),o};var n=o(r(24)),i=o(r(39)),a=o(r(4));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t,r){if(void 0!==r)return "SQ"===r(e.tag);if(t.position+4<=t.byteArray.length){var n=(0, a.default)(t);return t.seek(-4),"xfffee000"===n||"xfffee0dd"===n}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r=e.byteArray.length-8;for(;e.position<=r;){var n=e.readUint16();if(65534===n){var i=e.readUint16();if(57357===i){var a=e.readUint32();return 0!==a&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position);};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return n[e]},t.isPrivateTag=function(e){return parseInt(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return {familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n,i){if(n=n||t.basicOffsetTable,i=i||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===n.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(r<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(r>=n.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=n[r],f=o(i,l);if(void 0===f)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var u=s(r,n,i,f);return (0, a.default)(e,t,f,u,i)};var n,i=r(17),a=(n=i)&&n.__esModule?n:{default:n};var o=function(e,t){for(var r=0;r<e.length;r++)if(e[r].offset===t)return r},s=function(e,t,r,n){if(e===t.length-1)return r.length-n;for(var i=t[e+1],a=n+1;a<r.length;a++)if(r[a].offset===i)return a-n;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};},function(e,t,r){var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e;}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return -1^e};},function(e,t,r){e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0;}while(--o);i%=65521,a%=65521;}return i|a<<16|0};},function(e,t,r){(function(e,n){var i=/%[sdj%]/g;t.format=function(e){if(!_(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,o=String(e).replace(i,function(e){if("%%"===e)return "%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return "[Circular]"}default:return e}}),l=n[r];r<a;l=n[++r])g(l)||!v(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(r,i){if(y(e.process))return function(){return t.deprecate(r,i).apply(this,arguments)};if(!0===n.noDeprecation)return r;var a=!1;return function(){if(!a){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),a=!0;}return r.apply(this,arguments)}};var a,o={};function s(e,r){var n={seen:[],stylize:f};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),u(n,e,n.depth)}function l(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function f(e,t){return e}function u(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return _(i)||(i=u(e,i,n)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(_(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(m(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,r);if(a)return a;var o=Object.keys(r),s=function(e){var t={};return e.forEach(function(e,r){t[e]=!0;}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),E(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(r);if(0===o.length){if(x(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(b(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(w(r))return e.stylize(Date.prototype.toString.call(r),"date");if(E(r))return h(r)}var f,v="",S=!1,k=["{","}"];(c(r)&&(S=!0,k=["[","]"]),x(r))&&(v=" [Function"+(r.name?": "+r.name:"")+"]");return b(r)&&(v=" "+RegExp.prototype.toString.call(r)),w(r)&&(v=" "+Date.prototype.toUTCString.call(r)),E(r)&&(v=" "+h(r)),0!==o.length||S&&0!=r.length?n<0?b(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),f=S?function(e,t,r,n,i){for(var a=[],o=0,s=t.length;o<s;++o)P(t,String(o))?a.push(d(e,t,r,n,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(d(e,t,r,n,i,!0));}),a}(e,r,n,s,o):o.map(function(t){return d(e,r,n,s,t,S)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(f,v,k)):k[0]+v+k[1]}function h(e){return "["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),P(n,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=g(r)?u(e,l.value,null):u(e,l.value,r-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return "  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return "   "+e}).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"));}return o+": "+s}function c(e){return Array.isArray(e)}function p(e){return "boolean"==typeof e}function g(e){return null===e}function m(e){return "number"==typeof e}function _(e){return "string"==typeof e}function y(e){return void 0===e}function b(e){return v(e)&&"[object RegExp]"===S(e)}function v(e){return "object"==typeof e&&null!==e}function w(e){return v(e)&&"[object Date]"===S(e)}function E(e){return v(e)&&("[object Error]"===S(e)||e instanceof Error)}function x(e){return "function"==typeof e}function S(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=n.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n);};}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=c,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=_,t.isSymbol=function(e){return "symbol"==typeof e},t.isUndefined=y,t.isRegExp=b,t.isObject=v,t.isDate=w,t.isError=E,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(54);var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,r;console.log("%s - %s",(e=new Date,r=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":"),[e.getDate(),A[e.getMonth()],r].join(" ")),t.format.apply(t,arguments));},t.inherits=r(53),t._extend=function(e,t){if(!t||!v(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};}).call(this,r(0),r(3));},function(e,t,r){(function(t){
  /*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
   * @license  MIT
   */
  function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=r(29),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l="foo"===function(){}.name;function f(e){return Object.prototype.toString.call(e)}function u(e){return !i(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var h=e.exports=_,d=/\s*function\s+([^\(\s]*)\s*/;function c(e){if(a.isFunction(e)){if(l)return e.name;var t=e.toString().match(d);return t&&t[1]}}function p(e,t){return "string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(l||!a.isFunction(e))return a.inspect(e);var t=c(e);return "[Function"+(t?": "+t:"")+"]"}function m(e,t,r,n,i){throw new h.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function _(e,t){e||m(e,!0,t,"==",h.ok);}function y(e,t,r,o){if(e===t)return !0;if(i(e)&&i(t))return 0===n(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(u(e)&&u(t)&&f(e)===f(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return !1;var l=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return -1!==l&&l===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return !1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return !1;var i=b(e),o=b(t);if(i&&!o||!i&&o)return !1;if(i)return e=s.call(e),t=s.call(t),y(e,t,r);var l,f,u=E(e),h=E(t);if(u.length!==h.length)return !1;for(u.sort(),h.sort(),f=u.length-1;f>=0;f--)if(u[f]!==h[f])return !1;for(f=u.length-1;f>=0;f--)if(l=u[f],!y(e[l],t[l],r,n))return !1;return !0}(e,t,r,o))}return r?e===t:e==t}function b(e){return "[object Arguments]"==Object.prototype.toString.call(e)}function v(e,t){if(!e||!t)return !1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return !0}catch(e){}return !Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e();}catch(e){t=e;}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&m(i,r,"Missing expected exception"+n);var o="string"==typeof n,s=!e&&a.isError(i),l=!e&&i&&!r;if((s&&o&&v(i,r)||l)&&m(i,r,"Got unwanted exception"+n),e&&i&&r&&!v(i,r)||!e&&i)throw i}h.AssertionError=function(e){var t;this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(g((t=this).actual),128)+" "+t.operator+" "+p(g(t.expected),128),this.generatedMessage=!0);var r=e.stackStartFunction||m;if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var n=new Error;if(n.stack){var i=n.stack,a=c(r),o=i.indexOf("\n"+a);if(o>=0){var s=i.indexOf("\n",o+1);i=i.substring(s+1);}this.stack=i;}}},a.inherits(h.AssertionError,Error),h.fail=m,h.ok=_,h.equal=function(e,t,r){e!=t&&m(e,t,r,"==",h.equal);},h.notEqual=function(e,t,r){e==t&&m(e,t,r,"!=",h.notEqual);},h.deepEqual=function(e,t,r){y(e,t,!1)||m(e,t,r,"deepEqual",h.deepEqual);},h.deepStrictEqual=function(e,t,r){y(e,t,!0)||m(e,t,r,"deepStrictEqual",h.deepStrictEqual);},h.notDeepEqual=function(e,t,r){y(e,t,!1)&&m(e,t,r,"notDeepEqual",h.notDeepEqual);},h.notDeepStrictEqual=function e(t,r,n){y(t,r,!0)&&m(t,r,n,"notDeepStrictEqual",e);},h.strictEqual=function(e,t,r){e!==t&&m(e,t,r,"===",h.strictEqual);},h.notStrictEqual=function(e,t,r){e===t&&m(e,t,r,"!==",h.notStrictEqual);},h.throws=function(e,t,r){w(!0,e,t,r);},h.doesNotThrow=function(e,t,r){w(!1,e,t,r);},h.ifError=function(e){if(e)throw e};var E=Object.keys||function(e){var t=[];for(var r in e)o.call(e,r)&&t.push(r);return t};}).call(this,r(0));},function(e,t,r){e.exports=a;var n=r(2),i=r(6);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark);}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o);}function o(){var e=this;"function"==typeof this._flush?this._flush(function(t,r){s(e,t,r);}):s(this,null,null);}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(5),i.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark);}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0;},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close");});};},function(e,t,r){var n=r(9).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return !0;default:return !1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return "utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return "utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return "utf16le";case"latin1":case"binary":return "latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0;}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=f,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=h,t=3;break;default:return this.write=d,void(this.end=c)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t);}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"".repeat(r);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"".repeat(r+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"".repeat(r+2)}}(this,e,t);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function f(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function c(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return "";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return "";r=this.lastNeed,this.lastNeed=0;}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r)return 0;if((i=o(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r)return 0;if((i=o(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length;};},function(e,t,r){var n=r(10);function i(e,t){e.emit("error",t);}e.exports={destroy:function(e,t){var r=this,a=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return a||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e);}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1);}};},function(e,t,r){e.exports=r(20).EventEmitter;},function(e,t,r){(function(t,n){var i=r(10);e.exports=b;var a,o=r(38);b.ReadableState=y;r(20).EventEmitter;var s=function(e,t){return e.listeners(t).length},l=r(34),f=r(9).Buffer,u=t.Uint8Array||function(){};var h=r(6);h.inherits=r(5);var d=r(66),c=void 0;c=d&&d.debuglog?d.debuglog("stream"):function(){};var p,g=r(65),m=r(33);h.inherits(b,l);var _=["error","close","destroy","pause","resume"];function y(e,t){a=a||r(2),e=e||{};var n=t instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=r(32).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding);}function b(e){if(a=a||r(2),!(this instanceof b))return new b(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this);}function v(e,t,r,n,i){var a,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length);}t.ended=!0,S(e);}(e,o)):(i||(a=function(e,t){var r;n=t,f.isBuffer(n)||n instanceof u||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===f.prototype||(t=function(e){return f.from(e)}(t)),n?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):A(e,o)):w(e,o,t,!1))):n||(o.reading=!1));return function(e){return !e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&S(e)),A(e,t);}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e);}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e);},b.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=f.from(e,t),t=""),r=!0),v(this,e,t,!1,r)},b.prototype.unshift=function(e){return v(this,e,null,!0,!1)},b.prototype.isPaused=function(){return !1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=r(32).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var E=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=E?e=E:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e));}function k(e){c("emit readable"),e.emit("readable"),O(e);}function A(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(P,e,t));}function P(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(c("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1;}function T(e){c("readable nexttick read 0"),e.read(0);}function D(e,t){t.reading||(c("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0);}function O(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function I(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(o===a.length?i+=a:i+=a.slice(0,e),0===(e-=o)){o===a.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++n;}return t.length-=n,i}(e,t):function(e,t){var r=f.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,o),0===(e-=o)){o===a.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(o));break}++i;}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r;}function R(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(L,t,e));}function L(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"));}function F(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1}b.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?R(this):S(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&R(this),null;var n,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(r,t))),null===(n=e>0?I(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&R(this)),null!==n&&this.emit("data",n),n},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"));},b.prototype.pipe=function(e,t){var r=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e);}a.pipesCount+=1,c("pipe count=%d opts=%j",a.pipesCount,t);var l=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?u:b;function f(t,n){c("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",_),e.removeListener("finish",y),e.removeListener("drain",h),e.removeListener("error",m),e.removeListener("unpipe",f),r.removeListener("end",u),r.removeListener("end",b),r.removeListener("data",g),d=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||h());}function u(){c("onend"),e.end();}a.endEmitted?i.nextTick(l):r.once("end",l),e.on("unpipe",f);var h=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,O(e));}}(r);e.on("drain",h);var d=!1;var p=!1;function g(t){c("ondata"),p=!1,!1!==e.write(t)||p||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==F(a.pipes,e))&&!d&&(c("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,p=!0),r.pause());}function m(t){c("onerror",t),b(),e.removeListener("error",m),0===s(e,"error")&&e.emit("error",t);}function _(){e.removeListener("finish",y),b();}function y(){c("onfinish"),e.removeListener("close",_),b();}function b(){c("unpipe"),r.unpipe(e);}return r.on("data",g),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r);}(e,"error",m),e.once("close",_),e.once("finish",y),e.emit("pipe",r),a.flowing||(c("pipe resume"),r.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,r);return this}var o=F(t.pipes,e);return -1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},b.prototype.on=function(e,t){var r=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&S(this):i.nextTick(T,this));}return r},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(D,e,t));}(this,e)),this},b.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",function(){if(c("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e);}t.push(null);}),e.on("data",function(i){(c("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&void 0!==i)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())));}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<_.length;a++)e.on(_[a],this.emit.bind(this,_[a]));return this._read=function(t){c("wrapped _read",t),n&&(n=!1,e.resume());},this},b._fromList=I;}).call(this,r(0),r(3));},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var r=new n.default(a.default,e);return function(){!function(){if(r.seek(128),"DICM"!==r.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();var e=[],t={};for(;r.position<r.byteArray.length;){var n=r.position,s=(0, o.default)(r,e);if(s.tag>"x0002ffff"){r.position=n;break}s.parser=a.default,t[s.tag]=s;}var l=new i.default(r.byteArrayParser,r.byteArray,t);return l.warnings=r.warnings,l.position=r.position,l}()};var n=s(r(12)),i=s(r(7)),a=s(r(21)),o=s(r(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return (e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var r=(e[t]<<8)+e[t+1];return 32768&r&&(r=r-65535-1),r},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return (e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[3]=e[t],r[2]=e[t+1],r[1]=e[t+2],r[0]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[7]=e[t],r[6]=e[t+1],r[5]=e[t+2],r[4]=e[t+3],r[3]=e[t+4],r[2]=e[t+5],r[1]=e[t+6],r[0]=e[t+7],new Float64Array(r.buffer)[0]}};},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return "[object Array]"==r.call(e)};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var n=(0, o.default)(e);if(e.seek(-4),"xfffee0dd"===n)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=f(e,r);t.items.push(i);}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset;}(e,t,r):function(e,t,r){var n=t.dataOffset+t.length;for(;e.position<n;){var i=f(e,r);t.items.push(i);}}(e,t,r);};var n=l(r(7)),i=l(r(23)),a=l(r(13)),o=l(r(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){var r=(0, a.default)(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=(0, i.default)(e,void 0,t);if(r[a.tag]=a,"xfffee00d"===a.tag)return new n.default(e.byteArrayParser,e.byteArray,r)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new n.default(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new n.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(r.dataSet,e,e.position+r.length,{vrCallback:t})),r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var n=(0, o.default)(e);if(e.seek(-4),"xfffee0dd"===n)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=f(e,r);t.items.push(i);}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset;}(e,t,r):function(e,t,r){var n=t.dataOffset+t.length;for(;e.position<n;){var i=f(e,r);t.items.push(i);}}(e,t,r);};var n=l(r(7)),i=l(r(15)),a=l(r(13)),o=l(r(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(16));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){var r=(0, a.default)(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=(0, i.default)(e,t);if(r[a.tag]=a,"xfffee00d"===a.tag)return new n.default(e.byteArrayParser,e.byteArray,r)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new n.default(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new n.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(r.dataSet,e,e.position+r.length)),r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";var r=e.byteArray.length-8;for(;e.position<=r;){var n=e.readUint16();if(65534===n){var i=e.readUint16();if(57565===i){var a=e.readUint32();return 0!==a&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position);};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0, a.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var n=e.readUint32()/4,i=0;i<n;i++){var o=e.readUint32();t.basicOffsetTable.push(o);}var s=e.position;for(;e.position<e.byteArray.length;){var l=(0, a.default)(e),f=e.readUint32();if("xfffee0dd"===l)return e.seek(f),void(t.length=e.position-t.dataOffset);if("xfffee000"!==l)return r&&r.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),f>e.byteArray.length-e.position&&(f=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:f}),e.seek(f),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:f}),e.seek(f);}r&&r.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd");};var n,i=r(4),a=(n=i)&&n.__esModule?n:{default:n};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,i=t.vr,a=t.tag;function o(t,r){for(var n="",i=0;i<t;i++)0!==i&&(n+="/"),n+=r.call(e,a,i).toString();return n}if(!0===n.isStringVr(i))r=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?r=o(t.length/2,e.uint16):"SS"===i?r=o(t.length/2,e.int16):"UL"===i?r=o(t.length/4,e.uint32):"SL"===i?r=o(t.length/4,e.int32):"FD"===i?r=o(t.length/8,e.double):"FL"===i&&(r=o(t.length/4,e.float));}return r};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(25));},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated"));if(void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";if(0!==t.basicOffsetTable.length)return (0, n.default)(e,t,r);return (0, i.default)(e,t,0,t.fragments.length)};var n=a(r(26)),i=a(r(17));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1;},function(e,t,r){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};},function(e,t,r){var n=r(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,f,u,h,d){var c,p,g,m,_,y,b,v,w,E=d.bits,x=0,S=0,k=0,A=0,P=0,T=0,D=0,O=0,I=0,R=0,L=null,F=0,B=new n.Buf16(16),U=new n.Buf16(16),M=null,N=0;for(x=0;x<=15;x++)B[x]=0;for(S=0;S<l;S++)B[t[r+S]]++;for(P=E,A=15;A>=1&&0===B[A];A--);if(P>A&&(P=A),0===A)return f[u++]=20971520,f[u++]=20971520,d.bits=1,0;for(k=1;k<A&&0===B[k];k++);for(P<k&&(P=k),O=1,x=1;x<=15;x++)if(O<<=1,(O-=B[x])<0)return -1;if(O>0&&(0===e||1!==A))return -1;for(U[1]=0,x=1;x<15;x++)U[x+1]=U[x]+B[x];for(S=0;S<l;S++)0!==t[r+S]&&(h[U[t[r+S]]++]=S);if(0===e?(L=M=h,y=19):1===e?(L=i,F-=257,M=a,N-=257,y=256):(L=o,M=s,y=-1),R=0,S=0,x=k,_=u,T=P,D=0,g=-1,m=(I=1<<P)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){b=x-D,h[S]<y?(v=0,w=h[S]):h[S]>y?(v=M[N+h[S]],w=L[F+h[S]]):(v=96,w=0),c=1<<x-D,k=p=1<<T;do{f[_+(R>>D)+(p-=c)]=b<<24|v<<16|w|0;}while(0!==p);for(c=1<<x-1;R&c;)c>>=1;if(0!==c?(R&=c-1,R+=c):R=0,S++,0==--B[x]){if(x===A)break;x=t[r+h[S]];}if(x>P&&(R&m)!==g){for(0===D&&(D=P),_+=k,O=1<<(T=x-D);T+D<A&&!((O-=B[T+D])<=0);)T++,O<<=1;if(I+=1<<T,1===e&&I>852||2===e&&I>592)return 1;f[g=R&m]=P<<24|T<<16|_-u|0;}}return 0!==R&&(f[_+R]=x-D<<24|64<<16|0),d.bits=P,0};},function(e,t,r){e.exports=function(e,t){var r,n,i,a,o,s,l,f,u,h,d,c,p,g,m,_,y,b,v,w,E,x,S,k,A;r=e.state,n=e.next_in,k=e.input,i=n+(e.avail_in-5),a=e.next_out,A=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,f=r.wsize,u=r.whave,h=r.wnext,d=r.window,c=r.hold,p=r.bits,g=r.lencode,m=r.distcode,_=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(c+=k[n++]<<p,p+=8,c+=k[n++]<<p,p+=8),b=g[c&_];t:for(;;){if(c>>>=v=b>>>24,p-=v,0===(v=b>>>16&255))A[a++]=65535&b;else{if(!(16&v)){if(0==(64&v)){b=g[(65535&b)+(c&(1<<v)-1)];continue t}if(32&v){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}w=65535&b,(v&=15)&&(p<v&&(c+=k[n++]<<p,p+=8),w+=c&(1<<v)-1,c>>>=v,p-=v),p<15&&(c+=k[n++]<<p,p+=8,c+=k[n++]<<p,p+=8),b=m[c&y];r:for(;;){if(c>>>=v=b>>>24,p-=v,!(16&(v=b>>>16&255))){if(0==(64&v)){b=m[(65535&b)+(c&(1<<v)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&b,p<(v&=15)&&(c+=k[n++]<<p,(p+=8)<v&&(c+=k[n++]<<p,p+=8)),(E+=c&(1<<v)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(c>>>=v,p-=v,E>(v=a-o)){if((v=E-v)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(x=0,S=d,0===h){if(x+=f-v,v<w){w-=v;do{A[a++]=d[x++];}while(--v);x=a-E,S=A;}}else if(h<v){if(x+=f+h-v,(v-=h)<w){w-=v;do{A[a++]=d[x++];}while(--v);if(x=0,h<w){w-=v=h;do{A[a++]=d[x++];}while(--v);x=a-E,S=A;}}}else if(x+=h-v,v<w){w-=v;do{A[a++]=d[x++];}while(--v);x=a-E,S=A;}for(;w>2;)A[a++]=S[x++],A[a++]=S[x++],A[a++]=S[x++],w-=3;w&&(A[a++]=S[x++],w>1&&(A[a++]=S[x++]));}else{x=a-E;do{A[a++]=A[x++],A[a++]=A[x++],A[a++]=A[x++],w-=3;}while(w>2);w&&(A[a++]=A[x++],w>1&&(A[a++]=A[x++]));}break}}break}}while(n<i&&a<s);n-=w=p>>3,c&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=c,r.bits=p;};},function(e,t,r){var n=r(8),i=r(28),a=r(27),o=r(47),s=r(46),l=0,f=1,u=2,h=4,d=5,c=6,p=0,g=1,m=2,_=-2,y=-3,b=-4,v=-5,w=8,E=1,x=2,S=3,k=4,A=5,P=6,T=7,D=8,O=9,I=10,R=11,L=12,F=13,B=14,U=15,M=16,N=17,z=18,Z=19,j=20,C=21,q=22,Y=23,W=24,H=25,G=26,V=27,J=28,K=29,X=30,$=31,Q=32,ee=852,te=592,re=15;function ne(e){return (e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,p):_}function ae(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ie(e)):_}function oe(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,ae(e))):_}function se(e,t){var r,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0;},e.state=i,i.window=null,(r=oe(e,t))!==p&&(e.state=null),r):_}var le,fe,ue=!0;function he(e){if(ue){var t;for(le=new n.Buf32(512),fe=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(f,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,fe,0,e.work,{bits:5}),ue=!1;}e.lencode=le,e.lenbits=9,e.distcode=fe,e.distbits=5;}function de(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=ae,t.inflateReset2=oe,t.inflateResetKeep=ie,t.inflateInit=function(e){return se(e,re)},t.inflateInit2=se,t.inflate=function(e,t){var r,ee,te,re,ie,ae,oe,se,le,fe,ue,ce,pe,ge,me,_e,ye,be,ve,we,Ee,xe,Se,ke,Ae=0,Pe=new n.Buf8(4),Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _;(r=e.state).mode===L&&(r.mode=F),ie=e.next_out,te=e.output,oe=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,se=r.hold,le=r.bits,fe=ae,ue=oe,xe=p;e:for(;;)switch(r.mode){case E:if(0===r.wrap){r.mode=F;break}for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(2&r.wrap&&35615===se){r.check=0,Pe[0]=255&se,Pe[1]=se>>>8&255,r.check=a(r.check,Pe,2,0),se=0,le=0,r.mode=x;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",r.mode=X;break}if((15&se)!==w){e.msg="unknown compression method",r.mode=X;break}if(le-=4,Ee=8+(15&(se>>>=4)),0===r.wbits)r.wbits=Ee;else if(Ee>r.wbits){e.msg="invalid window size",r.mode=X;break}r.dmax=1<<Ee,e.adler=r.check=1,r.mode=512&se?I:L,se=0,le=0;break;case x:for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(r.flags=se,(255&r.flags)!==w){e.msg="unknown compression method",r.mode=X;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=X;break}r.head&&(r.head.text=se>>8&1),512&r.flags&&(Pe[0]=255&se,Pe[1]=se>>>8&255,r.check=a(r.check,Pe,2,0)),se=0,le=0,r.mode=S;case S:for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}r.head&&(r.head.time=se),512&r.flags&&(Pe[0]=255&se,Pe[1]=se>>>8&255,Pe[2]=se>>>16&255,Pe[3]=se>>>24&255,r.check=a(r.check,Pe,4,0)),se=0,le=0,r.mode=k;case k:for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}r.head&&(r.head.xflags=255&se,r.head.os=se>>8),512&r.flags&&(Pe[0]=255&se,Pe[1]=se>>>8&255,r.check=a(r.check,Pe,2,0)),se=0,le=0,r.mode=A;case A:if(1024&r.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}r.length=se,r.head&&(r.head.extra_len=se),512&r.flags&&(Pe[0]=255&se,Pe[1]=se>>>8&255,r.check=a(r.check,Pe,2,0)),se=0,le=0;}else r.head&&(r.head.extra=null);r.mode=P;case P:if(1024&r.flags&&((ce=r.length)>ae&&(ce=ae),ce&&(r.head&&(Ee=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,ee,re,ce,Ee)),512&r.flags&&(r.check=a(r.check,ee,ce,re)),ae-=ce,re+=ce,r.length-=ce),r.length))break e;r.length=0,r.mode=T;case T:if(2048&r.flags){if(0===ae)break e;ce=0;do{Ee=ee[re+ce++],r.head&&Ee&&r.length<65536&&(r.head.name+=String.fromCharCode(Ee));}while(Ee&&ce<ae);if(512&r.flags&&(r.check=a(r.check,ee,ce,re)),ae-=ce,re+=ce,Ee)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=D;case D:if(4096&r.flags){if(0===ae)break e;ce=0;do{Ee=ee[re+ce++],r.head&&Ee&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ee));}while(Ee&&ce<ae);if(512&r.flags&&(r.check=a(r.check,ee,ce,re)),ae-=ce,re+=ce,Ee)break e}else r.head&&(r.head.comment=null);r.mode=O;case O:if(512&r.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(se!==(65535&r.check)){e.msg="header crc mismatch",r.mode=X;break}se=0,le=0;}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=L;break;case I:for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}e.adler=r.check=ne(se),se=0,le=0,r.mode=R;case R:if(0===r.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,m;e.adler=r.check=1,r.mode=L;case L:if(t===d||t===c)break e;case F:if(r.last){se>>>=7&le,le-=7&le,r.mode=V;break}for(;le<3;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}switch(r.last=1&se,le-=1,3&(se>>>=1)){case 0:r.mode=B;break;case 1:if(he(r),r.mode=j,t===c){se>>>=2,le-=2;break e}break;case 2:r.mode=N;break;case 3:e.msg="invalid block type",r.mode=X;}se>>>=2,le-=2;break;case B:for(se>>>=7&le,le-=7&le;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",r.mode=X;break}if(r.length=65535&se,se=0,le=0,r.mode=U,t===c)break e;case U:r.mode=M;case M:if(ce=r.length){if(ce>ae&&(ce=ae),ce>oe&&(ce=oe),0===ce)break e;n.arraySet(te,ee,re,ce,ie),ae-=ce,re+=ce,oe-=ce,ie+=ce,r.length-=ce;break}r.mode=L;break;case N:for(;le<14;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(r.nlen=257+(31&se),se>>>=5,le-=5,r.ndist=1+(31&se),se>>>=5,le-=5,r.ncode=4+(15&se),se>>>=4,le-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=X;break}r.have=0,r.mode=z;case z:for(;r.have<r.ncode;){for(;le<3;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}r.lens[Te[r.have++]]=7&se,se>>>=3,le-=3;}for(;r.have<19;)r.lens[Te[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Se={bits:r.lenbits},xe=s(l,r.lens,0,19,r.lencode,0,r.work,Se),r.lenbits=Se.bits,xe){e.msg="invalid code lengths set",r.mode=X;break}r.have=0,r.mode=Z;case Z:for(;r.have<r.nlen+r.ndist;){for(;_e=(Ae=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,ye=65535&Ae,!((me=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(ye<16)se>>>=me,le-=me,r.lens[r.have++]=ye;else{if(16===ye){for(ke=me+2;le<ke;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(se>>>=me,le-=me,0===r.have){e.msg="invalid bit length repeat",r.mode=X;break}Ee=r.lens[r.have-1],ce=3+(3&se),se>>>=2,le-=2;}else if(17===ye){for(ke=me+3;le<ke;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}le-=me,Ee=0,ce=3+(7&(se>>>=me)),se>>>=3,le-=3;}else{for(ke=me+7;le<ke;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}le-=me,Ee=0,ce=11+(127&(se>>>=me)),se>>>=7,le-=7;}if(r.have+ce>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=X;break}for(;ce--;)r.lens[r.have++]=Ee;}}if(r.mode===X)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=X;break}if(r.lenbits=9,Se={bits:r.lenbits},xe=s(f,r.lens,0,r.nlen,r.lencode,0,r.work,Se),r.lenbits=Se.bits,xe){e.msg="invalid literal/lengths set",r.mode=X;break}if(r.distbits=6,r.distcode=r.distdyn,Se={bits:r.distbits},xe=s(u,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Se),r.distbits=Se.bits,xe){e.msg="invalid distances set",r.mode=X;break}if(r.mode=j,t===c)break e;case j:r.mode=C;case C:if(ae>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,o(e,ue),ie=e.next_out,te=e.output,oe=e.avail_out,re=e.next_in,ee=e.input,ae=e.avail_in,se=r.hold,le=r.bits,r.mode===L&&(r.back=-1);break}for(r.back=0;_e=(Ae=r.lencode[se&(1<<r.lenbits)-1])>>>16&255,ye=65535&Ae,!((me=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(_e&&0==(240&_e)){for(be=me,ve=_e,we=ye;_e=(Ae=r.lencode[we+((se&(1<<be+ve)-1)>>be)])>>>16&255,ye=65535&Ae,!(be+(me=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}se>>>=be,le-=be,r.back+=be;}if(se>>>=me,le-=me,r.back+=me,r.length=ye,0===_e){r.mode=G;break}if(32&_e){r.back=-1,r.mode=L;break}if(64&_e){e.msg="invalid literal/length code",r.mode=X;break}r.extra=15&_e,r.mode=q;case q:if(r.extra){for(ke=r.extra;le<ke;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}r.length+=se&(1<<r.extra)-1,se>>>=r.extra,le-=r.extra,r.back+=r.extra;}r.was=r.length,r.mode=Y;case Y:for(;_e=(Ae=r.distcode[se&(1<<r.distbits)-1])>>>16&255,ye=65535&Ae,!((me=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(0==(240&_e)){for(be=me,ve=_e,we=ye;_e=(Ae=r.distcode[we+((se&(1<<be+ve)-1)>>be)])>>>16&255,ye=65535&Ae,!(be+(me=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}se>>>=be,le-=be,r.back+=be;}if(se>>>=me,le-=me,r.back+=me,64&_e){e.msg="invalid distance code",r.mode=X;break}r.offset=ye,r.extra=15&_e,r.mode=W;case W:if(r.extra){for(ke=r.extra;le<ke;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}r.offset+=se&(1<<r.extra)-1,se>>>=r.extra,le-=r.extra,r.back+=r.extra;}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=X;break}r.mode=H;case H:if(0===oe)break e;if(ce=ue-oe,r.offset>ce){if((ce=r.offset-ce)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=X;break}ce>r.wnext?(ce-=r.wnext,pe=r.wsize-ce):pe=r.wnext-ce,ce>r.length&&(ce=r.length),ge=r.window;}else ge=te,pe=ie-r.offset,ce=r.length;ce>oe&&(ce=oe),oe-=ce,r.length-=ce;do{te[ie++]=ge[pe++];}while(--ce);0===r.length&&(r.mode=C);break;case G:if(0===oe)break e;te[ie++]=r.length,oe--,r.mode=C;break;case V:if(r.wrap){for(;le<32;){if(0===ae)break e;ae--,se|=ee[re++]<<le,le+=8;}if(ue-=oe,e.total_out+=ue,r.total+=ue,ue&&(e.adler=r.check=r.flags?a(r.check,te,ue,ie-ue):i(r.check,te,ue,ie-ue)),ue=oe,(r.flags?se:ne(se))!==r.check){e.msg="incorrect data check",r.mode=X;break}se=0,le=0;}r.mode=J;case J:if(r.wrap&&r.flags){for(;le<32;){if(0===ae)break e;ae--,se+=ee[re++]<<le,le+=8;}if(se!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=X;break}se=0,le=0;}r.mode=K;case K:xe=g;break e;case X:xe=y;break e;case $:return b;case Q:default:return _}return e.next_out=ie,e.avail_out=oe,e.next_in=re,e.avail_in=ae,r.hold=se,r.bits=le,(r.wsize||ue!==e.avail_out&&r.mode<X&&(r.mode<V||t!==h))&&de(e,e.output,e.next_out,ue-e.avail_out)?(r.mode=$,b):(fe-=e.avail_in,ue-=e.avail_out,e.total_in+=fe,e.total_out+=ue,r.total+=ue,r.wrap&&ue&&(e.adler=r.check=r.flags?a(r.check,te,ue,e.next_out-ue):i(r.check,te,ue,e.next_out-ue)),e.data_type=r.bits+(r.last?64:0)+(r.mode===L?128:0)+(r.mode===j||r.mode===U?256:0),(0===fe&&0===ue||t===h)&&xe===p&&(xe=v),xe)},t.inflateEnd=function(e){if(!e||!e.state)return _;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?_:(r.head=t,t.done=!1,p):_},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==R?_:r.mode===R&&i(1,t,n,0)!==r.check?y:de(e,t,n,n)?(r.mode=$,b):(r.havedict=1,p):_},t.inflateInfo="pako inflate (from Nodeca project)";},function(e,t,r){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};},function(e,t,r){var n=r(8),i=4,a=0,o=1,s=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0;}var f=0,u=1,h=2,d=29,c=256,p=c+1+d,g=30,m=19,_=2*p+1,y=15,b=16,v=7,w=256,E=16,x=17,S=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=new Array(2*(p+2));l(D);var O=new Array(2*g);l(O);var I=new Array(512);l(I);var R=new Array(256);l(R);var L=new Array(d);l(L);var F,B,U,M=new Array(g);function N(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length;}function z(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t;}function Z(e){return e<256?I[e]:I[256+(e>>>7)]}function j(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255;}function C(e,t,r){e.bi_valid>b-r?(e.bi_buf|=t<<e.bi_valid&65535,j(e,e.bi_buf),e.bi_buf=t>>b-e.bi_valid,e.bi_valid+=r-b):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r);}function q(e,t,r){C(e,r[2*t],r[2*t+1]);}function Y(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1;}while(--t>0);return r>>>1}function W(e,t,r){var n,i,a=new Array(y+1),o=0;for(n=1;n<=y;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=Y(a[s]++,s));}}function H(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<g;t++)e.dyn_dtree[2*t]=0;for(t=0;t<m;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0;}function G(e){e.bi_valid>8?j(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0;}function V(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function J(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&V(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!V(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n;}function K(e,t,r){var n,i,a,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?q(e,i,t):(q(e,(a=R[i])+c+1,t),0!==(o=k[a])&&C(e,i-=L[a],o),q(e,a=Z(--n),r),0!==(o=A[a])&&C(e,n-=M[a],o));}while(s<e.last_lit);q(e,w,t);}function X(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,f=-1;for(e.heap_len=0,e.heap_max=_,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=f=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=f<2?++f:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=f,r=e.heap_len>>1;r>=1;r--)J(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],J(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,J(e,a,1);}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,f=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,c=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=y;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<_;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,g++),l[2*n+1]=a,n>f||(e.bl_count[a]++,o=0,n>=c&&(o=d[n-c]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(u[2*n+1]+o)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2;}while(g>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>f||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--);}}(e,t),W(a,f,e.bl_count);}function $(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,f=4;for(0===o&&(l=138,f=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<f?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*E]++):s<=10?e.bl_tree[2*x]++:e.bl_tree[2*S]++,s=0,a=i,0===o?(l=138,f=3):i===o?(l=6,f=3):(l=7,f=4));}function Q(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,f=4;for(0===o&&(l=138,f=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<f)do{q(e,i,e.bl_tree);}while(0!=--s);else 0!==i?(i!==a&&(q(e,i,e.bl_tree),s--),q(e,E,e.bl_tree),C(e,s-3,2)):s<=10?(q(e,x,e.bl_tree),C(e,s-3,3)):(q(e,S,e.bl_tree),C(e,s-11,7));s=0,a=i,0===o?(l=138,f=3):i===o?(l=6,f=3):(l=7,f=4);}}l(M);var ee=!1;function te(e,t,r,i){C(e,(f<<1)+(i?1:0),3),function(e,t,r,i){G(e),i&&(j(e,r),j(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r;}(e,t,r,!0);}t._tr_init=function(e){ee||(function(){var e,t,r,n,i,a=new Array(y+1);for(r=0,n=0;n<d-1;n++)for(L[n]=r,e=0;e<1<<k[n];e++)R[r++]=n;for(R[r-1]=n,i=0,n=0;n<16;n++)for(M[n]=i,e=0;e<1<<A[n];e++)I[i++]=n;for(i>>=7;n<g;n++)for(M[n]=i<<7,e=0;e<1<<A[n]-7;e++)I[256+i++]=n;for(t=0;t<=y;t++)a[t]=0;for(e=0;e<=143;)D[2*e+1]=8,e++,a[8]++;for(;e<=255;)D[2*e+1]=9,e++,a[9]++;for(;e<=279;)D[2*e+1]=7,e++,a[7]++;for(;e<=287;)D[2*e+1]=8,e++,a[8]++;for(W(D,p+1,a),e=0;e<g;e++)O[2*e+1]=5,O[2*e]=Y(e,5);F=new N(D,k,c+1,p,y),B=new N(O,A,0,g,y),U=new N(new Array(0),P,0,m,v);}(),ee=!0),e.l_desc=new z(e.dyn_ltree,F),e.d_desc=new z(e.dyn_dtree,B),e.bl_desc=new z(e.bl_tree,U),e.bi_buf=0,e.bi_valid=0,H(e);},t._tr_stored_block=te,t._tr_flush_block=function(e,t,r,n){var l,f,d=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return o;return a}(e)),X(e,e.l_desc),X(e,e.d_desc),d=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),X(e,e.bl_desc),t=m-1;t>=3&&0===e.bl_tree[2*T[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),l=e.opt_len+3+7>>>3,(f=e.static_len+3+7>>>3)<=l&&(l=f)):l=f=r+5,r+4<=l&&-1!==t?te(e,t,r,n):e.strategy===i||f===l?(C(e,(u<<1)+(n?1:0),3),K(e,D,O)):(C(e,(h<<1)+(n?1:0),3),function(e,t,r,n){var i;for(C(e,t-257,5),C(e,r-1,5),C(e,n-4,4),i=0;i<n;i++)C(e,e.bl_tree[2*T[i]+1],3);Q(e,e.dyn_ltree,t-1),Q(e,e.dyn_dtree,r-1);}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),K(e,e.dyn_ltree,e.dyn_dtree)),H(e),n&&G(e);},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(R[r]+c+1)]++,e.dyn_dtree[2*Z(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){C(e,u<<1,3),q(e,w,D),function(e){16===e.bi_valid?(j(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8);}(e);};},function(e,t,r){var n,i=r(8),a=r(50),o=r(28),s=r(27),l=r(49),f=0,u=1,h=3,d=4,c=5,p=0,g=1,m=-2,_=-3,y=-5,b=-1,v=1,w=2,E=3,x=4,S=0,k=2,A=8,P=9,T=15,D=8,O=286,I=30,R=19,L=2*O+1,F=15,B=3,U=258,M=U+B+1,N=32,z=42,Z=69,j=73,C=91,q=103,Y=113,W=666,H=1,G=2,V=3,J=4,K=3;function X(e,t){return e.msg=l[t],t}function $(e){return (e<<1)-(e>4?9:0)}function Q(e){for(var t=e.length;--t>=0;)e[t]=0;}function ee(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0));}function te(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm);}function re(e,t){e.pending_buf[e.pending++]=t;}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t;}function ie(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-M?e.strstart-(e.w_size-M):0,f=e.window,u=e.w_mask,h=e.prev,d=e.strstart+U,c=f[a+o-1],p=f[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(f[(r=t)+o]===p&&f[r+o-1]===c&&f[r]===f[a]&&f[++r]===f[a+1]){a+=2,r++;do{}while(f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&a<d);if(n=U-(d-a),a=d-U,n>o){if(e.match_start=t,o=n,n>=s)break;c=f[a+o-1],p=f[a+o];}}}while((t=h[t&u])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function ae(e){var t,r,n,a,l,f,u,h,d,c,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-M)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0;}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0;}while(--r);a+=p;}if(0===e.strm.avail_in)break;if(f=e.strm,u=e.window,h=e.strstart+e.lookahead,d=a,c=void 0,(c=f.avail_in)>d&&(c=d),r=0===c?0:(f.avail_in-=c,i.arraySet(u,f.input,f.next_in,c,h),1===f.state.wrap?f.adler=o(f.adler,u,c,h):2===f.state.wrap&&(f.adler=s(f.adler,u,c,h)),f.next_in+=c,f.total_in+=c,c),e.lookahead+=r,e.lookahead+e.insert>=B)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+B-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<B)););}while(e.lookahead<M&&0!==e.strm.avail_in)}function oe(e,t){for(var r,n;;){if(e.lookahead<M){if(ae(e),e.lookahead<M&&t===f)return H;if(0===e.lookahead)break}if(r=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-M&&(e.match_length=ie(e,r)),e.match_length>=B)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-B),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=B){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;}while(0!=--e.match_length);e.strstart++;}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=e.strstart<B-1?e.strstart:B-1,t===d?(te(e,!0),0===e.strm.avail_out?V:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:G}function se(e,t){for(var r,n,i;;){if(e.lookahead<M){if(ae(e),e.lookahead<M&&t===f)return H;if(0===e.lookahead)break}if(r=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=B-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-M&&(e.match_length=ie(e,r),e.match_length<=5&&(e.strategy===v||e.match_length===B&&e.strstart-e.match_start>4096)&&(e.match_length=B-1)),e.prev_length>=B&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-B,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-B),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=B-1,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return H}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return H}else e.match_available=1,e.strstart++,e.lookahead--;}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<B-1?e.strstart:B-1,t===d?(te(e,!0),0===e.strm.avail_out?V:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:G}function le(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i;}function fe(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?z:Y,e.adler=2===t.wrap?0:1,t.last_flush=f,a._tr_init(t),p):X(e,m)}function ue(e){var t,r=fe(e);return r===p&&((t=e.state).window_size=2*t.w_size,Q(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=B-1,t.match_available=0,t.ins_h=0),r}function he(e,t,r,n,a,o){if(!e)return m;var s=1;if(t===b&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>P||r!==A||n<8||n>15||t<0||t>9||o<0||o>x)return X(e,m);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*L),this.dyn_dtree=new i.Buf16(2*(2*I+1)),this.bl_tree=new i.Buf16(2*(2*R+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(F+1),this.heap=new i.Buf16(2*O+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*O+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0;};return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+B-1)/B),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,ue(e)}n=[new le(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===f)return H;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,te(e,!1),0===e.strm.avail_out))return H;if(e.strstart-e.block_start>=e.w_size-M&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?V:J):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),H)}),new le(4,4,8,4,oe),new le(4,5,16,8,oe),new le(4,6,32,32,oe),new le(4,4,16,16,se),new le(8,16,32,32,se),new le(8,16,128,128,se),new le(8,32,128,256,se),new le(32,128,258,1024,se),new le(32,258,258,4096,se)],t.deflateInit=function(e,t){return he(e,t,A,T,D,S)},t.deflateInit2=he,t.deflateReset=ue,t.deflateResetKeep=fe,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,p):m},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>c||t<0)return e?X(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===W&&t!==d)return X(e,0===e.avail_out?y:m);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===z)if(2===i.wrap)e.adler=0,re(i,31),re(i,139),re(i,8),i.gzhead?(re(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),re(i,255&i.gzhead.time),re(i,i.gzhead.time>>8&255),re(i,i.gzhead.time>>16&255),re(i,i.gzhead.time>>24&255),re(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),re(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(re(i,255&i.gzhead.extra.length),re(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=Z):(re(i,0),re(i,0),re(i,0),re(i,0),re(i,0),re(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),re(i,K),i.status=Y);else{var _=A+(i.w_bits-8<<4)<<8;_|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(_|=N),_+=31-_%31,i.status=Y,ne(i,_),0!==i.strstart&&(ne(i,e.adler>>>16),ne(i,65535&e.adler)),e.adler=1;}if(i.status===Z)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)re(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=j);}else i.status=j;if(i.status===j)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,re(i,l);}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=C);}else i.status=C;if(i.status===C)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,re(i,l);}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=q);}else i.status=q;if(i.status===q&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(re(i,255&e.adler),re(i,e.adler>>8&255),e.adler=0,i.status=Y)):i.status=Y),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&$(t)<=$(r)&&t!==d)return X(e,y);if(i.status===W&&0!==e.avail_in)return X(e,y);if(0!==e.avail_in||0!==i.lookahead||t!==f&&i.status!==W){var b=i.strategy===w?function(e,t){for(var r;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===f)return H;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?V:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:G}(i,t):i.strategy===E?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=U){if(ae(e),e.lookahead<=U&&t===f)return H;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=B&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+U;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=U-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead);}if(e.match_length>=B?(r=a._tr_tally(e,1,e.match_length-B),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?V:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:G}(i,t):n[i.level].func(i,t);if(b!==V&&b!==J||(i.status=W),b===H||b===V)return 0===e.avail_out&&(i.last_flush=-1),p;if(b===G&&(t===u?a._tr_align(i):t!==c&&(a._tr_stored_block(i,0,0,!1),t===h&&(Q(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,p}return t!==d?p:i.wrap<=0?g:(2===i.wrap?(re(i,255&e.adler),re(i,e.adler>>8&255),re(i,e.adler>>16&255),re(i,e.adler>>24&255),re(i,255&e.total_in),re(i,e.total_in>>8&255),re(i,e.total_in>>16&255),re(i,e.total_in>>24&255)):(ne(i,e.adler>>>16),ne(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:g)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==z&&t!==Z&&t!==j&&t!==C&&t!==q&&t!==Y&&t!==W?X(e,m):(e.state=null,t===Y?X(e,_):p):m},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,f,u,h,d=t.length;if(!e||!e.state)return m;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==z||r.lookahead)return m;for(1===s&&(e.adler=o(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===s&&(Q(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new i.Buf8(r.w_size),i.arraySet(h,t,d-r.w_size,r.w_size,0),t=h,d=r.w_size),l=e.avail_in,f=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,ae(r);r.lookahead>=B;){n=r.strstart,a=r.lookahead-(B-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+B-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++;}while(--a);r.strstart=n,r.lookahead=B-1,ae(r);}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=B-1,r.match_available=0,e.next_in=f,e.input=u,e.avail_in=l,r.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)";},function(e,t,r){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0;};},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e;};},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8};},function(e,t,r){(function(e,n){var i=r(30),a=r(52),o=r(51),s=r(48),l=r(45);for(var f in l)t[f]=l[f];t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7;function u(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0;}u.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null);},u.prototype.write=function(e,t,r,n,i,a,o){return this._write(!0,e,t,r,n,i,a,o)},u.prototype.writeSync=function(e,t,r,n,i,a,o){return this._write(!1,e,t,r,n,i,a,o)},u.prototype._write=function(r,a,o,s,l,f,u,h){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),l=0,s=0),this.strm.avail_in=l,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=h,this.strm.output=f,this.strm.next_out=u,this.flush=a,!r)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return n.nextTick(function(){d._process(),d._after();}),this},u.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},u.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},u.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return !0},u.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close();}},u.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close();},u.prototype.init=function(e,r,n,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(r>=-1&&r<=9,"invalid compression level"),i(n>=1&&n<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(r,e,n,a,o),this._setDictionary();},u.prototype.params=function(){throw new Error("deflateParams Not supported")},u.prototype.reset=function(){this._reset(),this._setDictionary();},u.prototype._init=function(e,r,n,i,l){switch(this.level=e,this.windowBits=r,this.memLevel=n,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0;},u.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary);}this.err!==t.Z_OK&&this._error("Failed to set dictionary");}},u.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm);}this.err!==t.Z_OK&&this._error("Failed to reset stream");},t.Zlib=u;}).call(this,r(1).Buffer,r(3));},function(e,t,r){e.exports=r(19).PassThrough;},function(e,t,r){e.exports=r(19).Transform;},function(e,t,r){e.exports=r(2);},function(e,t,r){e.exports=r(18);},function(e,t,r){e.exports=a;var n=r(31),i=r(6);function a(e){if(!(this instanceof a))return new a(e);n.call(this,e);}i.inherits=r(5),i.inherits(a,n),a.prototype._transform=function(e,t,r){r(null,e);};},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return !1}catch(e){return !1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0;}return e.apply(this,arguments)}};}).call(this,r(0));},function(e,t,r){(function(e,t){!function(e,r){if(!e.setImmediate){var n,i,a,o,s,l=1,f={},u=!1,h=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){p(e);});}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1;},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data);},n=function(e){a.port2.postMessage(e);}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,n=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null;},i.appendChild(t);}):n=function(e){setTimeout(p,0,e);}:(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length));},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),n=function(t){e.postMessage(o+t,"*");}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return f[l]=i,n(l),l++},d.clearImmediate=c;}function c(e){delete f[e];}function p(e){if(u)setTimeout(p,0,e);else{var t=f[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n);}}(t);}finally{c(e),u=!1;}}}}}("undefined"==typeof self?void 0===e?this:e:self);}).call(this,r(0),r(3));},function(e,t,r){(function(e){var n=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t;}t.setTimeout=function(){return new i(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close();},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id);},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t;},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1;},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout();},t));},r(62),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate;}).call(this,r(0));},function(e,t){},function(e,t,r){var n=r(9).Buffer,i=r(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0;}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length;},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length;},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0;},e.prototype.join=function(e){if(0===this.length)return "";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,a=n.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,r=a,i=s,t.copy(r,i),s+=o.data.length,o=o.next;return a},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e});},function(e,t){},function(e,t,r){e.exports=i;var n=r(20).EventEmitter;function i(){n.call(this);}r(5)(i,n),i.Readable=r(19),i.Writable=r(59),i.Duplex=r(58),i.Transform=r(57),i.PassThrough=r(56),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause();}function a(){r.readable&&r.resume&&r.resume();}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var o=!1;function s(){o||(o=!0,e.end());}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy());}function f(e){if(u(),0===n.listenerCount(this,"error"))throw e}function u(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",f),e.removeListener("error",f),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u);}return r.on("error",f),e.on("error",f),r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e};},function(e,t,r){(function(e){var n=r(1).Buffer,i=r(67).Transform,a=r(55),o=r(29),s=r(30).ok,l=r(1).kMaxLength,f="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var u=Object.keys(a),h=0;h<u.length;h++){var d=u[h];d.match(/^Z/)&&Object.defineProperty(t,d,{enumerable:!0,value:a[d],writable:!1});}for(var c={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(c),g=0;g<p.length;g++){var m=p[g];c[c[m]]=m;}function _(e,t,r){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o);}function s(){var t,o=null;a>=l?o=new RangeError(f):t=n.concat(i,a),i=[],e.close(),r(o,t);}e.on("error",function(t){e.removeListener("end",s),e.removeListener("readable",o),r(t);}),e.on("end",s),e.end(t),o();}function y(e,t){if("string"==typeof t&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Not a string or buffer");var r=e._finishFlushFlag;return e._processChunk(t,r)}function b(e){if(!(this instanceof b))return new b(e);P.call(this,e,a.DEFLATE);}function v(e){if(!(this instanceof v))return new v(e);P.call(this,e,a.INFLATE);}function w(e){if(!(this instanceof w))return new w(e);P.call(this,e,a.GZIP);}function E(e){if(!(this instanceof E))return new E(e);P.call(this,e,a.GUNZIP);}function x(e){if(!(this instanceof x))return new x(e);P.call(this,e,a.DEFLATERAW);}function S(e){if(!(this instanceof S))return new S(e);P.call(this,e,a.INFLATERAW);}function k(e){if(!(this instanceof k))return new k(e);P.call(this,e,a.UNZIP);}function A(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function P(e,r){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!A(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!A(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!n.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(r);var s=this;this._hadError=!1,this._handle.onerror=function(e,r){T(s),s._hadError=!0;var n=new Error(e);n.errno=r,n.code=t.codes[r],s.emit("error",n);};var l=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(l=e.level);var f=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(f=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,l,e.memLevel||t.Z_DEFAULT_MEMLEVEL,f,e.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=f,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return !o._handle},configurable:!0,enumerable:!0});}function T(t,r){r&&e.nextTick(r),t._handle&&(t._handle.close(),t._handle=null);}function D(e){e.emit("close");}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(c),writable:!1}),t.Deflate=b,t.Inflate=v,t.Gzip=w,t.Gunzip=E,t.DeflateRaw=x,t.InflateRaw=S,t.Unzip=k,t.createDeflate=function(e){return new b(e)},t.createInflate=function(e){return new v(e)},t.createDeflateRaw=function(e){return new x(e)},t.createInflateRaw=function(e){return new S(e)},t.createGzip=function(e){return new w(e)},t.createGunzip=function(e){return new E(e)},t.createUnzip=function(e){return new k(e)},t.deflate=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new b(t),e,r)},t.deflateSync=function(e,t){return y(new b(t),e)},t.gzip=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new w(t),e,r)},t.gzipSync=function(e,t){return y(new w(t),e)},t.deflateRaw=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new x(t),e,r)},t.deflateRawSync=function(e,t){return y(new x(t),e)},t.unzip=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new k(t),e,r)},t.unzipSync=function(e,t){return y(new k(t),e)},t.inflate=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new v(t),e,r)},t.inflateSync=function(e,t){return y(new v(t),e)},t.gunzip=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new E(t),e,r)},t.gunzipSync=function(e,t){return y(new E(t),e)},t.inflateRaw=function(e,t,r){return "function"==typeof t&&(r=t,t={}),_(new S(t),e,r)},t.inflateRawSync=function(e,t){return y(new S(t),e)},o.inherits(P,i),P.prototype.params=function(r,n,i){if(r<t.Z_MIN_LEVEL||r>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+r);if(n!=t.Z_FILTERED&&n!=t.Z_HUFFMAN_ONLY&&n!=t.Z_RLE&&n!=t.Z_FIXED&&n!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==r||this._strategy!==n){var o=this;this.flush(a.Z_SYNC_FLUSH,function(){s(o._handle,"zlib binding closed"),o._handle.params(r,n),o._hadError||(o._level=r,o._strategy=n,i&&i());});}else e.nextTick(i);},P.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},P.prototype._flush=function(e){this._transform(n.alloc(0),"",e);},P.prototype.flush=function(t,r){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!r)&&(r=t,t=a.Z_FULL_FLUSH),o.ended?r&&e.nextTick(r):o.ending?r&&this.once("end",r):o.needDrain?r&&this.once("drain",function(){return i.flush(t,r)}):(this._flushFlag=t,this.write(n.alloc(0),"",r));},P.prototype.close=function(t){T(this,t),e.nextTick(D,this);},P.prototype._transform=function(e,t,r){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||n.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},P.prototype._processChunk=function(e,t,r){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,u=this,h="function"==typeof r;if(!h){var d,c=[],p=0;this.on("error",function(e){d=e;}),s(this._handle,"zlib binding closed");do{var g=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a);}while(!this._hadError&&y(g[0],g[1]));if(this._hadError)throw d;if(p>=l)throw T(this),new RangeError(f);var m=n.concat(c,p);return T(this),m}s(this._handle,"zlib binding closed");var _=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(l,f){if(this&&(this.buffer=null,this.callback=null),!u._hadError){var d=a-f;if(s(d>=0,"have should not go down"),d>0){var g=u._buffer.slice(u._offset,u._offset+d);u._offset+=d,h?u.push(g):(c.push(g),p+=g.length);}if((0===f||u._offset>=u._chunkSize)&&(a=u._chunkSize,u._offset=0,u._buffer=n.allocUnsafe(u._chunkSize)),0===f){if(o+=i-l,i=l,!h)return !0;var m=u._handle.write(t,e,o,i,u._buffer,u._offset,u._chunkSize);return m.callback=y,void(m.buffer=e)}if(!h)return !1;r();}}_.buffer=e,_.callback=y;},o.inherits(b,P),o.inherits(v,P),o.inherits(w,P),o.inherits(E,P),o.inherits(x,P),o.inherits(S,P),o.inherits(k,P);}).call(this,r(3));},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e};},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,d){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";function c(l){var c=function(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var r=e.elements.x00020010;return u.readFixedString(t,r.dataOffset,r.length)}(l),p=function(e){if("1.2.840.10008.1.2"===e)return !1;return !0}(c),g=function(o,l){if("1.2.840.10008.1.2.1.99"===o){if(d&&d.inflater){var u=d.inflater(t,l);return new a.default(s.default,u,0)}if(void 0!==e&&this.module!==e){var h=r(68),c=(0, f.default)(t,l,t.length-l),p=h.inflateRawSync(c),g=(0, n.default)(t,p.length+l);return t.copy(g,0,0,l),p.copy(g,l),new a.default(s.default,g,0)}if("undefined"!=typeof pako){var m=t.slice(l),_=pako.inflateRaw(m),y=(0, n.default)(t,_.length+l);return y.set(t.slice(0,l),0),y.set(_,l),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}if("1.2.840.10008.1.2.2"===o)return new a.default(i.default,t,l);return new a.default(s.default,t,l)}(c,l.position),m=new o.default(g.byteArrayParser,g.byteArray,{});m.warnings=g.warnings;try{p?h.parseDicomDataSetExplicit(m,g,g.byteArray.length,d):h.parseDicomDataSetImplicit(m,g,g.byteArray.length,d);}catch(e){var _={exception:e,dataSet:m};throw _}return m}return p=(0, l.default)(t,d),g=c(p),function(e,t){for(var r in e.elements)e.elements.hasOwnProperty(r)&&(t.elements[r]=e.elements[r]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(p,g);var p,g;};var n=c(r(22)),i=c(r(37)),a=c(r(12)),o=c(r(7)),s=c(r(21)),l=c(r(36)),f=c(r(11)),u=d(r(14)),h=d(r(16));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}}).call(this,r(69)(e));},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.8.2";},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,f=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,c=e[t+h];for(h+=d,a=c&(1<<-u)-1,c>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===a)a=1-f;else{if(a===l)return o?NaN:1/0*(c?-1:1);o+=Math.pow(2,n),a-=f;}return (c?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,f=8*a-i-1,u=(1<<f)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,c=n?0:a-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+c]=255&s,c+=p,s/=256,i-=8);for(o=o<<i|s,f+=i;f>0;e[r+c]=255&o,c+=p,o/=256,f-=8);e[r+c-p]|=128*g;};},function(e,t,r){t.byteLength=function(e){return 3*e.length/4-f(e)},t.toByteArray=function(e){var t,r,n,o,s,l=e.length;o=f(e),s=new a(3*l/4-o),r=o>0?l-4:l;var u=0;for(t=0;t<r;t+=4)n=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[u++]=n>>16&255,s[u++]=n>>8&255,s[u++]=255&n;2===o?(n=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[u++]=255&n):1===o&&(n=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[u++]=n>>8&255,s[u++]=255&n);return s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a="",o=[],s=0,l=r-i;s<l;s+=16383)o.push(u(e,s,s+16383>l?l:s+16383));1===i?(t=e[r-1],a+=n[t>>2],a+=n[t<<4&63],a+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],a+=n[t>>10],a+=n[t>>4&63],a+=n[t<<2&63],a+="=");return o.push(a),o.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function f(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return "="===e[t-2]?2:"="===e[t-1]?1:0}function u(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63;},function(e,t,r){function n(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,r){var i=t.fragments[r];return !(!n(e,i.position+i.length-2)&&!n(e,i.position+i.length-3))}function a(e,t,r){for(var n=r;n<t.fragments.length;n++)if(i(e,t,n))return n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r&&r.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";r=r||t.fragments;var n=[],i=0;for(;;){n.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return n;i=o+1;}};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";r=r||{omitPrivateAttibutes:!0,maxElementLength:128};var n={};for(var i in t.elements){var s=t.elements[i];if(!0!==r.omitPrivateAttibutes||!o.isPrivateTag(i))if(s.items){for(var l=[],f=0;f<s.items.length;f++)l.push(e(s.items[f].dataSet,r));n[i]=l;}else{var u;u=void 0,s.length<r.maxElementLength&&(u=(0, a.default)(t,s)),n[i]=void 0!==u?u:{dataOffset:s.dataOffset,length:s.length};}}return n};var n,i=r(43),a=(n=i)&&n.__esModule?n:{default:n},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(25));},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var r=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);if(t&&!0!==function(e,t,r){if(isNaN(r))return !1;return t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,r)}(i,n,r))throw"invalid DA '"+e+"'";return {year:r,month:n,day:i}}if(t)throw"invalid DA '"+e+"'";return};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var r=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?parseInt(e.substring(7,13),10):void 0;if(t&&(isNaN(r)||void 0!==n&&isNaN(n)||void 0!==i&&isNaN(i)||void 0!==a&&isNaN(a)||r<0||r>23||n&&(n<0||n>59)||i&&(i<0||i>59)||a&&(a<0||a>999999)))throw"invalid TM '"+e+"'";return {hours:r,minutes:n,seconds:i,fractionalSeconds:a}}if(t)throw"invalid TM '"+e+"'";return};},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var n=r(25),i=f(r(77)),a=f(r(76)),o=f(r(43)),s=f(r(75)),l=f(r(74));function f(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=n.isStringVr,t.isPrivateTag=n.isPrivateTag,t.parsePN=n.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=l.default;},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var n=r(78),i=r(16),a=r(14),o=P(r(22)),s=P(r(71)),l=P(r(37)),f=P(r(12)),u=P(r(11)),h=P(r(7)),d=P(r(41)),c=P(r(42)),p=P(r(24)),g=P(r(21)),m=P(r(70)),_=P(r(15)),y=P(r(23)),b=P(r(26)),v=P(r(44)),w=P(r(17)),E=P(r(36)),x=P(r(40)),S=P(r(39)),k=P(r(13)),A=P(r(4));function P(e){return e&&e.__esModule?e:{default:e}}var T={isStringVr:n.isStringVr,isPrivateTag:n.isPrivateTag,parsePN:n.parsePN,parseTM:n.parseTM,parseDA:n.parseDA,explicitElementToString:n.explicitElementToString,explicitDataSetToJS:n.explicitDataSetToJS,createJPEGBasicOffsetTable:n.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:l.default,ByteStream:f.default,sharedCopy:u.default,DataSet:h.default,findAndSetUNElementLength:d.default,findEndOfEncapsulatedElement:c.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:g.default,parseDicom:m.default,readDicomElementExplicit:_.default,readDicomElementImplicit:y.default,readEncapsulatedImageFrame:b.default,readEncapsulatedPixelData:v.default,readEncapsulatedPixelDataFromFragments:w.default,readPart10Header:E.default,readSequenceItemsExplicit:x.default,readSequenceItemsImplicit:S.default,readSequenceItem:k.default,readTag:A.default};t.isStringVr=n.isStringVr,t.isPrivateTag=n.isPrivateTag,t.parsePN=n.parsePN,t.parseTM=n.parseTM,t.parseDA=n.parseDA,t.explicitElementToString=n.explicitElementToString,t.explicitDataSetToJS=n.explicitDataSetToJS,t.createJPEGBasicOffsetTable=n.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=l.default,t.ByteStream=f.default,t.sharedCopy=u.default,t.DataSet=h.default,t.findAndSetUNElementLength=d.default,t.findEndOfEncapsulatedElement=c.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=g.default,t.parseDicom=m.default,t.readDicomElementExplicit=_.default,t.readDicomElementImplicit=y.default,t.readEncapsulatedImageFrame=b.default,t.readEncapsulatedPixelData=v.default,t.readEncapsulatedPixelDataFromFragments=w.default,t.readPart10Header=E.default,t.readSequenceItemsExplicit=x.default,t.readSequenceItemsImplicit=S.default,t.readSequenceItem=k.default,t.readTag=A.default,t.default=T;}])});

  });

  var dicomParser = unwrapExports(dicomParser_min);

  var cornerstone$2 = createCommonjsModule(function (module, exports) {
  /*! cornerstone-core - 2.2.8 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */
  (function webpackUniversalModuleDefinition(root, factory) {
  	module.exports = factory();
  })(window, function() {
  return /******/ (function(modules) { // webpackBootstrap
  /******/ 	function hotDisposeChunk(chunkId) {
  /******/ 		delete installedChunks[chunkId];
  /******/ 	}
  /******/ 	var parentHotUpdateCallback = window["webpackHotUpdate"];
  /******/ 	window["webpackHotUpdate"] = // eslint-disable-next-line no-unused-vars
  /******/ 	function webpackHotUpdateCallback(chunkId, moreModules) {
  /******/ 		hotAddUpdateChunk(chunkId, moreModules);
  /******/ 		if (parentHotUpdateCallback) parentHotUpdateCallback(chunkId, moreModules);
  /******/ 	} ;
  /******/
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	function hotDownloadUpdateChunk(chunkId) {
  /******/ 		var head = document.getElementsByTagName("head")[0];
  /******/ 		var script = document.createElement("script");
  /******/ 		script.charset = "utf-8";
  /******/ 		script.src = __webpack_require__.p + "" + chunkId + "." + hotCurrentHash + ".hot-update.js";
  /******/ 		head.appendChild(script);
  /******/ 	}
  /******/
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	function hotDownloadManifest(requestTimeout) {
  /******/ 		requestTimeout = requestTimeout || 10000;
  /******/ 		return new Promise(function(resolve, reject) {
  /******/ 			if (typeof XMLHttpRequest === "undefined") {
  /******/ 				return reject(new Error("No browser support"));
  /******/ 			}
  /******/ 			try {
  /******/ 				var request = new XMLHttpRequest();
  /******/ 				var requestPath = __webpack_require__.p + "" + hotCurrentHash + ".hot-update.json";
  /******/ 				request.open("GET", requestPath, true);
  /******/ 				request.timeout = requestTimeout;
  /******/ 				request.send(null);
  /******/ 			} catch (err) {
  /******/ 				return reject(err);
  /******/ 			}
  /******/ 			request.onreadystatechange = function() {
  /******/ 				if (request.readyState !== 4) return;
  /******/ 				if (request.status === 0) {
  /******/ 					// timeout
  /******/ 					reject(
  /******/ 						new Error("Manifest request to " + requestPath + " timed out.")
  /******/ 					);
  /******/ 				} else if (request.status === 404) {
  /******/ 					// no update available
  /******/ 					resolve();
  /******/ 				} else if (request.status !== 200 && request.status !== 304) {
  /******/ 					// other failure
  /******/ 					reject(new Error("Manifest request to " + requestPath + " failed."));
  /******/ 				} else {
  /******/ 					// success
  /******/ 					try {
  /******/ 						var update = JSON.parse(request.responseText);
  /******/ 					} catch (e) {
  /******/ 						reject(e);
  /******/ 						return;
  /******/ 					}
  /******/ 					resolve(update);
  /******/ 				}
  /******/ 			};
  /******/ 		});
  /******/ 	}
  /******/
  /******/ 	var hotApplyOnUpdate = true;
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	var hotCurrentHash = "72ed982d5a0046aad5fa";
  /******/ 	var hotRequestTimeout = 10000;
  /******/ 	var hotCurrentModuleData = {};
  /******/ 	var hotCurrentChildModule;
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	var hotCurrentParents = [];
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	var hotCurrentParentsTemp = [];
  /******/
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	function hotCreateRequire(moduleId) {
  /******/ 		var me = installedModules[moduleId];
  /******/ 		if (!me) return __webpack_require__;
  /******/ 		var fn = function(request) {
  /******/ 			if (me.hot.active) {
  /******/ 				if (installedModules[request]) {
  /******/ 					if (installedModules[request].parents.indexOf(moduleId) === -1) {
  /******/ 						installedModules[request].parents.push(moduleId);
  /******/ 					}
  /******/ 				} else {
  /******/ 					hotCurrentParents = [moduleId];
  /******/ 					hotCurrentChildModule = request;
  /******/ 				}
  /******/ 				if (me.children.indexOf(request) === -1) {
  /******/ 					me.children.push(request);
  /******/ 				}
  /******/ 			} else {
  /******/ 				console.warn(
  /******/ 					"[HMR] unexpected require(" +
  /******/ 						request +
  /******/ 						") from disposed module " +
  /******/ 						moduleId
  /******/ 				);
  /******/ 				hotCurrentParents = [];
  /******/ 			}
  /******/ 			return __webpack_require__(request);
  /******/ 		};
  /******/ 		var ObjectFactory = function ObjectFactory(name) {
  /******/ 			return {
  /******/ 				configurable: true,
  /******/ 				enumerable: true,
  /******/ 				get: function() {
  /******/ 					return __webpack_require__[name];
  /******/ 				},
  /******/ 				set: function(value) {
  /******/ 					__webpack_require__[name] = value;
  /******/ 				}
  /******/ 			};
  /******/ 		};
  /******/ 		for (var name in __webpack_require__) {
  /******/ 			if (
  /******/ 				Object.prototype.hasOwnProperty.call(__webpack_require__, name) &&
  /******/ 				name !== "e" &&
  /******/ 				name !== "t"
  /******/ 			) {
  /******/ 				Object.defineProperty(fn, name, ObjectFactory(name));
  /******/ 			}
  /******/ 		}
  /******/ 		fn.e = function(chunkId) {
  /******/ 			if (hotStatus === "ready") hotSetStatus("prepare");
  /******/ 			hotChunksLoading++;
  /******/ 			return __webpack_require__.e(chunkId).then(finishChunkLoading, function(err) {
  /******/ 				finishChunkLoading();
  /******/ 				throw err;
  /******/ 			});
  /******/
  /******/ 			function finishChunkLoading() {
  /******/ 				hotChunksLoading--;
  /******/ 				if (hotStatus === "prepare") {
  /******/ 					if (!hotWaitingFilesMap[chunkId]) {
  /******/ 						hotEnsureUpdateChunk(chunkId);
  /******/ 					}
  /******/ 					if (hotChunksLoading === 0 && hotWaitingFiles === 0) {
  /******/ 						hotUpdateDownloaded();
  /******/ 					}
  /******/ 				}
  /******/ 			}
  /******/ 		};
  /******/ 		fn.t = function(value, mode) {
  /******/ 			if (mode & 1) value = fn(value);
  /******/ 			return __webpack_require__.t(value, mode & ~1);
  /******/ 		};
  /******/ 		return fn;
  /******/ 	}
  /******/
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	function hotCreateModule(moduleId) {
  /******/ 		var hot = {
  /******/ 			// private stuff
  /******/ 			_acceptedDependencies: {},
  /******/ 			_declinedDependencies: {},
  /******/ 			_selfAccepted: false,
  /******/ 			_selfDeclined: false,
  /******/ 			_disposeHandlers: [],
  /******/ 			_main: hotCurrentChildModule !== moduleId,
  /******/
  /******/ 			// Module API
  /******/ 			active: true,
  /******/ 			accept: function(dep, callback) {
  /******/ 				if (dep === undefined) hot._selfAccepted = true;
  /******/ 				else if (typeof dep === "function") hot._selfAccepted = dep;
  /******/ 				else if (typeof dep === "object")
  /******/ 					for (var i = 0; i < dep.length; i++)
  /******/ 						hot._acceptedDependencies[dep[i]] = callback || function() {};
  /******/ 				else hot._acceptedDependencies[dep] = callback || function() {};
  /******/ 			},
  /******/ 			decline: function(dep) {
  /******/ 				if (dep === undefined) hot._selfDeclined = true;
  /******/ 				else if (typeof dep === "object")
  /******/ 					for (var i = 0; i < dep.length; i++)
  /******/ 						hot._declinedDependencies[dep[i]] = true;
  /******/ 				else hot._declinedDependencies[dep] = true;
  /******/ 			},
  /******/ 			dispose: function(callback) {
  /******/ 				hot._disposeHandlers.push(callback);
  /******/ 			},
  /******/ 			addDisposeHandler: function(callback) {
  /******/ 				hot._disposeHandlers.push(callback);
  /******/ 			},
  /******/ 			removeDisposeHandler: function(callback) {
  /******/ 				var idx = hot._disposeHandlers.indexOf(callback);
  /******/ 				if (idx >= 0) hot._disposeHandlers.splice(idx, 1);
  /******/ 			},
  /******/
  /******/ 			// Management API
  /******/ 			check: hotCheck,
  /******/ 			apply: hotApply,
  /******/ 			status: function(l) {
  /******/ 				if (!l) return hotStatus;
  /******/ 				hotStatusHandlers.push(l);
  /******/ 			},
  /******/ 			addStatusHandler: function(l) {
  /******/ 				hotStatusHandlers.push(l);
  /******/ 			},
  /******/ 			removeStatusHandler: function(l) {
  /******/ 				var idx = hotStatusHandlers.indexOf(l);
  /******/ 				if (idx >= 0) hotStatusHandlers.splice(idx, 1);
  /******/ 			},
  /******/
  /******/ 			//inherit from previous dispose call
  /******/ 			data: hotCurrentModuleData[moduleId]
  /******/ 		};
  /******/ 		hotCurrentChildModule = undefined;
  /******/ 		return hot;
  /******/ 	}
  /******/
  /******/ 	var hotStatusHandlers = [];
  /******/ 	var hotStatus = "idle";
  /******/
  /******/ 	function hotSetStatus(newStatus) {
  /******/ 		hotStatus = newStatus;
  /******/ 		for (var i = 0; i < hotStatusHandlers.length; i++)
  /******/ 			hotStatusHandlers[i].call(null, newStatus);
  /******/ 	}
  /******/
  /******/ 	// while downloading
  /******/ 	var hotWaitingFiles = 0;
  /******/ 	var hotChunksLoading = 0;
  /******/ 	var hotWaitingFilesMap = {};
  /******/ 	var hotRequestedFilesMap = {};
  /******/ 	var hotAvailableFilesMap = {};
  /******/ 	var hotDeferred;
  /******/
  /******/ 	// The update info
  /******/ 	var hotUpdate, hotUpdateNewHash;
  /******/
  /******/ 	function toModuleId(id) {
  /******/ 		var isNumber = +id + "" === id;
  /******/ 		return isNumber ? +id : id;
  /******/ 	}
  /******/
  /******/ 	function hotCheck(apply) {
  /******/ 		if (hotStatus !== "idle") {
  /******/ 			throw new Error("check() is only allowed in idle status");
  /******/ 		}
  /******/ 		hotApplyOnUpdate = apply;
  /******/ 		hotSetStatus("check");
  /******/ 		return hotDownloadManifest(hotRequestTimeout).then(function(update) {
  /******/ 			if (!update) {
  /******/ 				hotSetStatus("idle");
  /******/ 				return null;
  /******/ 			}
  /******/ 			hotRequestedFilesMap = {};
  /******/ 			hotWaitingFilesMap = {};
  /******/ 			hotAvailableFilesMap = update.c;
  /******/ 			hotUpdateNewHash = update.h;
  /******/
  /******/ 			hotSetStatus("prepare");
  /******/ 			var promise = new Promise(function(resolve, reject) {
  /******/ 				hotDeferred = {
  /******/ 					resolve: resolve,
  /******/ 					reject: reject
  /******/ 				};
  /******/ 			});
  /******/ 			hotUpdate = {};
  /******/ 			var chunkId = "cornerstone";
  /******/ 			// eslint-disable-next-line no-lone-blocks
  /******/ 			{
  /******/ 				/*globals chunkId */
  /******/ 				hotEnsureUpdateChunk(chunkId);
  /******/ 			}
  /******/ 			if (
  /******/ 				hotStatus === "prepare" &&
  /******/ 				hotChunksLoading === 0 &&
  /******/ 				hotWaitingFiles === 0
  /******/ 			) {
  /******/ 				hotUpdateDownloaded();
  /******/ 			}
  /******/ 			return promise;
  /******/ 		});
  /******/ 	}
  /******/
  /******/ 	// eslint-disable-next-line no-unused-vars
  /******/ 	function hotAddUpdateChunk(chunkId, moreModules) {
  /******/ 		if (!hotAvailableFilesMap[chunkId] || !hotRequestedFilesMap[chunkId])
  /******/ 			return;
  /******/ 		hotRequestedFilesMap[chunkId] = false;
  /******/ 		for (var moduleId in moreModules) {
  /******/ 			if (Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {
  /******/ 				hotUpdate[moduleId] = moreModules[moduleId];
  /******/ 			}
  /******/ 		}
  /******/ 		if (--hotWaitingFiles === 0 && hotChunksLoading === 0) {
  /******/ 			hotUpdateDownloaded();
  /******/ 		}
  /******/ 	}
  /******/
  /******/ 	function hotEnsureUpdateChunk(chunkId) {
  /******/ 		if (!hotAvailableFilesMap[chunkId]) {
  /******/ 			hotWaitingFilesMap[chunkId] = true;
  /******/ 		} else {
  /******/ 			hotRequestedFilesMap[chunkId] = true;
  /******/ 			hotWaitingFiles++;
  /******/ 			hotDownloadUpdateChunk(chunkId);
  /******/ 		}
  /******/ 	}
  /******/
  /******/ 	function hotUpdateDownloaded() {
  /******/ 		hotSetStatus("ready");
  /******/ 		var deferred = hotDeferred;
  /******/ 		hotDeferred = null;
  /******/ 		if (!deferred) return;
  /******/ 		if (hotApplyOnUpdate) {
  /******/ 			// Wrap deferred object in Promise to mark it as a well-handled Promise to
  /******/ 			// avoid triggering uncaught exception warning in Chrome.
  /******/ 			// See https://bugs.chromium.org/p/chromium/issues/detail?id=465666
  /******/ 			Promise.resolve()
  /******/ 				.then(function() {
  /******/ 					return hotApply(hotApplyOnUpdate);
  /******/ 				})
  /******/ 				.then(
  /******/ 					function(result) {
  /******/ 						deferred.resolve(result);
  /******/ 					},
  /******/ 					function(err) {
  /******/ 						deferred.reject(err);
  /******/ 					}
  /******/ 				);
  /******/ 		} else {
  /******/ 			var outdatedModules = [];
  /******/ 			for (var id in hotUpdate) {
  /******/ 				if (Object.prototype.hasOwnProperty.call(hotUpdate, id)) {
  /******/ 					outdatedModules.push(toModuleId(id));
  /******/ 				}
  /******/ 			}
  /******/ 			deferred.resolve(outdatedModules);
  /******/ 		}
  /******/ 	}
  /******/
  /******/ 	function hotApply(options) {
  /******/ 		if (hotStatus !== "ready")
  /******/ 			throw new Error("apply() is only allowed in ready status");
  /******/ 		options = options || {};
  /******/
  /******/ 		var cb;
  /******/ 		var i;
  /******/ 		var j;
  /******/ 		var module;
  /******/ 		var moduleId;
  /******/
  /******/ 		function getAffectedStuff(updateModuleId) {
  /******/ 			var outdatedModules = [updateModuleId];
  /******/ 			var outdatedDependencies = {};
  /******/
  /******/ 			var queue = outdatedModules.slice().map(function(id) {
  /******/ 				return {
  /******/ 					chain: [id],
  /******/ 					id: id
  /******/ 				};
  /******/ 			});
  /******/ 			while (queue.length > 0) {
  /******/ 				var queueItem = queue.pop();
  /******/ 				var moduleId = queueItem.id;
  /******/ 				var chain = queueItem.chain;
  /******/ 				module = installedModules[moduleId];
  /******/ 				if (!module || module.hot._selfAccepted) continue;
  /******/ 				if (module.hot._selfDeclined) {
  /******/ 					return {
  /******/ 						type: "self-declined",
  /******/ 						chain: chain,
  /******/ 						moduleId: moduleId
  /******/ 					};
  /******/ 				}
  /******/ 				if (module.hot._main) {
  /******/ 					return {
  /******/ 						type: "unaccepted",
  /******/ 						chain: chain,
  /******/ 						moduleId: moduleId
  /******/ 					};
  /******/ 				}
  /******/ 				for (var i = 0; i < module.parents.length; i++) {
  /******/ 					var parentId = module.parents[i];
  /******/ 					var parent = installedModules[parentId];
  /******/ 					if (!parent) continue;
  /******/ 					if (parent.hot._declinedDependencies[moduleId]) {
  /******/ 						return {
  /******/ 							type: "declined",
  /******/ 							chain: chain.concat([parentId]),
  /******/ 							moduleId: moduleId,
  /******/ 							parentId: parentId
  /******/ 						};
  /******/ 					}
  /******/ 					if (outdatedModules.indexOf(parentId) !== -1) continue;
  /******/ 					if (parent.hot._acceptedDependencies[moduleId]) {
  /******/ 						if (!outdatedDependencies[parentId])
  /******/ 							outdatedDependencies[parentId] = [];
  /******/ 						addAllToSet(outdatedDependencies[parentId], [moduleId]);
  /******/ 						continue;
  /******/ 					}
  /******/ 					delete outdatedDependencies[parentId];
  /******/ 					outdatedModules.push(parentId);
  /******/ 					queue.push({
  /******/ 						chain: chain.concat([parentId]),
  /******/ 						id: parentId
  /******/ 					});
  /******/ 				}
  /******/ 			}
  /******/
  /******/ 			return {
  /******/ 				type: "accepted",
  /******/ 				moduleId: updateModuleId,
  /******/ 				outdatedModules: outdatedModules,
  /******/ 				outdatedDependencies: outdatedDependencies
  /******/ 			};
  /******/ 		}
  /******/
  /******/ 		function addAllToSet(a, b) {
  /******/ 			for (var i = 0; i < b.length; i++) {
  /******/ 				var item = b[i];
  /******/ 				if (a.indexOf(item) === -1) a.push(item);
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// at begin all updates modules are outdated
  /******/ 		// the "outdated" status can propagate to parents if they don't accept the children
  /******/ 		var outdatedDependencies = {};
  /******/ 		var outdatedModules = [];
  /******/ 		var appliedUpdate = {};
  /******/
  /******/ 		var warnUnexpectedRequire = function warnUnexpectedRequire() {
  /******/ 			console.warn(
  /******/ 				"[HMR] unexpected require(" + result.moduleId + ") to disposed module"
  /******/ 			);
  /******/ 		};
  /******/
  /******/ 		for (var id in hotUpdate) {
  /******/ 			if (Object.prototype.hasOwnProperty.call(hotUpdate, id)) {
  /******/ 				moduleId = toModuleId(id);
  /******/ 				/** @type {TODO} */
  /******/ 				var result;
  /******/ 				if (hotUpdate[id]) {
  /******/ 					result = getAffectedStuff(moduleId);
  /******/ 				} else {
  /******/ 					result = {
  /******/ 						type: "disposed",
  /******/ 						moduleId: id
  /******/ 					};
  /******/ 				}
  /******/ 				/** @type {Error|false} */
  /******/ 				var abortError = false;
  /******/ 				var doApply = false;
  /******/ 				var doDispose = false;
  /******/ 				var chainInfo = "";
  /******/ 				if (result.chain) {
  /******/ 					chainInfo = "\nUpdate propagation: " + result.chain.join(" -> ");
  /******/ 				}
  /******/ 				switch (result.type) {
  /******/ 					case "self-declined":
  /******/ 						if (options.onDeclined) options.onDeclined(result);
  /******/ 						if (!options.ignoreDeclined)
  /******/ 							abortError = new Error(
  /******/ 								"Aborted because of self decline: " +
  /******/ 									result.moduleId +
  /******/ 									chainInfo
  /******/ 							);
  /******/ 						break;
  /******/ 					case "declined":
  /******/ 						if (options.onDeclined) options.onDeclined(result);
  /******/ 						if (!options.ignoreDeclined)
  /******/ 							abortError = new Error(
  /******/ 								"Aborted because of declined dependency: " +
  /******/ 									result.moduleId +
  /******/ 									" in " +
  /******/ 									result.parentId +
  /******/ 									chainInfo
  /******/ 							);
  /******/ 						break;
  /******/ 					case "unaccepted":
  /******/ 						if (options.onUnaccepted) options.onUnaccepted(result);
  /******/ 						if (!options.ignoreUnaccepted)
  /******/ 							abortError = new Error(
  /******/ 								"Aborted because " + moduleId + " is not accepted" + chainInfo
  /******/ 							);
  /******/ 						break;
  /******/ 					case "accepted":
  /******/ 						if (options.onAccepted) options.onAccepted(result);
  /******/ 						doApply = true;
  /******/ 						break;
  /******/ 					case "disposed":
  /******/ 						if (options.onDisposed) options.onDisposed(result);
  /******/ 						doDispose = true;
  /******/ 						break;
  /******/ 					default:
  /******/ 						throw new Error("Unexception type " + result.type);
  /******/ 				}
  /******/ 				if (abortError) {
  /******/ 					hotSetStatus("abort");
  /******/ 					return Promise.reject(abortError);
  /******/ 				}
  /******/ 				if (doApply) {
  /******/ 					appliedUpdate[moduleId] = hotUpdate[moduleId];
  /******/ 					addAllToSet(outdatedModules, result.outdatedModules);
  /******/ 					for (moduleId in result.outdatedDependencies) {
  /******/ 						if (
  /******/ 							Object.prototype.hasOwnProperty.call(
  /******/ 								result.outdatedDependencies,
  /******/ 								moduleId
  /******/ 							)
  /******/ 						) {
  /******/ 							if (!outdatedDependencies[moduleId])
  /******/ 								outdatedDependencies[moduleId] = [];
  /******/ 							addAllToSet(
  /******/ 								outdatedDependencies[moduleId],
  /******/ 								result.outdatedDependencies[moduleId]
  /******/ 							);
  /******/ 						}
  /******/ 					}
  /******/ 				}
  /******/ 				if (doDispose) {
  /******/ 					addAllToSet(outdatedModules, [result.moduleId]);
  /******/ 					appliedUpdate[moduleId] = warnUnexpectedRequire;
  /******/ 				}
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// Store self accepted outdated modules to require them later by the module system
  /******/ 		var outdatedSelfAcceptedModules = [];
  /******/ 		for (i = 0; i < outdatedModules.length; i++) {
  /******/ 			moduleId = outdatedModules[i];
  /******/ 			if (
  /******/ 				installedModules[moduleId] &&
  /******/ 				installedModules[moduleId].hot._selfAccepted
  /******/ 			)
  /******/ 				outdatedSelfAcceptedModules.push({
  /******/ 					module: moduleId,
  /******/ 					errorHandler: installedModules[moduleId].hot._selfAccepted
  /******/ 				});
  /******/ 		}
  /******/
  /******/ 		// Now in "dispose" phase
  /******/ 		hotSetStatus("dispose");
  /******/ 		Object.keys(hotAvailableFilesMap).forEach(function(chunkId) {
  /******/ 			if (hotAvailableFilesMap[chunkId] === false) {
  /******/ 				hotDisposeChunk(chunkId);
  /******/ 			}
  /******/ 		});
  /******/
  /******/ 		var idx;
  /******/ 		var queue = outdatedModules.slice();
  /******/ 		while (queue.length > 0) {
  /******/ 			moduleId = queue.pop();
  /******/ 			module = installedModules[moduleId];
  /******/ 			if (!module) continue;
  /******/
  /******/ 			var data = {};
  /******/
  /******/ 			// Call dispose handlers
  /******/ 			var disposeHandlers = module.hot._disposeHandlers;
  /******/ 			for (j = 0; j < disposeHandlers.length; j++) {
  /******/ 				cb = disposeHandlers[j];
  /******/ 				cb(data);
  /******/ 			}
  /******/ 			hotCurrentModuleData[moduleId] = data;
  /******/
  /******/ 			// disable module (this disables requires from this module)
  /******/ 			module.hot.active = false;
  /******/
  /******/ 			// remove module from cache
  /******/ 			delete installedModules[moduleId];
  /******/
  /******/ 			// when disposing there is no need to call dispose handler
  /******/ 			delete outdatedDependencies[moduleId];
  /******/
  /******/ 			// remove "parents" references from all children
  /******/ 			for (j = 0; j < module.children.length; j++) {
  /******/ 				var child = installedModules[module.children[j]];
  /******/ 				if (!child) continue;
  /******/ 				idx = child.parents.indexOf(moduleId);
  /******/ 				if (idx >= 0) {
  /******/ 					child.parents.splice(idx, 1);
  /******/ 				}
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// remove outdated dependency from module children
  /******/ 		var dependency;
  /******/ 		var moduleOutdatedDependencies;
  /******/ 		for (moduleId in outdatedDependencies) {
  /******/ 			if (
  /******/ 				Object.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)
  /******/ 			) {
  /******/ 				module = installedModules[moduleId];
  /******/ 				if (module) {
  /******/ 					moduleOutdatedDependencies = outdatedDependencies[moduleId];
  /******/ 					for (j = 0; j < moduleOutdatedDependencies.length; j++) {
  /******/ 						dependency = moduleOutdatedDependencies[j];
  /******/ 						idx = module.children.indexOf(dependency);
  /******/ 						if (idx >= 0) module.children.splice(idx, 1);
  /******/ 					}
  /******/ 				}
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// Not in "apply" phase
  /******/ 		hotSetStatus("apply");
  /******/
  /******/ 		hotCurrentHash = hotUpdateNewHash;
  /******/
  /******/ 		// insert new code
  /******/ 		for (moduleId in appliedUpdate) {
  /******/ 			if (Object.prototype.hasOwnProperty.call(appliedUpdate, moduleId)) {
  /******/ 				modules[moduleId] = appliedUpdate[moduleId];
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// call accept handlers
  /******/ 		var error = null;
  /******/ 		for (moduleId in outdatedDependencies) {
  /******/ 			if (
  /******/ 				Object.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)
  /******/ 			) {
  /******/ 				module = installedModules[moduleId];
  /******/ 				if (module) {
  /******/ 					moduleOutdatedDependencies = outdatedDependencies[moduleId];
  /******/ 					var callbacks = [];
  /******/ 					for (i = 0; i < moduleOutdatedDependencies.length; i++) {
  /******/ 						dependency = moduleOutdatedDependencies[i];
  /******/ 						cb = module.hot._acceptedDependencies[dependency];
  /******/ 						if (cb) {
  /******/ 							if (callbacks.indexOf(cb) !== -1) continue;
  /******/ 							callbacks.push(cb);
  /******/ 						}
  /******/ 					}
  /******/ 					for (i = 0; i < callbacks.length; i++) {
  /******/ 						cb = callbacks[i];
  /******/ 						try {
  /******/ 							cb(moduleOutdatedDependencies);
  /******/ 						} catch (err) {
  /******/ 							if (options.onErrored) {
  /******/ 								options.onErrored({
  /******/ 									type: "accept-errored",
  /******/ 									moduleId: moduleId,
  /******/ 									dependencyId: moduleOutdatedDependencies[i],
  /******/ 									error: err
  /******/ 								});
  /******/ 							}
  /******/ 							if (!options.ignoreErrored) {
  /******/ 								if (!error) error = err;
  /******/ 							}
  /******/ 						}
  /******/ 					}
  /******/ 				}
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// Load self accepted modules
  /******/ 		for (i = 0; i < outdatedSelfAcceptedModules.length; i++) {
  /******/ 			var item = outdatedSelfAcceptedModules[i];
  /******/ 			moduleId = item.module;
  /******/ 			hotCurrentParents = [moduleId];
  /******/ 			try {
  /******/ 				__webpack_require__(moduleId);
  /******/ 			} catch (err) {
  /******/ 				if (typeof item.errorHandler === "function") {
  /******/ 					try {
  /******/ 						item.errorHandler(err);
  /******/ 					} catch (err2) {
  /******/ 						if (options.onErrored) {
  /******/ 							options.onErrored({
  /******/ 								type: "self-accept-error-handler-errored",
  /******/ 								moduleId: moduleId,
  /******/ 								error: err2,
  /******/ 								originalError: err
  /******/ 							});
  /******/ 						}
  /******/ 						if (!options.ignoreErrored) {
  /******/ 							if (!error) error = err2;
  /******/ 						}
  /******/ 						if (!error) error = err;
  /******/ 					}
  /******/ 				} else {
  /******/ 					if (options.onErrored) {
  /******/ 						options.onErrored({
  /******/ 							type: "self-accept-errored",
  /******/ 							moduleId: moduleId,
  /******/ 							error: err
  /******/ 						});
  /******/ 					}
  /******/ 					if (!options.ignoreErrored) {
  /******/ 						if (!error) error = err;
  /******/ 					}
  /******/ 				}
  /******/ 			}
  /******/ 		}
  /******/
  /******/ 		// handle errors in accept handlers and self accepted module load
  /******/ 		if (error) {
  /******/ 			hotSetStatus("fail");
  /******/ 			return Promise.reject(error);
  /******/ 		}
  /******/
  /******/ 		hotSetStatus("idle");
  /******/ 		return new Promise(function(resolve) {
  /******/ 			resolve(outdatedModules);
  /******/ 		});
  /******/ 	}
  /******/
  /******/ 	// The module cache
  /******/ 	var installedModules = {};
  /******/
  /******/ 	// The require function
  /******/ 	function __webpack_require__(moduleId) {
  /******/
  /******/ 		// Check if module is in cache
  /******/ 		if(installedModules[moduleId]) {
  /******/ 			return installedModules[moduleId].exports;
  /******/ 		}
  /******/ 		// Create a new module (and put it into the cache)
  /******/ 		var module = installedModules[moduleId] = {
  /******/ 			i: moduleId,
  /******/ 			l: false,
  /******/ 			exports: {},
  /******/ 			hot: hotCreateModule(moduleId),
  /******/ 			parents: (hotCurrentParentsTemp = hotCurrentParents, hotCurrentParents = [], hotCurrentParentsTemp),
  /******/ 			children: []
  /******/ 		};
  /******/
  /******/ 		// Execute the module function
  /******/ 		modules[moduleId].call(module.exports, module, module.exports, hotCreateRequire(moduleId));
  /******/
  /******/ 		// Flag the module as loaded
  /******/ 		module.l = true;
  /******/
  /******/ 		// Return the exports of the module
  /******/ 		return module.exports;
  /******/ 	}
  /******/
  /******/
  /******/ 	// expose the modules object (__webpack_modules__)
  /******/ 	__webpack_require__.m = modules;
  /******/
  /******/ 	// expose the module cache
  /******/ 	__webpack_require__.c = installedModules;
  /******/
  /******/ 	// define getter function for harmony exports
  /******/ 	__webpack_require__.d = function(exports, name, getter) {
  /******/ 		if(!__webpack_require__.o(exports, name)) {
  /******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
  /******/ 		}
  /******/ 	};
  /******/
  /******/ 	// define __esModule on exports
  /******/ 	__webpack_require__.r = function(exports) {
  /******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
  /******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
  /******/ 		}
  /******/ 		Object.defineProperty(exports, '__esModule', { value: true });
  /******/ 	};
  /******/
  /******/ 	// create a fake namespace object
  /******/ 	// mode & 1: value is a module id, require it
  /******/ 	// mode & 2: merge all properties of value into the ns
  /******/ 	// mode & 4: return value when already ns object
  /******/ 	// mode & 8|1: behave like require
  /******/ 	__webpack_require__.t = function(value, mode) {
  /******/ 		if(mode & 1) value = __webpack_require__(value);
  /******/ 		if(mode & 8) return value;
  /******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
  /******/ 		var ns = Object.create(null);
  /******/ 		__webpack_require__.r(ns);
  /******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
  /******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
  /******/ 		return ns;
  /******/ 	};
  /******/
  /******/ 	// getDefaultExport function for compatibility with non-harmony modules
  /******/ 	__webpack_require__.n = function(module) {
  /******/ 		var getter = module && module.__esModule ?
  /******/ 			function getDefault() { return module['default']; } :
  /******/ 			function getModuleExports() { return module; };
  /******/ 		__webpack_require__.d(getter, 'a', getter);
  /******/ 		return getter;
  /******/ 	};
  /******/
  /******/ 	// Object.prototype.hasOwnProperty.call
  /******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
  /******/
  /******/ 	// __webpack_public_path__
  /******/ 	__webpack_require__.p = "";
  /******/
  /******/ 	// __webpack_hash__
  /******/ 	__webpack_require__.h = function() { return hotCurrentHash; };
  /******/
  /******/
  /******/ 	// Load entry module and return exports
  /******/ 	return hotCreateRequire("./index.js")(__webpack_require__.s = "./index.js");
  /******/ })
  /************************************************************************/
  /******/ ({

  /***/ "./canvasToPixel.js":
  /*!**************************!*\
    !*** ./canvasToPixel.js ***!
    \**************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/getTransform.js */ "./internal/getTransform.js");


  /**
   * Converts a point in the canvas coordinate system to the pixel coordinate system
   * system.  This can be used to reset tools' image coordinates after modifications
   * have been made in canvas space (e.g. moving a tool by a few cm, independent of
   * image resolution).
   *
   * @param {HTMLElement} element The Cornerstone element within which the input point lies
   * @param {{x: Number, y: Number}} pt The input point in the canvas coordinate system
   *
   * @returns {{x: Number, y: Number}} The transformed point in the pixel coordinate system
   * @memberof PixelCoordinateSystem
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, pt) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var transform = Object(_internal_getTransform_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement);
    transform.invert();
    return transform.transformPoint(pt.x, pt.y);
  });

  /***/ }),

  /***/ "./colors/colormap.js":
  /*!****************************!*\
    !*** ./colors/colormap.js ***!
    \****************************/
  /*! exports provided: getColormapsList, getColormap */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getColormapsList", function() { return getColormapsList; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getColormap", function() { return getColormap; });
  /* harmony import */ var _lookupTable_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lookupTable.js */ "./colors/lookupTable.js");

  var COLOR_TRANSPARENT = [0, 0, 0, 0]; // Colormaps
  //
  // Hot Iron, PET, Hot Metal Blue and PET 20 Step are color palettes
  // Defined by the DICOM standard
  // http://dicom.nema.org/dicom/2013/output/chtml/part06/chapter_B.html
  //
  // All Linear Segmented Colormaps were copied from matplotlib
  // https://github.com/stefanv/matplotlib/blob/master/lib/matplotlib/_cm.py

  var colormapsData = {
    hotIron: {
      name: 'Hot Iron',
      numOfColors: 256,
      colors: [[0, 0, 0, 255], [2, 0, 0, 255], [4, 0, 0, 255], [6, 0, 0, 255], [8, 0, 0, 255], [10, 0, 0, 255], [12, 0, 0, 255], [14, 0, 0, 255], [16, 0, 0, 255], [18, 0, 0, 255], [20, 0, 0, 255], [22, 0, 0, 255], [24, 0, 0, 255], [26, 0, 0, 255], [28, 0, 0, 255], [30, 0, 0, 255], [32, 0, 0, 255], [34, 0, 0, 255], [36, 0, 0, 255], [38, 0, 0, 255], [40, 0, 0, 255], [42, 0, 0, 255], [44, 0, 0, 255], [46, 0, 0, 255], [48, 0, 0, 255], [50, 0, 0, 255], [52, 0, 0, 255], [54, 0, 0, 255], [56, 0, 0, 255], [58, 0, 0, 255], [60, 0, 0, 255], [62, 0, 0, 255], [64, 0, 0, 255], [66, 0, 0, 255], [68, 0, 0, 255], [70, 0, 0, 255], [72, 0, 0, 255], [74, 0, 0, 255], [76, 0, 0, 255], [78, 0, 0, 255], [80, 0, 0, 255], [82, 0, 0, 255], [84, 0, 0, 255], [86, 0, 0, 255], [88, 0, 0, 255], [90, 0, 0, 255], [92, 0, 0, 255], [94, 0, 0, 255], [96, 0, 0, 255], [98, 0, 0, 255], [100, 0, 0, 255], [102, 0, 0, 255], [104, 0, 0, 255], [106, 0, 0, 255], [108, 0, 0, 255], [110, 0, 0, 255], [112, 0, 0, 255], [114, 0, 0, 255], [116, 0, 0, 255], [118, 0, 0, 255], [120, 0, 0, 255], [122, 0, 0, 255], [124, 0, 0, 255], [126, 0, 0, 255], [128, 0, 0, 255], [130, 0, 0, 255], [132, 0, 0, 255], [134, 0, 0, 255], [136, 0, 0, 255], [138, 0, 0, 255], [140, 0, 0, 255], [142, 0, 0, 255], [144, 0, 0, 255], [146, 0, 0, 255], [148, 0, 0, 255], [150, 0, 0, 255], [152, 0, 0, 255], [154, 0, 0, 255], [156, 0, 0, 255], [158, 0, 0, 255], [160, 0, 0, 255], [162, 0, 0, 255], [164, 0, 0, 255], [166, 0, 0, 255], [168, 0, 0, 255], [170, 0, 0, 255], [172, 0, 0, 255], [174, 0, 0, 255], [176, 0, 0, 255], [178, 0, 0, 255], [180, 0, 0, 255], [182, 0, 0, 255], [184, 0, 0, 255], [186, 0, 0, 255], [188, 0, 0, 255], [190, 0, 0, 255], [192, 0, 0, 255], [194, 0, 0, 255], [196, 0, 0, 255], [198, 0, 0, 255], [200, 0, 0, 255], [202, 0, 0, 255], [204, 0, 0, 255], [206, 0, 0, 255], [208, 0, 0, 255], [210, 0, 0, 255], [212, 0, 0, 255], [214, 0, 0, 255], [216, 0, 0, 255], [218, 0, 0, 255], [220, 0, 0, 255], [222, 0, 0, 255], [224, 0, 0, 255], [226, 0, 0, 255], [228, 0, 0, 255], [230, 0, 0, 255], [232, 0, 0, 255], [234, 0, 0, 255], [236, 0, 0, 255], [238, 0, 0, 255], [240, 0, 0, 255], [242, 0, 0, 255], [244, 0, 0, 255], [246, 0, 0, 255], [248, 0, 0, 255], [250, 0, 0, 255], [252, 0, 0, 255], [254, 0, 0, 255], [255, 0, 0, 255], [255, 2, 0, 255], [255, 4, 0, 255], [255, 6, 0, 255], [255, 8, 0, 255], [255, 10, 0, 255], [255, 12, 0, 255], [255, 14, 0, 255], [255, 16, 0, 255], [255, 18, 0, 255], [255, 20, 0, 255], [255, 22, 0, 255], [255, 24, 0, 255], [255, 26, 0, 255], [255, 28, 0, 255], [255, 30, 0, 255], [255, 32, 0, 255], [255, 34, 0, 255], [255, 36, 0, 255], [255, 38, 0, 255], [255, 40, 0, 255], [255, 42, 0, 255], [255, 44, 0, 255], [255, 46, 0, 255], [255, 48, 0, 255], [255, 50, 0, 255], [255, 52, 0, 255], [255, 54, 0, 255], [255, 56, 0, 255], [255, 58, 0, 255], [255, 60, 0, 255], [255, 62, 0, 255], [255, 64, 0, 255], [255, 66, 0, 255], [255, 68, 0, 255], [255, 70, 0, 255], [255, 72, 0, 255], [255, 74, 0, 255], [255, 76, 0, 255], [255, 78, 0, 255], [255, 80, 0, 255], [255, 82, 0, 255], [255, 84, 0, 255], [255, 86, 0, 255], [255, 88, 0, 255], [255, 90, 0, 255], [255, 92, 0, 255], [255, 94, 0, 255], [255, 96, 0, 255], [255, 98, 0, 255], [255, 100, 0, 255], [255, 102, 0, 255], [255, 104, 0, 255], [255, 106, 0, 255], [255, 108, 0, 255], [255, 110, 0, 255], [255, 112, 0, 255], [255, 114, 0, 255], [255, 116, 0, 255], [255, 118, 0, 255], [255, 120, 0, 255], [255, 122, 0, 255], [255, 124, 0, 255], [255, 126, 0, 255], [255, 128, 4, 255], [255, 130, 8, 255], [255, 132, 12, 255], [255, 134, 16, 255], [255, 136, 20, 255], [255, 138, 24, 255], [255, 140, 28, 255], [255, 142, 32, 255], [255, 144, 36, 255], [255, 146, 40, 255], [255, 148, 44, 255], [255, 150, 48, 255], [255, 152, 52, 255], [255, 154, 56, 255], [255, 156, 60, 255], [255, 158, 64, 255], [255, 160, 68, 255], [255, 162, 72, 255], [255, 164, 76, 255], [255, 166, 80, 255], [255, 168, 84, 255], [255, 170, 88, 255], [255, 172, 92, 255], [255, 174, 96, 255], [255, 176, 100, 255], [255, 178, 104, 255], [255, 180, 108, 255], [255, 182, 112, 255], [255, 184, 116, 255], [255, 186, 120, 255], [255, 188, 124, 255], [255, 190, 128, 255], [255, 192, 132, 255], [255, 194, 136, 255], [255, 196, 140, 255], [255, 198, 144, 255], [255, 200, 148, 255], [255, 202, 152, 255], [255, 204, 156, 255], [255, 206, 160, 255], [255, 208, 164, 255], [255, 210, 168, 255], [255, 212, 172, 255], [255, 214, 176, 255], [255, 216, 180, 255], [255, 218, 184, 255], [255, 220, 188, 255], [255, 222, 192, 255], [255, 224, 196, 255], [255, 226, 200, 255], [255, 228, 204, 255], [255, 230, 208, 255], [255, 232, 212, 255], [255, 234, 216, 255], [255, 236, 220, 255], [255, 238, 224, 255], [255, 240, 228, 255], [255, 242, 232, 255], [255, 244, 236, 255], [255, 246, 240, 255], [255, 248, 244, 255], [255, 250, 248, 255], [255, 252, 252, 255], [255, 255, 255, 255]]
    },
    pet: {
      name: 'PET',
      numColors: 256,
      colors: [[0, 0, 0, 255], [0, 2, 1, 255], [0, 4, 3, 255], [0, 6, 5, 255], [0, 8, 7, 255], [0, 10, 9, 255], [0, 12, 11, 255], [0, 14, 13, 255], [0, 16, 15, 255], [0, 18, 17, 255], [0, 20, 19, 255], [0, 22, 21, 255], [0, 24, 23, 255], [0, 26, 25, 255], [0, 28, 27, 255], [0, 30, 29, 255], [0, 32, 31, 255], [0, 34, 33, 255], [0, 36, 35, 255], [0, 38, 37, 255], [0, 40, 39, 255], [0, 42, 41, 255], [0, 44, 43, 255], [0, 46, 45, 255], [0, 48, 47, 255], [0, 50, 49, 255], [0, 52, 51, 255], [0, 54, 53, 255], [0, 56, 55, 255], [0, 58, 57, 255], [0, 60, 59, 255], [0, 62, 61, 255], [0, 65, 63, 255], [0, 67, 65, 255], [0, 69, 67, 255], [0, 71, 69, 255], [0, 73, 71, 255], [0, 75, 73, 255], [0, 77, 75, 255], [0, 79, 77, 255], [0, 81, 79, 255], [0, 83, 81, 255], [0, 85, 83, 255], [0, 87, 85, 255], [0, 89, 87, 255], [0, 91, 89, 255], [0, 93, 91, 255], [0, 95, 93, 255], [0, 97, 95, 255], [0, 99, 97, 255], [0, 101, 99, 255], [0, 103, 101, 255], [0, 105, 103, 255], [0, 107, 105, 255], [0, 109, 107, 255], [0, 111, 109, 255], [0, 113, 111, 255], [0, 115, 113, 255], [0, 117, 115, 255], [0, 119, 117, 255], [0, 121, 119, 255], [0, 123, 121, 255], [0, 125, 123, 255], [0, 128, 125, 255], [1, 126, 127, 255], [3, 124, 129, 255], [5, 122, 131, 255], [7, 120, 133, 255], [9, 118, 135, 255], [11, 116, 137, 255], [13, 114, 139, 255], [15, 112, 141, 255], [17, 110, 143, 255], [19, 108, 145, 255], [21, 106, 147, 255], [23, 104, 149, 255], [25, 102, 151, 255], [27, 100, 153, 255], [29, 98, 155, 255], [31, 96, 157, 255], [33, 94, 159, 255], [35, 92, 161, 255], [37, 90, 163, 255], [39, 88, 165, 255], [41, 86, 167, 255], [43, 84, 169, 255], [45, 82, 171, 255], [47, 80, 173, 255], [49, 78, 175, 255], [51, 76, 177, 255], [53, 74, 179, 255], [55, 72, 181, 255], [57, 70, 183, 255], [59, 68, 185, 255], [61, 66, 187, 255], [63, 64, 189, 255], [65, 63, 191, 255], [67, 61, 193, 255], [69, 59, 195, 255], [71, 57, 197, 255], [73, 55, 199, 255], [75, 53, 201, 255], [77, 51, 203, 255], [79, 49, 205, 255], [81, 47, 207, 255], [83, 45, 209, 255], [85, 43, 211, 255], [86, 41, 213, 255], [88, 39, 215, 255], [90, 37, 217, 255], [92, 35, 219, 255], [94, 33, 221, 255], [96, 31, 223, 255], [98, 29, 225, 255], [100, 27, 227, 255], [102, 25, 229, 255], [104, 23, 231, 255], [106, 21, 233, 255], [108, 19, 235, 255], [110, 17, 237, 255], [112, 15, 239, 255], [114, 13, 241, 255], [116, 11, 243, 255], [118, 9, 245, 255], [120, 7, 247, 255], [122, 5, 249, 255], [124, 3, 251, 255], [126, 1, 253, 255], [128, 0, 255, 255], [130, 2, 252, 255], [132, 4, 248, 255], [134, 6, 244, 255], [136, 8, 240, 255], [138, 10, 236, 255], [140, 12, 232, 255], [142, 14, 228, 255], [144, 16, 224, 255], [146, 18, 220, 255], [148, 20, 216, 255], [150, 22, 212, 255], [152, 24, 208, 255], [154, 26, 204, 255], [156, 28, 200, 255], [158, 30, 196, 255], [160, 32, 192, 255], [162, 34, 188, 255], [164, 36, 184, 255], [166, 38, 180, 255], [168, 40, 176, 255], [170, 42, 172, 255], [171, 44, 168, 255], [173, 46, 164, 255], [175, 48, 160, 255], [177, 50, 156, 255], [179, 52, 152, 255], [181, 54, 148, 255], [183, 56, 144, 255], [185, 58, 140, 255], [187, 60, 136, 255], [189, 62, 132, 255], [191, 64, 128, 255], [193, 66, 124, 255], [195, 68, 120, 255], [197, 70, 116, 255], [199, 72, 112, 255], [201, 74, 108, 255], [203, 76, 104, 255], [205, 78, 100, 255], [207, 80, 96, 255], [209, 82, 92, 255], [211, 84, 88, 255], [213, 86, 84, 255], [215, 88, 80, 255], [217, 90, 76, 255], [219, 92, 72, 255], [221, 94, 68, 255], [223, 96, 64, 255], [225, 98, 60, 255], [227, 100, 56, 255], [229, 102, 52, 255], [231, 104, 48, 255], [233, 106, 44, 255], [235, 108, 40, 255], [237, 110, 36, 255], [239, 112, 32, 255], [241, 114, 28, 255], [243, 116, 24, 255], [245, 118, 20, 255], [247, 120, 16, 255], [249, 122, 12, 255], [251, 124, 8, 255], [253, 126, 4, 255], [255, 128, 0, 255], [255, 130, 4, 255], [255, 132, 8, 255], [255, 134, 12, 255], [255, 136, 16, 255], [255, 138, 20, 255], [255, 140, 24, 255], [255, 142, 28, 255], [255, 144, 32, 255], [255, 146, 36, 255], [255, 148, 40, 255], [255, 150, 44, 255], [255, 152, 48, 255], [255, 154, 52, 255], [255, 156, 56, 255], [255, 158, 60, 255], [255, 160, 64, 255], [255, 162, 68, 255], [255, 164, 72, 255], [255, 166, 76, 255], [255, 168, 80, 255], [255, 170, 85, 255], [255, 172, 89, 255], [255, 174, 93, 255], [255, 176, 97, 255], [255, 178, 101, 255], [255, 180, 105, 255], [255, 182, 109, 255], [255, 184, 113, 255], [255, 186, 117, 255], [255, 188, 121, 255], [255, 190, 125, 255], [255, 192, 129, 255], [255, 194, 133, 255], [255, 196, 137, 255], [255, 198, 141, 255], [255, 200, 145, 255], [255, 202, 149, 255], [255, 204, 153, 255], [255, 206, 157, 255], [255, 208, 161, 255], [255, 210, 165, 255], [255, 212, 170, 255], [255, 214, 174, 255], [255, 216, 178, 255], [255, 218, 182, 255], [255, 220, 186, 255], [255, 222, 190, 255], [255, 224, 194, 255], [255, 226, 198, 255], [255, 228, 202, 255], [255, 230, 206, 255], [255, 232, 210, 255], [255, 234, 214, 255], [255, 236, 218, 255], [255, 238, 222, 255], [255, 240, 226, 255], [255, 242, 230, 255], [255, 244, 234, 255], [255, 246, 238, 255], [255, 248, 242, 255], [255, 250, 246, 255], [255, 252, 250, 255], [255, 255, 255, 255]]
    },
    hotMetalBlue: {
      name: 'Hot Metal Blue',
      numColors: 256,
      colors: [[0, 0, 0, 255], [0, 0, 2, 255], [0, 0, 4, 255], [0, 0, 6, 255], [0, 0, 8, 255], [0, 0, 10, 255], [0, 0, 12, 255], [0, 0, 14, 255], [0, 0, 16, 255], [0, 0, 17, 255], [0, 0, 19, 255], [0, 0, 21, 255], [0, 0, 23, 255], [0, 0, 25, 255], [0, 0, 27, 255], [0, 0, 29, 255], [0, 0, 31, 255], [0, 0, 33, 255], [0, 0, 35, 255], [0, 0, 37, 255], [0, 0, 39, 255], [0, 0, 41, 255], [0, 0, 43, 255], [0, 0, 45, 255], [0, 0, 47, 255], [0, 0, 49, 255], [0, 0, 51, 255], [0, 0, 53, 255], [0, 0, 55, 255], [0, 0, 57, 255], [0, 0, 59, 255], [0, 0, 61, 255], [0, 0, 63, 255], [0, 0, 65, 255], [0, 0, 67, 255], [0, 0, 69, 255], [0, 0, 71, 255], [0, 0, 73, 255], [0, 0, 75, 255], [0, 0, 77, 255], [0, 0, 79, 255], [0, 0, 81, 255], [0, 0, 83, 255], [0, 0, 84, 255], [0, 0, 86, 255], [0, 0, 88, 255], [0, 0, 90, 255], [0, 0, 92, 255], [0, 0, 94, 255], [0, 0, 96, 255], [0, 0, 98, 255], [0, 0, 100, 255], [0, 0, 102, 255], [0, 0, 104, 255], [0, 0, 106, 255], [0, 0, 108, 255], [0, 0, 110, 255], [0, 0, 112, 255], [0, 0, 114, 255], [0, 0, 116, 255], [0, 0, 117, 255], [0, 0, 119, 255], [0, 0, 121, 255], [0, 0, 123, 255], [0, 0, 125, 255], [0, 0, 127, 255], [0, 0, 129, 255], [0, 0, 131, 255], [0, 0, 133, 255], [0, 0, 135, 255], [0, 0, 137, 255], [0, 0, 139, 255], [0, 0, 141, 255], [0, 0, 143, 255], [0, 0, 145, 255], [0, 0, 147, 255], [0, 0, 149, 255], [0, 0, 151, 255], [0, 0, 153, 255], [0, 0, 155, 255], [0, 0, 157, 255], [0, 0, 159, 255], [0, 0, 161, 255], [0, 0, 163, 255], [0, 0, 165, 255], [0, 0, 167, 255], [3, 0, 169, 255], [6, 0, 171, 255], [9, 0, 173, 255], [12, 0, 175, 255], [15, 0, 177, 255], [18, 0, 179, 255], [21, 0, 181, 255], [24, 0, 183, 255], [26, 0, 184, 255], [29, 0, 186, 255], [32, 0, 188, 255], [35, 0, 190, 255], [38, 0, 192, 255], [41, 0, 194, 255], [44, 0, 196, 255], [47, 0, 198, 255], [50, 0, 200, 255], [52, 0, 197, 255], [55, 0, 194, 255], [57, 0, 191, 255], [59, 0, 188, 255], [62, 0, 185, 255], [64, 0, 182, 255], [66, 0, 179, 255], [69, 0, 176, 255], [71, 0, 174, 255], [74, 0, 171, 255], [76, 0, 168, 255], [78, 0, 165, 255], [81, 0, 162, 255], [83, 0, 159, 255], [85, 0, 156, 255], [88, 0, 153, 255], [90, 0, 150, 255], [93, 2, 144, 255], [96, 4, 138, 255], [99, 6, 132, 255], [102, 8, 126, 255], [105, 9, 121, 255], [108, 11, 115, 255], [111, 13, 109, 255], [114, 15, 103, 255], [116, 17, 97, 255], [119, 19, 91, 255], [122, 21, 85, 255], [125, 23, 79, 255], [128, 24, 74, 255], [131, 26, 68, 255], [134, 28, 62, 255], [137, 30, 56, 255], [140, 32, 50, 255], [143, 34, 47, 255], [146, 36, 44, 255], [149, 38, 41, 255], [152, 40, 38, 255], [155, 41, 35, 255], [158, 43, 32, 255], [161, 45, 29, 255], [164, 47, 26, 255], [166, 49, 24, 255], [169, 51, 21, 255], [172, 53, 18, 255], [175, 55, 15, 255], [178, 56, 12, 255], [181, 58, 9, 255], [184, 60, 6, 255], [187, 62, 3, 255], [190, 64, 0, 255], [194, 66, 0, 255], [198, 68, 0, 255], [201, 70, 0, 255], [205, 72, 0, 255], [209, 73, 0, 255], [213, 75, 0, 255], [217, 77, 0, 255], [221, 79, 0, 255], [224, 81, 0, 255], [228, 83, 0, 255], [232, 85, 0, 255], [236, 87, 0, 255], [240, 88, 0, 255], [244, 90, 0, 255], [247, 92, 0, 255], [251, 94, 0, 255], [255, 96, 0, 255], [255, 98, 3, 255], [255, 100, 6, 255], [255, 102, 9, 255], [255, 104, 12, 255], [255, 105, 15, 255], [255, 107, 18, 255], [255, 109, 21, 255], [255, 111, 24, 255], [255, 113, 26, 255], [255, 115, 29, 255], [255, 117, 32, 255], [255, 119, 35, 255], [255, 120, 38, 255], [255, 122, 41, 255], [255, 124, 44, 255], [255, 126, 47, 255], [255, 128, 50, 255], [255, 130, 53, 255], [255, 132, 56, 255], [255, 134, 59, 255], [255, 136, 62, 255], [255, 137, 65, 255], [255, 139, 68, 255], [255, 141, 71, 255], [255, 143, 74, 255], [255, 145, 76, 255], [255, 147, 79, 255], [255, 149, 82, 255], [255, 151, 85, 255], [255, 152, 88, 255], [255, 154, 91, 255], [255, 156, 94, 255], [255, 158, 97, 255], [255, 160, 100, 255], [255, 162, 103, 255], [255, 164, 106, 255], [255, 166, 109, 255], [255, 168, 112, 255], [255, 169, 115, 255], [255, 171, 118, 255], [255, 173, 121, 255], [255, 175, 124, 255], [255, 177, 126, 255], [255, 179, 129, 255], [255, 181, 132, 255], [255, 183, 135, 255], [255, 184, 138, 255], [255, 186, 141, 255], [255, 188, 144, 255], [255, 190, 147, 255], [255, 192, 150, 255], [255, 194, 153, 255], [255, 196, 156, 255], [255, 198, 159, 255], [255, 200, 162, 255], [255, 201, 165, 255], [255, 203, 168, 255], [255, 205, 171, 255], [255, 207, 174, 255], [255, 209, 176, 255], [255, 211, 179, 255], [255, 213, 182, 255], [255, 215, 185, 255], [255, 216, 188, 255], [255, 218, 191, 255], [255, 220, 194, 255], [255, 222, 197, 255], [255, 224, 200, 255], [255, 226, 203, 255], [255, 228, 206, 255], [255, 229, 210, 255], [255, 231, 213, 255], [255, 233, 216, 255], [255, 235, 219, 255], [255, 237, 223, 255], [255, 239, 226, 255], [255, 240, 229, 255], [255, 242, 232, 255], [255, 244, 236, 255], [255, 246, 239, 255], [255, 248, 242, 255], [255, 250, 245, 255], [255, 251, 249, 255], [255, 253, 252, 255], [255, 255, 255, 255]]
    },
    pet20Step: {
      name: 'PET 20 Step',
      numColors: 256,
      colors: [[0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [0, 0, 0, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [96, 0, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 80, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [48, 48, 112, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [80, 80, 128, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [96, 96, 176, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [112, 112, 192, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [128, 128, 224, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 96, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [48, 144, 48, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [80, 192, 80, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [64, 224, 64, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [224, 224, 80, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 208, 96, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 176, 64, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [208, 144, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [192, 96, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [176, 48, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 0, 0, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255], [255, 255, 255, 255]]
    },
    gray: {
      name: 'Gray',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [1, 1, 1]],
        green: [[0, 0, 0], [1, 1, 1]],
        blue: [[0, 0, 0], [1, 1, 1]]
      }
    },
    jet: {
      name: 'Jet',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [0.35, 0, 0], [0.66, 1, 1], [0.89, 1, 1], [1, 0.5, 0.5]],
        green: [[0, 0, 0], [0.125, 0, 0], [0.375, 1, 1], [0.64, 1, 1], [0.91, 0, 0], [1, 0, 0]],
        blue: [[0, 0.5, 0.5], [0.11, 1, 1], [0.34, 1, 1], [0.65, 0, 0], [1, 0, 0]]
      }
    },
    hsv: {
      name: 'HSV',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 1, 1], [0.158730, 1, 1], [0.174603, 0.968750, 0.968750], [0.333333, 0.031250, 0.031250], [0.349206, 0, 0], [0.666667, 0, 0], [0.682540, 0.031250, 0.031250], [0.841270, 0.968750, 0.968750], [0.857143, 1, 1], [1, 1, 1]],
        green: [[0, 0, 0], [0.158730, 0.937500, 0.937500], [0.174603, 1, 1], [0.507937, 1, 1], [0.666667, 0.062500, 0.062500], [0.682540, 0, 0], [1, 0, 0]],
        blue: [[0, 0, 0], [0.333333, 0, 0], [0.349206, 0.062500, 0.062500], [0.507937, 1, 1], [0.841270, 1, 1], [0.857143, 0.937500, 0.937500], [1, 0.09375, 0.09375]]
      }
    },
    hot: {
      name: 'Hot',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0.0416, 0.0416], [0.365079, 1, 1], [1, 1, 1]],
        green: [[0, 0, 0], [0.365079, 0, 0], [0.746032, 1, 1], [1, 1, 1]],
        blue: [[0, 0, 0], [0.746032, 0, 0], [1, 1, 1]]
      }
    },
    cool: {
      name: 'Cool',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [1, 1, 1]],
        green: [[0, 1, 1], [1, 0, 0]],
        blue: [[0, 1, 1], [1, 1, 1]]
      }
    },
    spring: {
      name: 'Spring',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 1, 1], [1, 1, 1]],
        green: [[0, 0, 0], [1, 1, 1]],
        blue: [[0, 1, 1], [1, 0, 0]]
      }
    },
    summer: {
      name: 'Summer',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [1, 1, 1]],
        green: [[0, 0.5, 0.5], [1, 1, 1]],
        blue: [[0, 0.4, 0.4], [1, 0.4, 0.4]]
      }
    },
    autumn: {
      name: 'Autumn',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 1, 1], [1, 1, 1]],
        green: [[0, 0, 0], [1, 1, 1]],
        blue: [[0, 0, 0], [1, 0, 0]]
      }
    },
    winter: {
      name: 'Winter',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [1, 0, 0]],
        green: [[0, 0, 0], [1, 1, 1]],
        blue: [[0, 1, 1], [1, 0.5, 0.5]]
      }
    },
    bone: {
      name: 'Bone',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [0.746032, 0.652778, 0.652778], [1, 1, 1]],
        green: [[0, 0, 0], [0.365079, 0.319444, 0.319444], [0.746032, 0.777778, 0.777778], [1, 1, 1]],
        blue: [[0, 0, 0], [0.365079, 0.444444, 0.444444], [1, 1, 1]]
      }
    },
    copper: {
      name: 'Copper',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [0.809524, 1, 1], [1, 1, 1]],
        green: [[0, 0, 0], [1, 0.7812, 0.7812]],
        blue: [[0, 0, 0], [1, 0.4975, 0.4975]]
      }
    },
    spectral: {
      name: 'Spectral',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0, 0], [0.05, 0.4667, 0.4667], [0.10, 0.5333, 0.5333], [0.15, 0, 0], [0.20, 0, 0], [0.25, 0, 0], [0.30, 0, 0], [0.35, 0, 0], [0.40, 0, 0], [0.45, 0, 0], [0.50, 0, 0], [0.55, 0, 0], [0.60, 0, 0], [0.65, 0.7333, 0.7333], [0.70, 0.9333, 0.9333], [0.75, 1, 1], [0.80, 1, 1], [0.85, 1, 1], [0.90, 0.8667, 0.8667], [0.95, 0.80, 0.80], [1, 0.80, 0.80]],
        green: [[0, 0, 0], [0.05, 0, 0], [0.10, 0, 0], [0.15, 0, 0], [0.20, 0, 0], [0.25, 0.4667, 0.4667], [0.30, 0.6000, 0.6000], [0.35, 0.6667, 0.6667], [0.40, 0.6667, 0.6667], [0.45, 0.6000, 0.6000], [0.50, 0.7333, 0.7333], [0.55, 0.8667, 0.8667], [0.60, 1, 1], [0.65, 1, 1], [0.70, 0.9333, 0.9333], [0.75, 0.8000, 0.8000], [0.80, 0.6000, 0.6000], [0.85, 0, 0], [0.90, 0, 0], [0.95, 0, 0], [1, 0.80, 0.80]],
        blue: [[0, 0, 0], [0.05, 0.5333, 0.5333], [0.10, 0.6000, 0.6000], [0.15, 0.6667, 0.6667], [0.20, 0.8667, 0.8667], [0.25, 0.8667, 0.8667], [0.30, 0.8667, 0.8667], [0.35, 0.6667, 0.6667], [0.40, 0.5333, 0.5333], [0.45, 0, 0], [0.5, 0, 0], [0.55, 0, 0], [0.60, 0, 0], [0.65, 0, 0], [0.70, 0, 0], [0.75, 0, 0], [0.80, 0, 0], [0.85, 0, 0], [0.90, 0, 0], [0.95, 0, 0], [1, 0.80, 0.80]]
      }
    },
    coolwarm: {
      name: 'CoolWarm',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0.2298057, 0.2298057], [0.03125, 0.26623388, 0.26623388], [0.0625, 0.30386891, 0.30386891], [0.09375, 0.342804478, 0.342804478], [0.125, 0.38301334, 0.38301334], [0.15625, 0.424369608, 0.424369608], [0.1875, 0.46666708, 0.46666708], [0.21875, 0.509635204, 0.509635204], [0.25, 0.552953156, 0.552953156], [0.28125, 0.596262162, 0.596262162], [0.3125, 0.639176211, 0.639176211], [0.34375, 0.681291281, 0.681291281], [0.375, 0.722193294, 0.722193294], [0.40625, 0.761464949, 0.761464949], [0.4375, 0.798691636, 0.798691636], [0.46875, 0.833466556, 0.833466556], [0.5, 0.865395197, 0.865395197], [0.53125, 0.897787179, 0.897787179], [0.5625, 0.924127593, 0.924127593], [0.59375, 0.944468518, 0.944468518], [0.625, 0.958852946, 0.958852946], [0.65625, 0.96732803, 0.96732803], [0.6875, 0.969954137, 0.969954137], [0.71875, 0.966811177, 0.966811177], [0.75, 0.958003065, 0.958003065], [0.78125, 0.943660866, 0.943660866], [0.8125, 0.923944917, 0.923944917], [0.84375, 0.89904617, 0.89904617], [0.875, 0.869186849, 0.869186849], [0.90625, 0.834620542, 0.834620542], [0.9375, 0.795631745, 0.795631745], [0.96875, 0.752534934, 0.752534934], [1, 0.705673158, 0.705673158]],
        green: [[0, 0.298717966, 0.298717966], [0.03125, 0.353094838, 0.353094838], [0.0625, 0.406535296, 0.406535296], [0.09375, 0.458757618, 0.458757618], [0.125, 0.50941904, 0.50941904], [0.15625, 0.558148092, 0.558148092], [0.1875, 0.604562568, 0.604562568], [0.21875, 0.648280772, 0.648280772], [0.25, 0.688929332, 0.688929332], [0.28125, 0.726149107, 0.726149107], [0.3125, 0.759599947, 0.759599947], [0.34375, 0.788964712, 0.788964712], [0.375, 0.813952739, 0.813952739], [0.40625, 0.834302879, 0.834302879], [0.4375, 0.849786142, 0.849786142], [0.46875, 0.860207984, 0.860207984], [0.5, 0.86541021, 0.86541021], [0.53125, 0.848937047, 0.848937047], [0.5625, 0.827384882, 0.827384882], [0.59375, 0.800927443, 0.800927443], [0.625, 0.769767752, 0.769767752], [0.65625, 0.734132809, 0.734132809], [0.6875, 0.694266682, 0.694266682], [0.71875, 0.650421156, 0.650421156], [0.75, 0.602842431, 0.602842431], [0.78125, 0.551750968, 0.551750968], [0.8125, 0.49730856, 0.49730856], [0.84375, 0.439559467, 0.439559467], [0.875, 0.378313092, 0.378313092], [0.90625, 0.312874446, 0.312874446], [0.9375, 0.24128379, 0.24128379], [0.96875, 0.157246067, 0.157246067], [1, 0.01555616, 0.01555616]],
        blue: [[0, 0.753683153, 0.753683153], [0.03125, 0.801466763, 0.801466763], [0.0625, 0.84495867, 0.84495867], [0.09375, 0.883725899, 0.883725899], [0.125, 0.917387822, 0.917387822], [0.15625, 0.945619588, 0.945619588], [0.1875, 0.968154911, 0.968154911], [0.21875, 0.98478814, 0.98478814], [0.25, 0.995375608, 0.995375608], [0.28125, 0.999836203, 0.999836203], [0.3125, 0.998151185, 0.998151185], [0.34375, 0.990363227, 0.990363227], [0.375, 0.976574709, 0.976574709], [0.40625, 0.956945269, 0.956945269], [0.4375, 0.931688648, 0.931688648], [0.46875, 0.901068838, 0.901068838], [0.5, 0.865395561, 0.865395561], [0.53125, 0.820880546, 0.820880546], [0.5625, 0.774508472, 0.774508472], [0.59375, 0.726736146, 0.726736146], [0.625, 0.678007945, 0.678007945], [0.65625, 0.628751763, 0.628751763], [0.6875, 0.579375448, 0.579375448], [0.71875, 0.530263762, 0.530263762], [0.75, 0.481775914, 0.481775914], [0.78125, 0.434243684, 0.434243684], [0.8125, 0.387970225, 0.387970225], [0.84375, 0.343229596, 0.343229596], [0.875, 0.300267182, 0.300267182], [0.90625, 0.259301199, 0.259301199], [0.9375, 0.220525627, 0.220525627], [0.96875, 0.184115123, 0.184115123], [1, 0.150232812, 0.150232812]]
      }
    },
    blues: {
      name: 'Blues',
      numColors: 256,
      gamma: 1,
      segmentedData: {
        red: [[0, 0.9686274528503418, 0.9686274528503418], [0.125, 0.87058824300765991, 0.87058824300765991], [0.25, 0.7764706015586853, 0.7764706015586853], [0.375, 0.61960786581039429, 0.61960786581039429], [0.5, 0.41960784792900085, 0.41960784792900085], [0.625, 0.25882354378700256, 0.25882354378700256], [0.75, 0.12941177189350128, 0.12941177189350128], [0.875, 0.031372550874948502, 0.031372550874948502], [1, 0.031372550874948502, 0.031372550874948502]],
        green: [[0, 0.9843137264251709, 0.9843137264251709], [0.125, 0.92156863212585449, 0.92156863212585449], [0.25, 0.85882353782653809, 0.85882353782653809], [0.375, 0.7921568751335144, 0.7921568751335144], [0.5, 0.68235296010971069, 0.68235296010971069], [0.625, 0.57254904508590698, 0.57254904508590698], [0.75, 0.44313725829124451, 0.44313725829124451], [0.875, 0.31764706969261169, 0.31764706969261169], [1, 0.18823529779911041, 0.18823529779911041]],
        blue: [[0, 1, 1], [0.125, 0.9686274528503418, 0.9686274528503418], [0.25, 0.93725490570068359, 0.93725490570068359], [0.375, 0.88235294818878174, 0.88235294818878174], [0.5, 0.83921569585800171, 0.83921569585800171], [0.625, 0.7764706015586853, 0.7764706015586853], [0.75, 0.70980393886566162, 0.70980393886566162], [0.875, 0.61176472902297974, 0.61176472902297974], [1, 0.41960784792900085, 0.41960784792900085]]
      }
    }
  };
  /**
   *  Generate linearly spaced vectors
  *  http://cens.ioc.ee/local/man/matlab/techdoc/ref/linspace.html
   * @param {Number} a A number representing the first vector
   * @param {Number} b A number representing the second vector
   * @param {Number} n The number of linear spaced vectors to generate
   * @returns {Array} An array of points representing linear spaced vectors.
   * @memberof Colors
   */

  function linspace(a, b, n) {
    n = n === null ? 100 : n;
    var increment = (b - a) / (n - 1);
    var vector = [];

    while (n-- > 0) {
      vector.push(a);
      a += increment;
    } // Make sure the last item will always be "b" because most of the
    // Time we'll get numbers like 1.0000000000000002 instead of 1.


    vector[vector.length - 1] = b;
    return vector;
  }
  /**
   * Returns the "rank/index" of the element in a sorted array if found or the highest index if not. Uses (binary search)
   * @param {Array} array A sorted array to search in
   * @param {any} elem the element in the array to search for
   * @returns {number} The rank/index of the element in the given array
   * @memberof Colors
   */


  function getRank(array, elem) {
    var left = 0;
    var right = array.length - 1;

    while (left <= right) {
      var mid = left + Math.floor((right - left) / 2);
      var midElem = array[mid];

      if (midElem === elem) {
        return mid;
      } else if (elem < midElem) {
        right = mid - 1;
      } else {
        left = mid + 1;
      }
    }

    return left;
  }
  /**
   * Find the indices into a sorted array a such that, if the corresponding elements
   * In v were inserted before the indices, the order of a would be preserved.
   *  http://lagrange.univ-lyon1.fr/docs/numpy/1.11.0/reference/generated/numpy.searchsorted.html
   * @param {Array} inputArray The array where the values will be inserted
   * @param {Array} values An array of the values to be inserted into the inputArray
   * @returns {Array} The indices where elements should be inserted to maintain order.
   * @memberof Colors
   */


  function searchSorted(inputArray, values) {
    var i;
    var indexes = [];
    var len = values.length;
    inputArray.sort(function (a, b) {
      return a - b;
    });

    for (i = 0; i < len; i++) {
      indexes[i] = getRank(inputArray, values[i]);
    }

    return indexes;
  }
  /**
   * Creates an *N* -element 1-d lookup table
   * @param {Number} N The number of elements in the result lookup table
   * @param {Array} data represented by a list of x,y0,y1 mapping correspondences. Each element in this
   * List represents how a value between 0 and 1 (inclusive) represented by x is mapped to
   * A corresponding value between 0 and 1 (inclusive). The two values of y are to allow for
   * Discontinuous mapping functions (say as might be found in a sawtooth) where y0 represents
   * The value of y for values of x <= to that given, and y1 is the value to be used for x >
   * Than that given). The list must start with x=0, end with x=1, and all values of x must be
   * In increasing order. Values between the given mapping points are determined by simple linear
   * Interpolation.
   * @param {any} gamma value denotes a "gamma curve" value which adjusts the brightness
   * at the bottom and top of the map.
   * @returns {any[]} an array "result" where result[x*(N-1)] gives the closest value for
   * Values of x between 0 and 1.
   * @memberof Colors
   */


  function makeMappingArray(N, data, gamma) {
    var i;
    var x = [];
    var y0 = [];
    var y1 = [];
    var lut = [];
    gamma = gamma === null ? 1 : gamma;

    for (i = 0; i < data.length; i++) {
      var element = data[i];
      x.push((N - 1) * element[0]);
      y0.push(element[1]);
      y1.push(element[1]);
    }

    var xLinSpace = linspace(0, 1, N);

    for (i = 0; i < N; i++) {
      xLinSpace[i] = (N - 1) * Math.pow(xLinSpace[i], gamma);
    }

    var xLinSpaceIndexes = searchSorted(x, xLinSpace);

    for (i = 1; i < N - 1; i++) {
      var index = xLinSpaceIndexes[i];
      var colorPercent = (xLinSpace[i] - x[index - 1]) / (x[index] - x[index - 1]);
      var colorDelta = y0[index] - y1[index - 1];
      lut[i] = colorPercent * colorDelta + y1[index - 1];
    }

    lut[0] = y1[0];
    lut[N - 1] = y0[data.length - 1];
    return lut;
  }
  /**
   * Creates a Colormap based on lookup tables using linear segments.
   * @param {{red:Array, green:Array, blue:Array}} segmentedData An object with a red, green and blue entries.
   * Each entry should be a list of x, y0, y1 tuples, forming rows in a table.
   * @param {Number} N The number of elements in the result Colormap
   * @param {any} gamma value denotes a "gamma curve" value which adjusts the brightness
   * at the bottom and top of the Colormap.
   * @returns {Array} The created Colormap object
   * @description The lookup table is generated using linear interpolation for each
   *  Primary color, with the 0-1 domain divided into any number of
   * Segments.
   * https://github.com/stefanv/matplotlib/blob/3f1a23755e86fef97d51e30e106195f34425c9e3/lib/matplotlib/colors.py#L663
   * @memberof Colors
   */


  function createLinearSegmentedColormap(segmentedData, N, gamma) {
    var i;
    var lut = [];
    N = N === null ? 256 : N;
    gamma = gamma === null ? 1 : gamma;
    var redLut = makeMappingArray(N, segmentedData.red, gamma);
    var greenLut = makeMappingArray(N, segmentedData.green, gamma);
    var blueLut = makeMappingArray(N, segmentedData.blue, gamma);

    for (i = 0; i < N; i++) {
      var red = Math.round(redLut[i] * 255);
      var green = Math.round(greenLut[i] * 255);
      var blue = Math.round(blueLut[i] * 255);
      var rgba = [red, green, blue, 255];
      lut.push(rgba);
    }

    return lut;
  }
  /**
   * Return all available colormaps (id and name)
   * @returns {Array<{id,key}>} An array of colormaps with an object containing the "id" and display "name"
   * @memberof Colors
   */


  function getColormapsList() {
    var colormaps = [];
    var keys = Object.keys(colormapsData);
    keys.forEach(function (key) {
      if (colormapsData.hasOwnProperty(key)) {
        var colormap = colormapsData[key];
        colormaps.push({
          id: key,
          name: colormap.name
        });
      }
    });
    colormaps.sort(function (a, b) {
      var aName = a.name.toLowerCase();
      var bName = b.name.toLowerCase();

      if (aName === bName) {
        return 0;
      }

      return aName < bName ? -1 : 1;
    });
    return colormaps;
  }
  /**
   * Return a colorMap object with the provided id and colormapData
   * if the Id matches existent colorMap objects (check colormapsData) the colormapData is ignored.
   * if the colormapData is not empty, the colorMap will be added to the colormapsData list. Otherwise, an empty colorMap object is returned.
   * @param {string} id The ID of the colormap
   * @param {Object} colormapData - An object that can contain a name, numColors, gama, segmentedData and/or colors
   * @returns {*} The Colormap Object
   * @memberof Colors
  */

  function getColormap(id, colormapData) {
    var colormap = colormapsData[id];

    if (!colormap) {
      colormap = colormapsData[id] = colormapData || {
        name: '',
        colors: []
      };
    }

    if (!colormap.colors && colormap.segmentedData) {
      colormap.colors = createLinearSegmentedColormap(colormap.segmentedData, colormap.numColors, colormap.gamma);
    }

    return {
      getId: function getId() {
        return id;
      },
      getColorSchemeName: function getColorSchemeName() {
        return colormap.name;
      },
      setColorSchemeName: function setColorSchemeName(name) {
        colormap.name = name;
      },
      getNumberOfColors: function getNumberOfColors() {
        return colormap.colors.length;
      },
      setNumberOfColors: function setNumberOfColors(numColors) {
        while (colormap.colors.length < numColors) {
          colormap.colors.push(COLOR_TRANSPARENT);
        }

        colormap.colors.length = numColors;
      },
      getColor: function getColor(index) {
        if (this.isValidIndex(index)) {
          return colormap.colors[index];
        }

        return COLOR_TRANSPARENT;
      },
      getColorRepeating: function getColorRepeating(index) {
        var numColors = colormap.colors.length;
        index = numColors ? index % numColors : 0;
        return this.getColor(index);
      },
      setColor: function setColor(index, rgba) {
        if (this.isValidIndex(index)) {
          colormap.colors[index] = rgba;
        }
      },
      addColor: function addColor(rgba) {
        colormap.colors.push(rgba);
      },
      insertColor: function insertColor(index, rgba) {
        if (this.isValidIndex(index)) {
          colormap.colors.splice(index, 1, rgba);
        }
      },
      removeColor: function removeColor(index) {
        if (this.isValidIndex(index)) {
          colormap.colors.splice(index, 1);
        }
      },
      clearColors: function clearColors() {
        colormap.colors = [];
      },
      buildLookupTable: function buildLookupTable(lut) {
        if (!lut) {
          return;
        }

        var numColors = colormap.colors.length;
        lut.setNumberOfTableValues(numColors);

        for (var i = 0; i < numColors; i++) {
          lut.setTableValue(i, colormap.colors[i]);
        }
      },
      createLookupTable: function createLookupTable() {
        var lut = new _lookupTable_js__WEBPACK_IMPORTED_MODULE_0__["default"]();
        this.buildLookupTable(lut);
        return lut;
      },
      isValidIndex: function isValidIndex(index) {
        return index >= 0 && index < colormap.colors.length;
      }
    };
  }

  /***/ }),

  /***/ "./colors/index.js":
  /*!*************************!*\
    !*** ./colors/index.js ***!
    \*************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _colormap_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./colormap.js */ "./colors/colormap.js");
  /* harmony import */ var _lookupTable_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lookupTable.js */ "./colors/lookupTable.js");


  /* harmony default export */ __webpack_exports__["default"] = ({
    getColormap: _colormap_js__WEBPACK_IMPORTED_MODULE_0__["getColormap"],
    getColormapsList: _colormap_js__WEBPACK_IMPORTED_MODULE_0__["getColormapsList"],
    LookupTable: _lookupTable_js__WEBPACK_IMPORTED_MODULE_1__["default"]
  });

  /***/ }),

  /***/ "./colors/lookupTable.js":
  /*!*******************************!*\
    !*** ./colors/lookupTable.js ***!
    \*******************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  // This code was created based on vtkLookupTable
  // http://www.vtk.org/doc/release/5.0/html/a01697.html
  // https://github.com/Kitware/VTK/blob/master/Common/Core/vtkLookupTable.cxx
  var BELOW_RANGE_COLOR_INDEX = 0;
  var ABOVE_RANGE_COLOR_INDEX = 1;
  var NAN_COLOR_INDEX = 2;
  /**
   * Converts an HSV  (Hue, Saturation, Value) color to RGB (Red, Green, Blue) color value
   * @param {Number} hue A number representing the hue color value
   * @param {any} sat A number representing the saturation color value
   * @param {any} val A number representing the value color value
   * @returns {Numberp[]} An RGB color array
   */

  function HSVToRGB(hue, sat, val) {
    if (hue > 1) {
      throw new Error('HSVToRGB expects hue < 1');
    }

    var rgb = [];

    if (sat === 0) {
      rgb[0] = val;
      rgb[1] = val;
      rgb[2] = val;
      return rgb;
    }

    var hueCase = Math.floor(hue * 6);
    var frac = 6 * hue - hueCase;
    var lx = val * (1 - sat);
    var ly = val * (1 - sat * frac);
    var lz = val * (1 - sat * (1 - frac));

    switch (hueCase) {
      /* 0<hue<1/6 */
      case 0:
      case 6:
        rgb[0] = val;
        rgb[1] = lz;
        rgb[2] = lx;
        break;

      /* 1/6<hue<2/6 */

      case 1:
        rgb[0] = ly;
        rgb[1] = val;
        rgb[2] = lx;
        break;

      /* 2/6<hue<3/6 */

      case 2:
        rgb[0] = lx;
        rgb[1] = val;
        rgb[2] = lz;
        break;

      /* 3/6<hue/4/6 */

      case 3:
        rgb[0] = lx;
        rgb[1] = ly;
        rgb[2] = val;
        break;

      /* 4/6<hue<5/6 */

      case 4:
        rgb[0] = lz;
        rgb[1] = lx;
        rgb[2] = val;
        break;

      /* 5/6<hue<1 */

      case 5:
        rgb[0] = val;
        rgb[1] = lx;
        rgb[2] = ly;
        break;
    }

    return rgb;
  }
  /**
   * Maps a value to an index in the table
   * @param {Number} v A double value which table index will be returned.
   * @param {any} p An object that contains the Table "Range", the table "MaxIndex",
   * A "Shift" from first value in the table and the table "Scale" value
   * @returns {Number} The mapped index in the table
   * @memberof Colors
   */


  function linearIndexLookupMain(v, p) {
    var dIndex; // NOTE: Added Math.floor since values were not integers? Check VTK source

    if (v < p.Range[0]) {
      dIndex = p.MaxIndex + BELOW_RANGE_COLOR_INDEX + 1.5;
    } else if (v > p.Range[1]) {
      dIndex = p.MaxIndex + ABOVE_RANGE_COLOR_INDEX + 1.5;
    } else {
      dIndex = (v + p.Shift) * p.Scale;
    }

    return Math.floor(dIndex);
  }
  /**
   * Maps scalar values into colors via a lookup table
   * LookupTable is an object that is used by mapper objects to map scalar values into rgba (red-green-blue-alpha transparency) color specification,
   * or rgba into scalar values. The color table can be created by direct insertion of color values, or by specifying hue, saturation, value, and alpha range and generating a table
   */


  var LookupTable =
  /*#__PURE__*/
  function () {
    /**
     * Creates a default linear LookupTable object with 256 colors.
     */
    function LookupTable() {
      _classCallCheck(this, LookupTable);

      this.NumberOfColors = 256;
      this.Ramp = 'linear';
      this.TableRange = [0, 255];
      this.HueRange = [0, 0.66667];
      this.SaturationRange = [1, 1];
      this.ValueRange = [1, 1];
      this.AlphaRange = [1, 1];
      this.NaNColor = [128, 0, 0, 255];
      this.BelowRangeColor = [0, 0, 0, 255];
      this.UseBelowRangeColor = true;
      this.AboveRangeColor = [255, 255, 255, 255];
      this.UseAboveRangeColor = true;
      this.InputRange = [0, 255];
      this.Table = [];
    }
    /**
     * Specify the number of values (i.e., colors) in the lookup table.
     * @param {Number} number The number of colors in he LookupTable
     * @returns {void}
     * @memberof Colors
     */


    _createClass(LookupTable, [{
      key: "setNumberOfTableValues",
      value: function setNumberOfTableValues(number) {
        this.NumberOfColors = number;
      }
      /**
       * Set the shape of the table ramp to either 'linear', 'scurve' or 'sqrt'
       * @param {String} ramp A string value representing the shape of the table. Allowed values are 'linear', 'scurve' or 'sqrt'
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setRamp",
      value: function setRamp(ramp) {
        this.Ramp = ramp;
      }
      /**
       * Sets the minimum/maximum scalar values for scalar mapping.
       * Scalar values less than minimum range value are clamped to minimum range value.
       * Scalar values greater than maximum range value are clamped to maximum range value.
       * @param {Number} start A double representing the minimum scaler value of the LookupTable
       * @param {any} end A double representing the maximum scaler value of the LookupTable
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setTableRange",
      value: function setTableRange(start, end) {
        this.TableRange[0] = start;
        this.TableRange[1] = end;
      }
      /**
       * Set the range in hue (using automatic generation). Hue ranges between [0,1].
       * @param {Number} start A double representing the minimum hue value in a range. Min. is 0
       * @param {Number} end A double representing the maximum hue value in a range. Max. is 1
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setHueRange",
      value: function setHueRange(start, end) {
        this.HueRange[0] = start;
        this.HueRange[1] = end;
      }
      /**
       * Set the range in saturation (using automatic generation). Saturation ranges between [0,1].
       * @param {Number} start A double representing the minimum Saturation value in a range. Min. is 0
       * @param {Number} end A double representing the maximum Saturation value in a range. Max. is 1
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setSaturationRange",
      value: function setSaturationRange(start, end) {
        this.SaturationRange[0] = start;
        this.SaturationRange[1] = end;
      }
      /**
       * Set the range in value (using automatic generation). Value ranges between [0,1].
       * @param {Numeber } start A double representing the minimum value in a range. Min. is 0
       * @param {Numeber} end A double representing the maximum value in a range. Max. is 1
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setValueRange",
      value: function setValueRange(start, end) {
        // Set the range in value (using automatic generation). Value ranges between [0,1].
        this.ValueRange[0] = start;
        this.ValueRange[1] = end;
      }
      /**
       * (Not Used) Sets the range of scalars which will be mapped.
       * @param {Number} start the minimum scalar value in the range
       * @param {Number} end the maximum scalar value in the range
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setRange",
      value: function setRange(start, end) {
        this.InputRange[0] = start;
        this.InputRange[1] = end;
      }
      /**
       * Set the range in alpha (using automatic generation). Alpha ranges from [0,1].
       * @param {Number} start A double representing the minimum alpha value
       * @param {Number} end A double representing the maximum alpha value
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setAlphaRange",
      value: function setAlphaRange(start, end) {
        // Set the range in alpha (using automatic generation). Alpha ranges from [0,1].
        this.AlphaRange[0] = start;
        this.AlphaRange[1] = end;
      }
      /**
       * Map one value through the lookup table and return the color as an
       * RGBA array of doubles between 0 and 1.
       * @param {Number} scalar A double scalar value which will be mapped to a color in the LookupTable
       * @returns {Number[]} An RGBA array of doubles between 0 and 1
       * @memberof Colors
       */

    }, {
      key: "getColor",
      value: function getColor(scalar) {
        return this.mapValue(scalar);
      }
      /**
       * Generate lookup table from hue, saturation, value, alpha min/max values. Table is built from linear ramp of each value.
       * @param {Boolean} force true to force the build of the LookupTable. Otherwie, false. This is useful if a lookup table has been defined manually
       * (using SetTableValue) and then an application decides to rebuild the lookup table using the implicit process.
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "build",
      value: function build(force) {
        if (this.Table.length > 1 && !force) {
          return;
        } // Clear the table


        this.Table = [];
        var maxIndex = this.NumberOfColors - 1;
        var hinc, sinc, vinc, ainc;

        if (maxIndex) {
          hinc = (this.HueRange[1] - this.HueRange[0]) / maxIndex;
          sinc = (this.SaturationRange[1] - this.SaturationRange[0]) / maxIndex;
          vinc = (this.ValueRange[1] - this.ValueRange[0]) / maxIndex;
          ainc = (this.AlphaRange[1] - this.AlphaRange[0]) / maxIndex;
        } else {
          hinc = sinc = vinc = ainc = 0.0;
        }

        for (var i = 0; i <= maxIndex; i++) {
          var hue = this.HueRange[0] + i * hinc;
          var sat = this.SaturationRange[0] + i * sinc;
          var val = this.ValueRange[0] + i * vinc;
          var alpha = this.AlphaRange[0] + i * ainc;
          var rgb = HSVToRGB(hue, sat, val);
          var c_rgba = [];

          switch (this.Ramp) {
            case 'scurve':
              c_rgba[0] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[0]) * Math.PI)));
              c_rgba[1] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[1]) * Math.PI)));
              c_rgba[2] = Math.floor(127.5 * (1.0 + Math.cos((1.0 - rgb[2]) * Math.PI)));
              c_rgba[3] = Math.floor(alpha * 255);
              break;

            case 'linear':
              c_rgba[0] = Math.floor(rgb[0] * 255 + 0.5);
              c_rgba[1] = Math.floor(rgb[1] * 255 + 0.5);
              c_rgba[2] = Math.floor(rgb[2] * 255 + 0.5);
              c_rgba[3] = Math.floor(alpha * 255 + 0.5);
              break;

            case 'sqrt':
              c_rgba[0] = Math.floor(Math.sqrt(rgb[0]) * 255 + 0.5);
              c_rgba[1] = Math.floor(Math.sqrt(rgb[1]) * 255 + 0.5);
              c_rgba[2] = Math.floor(Math.sqrt(rgb[2]) * 255 + 0.5);
              c_rgba[3] = Math.floor(Math.sqrt(alpha) * 255 + 0.5);
              break;

            default:
              throw new Error("Invalid Ramp value (".concat(this.Ramp, ")"));
          }

          this.Table.push(c_rgba);
        }

        this.buildSpecialColors();
      }
      /**
       * Ensures the out-of-range colors (Below range and Above range) are set correctly.
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "buildSpecialColors",
      value: function buildSpecialColors() {
        var numberOfColors = this.NumberOfColors;
        var belowRangeColorIndex = numberOfColors + BELOW_RANGE_COLOR_INDEX;
        var aboveRangeColorIndex = numberOfColors + ABOVE_RANGE_COLOR_INDEX;
        var nanColorIndex = numberOfColors + NAN_COLOR_INDEX; // Below range color

        if (this.UseBelowRangeColor || numberOfColors === 0) {
          this.Table[belowRangeColorIndex] = this.BelowRangeColor;
        } else {
          // Duplicate the first color in the table.
          this.Table[belowRangeColorIndex] = this.Table[0];
        } // Above range color


        if (this.UseAboveRangeColor || numberOfColors === 0) {
          this.Table[aboveRangeColorIndex] = this.AboveRangeColor;
        } else {
          // Duplicate the last color in the table.
          this.Table[aboveRangeColorIndex] = this.Table[numberOfColors - 1];
        } // Always use NanColor


        this.Table[nanColorIndex] = this.NaNColor;
      }
      /**
       * Similar to GetColor - Map one value through the lookup table and return the color as an
       * RGBA array of doubles between 0 and 1.
       * @param {Numeber} v A double scalar value which will be mapped to a color in the LookupTable
       * @returns {Number[]} An RGBA array of doubles between 0 and 1
       * @memberof Colors
       */

    }, {
      key: "mapValue",
      value: function mapValue(v) {
        var index = this.getIndex(v);

        if (index < 0) {
          return this.NaNColor;
        } else if (index === 0) {
          if (this.UseBelowRangeColor && v < this.TableRange[0]) {
            return this.BelowRangeColor;
          }
        } else if (index === this.NumberOfColors - 1) {
          if (this.UseAboveRangeColor && v > this.TableRange[1]) {
            return this.AboveRangeColor;
          }
        }

        return this.Table[index];
      }
      /**
       * Return the table index associated with a particular value.
       * @param {Number} v A double value which table index will be returned.
       * @returns {Number} The index in the LookupTable
       * @memberof Colors
       */

    }, {
      key: "getIndex",
      value: function getIndex(v) {
        var p = {};
        p.Range = [];
        p.MaxIndex = this.NumberOfColors - 1; // This was LookupShiftAndScale

        p.Shift = -this.TableRange[0];

        if (this.TableRange[1] <= this.TableRange[0]) {
          p.Scale = Number.MAX_VALUE;
        } else {
          p.Scale = p.MaxIndex / (this.TableRange[1] - this.TableRange[0]);
        }

        p.Range[0] = this.TableRange[0];
        p.Range[1] = this.TableRange[1]; // First, check whether we have a number...

        if (isNaN(v)) {
          // For backwards compatibility
          return -1;
        } // Map to an index:


        var index = linearIndexLookupMain(v, p); // For backwards compatibility, if the index indicates an
        // Out-of-range value, truncate to index range for in-range colors.

        if (index === this.NumberOfColors + BELOW_RANGE_COLOR_INDEX) {
          index = 0;
        } else if (index === this.NumberOfColors + ABOVE_RANGE_COLOR_INDEX) {
          index = this.NumberOfColors - 1;
        }

        return index;
      }
      /**
       * Directly load color into lookup table. Use [0,1] double values for color component specification.
       * Make sure that you've either used the Build() method or used SetNumberOfTableValues() prior to using this method.
       * @param {Number} index The index in the LookupTable of where to insert the color value
       * @param {Number[]} rgba An array of [0,1] double values for an RGBA color component
       * @returns {void}
       * @memberof Colors
       */

    }, {
      key: "setTableValue",
      value: function setTableValue(index, rgba) {
        // Check if it index, red, green, blue and alpha were passed as parameter
        if (arguments.length === 5) {
          rgba = Array.prototype.slice.call(arguments, 1);
        } // Check the index to make sure it is valid


        if (index < 0) {
          throw new Error("Can't set the table value for negative index (".concat(index, ")"));
        }

        if (index >= this.NumberOfColors) {
          new Error("Index ".concat(index, " is greater than the number of colors ").concat(this.NumberOfColors));
        }

        this.Table[index] = rgba;

        if (index === 0 || index === this.NumberOfColors - 1) {
          // This is needed due to the way the special colors are stored in
          // The internal table. If Above/BelowRangeColors are not used and
          // The min/max colors are changed in the table with this member
          // Function, then the colors used for values outside the range may
          // Be incorrect. Calling this here ensures the out-of-range colors
          // Are set correctly.
          this.buildSpecialColors();
        }
      }
    }]);

    return LookupTable;
  }();

  /* harmony default export */ __webpack_exports__["default"] = (LookupTable);

  /***/ }),

  /***/ "./disable.js":
  /*!********************!*\
    !*** ./disable.js ***!
    \********************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events.js */ "./events.js");



  /**
   *  Disable an HTML element for further use in Cornerstone
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @returns {void}
   * @memberof Enable
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    if (element === undefined) {
      throw new Error('disable: element must not be undefined');
    } // Search for this element in this list of enabled elements


    var enabledElements = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElements"])();

    for (var i = 0; i < enabledElements.length; i++) {
      if (enabledElements[i].element === element) {
        // We found it!
        // Fire an event so dependencies can cleanup
        var eventData = {
          element: element
        };
        Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(element, _events_js__WEBPACK_IMPORTED_MODULE_2__["default"].ELEMENT_DISABLED, eventData);
        Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_2__["events"], _events_js__WEBPACK_IMPORTED_MODULE_2__["default"].ELEMENT_DISABLED, eventData); // Remove the child DOM elements that we created (e.g.canvas)

        enabledElements[i].element.removeChild(enabledElements[i].canvas);
        enabledElements[i].canvas = undefined; // Remove this element from the list of enabled elements

        enabledElements.splice(i, 1);
        break;
      }
    }
  });

  /***/ }),

  /***/ "./displayImage.js":
  /*!*************************!*\
    !*** ./displayImage.js ***!
    \*************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");
  /* harmony import */ var _internal_now_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./internal/now.js */ "./internal/now.js");
  /* harmony import */ var _layers_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./layers.js */ "./layers.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./events.js */ "./events.js");







  /**
   * Sets a new image object for a given element.
   *
   * Will also apply an optional viewport setting.
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @param {Object} image An Image loaded by a Cornerstone Image Loader
   * @param {Object} [viewport] A set of Cornerstone viewport parameters
   * @returns {void}
   * @memberof Drawing
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, image, viewport) {
    if (element === undefined) {
      throw new Error('displayImage: parameter element must not be undefined');
    }

    if (image === undefined) {
      throw new Error('displayImage: parameter image must not be undefined');
    }

    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var oldImage = enabledElement.image;
    enabledElement.image = image;

    if (enabledElement.layers && enabledElement.layers.length) {
      Object(_layers_js__WEBPACK_IMPORTED_MODULE_4__["setLayerImage"])(element, image);
    }

    if (enabledElement.viewport === undefined) {
      enabledElement.viewport = Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement.canvas, image);
    } // Merge viewport


    if (viewport) {
      for (var attrname in viewport) {
        if (viewport[attrname] !== null) {
          enabledElement.viewport[attrname] = viewport[attrname];
        }
      }
    }

    var frameRate;

    if (enabledElement.lastImageTimeStamp !== undefined) {
      var timeSinceLastImage = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_3__["default"])() - enabledElement.lastImageTimeStamp;
      frameRate = (1000 / timeSinceLastImage).toFixed();
    }

    enabledElement.lastImageTimeStamp = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_3__["default"])();
    var newImageEventData = {
      viewport: enabledElement.viewport,
      element: enabledElement.element,
      image: enabledElement.image,
      oldImage: oldImage,
      enabledElement: enabledElement,
      frameRate: frameRate
    };
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_5__["default"])(enabledElement.element, _events_js__WEBPACK_IMPORTED_MODULE_6__["default"].NEW_IMAGE, newImageEventData);
    Object(_updateImage_js__WEBPACK_IMPORTED_MODULE_2__["default"])(element);
  });

  /***/ }),

  /***/ "./draw.js":
  /*!*****************!*\
    !*** ./draw.js ***!
    \*****************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/drawImage.js */ "./internal/drawImage.js");


  /**
   * Immediately draws the enabled element
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @returns {void}
   * @memberof Drawing
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);

    if (enabledElement.image === undefined) {
      throw new Error('draw: image has not been loaded yet');
    }

    Object(_internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement);
  });

  /***/ }),

  /***/ "./drawInvalidated.js":
  /*!****************************!*\
    !*** ./drawInvalidated.js ***!
    \****************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/drawImage.js */ "./internal/drawImage.js");
  /**
   * This module is responsible for drawing invalidated enabled elements
   */


  /**
   * Draws all invalidated enabled elements and clears the invalid flag after drawing it
   *
   * @returns {void}
   * @memberof Drawing
   */

  /* harmony default export */ __webpack_exports__["default"] = (function () {
    var enabledElements = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElements"])();

    for (var i = 0; i < enabledElements.length; i++) {
      var ee = enabledElements[i];

      if (ee.invalid === true) {
        Object(_internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__["default"])(ee, true);
      }
    }
  });

  /***/ }),

  /***/ "./enable.js":
  /*!*******************!*\
    !*** ./enable.js ***!
    \*******************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _resize_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./resize.js */ "./resize.js");
  /* harmony import */ var _internal_drawImageSync_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./internal/drawImageSync.js */ "./internal/drawImageSync.js");
  /* harmony import */ var _internal_requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./internal/requestAnimationFrame.js */ "./internal/requestAnimationFrame.js");
  /* harmony import */ var _internal_tryEnableWebgl_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./internal/tryEnableWebgl.js */ "./internal/tryEnableWebgl.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _generateUUID_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./generateUUID.js */ "./generateUUID.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./events.js */ "./events.js");
  /* harmony import */ var _internal_getCanvas_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./internal/getCanvas.js */ "./internal/getCanvas.js");









  /**
   * @module Enable
   * This module is responsible for enabling an element to display images with cornerstone
   */

  /**
   * Returns whether or not an Enabled Element has either a currently active image or
   * a non-empty Array of Enabled Element Layers.
   *
   * @param {EnabledElement} enabledElement An Enabled Element
   * @return {Boolean} Whether or not the Enabled Element has an active image or valid set of layers
   * @memberof Enable
   */

  function hasImageOrLayers(enabledElement) {
    return enabledElement.image !== undefined || enabledElement.layers.length > 0;
  }
  /**
   * Enable an HTML Element for use in Cornerstone
   *
   * - If there is a Canvas already present within the HTMLElement, and it has the class
   * 'cornerstone-canvas', this function will use this existing Canvas instead of creating
   * a new one. This may be helpful when using libraries (e.g. React, Vue) which don't
   * want third parties to change the DOM.
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @param {Object} options Options for the enabledElement
   *
   * @return {void}
   * @memberof Enable
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (element, options) {
    if (element === undefined) {
      throw new Error('enable: parameter element cannot be undefined');
    } // If this enabled element has the option set for WebGL, we should
    // Check if this device actually supports it


    if (options && options.renderer && options.renderer.toLowerCase() === 'webgl') {
      Object(_internal_tryEnableWebgl_js__WEBPACK_IMPORTED_MODULE_4__["default"])(options);
    }

    var canvas = Object(_internal_getCanvas_js__WEBPACK_IMPORTED_MODULE_8__["default"])(element);
    var enabledElement = {
      element: element,
      canvas: canvas,
      image: undefined,
      // Will be set once image is loaded
      invalid: false,
      // True if image needs to be drawn, false if not
      needsRedraw: true,
      options: options,
      layers: [],
      data: {},
      renderingTools: {},
      uuid: Object(_generateUUID_js__WEBPACK_IMPORTED_MODULE_6__["default"])()
    };
    Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["addEnabledElement"])(enabledElement);
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_5__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_7__["events"], _events_js__WEBPACK_IMPORTED_MODULE_7__["default"].ELEMENT_ENABLED, enabledElement);
    Object(_resize_js__WEBPACK_IMPORTED_MODULE_1__["default"])(element, true);
    /**
     * Draw the image immediately
     *
     * @param {DOMHighResTimeStamp} timestamp The current time for when requestAnimationFrame starts to fire callbacks
     * @returns {void}
     * @memberof Drawing
     */

    function draw(timestamp) {
      if (enabledElement.canvas === undefined) {
        return;
      }

      var eventDetails = {
        enabledElement: enabledElement,
        timestamp: timestamp
      };
      Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_5__["default"])(enabledElement.element, _events_js__WEBPACK_IMPORTED_MODULE_7__["default"].PRE_RENDER, eventDetails);

      if (enabledElement.needsRedraw && hasImageOrLayers(enabledElement)) {
        Object(_internal_drawImageSync_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement, enabledElement.invalid);
      }

      Object(_internal_requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__["default"])(draw);
    }

    draw();
  });

  /***/ }),

  /***/ "./enabledElementData.js":
  /*!*******************************!*\
    !*** ./enabledElementData.js ***!
    \*******************************/
  /*! exports provided: getElementData, removeElementData */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getElementData", function() { return getElementData; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "removeElementData", function() { return removeElementData; });
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");

  /**
   * Retrieves any data for a Cornerstone enabledElement for a specific string
   * dataType
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @param {string} dataType A string name for an arbitrary set of data
   * @returns {*} Whatever data is stored for this enabled element
   */

  function getElementData(element, dataType) {
    var ee = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);

    if (ee.data.hasOwnProperty(dataType) === false) {
      ee.data[dataType] = {};
    }

    return ee.data[dataType];
  }
  /**
   * Clears any data for a Cornerstone enabledElement for a specific string
   * dataType
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @param {string} dataType A string name for an arbitrary set of data
   *
   * @returns {void}
   */

  function removeElementData(element, dataType) {
    var ee = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    delete ee.data[dataType];
  }

  /***/ }),

  /***/ "./enabledElements.js":
  /*!****************************!*\
    !*** ./enabledElements.js ***!
    \****************************/
  /*! exports provided: getEnabledElement, addEnabledElement, getEnabledElementsByImageId, getEnabledElements */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getEnabledElement", function() { return getEnabledElement; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addEnabledElement", function() { return addEnabledElement; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getEnabledElementsByImageId", function() { return getEnabledElementsByImageId; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getEnabledElements", function() { return getEnabledElements; });
  var enabledElements = [];
  /**
   * @module EnabledElements
   */

  /**
   * @module Objects
   */

  /**
   * A two-dimensional vector
   *
   * @typedef {Object} vec2
   * @memberof Objects
   * @param {Number} x - The x distance
   * @param {Number} y - The y distance
   */

  /**
   * VOI
   *
   * @typedef {Object} VOI
   * @memberof Objects
   * @param {Number} windowWidth - Window Width for display
   * @param {Number} windowCenter - Window Center for display
   */

  /**
   * Lookup Table Array
   *
   * @typedef {Object} LUT
   * @memberof Objects
   * @property {Number} firstValueMapped
   * @property {Number} numBitsPerEntry
   * @property {Array} lut
   */

  /**
   * Image Statistics Object
   *
   * @typedef {Object} ImageStats
   * @memberof Objects
   * @property {Number} [lastGetPixelDataTime] The time in ms taken to retrieve stored pixels required to draw the image
   * @property {Number} [lastStoredPixelDataToCanvasImageDataTime] The time in ms taken to map from stored pixel array to canvas pixel array
   * @property {Number} [lastPutImageDataTime] The time in ms taken for putImageData to put the canvas pixel data into the canvas context
   * @property {Number} [lastRenderTime] The total time in ms taken for the entire rendering function to run
   * @property {Number} [lastLutGenerateTime] The time in ms taken to generate the lookup table for the image
   */

  /**
   * An Image Object in Cornerstone
   *
   * @typedef {Object} Image
   * @memberof Objects
   * @property {string} imageId - The imageId associated with this image object
   * @property {Number} minPixelValue - the minimum stored pixel value in the image
   * @property {Number} maxPixelValue - the maximum stored pixel value in the image
   * @property {Number} slope - the rescale slope to convert stored pixel values to modality pixel values or 1 if not specified
   * @property {Number} intercept - the rescale intercept used to convert stored pixel values to modality values or 0 if not specified
   * @property {Number} windowCenter - the default windowCenter to apply to the image
   * @property {Number} windowWidth - the default windowWidth to apply to the image
   * @property {function} getPixelData - a function that returns the underlying pixel data. An array of integers for grayscale and an array of RGBA for color
   * @property {function} getImageData - a function that returns a canvas imageData object for the image. This is only needed for color images
   * @property {function} getCanvas - a function that returns a canvas element with the image loaded into it. This is only needed for color images.
   * @property {function} getImage - a function that returns a JavaScript Image object with the image data. This is optional and typically used for images encoded in standard web JPEG and PNG formats
   * @property {Number} rows - number of rows in the image. This is the same as height but duplicated for convenience
   * @property {Number} columns - number of columns in the image. This is the same as width but duplicated for convenience
   * @property {Number} height - the height of the image. This is the same as rows but duplicated for convenience
   * @property {Number} width - the width of the image. This is the same as columns but duplicated for convenience
   * @property {Boolean} color - true if pixel data is RGB, false if grayscale
   * @property {Object} lut - The Lookup Table
   * @property {Boolean} rgba - Is the color pixel data stored in RGBA?
   * @property {Number} columnPixelSpacing - horizontal distance between the middle of each pixel (or width of each pixel) in mm or undefined if not known
   * @property {Number} rowPixelSpacing - vertical distance between the middle of each pixel (or height of each pixel) in mm or undefined if not known
   * @property {Boolean} invert - true if the the image should initially be displayed be inverted, false if not. This is here mainly to support DICOM images with a photometric interpretation of MONOCHROME1
   * @property {Number} sizeInBytes - the number of bytes used to store the pixels for this image.
   * @property {Boolean} [falseColor=false] - Whether or not the image has undergone false color mapping
   * @property {Array} [origPixelData] - Original pixel data for an image after it has undergone false color mapping
   * @property {ImageStats} [stats] - Statistics for the last redraw of the image
   * @property {Object} cachedLut - Cached Lookup Table for this image.
   * @property {String|Colormap} [colormap] - Depreacted. Use viewport.colormap instead. an optional colormap ID or colormap object (from colors/colormap.js). This will be applied during rendering to convert the image to pseudocolor
   * @property {Boolean} [labelmap=false] - whether or not to render this image as a label map (i.e. skip modality and VOI LUT pipelines and use only a color lookup table)
   */

  /**
   * A Viewport Settings Object Cornerstone
   *
   * @typedef {Object} Viewport
   * @memberof Objects
   * @property {Number} [scale=1.0] - The scale applied to the image. A scale of 1.0 will display no zoom (one image pixel takes up one screen pixel). A scale of 2.0 will be double zoom and a scale of .5 will be zoomed out by 2x
   * @property {vec2} [translation] - An object with properties x and y which describe the translation to apply in the pixel coordinate system. Note that the image is initially displayed centered in the enabled element with a x and y translation of 0 and 0 respectively.
   * @property {VOI} [voi] - an object with properties windowWidth and windowCenter.
   * @property {boolean} [invert=false] - Whether or not the image is inverted.
   * @property {boolean} [pixelReplication=false] - true if the image smooth / interpolation should be used when zoomed in on the image or false if pixel replication should be used.
   * @property {boolean} [hflip=false] - true if the image is flipped horizontally. Default is false
   * @property {boolean} [vflip=false] - true if the image is flipped vertically. Default is false
   * @property {Number} [rotation=0] - the rotation of the image (90 degree increments). Default is 0
   * @property {LUT} [modalityLUT] - the modality LUT to apply or undefined if none
   * @property {LUT} [voiLUT] - the modality LUT to apply or undefined if none
   * @property {String|Colormap} [colormap] - an optional colormap ID or colormap object (from colors/colormap.js). This will be applied during rendering to convert the image to pseudocolor
   * @property {Boolean} [labelmap=false] - whether or not to render this image as a label map (i.e. skip modality and VOI LUT pipelines and use only a color lookup table)
   */

  /**
   * An Enabled Element in Cornerstone
   *
   * @typedef {Object} EnabledElement
   * @memberof Objects
   * @property {HTMLElement} element - The DOM element which has been enabled for use by Cornerstone
   * @property {Image} [image] - The image currently displayed in the enabledElement
   * @property {Viewport} [viewport] - The current viewport settings of the enabledElement
   * @property {HTMLCanvasElement} [canvas] - The current canvas for this enabledElement
   * @property {Boolean} invalid - Whether or not the image pixel data underlying the enabledElement has been changed, necessitating a redraw
   * @property {Boolean} needsRedraw - A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid
   * @property {EnabledElementLayer[]} [layers] - The layers that have been added to the enabledElement
   * @property {Boolean} [syncViewports] - Whether or not to synchronize the viewport parameters
   * for each of the enabled element's layers
   * @property {Boolean} [lastSyncViewportsState] - The previous state for the sync viewport boolean
   */

  /**
   * An Enabled Element Layer in Cornerstone
   *
   * @typedef {Object} EnabledElementLayer
   * @memberof Objects
   * @property {HTMLElement} element - The DOM element which has been enabled for use by Cornerstone
   * @property {Image} [image] - The image currently displayed in the enabledElement
   * @property {Viewport} [viewport] - The current viewport settings of the enabledElement
   * @property {HTMLCanvasElement} [canvas] - The current canvas for this enabledElement
   * @property {Object} [options] - Layer drawing options
   * @property {Boolean} invalid - Whether or not the image pixel data underlying the enabledElement has been changed, necessitating a redraw
   * @property {Boolean} needsRedraw - A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid
   */

  /**
   * An Image Load Object
   *
   * @typedef {Object} ImageLoadObject
   * @memberof Objects
   * @property {Promise} promise - The Promise tracking the loading of this image
   * @property {Function|undefined} cancelFn - A function to cancel the image load request
   */

  /**
   * Retrieves a Cornerstone Enabled Element object
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   *
   * @returns {EnabledElement} A Cornerstone Enabled Element
   * @memberof EnabledElements
   */

  function getEnabledElement(element) {
    if (element === undefined) {
      throw new Error('getEnabledElement: parameter element must not be undefined');
    }

    for (var i = 0; i < enabledElements.length; i++) {
      if (enabledElements[i].element === element) {
        return enabledElements[i];
      }
    }

    throw new Error('element not enabled');
  }
  /**
   * Adds a Cornerstone Enabled Element object to the central store of enabledElements
   *
   * @param {EnabledElement} enabledElement A Cornerstone enabledElement Object
   * @returns {void}
   * @memberof EnabledElements
   */

  function addEnabledElement(enabledElement) {
    if (enabledElement === undefined) {
      throw new Error('getEnabledElement: enabledElement element must not be undefined');
    }

    enabledElements.push(enabledElement);
  }
  /**
   * Adds a Cornerstone Enabled Element object to the central store of enabledElements
   *
   * @param {string} imageId A Cornerstone Image ID
   * @returns {EnabledElement[]} An Array of Cornerstone enabledElement Objects
   * @memberof EnabledElements
   */

  function getEnabledElementsByImageId(imageId) {
    var ees = [];
    enabledElements.forEach(function (enabledElement) {
      if (enabledElement.image && enabledElement.image.imageId === imageId) {
        ees.push(enabledElement);
      }
    });
    return ees;
  }
  /**
   * Retrieve all of the currently enabled Cornerstone elements
   *
   * @return {EnabledElement[]} An Array of Cornerstone enabledElement Objects
   * @memberof EnabledElements
   */

  function getEnabledElements() {
    return enabledElements;
  }

  /***/ }),

  /***/ "./events.js":
  /*!*******************!*\
    !*** ./events.js ***!
    \*******************/
  /*! exports provided: default, events */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "events", function() { return events; });
  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  var EVENTS = {
    NEW_IMAGE: 'cornerstonenewimage',
    INVALIDATED: 'cornerstoneinvalidated',
    PRE_RENDER: 'cornerstoneprerender',
    IMAGE_CACHE_MAXIMUM_SIZE_CHANGED: 'cornerstoneimagecachemaximumsizechanged',
    IMAGE_CACHE_PROMISE_REMOVED: 'cornerstoneimagecachepromiseremoved',
    IMAGE_CACHE_FULL: 'cornerstoneimagecachefull',
    IMAGE_CACHE_CHANGED: 'cornerstoneimagecachechanged',
    WEBGL_TEXTURE_REMOVED: 'cornerstonewebgltextureremoved',
    WEBGL_TEXTURE_CACHE_FULL: 'cornerstonewebgltexturecachefull',
    IMAGE_LOADED: 'cornerstoneimageloaded',
    IMAGE_LOAD_FAILED: 'cornerstoneimageloadfailed',
    ELEMENT_RESIZED: 'cornerstoneelementresized',
    IMAGE_RENDERED: 'cornerstoneimagerendered',
    LAYER_ADDED: 'cornerstonelayeradded',
    LAYER_REMOVED: 'cornerstonelayerremoved',
    ACTIVE_LAYER_CHANGED: 'cornerstoneactivelayerchanged',
    ELEMENT_DISABLED: 'cornerstoneelementdisabled',
    ELEMENT_ENABLED: 'cornerstoneelementenabled'
  };
  /* harmony default export */ __webpack_exports__["default"] = (EVENTS);
  /**
   * EventTarget - Provides the [EventTarget](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget) interface
   *
   * @class
   * @memberof Polyfills
   */

  var EventTarget =
  /*#__PURE__*/
  function () {
    function EventTarget() {
      _classCallCheck(this, EventTarget);

      this.listeners = {};
      this.namespaces = {};
    }

    _createClass(EventTarget, [{
      key: "addEventNamespaceListener",
      value: function addEventNamespaceListener(type, callback) {
        if (type.indexOf('.') <= 0) {
          return;
        }

        this.namespaces[type] = callback;
        this.addEventListener(type.split('.')[0], callback);
      }
    }, {
      key: "removeEventNamespaceListener",
      value: function removeEventNamespaceListener(type) {
        if (type.indexOf('.') <= 0 || !this.namespaces[type]) {
          return;
        }

        this.removeEventListener(type.split('.')[0], this.namespaces[type]);
        delete this.namespaces[type];
      }
    }, {
      key: "addEventListener",
      value: function addEventListener(type, callback) {
        // Check if it is an event namespace
        if (type.indexOf('.') > 0) {
          this.addEventNamespaceListener(type, callback);
          return;
        }

        if (!(type in this.listeners)) {
          this.listeners[type] = [];
        }

        this.listeners[type].push(callback);
      }
    }, {
      key: "removeEventListener",
      value: function removeEventListener(type, callback) {
        // Check if it is an event namespace
        if (type.indexOf('.') > 0) {
          this.removeEventNamespaceListener(type);
          return;
        }

        if (!(type in this.listeners)) {
          return;
        }

        var stack = this.listeners[type];

        for (var i = 0, l = stack.length; i < l; i++) {
          if (stack[i] === callback) {
            stack.splice(i, 1);
            return;
          }
        }
      }
    }, {
      key: "dispatchEvent",
      value: function dispatchEvent(event) {
        if (!(event.type in this.listeners)) {
          return true;
        }

        var stack = this.listeners[event.type];

        for (var i = 0, l = stack.length; i < l; i++) {
          stack[i].call(this, event);
        }

        return !event.defaultPrevented;
      }
    }]);

    return EventTarget;
  }();

  var events = new EventTarget();

  /***/ }),

  /***/ "./falseColorMapping.js":
  /*!******************************!*\
    !*** ./falseColorMapping.js ***!
    \******************************/
  /*! exports provided: convertImageToFalseColorImage, convertToFalseColorImage, restoreImage */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "convertImageToFalseColorImage", function() { return convertImageToFalseColorImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "convertToFalseColorImage", function() { return convertToFalseColorImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "restoreImage", function() { return restoreImage; });
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _pixelDataToFalseColorData_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./pixelDataToFalseColorData.js */ "./pixelDataToFalseColorData.js");
  /* harmony import */ var _colors_colormap_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./colors/colormap.js */ "./colors/colormap.js");



  /**
   * Retrieves the minimum and maximum pixel values from an Array of pixel data
   *
   * @param {Array} pixelData The input pixel data array
   *
   * @returns {{minPixelValue: Number, maxPixelValue: Number}} The minimum and maximum pixel values in the input Array
   */

  function getPixelValues(pixelData) {
    var minPixelValue = Number.MAX_VALUE;
    var maxPixelValue = Number.MIN_VALUE;
    var len = pixelData.length;
    var pixel;

    for (var i = 0; i < len; i++) {
      pixel = pixelData[i];
      minPixelValue = minPixelValue < pixel ? minPixelValue : pixel;
      maxPixelValue = maxPixelValue > pixel ? maxPixelValue : pixel;
    }

    return {
      minPixelValue: minPixelValue,
      maxPixelValue: maxPixelValue
    };
  }
  /**
   * Retrieve a function that will allow an image object to be reset to its original form
   * after a false color mapping transformation
   *
   * @param {Image} image A Cornerstone Image Object
   *
   * @return {Function} A function for resetting an Image Object to its original form
   */


  function getRestoreImageMethod(image) {
    if (image.restore) {
      return image.restore;
    }

    var color = image.color;
    var rgba = image.rgba;
    var cachedLut = image.cachedLut;
    var slope = image.slope;
    var windowWidth = image.windowWidth;
    var windowCenter = image.windowCenter;
    var minPixelValue = image.minPixelValue;
    var maxPixelValue = image.maxPixelValue;
    return function () {
      image.color = color;
      image.rgba = rgba;
      image.cachedLut = cachedLut;
      image.slope = slope;
      image.windowWidth = windowWidth;
      image.windowCenter = windowCenter;
      image.minPixelValue = minPixelValue;
      image.maxPixelValue = maxPixelValue;

      if (image.origPixelData) {
        var pixelData = image.origPixelData;

        image.getPixelData = function () {
          return pixelData;
        };
      } // Remove some attributes added by false color mapping


      image.origPixelData = undefined;
      image.colormapId = undefined;
      image.falseColor = undefined;
    };
  } //
  // Then we need to make sure it will be converted into a colormap object if it's as string.

  /**
   * User can pass a colormap or its id as string to some of these public functions.
   * Then we need to make sure it will be converted into a colormap object if it's a string.
   *
   * @param {*} colormap A colormap ID or Object
   * @return {*} The colormap
   */


  function ensuresColormap(colormap) {
    if (colormap && typeof colormap === 'string') {
      colormap = Object(_colors_colormap_js__WEBPACK_IMPORTED_MODULE_2__["getColormap"])(colormap);
    }

    return colormap;
  }
  /**
   * Restores a false color image to its original version
   *
   * @param {Image} image A Cornerstone Image Object
   * @returns {Boolean} True if the image object had a valid restore function, which was run. Otherwise, false.
   */


  function restoreImage(image) {
    if (image.restore && typeof image.restore === 'function') {
      image.restore();
      return true;
    }

    return false;
  }
  /**
   * Convert an image to a false color image
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {String|Object} colormap - it can be a colormap object or a colormap id (string)
   *
   * @returns {Boolean} - Whether or not the image has been converted to a false color image
   */


  function convertImageToFalseColorImage(image, colormap) {
    if (image.color && !image.falseColor) {
      throw new Error('Color transforms are not implemented yet');
    } // User can pass a colormap id or a colormap object


    colormap = ensuresColormap(colormap);
    var colormapId = colormap.getId(); // Doesn't do anything if colormapId hasn't changed

    if (image.colormapId === colormapId) {
      // It has already being converted into a false color image
      // Using the colormapId passed as parameter
      return false;
    } // Restore the image attributes updated when converting to a false color image


    restoreImage(image); // Convert the image to a false color image

    if (colormapId) {
      var minPixelValue = image.minPixelValue || 0;
      var maxPixelValue = image.maxPixelValue || 255;
      image.restore = getRestoreImageMethod(image);
      var lookupTable = colormap.createLookupTable();
      lookupTable.setTableRange(minPixelValue, maxPixelValue); // Update the pixel data and render the new image

      Object(_pixelDataToFalseColorData_js__WEBPACK_IMPORTED_MODULE_1__["default"])(image, lookupTable); // Update min and max pixel values

      var pixelValues = getPixelValues(image.getPixelData());
      image.minPixelValue = pixelValues.minPixelValue;
      image.maxPixelValue = pixelValues.maxPixelValue;
      image.windowWidth = 255;
      image.windowCenter = 128; // Cache the last colormapId used for performance
      // Then it doesn't need to be re-rendered on next
      // Time if the user hasn't updated it

      image.colormapId = colormapId;
    } // Return `true` to tell the caller that the image has got updated


    return true;
  }
  /**
   * Convert the image of a element to a false color image
   *
   * @param {HTMLElement} element The Cornerstone element
   * @param {*} colormap - it can be a colormap object or a colormap id (string)
   *
   * @returns {void}
   */


  function convertToFalseColorImage(element, colormap) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    return convertImageToFalseColorImage(enabledElement.image, colormap);
  }



  /***/ }),

  /***/ "./fitToWindow.js":
  /*!************************!*\
    !*** ./fitToWindow.js ***!
    \************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");
  /* harmony import */ var _internal_getImageFitScale_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./internal/getImageFitScale.js */ "./internal/getImageFitScale.js");



  /**
   * Adjusts an image's scale and translation so the image is centered and all pixels
   * in the image are viewable.
   *
   * @param {HTMLElement} element The Cornerstone element to update
   * @returns {void}
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var image = enabledElement.image; // The new scale is the minimum of the horizontal and vertical scale values

    enabledElement.viewport.scale = Object(_internal_getImageFitScale_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement.canvas, image, enabledElement.viewport.rotation).scaleFactor;
    enabledElement.viewport.translation.x = 0;
    enabledElement.viewport.translation.y = 0;
    Object(_updateImage_js__WEBPACK_IMPORTED_MODULE_1__["default"])(element);
  });

  /***/ }),

  /***/ "./generateUUID.js":
  /*!*************************!*\
    !*** ./generateUUID.js ***!
    \*************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
  * Generates a UUID for the enabledElement.
  *
  * @return {String} the UUID.
  */
  /* harmony default export */ __webpack_exports__["default"] = (function () {
    // https://stackoverflow.com/a/8809472/9208320 Public Domain/MIT

    /* eslint no-bitwise: ["error", { "allow": ["&","|"] }] */
    var d = new Date().getTime();

    if (typeof performance !== 'undefined' && typeof performance.now === 'function') {
      d += performance.now(); // Use high-precision timer if available
    }

    return 'x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
      var r = (d + Math.random() * 16) % 16 | 0;
      d = Math.floor(d / 16);
      return (c === 'x' ? r : r & 0x3 | 0x8).toString(16);
    });
  });

  /***/ }),

  /***/ "./getDefaultViewportForImage.js":
  /*!***************************************!*\
    !*** ./getDefaultViewportForImage.js ***!
    \***************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");


  /**
   * Returns a default viewport for display the specified image on the specified
   * enabled element.  The default viewport is fit to window
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {Image} image A Cornerstone Image Object
   *
   * @returns {Viewport} The default viewport for the image
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, image) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    return Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement.canvas, image);
  });

  /***/ }),

  /***/ "./getImage.js":
  /*!*********************!*\
    !*** ./getImage.js ***!
    \*********************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");

  /**
   * Returns the currently displayed image for an element or undefined if no image has
   * been displayed yet
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @returns {Image} The Cornerstone Image Object displayed in this element
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    return enabledElement.image;
  });

  /***/ }),

  /***/ "./getPixels.js":
  /*!**********************!*\
    !*** ./getPixels.js ***!
    \**********************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _getStoredPixels_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./getStoredPixels.js */ "./getStoredPixels.js");
  /* harmony import */ var _internal_getModalityLUT_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./internal/getModalityLUT.js */ "./internal/getModalityLUT.js");



  /**
   * Retrieves an array of pixels from a rectangular region with modality LUT transformation applied
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {Number} x The x coordinate of the top left corner of the sampling rectangle in image coordinates
   * @param {Number} y The y coordinate of the top left corner of the sampling rectangle in image coordinates
   * @param {Number} width The width of the of the sampling rectangle in image coordinates
   * @param {Number} height The height of the of the sampling rectangle in image coordinates
   * @returns {Array} The modality pixel value of the pixels in the sampling rectangle
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, x, y, width, height) {
    var storedPixels = Object(_getStoredPixels_js__WEBPACK_IMPORTED_MODULE_1__["default"])(element, x, y, width, height);
    var ee = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var mlutfn = Object(_internal_getModalityLUT_js__WEBPACK_IMPORTED_MODULE_2__["default"])(ee.image.slope, ee.image.intercept, ee.viewport.modalityLUT);
    return storedPixels.map(mlutfn);
  });

  /***/ }),

  /***/ "./getStoredPixels.js":
  /*!****************************!*\
    !*** ./getStoredPixels.js ***!
    \****************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");

  /**
   * Retrieves an array of stored pixel values from a rectangular region of an image
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {Number} x The x coordinate of the top left corner of the sampling rectangle in image coordinates
   * @param {Number} y The y coordinate of the top left corner of the sampling rectangle in image coordinates
   * @param {Number} width The width of the of the sampling rectangle in image coordinates
   * @param {Number} height The height of the of the sampling rectangle in image coordinates
   * @returns {Array} The stored pixel value of the pixels in the sampling rectangle
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, x, y, width, height) {
    if (element === undefined) {
      throw new Error('getStoredPixels: parameter element must not be undefined');
    }

    x = Math.round(x);
    y = Math.round(y);
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var storedPixels = [];
    var index = 0;
    var pixelData = enabledElement.image.getPixelData();

    for (var row = 0; row < height; row++) {
      for (var column = 0; column < width; column++) {
        var spIndex = (row + y) * enabledElement.image.columns + (column + x);
        storedPixels[index++] = pixelData[spIndex];
      }
    }

    return storedPixels;
  });

  /***/ }),

  /***/ "./getViewport.js":
  /*!************************!*\
    !*** ./getViewport.js ***!
    \************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");

  /**
   * Retrieves the viewport for the specified enabled element
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @returns {Viewport|undefined} The Cornerstone Viewport settings for this element, if they exist. Otherwise, undefined
   * @memberof ViewportSettings
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var viewport = enabledElement.viewport;

    if (viewport === undefined) {
      return;
    } // Return a copy of the viewport


    return Object.assign({}, viewport);
  });

  /***/ }),

  /***/ "./imageCache.js":
  /*!***********************!*\
    !*** ./imageCache.js ***!
    \***********************/
  /*! exports provided: cachedImages, setMaximumSizeBytes, putImageLoadObject, getImageLoadObject, removeImageLoadObject, getCacheInfo, purgeCache, changeImageIdCacheSize, default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "cachedImages", function() { return cachedImages; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setMaximumSizeBytes", function() { return setMaximumSizeBytes; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "putImageLoadObject", function() { return putImageLoadObject; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getImageLoadObject", function() { return getImageLoadObject; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "removeImageLoadObject", function() { return removeImageLoadObject; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getCacheInfo", function() { return getCacheInfo; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "purgeCache", function() { return purgeCache; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "changeImageIdCacheSize", function() { return changeImageIdCacheSize; });
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./events.js */ "./events.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");


  /**
   * This module deals with caching images
   * @module ImageCache
   */

  var maximumSizeInBytes = 1024 * 1024 * 1024; // 1 GB

  var cacheSizeInBytes = 0; // Dictionary of imageId to cachedImage objects

  var imageCacheDict = {}; // Array of cachedImage objects

  var cachedImages = [];
  /** Sets the maximum size of cache and purges cache contents if necessary.
   *
   * @param {number} numBytes The maximun size that the cache should occupy.
   * @returns {void}
   */

  function setMaximumSizeBytes(numBytes) {
    if (numBytes === undefined) {
      throw new Error('setMaximumSizeBytes: parameter numBytes must not be undefined');
    }

    if (numBytes.toFixed === undefined) {
      throw new Error('setMaximumSizeBytes: parameter numBytes must be a number');
    }

    maximumSizeInBytes = numBytes;
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].IMAGE_CACHE_MAXIMUM_SIZE_CHANGED);
    purgeCacheIfNecessary();
  }
  /**
   * Purges the cache if size exceeds maximum
   * @returns {void}
   */

  function purgeCacheIfNecessary() {
    // If max cache size has not been exceeded, do nothing
    if (cacheSizeInBytes <= maximumSizeInBytes) {
      return;
    } // Cache size has been exceeded, create list of images sorted by timeStamp
    // So we can purge the least recently used image


    function compare(a, b) {
      if (a.timeStamp > b.timeStamp) {
        return -1;
      }

      if (a.timeStamp < b.timeStamp) {
        return 1;
      }

      return 0;
    }

    cachedImages.sort(compare); // Remove images as necessary)

    while (cacheSizeInBytes > maximumSizeInBytes) {
      var lastCachedImage = cachedImages[cachedImages.length - 1];
      var imageId = lastCachedImage.imageId;
      removeImageLoadObject(imageId);
      Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].IMAGE_CACHE_PROMISE_REMOVED, {
        imageId: imageId
      });
    }

    var cacheInfo = getCacheInfo();
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].IMAGE_CACHE_FULL, cacheInfo);
  }
  /**
   * Puts a new image loader into the cache
   *
   * @param {string} imageId ImageId of the image loader
   * @param {Object} imageLoadObject The object that is loading or loaded the image
   * @returns {void}
   */


  function putImageLoadObject(imageId, imageLoadObject) {
    if (imageId === undefined) {
      throw new Error('putImageLoadObject: imageId must not be undefined');
    }

    if (imageLoadObject.promise === undefined) {
      throw new Error('putImageLoadObject: imageLoadObject.promise must not be undefined');
    }

    if (imageCacheDict.hasOwnProperty(imageId) === true) {
      throw new Error('putImageLoadObject: imageId already in cache');
    }

    if (imageLoadObject.cancelFn && typeof imageLoadObject.cancelFn !== 'function') {
      throw new Error('putImageLoadObject: imageLoadObject.cancelFn must be a function');
    }

    var cachedImage = {
      loaded: false,
      imageId: imageId,
      sharedCacheKey: undefined,
      // The sharedCacheKey for this imageId.  undefined by default
      imageLoadObject: imageLoadObject,
      timeStamp: Date.now(),
      sizeInBytes: 0
    };
    imageCacheDict[imageId] = cachedImage;
    cachedImages.push(cachedImage);
    imageLoadObject.promise.then(function (image) {
      if (cachedImages.indexOf(cachedImage) === -1) {
        // If the image has been purged before being loaded, we stop here.
        return;
      }

      cachedImage.loaded = true;
      cachedImage.image = image;

      if (image.sizeInBytes === undefined) {
        throw new Error('putImageLoadObject: image.sizeInBytes must not be undefined');
      }

      if (image.sizeInBytes.toFixed === undefined) {
        throw new Error('putImageLoadObject: image.sizeInBytes is not a number');
      }

      cachedImage.sizeInBytes = image.sizeInBytes;
      cacheSizeInBytes += cachedImage.sizeInBytes;
      var eventDetails = {
        action: 'addImage',
        image: cachedImage
      };
      Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].IMAGE_CACHE_CHANGED, eventDetails);
      cachedImage.sharedCacheKey = image.sharedCacheKey;
      purgeCacheIfNecessary();
    }, function () {
      var cachedImage = imageCacheDict[imageId];
      cachedImages.splice(cachedImages.indexOf(cachedImage), 1);
      delete imageCacheDict[imageId];
    });
  }
  /**
   * Retuns the object that is loading a given imageId
   *
   * @param {string} imageId Image ID
   * @returns {void}
   */

  function getImageLoadObject(imageId) {
    if (imageId === undefined) {
      throw new Error('getImageLoadObject: imageId must not be undefined');
    }

    var cachedImage = imageCacheDict[imageId];

    if (cachedImage === undefined) {
      return;
    } // Bump time stamp for cached image


    cachedImage.timeStamp = Date.now();
    return cachedImage.imageLoadObject;
  }
  /**
   * Removes the image loader associated with a given Id from the cache
   *
   * @param {string} imageId Image ID
   * @returns {void}
   */

  function removeImageLoadObject(imageId) {
    if (imageId === undefined) {
      throw new Error('removeImageLoadObject: imageId must not be undefined');
    }

    var cachedImage = imageCacheDict[imageId];

    if (cachedImage === undefined) {
      throw new Error('removeImageLoadObject: imageId was not present in imageCache');
    }

    cachedImages.splice(cachedImages.indexOf(cachedImage), 1);
    cacheSizeInBytes -= cachedImage.sizeInBytes;
    var eventDetails = {
      action: 'deleteImage',
      image: cachedImage
    };
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].IMAGE_CACHE_CHANGED, eventDetails);
    decache(cachedImage.imageLoadObject);
    delete imageCacheDict[imageId];
  }
  /**
   * @typedef {Object} CacheInformation
   * @property {number} maximumSizeInBytes  The maximum size of the cache in bytes
   * @property {number} cacheSizeInBytes Currently occupied space in the cache in bytes
   * @property {number} numberOfImagesCached Number of ImageLoaders in the cache
   * @returns {void}
   */

  /**
   * Gets the current state of the cache
   * @returns {void}
   */

  function getCacheInfo() {
    return {
      maximumSizeInBytes: maximumSizeInBytes,
      cacheSizeInBytes: cacheSizeInBytes,
      numberOfImagesCached: cachedImages.length
    };
  } // This method should only be called by `removeImageLoadObject` because it's
  // The one that knows how to deal with shared cache keys and cache size.

  /**
   * INTERNAL: Removes and ImageLoader from the cache
   *
   * @param {Object} imageLoadObject Image Loader Object to remove
   * @returns {void}
   */

  function decache(imageLoadObject) {
    imageLoadObject.promise.then(function () {
      if (imageLoadObject.decache) {
        imageLoadObject.decache();
      }
    }, function () {
      if (imageLoadObject.decache) {
        imageLoadObject.decache();
      }
    });
  }
  /**
   * Removes all images from cache
   * @returns {void}
   */


  function purgeCache() {
    while (cachedImages.length > 0) {
      var removedCachedImage = cachedImages[0];
      removeImageLoadObject(removedCachedImage.imageId);
    }
  }
  /**
   * Updates the space than an image is using in the cache
   *
   * @param {string} imageId Image ID
   * @param {number} newCacheSize New image size
   * @returns {void}
   */

  function changeImageIdCacheSize(imageId, newCacheSize) {
    var cacheEntry = imageCacheDict[imageId];

    if (cacheEntry) {
      cacheEntry.imageLoadObject.promise.then(function (image) {
        var cacheSizeDifference = newCacheSize - image.sizeInBytes;
        image.sizeInBytes = newCacheSize;
        cacheEntry.sizeInBytes = newCacheSize;
        cacheSizeInBytes += cacheSizeDifference;
        var eventDetails = {
          action: 'changeImageSize',
          image: image
        };
        Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].IMAGE_CACHE_CHANGED, eventDetails);
      });
    }
  }
  /* harmony default export */ __webpack_exports__["default"] = ({
    imageCache: imageCacheDict,
    cachedImages: cachedImages,
    setMaximumSizeBytes: setMaximumSizeBytes,
    putImageLoadObject: putImageLoadObject,
    getImageLoadObject: getImageLoadObject,
    removeImageLoadObject: removeImageLoadObject,
    getCacheInfo: getCacheInfo,
    purgeCache: purgeCache,
    changeImageIdCacheSize: changeImageIdCacheSize
  });

  /***/ }),

  /***/ "./imageLoader.js":
  /*!************************!*\
    !*** ./imageLoader.js ***!
    \************************/
  /*! exports provided: loadImage, loadAndCacheImage, registerImageLoader, registerUnknownImageLoader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "loadImage", function() { return loadImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "loadAndCacheImage", function() { return loadAndCacheImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "registerImageLoader", function() { return registerImageLoader; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "registerUnknownImageLoader", function() { return registerUnknownImageLoader; });
  /* harmony import */ var _imageCache_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./imageCache.js */ "./imageCache.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./events.js */ "./events.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");



  /**
   * This module deals with ImageLoaders, loading images and caching images
   * @module ImageLoader
   */

  var imageLoaders = {};
  var unknownImageLoader;
  /**
   * Load an image using a registered Cornerstone Image Loader.
   *
   * The image loader that is used will be
   * determined by the image loader scheme matching against the imageId.
   *
   * @param {String} imageId A Cornerstone Image Object's imageId
   * @param {Object} [options] Options to be passed to the Image Loader
   *
   * @returns {ImageLoadObject} An Object which can be used to act after an image is loaded or loading fails
   * @memberof ImageLoader
   */

  function loadImageFromImageLoader(imageId, options) {
    var colonIndex = imageId.indexOf(':');
    var scheme = imageId.substring(0, colonIndex);
    var loader = imageLoaders[scheme];

    if (loader === undefined || loader === null) {
      if (unknownImageLoader !== undefined) {
        return unknownImageLoader(imageId);
      }

      throw new Error('loadImageFromImageLoader: no image loader for imageId');
    }

    var imageLoadObject = loader(imageId, options); // Broadcast an image loaded event once the image is loaded

    imageLoadObject.promise.then(function (image) {
      Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_2__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_1__["events"], _events_js__WEBPACK_IMPORTED_MODULE_1__["default"].IMAGE_LOADED, {
        image: image
      });
    }, function (error) {
      var errorObject = {
        imageId: imageId,
        error: error
      };
      Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_2__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_1__["events"], _events_js__WEBPACK_IMPORTED_MODULE_1__["default"].IMAGE_LOAD_FAILED, errorObject);
    });
    return imageLoadObject;
  }
  /**
   * Loads an image given an imageId and optional priority and returns a promise which will resolve to
   * the loaded image object or fail if an error occurred.  The loaded image is not stored in the cache.
   *
   * @param {String} imageId A Cornerstone Image Object's imageId
   * @param {Object} [options] Options to be passed to the Image Loader
   *
   * @returns {ImageLoadObject} An Object which can be used to act after an image is loaded or loading fails
   * @memberof ImageLoader
   */


  function loadImage(imageId, options) {
    if (imageId === undefined) {
      throw new Error('loadImage: parameter imageId must not be undefined');
    }

    var imageLoadObject = Object(_imageCache_js__WEBPACK_IMPORTED_MODULE_0__["getImageLoadObject"])(imageId);

    if (imageLoadObject !== undefined) {
      return imageLoadObject.promise;
    }

    return loadImageFromImageLoader(imageId, options).promise;
  } //

  /**
   * Loads an image given an imageId and optional priority and returns a promise which will resolve to
   * the loaded image object or fail if an error occurred. The image is stored in the cache.
   *
   * @param {String} imageId A Cornerstone Image Object's imageId
   * @param {Object} [options] Options to be passed to the Image Loader
   *
   * @returns {ImageLoadObject} Image Loader Object
   * @memberof ImageLoader
   */

  function loadAndCacheImage(imageId, options) {
    if (imageId === undefined) {
      throw new Error('loadAndCacheImage: parameter imageId must not be undefined');
    }

    var imageLoadObject = Object(_imageCache_js__WEBPACK_IMPORTED_MODULE_0__["getImageLoadObject"])(imageId);

    if (imageLoadObject !== undefined) {
      return imageLoadObject.promise;
    }

    imageLoadObject = loadImageFromImageLoader(imageId, options);
    Object(_imageCache_js__WEBPACK_IMPORTED_MODULE_0__["putImageLoadObject"])(imageId, imageLoadObject);
    return imageLoadObject.promise;
  }
  /**
   * Registers an imageLoader plugin with cornerstone for the specified scheme
   *
   * @param {String} scheme The scheme to use for this image loader (e.g. 'dicomweb', 'wadouri', 'http')
   * @param {Function} imageLoader A Cornerstone Image Loader function
   * @returns {void}
   * @memberof ImageLoader
   */

  function registerImageLoader(scheme, imageLoader) {
    imageLoaders[scheme] = imageLoader;
  }
  /**
   * Registers a new unknownImageLoader and returns the previous one
   *
   * @param {Function} imageLoader A Cornerstone Image Loader
   *
   * @returns {Function|Undefined} The previous Unknown Image Loader
   * @memberof ImageLoader
   */

  function registerUnknownImageLoader(imageLoader) {
    var oldImageLoader = unknownImageLoader;
    unknownImageLoader = imageLoader;
    return oldImageLoader;
  }

  /***/ }),

  /***/ "./index.js":
  /*!******************!*\
    !*** ./index.js ***!
    \******************/
  /*! exports provided: drawImage, generateLut, getDefaultViewport, requestAnimationFrame, storedPixelDataToCanvasImageData, storedColorPixelDataToCanvasImageData, storedPixelDataToCanvasImageDataColorLUT, storedPixelDataToCanvasImageDataPseudocolorLUT, internal, renderLabelMapImage, renderPseudoColorImage, renderColorImage, renderGrayscaleImage, renderWebImage, renderToCanvas, canvasToPixel, disable, displayImage, draw, drawInvalidated, enable, getElementData, removeElementData, getEnabledElement, addEnabledElement, getEnabledElementsByImageId, getEnabledElements, addLayer, removeLayer, getLayer, getLayers, getVisibleLayers, setActiveLayer, getActiveLayer, purgeLayers, setLayerImage, fitToWindow, getDefaultViewportForImage, getImage, getPixels, getStoredPixels, getViewport, loadImage, loadAndCacheImage, registerImageLoader, registerUnknownImageLoader, invalidate, invalidateImageId, pageToPixel, pixelToCanvas, reset, resize, setToPixelCoordinateSystem, setViewport, updateImage, pixelDataToFalseColorData, rendering, imageCache, metaData, webGL, colors, convertImageToFalseColorImage, convertToFalseColorImage, restoreImage, EVENTS, events, triggerEvent, default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./internal/drawImage.js */ "./internal/drawImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "drawImage", function() { return _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_0__["default"]; });

  /* harmony import */ var _internal_generateLut_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/generateLut.js */ "./internal/generateLut.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "generateLut", function() { return _internal_generateLut_js__WEBPACK_IMPORTED_MODULE_1__["default"]; });

  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getDefaultViewport", function() { return _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__["default"]; });

  /* harmony import */ var _internal_requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./internal/requestAnimationFrame.js */ "./internal/requestAnimationFrame.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "requestAnimationFrame", function() { return _internal_requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__["default"]; });

  /* harmony import */ var _internal_storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./internal/storedPixelDataToCanvasImageData.js */ "./internal/storedPixelDataToCanvasImageData.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "storedPixelDataToCanvasImageData", function() { return _internal_storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_4__["default"]; });

  /* harmony import */ var _internal_storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./internal/storedColorPixelDataToCanvasImageData.js */ "./internal/storedColorPixelDataToCanvasImageData.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "storedColorPixelDataToCanvasImageData", function() { return _internal_storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_5__["default"]; });

  /* harmony import */ var _internal_storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./internal/storedPixelDataToCanvasImageDataColorLUT.js */ "./internal/storedPixelDataToCanvasImageDataColorLUT.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "storedPixelDataToCanvasImageDataColorLUT", function() { return _internal_storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_6__["default"]; });

  /* harmony import */ var _internal_storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js */ "./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "storedPixelDataToCanvasImageDataPseudocolorLUT", function() { return _internal_storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_7__["default"]; });

  /* harmony import */ var _internal_index_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./internal/index.js */ "./internal/index.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "internal", function() { return _internal_index_js__WEBPACK_IMPORTED_MODULE_8__["default"]; });

  /* harmony import */ var _rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./rendering/renderLabelMapImage.js */ "./rendering/renderLabelMapImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "renderLabelMapImage", function() { return _rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_9__["renderLabelMapImage"]; });

  /* harmony import */ var _rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./rendering/renderPseudoColorImage.js */ "./rendering/renderPseudoColorImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "renderPseudoColorImage", function() { return _rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_10__["renderPseudoColorImage"]; });

  /* harmony import */ var _rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./rendering/renderColorImage.js */ "./rendering/renderColorImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "renderColorImage", function() { return _rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_11__["renderColorImage"]; });

  /* harmony import */ var _rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./rendering/renderGrayscaleImage.js */ "./rendering/renderGrayscaleImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "renderGrayscaleImage", function() { return _rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_12__["renderGrayscaleImage"]; });

  /* harmony import */ var _rendering_renderWebImage_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./rendering/renderWebImage.js */ "./rendering/renderWebImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "renderWebImage", function() { return _rendering_renderWebImage_js__WEBPACK_IMPORTED_MODULE_13__["renderWebImage"]; });

  /* harmony import */ var _rendering_renderToCanvas_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./rendering/renderToCanvas.js */ "./rendering/renderToCanvas.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "renderToCanvas", function() { return _rendering_renderToCanvas_js__WEBPACK_IMPORTED_MODULE_14__["default"]; });

  /* harmony import */ var _canvasToPixel_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./canvasToPixel.js */ "./canvasToPixel.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "canvasToPixel", function() { return _canvasToPixel_js__WEBPACK_IMPORTED_MODULE_15__["default"]; });

  /* harmony import */ var _disable_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./disable.js */ "./disable.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "disable", function() { return _disable_js__WEBPACK_IMPORTED_MODULE_16__["default"]; });

  /* harmony import */ var _displayImage_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./displayImage.js */ "./displayImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "displayImage", function() { return _displayImage_js__WEBPACK_IMPORTED_MODULE_17__["default"]; });

  /* harmony import */ var _draw_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./draw.js */ "./draw.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "draw", function() { return _draw_js__WEBPACK_IMPORTED_MODULE_18__["default"]; });

  /* harmony import */ var _drawInvalidated_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./drawInvalidated.js */ "./drawInvalidated.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "drawInvalidated", function() { return _drawInvalidated_js__WEBPACK_IMPORTED_MODULE_19__["default"]; });

  /* harmony import */ var _enable_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./enable.js */ "./enable.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "enable", function() { return _enable_js__WEBPACK_IMPORTED_MODULE_20__["default"]; });

  /* harmony import */ var _enabledElementData_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./enabledElementData.js */ "./enabledElementData.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getElementData", function() { return _enabledElementData_js__WEBPACK_IMPORTED_MODULE_21__["getElementData"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "removeElementData", function() { return _enabledElementData_js__WEBPACK_IMPORTED_MODULE_21__["removeElementData"]; });

  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getEnabledElement", function() { return _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["getEnabledElement"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "addEnabledElement", function() { return _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["addEnabledElement"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getEnabledElementsByImageId", function() { return _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["getEnabledElementsByImageId"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getEnabledElements", function() { return _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["getEnabledElements"]; });

  /* harmony import */ var _layers_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./layers.js */ "./layers.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "addLayer", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["addLayer"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "removeLayer", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["removeLayer"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getLayer", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["getLayer"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getLayers", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["getLayers"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getVisibleLayers", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["getVisibleLayers"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "setActiveLayer", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["setActiveLayer"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getActiveLayer", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["getActiveLayer"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "purgeLayers", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["purgeLayers"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "setLayerImage", function() { return _layers_js__WEBPACK_IMPORTED_MODULE_23__["setLayerImage"]; });

  /* harmony import */ var _fitToWindow_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./fitToWindow.js */ "./fitToWindow.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "fitToWindow", function() { return _fitToWindow_js__WEBPACK_IMPORTED_MODULE_24__["default"]; });

  /* harmony import */ var _getDefaultViewportForImage_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./getDefaultViewportForImage.js */ "./getDefaultViewportForImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getDefaultViewportForImage", function() { return _getDefaultViewportForImage_js__WEBPACK_IMPORTED_MODULE_25__["default"]; });

  /* harmony import */ var _getImage_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./getImage.js */ "./getImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getImage", function() { return _getImage_js__WEBPACK_IMPORTED_MODULE_26__["default"]; });

  /* harmony import */ var _getPixels_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./getPixels.js */ "./getPixels.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getPixels", function() { return _getPixels_js__WEBPACK_IMPORTED_MODULE_27__["default"]; });

  /* harmony import */ var _getStoredPixels_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./getStoredPixels.js */ "./getStoredPixels.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getStoredPixels", function() { return _getStoredPixels_js__WEBPACK_IMPORTED_MODULE_28__["default"]; });

  /* harmony import */ var _getViewport_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./getViewport.js */ "./getViewport.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "getViewport", function() { return _getViewport_js__WEBPACK_IMPORTED_MODULE_29__["default"]; });

  /* harmony import */ var _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./imageLoader.js */ "./imageLoader.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "loadImage", function() { return _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["loadImage"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "loadAndCacheImage", function() { return _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["loadAndCacheImage"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "registerImageLoader", function() { return _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["registerImageLoader"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "registerUnknownImageLoader", function() { return _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["registerUnknownImageLoader"]; });

  /* harmony import */ var _invalidate_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./invalidate.js */ "./invalidate.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "invalidate", function() { return _invalidate_js__WEBPACK_IMPORTED_MODULE_31__["default"]; });

  /* harmony import */ var _invalidateImageId_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./invalidateImageId.js */ "./invalidateImageId.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "invalidateImageId", function() { return _invalidateImageId_js__WEBPACK_IMPORTED_MODULE_32__["default"]; });

  /* harmony import */ var _pageToPixel_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./pageToPixel.js */ "./pageToPixel.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "pageToPixel", function() { return _pageToPixel_js__WEBPACK_IMPORTED_MODULE_33__["default"]; });

  /* harmony import */ var _pixelToCanvas_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./pixelToCanvas.js */ "./pixelToCanvas.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "pixelToCanvas", function() { return _pixelToCanvas_js__WEBPACK_IMPORTED_MODULE_34__["default"]; });

  /* harmony import */ var _reset_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./reset.js */ "./reset.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "reset", function() { return _reset_js__WEBPACK_IMPORTED_MODULE_35__["default"]; });

  /* harmony import */ var _resize_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./resize.js */ "./resize.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "resize", function() { return _resize_js__WEBPACK_IMPORTED_MODULE_36__["default"]; });

  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "setToPixelCoordinateSystem", function() { return _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_37__["default"]; });

  /* harmony import */ var _setViewport_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./setViewport.js */ "./setViewport.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "setViewport", function() { return _setViewport_js__WEBPACK_IMPORTED_MODULE_38__["default"]; });

  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "updateImage", function() { return _updateImage_js__WEBPACK_IMPORTED_MODULE_39__["default"]; });

  /* harmony import */ var _pixelDataToFalseColorData_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./pixelDataToFalseColorData.js */ "./pixelDataToFalseColorData.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "pixelDataToFalseColorData", function() { return _pixelDataToFalseColorData_js__WEBPACK_IMPORTED_MODULE_40__["default"]; });

  /* harmony import */ var _rendering_index_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./rendering/index.js */ "./rendering/index.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "rendering", function() { return _rendering_index_js__WEBPACK_IMPORTED_MODULE_41__["default"]; });

  /* harmony import */ var _imageCache_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./imageCache.js */ "./imageCache.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "imageCache", function() { return _imageCache_js__WEBPACK_IMPORTED_MODULE_42__["default"]; });

  /* harmony import */ var _metaData_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./metaData.js */ "./metaData.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "metaData", function() { return _metaData_js__WEBPACK_IMPORTED_MODULE_43__["default"]; });

  /* harmony import */ var _webgl_index_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./webgl/index.js */ "./webgl/index.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "webGL", function() { return _webgl_index_js__WEBPACK_IMPORTED_MODULE_44__["default"]; });

  /* harmony import */ var _colors_index_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./colors/index.js */ "./colors/index.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "colors", function() { return _colors_index_js__WEBPACK_IMPORTED_MODULE_45__["default"]; });

  /* harmony import */ var _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./falseColorMapping.js */ "./falseColorMapping.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "convertImageToFalseColorImage", function() { return _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__["convertImageToFalseColorImage"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "convertToFalseColorImage", function() { return _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__["convertToFalseColorImage"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "restoreImage", function() { return _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__["restoreImage"]; });

  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./events.js */ "./events.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "EVENTS", function() { return _events_js__WEBPACK_IMPORTED_MODULE_47__["default"]; });

  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "events", function() { return _events_js__WEBPACK_IMPORTED_MODULE_47__["events"]; });

  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "triggerEvent", function() { return _triggerEvent_js__WEBPACK_IMPORTED_MODULE_48__["default"]; });

  // Internal (some of these are from old internal/legacy expose)








   // Rendering







  /**
   * @module PixelCoordinateSystem
   */

  /**
   * @module ViewportSettings
   */



































  var cornerstone = {
    drawImage: _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_0__["default"],
    generateLut: _internal_generateLut_js__WEBPACK_IMPORTED_MODULE_1__["default"],
    getDefaultViewport: _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__["default"],
    requestAnimationFrame: _internal_requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__["default"],
    storedPixelDataToCanvasImageData: _internal_storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_4__["default"],
    storedColorPixelDataToCanvasImageData: _internal_storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_5__["default"],
    storedPixelDataToCanvasImageDataColorLUT: _internal_storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_6__["default"],
    storedPixelDataToCanvasImageDataPseudocolorLUT: _internal_storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_7__["default"],
    internal: _internal_index_js__WEBPACK_IMPORTED_MODULE_8__["default"],
    renderLabelMapImage: _rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_9__["renderLabelMapImage"],
    renderPseudoColorImage: _rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_10__["renderPseudoColorImage"],
    renderColorImage: _rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_11__["renderColorImage"],
    renderGrayscaleImage: _rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_12__["renderGrayscaleImage"],
    renderWebImage: _rendering_renderWebImage_js__WEBPACK_IMPORTED_MODULE_13__["renderWebImage"],
    renderToCanvas: _rendering_renderToCanvas_js__WEBPACK_IMPORTED_MODULE_14__["default"],
    canvasToPixel: _canvasToPixel_js__WEBPACK_IMPORTED_MODULE_15__["default"],
    disable: _disable_js__WEBPACK_IMPORTED_MODULE_16__["default"],
    displayImage: _displayImage_js__WEBPACK_IMPORTED_MODULE_17__["default"],
    draw: _draw_js__WEBPACK_IMPORTED_MODULE_18__["default"],
    drawInvalidated: _drawInvalidated_js__WEBPACK_IMPORTED_MODULE_19__["default"],
    enable: _enable_js__WEBPACK_IMPORTED_MODULE_20__["default"],
    getElementData: _enabledElementData_js__WEBPACK_IMPORTED_MODULE_21__["getElementData"],
    removeElementData: _enabledElementData_js__WEBPACK_IMPORTED_MODULE_21__["removeElementData"],
    getEnabledElement: _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["getEnabledElement"],
    addEnabledElement: _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["addEnabledElement"],
    getEnabledElementsByImageId: _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["getEnabledElementsByImageId"],
    getEnabledElements: _enabledElements_js__WEBPACK_IMPORTED_MODULE_22__["getEnabledElements"],
    addLayer: _layers_js__WEBPACK_IMPORTED_MODULE_23__["addLayer"],
    removeLayer: _layers_js__WEBPACK_IMPORTED_MODULE_23__["removeLayer"],
    getLayer: _layers_js__WEBPACK_IMPORTED_MODULE_23__["getLayer"],
    getLayers: _layers_js__WEBPACK_IMPORTED_MODULE_23__["getLayers"],
    getVisibleLayers: _layers_js__WEBPACK_IMPORTED_MODULE_23__["getVisibleLayers"],
    setActiveLayer: _layers_js__WEBPACK_IMPORTED_MODULE_23__["setActiveLayer"],
    getActiveLayer: _layers_js__WEBPACK_IMPORTED_MODULE_23__["getActiveLayer"],
    purgeLayers: _layers_js__WEBPACK_IMPORTED_MODULE_23__["purgeLayers"],
    setLayerImage: _layers_js__WEBPACK_IMPORTED_MODULE_23__["setLayerImage"],
    fitToWindow: _fitToWindow_js__WEBPACK_IMPORTED_MODULE_24__["default"],
    getDefaultViewportForImage: _getDefaultViewportForImage_js__WEBPACK_IMPORTED_MODULE_25__["default"],
    getImage: _getImage_js__WEBPACK_IMPORTED_MODULE_26__["default"],
    getPixels: _getPixels_js__WEBPACK_IMPORTED_MODULE_27__["default"],
    getStoredPixels: _getStoredPixels_js__WEBPACK_IMPORTED_MODULE_28__["default"],
    getViewport: _getViewport_js__WEBPACK_IMPORTED_MODULE_29__["default"],
    loadImage: _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["loadImage"],
    loadAndCacheImage: _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["loadAndCacheImage"],
    registerImageLoader: _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["registerImageLoader"],
    registerUnknownImageLoader: _imageLoader_js__WEBPACK_IMPORTED_MODULE_30__["registerUnknownImageLoader"],
    invalidate: _invalidate_js__WEBPACK_IMPORTED_MODULE_31__["default"],
    invalidateImageId: _invalidateImageId_js__WEBPACK_IMPORTED_MODULE_32__["default"],
    pageToPixel: _pageToPixel_js__WEBPACK_IMPORTED_MODULE_33__["default"],
    pixelToCanvas: _pixelToCanvas_js__WEBPACK_IMPORTED_MODULE_34__["default"],
    reset: _reset_js__WEBPACK_IMPORTED_MODULE_35__["default"],
    resize: _resize_js__WEBPACK_IMPORTED_MODULE_36__["default"],
    setToPixelCoordinateSystem: _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_37__["default"],
    setViewport: _setViewport_js__WEBPACK_IMPORTED_MODULE_38__["default"],
    updateImage: _updateImage_js__WEBPACK_IMPORTED_MODULE_39__["default"],
    pixelDataToFalseColorData: _pixelDataToFalseColorData_js__WEBPACK_IMPORTED_MODULE_40__["default"],
    rendering: _rendering_index_js__WEBPACK_IMPORTED_MODULE_41__["default"],
    imageCache: _imageCache_js__WEBPACK_IMPORTED_MODULE_42__["default"],
    metaData: _metaData_js__WEBPACK_IMPORTED_MODULE_43__["default"],
    webGL: _webgl_index_js__WEBPACK_IMPORTED_MODULE_44__["default"],
    colors: _colors_index_js__WEBPACK_IMPORTED_MODULE_45__["default"],
    convertImageToFalseColorImage: _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__["convertImageToFalseColorImage"],
    convertToFalseColorImage: _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__["convertToFalseColorImage"],
    restoreImage: _falseColorMapping_js__WEBPACK_IMPORTED_MODULE_46__["restoreImage"],
    EVENTS: _events_js__WEBPACK_IMPORTED_MODULE_47__["default"],
    events: _events_js__WEBPACK_IMPORTED_MODULE_47__["events"],
    triggerEvent: _triggerEvent_js__WEBPACK_IMPORTED_MODULE_48__["default"]
  };

  /* harmony default export */ __webpack_exports__["default"] = (cornerstone);

  /***/ }),

  /***/ "./internal/calculateTransform.js":
  /*!****************************************!*\
    !*** ./internal/calculateTransform.js ***!
    \****************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _transform_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./transform.js */ "./internal/transform.js");

  /**
   * Calculate the transform for a Cornerstone enabled element
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element
   * @param {Number} [scale] The viewport scale
   * @return {Transform} The current transform
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement, scale) {
    var transform = new _transform_js__WEBPACK_IMPORTED_MODULE_0__["Transform"](); // Move to center of canvas

    transform.translate(enabledElement.canvas.width / 2, enabledElement.canvas.height / 2); // Apply the rotation before scaling for non square pixels

    var angle = enabledElement.viewport.rotation;

    if (angle !== 0) {
      transform.rotate(angle * Math.PI / 180);
    } // Apply the scale


    var widthScale = enabledElement.viewport.scale;
    var heightScale = enabledElement.viewport.scale;
    var width = enabledElement.viewport.displayedArea.brhc.x - (enabledElement.viewport.displayedArea.tlhc.x - 1);
    var height = enabledElement.viewport.displayedArea.brhc.y - (enabledElement.viewport.displayedArea.tlhc.y - 1);

    if (enabledElement.viewport.displayedArea.presentationSizeMode === 'NONE') {
      if (enabledElement.image.rowPixelSpacing < enabledElement.image.columnPixelSpacing) {
        widthScale *= enabledElement.image.columnPixelSpacing / enabledElement.image.rowPixelSpacing;
      } else if (enabledElement.image.columnPixelSpacing < enabledElement.image.rowPixelSpacing) {
        heightScale *= enabledElement.image.rowPixelSpacing / enabledElement.image.columnPixelSpacing;
      }
    } else {
      // These should be good for "TRUE SIZE" and "MAGNIFY"
      widthScale = enabledElement.viewport.displayedArea.columnPixelSpacing;
      heightScale = enabledElement.viewport.displayedArea.rowPixelSpacing;

      if (enabledElement.viewport.displayedArea.presentationSizeMode === 'SCALE TO FIT') {
        // Fit TRUE IMAGE image (width/height) to window
        var verticalScale = enabledElement.canvas.height / (height * heightScale);
        var horizontalScale = enabledElement.canvas.width / (width * widthScale); // Apply new scale

        widthScale = heightScale = Math.min(horizontalScale, verticalScale);

        if (enabledElement.viewport.displayedArea.rowPixelSpacing < enabledElement.viewport.displayedArea.columnPixelSpacing) {
          widthScale *= enabledElement.viewport.displayedArea.columnPixelSpacing / enabledElement.viewport.displayedArea.rowPixelSpacing;
        } else if (enabledElement.viewport.displayedArea.columnPixelSpacing < enabledElement.viewport.displayedArea.rowPixelSpacing) {
          heightScale *= enabledElement.viewport.displayedArea.rowPixelSpacing / enabledElement.viewport.displayedArea.columnPixelSpacing;
        }
      }
    }

    transform.scale(widthScale, heightScale); // Unrotate to so we can translate unrotated

    if (angle !== 0) {
      transform.rotate(-angle * Math.PI / 180);
    } // Apply the pan offset


    transform.translate(enabledElement.viewport.translation.x, enabledElement.viewport.translation.y); // Rotate again so we can apply general scale

    if (angle !== 0) {
      transform.rotate(angle * Math.PI / 180);
    }

    if (scale !== undefined) {
      // Apply the font scale
      transform.scale(scale, scale);
    } // Apply Flip if required


    if (enabledElement.viewport.hflip) {
      transform.scale(-1, 1);
    }

    if (enabledElement.viewport.vflip) {
      transform.scale(1, -1);
    } // Move back from center of image


    transform.translate(-width / 2, -height / 2);
    return transform;
  });

  /***/ }),

  /***/ "./internal/computeAutoVoi.js":
  /*!************************************!*\
    !*** ./internal/computeAutoVoi.js ***!
    \************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return computeAutoVoi; });
  /**
   * Computes the VOI to display all the pixels if no VOI LUT data (Window Width/Window Center or voiLUT) exists on the viewport object.
   *
   * @param {Viewport} viewport - Object containing the viewport properties
   * @param {Object} image An Image loaded by a Cornerstone Image Loader
   * @returns {void}
   * @memberof Internal
   */
  function computeAutoVoi(viewport, image) {
    if (hasVoi(viewport)) {
      return;
    }

    var maxVoi = image.maxPixelValue * image.slope + image.intercept;
    var minVoi = image.minPixelValue * image.slope + image.intercept;
    var ww = maxVoi - minVoi;
    var wc = (maxVoi + minVoi) / 2;

    if (viewport.voi === undefined) {
      viewport.voi = {
        windowWidth: ww,
        windowCenter: wc
      };
    } else {
      viewport.voi.windowWidth = ww;
      viewport.voi.windowCenter = wc;
    }
  }
  /**
   * Check if viewport has voi LUT data
   * @param {any} viewport The viewport to check for voi LUT data
   * @returns {Boolean} true viewport has LUT data (Window Width/Window Center or voiLUT). Otherwise, false.
   * @memberof Internal
   */

  function hasVoi(viewport) {
    var hasLut = viewport.voiLUT && viewport.voiLUT.lut && viewport.voiLUT.lut.length > 0;
    return hasLut || viewport.voi.windowWidth !== undefined && viewport.voi.windowCenter !== undefined;
  }

  /***/ }),

  /***/ "./internal/drawCompositeImage.js":
  /*!****************************************!*\
    !*** ./internal/drawCompositeImage.js ***!
    \****************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _layers_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../layers.js */ "./layers.js");
  /* harmony import */ var _rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../rendering/renderGrayscaleImage.js */ "./rendering/renderGrayscaleImage.js");
  /* harmony import */ var _rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../rendering/renderColorImage.js */ "./rendering/renderColorImage.js");
  /* harmony import */ var _rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../rendering/renderPseudoColorImage.js */ "./rendering/renderPseudoColorImage.js");
  /* harmony import */ var _rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../rendering/renderLabelMapImage.js */ "./rendering/renderLabelMapImage.js");
  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");







  function getViewportRatio(baseLayer, targetLayer) {
    if (!baseLayer.syncProps) {
      updateLayerSyncProps(baseLayer);
    }

    if (!targetLayer.syncProps) {
      updateLayerSyncProps(targetLayer);
    }

    return targetLayer.syncProps.originalScale / baseLayer.syncProps.originalScale;
  }

  function updateLayerSyncProps(layer) {
    var syncProps = layer.syncProps || {}; // This is used to keep each of the layers' viewports in sync with the active layer

    syncProps.originalScale = layer.viewport.scale;
    layer.syncProps = syncProps;
  } // Sync all viewports based on active layer's viewport


  function syncViewports(layers, activeLayer) {
    // If we intend to keep the viewport's scale, translation and rotation in sync,
    // loop through the layers
    layers.forEach(function (layer) {
      // Don't do anything to the active layer
      // Don't do anything if this layer has no viewport
      if (layer === activeLayer || !layer.viewport || !activeLayer.viewport) {
        return;
      }

      if (!layer.syncProps) {
        updateLayerSyncProps(layer);
      }

      var viewportRatio = getViewportRatio(activeLayer, layer); // Update the layer's translation and scale to keep them in sync with the first image
      // based on the ratios between the images

      layer.viewport.scale = activeLayer.viewport.scale * viewportRatio;
      layer.viewport.rotation = activeLayer.viewport.rotation;
      layer.viewport.translation = {
        x: activeLayer.viewport.translation.x / viewportRatio,
        y: activeLayer.viewport.translation.y / viewportRatio
      };
      layer.viewport.hflip = activeLayer.viewport.hflip;
      layer.viewport.vflip = activeLayer.viewport.vflip;
    });
  }
  /**
   * Internal function to render all layers for a Cornerstone enabled element
   *
   * @param {CanvasRenderingContext2D} context Canvas context to draw upon
   * @param {EnabledElementLayer[]} layers The array of all layers for this enabled element
   * @param {Boolean} invalidated A boolean whether or not this image has been invalidated and must be redrawn
   * @returns {void}
   * @memberof Internal
   */


  function renderLayers(context, layers, invalidated) {
    // Loop through each layer and draw it to the canvas
    layers.forEach(function (layer, index) {
      if (!layer.image) {
        return;
      }

      context.save(); // Set the layer's canvas to the pixel coordinate system

      layer.canvas = context.canvas;
      Object(_setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_5__["default"])(layer, context); // Render into the layer's canvas

      var colormap = layer.viewport.colormap || layer.options.colormap;
      var labelmap = layer.viewport.labelmap;
      var isInvalid = layer.invalid || invalidated;

      if (colormap && colormap !== '' && labelmap === true) {
        Object(_rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_4__["addLabelMapLayer"])(layer, isInvalid);
      } else if (colormap && colormap !== '') {
        Object(_rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_3__["addPseudoColorLayer"])(layer, isInvalid);
      } else if (layer.image.color === true) {
        Object(_rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_2__["addColorLayer"])(layer, isInvalid);
      } else {
        // If this is the base layer, use the alpha channel for rendering of the grayscale image
        var useAlphaChannel = index === 0;
        Object(_rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_1__["addGrayscaleLayer"])(layer, isInvalid, useAlphaChannel);
      } // Apply any global opacity settings that have been defined for this layer


      if (layer.options && layer.options.opacity) {
        context.globalAlpha = layer.options.opacity;
      } else {
        context.globalAlpha = 1;
      }

      if (layer.options && layer.options.fillStyle) {
        context.fillStyle = layer.options.fillStyle;
      } // Set the pixelReplication property before drawing from the layer into the
      // composite canvas


      context.imageSmoothingEnabled = !layer.viewport.pixelReplication;
      context.mozImageSmoothingEnabled = context.imageSmoothingEnabled; // Draw from the current layer's canvas onto the enabled element's canvas

      var sx = layer.viewport.displayedArea.tlhc.x - 1;
      var sy = layer.viewport.displayedArea.tlhc.y - 1;
      var width = layer.viewport.displayedArea.brhc.x - sx;
      var height = layer.viewport.displayedArea.brhc.y - sy;
      context.drawImage(layer.canvas, sx, sy, width, height, 0, 0, width, height);
      context.restore();
      layer.invalid = false;
    });
  }
  /**
   * Internal API function to draw a composite image to a given enabled element
   *
   * @param {EnabledElement} enabledElement An enabled element to draw into
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement, invalidated) {
    var element = enabledElement.element;
    var allLayers = Object(_layers_js__WEBPACK_IMPORTED_MODULE_0__["getLayers"])(element);
    var activeLayer = Object(_layers_js__WEBPACK_IMPORTED_MODULE_0__["getActiveLayer"])(element);
    var visibleLayers = Object(_layers_js__WEBPACK_IMPORTED_MODULE_0__["getVisibleLayers"])(element);
    var resynced = !enabledElement.lastSyncViewportsState && enabledElement.syncViewports; // This state will help us to determine if the user has re-synced the
    // layers allowing us to make a new copy of the viewports

    enabledElement.lastSyncViewportsState = enabledElement.syncViewports; // Stores a copy of all viewports if the user has just synced them then we can use the
    // copies to calculate anything later (ratio, translation offset, rotation offset, etc)

    if (resynced) {
      allLayers.forEach(function (layer) {
        if (layer.viewport) {
          updateLayerSyncProps(layer);
        }
      });
    } // Sync all viewports in case it's activated


    if (enabledElement.syncViewports === true) {
      syncViewports(visibleLayers, activeLayer);
    } // Get the enabled element's canvas so we can draw to it


    var context = enabledElement.canvas.getContext('2d');
    context.setTransform(1, 0, 0, 1, 0, 0); // Clear the canvas

    context.fillStyle = 'black';
    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height); // Render all visible layers

    renderLayers(context, visibleLayers, invalidated);
  });

  /***/ }),

  /***/ "./internal/drawImage.js":
  /*!*******************************!*\
    !*** ./internal/drawImage.js ***!
    \*******************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Internal API function to draw an image to a given enabled element
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw
   * @param {Boolean} [invalidated = false] - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof Internal
   */
  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement) {
    var invalidated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    enabledElement.needsRedraw = true;

    if (invalidated) {
      enabledElement.invalid = true;
    }
  });

  /***/ }),

  /***/ "./internal/drawImageSync.js":
  /*!***********************************!*\
    !*** ./internal/drawImageSync.js ***!
    \***********************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");
  /* harmony import */ var _drawCompositeImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./drawCompositeImage.js */ "./internal/drawCompositeImage.js");
  /* harmony import */ var _rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../rendering/renderColorImage.js */ "./rendering/renderColorImage.js");
  /* harmony import */ var _rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../rendering/renderGrayscaleImage.js */ "./rendering/renderGrayscaleImage.js");
  /* harmony import */ var _rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../rendering/renderPseudoColorImage.js */ "./rendering/renderPseudoColorImage.js");
  /* harmony import */ var _rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../rendering/renderLabelMapImage.js */ "./rendering/renderLabelMapImage.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../events.js */ "./events.js");








  /**
   * Draw an image to a given enabled element synchronously
   *
   * @param {EnabledElement} enabledElement An enabled element to draw into
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement, invalidated) {
    var image = enabledElement.image;
    var element = enabledElement.element;
    var layers = enabledElement.layers || []; // Check if enabledElement can be redrawn

    if (!enabledElement.canvas || !(enabledElement.image || layers.length)) {
      return;
    } // Start measuring the time needed to draw the image/layers


    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    image.stats = {
      lastGetPixelDataTime: -1.0,
      lastStoredPixelDataToCanvasImageDataTime: -1.0,
      lastPutImageDataTime: -1.0,
      lastRenderTime: -1.0,
      lastLutGenerateTime: -1.0
    };

    if (layers && layers.length) {
      Object(_drawCompositeImage_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement, invalidated);
    } else if (image) {
      var render = image.render;

      if (!render) {
        if (enabledElement.viewport.colormap && enabledElement.viewport.colormap !== '' && enabledElement.image.labelmap === true) {
          render = _rendering_renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_5__["renderLabelMapImage"];
        } else if (enabledElement.viewport.colormap && enabledElement.viewport.colormap !== '') {
          render = _rendering_renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_4__["renderPseudoColorImage"];
        } else if (image.color) {
          render = _rendering_renderColorImage_js__WEBPACK_IMPORTED_MODULE_2__["renderColorImage"];
        } else {
          render = _rendering_renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_3__["renderGrayscaleImage"];
        }
      }

      render(enabledElement, invalidated);
    } // Calculate how long it took to draw the image/layers


    var renderTimeInMs = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    var eventData = {
      viewport: enabledElement.viewport,
      element: element,
      image: image,
      enabledElement: enabledElement,
      canvasContext: enabledElement.canvas.getContext('2d'),
      renderTimeInMs: renderTimeInMs
    };
    image.stats.lastRenderTime = renderTimeInMs;
    enabledElement.invalid = false;
    enabledElement.needsRedraw = false;
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_6__["default"])(element, _events_js__WEBPACK_IMPORTED_MODULE_7__["default"].IMAGE_RENDERED, eventData);
  });

  /***/ }),

  /***/ "./internal/generateColorLut.js":
  /*!**************************************!*\
    !*** ./internal/generateColorLut.js ***!
    \**************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _getVOILut_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./getVOILut.js */ "./internal/getVOILut.js");

  /**
   * Creates a LUT used while rendering to convert stored pixel values to
   * display pixels
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Number} windowWidth The Window Width
   * @param {Number} windowCenter The Window Center
   * @param {Boolean} invert A boolean describing whether or not the image has been inverted
   * @param {Array} [voiLUT] A Volume of Interest Lookup Table
   *
   * @returns {Uint8ClampedArray} A lookup table to apply to the image
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, windowWidth, windowCenter, invert, voiLUT) {
    var maxPixelValue = image.maxPixelValue;
    var minPixelValue = image.minPixelValue;
    var offset = Math.min(minPixelValue, 0);

    if (image.cachedLut === undefined) {
      var length = maxPixelValue - offset + 1;
      image.cachedLut = {};
      image.cachedLut.lutArray = new Uint8ClampedArray(length);
    }

    var lut = image.cachedLut.lutArray;
    var vlutfn = Object(_getVOILut_js__WEBPACK_IMPORTED_MODULE_0__["default"])(windowWidth, windowCenter, voiLUT);

    if (invert === true) {
      for (var storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {
        lut[storedValue + -offset] = 255 - vlutfn(storedValue);
      }
    } else {
      for (var _storedValue = minPixelValue; _storedValue <= maxPixelValue; _storedValue++) {
        lut[_storedValue + -offset] = vlutfn(_storedValue);
      }
    }

    return lut;
  });

  /***/ }),

  /***/ "./internal/generateLut.js":
  /*!*********************************!*\
    !*** ./internal/generateLut.js ***!
    \*********************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _getModalityLUT_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./getModalityLUT.js */ "./internal/getModalityLUT.js");
  /* harmony import */ var _getVOILut_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./getVOILut.js */ "./internal/getVOILut.js");


  /**
   * Creates a LUT used while rendering to convert stored pixel values to
   * display pixels
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Number} windowWidth The Window Width
   * @param {Number} windowCenter The Window Center
   * @param {Boolean} invert A boolean describing whether or not the image has been inverted
   * @param {Array} [modalityLUT] A modality Lookup Table
   * @param {Array} [voiLUT] A Volume of Interest Lookup Table
   *
   * @returns {Uint8ClampedArray} A lookup table to apply to the image
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, windowWidth, windowCenter, invert, modalityLUT, voiLUT) {
    var maxPixelValue = image.maxPixelValue;
    var minPixelValue = image.minPixelValue;
    var offset = Math.min(minPixelValue, 0);

    if (image.cachedLut === undefined) {
      var length = maxPixelValue - offset + 1;
      image.cachedLut = {};
      image.cachedLut.lutArray = new Uint8ClampedArray(length);
    }

    var lut = image.cachedLut.lutArray;
    var mlutfn = Object(_getModalityLUT_js__WEBPACK_IMPORTED_MODULE_0__["default"])(image.slope, image.intercept, modalityLUT);
    var vlutfn = Object(_getVOILut_js__WEBPACK_IMPORTED_MODULE_1__["default"])(windowWidth, windowCenter, voiLUT);

    if (invert === true) {
      for (var storedValue = minPixelValue; storedValue <= maxPixelValue; storedValue++) {
        lut[storedValue + -offset] = 255 - vlutfn(mlutfn(storedValue));
      }
    } else {
      for (var _storedValue = minPixelValue; _storedValue <= maxPixelValue; _storedValue++) {
        lut[_storedValue + -offset] = vlutfn(mlutfn(_storedValue));
      }
    }

    return lut;
  });

  /***/ }),

  /***/ "./internal/getCanvas.js":
  /*!*******************************!*\
    !*** ./internal/getCanvas.js ***!
    \*******************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return getCanvas; });
  var CANVAS_CSS_CLASS = 'cornerstone-canvas';
  /**
   * Create a canvas and append it to the element
   *
   * @param {HTMLElement} element An HTML Element
   * @return {HTMLElement} canvas A Canvas DOM element
   */

  function createCanvas(element) {
    var canvas = document.createElement('canvas');
    canvas.style.display = 'block';
    canvas.classList.add(CANVAS_CSS_CLASS);
    element.appendChild(canvas);
    return canvas;
  }
  /**
   * Create a canvas or returns the one that already exists for a given element
   *
   * @param {HTMLElement} element An HTML Element
   * @return {HTMLElement} canvas A Canvas DOM element
   */


  function getCanvas(element) {
    var selector = "canvas.".concat(CANVAS_CSS_CLASS);
    return element.querySelector(selector) || createCanvas(element);
  }

  /***/ }),

  /***/ "./internal/getDefaultViewport.js":
  /*!****************************************!*\
    !*** ./internal/getDefaultViewport.js ***!
    \****************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _getImageFitScale_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./getImageFitScale.js */ "./internal/getImageFitScale.js");

  /**
   * Creates a new viewport object containing default values
   *
   * @returns {Viewport} viewport object
   * @memberof Internal
   */

  function createViewport() {
    var displayedArea = createDefaultDisplayedArea();
    return {
      scale: 1,
      translation: {
        x: 0,
        y: 0
      },
      voi: {
        windowWidth: undefined,
        windowCenter: undefined
      },
      invert: false,
      pixelReplication: false,
      rotation: 0,
      hflip: false,
      vflip: false,
      modalityLUT: undefined,
      voiLUT: undefined,
      colormap: undefined,
      labelmap: false,
      displayedArea: displayedArea
    };
  }
  /**
   * Creates the default displayed area.
   * C.10.4 Displayed Area Module: This Module describes Attributes required to define a Specified Displayed Area space.
   *
   * @returns {tlhc: {x,y}, brhc: {x, y},rowPixelSpacing: Number, columnPixelSpacing: Number, presentationSizeMode: Number} displayedArea object
   * @memberof Internal
   */


  function createDefaultDisplayedArea() {
    return {
      // Top Left Hand Corner
      tlhc: {
        x: 1,
        y: 1
      },
      // Bottom Right Hand Corner
      brhc: {
        x: 1,
        y: 1
      },
      rowPixelSpacing: 1,
      columnPixelSpacing: 1,
      presentationSizeMode: 'NONE'
    };
  }
  /**
   * Creates a new viewport object containing default values for the image and canvas
   *
   * @param {HTMLElement} canvas A Canvas DOM element
   * @param {Image} image A Cornerstone Image Object
   * @returns {Viewport} viewport object
   * @memberof Internal
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (canvas, image) {
    if (canvas === undefined) {
      throw new Error('getDefaultViewport: parameter canvas must not be undefined');
    }

    if (image === undefined) {
      return createViewport();
    } // Fit image to window


    var scale = Object(_getImageFitScale_js__WEBPACK_IMPORTED_MODULE_0__["default"])(canvas, image, 0).scaleFactor;
    return {
      scale: scale,
      translation: {
        x: 0,
        y: 0
      },
      voi: {
        windowWidth: image.windowWidth,
        windowCenter: image.windowCenter
      },
      invert: image.invert,
      pixelReplication: false,
      rotation: 0,
      hflip: false,
      vflip: false,
      modalityLUT: image.modalityLUT,
      voiLUT: image.voiLUT,
      colormap: image.colormap,
      labelmap: Boolean(image.labelmap),
      displayedArea: {
        tlhc: {
          x: 1,
          y: 1
        },
        brhc: {
          x: image.columns,
          y: image.rows
        },
        rowPixelSpacing: image.rowPixelSpacing === undefined ? 1 : image.rowPixelSpacing,
        columnPixelSpacing: image.columnPixelSpacing === undefined ? 1 : image.columnPixelSpacing,
        presentationSizeMode: 'NONE'
      }
    };
  });

  /***/ }),

  /***/ "./internal/getImageFitScale.js":
  /*!**************************************!*\
    !*** ./internal/getImageFitScale.js ***!
    \**************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _validator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validator.js */ "./internal/validator.js");
  /* harmony import */ var _getImageSize_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./getImageSize.js */ "./internal/getImageSize.js");


  /**
   * Calculates the horizontal, vertical and minimum scale factor for an image
     @param {{width, height}} windowSize The window size where the image is displayed. This can be any HTML element or structure with a width, height fields (e.g. canvas).
   * @param {any} image The cornerstone image object
   * @param {Number} rotation Optional. The rotation angle of the image.
   * @return {{horizontalScale, verticalScale, scaleFactor}} The calculated horizontal, vertical and minimum scale factor
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (windowSize, image) {
    var rotation = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    Object(_validator_js__WEBPACK_IMPORTED_MODULE_0__["validateParameterUndefinedOrNull"])(windowSize, 'getImageScale: parameter windowSize must not be undefined');
    Object(_validator_js__WEBPACK_IMPORTED_MODULE_0__["validateParameterUndefinedOrNull"])(image, 'getImageScale: parameter image must not be undefined');
    var imageSize = Object(_getImageSize_js__WEBPACK_IMPORTED_MODULE_1__["default"])(image, rotation);
    var rowPixelSpacing = image.rowPixelSpacing || 1;
    var columnPixelSpacing = image.columnPixelSpacing || 1;
    var verticalRatio = 1;
    var horizontalRatio = 1;

    if (rowPixelSpacing < columnPixelSpacing) {
      horizontalRatio = columnPixelSpacing / rowPixelSpacing;
    } else {
      // even if they are equal we want to calculate this ratio (the ration might be 0.5)
      verticalRatio = rowPixelSpacing / columnPixelSpacing;
    }

    var verticalScale = windowSize.height / imageSize.height / verticalRatio;
    var horizontalScale = windowSize.width / imageSize.width / horizontalRatio; // Fit image to window

    return {
      verticalScale: verticalScale,
      horizontalScale: horizontalScale,
      scaleFactor: Math.min(horizontalScale, verticalScale)
    };
  });

  /***/ }),

  /***/ "./internal/getImageSize.js":
  /*!**********************************!*\
    !*** ./internal/getImageSize.js ***!
    \**********************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _validator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validator.js */ "./internal/validator.js");

  /**
   * Check if the angle is rotated
   * @param {Number} rotation the rotation angle
   * @returns {Boolean} true if the angle is rotated; Otherwise, false.
   * @memberof Internal
   */

  function isRotated(rotation) {
    return !(rotation === null || rotation === undefined || rotation === 0 || rotation === 180);
  }
  /**
   * Retrieves the current image dimensions given an enabled element
   *
   * @param {any} image The Cornerstone image.
   * @param {Number} rotation Optional. The rotation angle of the image.
   * @return {{width:Number, height:Number}} The Image dimensions
   * @memberof Internal
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (image) {
    var rotation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    Object(_validator_js__WEBPACK_IMPORTED_MODULE_0__["validateParameterUndefinedOrNull"])(image, 'getImageSize: parameter image must not be undefined');
    Object(_validator_js__WEBPACK_IMPORTED_MODULE_0__["validateParameterUndefinedOrNull"])(image.width, 'getImageSize: parameter image must have width');
    Object(_validator_js__WEBPACK_IMPORTED_MODULE_0__["validateParameterUndefinedOrNull"])(image.height, 'getImageSize: parameter image must have height');

    if (isRotated(rotation)) {
      return {
        height: image.width,
        width: image.height
      };
    }

    return {
      width: image.width,
      height: image.height
    };
  });

  /***/ }),

  /***/ "./internal/getModalityLUT.js":
  /*!************************************!*\
    !*** ./internal/getModalityLUT.js ***!
    \************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Generates a linear modality transformation function
   *
   * See DICOM PS3.3 C.11.1 Modality LUT Module
   *
   * http://dicom.nema.org/medical/Dicom/current/output/chtml/part03/sect_C.11.html
   *
   * @param {Number} slope m in the equation specified by Rescale Intercept (0028,1052).
   * @param {Number} intercept The value b in relationship between stored values (SV) and the output units specified in Rescale Type (0028,1054).

   Output units = m*SV + b.
   * @return {function(*): *} A linear modality LUT function. Given a stored pixel it returns the modality pixel value
   * @memberof Internal
   */
  function generateLinearModalityLUT(slope, intercept) {
    return function (storedPixelValue) {
      return storedPixelValue * slope + intercept;
    };
  }

  function generateNonLinearModalityLUT(modalityLUT) {
    var minValue = modalityLUT.lut[0];
    var maxValue = modalityLUT.lut[modalityLUT.lut.length - 1];
    var maxValueMapped = modalityLUT.firstValueMapped + modalityLUT.lut.length;
    return function (storedPixelValue) {
      if (storedPixelValue < modalityLUT.firstValueMapped) {
        return minValue;
      } else if (storedPixelValue >= maxValueMapped) {
        return maxValue;
      }

      return modalityLUT.lut[storedPixelValue];
    };
  }
  /**
   * Get the appropriate Modality LUT for the current situation.
   *
   * @param {Number} [slope] m in the equation specified by Rescale Intercept (0028,1052).
   * @param {Number} [intercept] The value b in relationship between stored values (SV) and the output units specified in Rescale Type (0028,1054).
   * @param {Function} [modalityLUT] A modality LUT function. Given a stored pixel it returns the modality pixel value.
   *
   * @return {function(*): *} A modality LUT function. Given a stored pixel it returns the modality pixel value.
   * @memberof Internal
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (slope, intercept, modalityLUT) {
    if (modalityLUT) {
      return generateNonLinearModalityLUT(modalityLUT);
    }

    return generateLinearModalityLUT(slope, intercept);
  });

  /***/ }),

  /***/ "./internal/getTransform.js":
  /*!**********************************!*\
    !*** ./internal/getTransform.js ***!
    \**********************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _calculateTransform_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./calculateTransform.js */ "./internal/calculateTransform.js");

  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement) {
    // For now we will calculate it every time it is requested.
    // In the future, we may want to cache it in the enabled element to speed things up.
    return Object(_calculateTransform_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElement);
  });

  /***/ }),

  /***/ "./internal/getVOILut.js":
  /*!*******************************!*\
    !*** ./internal/getVOILut.js ***!
    \*******************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

  function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

  function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

  function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }

  /* eslint no-bitwise: 0 */

  /**
   * Volume of Interest Lookup Table Function
   *
   * @typedef {Function} VOILUTFunction
   *
   * @param {Number} modalityLutValue
   * @returns {Number} transformed value
   * @memberof Objects
   */

  /**
   * @module: VOILUT
   */

  /**
   *
   * @param {Number} windowWidth Window Width
   * @param {Number} windowCenter Window Center
   * @returns {VOILUTFunction} VOI LUT mapping function
   * @memberof VOILUT
   */
  function generateLinearVOILUT(windowWidth, windowCenter) {
    return function (modalityLutValue) {
      return ((modalityLutValue - windowCenter) / windowWidth + 0.5) * 255.0;
    };
  }
  /**
   * Generate a non-linear volume of interest lookup table
   *
   * @param {LUT} voiLUT Volume of Interest Lookup Table Object
   *
   * @returns {VOILUTFunction} VOI LUT mapping function
   * @memberof VOILUT
   */


  function generateNonLinearVOILUT(voiLUT) {
    // We don't trust the voiLUT.numBitsPerEntry, mainly thanks to Agfa!
    var bitsPerEntry = Math.max.apply(Math, _toConsumableArray(voiLUT.lut)).toString(2).length;
    var shift = bitsPerEntry - 8;
    var minValue = voiLUT.lut[0] >> shift;
    var maxValue = voiLUT.lut[voiLUT.lut.length - 1] >> shift;
    var maxValueMapped = voiLUT.firstValueMapped + voiLUT.lut.length - 1;
    return function (modalityLutValue) {
      if (modalityLutValue < voiLUT.firstValueMapped) {
        return minValue;
      } else if (modalityLutValue >= maxValueMapped) {
        return maxValue;
      }

      return voiLUT.lut[modalityLutValue - voiLUT.firstValueMapped] >> shift;
    };
  }
  /**
   * Retrieve a VOI LUT mapping function given the current windowing settings
   * and the VOI LUT for the image
   *
   * @param {Number} windowWidth Window Width
   * @param {Number} windowCenter Window Center
   * @param {LUT} [voiLUT] Volume of Interest Lookup Table Object
   *
   * @return {VOILUTFunction} VOI LUT mapping function
   * @memberof VOILUT
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (windowWidth, windowCenter, voiLUT) {
    if (voiLUT) {
      return generateNonLinearVOILUT(voiLUT);
    }

    return generateLinearVOILUT(windowWidth, windowCenter);
  });

  /***/ }),

  /***/ "./internal/guid.js":
  /*!**************************!*\
    !*** ./internal/guid.js ***!
    \**************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
  }
  /**
   * Generate a unique identifier
   *
   * @return {string} A unique identifier
   * @memberof Internal
   */


  /* harmony default export */ __webpack_exports__["default"] = (function () {
    return "".concat(s4() + s4(), "-").concat(s4(), "-").concat(s4(), "-").concat(s4(), "-").concat(s4()).concat(s4()).concat(s4());
  });

  /***/ }),

  /***/ "./internal/index.js":
  /*!***************************!*\
    !*** ./internal/index.js ***!
    \***************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _drawImage_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./drawImage.js */ "./internal/drawImage.js");
  /* harmony import */ var _generateLut_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./generateLut.js */ "./internal/generateLut.js");
  /* harmony import */ var _getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony import */ var _requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./requestAnimationFrame.js */ "./internal/requestAnimationFrame.js");
  /* harmony import */ var _storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./storedPixelDataToCanvasImageData.js */ "./internal/storedPixelDataToCanvasImageData.js");
  /* harmony import */ var _storedPixelDataToCanvasImageDataRGBA_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./storedPixelDataToCanvasImageDataRGBA.js */ "./internal/storedPixelDataToCanvasImageDataRGBA.js");
  /* harmony import */ var _storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./storedColorPixelDataToCanvasImageData.js */ "./internal/storedColorPixelDataToCanvasImageData.js");
  /* harmony import */ var _storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./storedPixelDataToCanvasImageDataColorLUT.js */ "./internal/storedPixelDataToCanvasImageDataColorLUT.js");
  /* harmony import */ var _storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./storedPixelDataToCanvasImageDataPseudocolorLUT.js */ "./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");
  /* harmony import */ var _getTransform_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./getTransform.js */ "./internal/getTransform.js");
  /* harmony import */ var _calculateTransform_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./calculateTransform.js */ "./internal/calculateTransform.js");
  /* harmony import */ var _transform_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./transform.js */ "./internal/transform.js");












  /**
   * @module Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = ({
    drawImage: _drawImage_js__WEBPACK_IMPORTED_MODULE_0__["default"],
    generateLut: _generateLut_js__WEBPACK_IMPORTED_MODULE_1__["default"],
    getDefaultViewport: _getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__["default"],
    requestAnimationFrame: _requestAnimationFrame_js__WEBPACK_IMPORTED_MODULE_3__["default"],
    storedPixelDataToCanvasImageData: _storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_4__["default"],
    storedPixelDataToCanvasImageDataRGBA: _storedPixelDataToCanvasImageDataRGBA_js__WEBPACK_IMPORTED_MODULE_5__["default"],
    storedPixelDataToCanvasImageDataColorLUT: _storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_7__["default"],
    storedPixelDataToCanvasImageDataPseudocolorLUT: _storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_8__["default"],
    storedColorPixelDataToCanvasImageData: _storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_6__["default"],
    getTransform: _getTransform_js__WEBPACK_IMPORTED_MODULE_9__["default"],
    calculateTransform: _calculateTransform_js__WEBPACK_IMPORTED_MODULE_10__["default"],
    Transform: _transform_js__WEBPACK_IMPORTED_MODULE_11__["Transform"]
  });

  /***/ }),

  /***/ "./internal/now.js":
  /*!*************************!*\
    !*** ./internal/now.js ***!
    \*************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * @module Polyfills
   */

  /**
   * Use the performance.now() method if possible, and if not, use Date.now()
   *
   * @return {number} Time elapsed since the time origin
   * @memberof Polyfills
   */
  /* harmony default export */ __webpack_exports__["default"] = (function () {
    if (window.performance) {
      return performance.now();
    }

    return Date.now();
  });

  /***/ }),

  /***/ "./internal/requestAnimationFrame.js":
  /*!*******************************************!*\
    !*** ./internal/requestAnimationFrame.js ***!
    \*******************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  function requestFrame(callback) {
    window.setTimeout(callback, 1000 / 60);
  }
  /**
   * Polyfills requestAnimationFrame for older browsers.
   *
   * @param {Function} callback A parameter specifying a function to call when it's time to update your animation for the next repaint. The callback has one single argument, a DOMHighResTimeStamp, which indicates the current time (the time returned from performance.now() ) for when requestAnimationFrame starts to fire callbacks.
   *
   * @return {Number} A long integer value, the request id, that uniquely identifies the entry in the callback list. This is a non-zero value, but you may not make any other assumptions about its value. You can pass this value to window.cancelAnimationFrame() to cancel the refresh callback request.
   * @memberof Polyfills
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (callback) {
    return window.requestAnimationFrame(callback) || window.webkitRequestAnimationFrame(callback) || window.mozRequestAnimationFrame(callback) || window.oRequestAnimationFrame(callback) || window.msRequestAnimationFrame(callback) || requestFrame(callback);
  });

  /***/ }),

  /***/ "./internal/storedColorPixelDataToCanvasImageData.js":
  /*!***********************************************************!*\
    !*** ./internal/storedColorPixelDataToCanvasImageData.js ***!
    \***********************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");

  /**
   * Converts stored color pixel values to display pixel values using a LUT.
   *
   * Note: Skips alpha value for any input image pixel data.
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Array} lut Lookup table array
   * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels
   *
   * @returns {void}
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, lut, canvasImageDataData) {
    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    var pixelData = image.getPixelData();
    image.stats.lastGetPixelDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0;
    var numPixels = pixelData.length; // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.
    // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement

    start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();

    if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Red

        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Green

        canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex] + -minPixelValue]; // Blue

        storedPixelDataIndex += 2;
        canvasImageDataIndex += 2;
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Red

        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Green

        canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex]]; // Blue

        storedPixelDataIndex += 2;
        canvasImageDataIndex += 2;
      }
    }

    image.stats.lastStoredPixelDataToCanvasImageDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
  });

  /***/ }),

  /***/ "./internal/storedPixelDataToCanvasImageData.js":
  /*!******************************************************!*\
    !*** ./internal/storedPixelDataToCanvasImageData.js ***!
    \******************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");

  /**
   * This function transforms stored pixel values into a canvas image data buffer
   * by using a LUT.  This is the most performance sensitive code in cornerstone and
   * we use a special trick to make this go as fast as possible.  Specifically we
   * use the alpha channel only to control the luminance rather than the red, green and
   * blue channels which makes it over 3x faster. The canvasImageDataData buffer needs
   * to be previously filled with white pixels.
   *
   * NOTE: Attribution would be appreciated if you use this technique!
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Array} lut Lookup table array
   * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels
   *
   * @returns {void}
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, lut, canvasImageDataData) {
    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    var pixelData = image.getPixelData();
    image.stats.lastGetPixelDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    var numPixels = pixelData.length;
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 3;
    var storedPixelDataIndex = 0; // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.
    // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement
    // Added two paths (Int16Array, Uint16Array) to avoid polymorphic deoptimization in chrome.

    start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();

    if (pixelData instanceof Int16Array) {
      if (minPixelValue < 0) {
        while (storedPixelDataIndex < numPixels) {
          canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Alpha

          canvasImageDataIndex += 4;
        }
      } else {
        while (storedPixelDataIndex < numPixels) {
          canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex++]]; // Alpha

          canvasImageDataIndex += 4;
        }
      }
    } else if (pixelData instanceof Uint16Array) {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex++]]; // Alpha

        canvasImageDataIndex += 4;
      }
    } else if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Alpha

        canvasImageDataIndex += 4;
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex] = lut[pixelData[storedPixelDataIndex++]]; // Alpha

        canvasImageDataIndex += 4;
      }
    }

    image.stats.lastStoredPixelDataToCanvasImageDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
  });

  /***/ }),

  /***/ "./internal/storedPixelDataToCanvasImageDataColorLUT.js":
  /*!**************************************************************!*\
    !*** ./internal/storedPixelDataToCanvasImageDataColorLUT.js ***!
    \**************************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _colors_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../colors/index.js */ "./colors/index.js");
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");


  /**
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {LookupTable|Array} colorLut Lookup table array
   * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels
   *
   * @returns {void}
   * @memberof Internal
   */

  function storedPixelDataToCanvasImageDataColorLUT(image, colorLut, canvasImageDataData) {
    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();
    var pixelData = image.getPixelData();
    image.stats.lastGetPixelDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
    var numPixels = pixelData.length;
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0;
    var rgba;
    var clut;
    start = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();

    if (colorLut instanceof _colors_index_js__WEBPACK_IMPORTED_MODULE_0__["default"].LookupTable) {
      clut = colorLut.Table;
    } else {
      clut = colorLut;
    }

    if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        rgba = clut[pixelData[storedPixelDataIndex++] + -minPixelValue];
        canvasImageDataData[canvasImageDataIndex++] = rgba[0];
        canvasImageDataData[canvasImageDataIndex++] = rgba[1];
        canvasImageDataData[canvasImageDataIndex++] = rgba[2];
        canvasImageDataData[canvasImageDataIndex++] = rgba[3];
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        rgba = clut[pixelData[storedPixelDataIndex++]];
        canvasImageDataData[canvasImageDataIndex++] = rgba[0];
        canvasImageDataData[canvasImageDataIndex++] = rgba[1];
        canvasImageDataData[canvasImageDataIndex++] = rgba[2];
        canvasImageDataData[canvasImageDataIndex++] = rgba[3];
      }
    }

    image.stats.lastStoredPixelDataToCanvasImageDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
  }

  /* harmony default export */ __webpack_exports__["default"] = (storedPixelDataToCanvasImageDataColorLUT);

  /***/ }),

  /***/ "./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js":
  /*!********************************************************************!*\
    !*** ./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js ***!
    \********************************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _colors_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../colors/index.js */ "./colors/index.js");
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");


  /**
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Array} grayscaleLut Lookup table array
   * @param {LookupTable|Array} colorLut Lookup table array
   * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels
   *
   * @returns {void}
   * @memberof Internal
   */

  function storedPixelDataToCanvasImageDataPseudocolorLUT(image, grayscaleLut, colorLut, canvasImageDataData) {
    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();
    var pixelData = image.getPixelData();
    image.stats.lastGetPixelDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
    var numPixels = pixelData.length;
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0;
    var grayscale;
    var rgba;
    var clut;
    start = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();

    if (colorLut instanceof _colors_index_js__WEBPACK_IMPORTED_MODULE_0__["default"].LookupTable) {
      clut = colorLut.Table;
    } else {
      clut = colorLut;
    }

    if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        grayscale = grayscaleLut[pixelData[storedPixelDataIndex++] + -minPixelValue];
        rgba = clut[grayscale];
        canvasImageDataData[canvasImageDataIndex++] = rgba[0];
        canvasImageDataData[canvasImageDataIndex++] = rgba[1];
        canvasImageDataData[canvasImageDataIndex++] = rgba[2];
        canvasImageDataData[canvasImageDataIndex++] = rgba[3];
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        grayscale = grayscaleLut[pixelData[storedPixelDataIndex++]];
        rgba = clut[grayscale];
        canvasImageDataData[canvasImageDataIndex++] = rgba[0];
        canvasImageDataData[canvasImageDataIndex++] = rgba[1];
        canvasImageDataData[canvasImageDataIndex++] = rgba[2];
        canvasImageDataData[canvasImageDataIndex++] = rgba[3];
      }
    }

    image.stats.lastStoredPixelDataToCanvasImageDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
  }

  /* harmony default export */ __webpack_exports__["default"] = (storedPixelDataToCanvasImageDataPseudocolorLUT);

  /***/ }),

  /***/ "./internal/storedPixelDataToCanvasImageDataRGBA.js":
  /*!**********************************************************!*\
    !*** ./internal/storedPixelDataToCanvasImageDataRGBA.js ***!
    \**********************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");

  /**
   * This function transforms stored pixel values into a canvas image data buffer
   * by using a LUT.
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Array} lut Lookup table array
   * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels
   *
   * @returns {void}
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, lut, canvasImageDataData) {
    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    var pixelData = image.getPixelData();
    image.stats.lastGetPixelDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    var numPixels = pixelData.length;
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0;
    var pixelValue; // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.
    // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement
    // Added two paths (Int16Array, Uint16Array) to avoid polymorphic deoptimization in chrome.

    start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();

    if (pixelData instanceof Int16Array) {
      if (minPixelValue < 0) {
        while (storedPixelDataIndex < numPixels) {
          pixelValue = lut[pixelData[storedPixelDataIndex++] + -minPixelValue];
          canvasImageDataData[canvasImageDataIndex++] = pixelValue;
          canvasImageDataData[canvasImageDataIndex++] = pixelValue;
          canvasImageDataData[canvasImageDataIndex++] = pixelValue;
          canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha
        }
      } else {
        while (storedPixelDataIndex < numPixels) {
          pixelValue = lut[pixelData[storedPixelDataIndex++]];
          canvasImageDataData[canvasImageDataIndex++] = pixelValue;
          canvasImageDataData[canvasImageDataIndex++] = pixelValue;
          canvasImageDataData[canvasImageDataIndex++] = pixelValue;
          canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha
        }
      }
    } else if (pixelData instanceof Uint16Array) {
      while (storedPixelDataIndex < numPixels) {
        pixelValue = lut[pixelData[storedPixelDataIndex++]];
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha
      }
    } else if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        pixelValue = lut[pixelData[storedPixelDataIndex++] + -minPixelValue];
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        pixelValue = lut[pixelData[storedPixelDataIndex++]];
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = pixelValue;
        canvasImageDataData[canvasImageDataIndex++] = 255; // Alpha
      }
    }

    image.stats.lastStoredPixelDataToCanvasImageDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
  });

  /***/ }),

  /***/ "./internal/storedRGBAPixelDataToCanvasImageData.js":
  /*!**********************************************************!*\
    !*** ./internal/storedRGBAPixelDataToCanvasImageData.js ***!
    \**********************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _now_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./now.js */ "./internal/now.js");

  /**
   * Converts stored RGBA color pixel values to display pixel values using a LUT.
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Array} lut Lookup table array
   * @param {Uint8ClampedArray} canvasImageDataData canvasImageData.data buffer filled with white pixels
   *
   * @returns {void}
   * @memberof Internal
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, lut, canvasImageDataData) {
    var start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    var pixelData = image.getPixelData();
    image.stats.lastGetPixelDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0;
    var numPixels = pixelData.length; // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.
    // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement

    start = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();

    if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Red

        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Green

        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++] + -minPixelValue]; // Blue

        canvasImageDataData[canvasImageDataIndex++] = pixelData[storedPixelDataIndex++];
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Red

        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Green

        canvasImageDataData[canvasImageDataIndex++] = lut[pixelData[storedPixelDataIndex++]]; // Blue

        canvasImageDataData[canvasImageDataIndex++] = pixelData[storedPixelDataIndex++];
      }
    }

    image.stats.lastStoredPixelDataToCanvasImageDataTime = Object(_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
  });

  /***/ }),

  /***/ "./internal/transform.js":
  /*!*******************************!*\
    !*** ./internal/transform.js ***!
    \*******************************/
  /*! exports provided: Transform */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Transform", function() { return Transform; });
  function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

  function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

  function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

  // By Simon Sarris
  // Www.simonsarris.com
  // Sarris@acm.org
  //
  // Free to use and distribute at will
  // So long as you are nice to people, etc
  // Simple class for keeping track of the current transformation matrix
  // For instance:
  //    Var t = new Transform();
  //    T.rotate(5);
  //    Var m = t.m;
  //    Ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
  // Is equivalent to:
  //    Ctx.rotate(5);
  // But now you can retrieve it :)
  // Remember that this does not account for any CSS transforms applied to the canvas
  var Transform =
  /*#__PURE__*/
  function () {
    function Transform() {
      _classCallCheck(this, Transform);

      this.reset();
    }

    _createClass(Transform, [{
      key: "reset",
      value: function reset() {
        this.m = [1, 0, 0, 1, 0, 0];
      }
    }, {
      key: "clone",
      value: function clone() {
        var transform = new Transform();
        transform.m[0] = this.m[0];
        transform.m[1] = this.m[1];
        transform.m[2] = this.m[2];
        transform.m[3] = this.m[3];
        transform.m[4] = this.m[4];
        transform.m[5] = this.m[5];
        return transform;
      }
    }, {
      key: "multiply",
      value: function multiply(matrix) {
        var m11 = this.m[0] * matrix.m[0] + this.m[2] * matrix.m[1];
        var m12 = this.m[1] * matrix.m[0] + this.m[3] * matrix.m[1];
        var m21 = this.m[0] * matrix.m[2] + this.m[2] * matrix.m[3];
        var m22 = this.m[1] * matrix.m[2] + this.m[3] * matrix.m[3];
        var dx = this.m[0] * matrix.m[4] + this.m[2] * matrix.m[5] + this.m[4];
        var dy = this.m[1] * matrix.m[4] + this.m[3] * matrix.m[5] + this.m[5];
        this.m[0] = m11;
        this.m[1] = m12;
        this.m[2] = m21;
        this.m[3] = m22;
        this.m[4] = dx;
        this.m[5] = dy;
      }
    }, {
      key: "invert",
      value: function invert() {
        var d = 1 / (this.m[0] * this.m[3] - this.m[1] * this.m[2]);
        var m0 = this.m[3] * d;
        var m1 = -this.m[1] * d;
        var m2 = -this.m[2] * d;
        var m3 = this.m[0] * d;
        var m4 = d * (this.m[2] * this.m[5] - this.m[3] * this.m[4]);
        var m5 = d * (this.m[1] * this.m[4] - this.m[0] * this.m[5]);
        this.m[0] = m0;
        this.m[1] = m1;
        this.m[2] = m2;
        this.m[3] = m3;
        this.m[4] = m4;
        this.m[5] = m5;
      }
    }, {
      key: "rotate",
      value: function rotate(rad) {
        var c = Math.cos(rad);
        var s = Math.sin(rad);
        var m11 = this.m[0] * c + this.m[2] * s;
        var m12 = this.m[1] * c + this.m[3] * s;
        var m21 = this.m[0] * -s + this.m[2] * c;
        var m22 = this.m[1] * -s + this.m[3] * c;
        this.m[0] = m11;
        this.m[1] = m12;
        this.m[2] = m21;
        this.m[3] = m22;
      }
    }, {
      key: "translate",
      value: function translate(x, y) {
        this.m[4] += this.m[0] * x + this.m[2] * y;
        this.m[5] += this.m[1] * x + this.m[3] * y;
      }
    }, {
      key: "scale",
      value: function scale(sx, sy) {
        this.m[0] *= sx;
        this.m[1] *= sx;
        this.m[2] *= sy;
        this.m[3] *= sy;
      }
    }, {
      key: "transformPoint",
      value: function transformPoint(px, py) {
        var x = px;
        var y = py;
        px = x * this.m[0] + y * this.m[2] + this.m[4];
        py = x * this.m[1] + y * this.m[3] + this.m[5];
        return {
          x: px,
          y: py
        };
      }
    }]);

    return Transform;
  }();

  /***/ }),

  /***/ "./internal/tryEnableWebgl.js":
  /*!************************************!*\
    !*** ./internal/tryEnableWebgl.js ***!
    \************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _webgl_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../webgl/index.js */ "./webgl/index.js");

  /**
   * Checks if webGL is supported and initializes the rendering engine.
   * @param {any} options Options to check if webgl rendering is requested (e.g. enable webgl by passing {renderer: 'webgl'})
   * @returns {Boolean} true if webgl rendering has been successfully initialized. Otherwise, false.
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (options) {
    if (_webgl_index_js__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.isWebGLAvailable()) {
      // If WebGL is available on the device, initialize the renderer
      // And return the renderCanvas from the WebGL rendering path
      _webgl_index_js__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.initRenderer();
      options.renderer = 'webgl';
      return true;
    } // If WebGL is not available on this device, we will fall back
    // To using the Canvas renderer


    console.error('WebGL not available, falling back to Canvas renderer');
    delete options.renderer;
    return false;
  });

  /***/ }),

  /***/ "./internal/validator.js":
  /*!*******************************!*\
    !*** ./internal/validator.js ***!
    \*******************************/
  /*! exports provided: validateParameterUndefined, validateParameterUndefinedOrNull */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "validateParameterUndefined", function() { return validateParameterUndefined; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "validateParameterUndefinedOrNull", function() { return validateParameterUndefinedOrNull; });
  /**
   * Check if the supplied parameter is undefined and throws and error
   * @param {any} checkParam the parameter to validate for undefined
   * @param {any} errorMsg the error message to be thrown
   * @returns {void}
   * @memberof internal
   */
  function validateParameterUndefined(checkParam, errorMsg) {
    if (checkParam === undefined) {
      throw new Error(errorMsg);
    }
  }
  /**
   * Check if the supplied parameter is undefined or null and throws and error
   * @param {any} checkParam the parameter to validate for undefined
   * @param {any} errorMsg the error message to be thrown
   * @returns {void}
   * @memberof internal
   */

  function validateParameterUndefinedOrNull(checkParam, errorMsg) {
    if (checkParam === undefined || checkParam === null) {
      throw new Error(errorMsg);
    }
  }

  /***/ }),

  /***/ "./invalidate.js":
  /*!***********************!*\
    !*** ./invalidate.js ***!
    \***********************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events.js */ "./events.js");



  /**
   * Sets the invalid flag on the enabled element and fire an event
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @returns {void}
   * @memberof Drawing
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    enabledElement.invalid = true;
    enabledElement.needsRedraw = true;
    var eventData = {
      element: element
    };
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(element, _events_js__WEBPACK_IMPORTED_MODULE_2__["default"].INVALIDATED, eventData);
  });

  /***/ }),

  /***/ "./invalidateImageId.js":
  /*!******************************!*\
    !*** ./invalidateImageId.js ***!
    \******************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/drawImage.js */ "./internal/drawImage.js");


  /**
   * Forces the image to be updated/redrawn for the all enabled elements
   * displaying the specified imageId
   *
   * @param {string} imageId The imageId of the Cornerstone Image Object to redraw
   * @returns {void}
   * @memberof Drawing
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (imageId) {
    var enabledElements = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElementsByImageId"])(imageId);
    enabledElements.forEach(function (enabledElement) {
      Object(_internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement, true);
    });
  });

  /***/ }),

  /***/ "./layers.js":
  /*!*******************!*\
    !*** ./layers.js ***!
    \*******************/
  /*! exports provided: rescaleImage, addLayer, removeLayer, getLayer, getLayers, getVisibleLayers, setActiveLayer, setLayerImage, getActiveLayer, purgeLayers */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "rescaleImage", function() { return rescaleImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addLayer", function() { return addLayer; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "removeLayer", function() { return removeLayer; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getLayer", function() { return getLayer; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getLayers", function() { return getLayers; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getVisibleLayers", function() { return getVisibleLayers; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setActiveLayer", function() { return setActiveLayer; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "setLayerImage", function() { return setLayerImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getActiveLayer", function() { return getActiveLayer; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "purgeLayers", function() { return purgeLayers; });
  /* harmony import */ var _internal_guid_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./internal/guid.js */ "./internal/guid.js");
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./events.js */ "./events.js");






  /**
   * @module EnabledElementLayers
   */

  /**
   * Helper function to trigger an event on a Cornerstone element with
   * a specific layerId
   *
   * @param {String} eventName The event name (e.g. CornerstoneLayerAdded)
   * @param {EnabledElement} enabledElement The Cornerstone enabled element
   * @param {String} layerId The layer's unique identifier
   * @returns {void}
   * @memberof EnabledElementLayers
   */

  function triggerEventForLayer(eventName, enabledElement, layerId) {
    var element = enabledElement.element;
    var eventData = {
      viewport: enabledElement.viewport,
      element: enabledElement.element,
      image: enabledElement.image,
      enabledElement: enabledElement,
      layerId: layerId
    };
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_4__["default"])(element, eventName, eventData);
  }
  /**
   * Rescale the target layer to the base layer based on the
   * relative size of each image and their pixel dimensions.
   *
   * This function will update the Viewport parameters of the
   * target layer to a new scale.
   *
   * @param {EnabledElementLayer} baseLayer The base layer
   * @param {EnabledElementLayer} targetLayer The target layer to rescale
   * @returns {void}
   * @memberof EnabledElementLayers
   */


  function rescaleImage(baseLayer, targetLayer) {
    if (baseLayer.layerId === targetLayer.layerId) {
      throw new Error('rescaleImage: both arguments represent the same layer');
    }

    var baseImage = baseLayer.image;
    var targetImage = targetLayer.image; // Return if these images don't have an imageId (e.g. for dynamic images)

    if (!baseImage.imageId || !targetImage.imageId) {
      return;
    } // Column pixel spacing need to be considered when calculating the
    // ratio between the layer added and base layer images


    var colRelative = targetLayer.viewport.displayedArea.columnPixelSpacing * targetImage.width / (baseLayer.viewport.displayedArea.columnPixelSpacing * baseImage.width);
    var viewportRatio = targetLayer.viewport.scale / baseLayer.viewport.scale * colRelative;
    targetLayer.viewport.scale = baseLayer.viewport.scale * viewportRatio;
  }
  /**
   * Add a layer to a Cornerstone element
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {Image} image A Cornerstone Image object to add as a new layer
   * @param {Object} options Options for the layer
   *
   * @returns {String} layerId The new layer's unique identifier
   * @memberof EnabledElementLayers
   */

  function addLayer(element, image, options) {
    var layerId = Object(_internal_guid_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    var layers = enabledElement.layers;
    var viewport;

    if (image) {
      viewport = Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement.canvas, image); // Override the defaults if any optional viewport settings
      // have been specified

      if (options && options.viewport) {
        viewport = Object.assign(viewport, options.viewport);
      }
    } // Set syncViewports to true by default when a new layer is added


    if (enabledElement.syncViewports !== false) {
      enabledElement.syncViewports = true;
    }

    var newLayer = {
      image: image,
      layerId: layerId,
      viewport: viewport,
      options: options || {},
      renderingTools: {}
    }; // Rescale the new layer based on the base layer to make sure
    // they will have a proportional size (pixel spacing)

    if (layers.length && image) {
      rescaleImage(layers[0], newLayer);
    }

    layers.push(newLayer);
    triggerEventForLayer(_events_js__WEBPACK_IMPORTED_MODULE_5__["default"].LAYER_ADDED, enabledElement, layerId); // Set the layer as active if it's the first layer added

    if (layers.length === 1 && image) {
      setActiveLayer(element, layerId);
    }

    return layerId;
  }
  /**
   * Remove a layer from a Cornerstone element given a layer ID
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {String} layerId The unique identifier for the layer
   * @returns {void}
   * @memberof EnabledElementLayers
   */

  function removeLayer(element, layerId) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    var layers = enabledElement.layers;
    var index = enabledElement.layers.findIndex(function (layer) {
      return layer.layerId === layerId;
    });

    if (index !== -1) {
      layers.splice(index, 1); // If the current layer is active, and we have other layers,
      // switch to the first layer that remains in the array

      if (layerId === enabledElement.activeLayerId && layers.length) {
        setActiveLayer(element, layers[0].layerId);
      }

      triggerEventForLayer(_events_js__WEBPACK_IMPORTED_MODULE_5__["default"].LAYER_REMOVED, enabledElement, layerId);
    }
  }
  /**
   * Retrieve a layer from a Cornerstone element given a layer ID
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {String} layerId The unique identifier for the layer
   * @return {EnabledElementLayer} The layer
   * @memberof EnabledElementLayers
   */

  function getLayer(element, layerId) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    return enabledElement.layers.find(function (layer) {
      return layer.layerId === layerId;
    });
  }
  /**
   * Retrieve all layers for a Cornerstone element
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   *
   * @return {EnabledElementLayer[]} An array of layers
   * @memberof EnabledElementLayers
   */

  function getLayers(element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    return enabledElement.layers;
  }
  /**
   * Retrieve all visible layers for a Cornerstone element
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   *
   * @return {EnabledElementLayer[]} An array of layers
   * @memberof EnabledElementLayers
   */

  function getVisibleLayers(element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    return enabledElement.layers.filter(function (layer) {
      return layer.options && layer.options.visible !== false && layer.options.opacity !== 0;
    });
  }
  /**
   * Set the active layer for a Cornerstone element
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {String} layerId The unique identifier for the layer
   * @returns {void}
   * @memberof EnabledElementLayers
   */

  function setActiveLayer(element, layerId) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element); // Stop here if this layer is already active

    if (enabledElement.activeLayerId === layerId) {
      return;
    }

    var index = enabledElement.layers.findIndex(function (layer) {
      return layer.layerId === layerId;
    });

    if (index === -1) {
      throw new Error('setActiveLayer: layer not found in layers array');
    }

    var layer = enabledElement.layers[index];

    if (!layer.image) {
      throw new Error('setActiveLayer: layer with undefined image cannot be set as active.');
    }

    enabledElement.activeLayerId = layerId;
    enabledElement.image = layer.image;
    enabledElement.viewport = layer.viewport;
    Object(_updateImage_js__WEBPACK_IMPORTED_MODULE_3__["default"])(element);
    triggerEventForLayer(_events_js__WEBPACK_IMPORTED_MODULE_5__["default"].ACTIVE_LAYER_CHANGED, enabledElement, layerId);
  }
  /**
   * Set a new image for a specific layerId
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {Image} image The image to be displayed in this layer
   * @param {String} [layerId] The unique identifier for the layer
   * @returns {void}
   * @memberof EnabledElementLayers
   */

  function setLayerImage(element, image, layerId) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    var baseLayer = enabledElement.layers[0];
    var layer;

    if (layerId) {
      layer = getLayer(element, layerId);
    } else {
      layer = getActiveLayer(element);
    }

    if (!layer) {
      throw new Error('setLayerImage: Layer not found');
    }

    layer.image = image;

    if (!image) {
      layer.viewport = undefined;
      return;
    }

    if (!layer.viewport) {
      var defaultViewport = Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement.canvas, image); // Override the defaults if any optional viewport settings
      // have been specified

      if (layer.options && layer.options.viewport) {
        layer.viewport = Object.assign(defaultViewport, layer.options.viewport);
      }

      if (baseLayer.layerId !== layerId) {
        rescaleImage(baseLayer, layer);
      }
    }
  }
  /**
   * Retrieve the currently active layer for a Cornerstone element
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @return {EnabledElementLayer} The currently active layer
   * @memberof EnabledElementLayers
   */

  function getActiveLayer(element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    return enabledElement.layers.find(function (layer) {
      return layer.layerId === enabledElement.activeLayerId;
    });
  }
  /**
   * Purge the layers
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   *
   * @returns {void}
   */

  function purgeLayers(element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element);
    enabledElement.layers = [];
    delete enabledElement.activeLayerId;
    delete enabledElement.lastSyncViewportsState;
  }

  /***/ }),

  /***/ "./metaData.js":
  /*!*********************!*\
    !*** ./metaData.js ***!
    \*********************/
  /*! exports provided: addProvider, removeProvider, default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addProvider", function() { return addProvider; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "removeProvider", function() { return removeProvider; });
  // This module defines a way to access various metadata about an imageId.  This layer of abstraction exists
  // So metadata can be provided in different ways (e.g. by parsing DICOM P10 or by a WADO-RS document)
  var providers = [];
  /**
   * @module Metadata
   */

  /**
   * Adds a metadata provider with the specified priority
   * @param {Function} provider Metadata provider function
   * @param {Number} [priority=0] - 0 is default/normal, > 0 is high, < 0 is low
   *
   * @returns {void}
   * @memberof Metadata
   */

  function addProvider(provider) {
    var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var i; // Find the right spot to insert this provider based on priority

    for (i = 0; i < providers.length; i++) {
      if (providers[i].priority <= priority) {
        break;
      }
    } // Insert the decode task at position i


    providers.splice(i, 0, {
      priority: priority,
      provider: provider
    });
  }
  /**
   * Removes the specified provider
   *
   * @param {Function} provider Metadata provider function
   *
   * @returns {void}
   * @memberof Metadata
   */

  function removeProvider(provider) {
    for (var i = 0; i < providers.length; i++) {
      if (providers[i].provider === provider) {
        providers.splice(i, 1);
        break;
      }
    }
  }
  /**
   * Gets metadata from the registered metadata providers.  Will call each one from highest priority to lowest
   * until one responds
   *
   * @param {String} type The type of metadata requested from the metadata store
   * @param {String} imageId The Cornerstone Image Object's imageId
   *
   * @returns {*} The metadata retrieved from the metadata store
   * @memberof Metadata
   */

  function getMetaData(type, imageId) {
    // Invoke each provider in priority order until one returns something
    for (var i = 0; i < providers.length; i++) {
      var result = providers[i].provider(type, imageId);

      if (result !== undefined) {
        return result;
      }
    }
  }

  /* harmony default export */ __webpack_exports__["default"] = ({
    addProvider: addProvider,
    removeProvider: removeProvider,
    get: getMetaData
  });

  /***/ }),

  /***/ "./pageToPixel.js":
  /*!************************!*\
    !*** ./pageToPixel.js ***!
    \************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/getTransform.js */ "./internal/getTransform.js");


  /**
   * Converts a point in the page coordinate system to the pixel coordinate
   * system
   *
   * @param {HTMLElement} element The Cornerstone element within which the input point lies
   * @param {Number} pageX The x value in the page coordinate system
   * @param {Number} pageY The y value in the page coordinate system
   *
   * @returns {{x: Number, y: Number}} The transformed point in the pixel coordinate system
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, pageX, pageY) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);

    if (enabledElement.image === undefined) {
      throw new Error('image has not been loaded yet');
    } // Convert the pageX and pageY to the canvas client coordinates


    var rect = element.getBoundingClientRect();
    var clientX = pageX - rect.left - window.pageXOffset;
    var clientY = pageY - rect.top - window.pageYOffset;
    var pt = {
      x: clientX,
      y: clientY
    };
    var transform = Object(_internal_getTransform_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement);
    transform.invert();
    return transform.transformPoint(pt.x, pt.y);
  });

  /***/ }),

  /***/ "./pixelDataToFalseColorData.js":
  /*!**************************************!*\
    !*** ./pixelDataToFalseColorData.js ***!
    \**************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return pixelDataToFalseColorData; });
  /* harmony import */ var _colors_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./colors/index.js */ "./colors/index.js");

  /**
   * Converts the image pixel data into a false color data
   *
   * @param {Image} image A Cornerstone Image Object
   * @param {Object} lookupTable A lookup table Object
   *
   * @returns {void}
   * @deprecated This function is superseded by the ability to set the Viewport parameters
   * to include colormaps.
   */

  function pixelDataToFalseColorData(image, lookupTable) {
    if (image.color && !image.falseColor) {
      throw new Error('Color transforms are not implemented yet');
    }

    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0;
    var numPixels = image.width * image.height;
    var origPixelData = image.origPixelData || image.getPixelData();
    var storedColorPixelData = new Uint8Array(numPixels * 4);
    var sp;
    var mapped;
    image.color = true;
    image.falseColor = true;
    image.origPixelData = origPixelData;

    if (lookupTable instanceof _colors_index_js__WEBPACK_IMPORTED_MODULE_0__["default"].LookupTable) {
      lookupTable.build();

      while (storedPixelDataIndex < numPixels) {
        sp = origPixelData[storedPixelDataIndex++];
        mapped = lookupTable.mapValue(sp);
        storedColorPixelData[canvasImageDataIndex++] = mapped[0];
        storedColorPixelData[canvasImageDataIndex++] = mapped[1];
        storedColorPixelData[canvasImageDataIndex++] = mapped[2];
        storedColorPixelData[canvasImageDataIndex++] = mapped[3];
      }
    } else if (minPixelValue < 0) {
      while (storedPixelDataIndex < numPixels) {
        sp = origPixelData[storedPixelDataIndex++];
        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][0]; // Red

        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][1]; // Green

        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][2]; // Blue

        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp + -minPixelValue][3]; // Alpha
      }
    } else {
      while (storedPixelDataIndex < numPixels) {
        sp = origPixelData[storedPixelDataIndex++];
        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][0]; // Red

        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][1]; // Green

        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][2]; // Blue

        storedColorPixelData[canvasImageDataIndex++] = lookupTable[sp][3]; // Alpha
      }
    }

    image.rgba = true;
    image.cachedLut = undefined;
    image.render = undefined;
    image.slope = 1;
    image.intercept = 0;
    image.minPixelValue = 0;
    image.maxPixelValue = 255;
    image.windowWidth = 255;
    image.windowCenter = 128;

    image.getPixelData = function () {
      return storedColorPixelData;
    };
  }

  /***/ }),

  /***/ "./pixelToCanvas.js":
  /*!**************************!*\
    !*** ./pixelToCanvas.js ***!
    \**************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getTransform_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/getTransform.js */ "./internal/getTransform.js");


  /**
   * Converts a point in the pixel coordinate system to the canvas coordinate system
   * system.  This can be used to render using canvas context without having the weird
   * side effects that come from scaling and non square pixels
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @param {{x: Number, y: Number}} pt The transformed point in the pixel coordinate system
   *
   * @returns {{x: Number, y: Number}} The input point in the canvas coordinate system
   * @memberof PixelCoordinateSystem
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, pt) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var transform = Object(_internal_getTransform_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement);
    return transform.transformPoint(pt.x, pt.y);
  });

  /***/ }),

  /***/ "./rendering/doesImageNeedToBeRendered.js":
  /*!************************************************!*\
    !*** ./rendering/doesImageNeedToBeRendered.js ***!
    \************************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Determine whether or not an Enabled Element needs to be re-rendered.
   *
   * If the imageId has changed, or if any of the last rendered viewport
   * parameters have changed, this function will return true.
   *
   * @param {EnabledElement} enabledElement An Enabled Element
   * @param {Image} image An Image
   * @return {boolean} Whether or not the Enabled Element needs to re-render its image
   * @memberof rendering
   */
  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement, image) {
    var lastRenderedImageId = enabledElement.renderingTools.lastRenderedImageId;
    var lastRenderedViewport = enabledElement.renderingTools.lastRenderedViewport;
    return image.imageId !== lastRenderedImageId || !lastRenderedViewport || lastRenderedViewport.windowCenter !== enabledElement.viewport.voi.windowCenter || lastRenderedViewport.windowWidth !== enabledElement.viewport.voi.windowWidth || lastRenderedViewport.invert !== enabledElement.viewport.invert || lastRenderedViewport.rotation !== enabledElement.viewport.rotation || lastRenderedViewport.hflip !== enabledElement.viewport.hflip || lastRenderedViewport.vflip !== enabledElement.viewport.vflip || lastRenderedViewport.modalityLUT !== enabledElement.viewport.modalityLUT || lastRenderedViewport.voiLUT !== enabledElement.viewport.voiLUT || lastRenderedViewport.colormap !== enabledElement.viewport.colormap;
  });

  /***/ }),

  /***/ "./rendering/getLut.js":
  /*!*****************************!*\
    !*** ./rendering/getLut.js ***!
    \*****************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _internal_computeAutoVoi_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/computeAutoVoi.js */ "./internal/computeAutoVoi.js");
  /* harmony import */ var _lutMatches_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lutMatches.js */ "./rendering/lutMatches.js");
  /* harmony import */ var _internal_generateLut_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../internal/generateLut.js */ "./internal/generateLut.js");



  /**
   * Retrieve or generate a LUT Array for an Image and Viewport
   *
   * @param {Image} image An Image Object
   * @param {Viewport} viewport An Viewport Object
   * @param {Boolean} invalidated Whether or not the LUT data has been invalidated
   * (e.g. by a change to the windowWidth, windowCenter, or invert viewport parameters).
   * @return {Uint8ClampedArray} LUT Array
   * @memberof rendering
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (image, viewport, invalidated) {
    // If we have a cached lut and it has the right values, return it immediately
    if (image.cachedLut !== undefined && image.cachedLut.windowCenter === viewport.voi.windowCenter && image.cachedLut.windowWidth === viewport.voi.windowWidth && Object(_lutMatches_js__WEBPACK_IMPORTED_MODULE_1__["default"])(image.cachedLut.modalityLUT, viewport.modalityLUT) && Object(_lutMatches_js__WEBPACK_IMPORTED_MODULE_1__["default"])(image.cachedLut.voiLUT, viewport.voiLUT) && image.cachedLut.invert === viewport.invert && invalidated !== true) {
      return image.cachedLut.lutArray;
    }

    Object(_internal_computeAutoVoi_js__WEBPACK_IMPORTED_MODULE_0__["default"])(viewport, image); // Lut is invalid or not present, regenerate it and cache it

    Object(_internal_generateLut_js__WEBPACK_IMPORTED_MODULE_2__["default"])(image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert, viewport.modalityLUT, viewport.voiLUT);
    image.cachedLut.windowWidth = viewport.voi.windowWidth;
    image.cachedLut.windowCenter = viewport.voi.windowCenter;
    image.cachedLut.invert = viewport.invert;
    image.cachedLut.voiLUT = viewport.voiLUT;
    image.cachedLut.modalityLUT = viewport.modalityLUT;
    return image.cachedLut.lutArray;
  });

  /***/ }),

  /***/ "./rendering/index.js":
  /*!****************************!*\
    !*** ./rendering/index.js ***!
    \****************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _renderColorImage_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./renderColorImage.js */ "./rendering/renderColorImage.js");
  /* harmony import */ var _renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./renderGrayscaleImage.js */ "./rendering/renderGrayscaleImage.js");
  /* harmony import */ var _renderWebImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./renderWebImage.js */ "./rendering/renderWebImage.js");
  /* harmony import */ var _renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./renderPseudoColorImage.js */ "./rendering/renderPseudoColorImage.js");
  /* harmony import */ var _renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./renderLabelMapImage.js */ "./rendering/renderLabelMapImage.js");
  /* harmony import */ var _renderToCanvas_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./renderToCanvas.js */ "./rendering/renderToCanvas.js");






  /**
   * @module rendering
   */

  /* harmony default export */ __webpack_exports__["default"] = ({
    colorImage: _renderColorImage_js__WEBPACK_IMPORTED_MODULE_0__["renderColorImage"],
    grayscaleImage: _renderGrayscaleImage_js__WEBPACK_IMPORTED_MODULE_1__["renderGrayscaleImage"],
    webImage: _renderWebImage_js__WEBPACK_IMPORTED_MODULE_2__["renderWebImage"],
    pseudoColorImage: _renderPseudoColorImage_js__WEBPACK_IMPORTED_MODULE_3__["renderPseudoColorImage"],
    labelMapImage: _renderLabelMapImage_js__WEBPACK_IMPORTED_MODULE_4__["renderLabelMapImage"],
    toCanvas: _renderToCanvas_js__WEBPACK_IMPORTED_MODULE_5__["default"]
  });

  /***/ }),

  /***/ "./rendering/initializeRenderCanvas.js":
  /*!*********************************************!*\
    !*** ./rendering/initializeRenderCanvas.js ***!
    \*********************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Sets size and clears canvas
   *
   * @param {Object} enabledElement Cornerstone Enabled Element
   * @param {Object} image Image to be rendered
   * @returns {void}
   * @memberof rendering
   */
  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement, image) {
    var renderCanvas = enabledElement.renderingTools.renderCanvas; // Resize the canvas

    renderCanvas.width = image.width;
    renderCanvas.height = image.height;
    var canvasContext = renderCanvas.getContext('2d'); // NOTE - we need to fill the render canvas with white pixels since we
    // control the luminance using the alpha channel to improve rendering performance.

    canvasContext.fillStyle = 'white';
    canvasContext.fillRect(0, 0, renderCanvas.width, renderCanvas.height);
    var renderCanvasData = canvasContext.getImageData(0, 0, image.width, image.height);
    enabledElement.renderingTools.renderCanvasContext = canvasContext;
    enabledElement.renderingTools.renderCanvasData = renderCanvasData;
  });

  /***/ }),

  /***/ "./rendering/lutMatches.js":
  /*!*********************************!*\
    !*** ./rendering/lutMatches.js ***!
    \*********************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Check if two lookup tables match
   *
   * @param {LUT} a A lookup table function
   * @param {LUT} b Another lookup table function
   * @return {boolean} Whether or not they match
   * @memberof rendering
   */
  /* harmony default export */ __webpack_exports__["default"] = (function (a, b) {
    // If undefined, they are equal
    if (!a && !b) {
      return true;
    } // If one is undefined, not equal


    if (!a || !b) {
      return false;
    } // Check the unique ids


    return a.id === b.id;
  });

  /***/ }),

  /***/ "./rendering/renderColorImage.js":
  /*!***************************************!*\
    !*** ./rendering/renderColorImage.js ***!
    \***************************************/
  /*! exports provided: renderColorImage, addColorLayer */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "renderColorImage", function() { return renderColorImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addColorLayer", function() { return addColorLayer; });
  /* harmony import */ var _internal_now_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/now.js */ "./internal/now.js");
  /* harmony import */ var _internal_generateColorLut_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../internal/generateColorLut.js */ "./internal/generateColorLut.js");
  /* harmony import */ var _internal_storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../internal/storedColorPixelDataToCanvasImageData.js */ "./internal/storedColorPixelDataToCanvasImageData.js");
  /* harmony import */ var _internal_storedRGBAPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../internal/storedRGBAPixelDataToCanvasImageData.js */ "./internal/storedRGBAPixelDataToCanvasImageData.js");
  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");
  /* harmony import */ var _webgl_index_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../webgl/index.js */ "./webgl/index.js");
  /* harmony import */ var _doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./doesImageNeedToBeRendered.js */ "./rendering/doesImageNeedToBeRendered.js");
  /* harmony import */ var _initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./initializeRenderCanvas.js */ "./rendering/initializeRenderCanvas.js");
  /* harmony import */ var _saveLastRendered_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./saveLastRendered.js */ "./rendering/saveLastRendered.js");









  /**
   * Generates an appropriate Look Up Table to render the given image with the given window width and level (specified in the viewport)
   * Uses an internal cache for performance
   *
   * @param {Object} image  The image to be rendered
   * @param {Object} viewport The viewport values used for rendering
   * @returns {Uint8ClampedArray} Look Up Table array.
   * @memberof rendering
   */

  function getLut(image, viewport) {
    // If we have a cached lut and it has the right values, return it immediately
    if (image.cachedLut !== undefined && image.cachedLut.windowCenter === viewport.voi.windowCenter && image.cachedLut.windowWidth === viewport.voi.windowWidth && image.cachedLut.invert === viewport.invert) {
      return image.cachedLut.lutArray;
    } // Lut is invalid or not present, regenerate it and cache it


    Object(_internal_generateColorLut_js__WEBPACK_IMPORTED_MODULE_1__["default"])(image, viewport.voi.windowWidth, viewport.voi.windowCenter, viewport.invert);
    image.cachedLut.windowWidth = viewport.voi.windowWidth;
    image.cachedLut.windowCenter = viewport.voi.windowCenter;
    image.cachedLut.invert = viewport.invert;
    return image.cachedLut.lutArray;
  }
  /**
   * Returns an appropriate canvas to render the Image. If the canvas available in the cache is appropriate
   * it is returned, otherwise adjustments are made. It also sets the color transfer functions.
   *
   * @param {Object} enabledElement The cornerstone enabled element
   * @param {Object} image The image to be rendered
   * @param {Boolean} invalidated Is pixel data valid
   * @returns {HTMLCanvasElement} An appropriate canvas for rendering the image
   * @memberof rendering
   */


  function getRenderCanvas(enabledElement, image, invalidated) {
    var canvasWasColor = enabledElement.renderingTools.lastRenderedIsColor === true;

    if (!enabledElement.renderingTools.renderCanvas || !canvasWasColor) {
      enabledElement.renderingTools.renderCanvas = document.createElement('canvas');
    }

    var renderCanvas = enabledElement.renderingTools.renderCanvas; // The ww/wc is identity and not inverted - get a canvas with the image rendered into it for
    // Fast drawing

    if (enabledElement.viewport.voi.windowWidth === 255 && enabledElement.viewport.voi.windowCenter === 128 && enabledElement.viewport.invert === false && image.getCanvas && image.getCanvas()) {
      return image.getCanvas();
    } // Apply the lut to the stored pixel data onto the render canvas


    if (Object(_doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_6__["default"])(enabledElement, image) === false && invalidated !== true) {
      return renderCanvas;
    } // If our render canvas does not match the size of this image reset it
    // NOTE: This might be inefficient if we are updating multiple images of different
    // Sizes frequently.


    if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {
      Object(_initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_7__["default"])(enabledElement, image);
    } // Get the lut to use


    var start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    var colorLut = getLut(image, enabledElement.viewport);
    image.stats = image.stats || {};
    image.stats.lastLutGenerateTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    var renderCanvasData = enabledElement.renderingTools.renderCanvasData;
    var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext; // The color image voi/invert has been modified - apply the lut to the underlying
    // Pixel data and put it into the renderCanvas

    if (image.rgba) {
      Object(_internal_storedRGBAPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_3__["default"])(image, colorLut, renderCanvasData.data);
    } else {
      Object(_internal_storedColorPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_2__["default"])(image, colorLut, renderCanvasData.data);
    }

    start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
    renderCanvasContext.putImageData(renderCanvasData, 0, 0);
    image.stats.lastPutImageDataTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_0__["default"])() - start;
    return renderCanvas;
  }
  /**
   * API function to render a color image to an enabled element
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof rendering
   */


  function renderColorImage(enabledElement, invalidated) {
    if (enabledElement === undefined) {
      throw new Error('renderColorImage: enabledElement parameter must not be undefined');
    }

    var image = enabledElement.image;

    if (image === undefined) {
      throw new Error('renderColorImage: image must be loaded before it can be drawn');
    } // Get the canvas context and reset the transform


    var context = enabledElement.canvas.getContext('2d');
    context.setTransform(1, 0, 0, 1, 0, 0); // Clear the canvas

    context.fillStyle = 'black';
    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled; // Save the canvas context state and apply the viewport properties

    Object(_setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_4__["default"])(enabledElement, context);
    var renderCanvas;

    if (enabledElement.options && enabledElement.options.renderer && enabledElement.options.renderer.toLowerCase() === 'webgl') {
      // If this enabled element has the option set for WebGL, we should
      // User it as our renderer.
      renderCanvas = _webgl_index_js__WEBPACK_IMPORTED_MODULE_5__["default"].renderer.render(enabledElement);
    } else {
      // If no options are set we will retrieve the renderCanvas through the
      // Normal Canvas rendering path
      renderCanvas = getRenderCanvas(enabledElement, image, invalidated);
    }

    var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;
    var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;
    var width = enabledElement.viewport.displayedArea.brhc.x - sx;
    var height = enabledElement.viewport.displayedArea.brhc.y - sy;
    context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);
    enabledElement.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_8__["default"])(enabledElement);
  }
  function addColorLayer(layer, invalidated) {
    if (layer === undefined) {
      throw new Error('addColorLayer: layer parameter must not be undefined');
    }

    var image = layer.image;

    if (image === undefined) {
      throw new Error('addColorLayer: image must be loaded before it can be drawn');
    } // All multi-layer images should include the alpha value


    image.rgba = true;
    layer.canvas = getRenderCanvas(layer, image, invalidated);
    var context = layer.canvas.getContext('2d'); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !layer.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;
    layer.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_8__["default"])(layer);
  }

  /***/ }),

  /***/ "./rendering/renderGrayscaleImage.js":
  /*!*******************************************!*\
    !*** ./rendering/renderGrayscaleImage.js ***!
    \*******************************************/
  /*! exports provided: renderGrayscaleImage, addGrayscaleLayer */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "renderGrayscaleImage", function() { return renderGrayscaleImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addGrayscaleLayer", function() { return addGrayscaleLayer; });
  /* harmony import */ var _internal_storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/storedPixelDataToCanvasImageData.js */ "./internal/storedPixelDataToCanvasImageData.js");
  /* harmony import */ var _internal_storedPixelDataToCanvasImageDataRGBA_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../internal/storedPixelDataToCanvasImageDataRGBA.js */ "./internal/storedPixelDataToCanvasImageDataRGBA.js");
  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");
  /* harmony import */ var _internal_now_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../internal/now.js */ "./internal/now.js");
  /* harmony import */ var _webgl_index_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../webgl/index.js */ "./webgl/index.js");
  /* harmony import */ var _getLut_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./getLut.js */ "./rendering/getLut.js");
  /* harmony import */ var _doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./doesImageNeedToBeRendered.js */ "./rendering/doesImageNeedToBeRendered.js");
  /* harmony import */ var _initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./initializeRenderCanvas.js */ "./rendering/initializeRenderCanvas.js");
  /* harmony import */ var _saveLastRendered_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./saveLastRendered.js */ "./rendering/saveLastRendered.js");









  /**
   * Returns an appropriate canvas to render the Image. If the canvas available in the cache is appropriate
   * it is returned, otherwise adjustments are made. It also sets the color transfer functions.
   *
   * @param {Object} enabledElement The cornerstone enabled element
   * @param {Object} image The image to be rendered
   * @param {Boolean} invalidated Is pixel data valid
   * @param {Boolean} [useAlphaChannel = true] Will an alpha channel be used
   * @returns {HTMLCanvasElement} An appropriate canvas for rendering the image
   * @memberof rendering
   */

  function getRenderCanvas(enabledElement, image, invalidated) {
    var useAlphaChannel = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
    var canvasWasColor = enabledElement.renderingTools.lastRenderedIsColor === true;

    if (!enabledElement.renderingTools.renderCanvas || canvasWasColor) {
      enabledElement.renderingTools.renderCanvas = document.createElement('canvas');
      Object(_initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_7__["default"])(enabledElement, image);
    }

    var renderCanvas = enabledElement.renderingTools.renderCanvas;

    if (Object(_doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_6__["default"])(enabledElement, image) === false && invalidated !== true) {
      return renderCanvas;
    } // If our render canvas does not match the size of this image reset it
    // NOTE: This might be inefficient if we are updating multiple images of different
    // Sizes frequently.


    if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {
      Object(_initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_7__["default"])(enabledElement, image);
    } // Get the lut to use


    var start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_3__["default"])();
    var lut = Object(_getLut_js__WEBPACK_IMPORTED_MODULE_5__["default"])(image, enabledElement.viewport, invalidated);
    image.stats = image.stats || {};
    image.stats.lastLutGenerateTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_3__["default"])() - start;
    var renderCanvasData = enabledElement.renderingTools.renderCanvasData;
    var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext; // Gray scale image - apply the lut and put the resulting image onto the render canvas

    if (useAlphaChannel) {
      Object(_internal_storedPixelDataToCanvasImageData_js__WEBPACK_IMPORTED_MODULE_0__["default"])(image, lut, renderCanvasData.data);
    } else {
      Object(_internal_storedPixelDataToCanvasImageDataRGBA_js__WEBPACK_IMPORTED_MODULE_1__["default"])(image, lut, renderCanvasData.data);
    }

    start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_3__["default"])();
    renderCanvasContext.putImageData(renderCanvasData, 0, 0);
    image.stats.lastPutImageDataTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_3__["default"])() - start;
    return renderCanvas;
  }
  /**
   * API function to draw a grayscale image to a given enabledElement
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof rendering
   */


  function renderGrayscaleImage(enabledElement, invalidated) {
    if (enabledElement === undefined) {
      throw new Error('drawImage: enabledElement parameter must not be undefined');
    }

    var image = enabledElement.image;

    if (image === undefined) {
      throw new Error('drawImage: image must be loaded before it can be drawn');
    } // Get the canvas context and reset the transform


    var context = enabledElement.canvas.getContext('2d');
    context.setTransform(1, 0, 0, 1, 0, 0); // Clear the canvas

    context.fillStyle = 'black';
    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled; // Save the canvas context state and apply the viewport properties

    Object(_setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement, context);
    var renderCanvas;

    if (enabledElement.options && enabledElement.options.renderer && enabledElement.options.renderer.toLowerCase() === 'webgl') {
      // If this enabled element has the option set for WebGL, we should
      // User it as our renderer.
      renderCanvas = _webgl_index_js__WEBPACK_IMPORTED_MODULE_4__["default"].renderer.render(enabledElement);
    } else {
      // If no options are set we will retrieve the renderCanvas through the
      // Normal Canvas rendering path
      renderCanvas = getRenderCanvas(enabledElement, image, invalidated);
    }

    var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;
    var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;
    var width = enabledElement.viewport.displayedArea.brhc.x - sx;
    var height = enabledElement.viewport.displayedArea.brhc.y - sy;
    context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);
    enabledElement.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_8__["default"])(enabledElement);
  }
  /**
   * API function to draw a grayscale image to a given layer
   *
   * @param {EnabledElementLayer} layer The layer that the image will be added to
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @param {Boolean} [useAlphaChannel] - Whether or not to render the grayscale image using only the alpha channel.
                                          This does not work if this layer is not the first layer in the enabledElement.
   * @returns {void}
   */

  function addGrayscaleLayer(layer, invalidated) {
    var useAlphaChannel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

    if (layer === undefined) {
      throw new Error('addGrayscaleLayer: layer parameter must not be undefined');
    }

    var image = layer.image;

    if (image === undefined) {
      throw new Error('addGrayscaleLayer: image must be loaded before it can be drawn');
    }

    layer.canvas = getRenderCanvas(layer, image, invalidated, useAlphaChannel);
    var context = layer.canvas.getContext('2d'); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !layer.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;
    layer.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_8__["default"])(layer);
  }

  /***/ }),

  /***/ "./rendering/renderLabelMapImage.js":
  /*!******************************************!*\
    !*** ./rendering/renderLabelMapImage.js ***!
    \******************************************/
  /*! exports provided: renderLabelMapImage, addLabelMapLayer */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "renderLabelMapImage", function() { return renderLabelMapImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addLabelMapLayer", function() { return addLabelMapLayer; });
  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");
  /* harmony import */ var _internal_now_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../internal/now.js */ "./internal/now.js");
  /* harmony import */ var _initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./initializeRenderCanvas.js */ "./rendering/initializeRenderCanvas.js");
  /* harmony import */ var _saveLastRendered_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./saveLastRendered.js */ "./rendering/saveLastRendered.js");
  /* harmony import */ var _doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./doesImageNeedToBeRendered.js */ "./rendering/doesImageNeedToBeRendered.js");
  /* harmony import */ var _internal_storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../internal/storedPixelDataToCanvasImageDataColorLUT.js */ "./internal/storedPixelDataToCanvasImageDataColorLUT.js");
  /* harmony import */ var _colors_index_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../colors/index.js */ "./colors/index.js");







  /**
   * Returns an appropriate canvas to render the Image. If the canvas available in the cache is appropriate
   * it is returned, otherwise adjustments are made. It also sets the color transfer functions.
   *
   * @param {Object} enabledElement The cornerstone enabled element
   * @param {Object} image The image to be rendered
   * @param {Boolean} invalidated Is pixel data valid
   * @returns {HTMLCanvasElement} An appropriate canvas for rendering the image
   * @memberof rendering
   */

  function getRenderCanvas(enabledElement, image, invalidated) {
    if (!enabledElement.renderingTools.renderCanvas) {
      enabledElement.renderingTools.renderCanvas = document.createElement('canvas');
    }

    var renderCanvas = enabledElement.renderingTools.renderCanvas;
    var colormap = enabledElement.viewport.colormap || enabledElement.options.colormap;

    if (enabledElement.options.colormap) {
      console.warn('enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead');
    }

    if (colormap && typeof colormap === 'string') {
      colormap = _colors_index_js__WEBPACK_IMPORTED_MODULE_6__["default"].getColormap(colormap);
    }

    if (!colormap) {
      throw new Error('renderLabelMapImage: colormap not found.');
    }

    var colormapId = colormap.getId();

    if (Object(_doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_4__["default"])(enabledElement, image) === false && invalidated !== true && enabledElement.renderingTools.colormapId === colormapId) {
      return renderCanvas;
    } // If our render canvas does not match the size of this image reset it
    // NOTE: This might be inefficient if we are updating multiple images of different
    // Sizes frequently.


    if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {
      Object(_initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement, image);
    } // Get the lut to use


    var start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();

    if (!enabledElement.renderingTools.colorLut || invalidated || enabledElement.renderingTools.colormapId !== colormapId) {
      enabledElement.renderingTools.colorLut = colormap.createLookupTable();
      enabledElement.renderingTools.colormapId = colormapId;
    }

    image.stats = image.stats || {};
    image.stats.lastLutGenerateTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
    var colorLut = enabledElement.renderingTools.colorLut;
    var renderCanvasData = enabledElement.renderingTools.renderCanvasData;
    var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;
    Object(_internal_storedPixelDataToCanvasImageDataColorLUT_js__WEBPACK_IMPORTED_MODULE_5__["default"])(image, colorLut, renderCanvasData.data);
    start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();
    renderCanvasContext.putImageData(renderCanvasData, 0, 0);
    image.stats.lastPutImageDataTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
    return renderCanvas;
  }
  /**
   * API function to draw a label map image to a given enabledElement
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof rendering
   */


  function renderLabelMapImage(enabledElement, invalidated) {
    if (enabledElement === undefined) {
      throw new Error('renderLabelMapImage: enabledElement parameter must not be undefined');
    }

    var image = enabledElement.image;

    if (image === undefined) {
      throw new Error('renderLabelMapImage: image must be loaded before it can be drawn');
    } // Get the canvas context and reset the transform


    var context = enabledElement.canvas.getContext('2d');
    context.setTransform(1, 0, 0, 1, 0, 0); // Clear the canvas

    context.fillStyle = 'black';
    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled; // Save the canvas context state and apply the viewport properties

    Object(_setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElement, context); // If no options are set we will retrieve the renderCanvas through the
    // Normal Canvas rendering path
    // TODO: Add WebGL support for label map pipeline

    var renderCanvas = getRenderCanvas(enabledElement, image, invalidated);
    var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;
    var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;
    var width = enabledElement.viewport.displayedArea.brhc.x - sx;
    var height = enabledElement.viewport.displayedArea.brhc.y - sy;
    context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);
    enabledElement.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_3__["default"])(enabledElement);
  }
  /**
   * API function to draw a pseudo-color image to a given layer
   *
   * @param {EnabledElementLayer} layer The layer that the image will be added to
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   */

  function addLabelMapLayer(layer, invalidated) {
    if (layer === undefined) {
      throw new Error('addLabelMapLayer: layer parameter must not be undefined');
    }

    var image = layer.image;

    if (image === undefined) {
      throw new Error('addLabelMapLayer: image must be loaded before it can be drawn');
    }

    layer.canvas = getRenderCanvas(layer, image, invalidated);
    var context = layer.canvas.getContext('2d'); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !layer.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;
    layer.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_3__["default"])(layer);
  }

  /***/ }),

  /***/ "./rendering/renderPseudoColorImage.js":
  /*!*********************************************!*\
    !*** ./rendering/renderPseudoColorImage.js ***!
    \*********************************************/
  /*! exports provided: renderPseudoColorImage, addPseudoColorLayer */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "renderPseudoColorImage", function() { return renderPseudoColorImage; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addPseudoColorLayer", function() { return addPseudoColorLayer; });
  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");
  /* harmony import */ var _internal_now_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../internal/now.js */ "./internal/now.js");
  /* harmony import */ var _initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./initializeRenderCanvas.js */ "./rendering/initializeRenderCanvas.js");
  /* harmony import */ var _getLut_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./getLut.js */ "./rendering/getLut.js");
  /* harmony import */ var _saveLastRendered_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./saveLastRendered.js */ "./rendering/saveLastRendered.js");
  /* harmony import */ var _doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./doesImageNeedToBeRendered.js */ "./rendering/doesImageNeedToBeRendered.js");
  /* harmony import */ var _internal_storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js */ "./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");
  /* harmony import */ var _colors_index_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../colors/index.js */ "./colors/index.js");








  /**
   * Returns an appropriate canvas to render the Image. If the canvas available in the cache is appropriate
   * it is returned, otherwise adjustments are made. It also sets the color transfer functions.
   *
   * @param {Object} enabledElement The cornerstone enabled element
   * @param {Object} image The image to be rendered
   * @param {Boolean} invalidated Is pixel data valid
   * @returns {HTMLCanvasElement} An appropriate canvas for rendering the image
   * @memberof rendering
   */

  function getRenderCanvas(enabledElement, image, invalidated) {
    if (!enabledElement.renderingTools.renderCanvas) {
      enabledElement.renderingTools.renderCanvas = document.createElement('canvas');
    }

    var renderCanvas = enabledElement.renderingTools.renderCanvas;
    var colormap = enabledElement.viewport.colormap || enabledElement.options.colormap;

    if (enabledElement.options.colormap) {
      console.warn('enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead');
    }

    if (colormap && typeof colormap === 'string') {
      colormap = _colors_index_js__WEBPACK_IMPORTED_MODULE_7__["default"].getColormap(colormap);
    }

    if (!colormap) {
      throw new Error('renderPseudoColorImage: colormap not found.');
    }

    var colormapId = colormap.getId();

    if (Object(_doesImageNeedToBeRendered_js__WEBPACK_IMPORTED_MODULE_5__["default"])(enabledElement, image) === false && invalidated !== true && enabledElement.renderingTools.colormapId === colormapId) {
      return renderCanvas;
    } // If our render canvas does not match the size of this image reset it
    // NOTE: This might be inefficient if we are updating multiple images of different
    // Sizes frequently.


    if (renderCanvas.width !== image.width || renderCanvas.height !== image.height) {
      Object(_initializeRenderCanvas_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElement, image);
    } // Get the lut to use


    var start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();

    if (!enabledElement.renderingTools.colorLut || invalidated || enabledElement.renderingTools.colormapId !== colormapId) {
      colormap.setNumberOfColors(256);
      enabledElement.renderingTools.colorLut = colormap.createLookupTable();
      enabledElement.renderingTools.colormapId = colormapId;
    }

    var lut = Object(_getLut_js__WEBPACK_IMPORTED_MODULE_3__["default"])(image, enabledElement.viewport, invalidated);
    image.stats = image.stats || {};
    image.stats.lastLutGenerateTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
    var colorLut = enabledElement.renderingTools.colorLut;
    var renderCanvasData = enabledElement.renderingTools.renderCanvasData;
    var renderCanvasContext = enabledElement.renderingTools.renderCanvasContext;
    Object(_internal_storedPixelDataToCanvasImageDataPseudocolorLUT_js__WEBPACK_IMPORTED_MODULE_6__["default"])(image, lut, colorLut, renderCanvasData.data);
    start = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])();
    renderCanvasContext.putImageData(renderCanvasData, 0, 0);
    image.stats.lastPutImageDataTime = Object(_internal_now_js__WEBPACK_IMPORTED_MODULE_1__["default"])() - start;
    return renderCanvas;
  }
  /**
   * API function to draw a pseudo-color image to a given enabledElement
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof rendering
   */


  function renderPseudoColorImage(enabledElement, invalidated) {
    if (enabledElement === undefined) {
      throw new Error('drawImage: enabledElement parameter must not be undefined');
    }

    var image = enabledElement.image;

    if (image === undefined) {
      throw new Error('drawImage: image must be loaded before it can be drawn');
    } // Get the canvas context and reset the transform


    var context = enabledElement.canvas.getContext('2d');
    context.setTransform(1, 0, 0, 1, 0, 0); // Clear the canvas

    context.fillStyle = 'black';
    context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled; // Save the canvas context state and apply the viewport properties

    Object(_setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElement, context); // If no options are set we will retrieve the renderCanvas through the
    // Normal Canvas rendering path
    // TODO: Add WebGL support for pseudocolor pipeline

    var renderCanvas = getRenderCanvas(enabledElement, image, invalidated);
    var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;
    var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;
    var width = enabledElement.viewport.displayedArea.brhc.x - sx;
    var height = enabledElement.viewport.displayedArea.brhc.y - sy;
    context.drawImage(renderCanvas, sx, sy, width, height, 0, 0, width, height);
    enabledElement.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_4__["default"])(enabledElement);
  }
  /**
   * API function to draw a pseudo-color image to a given layer
   *
   * @param {EnabledElementLayer} layer The layer that the image will be added to
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   */

  function addPseudoColorLayer(layer, invalidated) {
    if (layer === undefined) {
      throw new Error('addPseudoColorLayer: layer parameter must not be undefined');
    }

    var image = layer.image;

    if (image === undefined) {
      throw new Error('addPseudoColorLayer: image must be loaded before it can be drawn');
    }

    layer.canvas = getRenderCanvas(layer, image, invalidated);
    var context = layer.canvas.getContext('2d'); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

    context.imageSmoothingEnabled = !layer.viewport.pixelReplication;
    context.mozImageSmoothingEnabled = context.imageSmoothingEnabled;
    layer.renderingTools = Object(_saveLastRendered_js__WEBPACK_IMPORTED_MODULE_4__["default"])(layer);
  }

  /***/ }),

  /***/ "./rendering/renderToCanvas.js":
  /*!*************************************!*\
    !*** ./rendering/renderToCanvas.js ***!
    \*************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../events.js */ "./events.js");
  /* harmony import */ var _internal_drawImageSync_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../internal/drawImageSync.js */ "./internal/drawImageSync.js");
  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony import */ var _internal_tryEnableWebgl_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../internal/tryEnableWebgl.js */ "./internal/tryEnableWebgl.js");





  /**
   * @typedef {Object} EnabledElementStub
   * @property {HTMLElement} element  The enabled element
   * @property {HTMLCanvasElement} canvas The current canvas
   * @property {Object} image Currently displayed image
   * @property {Boolean} invalid Whether or not the image pixel data has been changed
   * @property {Boolean} needsRedraw  A flag for triggering a redraw of the canvas without re-retrieving the pixel data, since it remains valid
   * @property {Object} options Layer drawing options
   * @property {Object[]} layers Layers added to the EnabledElement
   * @property {Object} data
   * @property {Object} renderingTools
   * @property {Object} viewport The current viewport
   * @memberof rendering
   */

  /**
   * creates a dummy enabled element
   *
   * @param {HTMLCanvasElement} canvas the canvas that will be assigned to the enabled element.
   * @param {any} image An Image loaded by a Cornerstone Image Loader
   * @param { any } options Options for rendering the image (e.g.enable webgl by {renderer: 'webgl' })
   * @param { any } viewport A set of Cornerstone viewport parameters
   * @returns {EnabledElementStub} a dummy enabled element
   * @memberof rendering
   */

  function createEnabledElementStub(canvas, image, options, viewport) {
    return {
      element: canvas,
      canvas: canvas,
      image: image,
      invalid: true,
      // True if image needs to be drawn, false if not
      needsRedraw: true,
      options: options,
      layers: [],
      data: {},
      renderingTools: {},
      viewport: viewport
    };
  }
  /**
   * Render the image to the provided canvas immediately.
   * @param {any} canvas The HTML canvas where the image will be rendered.
   * @param {any} image An Image loaded by a Cornerstone Image Loader
   * @param {any} [viewport = null] A set of Cornerstone viewport parameters
   * @param {any} [options = null] Options for rendering the image (e.g. enable webgl by {renderer: 'webgl'})
   * @returns {void}
   * @memberof rendering
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (canvas, image) {
    var viewport = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

    if (canvas === undefined) {
      throw new Error('renderToCanvas: parameter canvas cannot be undefined');
    } // If this enabled element has the option set for WebGL, we should
    // Check if this device actually supports it


    if (options && options.renderer && options.renderer.toLowerCase() === 'webgl') {
      Object(_internal_tryEnableWebgl_js__WEBPACK_IMPORTED_MODULE_4__["default"])(options);
    }

    var defaultViewport = Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_3__["default"])(canvas, image);

    if (viewport) {
      Object.assign(defaultViewport, viewport);
    }

    var enabledElementStub = createEnabledElementStub(canvas, image, options, defaultViewport);
    var eventDetails = {
      enabledElement: enabledElementStub,
      timestamp: Date.now()
    };
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElementStub.element, _events_js__WEBPACK_IMPORTED_MODULE_1__["default"].PRE_RENDER, eventDetails);
    Object(_internal_drawImageSync_js__WEBPACK_IMPORTED_MODULE_2__["default"])(enabledElementStub, enabledElementStub.invalid);
  });

  /***/ }),

  /***/ "./rendering/renderWebImage.js":
  /*!*************************************!*\
    !*** ./rendering/renderWebImage.js ***!
    \*************************************/
  /*! exports provided: renderWebImage */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "renderWebImage", function() { return renderWebImage; });
  /* harmony import */ var _setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../setToPixelCoordinateSystem.js */ "./setToPixelCoordinateSystem.js");
  /* harmony import */ var _renderColorImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./renderColorImage.js */ "./rendering/renderColorImage.js");


  /**
   * API function to draw a standard web image (PNG, JPG) to an enabledImage
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element to redraw
   * @param {Boolean} invalidated - true if pixel data has been invalidated and cached rendering should not be used
   * @returns {void}
   * @memberof rendering
   */

  function renderWebImage(enabledElement, invalidated) {
    if (enabledElement === undefined) {
      throw new Error('renderWebImage: enabledElement parameter must not be undefined');
    }

    var image = enabledElement.image;

    if (image === undefined) {
      throw new Error('renderWebImage: image must be loaded before it can be drawn');
    } // If the viewport ww/wc and invert all match the initial state of the image, we can draw the image
    // Directly. If any of those are changed, we call renderColorImage() to apply the lut


    if (enabledElement.viewport.voi.windowWidth === enabledElement.image.windowWidth && enabledElement.viewport.voi.windowCenter === enabledElement.image.windowCenter && enabledElement.viewport.invert === false) {
      // Get the canvas context and reset the transform
      var context = enabledElement.canvas.getContext('2d');
      context.setTransform(1, 0, 0, 1, 0, 0); // Clear the canvas

      context.fillStyle = 'black';
      context.fillRect(0, 0, enabledElement.canvas.width, enabledElement.canvas.height); // Turn off image smooth/interpolation if pixelReplication is set in the viewport

      context.imageSmoothingEnabled = !enabledElement.viewport.pixelReplication;
      context.mozImageSmoothingEnabled = context.imageSmoothingEnabled; // Save the canvas context state and apply the viewport properties

      Object(_setToPixelCoordinateSystem_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElement, context);
      var sx = enabledElement.viewport.displayedArea.tlhc.x - 1;
      var sy = enabledElement.viewport.displayedArea.tlhc.y - 1;
      var width = enabledElement.viewport.displayedArea.brhc.x - sx;
      var height = enabledElement.viewport.displayedArea.brhc.y - sy;
      context.drawImage(image.getImage(), sx, sy, width, height, 0, 0, width, height);
    } else {
      Object(_renderColorImage_js__WEBPACK_IMPORTED_MODULE_1__["renderColorImage"])(enabledElement, invalidated);
    }
  }

  /***/ }),

  /***/ "./rendering/saveLastRendered.js":
  /*!***************************************!*\
    !*** ./rendering/saveLastRendered.js ***!
    \***************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Saves the parameters of the last render into renderingTools, used later to decide if data can be reused.
   *
   * @param {Object} enabledElement Cornerstone EnabledElement
   * @returns {Object} enabledElement.renderingTools
   * @memberof rendering
   */
  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement) {
    var imageId = enabledElement.image.imageId;
    var viewport = enabledElement.viewport;
    var isColor = enabledElement.image.color;
    enabledElement.renderingTools.lastRenderedImageId = imageId;
    enabledElement.renderingTools.lastRenderedIsColor = isColor;
    enabledElement.renderingTools.lastRenderedViewport = {
      windowCenter: viewport.voi.windowCenter,
      windowWidth: viewport.voi.windowWidth,
      invert: viewport.invert,
      rotation: viewport.rotation,
      hflip: viewport.hflip,
      vflip: viewport.vflip,
      modalityLUT: viewport.modalityLUT,
      voiLUT: viewport.voiLUT,
      colormap: viewport.colormap
    };
    return enabledElement.renderingTools;
  });

  /***/ }),

  /***/ "./reset.js":
  /*!******************!*\
    !*** ./reset.js ***!
    \******************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");



  /**
   * Resets the viewport to the default settings
   *
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @returns {void}
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    enabledElement.viewport = Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement.canvas, enabledElement.image);
    Object(_updateImage_js__WEBPACK_IMPORTED_MODULE_2__["default"])(element);
  });

  /***/ }),

  /***/ "./resize.js":
  /*!*******************!*\
    !*** ./resize.js ***!
    \*******************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _fitToWindow_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fitToWindow.js */ "./fitToWindow.js");
  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./triggerEvent.js */ "./triggerEvent.js");
  /* harmony import */ var _internal_getImageSize_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./internal/getImageSize.js */ "./internal/getImageSize.js");
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./events.js */ "./events.js");






  /**
   * This module is responsible for enabling an element to display images with cornerstone
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {HTMLElement} canvas The Canvas DOM element within the DOM element enabled for Cornerstone
   * @returns {void}
   */

  function setCanvasSize(element, canvas) {
    // The device pixel ratio is 1.0 for normal displays and > 1.0
    // For high DPI displays like Retina

    /*
        This functionality is disabled due to buggy behavior on systems with mixed DPI's.  If the canvas
      is created on a display with high DPI (e.g. 2.0) and then the browser window is dragged to
      a different display with a different DPI (e.g. 1.0), the canvas is not recreated so the pageToPixel
      produces incorrect results.  I couldn't find any way to determine when the DPI changed other than
      by polling which is not very clean.  If anyone has any ideas here, please let me know, but for now
      we will disable this functionality.  We may want
      to add a mechanism to optionally enable this functionality if we can determine it is safe to do
      so (e.g. iPad or iPhone or perhaps enumerate the displays on the system.  I am choosing
      to be cautious here since I would rather not have bug reports or safety issues related to this
      scenario.
        var devicePixelRatio = window.devicePixelRatio;
      if(devicePixelRatio === undefined) {
          devicePixelRatio = 1.0;
      }
      */
    // Avoid setting the same value because it flashes the canvas with IE and Edge
    if (canvas.width !== element.clientWidth) {
      canvas.width = element.clientWidth;
      canvas.style.width = "".concat(element.clientWidth, "px");
    } // Avoid setting the same value because it flashes the canvas with IE and Edge


    if (canvas.height !== element.clientHeight) {
      canvas.height = element.clientHeight;
      canvas.style.height = "".concat(element.clientHeight, "px");
    }
  }
  /**
   * Checks if the image of a given enabled element fitted the window
   * before the resize
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element
   * @param {number} oldCanvasWidth The width of the canvas before the resize
   * @param {number} oldCanvasHeight The height of the canvas before the resize
   * @return {Boolean} true if it fitted the windows, false otherwise
   */


  function wasFitToWindow(enabledElement, oldCanvasWidth, oldCanvasHeight) {
    var scale = enabledElement.viewport.scale;
    var imageSize = Object(_internal_getImageSize_js__WEBPACK_IMPORTED_MODULE_4__["default"])(enabledElement.image, enabledElement.viewport.rotation);
    var imageWidth = Math.round(imageSize.width * scale);
    var imageHeight = Math.round(imageSize.height * scale);
    var x = enabledElement.viewport.translation.x;
    var y = enabledElement.viewport.translation.y;
    return imageWidth === oldCanvasWidth && imageHeight <= oldCanvasHeight || imageWidth <= oldCanvasWidth && imageHeight === oldCanvasHeight && x === 0 && y === 0;
  }
  /**
   * Rescale the image relative to the changed size of the canvas
   *
   * @param {EnabledElement} enabledElement The Cornerstone Enabled Element
   * @param {number} oldCanvasWidth The width of the canvas before the resize
   * @param {number} oldCanvasHeight The height of the canvas before the resize
   * @return {void}
   */


  function relativeRescale(enabledElement, oldCanvasWidth, oldCanvasHeight) {
    var scale = enabledElement.viewport.scale;
    var canvasWidth = enabledElement.canvas.width;
    var canvasHeight = enabledElement.canvas.height;
    var relWidthChange = canvasWidth / oldCanvasWidth;
    var relHeightChange = canvasHeight / oldCanvasHeight;
    var relChange = Math.sqrt(relWidthChange * relHeightChange);
    enabledElement.viewport.scale = relChange * scale;
  }
  /**
   * Resizes an enabled element and optionally fits the image to window
   *
   * @param {HTMLElement} element The DOM element enabled for Cornerstone
   * @param {Boolean} forceFitToWindow true to to force a refit, false to rescale accordingly
   * @returns {void}
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (element, forceFitToWindow) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);
    var oldCanvasWidth = enabledElement.canvas.width;
    var oldCanvasHeight = enabledElement.canvas.height;
    setCanvasSize(element, enabledElement.canvas);
    var eventData = {
      element: element
    };
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_3__["default"])(element, _events_js__WEBPACK_IMPORTED_MODULE_5__["default"].ELEMENT_RESIZED, eventData);

    if (enabledElement.image === undefined) {
      return;
    }

    if (forceFitToWindow || wasFitToWindow(enabledElement, oldCanvasWidth, oldCanvasHeight)) {
      // Fit the image to the window again if it fitted before the resize
      Object(_fitToWindow_js__WEBPACK_IMPORTED_MODULE_1__["default"])(element);
    } else {
      // Adapt the scale of a zoomed or panned image relative to the size change
      relativeRescale(enabledElement, oldCanvasWidth, oldCanvasHeight);
      Object(_updateImage_js__WEBPACK_IMPORTED_MODULE_2__["default"])(element);
    }
  });

  /***/ }),

  /***/ "./setToPixelCoordinateSystem.js":
  /*!***************************************!*\
    !*** ./setToPixelCoordinateSystem.js ***!
    \***************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _internal_calculateTransform_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./internal/calculateTransform.js */ "./internal/calculateTransform.js");

  /**
   * Sets the canvas context transformation matrix to the pixel coordinate system.  This allows
   * geometry to be driven using the canvas context using coordinates in the pixel coordinate system
   * @param {EnabledElement} enabledElement The
   * @param {CanvasRenderingContext2D} context The CanvasRenderingContext2D for the enabledElement's Canvas
   * @param {Number} [scale] Optional scale to apply
   * @returns {void}
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (enabledElement, context, scale) {
    if (enabledElement === undefined) {
      throw new Error('setToPixelCoordinateSystem: parameter enabledElement must not be undefined');
    }

    if (context === undefined) {
      throw new Error('setToPixelCoordinateSystem: parameter context must not be undefined');
    }

    var transform = Object(_internal_calculateTransform_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElement, scale);
    context.setTransform(transform.m[0], transform.m[1], transform.m[2], transform.m[3], transform.m[4], transform.m[5]);
  });

  /***/ }),

  /***/ "./setViewport.js":
  /*!************************!*\
    !*** ./setViewport.js ***!
    \************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./internal/getDefaultViewport.js */ "./internal/getDefaultViewport.js");
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _updateImage_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./updateImage.js */ "./updateImage.js");



  var MIN_WINDOW_WIDTH = 0.000001;
  var MIN_VIEWPORT_SCALE = 0.0001;
  /**
   * Sets/updates viewport of a given enabled element
   *
   * @param {HTMLElement} element - DOM element of the enabled element
   * @param {Viewport} [viewport] - Object containing the viewport properties
   * @returns {void}
   * @memberof ViewportSettings
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element, viewport) {
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_1__["getEnabledElement"])(element); // If viewport is not already set, start with default and merge new
    // viewport options later

    if (enabledElement.viewport === undefined) {
      enabledElement.viewport = Object(_internal_getDefaultViewport_js__WEBPACK_IMPORTED_MODULE_0__["default"])(enabledElement.canvas);
    } // Merge viewport


    if (viewport) {
      for (var attrname in viewport) {
        if (viewport[attrname] !== null) {
          enabledElement.viewport[attrname] = viewport[attrname];
        }
      }
    } // Prevent window width from being too small (note that values close to zero are valid and can occur with
    // PET images in particular)


    if (enabledElement.viewport.voi.windowWidth) {
      enabledElement.viewport.voi.windowWidth = Math.max(viewport.voi.windowWidth, MIN_WINDOW_WIDTH);
    } // Prevent scale from getting too small


    if (enabledElement.viewport.scale) {
      enabledElement.viewport.scale = Math.max(viewport.scale, MIN_VIEWPORT_SCALE);
    } // Normalize the rotation value to a positive rotation in degrees


    enabledElement.viewport.rotation %= 360;

    if (enabledElement.viewport.rotation < 0) {
      enabledElement.viewport.rotation += 360;
    }

    if (enabledElement.image) {
      // Force the image to be updated since the viewport has been modified
      Object(_updateImage_js__WEBPACK_IMPORTED_MODULE_2__["default"])(element);
    }
  });

  /***/ }),

  /***/ "./triggerEvent.js":
  /*!*************************!*\
    !*** ./triggerEvent.js ***!
    \*************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return triggerEvent; });
  /**
   * Trigger a CustomEvent
   *
   * @param {EventTarget} el The element or EventTarget to trigger the event upon
   * @param {String} type The event type name
   * @param {Object|null} detail=null The event data to be sent
   * @returns {Boolean} The return value is false if at least one event listener called preventDefault(). Otherwise it returns true.
   */
  function triggerEvent(el, type) {
    var detail = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var event; // This check is needed to polyfill CustomEvent on IE11-

    if (typeof window.CustomEvent === 'function') {
      event = new CustomEvent(type, {
        detail: detail,
        cancelable: true
      });
    } else {
      event = document.createEvent('CustomEvent');
      event.initCustomEvent(type, true, true, detail);
    }

    return el.dispatchEvent(event);
  }

  /***/ }),

  /***/ "./updateImage.js":
  /*!************************!*\
    !*** ./updateImage.js ***!
    \************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _enabledElements_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./enabledElements.js */ "./enabledElements.js");
  /* harmony import */ var _internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./internal/drawImage.js */ "./internal/drawImage.js");


  /**
   * Forces the image to be updated/redrawn for the specified enabled element
   * @param {HTMLElement} element An HTML Element enabled for Cornerstone
   * @param {Boolean} [invalidated=false] Whether or not the image pixel data has been changed, necessitating a redraw
   *
   * @returns {void}
   * @memberof Drawing
   */

  /* harmony default export */ __webpack_exports__["default"] = (function (element) {
    var invalidated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
    var enabledElement = Object(_enabledElements_js__WEBPACK_IMPORTED_MODULE_0__["getEnabledElement"])(element);

    if (enabledElement.image === undefined && !enabledElement.layers.length) {
      throw new Error('updateImage: image has not been loaded yet');
    }

    Object(_internal_drawImage_js__WEBPACK_IMPORTED_MODULE_1__["default"])(enabledElement, invalidated);
  });

  /***/ }),

  /***/ "./webgl/createProgramFromString.js":
  /*!******************************************!*\
    !*** ./webgl/createProgramFromString.js ***!
    \******************************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /**
   * Creates and compiles a shader.
   *
   * @param {!WebGLRenderingContext} gl The WebGL Context.
   * @param {string} shaderSource The GLSL source code for the shader.
   * @param {number} shaderType The type of shader, VERTEX_SHADER or FRAGMENT_SHADER.
   *
   * @return {!WebGLShader} The shader.
   * @memberof WebGLRendering
   */
  function compileShader(gl, shaderSource, shaderType) {
    // Create the shader object
    var shader = gl.createShader(shaderType); // Set the shader source code.

    gl.shaderSource(shader, shaderSource); // Compile the shader

    gl.compileShader(shader); // Check if it compiled

    var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);

    if (!success && !gl.isContextLost()) {
      // Something went wrong during compilation; get the error
      var infoLog = gl.getShaderInfoLog(shader);
      console.error("Could not compile shader:\n".concat(infoLog));
    }

    return shader;
  }
  /**
   * Creates a program from 2 shaders.
   *
   * @param {!WebGLRenderingContext} gl The WebGL context.
   * @param {!WebGLShader} vertexShader A vertex shader.
   * @param {!WebGLShader} fragmentShader A fragment shader.
   * @return {!WebGLProgram} A program.
   * @memberof WebGLRendering
   */


  function createProgram(gl, vertexShader, fragmentShader) {
    // Create a program.
    var program = gl.createProgram(); // Attach the shaders.

    gl.attachShader(program, vertexShader);
    gl.attachShader(program, fragmentShader); // Link the program.

    gl.linkProgram(program); // Check if it linked.

    var success = gl.getProgramParameter(program, gl.LINK_STATUS);

    if (!success && !gl.isContextLost()) {
      // Something went wrong with the link
      var infoLog = gl.getProgramInfoLog(program);
      console.error("WebGL program filed to link:\n".concat(infoLog));
    }

    return program;
  }
  /**
   * Creates a program from 2 shaders source (Strings)
   * @param  {!WebGLRenderingContext} gl              The WebGL context.
   * @param  {!WebGLShader} vertexShaderSrc   Vertex shader string
   * @param  {!WebGLShader} fragShaderSrc Fragment shader string
   * @return {!WebGLProgram}                 A program
   * @memberof WebGLRendering
   */


  /* harmony default export */ __webpack_exports__["default"] = (function (gl, vertexShaderSrc, fragShaderSrc) {
    var vertexShader = compileShader(gl, vertexShaderSrc, gl.VERTEX_SHADER);
    var fragShader = compileShader(gl, fragShaderSrc, gl.FRAGMENT_SHADER);
    return createProgram(gl, vertexShader, fragShader);
  });

  /***/ }),

  /***/ "./webgl/index.js":
  /*!************************!*\
    !*** ./webgl/index.js ***!
    \************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _renderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./renderer.js */ "./webgl/renderer.js");
  /* harmony import */ var _createProgramFromString_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./createProgramFromString.js */ "./webgl/createProgramFromString.js");
  /* harmony import */ var _textureCache_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./textureCache.js */ "./webgl/textureCache.js");



  /**
   * @module WebGLRendering
   */

  var mod = {
    createProgramFromString: _createProgramFromString_js__WEBPACK_IMPORTED_MODULE_1__["default"],
    renderer: {
      render: _renderer_js__WEBPACK_IMPORTED_MODULE_0__["render"],
      initRenderer: _renderer_js__WEBPACK_IMPORTED_MODULE_0__["initRenderer"],
      getRenderCanvas: _renderer_js__WEBPACK_IMPORTED_MODULE_0__["getRenderCanvas"],
      isWebGLAvailable: _renderer_js__WEBPACK_IMPORTED_MODULE_0__["isWebGLAvailable"]
    },
    textureCache: _textureCache_js__WEBPACK_IMPORTED_MODULE_2__["default"]
  };
  Object.defineProperty(mod, 'isWebGLInitialized', {
    enumerable: true,
    configurable: false,
    get: function get() {
      return _renderer_js__WEBPACK_IMPORTED_MODULE_0__["isWebGLInitialized"];
    }
  });
  /* harmony default export */ __webpack_exports__["default"] = (mod);

  /***/ }),

  /***/ "./webgl/renderer.js":
  /*!***************************!*\
    !*** ./webgl/renderer.js ***!
    \***************************/
  /*! exports provided: isWebGLInitialized, getRenderCanvas, initRenderer, render, isWebGLAvailable */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isWebGLInitialized", function() { return isWebGLInitialized; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getRenderCanvas", function() { return getRenderCanvas; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "initRenderer", function() { return initRenderer; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isWebGLAvailable", function() { return isWebGLAvailable; });
  /* harmony import */ var _shaders_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./shaders/index.js */ "./webgl/shaders/index.js");
  /* harmony import */ var _vertexShader_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vertexShader.js */ "./webgl/vertexShader.js");
  /* harmony import */ var _textureCache_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./textureCache.js */ "./webgl/textureCache.js");
  /* harmony import */ var _createProgramFromString_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./createProgramFromString.js */ "./webgl/createProgramFromString.js");
  /* eslint no-bitwise: 0 */




  var renderCanvas = document.createElement('canvas');
  var gl;
  var texCoordBuffer;
  var positionBuffer;
  var isWebGLInitialized = false;

  function getRenderCanvas() {
    return renderCanvas;
  }

  function initShaders() {
    for (var id in _shaders_index_js__WEBPACK_IMPORTED_MODULE_0__["shaders"]) {
      // Console.log("WEBGL: Loading shader", id);
      var shader = _shaders_index_js__WEBPACK_IMPORTED_MODULE_0__["shaders"][id];
      shader.attributes = {};
      shader.uniforms = {};
      shader.vert = _vertexShader_js__WEBPACK_IMPORTED_MODULE_1__["vertexShader"];
      shader.program = Object(_createProgramFromString_js__WEBPACK_IMPORTED_MODULE_3__["default"])(gl, shader.vert, shader.frag);
      shader.attributes.texCoordLocation = gl.getAttribLocation(shader.program, 'a_texCoord');
      gl.enableVertexAttribArray(shader.attributes.texCoordLocation);
      shader.attributes.positionLocation = gl.getAttribLocation(shader.program, 'a_position');
      gl.enableVertexAttribArray(shader.attributes.positionLocation);
      shader.uniforms.resolutionLocation = gl.getUniformLocation(shader.program, 'u_resolution');
    }
  }

  function initRenderer() {
    if (isWebGLInitialized === true) {
      // Console.log("WEBGL Renderer already initialized");
      return;
    }

    if (initWebGL(renderCanvas)) {
      initBuffers();
      initShaders(); // Console.log("WEBGL Renderer initialized!");

      isWebGLInitialized = true;
    }
  }

  function updateRectangle(gl, width, height) {
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([width, height, 0, height, width, 0, 0, 0]), gl.STATIC_DRAW);
  }

  function handleLostContext(event) {
    event.preventDefault();
    console.warn('WebGL Context Lost!');
  }

  function handleRestoredContext(event) {
    event.preventDefault();
    isWebGLInitialized = false;
    _textureCache_js__WEBPACK_IMPORTED_MODULE_2__["default"].purgeCache();
    initRenderer(); // Console.log('WebGL Context Restored.');
  }

  function initWebGL(canvas) {
    gl = null;

    try {
      // Try to grab the standard context. If it fails, fallback to experimental.
      var options = {
        preserveDrawingBuffer: true // Preserve buffer so we can copy to display canvas element

      }; // ---------------- Testing purposes -------------
      // If (debug === true && WebGLDebugUtils) {
      //    RenderCanvas = WebGLDebugUtils.makeLostContextSimulatingCanvas(renderCanvas);
      // }
      // ---------------- Testing purposes -------------

      gl = canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options); // Set up event listeners for context lost / context restored

      canvas.removeEventListener('webglcontextlost', handleLostContext, false);
      canvas.addEventListener('webglcontextlost', handleLostContext, false);
      canvas.removeEventListener('webglcontextrestored', handleRestoredContext, false);
      canvas.addEventListener('webglcontextrestored', handleRestoredContext, false);
    } catch (error) {
      throw new Error('Error creating WebGL context');
    } // If we don't have a GL context, give up now


    if (!gl) {
      console.error('Unable to initialize WebGL. Your browser may not support it.');
      gl = null;
    }

    return gl;
  }
  /**
   * Returns the image data type as a string representation.
   * @param {any} image The cornerstone image object
   * @returns {string} image data type (rgb, iint16, uint16, int8 and uint8)
   * @memberof WebGLRendering
   */


  function getImageDataType(image) {
    if (image.color) {
      return 'rgb';
    }

    var pixelData = image.getPixelData();

    if (pixelData instanceof Int16Array) {
      return 'int16';
    }

    if (pixelData instanceof Uint16Array) {
      return 'uint16';
    }

    if (pixelData instanceof Int8Array) {
      return 'int8';
    }

    return 'uint8';
  }

  function getShaderProgram(image) {
    var datatype = getImageDataType(image); // We need a mechanism for
    // Choosing the shader based on the image datatype
    // Console.log("Datatype: " + datatype);

    if (_shaders_index_js__WEBPACK_IMPORTED_MODULE_0__["shaders"].hasOwnProperty(datatype)) {
      return _shaders_index_js__WEBPACK_IMPORTED_MODULE_0__["shaders"][datatype];
    }

    return _shaders_index_js__WEBPACK_IMPORTED_MODULE_0__["shaders"].rgb;
  }

  function generateTexture(image) {
    var TEXTURE_FORMAT = {
      uint8: gl.LUMINANCE,
      int8: gl.LUMINANCE_ALPHA,
      uint16: gl.LUMINANCE_ALPHA,
      int16: gl.RGB,
      rgb: gl.RGB
    };
    var TEXTURE_BYTES = {
      int8: 1,
      // Luminance
      uint16: 2,
      // Luminance + Alpha
      int16: 3,
      // RGB
      rgb: 3 // RGB

    };
    var imageDataType = getImageDataType(image);
    var format = TEXTURE_FORMAT[imageDataType]; // GL texture configuration

    var texture = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, texture);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);
    var imageData = _shaders_index_js__WEBPACK_IMPORTED_MODULE_0__["dataUtilities"][imageDataType].storedPixelDataToImageData(image, image.width, image.height);
    gl.texImage2D(gl.TEXTURE_2D, 0, format, image.width, image.height, 0, format, gl.UNSIGNED_BYTE, imageData); // Calculate the size in bytes of this image in memory

    var sizeInBytes = image.width * image.height * TEXTURE_BYTES[imageDataType];
    return {
      texture: texture,
      sizeInBytes: sizeInBytes
    };
  }

  function getImageTexture(image) {
    var imageTexture = _textureCache_js__WEBPACK_IMPORTED_MODULE_2__["default"].getImageTexture(image.imageId);

    if (!imageTexture) {
      // Console.log("Generating texture for imageid: ", image.imageId);
      imageTexture = generateTexture(image);
      _textureCache_js__WEBPACK_IMPORTED_MODULE_2__["default"].putImageTexture(image, imageTexture);
    }

    return imageTexture.texture;
  }

  function initBuffers() {
    positionBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 1, 0, 1, 1, 0, 0, 0]), gl.STATIC_DRAW);
    texCoordBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0]), gl.STATIC_DRAW);
  }

  function renderQuad(shader, parameters, texture, width, height) {
    gl.clearColor(1.0, 0.0, 0.0, 1.0);
    gl.viewport(0, 0, width, height);
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    gl.useProgram(shader.program);
    gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);
    gl.vertexAttribPointer(shader.attributes.texCoordLocation, 2, gl.FLOAT, false, 0, 0);
    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
    gl.vertexAttribPointer(shader.attributes.positionLocation, 2, gl.FLOAT, false, 0, 0);

    for (var key in parameters) {
      var uniformLocation = gl.getUniformLocation(shader.program, key);

      if (!uniformLocation) {
        continue; // Disabling this error for now since RGB requires minPixelValue
        // but the other shaders do not.
        // throw `Could not access location for uniform: ${key}`;
      }

      var uniform = parameters[key];
      var type = uniform.type;
      var value = uniform.value;

      if (type === 'i') {
        gl.uniform1i(uniformLocation, value);
      } else if (type === 'f') {
        gl.uniform1f(uniformLocation, value);
      } else if (type === '2f') {
        gl.uniform2f(uniformLocation, value[0], value[1]);
      }
    }

    updateRectangle(gl, width, height);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, texture);
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
  }

  function render(enabledElement) {
    // Resize the canvas
    var image = enabledElement.image;
    renderCanvas.width = image.width;
    renderCanvas.height = image.height;
    var viewport = enabledElement.viewport; // Render the current image

    var shader = getShaderProgram(image);
    var texture = getImageTexture(image);
    var parameters = {
      u_resolution: {
        type: '2f',
        value: [image.width, image.height]
      },
      wc: {
        type: 'f',
        value: viewport.voi.windowCenter
      },
      ww: {
        type: 'f',
        value: viewport.voi.windowWidth
      },
      slope: {
        type: 'f',
        value: image.slope
      },
      intercept: {
        type: 'f',
        value: image.intercept
      },
      minPixelValue: {
        type: 'f',
        value: image.minPixelValue
      },
      invert: {
        type: 'i',
        value: viewport.invert ? 1 : 0
      }
    };
    renderQuad(shader, parameters, texture, image.width, image.height);
    return renderCanvas;
  }
  function isWebGLAvailable() {
    // Adapted from
    // http://stackoverflow.com/questions/9899807/three-js-detect-webgl-support-and-fallback-to-regular-canvas
    var options = {
      failIfMajorPerformanceCaveat: true
    };

    try {
      var canvas = document.createElement('canvas');
      return Boolean(window.WebGLRenderingContext) && (canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options));
    } catch (e) {
      return false;
    }
  }

  /***/ }),

  /***/ "./webgl/shaders/index.js":
  /*!********************************!*\
    !*** ./webgl/shaders/index.js ***!
    \********************************/
  /*! exports provided: shaders, dataUtilities */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "shaders", function() { return shaders; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "dataUtilities", function() { return dataUtilities; });
  /* harmony import */ var _int16_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./int16.js */ "./webgl/shaders/int16.js");
  /* harmony import */ var _int8_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./int8.js */ "./webgl/shaders/int8.js");
  /* harmony import */ var _rgb_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./rgb.js */ "./webgl/shaders/rgb.js");
  /* harmony import */ var _uint16_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./uint16.js */ "./webgl/shaders/uint16.js");
  /* harmony import */ var _uint8_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./uint8.js */ "./webgl/shaders/uint8.js");





  var shaders = {
    int16: _int16_js__WEBPACK_IMPORTED_MODULE_0__["int16Shader"],
    int8: _int8_js__WEBPACK_IMPORTED_MODULE_1__["int8Shader"],
    rgb: _rgb_js__WEBPACK_IMPORTED_MODULE_2__["rgbShader"],
    uint16: _uint16_js__WEBPACK_IMPORTED_MODULE_3__["uint16Shader"],
    uint8: _uint8_js__WEBPACK_IMPORTED_MODULE_4__["uint8Shader"]
  };
  var dataUtilities = {
    int16: _int16_js__WEBPACK_IMPORTED_MODULE_0__["int16DataUtilities"],
    int8: _int8_js__WEBPACK_IMPORTED_MODULE_1__["int8DataUtilities"],
    rgb: _rgb_js__WEBPACK_IMPORTED_MODULE_2__["rgbDataUtilities"],
    uint16: _uint16_js__WEBPACK_IMPORTED_MODULE_3__["uint16DataUtilities"],
    uint8: _uint8_js__WEBPACK_IMPORTED_MODULE_4__["uint8DataUtilities"]
  };


  /***/ }),

  /***/ "./webgl/shaders/int16.js":
  /*!********************************!*\
    !*** ./webgl/shaders/int16.js ***!
    \********************************/
  /*! exports provided: int16DataUtilities, int16Shader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "int16DataUtilities", function() { return int16DataUtilities; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "int16Shader", function() { return int16Shader; });
  /* eslint no-bitwise: 0 */
  var int16Shader = {};
  /**
   * Convert stored pixel data to image data.
   *
   * Pack int16 into three uint8 channels (r, g, b)
   *
   * @param {Image} image A Cornerstone Image Object
   * @returns {Uint8Array} The image data for use by the WebGL shader
   * @memberof WebGLRendering
   */

  function storedPixelDataToImageData(image) {
    // Transfer image data to alpha and luminance channels of WebGL texture
    // Credit to @jpambrun and @fernandojsg
    // Pack int16 into three uint8 channels (r, g, b)
    var pixelData = image.getPixelData();
    var numberOfChannels = 3;
    var data = new Uint8Array(image.width * image.height * numberOfChannels);
    var offset = 0;

    for (var i = 0; i < pixelData.length; i++) {
      var val = Math.abs(pixelData[i]);
      data[offset++] = val & 0xFF;
      data[offset++] = val >> 8;
      data[offset++] = pixelData[i] < 0 ? 0 : 1; // 0 For negative, 1 for positive
    }

    return data;
  }

  var int16DataUtilities = {
    storedPixelDataToImageData: storedPixelDataToImageData
  };
  int16Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' + // Get texture
  'vec4 color = texture2D(u_image, v_texCoord);' + // Calculate luminance from packed texture
  'float intensity = color.r*256.0 + color.g*65536.0;' + 'if (color.b == 0.0)' + 'intensity = -intensity;' + // Rescale based on slope and window settings
  'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' + // Clamp intensity
  'intensity = clamp(intensity, 0.0, 1.0);' + // RGBA output
  'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' + // Apply any inversion necessary
  'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';


  /***/ }),

  /***/ "./webgl/shaders/int8.js":
  /*!*******************************!*\
    !*** ./webgl/shaders/int8.js ***!
    \*******************************/
  /*! exports provided: int8DataUtilities, int8Shader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "int8DataUtilities", function() { return int8DataUtilities; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "int8Shader", function() { return int8Shader; });
  var int8Shader = {};
  /**
   * Convert stored pixel data to image data.
   *
   * Store data in Uint8Array
   *
   * @param {Image} image A Cornerstone Image Object
   * @returns {Uint8Array} The image data for use by the WebGL shader
   * @memberof WebGLRendering
   */

  function storedPixelDataToImageData(image) {
    // Transfer image data to alpha channel of WebGL texture
    // Store data in Uint8Array
    var pixelData = image.getPixelData();
    var numberOfChannels = 2;
    var data = new Uint8Array(image.width * image.height * numberOfChannels);
    var offset = 0;

    for (var i = 0; i < pixelData.length; i++) {
      data[offset++] = pixelData[i];
      data[offset++] = pixelData[i] < 0 ? 0 : 1; // 0 For negative, 1 for positive
    }

    return data;
  }

  var int8DataUtilities = {
    storedPixelDataToImageData: storedPixelDataToImageData
  };
  int8Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' + // Get texture
  'vec4 color = texture2D(u_image, v_texCoord);' + // Calculate luminance from packed texture
  'float intensity = color.r*256.;' + 'if (color.a == 0.0)' + 'intensity = -intensity;' + // Rescale based on slope and window settings
  'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' + // Clamp intensity
  'intensity = clamp(intensity, 0.0, 1.0);' + // RGBA output
  'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' + // Apply any inversion necessary
  'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';


  /***/ }),

  /***/ "./webgl/shaders/rgb.js":
  /*!******************************!*\
    !*** ./webgl/shaders/rgb.js ***!
    \******************************/
  /*! exports provided: rgbDataUtilities, rgbShader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "rgbDataUtilities", function() { return rgbDataUtilities; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "rgbShader", function() { return rgbShader; });
  var rgbShader = {};
  /**
   * Convert stored pixel data to image data.
   *
   * Pack RGB images into a 3-channel RGB texture
   *
   * @param {Image} image A Cornerstone Image Object
   * @returns {Uint8Array} The image data for use by the WebGL shader
   * @memberof WebGLRendering
   */

  function storedPixelDataToImageData(image) {
    var minPixelValue = image.minPixelValue;
    var canvasImageDataIndex = 0;
    var storedPixelDataIndex = 0; // Only 3 channels, since we use WebGL's RGB texture format

    var numStoredPixels = image.width * image.height * 4;
    var numOutputPixels = image.width * image.height * 3;
    var storedPixelData = image.getPixelData();
    var data = new Uint8Array(numOutputPixels); // NOTE: As of Nov 2014, most javascript engines have lower performance when indexing negative indexes.
    // We have a special code path for this case that improves performance.  Thanks to @jpambrun for this enhancement

    if (minPixelValue < 0) {
      while (storedPixelDataIndex < numStoredPixels) {
        data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + -minPixelValue; // Red

        data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + -minPixelValue; // Green

        data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++] + -minPixelValue; // Blue

        storedPixelDataIndex += 1; // The stored pixel data has 4 channels
      }
    } else {
      while (storedPixelDataIndex < numStoredPixels) {
        data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Red

        data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Green

        data[canvasImageDataIndex++] = storedPixelData[storedPixelDataIndex++]; // Blue

        storedPixelDataIndex += 1; // The stored pixel data has 4 channels
      }
    }

    return data;
  }

  var rgbDataUtilities = {
    storedPixelDataToImageData: storedPixelDataToImageData
  };
  rgbShader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform float minPixelValue;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' + // Get texture
  'vec3 color = texture2D(u_image, v_texCoord).xyz;' + // Rescale based on slope and intercept
  'color = color * 256.0 * slope + intercept;' + // Apply window settings
  'float center0 = wc - 0.5 - minPixelValue;' + 'float width0 = max(ww, 1.0);' + 'color = (color - center0) / width0 + 0.5;' + // RGBA output
  'gl_FragColor = vec4(color, 1);' + // Apply any inversion necessary
  'if (invert == 1)' + 'gl_FragColor.rgb = 1. - gl_FragColor.rgb;' + '}';


  /***/ }),

  /***/ "./webgl/shaders/uint16.js":
  /*!*********************************!*\
    !*** ./webgl/shaders/uint16.js ***!
    \*********************************/
  /*! exports provided: uint16DataUtilities, uint16Shader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "uint16DataUtilities", function() { return uint16DataUtilities; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "uint16Shader", function() { return uint16Shader; });
  /* eslint no-bitwise: 0 */
  var uint16Shader = {};
  /**
   * Convert stored pixel data to image data.
   *
   * For uint16 pack uint16 into two uint8 channels (r and a).
   *
   * @param {Image} image A Cornerstone Image Object
   * @returns {Uint8Array} The image data for use by the WebGL shader
   * @memberof WebGLRendering
   */

  function storedPixelDataToImageData(image) {
    // Transfer image data to alpha and luminance channels of WebGL texture
    // Credit to @jpambrun and @fernandojsg
    // Pack uint16 into two uint8 channels (r and a)
    var pixelData = image.getPixelData();
    var numberOfChannels = 2;
    var data = new Uint8Array(image.width * image.height * numberOfChannels);
    var offset = 0;

    for (var i = 0; i < pixelData.length; i++) {
      var val = pixelData[i];
      data[offset++] = val & 0xFF;
      data[offset++] = val >> 8;
    }

    return data;
  }

  var uint16DataUtilities = {
    storedPixelDataToImageData: storedPixelDataToImageData
  };
  uint16Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' + // Get texture
  'vec4 color = texture2D(u_image, v_texCoord);' + // Calculate luminance from packed texture
  'float intensity = color.r*256.0 + color.a*65536.0;' + // Rescale based on slope and window settings
  'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' + // Clamp intensity
  'intensity = clamp(intensity, 0.0, 1.0);' + // RGBA output
  'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' + // Apply any inversion necessary
  'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';


  /***/ }),

  /***/ "./webgl/shaders/uint8.js":
  /*!********************************!*\
    !*** ./webgl/shaders/uint8.js ***!
    \********************************/
  /*! exports provided: uint8DataUtilities, uint8Shader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "uint8DataUtilities", function() { return uint8DataUtilities; });
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "uint8Shader", function() { return uint8Shader; });
  var uint8Shader = {};
  /**
   * Convert stored pixel data to image data. Here we will store
   * all data in the alpha channel.
   *
   * @param {Image} image A Cornerstone Image Object
   * @returns {Uint8Array} The image data for use by the WebGL shader
   * @memberof WebGLRendering
   */

  function storedPixelDataToImageData(image) {
    // Transfer image data to alpha channel of WebGL texture
    return image.getPixelData();
  }

  var uint8DataUtilities = {
    storedPixelDataToImageData: storedPixelDataToImageData
  };
  uint8Shader.frag = 'precision mediump float;' + 'uniform sampler2D u_image;' + 'uniform float ww;' + 'uniform float wc;' + 'uniform float slope;' + 'uniform float intercept;' + 'uniform int invert;' + 'varying vec2 v_texCoord;' + 'void main() {' + // Get texture
  'vec4 color = texture2D(u_image, v_texCoord);' + // Calculate luminance from packed texture
  'float intensity = color.r*256.0;' + // Rescale based on slope and window settings
  'intensity = intensity * slope + intercept;' + 'float center0 = wc - 0.5;' + 'float width0 = max(ww, 1.0);' + 'intensity = (intensity - center0) / width0 + 0.5;' + // Clamp intensity
  'intensity = clamp(intensity, 0.0, 1.0);' + // RGBA output
  'gl_FragColor = vec4(intensity, intensity, intensity, 1.0);' + // Apply any inversion necessary
  'if (invert == 1)' + 'gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;' + '}';


  /***/ }),

  /***/ "./webgl/textureCache.js":
  /*!*******************************!*\
    !*** ./webgl/textureCache.js ***!
    \*******************************/
  /*! exports provided: default */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony import */ var _events_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../events.js */ "./events.js");
  /* harmony import */ var _triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../triggerEvent.js */ "./triggerEvent.js");


  /**
   * This module deals with caching image textures in VRAM for WebGL
   * @module WebGLTextureCache
   */

  var imageCache = {};
  var cachedImages = [];
  var maximumSizeInBytes = 1024 * 1024 * 256; // 256 MB

  var cacheSizeInBytes = 0;

  function getCacheInfo() {
    return {
      maximumSizeInBytes: maximumSizeInBytes,
      cacheSizeInBytes: cacheSizeInBytes,
      numberOfImagesCached: cachedImages.length
    };
  }

  function purgeCacheIfNecessary() {
    // If max cache size has not been exceeded, do nothing
    if (cacheSizeInBytes <= maximumSizeInBytes) {
      return;
    } // Cache size has been exceeded, create list of images sorted by timeStamp
    // So we can purge the least recently used image


    function compare(a, b) {
      if (a.timeStamp > b.timeStamp) {
        return -1;
      }

      if (a.timeStamp < b.timeStamp) {
        return 1;
      }

      return 0;
    }

    cachedImages.sort(compare); // Remove images as necessary

    while (cacheSizeInBytes > maximumSizeInBytes) {
      var lastCachedImage = cachedImages[cachedImages.length - 1];
      cacheSizeInBytes -= lastCachedImage.sizeInBytes;
      delete imageCache[lastCachedImage.imageId];
      cachedImages.pop();
      Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].WEBGL_TEXTURE_REMOVED, {
        imageId: lastCachedImage.imageId
      });
    }

    var cacheInfo = getCacheInfo();
    Object(_triggerEvent_js__WEBPACK_IMPORTED_MODULE_1__["default"])(_events_js__WEBPACK_IMPORTED_MODULE_0__["events"], _events_js__WEBPACK_IMPORTED_MODULE_0__["default"].WEBGL_TEXTURE_CACHE_FULL, cacheInfo);
  }

  function setMaximumSizeBytes(numBytes) {
    if (numBytes === undefined) {
      throw new Error('setMaximumSizeBytes: parameter numBytes must not be undefined');
    }

    if (numBytes.toFixed === undefined) {
      throw new Error('setMaximumSizeBytes: parameter numBytes must be a number');
    }

    maximumSizeInBytes = numBytes;
    purgeCacheIfNecessary();
  }

  function putImageTexture(image, imageTexture) {
    var imageId = image.imageId;

    if (image === undefined) {
      throw new Error('putImageTexture: image must not be undefined');
    }

    if (imageId === undefined) {
      throw new Error('putImageTexture: imageId must not be undefined');
    }

    if (imageTexture === undefined) {
      throw new Error('putImageTexture: imageTexture must not be undefined');
    }

    if (Object.prototype.hasOwnProperty.call(imageCache, imageId) === true) {
      throw new Error('putImageTexture: imageId already in cache');
    }

    var cachedImage = {
      imageId: imageId,
      imageTexture: imageTexture,
      timeStamp: new Date(),
      sizeInBytes: imageTexture.sizeInBytes
    };
    imageCache[imageId] = cachedImage;
    cachedImages.push(cachedImage);

    if (imageTexture.sizeInBytes === undefined) {
      throw new Error('putImageTexture: imageTexture.sizeInBytes must not be undefined');
    }

    if (imageTexture.sizeInBytes.toFixed === undefined) {
      throw new Error('putImageTexture: imageTexture.sizeInBytes is not a number');
    }

    cacheSizeInBytes += cachedImage.sizeInBytes;
    purgeCacheIfNecessary();
  }

  function getImageTexture(imageId) {
    if (imageId === undefined) {
      throw new Error('getImageTexture: imageId must not be undefined');
    }

    var cachedImage = imageCache[imageId];

    if (cachedImage === undefined) {
      return;
    } // Bump time stamp for cached image


    cachedImage.timeStamp = new Date();
    return cachedImage.imageTexture;
  }

  function removeImageTexture(imageId) {
    if (imageId === undefined) {
      throw new Error('removeImageTexture: imageId must not be undefined');
    }

    var cachedImage = imageCache[imageId];

    if (cachedImage === undefined) {
      throw new Error('removeImageTexture: imageId must not be undefined');
    }

    cachedImages.splice(cachedImages.indexOf(cachedImage), 1);
    cacheSizeInBytes -= cachedImage.sizeInBytes;
    delete imageCache[imageId];
    return cachedImage.imageTexture;
  }

  function purgeCache() {
    while (cachedImages.length > 0) {
      var removedCachedImage = cachedImages.pop();
      delete imageCache[removedCachedImage.imageId];
    }

    cacheSizeInBytes = 0;
  }

  /* harmony default export */ __webpack_exports__["default"] = ({
    purgeCache: purgeCache,
    getImageTexture: getImageTexture,
    putImageTexture: putImageTexture,
    removeImageTexture: removeImageTexture,
    setMaximumSizeBytes: setMaximumSizeBytes
  });

  /***/ }),

  /***/ "./webgl/vertexShader.js":
  /*!*******************************!*\
    !*** ./webgl/vertexShader.js ***!
    \*******************************/
  /*! exports provided: vertexShader */
  /***/ (function(module, __webpack_exports__, __webpack_require__) {
  __webpack_require__.r(__webpack_exports__);
  /* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "vertexShader", function() { return vertexShader; });
  var vertexShader = 'attribute vec2 a_position;' + 'attribute vec2 a_texCoord;' + 'uniform vec2 u_resolution;' + 'varying vec2 v_texCoord;' + 'void main() {' + 'vec2 zeroToOne = a_position / u_resolution;' + 'vec2 zeroToTwo = zeroToOne * 2.0;' + 'vec2 clipSpace = zeroToTwo - 1.0;' + 'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' + 'v_texCoord = a_texCoord;' + '}';

  /***/ })

  /******/ });
  });

  });

  var cornerstone$3 = unwrapExports(cornerstone$2);

  var cornerstoneWADOImageLoader_min = createCommonjsModule(function (module, exports) {
  /*! cornerstone-wado-image-loader - 2.2.2 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWADOImageLoader */
  !function(e,t){module.exports=t();}(commonjsGlobal,function(){return function(r){var a={};function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r});},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0});},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,r){t.a=function(e){for(var t,r=e[0],a=e[0],n=e.length,o=1;o<n;o++)t=e[o],r=Math.min(r,t),a=Math.max(a,t);return {min:r,max:a}};},function(e,t,r){var m;function a(){if("undefined"==typeof CharLS)throw new Error("No JPEG-LS decoder loaded");if(!(m||(m=CharLS())&&m._jpegls_decode))throw new Error("JPEG-LS failed to initialize")}r.d(t,"b",function(){return a}),t.a=function(e,t){a();var r=function(e,t){var r=m._malloc(e.length);m.writeArrayToMemory(e,r);var a=m._malloc(4),n=m._malloc(4),o=m._malloc(4),i=m._malloc(4),l=m._malloc(4),s=m._malloc(4),u=m._malloc(4),c=m._malloc(4),f=m._malloc(4),d={result:m.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[r,e.length,a,n,o,i,l,s,c,u,f]),width:m.getValue(o,"i32"),height:m.getValue(i,"i32"),bitsPerSample:m.getValue(l,"i32"),stride:m.getValue(s,"i32"),components:m.getValue(c,"i32"),allowedLossyError:m.getValue(u,"i32"),interleaveMode:m.getValue(f,"i32"),pixelData:void 0},p=m.getValue(a,"*");return d.bitsPerSample<=8?(d.pixelData=new Uint8Array(d.width*d.height*d.components),d.pixelData.set(new Uint8Array(m.HEAP8.buffer,p,d.pixelData.length))):t?(d.pixelData=new Int16Array(d.width*d.height*d.components),d.pixelData.set(new Int16Array(m.HEAP16.buffer,p,d.pixelData.length))):(d.pixelData=new Uint16Array(d.width*d.height*d.components),d.pixelData.set(new Uint16Array(m.HEAP16.buffer,p,d.pixelData.length))),m._free(r),m._free(p),m._free(a),m._free(n),m._free(o),m._free(i),m._free(l),m._free(s),m._free(c),m._free(f),d}(t,1===e.pixelRepresentation);if(0!==r.result&&6!==r.result)throw new Error("JPEG-LS decoder failed to decode frame (error code ".concat(r.result,")"));return e.columns=r.width,e.rows=r.height,e.pixelData=r.pixelData,e};},function(e,t,r){var h;function n(e,t){var r=function(e,t,r){var a=h._malloc(e.length);h.writeArrayToMemory(e,a);var n=h._malloc(4),o=h._malloc(4),i=h._malloc(4),l=h._malloc(4),s=h._malloc(4),u=(new Date).getTime();if(0!==h.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[a,e.length,n,o,i,l,s]))return console.log("[opj_decode] decoding failed!"),h._free(a),h._free(h.getValue(n,"*")),h._free(i),h._free(l),h._free(o),void h._free(s);var c=h.getValue(n,"*"),f={length:h.getValue(o,"i32"),sx:h.getValue(i,"i32"),sy:h.getValue(l,"i32"),nbChannels:h.getValue(s,"i32"),perf_timetodecode:void 0,pixelData:void 0},d=f.sx*f.sy*f.nbChannels,p=new Int32Array(h.HEAP32.buffer,c,d);if(1===t)if(Uint8Array.from)f.pixelData=Uint8Array.from(p);else{f.pixelData=new Uint8Array(d);for(var m=0;m<d;m++)f.pixelData[m]=p[m];}else if(r)if(Int16Array.from)f.pixelData=Int16Array.from(p);else{f.pixelData=new Int16Array(d);for(var g=0;g<d;g++)f.pixelData[g]=p[g];}else if(Uint16Array.from)f.pixelData=Uint16Array.from(p);else{f.pixelData=new Uint16Array(d);for(var v=0;v<d;v++)f.pixelData[v]=p[v];}var x=(new Date).getTime();return f.perf_timetodecode=x-u,h._free(a),h._free(n),h._free(c),h._free(o),h._free(i),h._free(l),h._free(s),f}(t,e.bitsAllocated<=8?1:2,1===e.pixelRepresentation);return e.columns=r.sx,e.rows=r.sy,e.pixelData=r.pixelData,1<r.nbChannels&&(e.photometricInterpretation="RGB"),e}function o(e){if(!e.usePDFJS&&"undefined"==typeof OpenJPEG)throw new Error("OpenJPEG decoder not loaded");if(!(h||(h=OpenJPEG())&&h._jp2_decode))throw new Error("OpenJPEG failed to initialize")}r.d(t,"b",function(){return o}),t.a=function(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return o(r),a.usePDFJS||r.usePDFJS?function(e,t){var r=new JpxImage;r.parse(t);var a=r.tiles.length;if(1!==a)throw new Error("JPEG2000 decoder returned a tileCount of ".concat(a,", when 1 is expected"));return e.columns=r.width,e.rows=r.height,e.pixelData=r.tiles[0].items,e}(e,t):n(e,t)};},function(e,t,r){t.a="2.2.2";},function(e,t,r){r.d(t,"a",function(){return a});var n=r(0);function a(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=Object(n.a)(e.pixelData),a=!(o(e.smallestPixelValue)&&o(e.largestPixelValue));!0!==t||a?(e.smallestPixelValue=r.min,e.largestPixelValue=r.max):(e.smallestPixelValue!==r.min&&console.warn("Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably."),e.largestPixelValue!==r.max&&console.warn("Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably."));}function o(e){return "number"==typeof e}},function(e,t,r){var c=function(e,t){var r=t.buffer,a=t.byteOffset,n=t.length;return 16===e.bitsAllocated?(a%2&&(r=r.slice(a),a=0),0===e.pixelRepresentation?e.pixelData=new Uint16Array(r,a,n/2):e.pixelData=new Int16Array(r,a,n/2)):8===e.bitsAllocated||1===e.bitsAllocated?e.pixelData=t:32===e.bitsAllocated&&(a%2&&(r=r.slice(a),a=0),e.pixelData=new Float32Array(r,a,n/4)),e};var f=function(e,t){if(16===e.bitsAllocated){var r=t.buffer,a=t.byteOffset,n=t.length;a%2&&(r=r.slice(a),a=0),0===e.pixelRepresentation?e.pixelData=new Uint16Array(r,a,n/2):e.pixelData=new Int16Array(r,a,n/2);for(var o=0;o<e.pixelData.length;o++)e.pixelData[o]=(255&(i=e.pixelData[o]))<<8|i>>8&255;}else 8===e.bitsAllocated&&(e.pixelData=t);var i;return e};var d=function(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){for(var r=t,a=e.rows*e.columns,n=new ArrayBuffer(a*e.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),i=new Int8Array(r.buffer,r.byteOffset),l=new Int8Array(n),s=0,u=o.getInt32(0,!0),c=0;c<u;++c){s=c*a;var f=o.getInt32(4*(c+1),!0),d=o.getInt32(4*(c+2),!0);0===d&&(d=r.length);for(var p=a*u;f<d;){var m=i[f++];if(0<=m&&m<=127)for(var g=0;g<m+1&&s<p;++g)l[s]=i[f++],s++;else if(m<=-1&&-127<=m)for(var v=i[f++],x=0;x<1-m&&s<p;++x)l[s]=v,s++;}}return e.pixelData=new Uint8Array(n),e}(e,t):function(e,t){for(var r=t,a=e.rows*e.columns,n=new ArrayBuffer(a*e.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),i=new Int8Array(r.buffer,r.byteOffset),l=new Int8Array(n),s=0,u=o.getInt32(0,!0),c=0;c<u;++c){s=c;var f=o.getInt32(4*(c+1),!0),d=o.getInt32(4*(c+2),!0);0===d&&(d=r.length);for(var p=a*u;f<d;){var m=i[f++];if(0<=m&&m<=127)for(var g=0;g<m+1&&s<p;++g)l[s]=i[f++],s+=e.samplesPerPixel;else if(m<=-1&&-127<=m)for(var v=i[f++],x=0;x<1-m&&s<p;++x)l[s]=v,s+=e.samplesPerPixel;}}return e.pixelData=new Uint8Array(n),e}(e,t);if(16===e.bitsAllocated)return function(e,t){for(var r=t,a=e.rows*e.columns,n=new ArrayBuffer(a*e.samplesPerPixel*2),o=new DataView(r.buffer,r.byteOffset),i=new Int8Array(r.buffer,r.byteOffset),l=new Int8Array(n),s=o.getInt32(0,!0),u=0;u<s;++u){var c=0,f=0===u?1:0,d=o.getInt32(4*(u+1),!0),p=o.getInt32(4*(u+2),!0);for(0===p&&(p=r.length);d<p;){var m=i[d++];if(0<=m&&m<=127)for(var g=0;g<m+1&&c<a;++g)l[2*c+f]=i[d++],c++;else if(m<=-1&&-127<=m)for(var v=i[d++],x=0;x<1-m&&c<a;++x)l[2*c+f]=v,c++;}}return 0===e.pixelRepresentation?e.pixelData=new Uint16Array(n):e.pixelData=new Int16Array(n),e}(e,t);throw new Error("unsupported pixel format for RLE")};var p=function(e,t){if("undefined"==typeof JpegImage)throw new Error("No JPEG Baseline decoder loaded");var r=new JpegImage;return r.parse(t),r.colorTransform=!1,8===e.bitsAllocated?(e.pixelData=r.getData(e.columns,e.rows),e):16===e.bitsAllocated?(e.pixelData=r.getData16(e.columns,e.rows),e):void 0};var m=function(e,t){if("undefined"==typeof jpeg||void 0===jpeg.lossless||void 0===jpeg.lossless.Decoder)throw new Error("No JPEG Lossless decoder loaded");var r=e.bitsAllocated<=8?1:2,a=t.buffer,n=(new jpeg.lossless.Decoder).decode(a,t.byteOffset,t.length,r);return 0===e.pixelRepresentation?16===e.bitsAllocated?e.pixelData=new Uint16Array(n.buffer):e.pixelData=new Uint8Array(n.buffer):e.pixelData=new Int16Array(n.buffer),e},g=r(1),v=r(2);t.a=function(e,t,r,a,n){var o=(new Date).getTime();if("1.2.840.10008.1.2"===t)e=c(e,r);else if("1.2.840.10008.1.2.1"===t)e=c(e,r);else if("1.2.840.10008.1.2.2"===t)e=f(e,r);else if("1.2.840.10008.1.2.1.99"===t)e=c(e,r);else if("1.2.840.10008.1.2.5"===t)e=d(e,r);else if("1.2.840.10008.1.2.4.50"===t)e=p(e,r);else if("1.2.840.10008.1.2.4.51"===t)e=p(e,r);else if("1.2.840.10008.1.2.4.57"===t)e=m(e,r);else if("1.2.840.10008.1.2.4.70"===t)e=m(e,r);else if("1.2.840.10008.1.2.4.80"===t)e=Object(g.a)(e,r);else if("1.2.840.10008.1.2.4.81"===t)e=Object(g.a)(e,r);else if("1.2.840.10008.1.2.4.90"===t)e=Object(v.a)(e,r,a,n);else{if("1.2.840.10008.1.2.4.91"!==t)throw new Error("no decoder for transfer syntax ".concat(t));e=Object(v.a)(e,r,a,n);}var i=void 0!==e.pixelRepresentation&&1===e.pixelRepresentation,l=i&&void 0!==e.bitsStored?32-e.bitsStored:void 0;if(i&&void 0!==l)for(var s=0;s<e.pixelData.length;s++)e.pixelData[s]=e.pixelData[s]<<l>>l;var u=(new Date).getTime();return e.decodeTimeInMS=u-o,e};},function(e,t,r){r.r(t);var a=function(e,t){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");for(var r=e.length/3,a=0,n=0,o=0;o<r;o++)t[n++]=e[a++],t[n++]=e[a++],t[n++]=e[a++],t[n++]=255;},n=function(e,t){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");for(var r=e.length/3,a=0,n=0,o=r,i=2*r,l=0;l<r;l++)t[a++]=e[n++],t[a++]=e[o++],t[a++]=e[i++],t[a++]=255;},o=function(e,t){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");for(var r=e.length/3,a=0,n=0,o=0;o<r;o++){var i=e[a++],l=e[a++],s=e[a++];t[n++]=i+1.402*(s-128),t[n++]=i-.34414*(l-128)-.71414*(s-128),t[n++]=i+1.772*(l-128),t[n++]=255;}},i=function(e,t){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");for(var r=e.length/3,a=0,n=0,o=r,i=2*r,l=0;l<r;l++){var s=e[n++],u=e[o++],c=e[i++];t[a++]=s+1.402*(c-128),t[a++]=s-.34414*(u-128)-.71414*(c-128),t[a++]=s+1.772*(u-128),t[a++]=255;}};function x(e,t){for(var r=e.length,a=new Uint8ClampedArray(r),n=0;n<r;++n)a[n]=e[n]>>t;return a}var l=function(e,t){for(var r=e.columns*e.rows,a=e.pixelData,n=e.redPaletteColorLookupTableData,o=e.greenPaletteColorLookupTableData,i=e.bluePaletteColorLookupTableData,l=e.redPaletteColorLookupTableData.length,s=0,u=0,c=e.redPaletteColorLookupTableDescriptor[1],f=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,d=x(n,f),p=x(o,f),m=x(i,f),g=0;g<r;++g){var v=a[s++];v<c?v=0:c+l-1<v?v=l-1:v-=c,t[u++]=d[v],t[u++]=p[v],t[u++]=m[v],t[u++]=255;}};function s(e,t){if(e.elements[t]&&6===e.elements[t].length)return [e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function u(e,t,r){for(var a=[],n=e.elements[t],o=0;o<r[0];o++)16===r[2]?a[o]=e.uint16(t,o):a[o]=e.byteArray[o+n.dataOffset];return a}var g=function(e){var t,r,a,n={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return r=n,a=(t=e).uint16("x00280103"),r.largestPixelValue=0===a?(r.smallestPixelValue=t.uint16("x00280106"),t.uint16("x00280107")):(r.smallestPixelValue=t.int16("x00280106"),t.int16("x00280107")),"PALETTE COLOR"===n.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=s(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=s(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=s(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);var r=t.redPaletteColorLookupTableDescriptor[0],a=e.elements.x00281201.length===r?8:16;t.redPaletteColorLookupTableDescriptor[2]!==a&&(t.redPaletteColorLookupTableDescriptor[2]=a,t.greenPaletteColorLookupTableDescriptor[2]=a,t.bluePaletteColorLookupTableDescriptor[2]=a),t.redPaletteColorLookupTableData=u(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=u(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=u(e,"x00281203",t.bluePaletteColorLookupTableDescriptor);}(e,n),n};function c(e,t){var r=t.uint16("x00283002",0);0===r&&(r=65535);for(var a={id:"1",firstValueMapped:0===e?t.uint16("x00283002",1):t.int16("x00283002",1),numBitsPerEntry:t.uint16("x00283002",2),lut:[]},n=0;n<r;n++)a.lut[n]=0===e?t.uint16("x00283006",n):t.int16("x00283006",n);return a}var v=function(e,t){if(t&&t.items.length){for(var r=[],a=0;a<t.items.length;a++){var n=c(e,t.items[a].dataSet);n&&r.push(n);}return r}};var h=function(e){var t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;var r,a,n,o=e.floatString("x00281052"),i=e.floatString("x00281053");return void 0===o||void 0===i?e.elements.x00283000&&0<e.elements.x00283000.length?0:e.uint16("x00280103"):(a=(r=e).uint16("x00280103"),n=r.uint16("x00280101"),(0===a?0:-1<<n-1)*i+o<0?1:0)};var w=function(e,t,r){var a=[],n=e.string(t);if(n){var o=n.split("\\");if(!(r&&o.length<r)){for(var i=0;i<o.length;i++)a.push(parseFloat(o[i]));return a}}};var d=function(e,t,r){return t=t||0,e&&e.Value?e.Value.length<=t?r:e.Value[t]:r};var f=function(e,t,r){var a=d(e,t,r);if(void 0!==a)return parseFloat(a)};var p=function(e,t){var r=d(e,t);if(void 0!==r)return parseFloat(r)};var m=function(e,t){if(e&&e.Value&&!(t&&e.Value.length<t)){for(var r=[],a=0;a<e.Value.length;a++)r.push(parseFloat(e.Value[a]));return r}},b=[];var y={add:function(e,t){b[e]=t;},get:function(e){return b[e]},remove:function(e){b[e]=void 0;},purge:function(){b=[];}};var P=function(e,t){var r=fe.dicomParser,a=y.get(t);if(a){if("generalSeriesModule"===e)return {modality:d(a["00080060"]),seriesInstanceUID:d(a["0020000e"]),seriesNumber:p(a["00200011"]),studyInstanceUID:d(a["0020000d"]),seriesDate:r.parseDA(d(a["00080021"])),seriesTime:r.parseTM(d(a["00080031"],0,""))};if("patientStudyModule"===e)return {patientAge:p(a["00101010"]),patientSize:p(a["00101020"]),patientWeight:p(a["00101030"])};if("imagePlaneModule"===e){var n=m(a["00200037"],6),o=m(a["00200032"],3),i=m(a["00280030"],2),l=null,s=null;i&&(s=i[0],l=i[1]);var u=null,c=null;return n&&(u=[parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])],c=[parseFloat(n[3]),parseFloat(n[4]),parseFloat(n[5])]),{frameOfReferenceUID:d(a["00200052"]),rows:p(a["00280010"]),columns:p(a["00280011"]),imageOrientationPatient:n,rowCosines:u,columnCosines:c,imagePositionPatient:o,sliceThickness:p(a["00180050"]),sliceLocation:p(a["00201041"]),pixelSpacing:i,rowPixelSpacing:s,columnPixelSpacing:l}}if("imagePixelModule"===e)return {samplesPerPixel:p(a["00280002"]),photometricInterpretation:d(a["00280004"]),rows:p(a["00280010"]),columns:p(a["00280011"]),bitsAllocated:p(a["00280100"]),bitsStored:p(a["00280101"]),highBit:d(a["00280102"]),pixelRepresentation:p(a["00280103"]),planarConfiguration:p(a["00280006"]),pixelAspectRatio:d(a["00280034"]),smallestPixelValue:p(a["00280106"]),largestPixelValue:p(a["00280107"]),redPaletteColorLookupTableDescriptor:m(a["00281101"]),greenPaletteColorLookupTableDescriptor:m(a["00281102"]),bluePaletteColorLookupTableDescriptor:m(a["00281103"]),redPaletteColorLookupTableData:m(a["00281201"]),greenPaletteColorLookupTableData:m(a["00281202"]),bluePaletteColorLookupTableData:m(a["00281203"])};if("voiLutModule"===e)return {windowCenter:m(a["00281050"],1),windowWidth:m(a["00281051"],1)};if("modalityLutModule"===e)return {rescaleIntercept:p(a["00281052"]),rescaleSlope:p(a["00281053"]),rescaleType:d(a["00281054"])};if("sopCommonModule"===e)return {sopClassUID:d(a["00080016"]),sopInstanceUID:d(a["00080018"])};if("petIsotopeModule"===e){var f=d(a["00540016"]);if(void 0===f)return;return {radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:r.parseTM(d(f["00181072"],0,"")),radionuclideTotalDose:p(f["00181074"]),radionuclideHalfLife:p(f["00181075"])}}}}};function D(e,t,r){if(r+e.length>t.length)return !1;for(var a=r,n=0;n<e.length;n++)if(e[n]!==t[a++])return !1;return !0}var I=function(e,t,r){r=r||0;for(var a=function(e){for(var t=new Uint8Array(e.length),r=0,a=e.length;r<a;r++)t[r]=e.charCodeAt(r);return t}(t),n=r;n<e.length;n++)if(a[0]===e[n]&&D(a,e,n))return n;return -1},T={beforeSend:function(){},imageCreated:function(){},strict:!1,useWebWorkers:!0,decodeConfig:{usePDFJS:!1}};function C(e){T=Object.assign(T,e);}function k(){return T}var A=function(o,i){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},s=fe.cornerstone,u=k();return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("get",o,!0),a.responseType="arraybuffer",u.beforeSend(a,i,n,l),Object.keys(n).forEach(function(e){a.setRequestHeader(e,n[e]);}),l.deferred={resolve:t,reject:r},l.url=o,l.imageId=i,a.onloadstart=function(e){u.onloadstart&&u.onloadstart(e,l);var t={url:o,imageId:i};s.triggerEvent(s.events,"cornerstoneimageloadstart",t);},a.onloadend=function(e){u.onloadend&&u.onloadend(e,l);var t={url:o,imageId:i};s.triggerEvent(s.events,"cornerstoneimageloadend",t);},a.onreadystatechange=function(e){u.onreadystatechange?u.onreadystatechange(e,l):4===a.readyState&&(200===a.status?t(a.response,a):r(a));},a.onprogress=function(e){var t,r,a=e.loaded;e.lengthComputable&&(t=e.total,r=Math.round(a/t*100)),u.onprogress&&u.onprogress(e,l);var n={url:o,imageId:i,loaded:a,total:t,percentComplete:r};s.triggerEvent(s.events,"cornerstoneimageloadprogress",n);},a.send();})},L={xhrRequest:A,setOptions:C,getOptions:k};var S=function(e,t){var r={accept:2<arguments.length&&void 0!==arguments[2]?arguments[2]:"application/octet-stream"};return new Promise(function(s,u){A(e,t,r).then(function(e){var t=new Uint8Array(e),r=I(t,"\r\n\r\n");-1===r&&u(new Error("invalid response - no multipart mime header"));var a=function(e,t,r){t=t||0,r=r||e.length-t;for(var a="",n=t;n<t+r;n++)a+=String.fromCharCode(e[n]);return a}(t,0,r).split("\r\n"),n=function(e){for(var t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}(a);n||u(new Error("invalid response - no boundary marker"));var o=r+4,i=I(t,n,o);-1===i&&u(new Error("invalid response - terminating boundary not found"));var l=i-o-2;s({contentType:function(e){for(var t=0;t<e.length;t++)if("Content-Type:"===e[t].substr(0,13))return e[t].substr(13).trim()}(a),imageFrame:{pixelData:new Uint8Array(e,o,l)}});});})};var E,O=function(e){var t=fe.cornerstone.metaData.get("imagePixelModule",e);return {samplesPerPixel:t.samplesPerPixel,photometricInterpretation:t.photometricInterpretation,planarConfiguration:t.planarConfiguration,rows:t.rows,columns:t.columns,bitsAllocated:t.bitsAllocated,bitsStored:t.bitsStored,pixelRepresentation:t.pixelRepresentation,smallestPixelValue:t.smallestPixelValue,largestPixelValue:t.largestPixelValue,redPaletteColorLookupTableDescriptor:t.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:t.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:t.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:t.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:t.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:t.bluePaletteColorLookupTableData,pixelData:void 0}},M=0,B=[],R=[],_=k(),W={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerPath:"../../dist/cornerstoneWADOImageLoaderWebWorker.js",webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"../dist/cornerstoneWADOImageLoaderCodecs.js",usePDFJS:!1,strict:_.strict}}},U={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function V(){if(B.length){for(var e=0;e<R.length;e++)if("ready"===R[e].status){R[e].status="busy";var t=B.shift();t.start=(new Date).getTime();var r=(new Date).getTime();return U.totalTimeDelayedInMS+=r-t.added,R[e].task=t,R[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void U.numTasksExecuting++}R.length<E.maxWebWorkers&&j();}}function F(e){if("initialize"===e.data.taskType)R[e.data.workerIndex].status="ready",V();else{var t=R[e.data.workerIndex].task.start;R[e.data.workerIndex].task.deferred.resolve(e.data.result),R[e.data.workerIndex].task=void 0,U.numTasksExecuting--,R[e.data.workerIndex].status="ready",U.numTasksCompleted++;var r=(new Date).getTime();U.totalTaskTimeInMS+=r-t,V();}}function j(){if(!(R.length>=E.maxWebWorkers)){var e=new Worker(E.webWorkerPath);R.push({worker:e,status:"initializing"}),e.addEventListener("message",F),e.postMessage({taskType:"initialize",workerIndex:R.length-1,config:E});}}function G(e){if(e=e||W,E)throw new Error("WebWorkerManager already initialized");if((E=e).maxWebWorkers=E.maxWebWorkers||navigator.hardwareConcurrency||1,!E.startWebWorkersOnDemand)for(var t=0;t<E.maxWebWorkers;t++)j();}var J={initialize:G,loadWebWorkerTask:function(e,t){E.webWorkerTaskPaths.push(e),t&&(E.taskConfiguration=Object.assign(E.taskConfiguration,t));for(var r=0;r<R.length;r++)R[r].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:R.length-1,sourcePath:e,config:E});},addTask:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length?arguments[3]:void 0;E||G();var n,o={},i=new Promise(function(e,t){o={resolve:e,reject:t};});for(n=0;n<B.length&&!(B[n].priority<r);n++);var l=M++;return B.splice(n,0,{taskId:l,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:o,priority:r,transferList:a}),V(),{taskId:l,promise:i}},getStatistics:function(){return U.maxWebWorkers=E.maxWebWorkers,U.numWebWorkers=R.length,U.numTasksQueued=B.length,U},setTaskPriority:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=0;r<B.length;r++)if(B[r].taskId===e){var a=B.splice(r,1)[0];for(a.priority=t,r=0;r<B.length&&!(B[r].priority<t);r++);return B.splice(r,0,a),!0}return !1},cancelTask:function(e,t){for(var r=0;r<B.length;r++)if(B[r].taskId===e)return B.splice(r,1).deferred.reject(t),!0;return !1}},z=r(0);function q(e){return function(t){var r;try{return decodeURIComponent(escape(t))}catch(e){if((r=e)instanceof URIError)return t;throw r}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}var Y=function(i,e,l){var s=(new Date).getTime(),r=new Blob([e],{type:"image/jpeg"});return new Promise(function(o,t){var e=new FileReader;void 0===e.readAsBinaryString?e.readAsArrayBuffer(r):e.readAsBinaryString(r),e.onload=function(){var n=new Image;n.onload=function(){l.height=n.height,l.width=n.width,i.rows=n.height,i.columns=n.width;var e=l.getContext("2d");e.drawImage(this,0,0);var t=e.getImageData(0,0,n.width,n.height),r=(new Date).getTime();i.pixelData=t.data,i.imageData=t,i.decodeTimeInMS=r-s;var a=Object(z.a)(i.pixelData);i.smallestPixelValue=a.min,i.largestPixelValue=a.max,o(i);},n.onerror=function(e){t(e);},void 0===e.readAsBinaryString?n.src="data:image/jpeg;base64,".concat(window.btoa(q(e.result))):n.src="data:image/jpeg;base64,".concat(window.btoa(e.result));},e.onerror=function(e){t(e);};})},N=r(5),H=r(4),K=r(2),Q=r(1),X=!1;function Z(n,o,i,l){var e=l.priority||void 0,t=l.transferPixelData?[i.buffer]:void 0,r=k(),s=r.strict,u=r.decodeConfig;return !1===r.useWebWorkers?(!1===X&&(Object(K.b)(u),Object(Q.b)(u),X=!0),new Promise(function(e,t){try{var r=[n,o,i,u,l],a=N.a.apply(void 0,r);Object(H.a)(a,s),e(a);}catch(e){t(e);}})):J.addTask("decodeTask",{imageFrame:n,transferSyntax:o,pixelData:i,options:l},e,t).promise}var $=function(e,r,t,a){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return "1.2.840.10008.1.2"===r?Z(e,r,t,n):"1.2.840.10008.1.2.1"===r?Z(e,r,t,n):"1.2.840.10008.1.2.2"===r?Z(e,r,t,n):"1.2.840.10008.1.2.1.99"===r?Z(e,r,t,n):"1.2.840.10008.1.2.5"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.50"===r?8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?Z(e,r,t,n):Y(e,t,a):"1.2.840.10008.1.2.4.51"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.57"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.70"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.80"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.81"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.90"===r?Z(e,r,t,n):"1.2.840.10008.1.2.4.91"===r?Z(e,r,t,n):new Promise(function(e,t){t(new Error("No decoder for transfer syntax ".concat(r)));})},ee=function(e){return "RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e};function te(e,t){0===e.planarConfiguration?a(e.pixelData,t):n(e.pixelData,t);}function re(e,t){var r,a,n=t.data;if("RGB"===e.photometricInterpretation)te(e,n);else if("YBR_RCT"===e.photometricInterpretation)te(e,n);else if("YBR_ICT"===e.photometricInterpretation)te(e,n);else if("PALETTE COLOR"===e.photometricInterpretation)l(e,n);else if("YBR_FULL_422"===e.photometricInterpretation)te(e,n);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error("No color space conversion for photometric interpretation ".concat(e.photometricInterpretation));a=n,0===(r=e).planarConfiguration?o(r.pixelData,a):i(r.pixelData,a);}}var ae=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return !0},ne="";var oe=function(v,e,x,t){if(!e||!e.length)return Promise.reject(new Error("The file does not contain image data."));var h=fe.cornerstone,w=document.createElement("canvas"),r=O(v),a=$(r,x,e,w,t);return new Promise(function(g,e){a.then(function(e){var t,r=h.metaData.get("imagePlaneModule",v)||{},a=h.metaData.get("voiLutModule",v)||{},n=h.metaData.get("modalityLutModule",v)||{},o=h.metaData.get("sopCommonModule",v)||{},i=ee(e.photometricInterpretation);if(!ae(e,x)&&(32===(t=e).bitsAllocated?t.pixelData=new Float32Array(t.pixelData):16===t.bitsAllocated?0===t.pixelRepresentation?t.pixelData=new Uint16Array(t.pixelData):t.pixelData=new Int16Array(t.pixelData):t.pixelData=new Uint8Array(t.pixelData),i)){w.height=e.rows,w.width=e.columns;var l=w.getContext("2d").createImageData(e.columns,e.rows);re(e,l),e.imageData=l,e.pixelData=l.data;var s=Object(z.a)(e.pixelData);e.smallestPixelValue=s.min,e.largestPixelValue=s.max;}var u,c={imageId:v,color:i,columnPixelSpacing:r.columnPixelSpacing,columns:e.columns,height:e.rows,intercept:n.rescaleIntercept?n.rescaleIntercept:0,invert:"MONOCHROME1"===e.photometricInterpretation,minPixelValue:e.smallestPixelValue,maxPixelValue:e.largestPixelValue,rowPixelSpacing:r.rowPixelSpacing,rows:e.rows,sizeInBytes:e.pixelData.length,slope:n.rescaleSlope?n.rescaleSlope:1,width:e.columns,windowCenter:a.windowCenter?a.windowCenter[0]:void 0,windowWidth:a.windowWidth?a.windowWidth[0]:void 0,decodeTimeInMS:e.decodeTimeInMS,floatPixelData:void 0};if(e.pixelData instanceof Float32Array){var f=e.pixelData,d=function(e){for(var t=Object(z.a)(e),r=Math.abs(t.max-t.min)/65535,a=t.min,n=e.length,o=new Uint16Array(n),i=65535,l=0,s=0;s<n;s++){var u=Math.floor((e[s]-a)/r);o[s]=u,i=Math.min(i,u),l=Math.max(l,u);}return {min:i,max:l,intPixelData:o,slope:r,intercept:a}}(f);c.minPixelValue=d.min,c.maxPixelValue=d.max,c.slope=d.slope,c.intercept=d.intercept,c.floatPixelData=f,c.getPixelData=function(){return d.intPixelData};}else c.getPixelData=function(){return e.pixelData};if(c.color&&(c.getCanvas=function(){return ne===v||(w.height=c.rows,w.width=c.columns,w.getContext("2d").putImageData(e.imageData,0,0),ne=v),w}),n.modalityLUTSequence&&0<n.modalityLUTSequence.length&&"1.2.840.10008.5.1.4.1.1.12.1"!==(u=o.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==u&&(c.modalityLUT=n.modalityLUTSequence[0]),a.voiLUTSequence&&0<a.voiLUTSequence.length&&(c.voiLUT=a.voiLUTSequence[0]),c.color&&(c.windowWidth=255,c.windowCenter=127),void 0===c.windowCenter||void 0===c.windowWidth){var p=c.maxPixelValue*c.slope+c.intercept,m=c.minPixelValue*c.slope+c.intercept;c.windowWidth=p-m,c.windowCenter=(p+m)/2;}g(c);},e);})};var ie=function(o,i){var l=(new Date).getTime(),t=o.substring(7);return {promise:new Promise(function(a,n){if(void 0===y.get(o)){var e=new Error("no metadata for imageId ".concat(o));return n(e)}S(t,o,'multipart/related; type="application/octet-stream"').then(function(e){var t=function(e){var t="1.2.840.10008.1.2";if(!e)return t;var r=e.split(";"),a={};r.forEach(function(e){var t=e.split("=");if(2===t.length){var r=t[1].trim().replace(/"/g,"");a[t[0].trim()]=r;}});var n={"image/jpeg":"1.2.840.10008.1.2.4.70","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92"};return a["transfer-syntax"]?a["transfer-syntax"]:e&&!Object.keys(a).length&&n[e]?n[e]:a.type&&n[a.type]?n[a.type]:t}(e.contentType),r=e.imageFrame.pixelData;oe(o,r,t,i).then(function(e){var t=(new Date).getTime();e.loadTimeInMS=t-l,a(e);},n);},n);}),cancelFn:void 0}},le={metaData:{getNumberString:f,getNumberValue:p,getNumberValues:m,getValue:d,metaDataProvider:P},findIndexOfString:I,getPixelData:S,loadImage:ie,metaDataManager:y,register:function(e){e.registerImageLoader("wadors",ie),e.metaData.addProvider(P);}};var se,ue,ce=function(e){le.register(e),Le.register(e);},fe={set cornerstone(e){ce(se=e);},get cornerstone(){if(!se){if(!window||!window.cornerstone)throw new Error("cornerstoneWADOImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneWADOImageLoader.external.cornerstone = cornerstone; to your application.");se=window.cornerstone,ce(se);}return se},set dicomParser(e){ue=e;},get dicomParser(){if(!ue){if(!window||!window.dicomParser)throw new Error("cornerstoneWADOImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneWADOImageLoader.external.dicomParser = dicomParser; to your application.");ue=window.dicomParser;}return ue}};var de=function(e){var t,r=e.indexOf(":"),a=e.substring(r+1),n=a.indexOf("frame=");if(-1!==n){var o=a.substr(n+6);t=parseInt(o,10),a=a.substr(0,n-1);}return {scheme:e.substr(0,r),url:a,frame:t}},pe=0,me={},ge={};function ve(){return {cacheSizeInBytes:pe,numberOfDataSetsCached:Object.keys(me).length}}var xe={isLoaded:function(e){return void 0!==me[e]},load:function(o){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:A,t=2<arguments.length?arguments[2]:void 0,i=fe.cornerstone,l=fe.dicomParser;if(me[o])return new Promise(function(e){me[o].cacheCount++,e(me[o].dataSet);});if(ge[o])return ge[o].cacheCount++,ge[o];var r=e(o,t),s=new Promise(function(a,n){r.then(function(e){var t,r=new Uint8Array(e);try{t=l.parseDicom(r);}catch(e){return n(e)}me[o]={dataSet:t,cacheCount:s.cacheCount},pe+=t.byteArray.length,a(t),i.triggerEvent(i.events,"datasetscachechanged",{uri:o,action:"loaded",cacheInfo:ve()});},n).then(function(){delete ge[o];},function(){delete ge[o];});});return s.cacheCount=1,ge[o]=s},unload:function(e){var t=fe.cornerstone;me[e]&&(me[e].cacheCount--,0===me[e].cacheCount&&(pe-=me[e].dataSet.byteArray.length,delete me[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:ve()})));},getInfo:ve,purge:function(){me={},ge={};},get:function(e){if(me[e])return me[e].dataSet}};var he=function(e,t){var r=fe.dicomParser,a=de(t),n=xe.get(a.url);if(n){if("generalSeriesModule"===e)return {modality:n.string("x00080060"),seriesInstanceUID:n.string("x0020000e"),seriesNumber:n.intString("x00200011"),studyInstanceUID:n.string("x0020000d"),seriesDate:r.parseDA(n.string("x00080021")),seriesTime:r.parseTM(n.string("x00080031")||"")};if("patientStudyModule"===e)return {patientAge:n.intString("x00101010"),patientSize:n.floatString("x00101020"),patientWeight:n.floatString("x00101030")};if("imagePlaneModule"===e){var o=w(n,"x00200037",6),i=w(n,"x00200032",3),l=w(n,"x00280030",2),s=null,u=null;l&&(u=l[0],s=l[1]);var c=null,f=null;return o&&(c=[parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])],f=[parseFloat(o[3]),parseFloat(o[4]),parseFloat(o[5])]),{frameOfReferenceUID:n.string("x00200052"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),imageOrientationPatient:o,rowCosines:c,columnCosines:f,imagePositionPatient:i,sliceThickness:n.floatString("x00180050"),sliceLocation:n.floatString("x00201041"),pixelSpacing:l,rowPixelSpacing:u,columnPixelSpacing:s}}if("imagePixelModule"===e)return g(n);if("modalityLutModule"===e)return {rescaleIntercept:n.floatString("x00281052"),rescaleSlope:n.floatString("x00281053"),rescaleType:n.string("x00281054"),modalityLUTSequence:v(n.uint16("x00280103"),n.elements.x00283000)};if("voiLutModule"===e){var d=h(n);return {windowCenter:w(n,"x00281050",1),windowWidth:w(n,"x00281051",1),voiLUTSequence:v(d,n.elements.x00283010)}}if("sopCommonModule"===e)return {sopClassUID:n.string("x00080016"),sopInstanceUID:n.string("x00080018")};if("petIsotopeModule"===e){var p=n.elements.x00540016;if(void 0===p)return;var m=p.items[0].dataSet;return {radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:r.parseTM(m.string("x00181072")||""),radionuclideTotalDose:m.floatString("x00181074"),radionuclideHalfLife:m.floatString("x00181075")}}}}},we=[];var be={add:function(e){var t=we.push(e);return "dicomfile:".concat(t-1)},get:function(e){return we[e]},remove:function(e){we[e]=void 0;},purge:function(){we=[];}};function ye(e,t){var r,a=fe.dicomParser;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return a.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if((r=e).intString("x00280008")===r.elements.x7fe00010.fragments.length)return a.readEncapsulatedPixelDataFromFragments(e,e.elements.x7fe00010,t);var n=a.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return a.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,n)}var Pe=function(e,t,r){for(var a=new Uint8Array(r),n=0;n<r;n++){var o=e[Math.floor(n/8)+t],i=n%8;a[n]=o&1<<i?1:0;}return a};var De=function(e,t){var r,a=e.elements.x7fe00010||e.elements.x7fe00008,n=e.uint16("x00280100"),o=e.uint16("x00280010"),i=e.uint16("x00280011"),l=e.uint16("x00280002"),s=a.dataOffset,u=o*i*l;if(8===n){if((r=s+t*u)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,r,u)}if(16===n){if((r=s+t*u*2)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,r,2*u)}if(1===n){if((r=s+t*u*.125)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return Pe(e.byteArray,r,u)}if(32!==n)throw new Error("unsupported pixel format");if((r=s+t*u*4)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer,r,4*u)};var Ie=function(e){var t=de(e),r=parseInt(t.url,10),a=be.get(r);return new Promise(function(r,e){var t=new FileReader;t.onload=function(e){var t=e.target.result;r(t);},t.onerror=e,t.readAsArrayBuffer(a);})};var Te=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=e.elements.x7fe00010||e.elements.x7fe00008;return r?r.encapsulatedPixelData?ye(e,t):De(e,t):null};function Ce(e,s){var u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,c=3<arguments.length?arguments[3]:void 0,f=4<arguments.length?arguments[4]:void 0,d=5<arguments.length?arguments[5]:void 0,p=(new Date).getTime(),m={cancelFn:void 0};return m.promise=new Promise(function(i,l){e.then(function(r){var t,e=Te(r,u),a=r.string("x00020010"),n=(new Date).getTime(),o=oe(s,e,a,f);t=s,m.decache=function(){var e=de(t);xe.unload(e.url);},o.then(function(e){e.data=r,e.sharedCacheKey=c;var t=(new Date).getTime();e.loadTimeInMS=n-p,e.totalTimeInMS=t-p,void 0!==d&&void 0!==d.imageDoneCallback&&d.imageDoneCallback(e),i(e);},function(e){l({error:e,dataSet:r});});},function(e){l({error:e});});}),m}function ke(e){return "dicomweb"===e||"wadouri"===e?A:"dicomfile"===e?Ie:void 0}function Ae(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=de(e),a=(t=Object.assign({},t)).loader;return void 0===a?a=ke(r.scheme):delete t.loader,xe.isLoaded(r.url)?function(i,l){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,u=3<arguments.length?arguments[3]:void 0,c=4<arguments.length?arguments[4]:void 0,f=(new Date).getTime();return {promise:new Promise(function(r,t){var e,a=(new Date).getTime();try{var n=Te(i,s),o=i.string("x00020010");e=oe(l,n,o,c);}catch(e){return void t({error:e,dataSet:i})}e.then(function(e){e.data=i,e.sharedCacheKey=u;var t=(new Date).getTime();e.loadTimeInMS=a-f,e.totalTimeInMS=t-f,r(e);},t);}),cancelFn:void 0}}(xe.get(r.url,a,e),e,r.frame,r.url,t):Ce(xe.load(r.url,a,e),e,r.frame,r.url,t)}var Le={metaData:{getImagePixelModule:g,getLUTs:v,getModalityLUTOutputPixelRepresentation:h,getNumberValues:w,metaDataProvider:he},dataSetCacheManager:xe,fileManager:be,getEncapsulatedImageFrame:ye,getUncompressedImageFrame:De,loadFileRequest:Ie,loadImageFromPromise:Ce,getLoaderForScheme:ke,loadImage:Ae,parseImageId:de,unpackBinaryFrame:Pe,register:function(e){e.registerImageLoader("dicomweb",Ae),e.registerImageLoader("wadouri",Ae),e.registerImageLoader("dicomfile",Ae),e.metaData.addProvider(he);}};var Se=function(e){C(e);},Ee=r(3);r.d(t,"convertRGBColorByPixel",function(){return a}),r.d(t,"convertRGBColorByPlane",function(){return n}),r.d(t,"convertYBRFullByPixel",function(){return o}),r.d(t,"convertYBRFullByPlane",function(){return i}),r.d(t,"convertPALETTECOLOR",function(){return l}),r.d(t,"wadouri",function(){return Le}),r.d(t,"wadors",function(){return le}),r.d(t,"configure",function(){return Se}),r.d(t,"convertColorSpace",function(){return re}),r.d(t,"createImage",function(){return oe}),r.d(t,"decodeImageFrame",function(){return $}),r.d(t,"decodeJPEGBaseline8BitColor",function(){return Y}),r.d(t,"getImageFrame",function(){return O}),r.d(t,"getMinMax",function(){return z.a}),r.d(t,"isColorImage",function(){return ee}),r.d(t,"isJPEGBaseline8BitColor",function(){return ae}),r.d(t,"webWorkerManager",function(){return J}),r.d(t,"version",function(){return Ee.a}),r.d(t,"internal",function(){return L}),r.d(t,"external",function(){return fe});var Oe={convertRGBColorByPixel:a,convertRGBColorByPlane:n,convertYBRFullByPixel:o,convertYBRFullByPlane:i,convertPALETTECOLOR:l,wadouri:Le,wadors:le,configure:Se,convertColorSpace:re,createImage:oe,decodeImageFrame:$,decodeJPEGBaseline8BitColor:Y,getImageFrame:O,getMinMax:z.a,isColorImage:ee,isJPEGBaseline8BitColor:ae,webWorkerManager:J,version:Ee.a,internal:L,external:fe};t.default=Oe;}])});

  });

  var cornerstoneWADOImageLoader$1 = unwrapExports(cornerstoneWADOImageLoader_min);
  var cornerstoneWADOImageLoader_min_1 = cornerstoneWADOImageLoader_min.cornerstoneWADOImageLoader;

  var cornerstoneMath_min = createCommonjsModule(function (module, exports) {
  /*! cornerstone-math - 0.1.8 - 2019-01-16 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneMath */
  !function(t,e){module.exports=e();}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n});},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0});},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=function(t,e,i){return t<e?e:t>i?i:t},e.degToRad=function(t){return t*(Math.PI/180)},e.radToDeg=function(t){return t*(180/Math.PI)},e.sign=function(t){return "number"==typeof t?t?t<0?-1:1:t==t?0:NaN:NaN};},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,o=i(3),s=(n=o)&&n.__esModule?n:{default:n},r=i(0);var a,h,u,c,l,f=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0;};f.prototype={constructor:f,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyAxisAngle:(l=void 0,function(t,e){return void 0===l&&(l=new s.default),this.applyQuaternion(l.setFromAxisAngle(t.normalize(),e)),this}),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,o=t.elements;return this.x=o[0]*e+o[3]*i+o[6]*n,this.y=o[1]*e+o[4]*i+o[7]*n,this.z=o[2]*e+o[5]*i+o[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12],this.y=o[1]*e+o[5]*i+o[9]*n+o[13],this.z=o[2]*e+o[6]*i+o[10]*n+o[14],this},applyProjection:function(t){var e=this.x,i=this.y,n=this.z,o=t.elements,s=1/(o[3]*e+o[7]*i+o[11]*n+o[15]);return this.x=(o[0]*e+o[4]*i+o[8]*n+o[12])*s,this.y=(o[1]*e+o[5]*i+o[9]*n+o[13])*s,this.z=(o[2]*e+o[6]*i+o[10]*n+o[14])*s,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,o=t.x,s=t.y,r=t.z,a=t.w,h=a*e+s*n-r*i,u=a*i+r*e-o*n,c=a*n+o*i-s*e,l=-o*e-s*i-r*n;return this.x=h*a+l*-o+u*-r-c*-s,this.y=u*a+l*-s+c*-o-h*-r,this.z=c*a+l*-r+h*-s-u*-o,this},transformDirection:function(t){var e=this.x,i=this.y,n=this.z,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n,this.y=o[1]*e+o[5]*i+o[9]*n,this.z=o[2]*e+o[6]*i+o[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e,this.z*=e;}else this.x=0,this.y=0,this.z=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},clampScalar:(u=void 0,c=void 0,function(t,e){return void 0===u&&(u=new f,c=new f),u.set(t,t,t),c.set(e,e,e),this.clamp(u,c)}),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},cross:function(t,e){if(void 0!==e)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,o=this.z;return this.x=n*t.z-o*t.y,this.y=o*t.x-i*t.z,this.z=i*t.y-n*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,o=t.z,s=e.x,r=e.y,a=e.z;return this.x=n*a-o*r,this.y=o*s-i*a,this.z=i*r-n*s,this},projectOnVector:(a=void 0,h=void 0,function(t){return void 0===a&&(a=new f),a.copy(t).normalize(),h=this.dot(a),this.copy(a).multiplyScalar(h)}),projectOnPlane:function(){var t=void 0;return function(e){return void 0===t&&(t=new f),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=void 0;return function(e){return void 0===t&&(t=new f),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/(this.length()*t.length());return Math.acos((0, r.clamp)(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),i=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),n=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){var i=4*t,n=e.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},toArray:function(){return [this.x,this.y,this.z]},clone:function(){return new f(this.x,this.y,this.z)}},e.default=f;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0);function o(t){return t*t}function s(t,e){return o(t.x-e.x)+o(t.y-e.y)}var r={distanceToPoint:function(t,e){return Math.sqrt(function(t,e){var i=s(t.start,t.end);if(0===i)return s(e,t.start);var n=((e.x-t.start.x)*(t.end.x-t.start.x)+(e.y-t.start.y)*(t.end.y-t.start.y))/i;return s(e,n<0?t.start:n>1?t.end:{x:t.start.x+n*(t.end.x-t.start.x),y:t.start.y+n*(t.end.y-t.start.y)})}(t,e))},intersectLine:function(t,e){var i,o,s,r,a,h,u,c,l,f,y,d={},p=t.start.x,x=t.start.y,m=t.end.x,v=t.end.y,g=e.start.x,z=e.start.y,b=e.end.x,M=e.end.y,w=void 0;if(f=(i=v-x)*b+(s=p-m)*M+(a=m*x-p*v),(0===(l=i*g+s*z+a)||0===f||(0, n.sign)(l)!==(0, n.sign)(f))&&(c=(o=M-z)*m+(r=g-b)*v+(h=b*z-g*M),0===(u=o*p+r*x+h)||0===c||(0, n.sign)(u)!==(0, n.sign)(c))){y=i*r-o*s,w=s*h-r*a;var R=parseFloat(w/y);w=o*a-i*h;var P=parseFloat(w/y);return d.x=R,d.y=P,d}}};e.default=r;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1;};n.prototype.setFromAxisAngle=function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this},n.prototype.multiplyQuaternions=function(t,e){var i=t.x,n=t.y,o=t.z,s=t.w,r=e.x,a=e.y,h=e.z,u=e.w;return this.x=i*u+s*r+n*h-o*a,this.y=n*u+s*a+o*r-i*h,this.z=o*u+s*h+i*a-n*r,this.w=s*u-i*r-n*a-o*h,this},n.prototype.setFromRotationMatrix=function(t){var e=t.elements,i=e[0],n=e[4],o=e[8],s=e[1],r=e[5],a=e[9],h=e[2],u=e[6],c=e[10],l=i+r+c,f=void 0;return l>0?(f=.5/Math.sqrt(l+1),this.w=.25/f,this.x=(u-a)*f,this.y=(o-h)*f,this.z=(s-n)*f):i>r&&i>c?(f=2*Math.sqrt(1+i-r-c),this.w=(u-a)/f,this.x=.25*f,this.y=(n+s)/f,this.z=(o+h)/f):r>c?(f=2*Math.sqrt(1+r-i-c),this.w=(o-h)/f,this.x=(n+s)/f,this.y=.25*f,this.z=(a+u)/f):(f=2*Math.sqrt(1+c-i-r),this.w=(s-n)/f,this.x=(o+h)/f,this.y=(a+u)/f,this.z=.25*f),this},e.default=n;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,o=i(2),s=(n=o)&&n.__esModule?n:{default:n};function r(t){return {topLeft:{x:t.left,y:t.top},bottomRight:{x:t.left+t.width,y:t.top+t.height}}}var a={distanceToPoint:function(t,e){var i=655535;return function(t){return [{start:{x:t.left,y:t.top},end:{x:t.left+t.width,y:t.top}},{start:{x:t.left+t.width,y:t.top},end:{x:t.left+t.width,y:t.top+t.height}},{start:{x:t.left+t.width,y:t.top+t.height},end:{x:t.left,y:t.top+t.height}},{start:{x:t.left,y:t.top+t.height},end:{x:t.left,y:t.top}}]}(t).forEach(function(t){var n=s.default.distanceToPoint(t,e);n<i&&(i=n);}),i},getIntersectionRect:function(t,e){var i={topLeft:{},bottomRight:{}};if(function(t,e){var i=void 0,n=void 0,o=r(t),s=r(e);return i=t.width>=0?e.width>=0?!(o.bottomRight.x<=s.topLeft.x||s.bottomRight.x<=o.topLeft.x):!(o.bottomRight.x<=s.bottomRight.x||s.topLeft.x<=o.topLeft.x):e.width>=0?!(o.topLeft.x<=s.topLeft.x||s.bottomRight.x<=o.bottomRight.x):!(o.topLeft.x<=s.bottomRight.x||s.topLeft.x<=o.bottomRight.x),n=t.height>=0?e.height>=0?!(o.bottomRight.y<=s.topLeft.y||s.bottomRight.y<=o.topLeft.y):!(o.bottomRight.y<=s.bottomRight.y||s.topLeft.y<=o.topLeft.y):e.height>=0?!(o.topLeft.y<=s.topLeft.y||s.bottomRight.y<=o.bottomRight.y):!(o.topLeft.y<=s.bottomRight.y||s.top<=o.bottomRight.y),i&&n}(t,e)){var n=r(t),o=r(e);return t.width>=0?e.width>=0?(i.topLeft.x=Math.max(n.topLeft.x,o.topLeft.x),i.bottomRight.x=Math.min(n.bottomRight.x,o.bottomRight.x)):(i.topLeft.x=Math.max(n.topLeft.x,o.bottomRight.x),i.bottomRight.x=Math.min(n.bottomRight.x,o.topLeft.x)):e.width>=0?(i.topLeft.x=Math.min(n.topLeft.x,o.bottomRight.x),i.bottomRight.x=Math.max(n.bottomRight.x,o.topLeft.x)):(i.topLeft.x=Math.min(n.topLeft.x,o.topLeft.x),i.bottomRight.x=Math.max(n.bottomRight.x,o.bottomRight.x)),t.height>=0?e.height>=0?(i.topLeft.y=Math.max(n.topLeft.y,o.topLeft.y),i.bottomRight.y=Math.min(n.bottomRight.y,o.bottomRight.y)):(i.topLeft.y=Math.max(n.topLeft.y,o.bottomRight.y),i.bottomRight.y=Math.min(n.bottomRight.y,o.topLeft.y)):e.height>=0?(i.topLeft.y=Math.min(n.topLeft.y,o.bottomRight.y),i.bottomRight.y=Math.max(n.bottomRight.y,o.topLeft.y)):(i.topLeft.y=Math.min(n.topLeft.y,o.topLeft.y),i.bottomRight.y=Math.max(n.bottomRight.y,o.bottomRight.y)),i}}};e.default=a;},function(t,e,i){function n(t,e){return {x:t.x-e.x,y:t.y-e.y}}function o(t,e){return Math.sqrt(s(t,e))}function s(t,e){var i=n(t,e);return i.x*i.x+i.y*i.y}Object.defineProperty(e,"__esModule",{value:!0});var r={subtract:n,copy:function(t){return {x:t.x,y:t.y}},pageToPoint:function(t){return {x:t.pageX,y:t.pageY}},distance:o,distanceSquared:s,insideRect:function(t,e){return !(t.x<e.left||t.x>e.left+e.width||t.y<e.top||t.y>e.top+e.height)},findClosestPoint:function(t,e){var i=[],n=void 0;return t.forEach(function(t,s){var r=o(t,e);i.push(r),n=0===s?r:Math.min(r,n);}),t[i.indexOf(n)]}};e.default=r;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,o=i(1),s=(n=o)&&n.__esModule?n:{default:n};var r,a,h=function(t,e){this.normal=void 0!==t?t:new s.default(1,0,0),this.constant=void 0!==e?e:0;};h.prototype={constructor:h,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:(r=new s.default,a=new s.default,function(t,e,i){var n=r.subVectors(i,e).cross(a.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}),copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t);return (e||new s.default).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectLine:function(){var t=new s.default;return function(e,i){var n=i||new s.default,o=e.delta(t),r=this.normal.dot(o);if(0===r)return 0===this.distanceToPoint(e.start)?n.copy(e.start):void 0;var a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?void 0:n.copy(o).multiplyScalar(a).add(e.start)}}(),intersectPlane:function(t){var e=this.normal.clone().cross(t.normal),i={origin:new s.default,direction:e};if(this.normal.clone().cross(t.normal).length<1e-10)return i.direction=new s.default,i;var n=this.constant,o=t.constant,r=this.normal.clone().dot(t.normal),a=-(n-o*r)/(1-r*r),h=-(o-n*r)/(1-r*r);return i.origin=this.normal.clone().multiplyScalar(a).add(t.normal.clone().multiplyScalar(h)),i},coplanarPoint:function(t){return (t||new s.default).copy(this.normal).multiplyScalar(-this.constant)},translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},clone:function(){return (new h).copy(this)}},e.default=h;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,o=i(1),s=(n=o)&&n.__esModule?n:{default:n};var r=function(t,e,i,n,o,s,r,a,h,u,c,l,f,y,d,p){this.elements=new Float32Array(16);var x=this.elements;x[0]=void 0!==t?t:1,x[4]=e||0,x[8]=i||0,x[12]=n||0,x[1]=o||0,x[5]=void 0!==s?s:1,x[9]=r||0,x[13]=a||0,x[2]=h||0,x[6]=u||0,x[10]=void 0!==c?c:1,x[14]=l||0,x[3]=f||0,x[7]=y||0,x[11]=d||0,x[15]=void 0!==p?p:1;};r.prototype.makeRotationFromQuaternion=function(t){var e=this.elements,i=t.x,n=t.y,o=t.z,s=t.w,r=i+i,a=n+n,h=o+o,u=i*r,c=i*a,l=i*h,f=n*a,y=n*h,d=o*h,p=s*r,x=s*a,m=s*h;return e[0]=1-(f+d),e[4]=c-m,e[8]=l+x,e[1]=c+m,e[5]=1-(u+d),e[9]=y-p,e[2]=l-x,e[6]=y+p,e[10]=1-(u+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},r.prototype.multiplyMatrices=function(t,e){var i=t.elements,n=e.elements,o=this.elements,s=i[0],r=i[4],a=i[8],h=i[12],u=i[1],c=i[5],l=i[9],f=i[13],y=i[2],d=i[6],p=i[10],x=i[14],m=i[3],v=i[7],g=i[11],z=i[15],b=n[0],M=n[4],w=n[8],R=n[12],P=n[1],L=n[5],T=n[9],S=n[13],_=n[2],V=n[6],q=n[10],j=n[14],E=n[3],k=n[7],O=n[11],A=n[15];return o[0]=s*b+r*P+a*_+h*E,o[4]=s*M+r*L+a*V+h*k,o[8]=s*w+r*T+a*q+h*O,o[12]=s*R+r*S+a*j+h*A,o[1]=u*b+c*P+l*_+f*E,o[5]=u*M+c*L+l*V+f*k,o[9]=u*w+c*T+l*q+f*O,o[13]=u*R+c*S+l*j+f*A,o[2]=y*b+d*P+p*_+x*E,o[6]=y*M+d*L+p*V+x*k,o[10]=y*w+d*T+p*q+x*O,o[14]=y*R+d*S+p*j+x*A,o[3]=m*b+v*P+g*_+z*E,o[7]=m*M+v*L+g*V+z*k,o[11]=m*w+v*T+g*q+z*O,o[15]=m*R+v*S+g*j+z*A,this},r.prototype.multiply=function(t,e){return void 0!==e?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},r.prototype.getInverse=function(t,e){var i=this.elements,n=t.elements,o=n[0],s=n[4],r=n[8],a=n[12],h=n[1],u=n[5],c=n[9],l=n[13],f=n[2],y=n[6],d=n[10],p=n[14],x=n[3],m=n[7],v=n[11],g=n[15];i[0]=c*p*m-l*d*m+l*y*v-u*p*v-c*y*g+u*d*g,i[4]=a*d*m-r*p*m-a*y*v+s*p*v+r*y*g-s*d*g,i[8]=r*l*m-a*c*m+a*u*v-s*l*v-r*u*g+s*c*g,i[12]=a*c*y-r*l*y-a*u*d+s*l*d+r*u*p-s*c*p,i[1]=l*d*x-c*p*x-l*f*v+h*p*v+c*f*g-h*d*g,i[5]=r*p*x-a*d*x+a*f*v-o*p*v-r*f*g+o*d*g,i[9]=a*c*x-r*l*x-a*h*v+o*l*v+r*h*g-o*c*g,i[13]=r*l*f-a*c*f+a*h*d-o*l*d-r*h*p+o*c*p,i[2]=u*p*x-l*y*x+l*f*m-h*p*m-u*f*g+h*y*g,i[6]=a*y*x-s*p*x-a*f*m+o*p*m+s*f*g-o*y*g,i[10]=s*l*x-a*u*x+a*h*m-o*l*m-s*h*g+o*u*g,i[14]=a*u*f-s*l*f-a*h*y+o*l*y+s*h*p-o*u*p,i[3]=c*y*x-u*d*x-c*f*m+h*d*m+u*f*v-h*y*v,i[7]=s*d*x-r*y*x+r*f*m-o*d*m-s*f*v+o*y*v,i[11]=r*u*x-s*c*x-r*h*m+o*c*m+s*h*v-o*u*v,i[15]=s*c*f-r*u*f+r*h*y-o*c*y-s*h*d+o*u*d;var z=o*i[0]+h*i[4]+f*i[8]+x*i[12];if(0===z){var b="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(b);return console.warn(b),this.identity(),this}return this.multiplyScalar(1/z),this},r.prototype.applyToVector3Array=function(){var t=new s.default;return function(e,i,n){void 0===i&&(i=0),void 0===n&&(n=e.length);for(var o=0,s=i;o<n;o+=3,s+=3)t.x=e[s],t.y=e[s+1],t.z=e[s+2],t.applyMatrix4(this),e[s]=t.x,e[s+1]=t.y,e[s+2]=t.z;return e}},r.prototype.makeTranslation=function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},r.prototype.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},r.prototype.set=function(t,e,i,n,o,s,r,a,h,u,c,l,f,y,d,p){var x=this.elements;return x[0]=t,x[4]=e,x[8]=i,x[12]=n,x[1]=o,x[5]=s,x[9]=r,x[13]=a,x[2]=h,x[6]=u,x[10]=c,x[14]=l,x[3]=f,x[7]=y,x[11]=d,x[15]=p,this},r.prototype.makeScale=function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},e.default=r;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n);}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),r=(n=s)&&n.__esModule?n:{default:n},a=i(0);var h=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.start=void 0!==e?e:new r.default,this.end=void 0!==i?i:new r.default;}return o(t,[{key:"set",value:function(t,e){return this.start.copy(t),this.end.copy(e),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"center",value:function(t){return (t||new r.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(t){return (t||new r.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,e){var i=e||new r.default;return this.delta(i).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,e){var i=new r.default,n=new r.default;i.subVectors(t,this.start),n.subVectors(this.end,this.start);var o=n.dot(n),s=n.dot(i)/o;return e&&(s=(0, a.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(t,e,i){var n=this.closestPointToPointParameter(t,e),o=i||new r.default;return this.delta(o).multiplyScalar(n).add(this.start)}},{key:"applyMatrix4",value:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}},{key:"clone",value:function(){return (new t).copy(this)}},{key:"intersectLine",value:function(t){var e=this.end.clone().sub(this.start),i=t.end.clone().sub(t.start),n=t.start.clone().sub(this.start),o=e.clone().cross(i),s=n.clone().cross(i);if(0!==n.dot(e)){var r=s.dot(o)/o.lengthSq();if(!(r>1||isNaN(r))){var a=this.start.clone().add(e.clone().multiplyScalar(r));return a.clone().sub(t.start).lengthSq()+a.clone().sub(t.end).lengthSq()<=t.distanceSq()?a:void 0}}}}]),t}();e.default=h;},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3=e.rect=e.quaternion=e.point=e.Plane=e.Matrix4=e.sign=e.radToDeg=e.degToRad=e.clamp=e.lineSegment=e.Line3=void 0;var n=f(i(8)),o=f(i(2)),s=i(0),r=f(i(7)),a=f(i(6)),h=f(i(5)),u=f(i(3)),c=f(i(4)),l=f(i(1));function f(t){return t&&t.__esModule?t:{default:t}}var y={Line3:n.default,lineSegment:o.default,clamp:s.clamp,degToRad:s.degToRad,radToDeg:s.radToDeg,sign:s.sign,Matrix4:r.default,Plane:a.default,point:h.default,quaternion:u.default,rect:c.default,Vector3:l.default};e.Line3=n.default,e.lineSegment=o.default,e.clamp=s.clamp,e.degToRad=s.degToRad,e.radToDeg=s.radToDeg,e.sign=s.sign,e.Matrix4=r.default,e.Plane=a.default,e.point=h.default,e.quaternion=u.default,e.rect=c.default,e.Vector3=l.default,e.default=y;}])});

  });

  var cornerstoneMath$1 = unwrapExports(cornerstoneMath_min);

  var cornerstoneTools_min = createCommonjsModule(function (module, exports) {
  /*! cornerstone-tools - 3.0.0-b.1512 - 2018-12-17 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
  !function(e,t){module.exports=t();}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a});},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0});},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a);}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};},function(e,t,n){var a=n(16);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t);};},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n;},function(e,t,n){var a=n(6),o=n(0);e.exports=function(e,t){return !t||"object"!==a(t)&&"function"!=typeof t?o(e):t};},function(e,t){function n(e){return (n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t){return "function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=a=function(e){return n(e)}:e.exports=a=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a(t)}e.exports=a;},function(e,t,n){e.exports=n(12);},function(e,t){function n(e,t,n,a,o,i,r){try{var s=e[i](r),l=s.value;}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,o);}e.exports=function(e){return function(){var t=this,a=arguments;return new Promise(function(o,i){var r=e.apply(t,a);function s(e){n(r,o,i,s,l,"next",e);}function l(e){n(r,o,i,s,l,"throw",e);}s(void 0);})}};},function(e,t,n){var a=n(15),o=n(14),i=n(13);e.exports=function(e){return a(e)||o(e)||i()};},function(e,t,n){n.r(t);var a=n(1),o=n.n(a),i=n(2),r=n.n(i),s=n(5),l=n.n(s),c=n(4),u=n.n(c),d=n(3),h=n.n(d),v=window.cornerstone,g=window.cornerstoneMath,m=window.Hammer,f={set cornerstone(e){v=e;},get cornerstone(){return v},set cornerstoneMath(e){g=e;},get cornerstoneMath(){return g},set Hammer(e){m=e;},get Hammer(){return m}},p=n(6),y=n.n(p),x={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll"};function T(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return "function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:a,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,a),e.dispatchEvent(n)}var b={drawColorId:0,radius:10,minRadius:1,maxRadius:50,alpha:.4,renderBrushIfHiddenButActive:!0,hiddenButActiveAlpha:.2,colorMapId:"BrushColorMap",visibleSegmentations:{},imageBitmapCache:{},segmentationMetadata:{}},E={radius:function(e){b.radius=Math.min(Math.max(e,b.minRadius),b.maxRadius);},brushColorMap:function(e){var t=f.cornerstone.colors.getColormap(b.colorMapId);t.setNumberOfColors(e.length);for(var n=0;n<e.length;n++)t.setColor(n,e[n]);},elementVisible:function(e){if(f.cornerstone){var t=f.cornerstone.getEnabledElement(e).uuid,n=f.cornerstone.colors.getColormap(b.colorMapId).getNumberOfColors();b.visibleSegmentations[t]=[];for(var a=0;a<n;a++)b.visibleSegmentations[t].push(!0);}},brushVisibilityForElement:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];b.visibleSegmentations[e]||(b.imageBitmapCache[e]=[]),b.visibleSegmentations[e][t]=n;},imageBitmapCacheForElement:function(e,t,n){b.imageBitmapCache[e]||(b.imageBitmapCache[e]=[]),b.imageBitmapCache[e][t]=n;},clearImageBitmapCacheForElement:function(e){b.imageBitmapCache[e]=[];},metadata:function(e,t,n){b.segmentationMetadata[e]||(b.segmentationMetadata[e]=[]),b.segmentationMetadata[e][t]=n;}};var M={state:b,onRegisterCallback:function(){!function(){var e=f.cornerstone.colors.getColormap(b.colorMapId);e.setNumberOfColors(19);for(var t=0;t<19;t++)t<C.length?e.setColor(t,C[t]):e.setColor(t,I());}();},enabledElementCallback:function(e){E.elementVisible(e);},getters:{imageBitmapCacheForElement:function(e){return b.imageBitmapCache[e]?b.imageBitmapCache[e]:null},visibleSegmentationsForElement:function(e){return b.visibleSegmentations[e]?b.visibleSegmentations[e]:null},metadata:function(e,t){if(b.segmentationMetadata[e])return void 0!==t?b.segmentationMetadata[e][t]:b.segmentationMetadata[e]}},setters:E},C=[[230,25,75,255],[60,180,175,255],[255,225,25,255],[0,130,200,255],[245,130,48,255],[145,30,180,255],[70,240,240,255],[240,50,230,255],[210,245,60,255],[250,190,190,255],[0,128,128,255],[230,190,255,255],[170,110,40,255],[255,250,200,255],[128,0,0,255],[170,255,195,255],[128,128,0,255],[255,215,180,255],[0,0,128,255]],w=0;function I(){for(var e=function(){var e=[w];w<C.length-1?(w++,e.push(w)):(w=0,e.push(w));return e}(),t=Math.random(),n=[],a=0;a<4;a++)n.push(Math.floor(t*C[e[0]][a]+(1-t)*C[e[1]][a]));return n}var S={globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},k={mouseTools:function(){return S.tools.filter(function(e){return e.supportedInteractionTypes.includes("Mouse")})},touchTools:function(){return S.tools.filter(function(e){return e.supportedInteractionTypes.includes("Touch")})},enabledElementByUID:function(e){return S.enabledElements.filter(function(t){return t.uuid===e})}},P={brush:M,globalConfiguration:{state:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1},setters:{}}},_={modules:P,state:S,getters:k},O=function(e,t){return S.tools.find(function(n){return n.element===e&&n.name===t})},D=function(e,t,n,a){void 0===a&&Array.isArray(n)&&(a=n,n=null);var o=O(e,t);o&&(!function(e,t,n,a){t.supportedInteractionTypes.forEach(function(o){if(void 0===a||a.includes(o)){var i=W[o];i?i(t,e,n):console.warn("Unable to resolve input conflicts for type ".concat(o));}}),_.state.tools.filter(function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0}).forEach(function(t){var n=!1;t.supportedInteractionTypes.forEach(function(e){t.options["is".concat(e,"Active")]&&(n=!0);}),n||(console.info("Setting tool ".concat(t.name,"'s to PASSIVE")),N(e,t.name));});}(e,o,n,a),o.supportedInteractionTypes.forEach(function(e){void 0===a||a.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1;})),F("active",null,e,t,n);},L=function(e,t,n){z("active",e,t,n),_.state.enabledElements.forEach(function(a){D(a,e,t,n);});},A=F.bind(null,"disabled",null),H=V.bind(null,"disabled",null),R=F.bind(null,"enabled",null),U=V.bind(null,"enabled",null),N=F.bind(null,"passive",x.TOOL_DEACTIVATED),B=V.bind(null,"passive",x.TOOL_DEACTIVATED);function F(e,t,n,a,o){var i=O(n,a);i?(o=G(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(i.options.mouseButtonMask)&&(o.mouseButtonMask=o.mouseButtonMask.concat(i.options.mouseButtonMask)),i.mode=e,i.mergeOptions(o),i["".concat(e,"Callback")]&&i["".concat(e,"Callback")](n,o),t&&T(n,t,{options:o,toolName:a,type:t})):console.warn("Unable to find tool '".concat(a,"' for enabledElement"));}function V(e,t,n,a){z(e,n,a),_.state.enabledElements.forEach(function(o){F(e,t,o,n,a);});}function j(e,t,n,a){var o=_.state.tools.find(function(t){return t.element===n&&"active"===t.mode&&!0===t.options["is".concat(e,"Active")]});o&&(console.info("Setting tool ".concat(o.name,"'s is").concat(e,"Active to false")),o.options["is".concat(e,"Active")]=!1);}function z(e,t,n,a){if(_.modules.globalConfiguration.state.globalToolSyncEnabled){var o={mode:e,args:[t,n]};a&&o.push(a),_.state.globalToolChangeHistory.push(o);_.state.globalToolChangeHistory.length>50&&_.state.globalToolChangeHistory.shift();var i=_.state.globalTools[t];if("active"===e){var r=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var a=[],o=_.state.globalTools[e];if(o){var i=new o.tool(o.configuration);i.supportedInteractionTypes.forEach(function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var o=G(t).mouseButtonMask;Array.isArray(o)&&o.length>0?o.forEach(function(t){return a.push("".concat(e,"-").concat(t))}):Array.isArray(o)&&0===o.length&&a.push("".concat(e,"-DELETE"));}else"MultiTouch"===e?a.push("".concat(e,"-").concat(i.configuration.touchPointers)):a.push(e);});}return a}(t,n,a);Object.keys(_.state.globalTools).forEach(function(e){var t=_.state.globalTools[e];t.activeBindings=t.activeBindings.filter(function(e){return !r.includes(e)});}),r.some(function(e){return e.includes("Mouse-DELETE")})&&(i.activeBindings=i.activeBindings.filter(function(e){return !e.includes("Mouse")}),r=r.filter(function(e){return !e.includes("Mouse")})),i.activeBindings=i.activeBindings.concat(r);}else i.activeBindings=[];}}var W={Mouse:function(e,t,n){var a=G(n).mouseButtonMask;if(Array.isArray(a)&&a.length>0){var o=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some(function(e){return a.includes(e)})});o&&(o.options.mouseButtonMask=o.options.mouseButtonMask.filter(function(e){return !a.includes(e)}),0===o.options.mouseButtonMask.length&&(o.options.isMouseActive=!1));}},MouseWheel:j.bind(void 0,"MouseWheel"),Touch:function(e,t,n){var a=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}),o=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers});a&&(console.info("Setting tool ".concat(a.name,"'s isTouchActive to false")),a.options.isTouchActive=!1),o&&(console.info("Setting tool ".concat(o.name,"'s isTouchActive to false")),o.options.isMultiTouchActive=!1);},TouchPinch:j.bind(void 0,"TouchPinch"),TouchRotate:j.bind(void 0,"TouchRotate"),DoubleTap:j.bind(void 0,"DoubleTap"),MultiTouch:function(e,t,n){var a,o=_.state.tools.find(function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers});1===e.configuration.touchPointers&&(a=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),o&&(console.info("Setting tool ".concat(o.name,"'s isMultiTouchActive to false")),o.options.isMultiTouchActive=!1),a&&(console.info("Setting tool ".concat(a.name,"'s isTouchActive to false")),a.options.isTouchActive=!1);}};function G(e){if(e!==Object(e)||Array.isArray(e))if("number"==typeof e){var t=[];t.push(e),e={mouseButtonMask:0===e?[]:t};}else null===e?e={mouseButtonMask:[]}:(console.info("No options provided when changing tool mode"),e={});else if(0===e.mouseButtonMask||null===e.mouseButtonMask)e.mouseButtonMask=[];else if("number"==typeof e.mouseButtonMask){var n=[];n.push(e.mouseButtonMask),e.mouseButtonMask=n;}return e}var q={activeOrDisabledBinaryTool:{passiveCallback:function(e){A(e,this.name);},enabledCallback:function(e){D(e,this.name);}},enabledOrDisabledBinaryTool:{passiveCallback:function(e){A(e,this.name);},activeCallback:function(e){R(e,this.name);}}},Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.name,a=t.strategies,i=t.defaultStrategy,r=t.configuration,s=t.supportedInteractionTypes,l=t.mixins;o()(this,e),this.name=n,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=s||[],this.strategies=a||{},this.defaultStrategy=i||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,this._options={},this._configuration=Object.assign({},r),this.hasCursor=!1,l&&l.length&&this._applyMixins(l);}return r()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e);}},{key:"clearOptions",value:function(){this._options={};}},{key:"applyActiveStrategy",value:function(e){return this.strategies[this.activeStrategy](e,this.configuration)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=q["".concat(e[t])];"object"===y()(n)?Object.assign(this,n):console.warn("".concat(this.name,": mixin ").concat(q[t]," does not exist."));}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e;}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}();function X(){var e={};return {get:function(t,n){var a=f.cornerstone.getEnabledElement(t);if(a.image&&!1!==e.hasOwnProperty(a.image.imageId)){var o=e[a.image.imageId];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,a){var o=f.cornerstone.getEnabledElement(t);o.image&&!1!==e.hasOwnProperty(o.image.imageId)||(e[o.image.imageId]={});var i=e[o.image.imageId];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a);},clear:function(t){var n=f.cornerstone.getEnabledElement(t);n.image&&!1!==e.hasOwnProperty(n.image.imageId)&&delete e[n.image.imageId];},saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n;},saveToolState:function(){return e},restoreToolState:function(t){e=t;},toolState:e}}var K=X();function Z(e){var t=f.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=K),t.toolStateManager}function J(e,t,n){Z(e).add(e,t,n),T(e,x.MEASUREMENT_ADDED,{toolType:t,element:e,measurementData:n});}function Q(e,t){return Z(e).get(e,t)}function $(e,t,n){for(var a=Z(e).get(e,t),o=-1,i=0;i<a.data.length;i++)a.data[i]===n&&(o=i);-1!==o&&(a.data.splice(o,1),T(e,x.MEASUREMENT_REMOVED,{toolType:t,element:e,measurementData:n}));}function ee(e,t){var n=Z(e).get(e,t);void 0!==n&&(n.data=[]);}function te(e,t){f.cornerstone.getEnabledElement(e).toolStateManager=t;}var ne=function(e,t){if(e.boundingBox)return f.cornerstoneMath.point.insideRect(t,e.boundingBox)},ae=function(e,t,n,a){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return !0}else if(!0===e.hasBoundingBox){if(ne(e,n))return !0}else{var o=f.cornerstone.pixelToCanvas(t,e);if(f.cornerstoneMath.point.distance(o,n)<=a)return !0}return !1},oe=function e(t,n,a,o){var i;if(n){if(Array.isArray(n))for(var r=Object.keys(n),s=0;s<r.length;s++){var l=n[r[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&ae(l,t,a,o)){i=l;break}}else if("object"===y()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(i=e(t,n[d],a,o))break}else{var h=n[d];if(ae(h,t,a,o)){i=h;break}}}return i}},ie=function(e,t,n,a){a||(a=6);var o=function(e){var t;return Object.keys(e).forEach(function(n){var a=e[n];!0!==a.active||(t=a);}),t}(t),i=oe(e,t,n,a);return o!==i&&(void 0!==i&&(i.active=!0),void 0!==o&&(o.active=!1),!0)};var re=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},o=!1;return Object.keys(t).forEach(function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===f.cornerstoneMath.point.insideRect(n,a)&&(o=!0);}),o};function se(e,t,n){return Math.min(Math.max(t,e),n)}function le(e,t){e.x=se(e.x,0,t.width),e.y=se(e.y,0,t.height);}var ce={mouse:[x.MOUSE_DRAG],touch:[x.TOUCH_DRAG]},ue={mouse:[x.MOUSE_UP,x.MOUSE_CLICK],touch:[x.TOUCH_END,x.TOUCH_DRAG_END,x.TOUCH_PINCH,x.TOUCH_PRESS,x.TAP]},de=function(e,t,n){var a=e.element,o=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:S.deleteIfHandleOutsideImage,preventHandleOutsideImage:S.preventHandleOutsideImage},o);var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,o=a.detail,i=o.element,r=o.image,s=a.detail.deltaPoints.image,l=s.x,c=s.y;t.active=!0;for(var u=Object.keys(t.handles),d=0;d<u.length;d++){var h=u[d],v=t.handles[h];!0!==v.movesIndependently&&v.hasOwnProperty("x")&&v.hasOwnProperty("y")&&(v.x+=l,v.y+=c,n.preventHandleOutsideImage&&le(v,r));}f.cornerstone.updateImage(i);var g=x.MEASUREMENT_MODIFIED;T(i,g,{toolName:e,element:i,measurementData:t}),a.preventDefault(),a.stopPropagation();}.bind(this,t,n,o),s=function e(a){!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=o.dragHandler,r=o.upOrEndHandler,s=arguments.length>5?arguments[5]:void 0,l=s.detail,c=s.detail.element;t.active=!1,t.invalidated=!0,S.isToolLocked=!1,ce[a].forEach(function(e){c.removeEventListener(e,i);}),ue[a].forEach(function(e){c.removeEventListener(e,r);}),n.deleteIfHandleOutsideImage&&re(l,t.handles)&&$(c,e,t);"function"==typeof n.doneMovingCallback&&n.doneMovingCallback();f.cornerstone.updateImage(c);}(t,n,o,i,{dragHandler:r,upOrEndHandler:e},a);};n.active=!0,S.isToolLocked=!0,ce[i].forEach(function(e){a.addEventListener(e,r);}),ue[i].forEach(function(e){a.addEventListener(e,s);});};var he={value:!1},ve={mouse:[x.MOUSE_DRAG],touch:[x.TOUCH_DRAG]},ge={mouse:[x.MOUSE_UP,x.MOUSE_CLICK],touch:[x.TOUCH_END,x.TOUCH_DRAG_END,x.TOUCH_PINCH,x.TOUCH_PRESS,x.TAP]},me=function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:S.deleteIfHandleOutsideImage,preventHandleOutsideImage:S.preventHandleOutsideImage},o);var r=e.element,s=function(e,t,n,a,o,i){var r=i.detail,s=r.image,l=r.currentPoints,c=r.element,u=l.page,d=f.cornerstone.pageToPixel(c,u.x,"touch"===o?u.y+-57:u.y);!1===n.hasMoved&&(n.hasMoved=!0);he.value=!1,n.active=!0,n.x=d.x,n.y=d.y,a.preventHandleOutsideImage&&le(n,s);f.cornerstone.updateImage(c);var h=x.MEASUREMENT_MODIFIED;T(c,h,{toolName:e,element:c,measurementData:t});}.bind(this,t,n,a,o,i),l=function r(l){!function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,s=r.dragHandler,l=r.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.currentPoints.image,d=c.detail.element;a.active=!1,n.active=!1,n.invalidated=!0,S.isToolLocked=!1,he.value=!1,ve[i].forEach(function(e){d.removeEventListener(e,s);}),ge[i].forEach(function(e){d.removeEventListener(e,l);}),o.deleteIfHandleOutsideImage&&re(t,n.handles)&&$(d,e,n);c.type===x.TOUCH_PRESS&&(c.detail.handlePressed=n,a.x=u.x,a.y=u.y);"function"==typeof o.doneMovingCallback&&o.doneMovingCallback();f.cornerstone.updateImage(d);}(t,e,n,a,o,i,{dragHandler:s,upOrEndHandler:r},l);};if(a.active=!0,n.active=!0,S.isToolLocked=!0,ve[i].forEach(function(e){r.addEventListener(e,s);}),ge[i].forEach(function(e){r.addEventListener(e,l);}),"touch"===i){he.value=!0;var c=f.cornerstone.getEnabledElement(r),u={x:e.currentPoints.page.x,y:e.currentPoints.page.y+-57},d=f.cornerstone.pageToPixel(r,u.x,u.y);!function e(t,n,a,o){if(!n.value)return;var i=Math.abs(t.y-o.y);var r=i/10;if(i<1)return t.y=o.y,void(n.value=!1);t.y>o.y?t.y-=r:t.y<o.y&&(t.y+=r);f.cornerstone.updateImage(a.element);f.cornerstone.requestAnimationFrame(function(){e(t,n,a,o);});}(a,he,c,d);}};var fe={mouse:[x.MOUSE_MOVE,x.MOUSE_DRAG],touch:[x.TOUCH_DRAG]},pe={mouse:[x.MOUSE_UP,x.MOUSE_CLICK],touch:[x.TOUCH_END,x.TOUCH_PINCH,x.TAP]},ye=function(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:S.deleteIfHandleOutsideImage,preventHandleOutsideImage:S.preventHandleOutsideImage},o);var r=e.element;S.isToolLocked=!0,a.active=!0,n.active=!0;var s=function(e,t,n,a,o,i){var r=i.detail,s=r.currentPoints,l=r.image,c=r.element,u=s.page,d=f.cornerstone.pageToPixel(c,"touch"===o?u.x+-57:u.x,"touch"===o?u.y+-57:u.y);n.active=!0,n.x=d.x,n.y=d.y,a&&a.preventHandleOutsideImage&&le(n,l);f.cornerstone.updateImage(c);var h=x.MEASUREMENT_MODIFIED;T(c,h,{toolName:e,element:c,measurementData:t});}.bind(this,t,n,a,o,i),l=function e(r){!function(e,t,n,a,o,i,r){var s=i.moveHandler,l=i.moveEndHandler,c=r.detail,u=c.element,d=c.currentPoints.page,h=f.cornerstone.pageToPixel(u,"touch"===o?d.x+-57:d.x,"touch"===o?d.y+-57:d.y);if(n.active=!1,t.active=!1,S.isToolLocked=!1,n.x=h.x,n.y=h.y,fe[o].forEach(function(e){u.removeEventListener(e,s);}),pe[o].forEach(function(e){u.removeEventListener(e,l);}),u.removeEventListener(x.TOUCH_START,xe),r.type===x.TOUCH_PINCH||r.type===x.TOUCH_PRESS)return n.active=!1,f.cornerstone.updateImage(u),void("function"==typeof a.doneMovingCallback&&a.doneMovingCallback());a.preventHandleOutsideImage&&le(n,r.detail.image);a.deleteIfHandleOutsideImage&&re(r.detail,t.handles)&&$(u,e,t);"function"==typeof a.doneMovingCallback&&a.doneMovingCallback();f.cornerstone.updateImage(u);}(t,n,a,o,i,{moveHandler:s,moveEndHandler:e},r);};fe[i].forEach(function(e){r.addEventListener(e,s);}),pe[i].forEach(function(e){r.addEventListener(e,l);}),r.addEventListener(x.TOUCH_START,xe);};function xe(e){return e.stopImmediatePropagation(),!1}var Te=function(e,t,n,a,o){n.active=!0,S.isToolLocked=!0,me(e.detail,t.name,n,a,t.options,o),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();},be=function(e,t,n,a){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",i=0;i<t.data.length;i++){var r=t.data[i],s=oe(e,r.handles,a,"mouse"===o?S.clickProximity:S.touchProximity);if(s)return {handle:s,data:r}}},Ee=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=Object.assign({},{doneMovingCallback:function(){n.active=!1,S.isToolLocked=!1;}},t.options);n.active=!0,S.isToolLocked=!0,de(e.detail,t.name,n,null,o,a),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();},Me=function(e){function t(e){var n=e.name,a=e.strategies,i=e.defaultStrategy,r=e.configuration,s=e.supportedInteractionTypes,c=e.mixins;return o()(this,t),l()(this,u()(t).call(this,{name:n,strategies:a,defaultStrategy:i,configuration:r,supportedInteractionTypes:s,mixins:c}))}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=Q(n,this.name),i=!1,r=0;r<o.data.length;r++){var s=o.data[r];!0===ie(n,s.handles,a)&&(i=!0);var l=this.pointNearTool(n,s,a)&&!s.active,c=!this.pointNearTool(n,s,a)&&s.active;(l||c)&&(s.active=!s.active,i=!0);}return i}},{key:"handleSelectedCallback",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";Te(e,this,t,n,a);}},{key:"toolSelectedCallback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";Ee(e,this,t,n);}}]),t}(Y),Ce=1,we=2;var Ie={setToolWidth:function(e){Ce=e;},getToolWidth:function(){return Ce},setActiveWidth:function(e){we=e;},getActiveWidth:function(){return we}},Se="white",ke="greenyellow",Pe="transparent";var _e={setFillColor:function(e){Pe=e;},getFillColor:function(){return Pe},setToolColor:function(e){Se=e;},getToolColor:function(){return Se},setActiveColor:function(e){ke=e;},getActiveColor:function(){return ke},getColorIfActive:function(e){return e.color?e.color:e.active?ke:Se}},Oe=function(e,t){e.save(),t(e),e.restore();},De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=t.color,o=t.lineWidth,i=t.fillStyle,r=t.lineDash;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=o||void 0===o&&Ie.getToolWidth()||e.lineWidth,r&&e.setLineDash(r),n(e),i&&(e.fillStyle=i,e.fill()),e.stroke(),r&&e.setLineDash([]);};function Le(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";De(e,o,function(e){"pixel"===i&&(n=f.cornerstone.pixelToCanvas(t,n),a=f.cornerstone.pixelToCanvas(t,a)),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y);});}var Ae=function(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";De(e,o,function(e){"pixel"===i&&(n=f.cornerstone.pixelToCanvas(t,n),a=a.map(function(e){return f.cornerstone.pixelToCanvas(t,e)})),e.moveTo(n.x,n.y),a.forEach(function(t){var n=t.x,a=t.y;e.lineTo(n,a);});});},He=function(e,t,n,a,o){var i=Math.atan2(n.y-t.y,n.x-t.x),r={color:a,lineWidth:o};Le(e,void 0,t,n,r,"canvas"),r={color:a,lineWidth:o,fillStyle:a};var s=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];Ae(e,void 0,n,s,r,"canvas");},Re=function(e,t,n,a,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=f.cornerstone.pixelToCanvas(t,n)),De(e,o,function(e){e.arc(n.x,n.y,a,0,2*Math.PI);});},Ue=function(e,t,n,a,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=f.cornerstone.pixelToCanvas(t,n),a=f.cornerstone.pixelToCanvas(t,a));var i=Math.min(n.x,a.x),r=Math.min(n.y,a.y),s=Math.abs(n.x-a.x),l=Math.abs(n.y-a.y),c=s/2*.5522848,u=l/2*.5522848,d=i+s,h=r+l,v=i+s/2,g=r+l/2;De(e,o,function(e){e.moveTo(i,g),e.bezierCurveTo(i,g-u,v-c,r,v,r),e.bezierCurveTo(v+c,r,d,g-u,d,g),e.bezierCurveTo(d,g+u,v+c,h,v,h),e.bezierCurveTo(v-c,h,i,g+u,i,g),e.closePath();});},Ne=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=t.element,i=_e.getToolColor();e.strokeStyle=a.color||i;for(var r=Object.keys(n),s=function(t){var i=r[t],s=n[i];if(!0===s.drawnIndependently)return "continue";if(!0===a.drawHandlesIfActive&&!s.active)return "continue";var l=s.active?Ie.getActiveWidth():Ie.getToolWidth(),c=a.fill;De(e,{lineWidth:l,fillStyle:c},function(e){var t=f.cornerstone.pixelToCanvas(o,s),n=s.radius||a.handleRadius||S.handleRadius;e.arc(t.x,t.y,n,0,2*Math.PI);});},l=0;l<r.length;l++)s(l);},Be=function(e,t,n,a,o,i){var r=e.length>0?f.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Le(a,void 0,r,f.cornerstoneMath.point.findClosestPoint(s,r),{color:o,lineWidth:i,lineDash:[2,3]},"canvas");},Fe=15,Ve="".concat(Fe,"px Arial"),je="transparent";var ze={setFont:function(e){Ve=e;},getFont:function(){return Ve},setFontSize:function(e){Fe=e;},getFontSize:function(){return Fe},setBackgroundColor:function(e){je=e;},getBackgroundColor:function(){return je}},We=function(e,t,n,a,o){var i=ze.getFontSize();e.font=ze.getFont(),e.textBaseline="top",e.fillStyle=a,n.forEach(function(n,a){e.fillText(n,t.left+o,t.top+o+a*(i+o));});},Ge=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height);};function qe(e,t,n){var a=ze.getFont(),o=e.font;a&&a!==o&&(e.font=a);var i=e.measureText(t).width;return a&&a!==o&&(e.font=o),i+2*n}var Ye=function(e,t,n,a,o,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var r=ze.getFontSize(),s=ze.getBackgroundColor(),l=0;t.forEach(function(t){var n=qe(e,t,5);l=Math.max(l,n);});var c={width:l,height:5+t.length*(r+5)};return Oe(e,function(e){e.strokeStyle=o,i&&i.centering&&!0===i.centering.x&&(n-=c.width/2),i&&i.centering&&!0===i.centering.y&&(a-=c.height/2),c.left=n,c.top=a;var r=i&&!0===i.debug?"#FF0000":s;Ge(e,c,r),We(e,c,t,o,5);}),c},Xe=function(e,t,n,a,o,i,r,s,l,c){var u=f.cornerstone,d=u.pixelToCanvas(t,n);l&&(d.x+=l);var h={centering:{x:!1,y:c}};if(n.boundingBox=Ye(e,a,d.x,d.y,r,h),n.hasMoved){var v=i(o).map(function(e){return u.pixelToCanvas(t,e)});Be(v,d,n.boundingBox,e,r,s);}},Ke=function(e,t,n,a,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=f.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a);}var r=Math.min(n.x,a.x),s=Math.min(n.y,a.y),l=Math.abs(n.x-a.x),c=Math.abs(n.y-a.y);De(e,o,function(e){e.rect(r,s,l,c);});},Ze=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},Je=function(e,t){return void 0===e?t:e},Qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Je(t.shadowColor,"#000000"),e.shadowBlur=Je(t.shadowBlur,0),e.shadowOffsetX=Je(t.shadowOffsetX,1),e.shadowOffsetY=Je(t.shadowOffsetY,1));},$e=function(e,t,n){if(n.vflip||n.vflip||n.rotation){var a={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(a.x,a.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-a.x,-a.y);}},et=function(e){e.setTransform(1,0,0,1,0,0);},tt=function(e,t,n,a){var o=f.cornerstone,i={start:o.pixelToCanvas(e,t),end:o.pixelToCanvas(e,n)};return f.cornerstoneMath.lineSegment.distanceToPoint(i,a)},nt=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n};function at(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}var ot=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Angle",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.preventNewMeasurement=!1,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){return {visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return !1!==t.visible&&(tt(e,t.handles.start,t.handles.middle,n)<25||tt(e,t.handles.middle,t.handles.end,n)<25)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.enabledElement,o=this.configuration,i=o.handleRadius,r=o.drawHandlesOnHover,s=Q(e.currentTarget,this.name);if(s)for(var l=Ze(n.canvasContext.canvas),c=Ie.getToolWidth(),u=function(e){var o=s.data[e];if(!1===o.visible)return "continue";Oe(l,function(e){Qe(e,t.configuration);var s=_e.getColorIfActive(o),l=f.cornerstone.pixelToCanvas(n.element,o.handles.start),u=f.cornerstone.pixelToCanvas(n.element,o.handles.middle);Ae(e,n.element,o.handles.start,[o.handles.middle,o.handles.end],{color:s});var d={color:s,handleRadius:i,drawHandlesIfActive:r};Ne(e,n,o.handles,d);var v=n.image.columnPixelSpacing||1,g=n.image.rowPixelSpacing||1,m={x:(o.handles.middle.x-o.handles.start.x)*v,y:(o.handles.middle.y-o.handles.start.y)*g},p={x:(o.handles.end.x-o.handles.middle.x)*v,y:(o.handles.end.y-o.handles.middle.y)*g},y={x:(o.handles.end.x-o.handles.start.x)*v,y:(o.handles.end.y-o.handles.start.y)*g},x=at(m),T=at(p),b=at(y),E=Math.acos((Math.pow(x,2)+Math.pow(T,2)-Math.pow(b,2))/(2*x*T));if(E*=180/Math.PI,o.rAngle=nt(E,2),o.rAngle){var M,C=function(e,t,n){var a=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+a}(o,n.image.rowPixelSpacing,n.image.columnPixelSpacing);if(!o.handles.textBox.hasMoved){M={x:u.x,y:u.y};var w=qe(e,C,5);u.x<l.x?M.x-=15+w+10:M.x+=15;var I=f.cornerstone.internal.getTransform(a);I.invert();var S=I.transformPoint(M.x,M.y);o.handles.textBox.x=S.x,o.handles.textBox.y=S.y;}Xe(e,n.element,o.handles.textBox,C,o.handles,h,s,c,0,!0);}});},d=0;d<s.data.length;d++)u(d);function h(e){return [e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var a=e.detail,o=this.createNewMeasurement(a),i=e.detail.element;J(i,this.name,o),f.cornerstone.updateImage(i);var r=Object.assign({},{doneMovingCallback:function(){o.active=!1,n.preventNewMeasurement=!1,f.cornerstone.updateImage(i);}},this.options),s=Object.assign({},{doneMovingCallback:function(){o.active=!1,o.handles.end.active=!0,f.cornerstone.updateImage(i),ye(a,n.name,o,o.handles.end,r,t);}},this.options);ye(a,this.name,o,o.handles.middle,s,t);}}}]),t}(Me),it=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:rt,changeTextCallback:st,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e.preventNewMeasurement=!1,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){return {visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return !1!==t.visible&&tt(e,t.handles.start,t.handles.end,n)<25}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,o=n.enabledElement,i=this.configuration,r=i.handleRadius,s=i.drawHandlesOnHover,l=Q(a,this.name);if(l)for(var c=e.detail.canvasContext.canvas,u=Ze(c),d=Ie.getToolWidth(),h=function(n){var i=l.data[n];if(!1===i.visible)return "continue";Oe(u,function(n){Qe(n,t.configuration);var l=_e.getColorIfActive(i),c=f.cornerstone.pixelToCanvas(a,i.handles.start),u=f.cornerstone.pixelToCanvas(a,i.handles.end);t.configuration.arrowFirst?He(n,u,c,l,d):He(n,c,u,l,d);var h={color:l,handleRadius:r,drawHandlesIfActive:s};t.configuration.drawHandles&&Ne(n,e.detail,i.handles,h);var v=function(e){return e.text}(i);if(v&&""!==v){var m=qe(n,v,5),p=ze.getFontSize()+10,y=Math.max(m,p)/2+5;if(u.x<c.x&&(y=-y),!i.handles.textBox.hasMoved){var x;x=t.configuration.arrowFirst?{x:u.x-m/2+y,y:u.y-p/2}:{x:c.x-m/2-y,y:c.y-p/2};var T=f.cornerstone.internal.getTransform(o);T.invert();var b=T.transformPoint(x.x,x.y);i.handles.textBox.x=b.x,i.handles.textBox.y=b.y;}Xe(n,a,i.handles.textBox,v,i.handles,g,l,d,0,!1);}});},v=0;v<l.data.length;v++)h(v);function g(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return [e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,a=e.detail.element,o=this.createNewMeasurement(e);J(a,this.name,o),f.cornerstone.updateImage(a);var i=Object.assign({},{doneMovingCallback:function(){void 0===o.text&&n.configuration.getTextCallback(function(e){e?o.text=e:$(a,n.name,o),o.active=!1,f.cornerstone.updateImage(a);}),f.cornerstone.updateImage(a);}},this.options);ye(e.detail,this.name,o,o.handles.end,i,t);}},{key:"doubleClickCallback",value:function(e){if(Array.isArray(this.options.mouseButtonMask)&&this.options.mouseButtonMask.includes(e.detail.buttons))return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,a=Q(t,this.name);if(!a)return !1;for(var o=0;o<a.data.length;o++){var i=a.data[o];if(this.pointNearTool(t,i,n)||ne(i.handles.textBox,n))return i.active=!0,f.cornerstone.updateImage(t),this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,t,i)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,a){!0===a?$(e,this.name,t):t.text=n,t.active=!1,f.cornerstone.updateImage(e);}}]),t}(Me);function rt(e){e(prompt("Enter your annotation:"));}function st(e,t,n){n(prompt("Change your annotation:"));}var lt,ct=n(0),ut=n.n(ct),dt=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},a)},ht=function(e){var t=e.currentPoints.image,n=t.x,a=t.y;return {toolType:this.name,isCreating:!0,visible:!0,active:!0,handles:{start:dt(n,a,0),end:dt(n,a,1,{active:!0}),perpendicularStart:dt(n,a,2,{locked:!0}),perpendicularEnd:dt(n,a,3),textBox:dt(n-50,a-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},vt=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=f.cornerstone,i=f.cornerstoneMath,r=t.handles,s={start:o.pixelToCanvas(e,r.start),end:o.pixelToCanvas(e,r.end)},l=i.lineSegment.distanceToPoint(s,n);if(ne(r.textBox,n))return !0;var c="mouse"===a?S.clickProximity:S.touchProximity;return !!function(e,t,n,a){var o=f.cornerstone,i=f.cornerstoneMath,r={start:o.pixelToCanvas(e,t.perpendicularStart),end:o.pixelToCanvas(e,t.perpendicularEnd)};return i.lineSegment.distanceToPoint(r,n)<a}(e,r,n,c)||l<c},gt=function(e){var t=this,n=e.detail,a=n.element,o=n.canvasContext,i=n.image,r=this.configuration,s=r.handleRadius,l=r.drawHandlesOnHover,c=Q(a,this.name);if(c){var u=f.cornerstone.metaData.get("imagePlaneModule",i.imageId),d=i.rowPixelSpacing,h=i.columnPixelSpacing;if(u&&(d=u.rowPixelSpacing||u.rowImagePixelSpacing,h=u.columnPixelSpacing||u.colImagePixelSpacing),d&&h)for(var v,g=Ze(o.canvas),m=_e.getActiveColor(),p=Ie.getToolWidth(),y=function(e){var o=c.data[e];if(!1===o.visible)return "continue";v=o.active?m:_e.getToolColor(),mt(o,d,h),Oe(g,function(e){Qe(e,t.configuration);var i=o.handles,r=i.start,c=i.end,u=i.perpendicularStart,g=i.perpendicularEnd,m=i.textBox;Le(e,a,r,c,{color:v});var f=p;!function(e,t){if(t.handles.perpendicularStart.locked){var n,a,o,i,r=t.handles,s=r.start,l=r.end;if(s.x===l.x&&s.y===l.y)n=s.x,a=s.y,o=l.x,i=l.y;else{var c={x:(s.x+l.x)/2,y:(s.y+l.y)/2},u=(s.x-l.x)*(e.image.columnPixelSpacing||1),d=(s.y-l.y)*(e.image.rowPixelSpacing||1),h=Math.sqrt(u*u+d*d),v=(s.x-l.x)/h,g=(s.y-l.y)/h,m=h/2;n=c.x+m/2*g,a=c.y-m/2*v,o=c.x-m/2*g,i=c.y+m/2*v;}t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=a,t.handles.perpendicularEnd.x=o,t.handles.perpendicularEnd.y=i;}}(n,o),Le(e,a,u,g,{color:v,strokeWidth:f});var y={color:v,handleRadius:s,drawHandlesIfActive:l};Ne(e,n,o.handles,y);var x=ft(o,d,h);o.additionalData&&Array.isArray(o.additionalData)&&(x=o.additionalData.concat(x)),Xe(e,a,m,x,o.handles,function(e){return [e.start,e.end,e.perpendicularStart,e.perpendicularEnd]},v,p,10,!0);});},x=0;x<c.data.length;x++)y(x);}},mt=function(e,t,n){var a=e.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=(o.x-i.x)*(n||1),c=(o.y-i.y)*(t||1),u=Math.sqrt(l*l+c*c),d=(r.x-s.x)*(n||1),h=(r.y-s.y)*(t||1),v=Math.sqrt(d*d+h*h);if(v||(v=0),v>u){var g=u;u=v,v=g;}e.longestDiameter=u.toFixed(1),e.shortestDiameter=v.toFixed(1);},ft=function(e,t,n){var a=" mm";return t&&n||(a=" pixels"),[" L ".concat(e.longestDiameter).concat(a)," W ".concat(e.shortestDiameter).concat(a)]},pt=function(e,t){var n=this,a=e.detail,o=a.element,i=a.image,r=this.configuration;if(!yt(i)){var s=this.createNewMeasurement(a),l=function(){s.active=!1,f.cornerstone.updateImage(o);};J(o,this.name,s),f.cornerstone.updateImage(o);var c=(new Date).getTime(),u=s.handles,d=u.end,h=u.perpendicularStart;ye(a,this.name,s,d,{doneMovingCallback:function(){var e=s.handles,t=s.longestDiameter,i=s.shortestDiameter,u=re(a,e),d=parseFloat(t)||0,v=parseFloat(i)||0,g=d<1||v<1,m=(new Date).getTime()-c<150;u||g||m?(s.cancelled=!0,$(o,n.name,s)):r.getMeasurementLocationCallback(s,a,l),h.locked=!1,f.cornerstone.updateImage(o);}},t);}},yt=function(e){var t=f.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,a=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,a=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!a};var xt={setCoords:function(e){lt=e.currentPoints.canvas;},getCoords:function(){return lt}},Tt=function(e){var t=this,n=e.detail,a=n.element;xt.setCoords(n);var o=Q(a,this.name);if(o){for(var i=!1,r=function(e){var r=n.currentPoints.canvas,s=o.data[e],l=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=oe(e,t,n,a),i=!1;return Object.keys(t).forEach(function(e){if("textBox"!==e){var n=t[e],a=n===o;n.active!==a&&(i=!0),n.active=a;}}),i}(a,s.handles,r);Object.keys(s.handles).forEach(function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active;}}),l&&(i=!0);var c=t.pointNearTool(a,s,r,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,i=!0);},s=0;s<o.data.length;s++)r(s);!0===i&&f.cornerstone.updateImage(a);}},bt=function(e,t,n,a){var o,i,r,s,l={},c={},u={x:t.currentPoints.image.x+a.x,y:t.currentPoints.image.y+a.y};0===e.index?function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},c={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}},u=f.cornerstoneMath.lineSegment.intersectLine(l,c),d=n(r,u),h=n(s,u),v=n(i,u),g=n(i,e);if(g<=v)return !1;var m=(i.x-e.x)/g,p=(i.y-e.y)/g,y=v/g,x=i.x+(e.x-i.x)*y,T=i.y+(e.y-i.y)*y;return r.x=x-d*p,r.y=T+d*m,s.x=x+h*p,s.y=T-h*m,!0}(u,n)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},c={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}},u=f.cornerstoneMath.lineSegment.intersectLine(l,c),d=n(r,u),h=n(s,u),v=n(o,u),g=n(o,e);if(g<=v)return !1;var m=(o.x-e.x)/g,p=(o.y-e.y)/g,y=v/g,x=o.x+(e.x-o.x)*y,T=o.y+(e.y-o.y)*y;return r.x=x+d*p,r.y=T-d*m,s.x=x-h*p,s.y=T+h*m,!0}(u,n)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(i=f.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},i=f.cornerstoneMath.lineSegment.intersectLine(l,c),r=f.cornerstoneMath.point.distance(i,n.handles.start),s=f.cornerstoneMath.point.distance(i,n.handles.end),(!i||r<3||s<3)&&(o=!0)),o||function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=s,c=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,l),u=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,e),d=c+u;if(n(l,e)<=c)return !1;var h=n(o,i);if(0===h)return !1;var v=(o.x-i.x)/h,g=(o.y-i.y)/h,m=o.x-1*v,p=o.y-1*g,y=i.x+1*v,x=i.y+1*g;r.x=e.x,r.y=e.y,s.x=e.x-d*g,s.y=e.y+d*v;var T={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},b={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}};return f.cornerstoneMath.lineSegment.intersectLine(T,b)||(n(e,o)>n(e,i)?(r.x=y+u*g,r.y=x-u*v,s.x=r.x-d*g,s.y=r.y+d*v):(r.x=m+u*g,r.y=p-u*v,s.x=r.x-d*g,s.y=r.y+d*v)),!0}(u,n)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(i=f.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},i=f.cornerstoneMath.lineSegment.intersectLine(l,c),r=f.cornerstoneMath.point.distance(i,n.handles.start),s=f.cornerstoneMath.point.distance(i,n.handles.end),(!i||r<3||s<3)&&(o=!0)),o||function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=r,c=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,l),u=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,e),d=c+u;if(n(l,e)<=c)return !1;var h=n(o,i),v=(o.x-i.x)/h,g=(o.y-i.y)/h,m=o.x-1*v,p=o.y-1*g,y=i.x+1*v,x=i.y+1*g;r.x=e.x+d*g,r.y=e.y-d*v,s.x=e.x,s.y=e.y,s.locked=!1,r.locked=!1;var T={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},b={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}};return f.cornerstoneMath.lineSegment.intersectLine(T,b)||(n(e,o)>n(e,i)?(s.x=y-u*g,s.y=x+u*v,r.x=s.x+d*g,r.y=s.y-d*v):(s.x=m-u*g,s.y=p+u*v,r.x=s.x+d*g,r.y=s.y-d*v)),!0}(u,n)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y));},Et=function(e,t,n){var a=e[n],o=t[n];e[n]=o,t[n]=a;},Mt=function(e,t){Et(e,t,"x"),Et(e,t,"y"),Et(e,t,"moving"),Et(e,t,"hover"),Et(e,t,"active"),Et(e,t,"selected");};var Ct=function(e){var t,n=this,a=e.detail,o=a.element,i=S.clickProximity,r=function(e){t.invalidated=!0,re(a,t.handles)&&$(o,n.name,t),e&&(e.moving=!1,e.selected=!0),o.style.cursor="",f.cornerstone.updateImage(o),o.addEventListener(x.MOUSE_MOVE,n._moveCallback),o.addEventListener(x.TOUCH_START,n._moveCallback);},s=a.startPoints.canvas,l=Q(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,i],d=oe.apply(void 0,u);if(d)return o.removeEventListener(x.MOUSE_MOVE,n._moveCallback),o.removeEventListener(x.TOUCH_START,n._moveCallback),t.active=!0,wt(t.handles),d.moving=!0,d=function(e,t,n){var a=e.image,o=a.rowPixelSpacing,i=a.columnPixelSpacing,r=t.handles,s=r.start,l=r.end,c=r.perpendicularStart,u=r.perpendicularEnd,d=(s.x-l.x)*(i||1),h=(s.y-l.y)*(o||1),v=Math.sqrt(d*d+h*h),g=(c.x-u.x)*(i||1),m=(c.y-u.y)*(o||1);return (Math.sqrt(g*g+m*m)||0)>v?(Mt(s,l),Mt(s,c),Mt(l,u),Object.values(r).find(function(e){return !0===e.moving})):n}(a,t,d),o.style.cursor=d.hasBoundingBox?"move":"none",function(e,t,n,a,o,i){var r=e.element,s={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},l=function(e){var o=e.detail;a.active=!0,a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=o.currentPoints.image.x+s.x,a.y=o.currentPoints.image.y+s.y):bt(a,o,n,s),i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),f.cornerstone.updateImage(r);var l={toolType:t,element:r,measurementData:n};f.cornerstone.triggerEvent(r,x.MEASUREMENT_MODIFIED,l);};r.addEventListener(x.MOUSE_DRAG,l),r.addEventListener(x.TOUCH_DRAG,l);var c=f.cornerstone.getImage(r),u=function(){f.cornerstone.getImage(r).imageId!==c.imageId&&d();};r.addEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,u);var d=function e(){r.removeEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,u),r.removeEventListener(x.MOUSE_DRAG,l),r.removeEventListener(x.MOUSE_UP,e),r.removeEventListener(x.MOUSE_CLICK,e),r.removeEventListener(x.TOUCH_DRAG,l),r.removeEventListener(x.TOUCH_DRAG_END,e),r.removeEventListener(x.TAP,e),f.cornerstone.updateImage(r),"function"==typeof o&&o();};r.addEventListener(x.MOUSE_UP,d),r.addEventListener(x.MOUSE_CLICK,d),r.addEventListener(x.TOUCH_DRAG_END,d),r.addEventListener(x.TAP,d);}(a,n.name,t,d,function(){return r(d)}),St(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===y()(d))return d.v}var h=function(e){return function(){It(e,!1),r();}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"mouse")){o.removeEventListener(x.MOUSE_MOVE,this._moveCallback),o.removeEventListener(x.TOUCH_START,this._moveCallback),t.active=!0,wt(t.handles),It(t.handles,!0);var v=h(t.handles);return de(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,doneMovingCallback:v},"mouse"),St(e),!0}}},wt=function(e){var t=!1;return Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1);}),t},It=function(e,t){Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].moving=t);});},St=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();},kt=[x.TOUCH_END,x.TOUCH_DRAG_END,x.TOUCH_PINCH,x.TOUCH_PRESS,x.TAP],Pt=function(e){var t,n=this,a=e.detail,o=a.element,i=S.touchProximity,r=function(e){t.invalidated=!0,re(a,t.handles)&&$(o,n.name,t),e&&(e.moving=!1,e.selected=!0),f.cornerstone.updateImage(o),o.addEventListener(x.TOUCH_DRAG,n._moveCallback);},s=a.startPoints.canvas,l=Q(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,i],d=oe.apply(void 0,u);if(d)return o.removeEventListener(x.TOUCH_DRAG,n._moveCallback),t.active=!0,_t(t.handles),d.moving=!0,function(e,t,n,a,o,i){var r=e.element,s={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},l=function(e){var o=e.detail;a.active=!0,a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=o.currentPoints.image.x+s.x,a.y=o.currentPoints.image.y+s.y):bt(a,o,n,s),i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),f.cornerstone.updateImage(r);var l=x.MEASUREMENT_MODIFIED,c={toolType:t,element:r,measurementData:n};f.cornerstone.triggerEvent(r,l,c);};r.addEventListener(x.TOUCH_DRAG,l);var c=function e(){r.removeEventListener(x.TOUCH_DRAG,l),kt.forEach(function(t){r.removeEventListener(t,e);}),f.cornerstone.updateImage(r),"function"==typeof o&&o();};kt.forEach(function(e){r.addEventListener(e,c);});}(a,n.name,t,d,function(){return r(d)}),Dt(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===y()(d))return d.v}var h=function(e){return function(){Ot(e,!1),r();}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"touch")){o.removeEventListener(x.TOUCH_DRAG,this._moveCallback),t.active=!0,_t(t.handles),Ot(t.handles,!0);var v=h(t.handles);return de(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,doneMovingCallback:v},"touch"),Dt(e),!0}}},_t=function(e){var t=!1;return Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1);}),t},Ot=function(e,t){Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].moving=t);});},Dt=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();},Lt=function(e,t,n){return n()},At=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Lt,getMeasurementLocationCallback:Lt,textBox:"",shadow:"",drawHandlesOnHover:!0,additionalData:[]}},i=Object.assign(a.configuration,n),r=Object.assign(a,{configuration:i});return (e=l()(this,u()(t).call(this,r))).createNewMeasurement=ht.bind(ut()(ut()(e))),e.pointNearTool=vt.bind(ut()(ut()(e))),e.renderToolData=gt.bind(ut()(ut()(e))),e.addNewMeasurement=pt.bind(ut()(ut()(e))),e._moveCallback=Tt.bind(ut()(ut()(e))),e.preMouseDownCallback=Ct.bind(ut()(ut()(e))),e.preTouchStartCallback=Pt.bind(ut()(ut()(e))),e}return h()(t,e),t}(Me),Ht=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.hasIncomplete=!1,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return !1!==t.visible&&(!this.hasIncomplete&&(tt(e,t.handles.start,t.handles.end,n)<25||tt(e,t.handles.start2,t.handles.end2,n)<25))}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,o=a.handleRadius,i=a.drawHandlesOnHover,r=Q(e.currentTarget,this.name);if(r)for(var s=Ze(n.canvasContext.canvas),l=Ie.getToolWidth(),c=ze.getFont(),u=function(e){var a=r.data[e];if(!1===a.visible)return "continue";Oe(s,function(e){Qe(e,t.configuration);var r=_e.getColorIfActive(a);Le(e,n.element,a.handles.start,a.handles.end,{color:r}),a.complete&&Le(e,n.element,a.handles.start2,a.handles.end2,{color:r});var s={color:r,handleRadius:o,drawHandlesIfActive:i};Ne(e,n,a.handles,s),e.fillStyle=r;var u=a.value;if(!a.handles.textBox.hasMoved){var d={x:(a.handles.start.x+a.handles.end.x)/2,y:(a.handles.start.y+a.handles.end.y)/2-10};e.font=c,a.handles.textBox.x=d.x,a.handles.textBox.y=d.y;}Xe(e,n.element,a.handles.textBox,u,a.handles,h,r,l,0,!0);});},d=0;d<r.data.length;d++)u(d);function h(e){return [e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=Q(e,this.name);if(void 0!==t)for(var n=0;n<t.data.length;n++)if(!1===t.data[n].complete)return t.data[n]}},{key:"addNewMeasurement",value:function(e,t){e.preventDefault(),e.stopPropagation();var n,a,o=e.detail,i=e.detail.element,r=this.getIncomplete(i);r?((n=r).complete=!0,n.handles.start2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},n.handles.end2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},a=n.handles.end2,this.hasIncomplete=!1):(n=this.createNewMeasurement(o),J(i,this.name,n),a=n.handles.end),f.cornerstone.updateImage(i),ye(o,this.name,n,a,this.options,t);}},{key:"onMeasureModified",value:function(e){var t=f.cornerstone.getEnabledElement(e.detail.element).image;if(e.detail.toolType===this.name){var n=e.detail.measurementData;n.value=function(e,t){var n=t.columnPixelSpacing||1,a=t.rowPixelSpacing||1,o=(Math.ceil(e.handles.start.x)-Math.ceil(e.handles.end.x))*n,i=(Math.ceil(e.handles.start.y)-Math.ceil(e.handles.end.y))*a,r=(Math.ceil(e.handles.start2.x)-Math.ceil(e.handles.end2.x))*n,s=(Math.ceil(e.handles.start2.y)-Math.ceil(e.handles.end2.y))*a,l=Math.acos(Math.abs((o*r+i*s)/(Math.sqrt(o*o+i*i)*Math.sqrt(r*r+s*s))));l*=180/Math.PI;var c=nt(l,2);if(!Number.isNaN(e.rAngle))return function(e,t,n){var a=t&&n?"":" (isotropic)";return e.toString()+String.fromCharCode(parseInt("00B0",16))+a}(c,t.rowPixelSpacing,t.columnPixelSpacing);return ""}(n,t);}}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified);}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified);}},{key:"enabledCallback",value:function(e){e.removeEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified);}},{key:"disabledCallback",value:function(e){e.removeEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified);}}]),t}(Me),Rt=function(e,t){var n=f.cornerstone,a=n.metaData.get("patientStudyModule",e.imageId),o=n.metaData.get("generalSeriesModule",e.imageId);if(a&&o&&"PT"===o.modality){var i=t*e.slope+e.intercept,r=a.patientWeight;if(r){var s=n.metaData.get("petIsotopeModule",e.imageId);if(s){var l=s.radiopharmaceuticalInfo,c=l.radiopharmaceuticalStartTime,u=l.radionuclideTotalDose,d=l.radionuclideHalfLife,h=o.seriesTime;if(c&&u&&d&&h){var v=Ut(h.fractionalSeconds||0)+h.seconds+60*h.minutes+60*h.hours*60-(Ut(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60);return i*r/(u*Math.exp(-v*Math.log(2)/d))*1e3}}}}};function Ut(e){return parseFloat(".".concat(e))}var Nt=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},Bt=function(e,t){var n=e.width/2,a=e.height/2;if(n<=0||a<=0)return !1;var o=e.left+n,i=e.top+a,r=t.x-o,s=t.y-i;return r*r/(n*n)+s*s/(a*a)<=1},Ft={calculateEllipseStatistics:function(e,t){for(var n=0,a=0,o=0,i=0,r=t.top;r<t.top+t.height;r++)for(var s=t.left;s<t.left+t.width;s++)Bt(t,{x:s,y:r})&&(n+=e[i],a+=e[i]*e[i],o++),i++;if(0===o)return {count:o,mean:0,variance:0,stdDev:0};var l=n/o,c=a/o-l*l;return {count:o,mean:l,variance:c,stdDev:Math.sqrt(c)}},pointInEllipse:Bt},Vt=Ft.pointInEllipse,jt=Ft.calculateEllipseStatistics,zt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return {visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return !1;var o=f.cornerstone.pixelToCanvas(e,t.handles.start),i=f.cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(o.x,i.x)+7.5,top:Math.min(o.y,i.y)+7.5,width:Math.abs(o.x-i.x)-15,height:Math.abs(o.y-i.y)-15},s={left:Math.min(o.x,i.x)-7.5,top:Math.min(o.y,i.y)-7.5,width:Math.abs(o.x-i.x)+15,height:Math.abs(o.y-i.y)+15},l=Vt(r,n);return !(!Vt(s,n)||l)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,o=a.handleRadius,i=a.drawHandlesOnHover,r=Q(e.currentTarget,this.name);if(r){var s,l=Ze(n.canvasContext.canvas),c=n.image,u=n.element,d=Ie.getToolWidth(),h=f.cornerstone.metaData.get("generalSeriesModule",c.imageId),v=f.cornerstone.metaData.get("imagePlaneModule",c.imageId),g=c.rowPixelSpacing,m=c.columnPixelSpacing;v&&(g=v.rowPixelSpacing||v.rowImagePixelSpacing,m=v.columnPixelSpacing||v.colImagePixelSpacing),h&&(s=h.modality);for(var p=function(e){var a=r.data[e];if(!1===a.visible)return "continue";Oe(l,function(e){Qe(e,t.configuration);var r=_e.getColorIfActive(a);Ue(e,u,a.handles.start,a.handles.end,{color:r});var l,h,v,p={color:r,handleRadius:o,drawHandlesIfActive:i};if(Ne(e,n,a.handles,p),!1===a.invalidated)h=a.meanStdDev,v=a.meanStdDevSUV,l=a.area;else{var y={left:Math.round(Math.min(a.handles.start.x,a.handles.end.x)),top:Math.round(Math.min(a.handles.start.y,a.handles.end.y)),width:Math.round(Math.abs(a.handles.start.x-a.handles.end.x)),height:Math.round(Math.abs(a.handles.start.y-a.handles.end.y))};if(!c.color){var T=f.cornerstone.getPixels(u,y.left,y.top,y.width,y.height);h=jt(T,y),"PT"===s&&(v={mean:Rt(c,(h.mean-c.intercept)/c.slope),stdDev:Rt(c,(h.stdDev-c.intercept)/c.slope)}),h&&!isNaN(h.mean)&&(a.meanStdDev=h,a.meanStdDevSUV=v);}l=Math.PI*(y.width*(m||1)/2)*(y.height*(g||1)/2),isNaN(l)||(a.area=l),a.invalidated=!1;}a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2);var b=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=[];if(t&&void 0!==t.mean){var i="";"CT"===s&&(i=" HU");var r="Mean: ".concat(Nt(t.mean.toFixed(2))).concat(i),l="StdDev: ".concat(Nt(t.stdDev.toFixed(2))).concat(i);if(n&&void 0!==n.mean){r+=" SUV: "+Nt(n.mean.toFixed(2)),l+=" SUV: "+Nt(n.stdDev.toFixed(2));}o.push(r),o.push(l);}if(a){var c=" mm".concat(String.fromCharCode(178));g&&m||(c=" pixels".concat(String.fromCharCode(178)));var u="Area: ".concat(Nt(a.toFixed(2))).concat(c);o.push(u);}return o}(a);Xe(e,u,a.handles.textBox,b,a.handles,x,r,d,0,!0);});},y=0;y<r.data.length;y++)p(y);}function x(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),o=Math.abs(e.start.y-e.end.y);return [{x:t+a/2,y:n},{x:t,y:n+o/2},{x:t+a/2,y:n+o},{x:t+a,y:n+o/2}]}}}]),t}(Me),Wt=n(9),Gt=n.n(Wt),qt=function(e,t){for(var n=!1,a=e.length-1,o=0;o<e.length;o++)Yt(t,e[o],e[a])&&(n=!n),a=o;return n};function Yt(e,t,n){return a=e.y,o=t.y,i=n.y,!(!(o<a&&a<i||i<a&&a<o)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return !0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var a=t;t=n,n=a;}var o=function(e,t,n){var a=(n.y-t.y)/(n.x-t.x);return {value:t.x+a*(e.x-t.x),gradient:a}}(e,t,n);return Math.sign(o.gradient)*e.y>o.value}(e,t,n));var a,o,i;}function Xt(e,t,n,a){qt(e,t)&&(n.value+=a,n.squared+=a*a,n.count++);}var Kt=function e(t,n){o()(this,e),this.toolIndex=t,this.handleIndexArray=n;},Zt=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];o()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=a,this.lines=[];};function Jt(e,t,n,a){for(var o=e.length-1,i=0;i<e.length;i++)if(-1===a.indexOf(i)&&-1===a.indexOf(o)){if(Qt(t,n,$t(e[o]),$t(e[i])))return !0;o=i;}else o=i;return !1}function Qt(e,t,n,a){var o=!1,i=[en(e,t,n),en(e,t,a),en(n,a,e),en(n,a,t)];return i[0]!==i[1]&&i[2]!==i[3]||(0===i[0]&&tn(e,n,t)?o=!0:0===i[1]&&tn(e,a,t)?o=!0:0===i[2]&&tn(n,e,a)?o=!0:0===i[3]&&tn(n,t,a)&&(o=!0),o)}function $t(e){return {x:e.x,y:e.y}}function en(e,t,n){var a=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===a?0:a>0?1:2}function tn(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var nn={newHandle:function(e,t){var n=t.length-1;return Jt(t,$t(t[n]),$t(e),[n])},end:function(e){var t=e.length-1;return Jt(e,$t(e[t]),$t(e[0]),[t,0])},modify:function(e,t){var n=$t(e[t]),a=t-1;0===t&&(a=e.length-1);var o=$t(e[a]);return !!Jt(e,n,o,[t,a])||Jt(e,n,o=$t(e[a=t===e.length-1?0:t+1]),[t,a])}},an=function(){function e(t){o()(this,e),this._eventData=t;}return r()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=Q(this._eventData.element,"FreehandMouse"),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var a=this._nearestHandleToPoint(n);null!==a&&(a.distance<t.distance&&(t=a));}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e];if(void 0===n.handles)return null;if(!1===n.visible)return null;for(var a={toolIndex:e,handleIndex:null,distance:1/0},o=0;o<n.handles.length;o++){var i=f.cornerstone.pixelToCanvas(t.element,n.handles[o]),r=f.cornerstoneMath.point.distance(i,this._mousePoint);r<a.distance&&(a.handleIndex=o,a.distance=r);}return a}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles,a=[],o=0;o<n.length;o++){var i=e.getNextHandleIndex(o,n.length);this._distanceOfPointfromLine(n[o],n[i])<10&&a.push([o,i]);}return a}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new Kt(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var a=this._eventData,o=this._toolData.data[t];if(void 0!==o.handles){if(!1===o.visible)return !1;var i=o.handles[n[0]],r=o.handles[n[1]],s=e.getCanvasPointsFromHandles(i,r,a.element),l=e.getLineAsVector(s),c=this._getLineOriginToMouseAsVector(s),u=(c[0]*l[0]+c[1]*l[1])/l.magnitude;return u>0&&u<l.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return [this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,a=f.cornerstone.pixelToCanvas(n.element,e),o=f.cornerstone.pixelToCanvas(n.element,t),i=this._mousePoint;return Math.abs((o.y-a.y)*i.x-(o.x-a.x)*i.y+o.x*a.y-o.y*a.x)/f.cornerstoneMath.point.distance(a,o)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var a=[];return e.x<t.x?(a.push(f.cornerstone.pixelToCanvas(n,e)),a.push(f.cornerstone.pixelToCanvas(n,t))):(a.push(f.cornerstone.pixelToCanvas(n,t)),a.push(f.cornerstone.pixelToCanvas(n,e))),a}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=f.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),on="FreehandMouse";var rn={calculateFreehandStatistics:function(e,t,n){var a={count:0,mean:0,variance:0,stdDev:0},o=function(e,t,n){for(var a={value:0,squared:0,count:0},o=0,i=t.top;i<t.top+t.height;i++)for(var r=t.left;r<t.left+t.width;r++){var s={x:r,y:i};Xt(n,s,a,e[o]),o++;}return a}(e,t,n);return 0===o.count?a:(a.count=o.count,a.mean=o.value/o.count,a.variance=o.squared/o.count-a.mean*a.mean,a.stdDev=Math.sqrt(a.variance),a)},ClickedLineData:Kt,freehandArea:function(e,t){var n=0,a=e.length-1;t=t||1;for(var o=0;o<e.length;o++)n+=(e[a].x+e[o].x)*(e[a].y-e[o].y),a=o;return Math.abs(n*t/2)},FreehandHandleData:Zt,freehandIntersect:nn,FreehandLineFinder:an,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby)!function(e,t){var n=Q(e.element,on);if(void 0!==n){var a=t.handleIndex,o=t.toolIndex,i=n.data[o];i.handles.length<=3||(a===i.handles.length-1?(i.handles[a-1].lines.pop(),i.handles[a-1].lines.push(i.handles[0])):0===a?(i.handles[i.handles.length-1].lines.pop(),i.handles[i.handles.length-1].lines.push(i.handles[a+1])):(i.handles[a-1].lines.pop(),i.handles[a-1].lines.push(i.handles[a+1])),i.handles.splice(a,1),i.invalidated=!0,i.active=!0,i.highlight=!0,f.cornerstone.updateImage(e.element));}}(n,{toolIndex:t.toolIndex,handleIndex:t.handleNearby});else{var a=new an(n).findLine();a&&function(e,t){var n=Q(e.element,on);if(void 0!==n){var a=n.data[t.toolIndex],o=function(e){for(var t=e.handleIndexArray,n=1/0,a=t.includes(0),o=0;o<t.length;o++){var i=t[o];0!==i&&i<n&&(n=i);}return a&&1===n&&(n=0),++n}(t);if(o!==1/0){var i=new Zt(e.currentPoints.image);a.handles.splice(o,0,i),a.handles[o-1].lines.pop(),a.handles[o-1].lines.push(e.currentPoints.image),o===a.handles.length-1?a.handles[o].lines.push(a.handles[0]):a.handles[o].lines.push(a.handles[o+1]),a.active=!0,a.highlight=!0,a.invalidated=!0,f.cornerstone.updateImage(e.element);}}}(n,a);}},pointInFreehand:qt},sn=rn.insertOrDelete,ln=rn.freehandArea,cn=rn.calculateFreehandStatistics,un=rn.freehandIntersect,dn=rn.FreehandHandleData,hn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"FreehandMouse",supportedInteractionTypes:["Mouse"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:5,activeHandleRadius:3,completeHandleRadius:6,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(ut()(ut()(e))),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(ut()(ut()(e))),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(ut()(ut()(e))),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(ut()(ut()(e))),e._editMouseUpCallback=e._editMouseUpCallback.bind(ut()(ut()(e))),e._editMouseDragCallback=e._editMouseDragCallback.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:[]};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles;if(!a)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return !(!a||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var a=1/0,o=0;o<t.handles.length;o++){var i=f.cornerstoneMath.point.distance(t.handles[o],n);a=Math.min(a,i);}return a===1/0?-1:a}},{key:"distanceFromPointCanvas",value:function(e,t,n){for(var a=1/0,o=f.cornerstone.pixelToCanvas(e,n),i=t.handles,r=0;r<i.length;r++){var s=f.cornerstone.pixelToCanvas(e,i[r]),l=f.cornerstoneMath.point.distance(s,o);a=Math.min(a,l);}return a===1/0?-1:a}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=Q(e.currentTarget,this.name);if(a){var o,i=n.image,r=n.element,s=this.configuration,l=f.cornerstone.metaData.get("generalSeriesModule",i.imageId);l&&(o=l.modality);for(var c=Ze(n.canvasContext.canvas),u=Ie.getToolWidth(),d=function(e){var l=a.data[e];if(!1===l.visible)return "continue";Oe(c,function(e){var a,c=_e.getColorIfActive(l);if(l.active?l.handles.invalidHandlePlacement?(c=s.invalidColor,a=s.invalidColor):(c=_e.getColorIfActive(l),a=_e.getFillColor()):a=_e.getToolColor(),l.handles.length)for(var d=0;d<l.handles.length;d++){var h=Gt()(l.handles[d].lines);d!==l.handles.length-1||l.polyBoundingBox||h.push(s.mouseLocation.handles.start),Ae(e,n.element,l.handles[d],h,{color:c});}var g,m,p,y={color:c,fill:a};if((s.alwaysShowHandles||l.active&&l.polyBoundingBox)&&(y.handleRadius=s.activeHandleRadius,Ne(e,n,l.handles,y)),l.canComplete&&(y.handleRadius=s.completeHandleRadius,Ne(e,n,[l.handles[0]],y)),l.active&&!l.polyBoundingBox&&(y.handleRadius=s.activeHandleRadius,Ne(e,n,s.mouseLocation.handles,y),Ne(e,n,[l.handles[0]],y)),!1===l.invalidated)m=l.meanStdDev,p=l.meanStdDevSUV,g=l.area;else if(!l.active){for(var x={left:l.handles[0].x,right:l.handles[0].x,bottom:l.handles[0].y,top:l.handles[0].x},T=0;T<l.handles.length;T++)x.left=Math.min(x.left,l.handles[T].x),x.right=Math.max(x.right,l.handles[T].x),x.bottom=Math.min(x.bottom,l.handles[T].y),x.top=Math.max(x.top,l.handles[T].y);var b={left:x.left,top:x.bottom,width:Math.abs(x.right-x.left),height:Math.abs(x.top-x.bottom)};if(l.polyBoundingBox=b,!i.color){var E=f.cornerstone.getPixels(r,b.left,b.top,b.width,b.height);m=cn.call(t,E,b,l.handles),"PT"===o&&(p={mean:Rt(i,(m.mean-i.intercept)/i.slope),stdDev:Rt(i,(m.stdDev-i.intercept)/i.slope)}),m&&!isNaN(m.mean)&&(l.meanStdDev=m,l.meanStdDevSUV=p);}var M=(i.columnPixelSpacing||1)*(i.rowPixelSpacing||1);g=ln(l.handles,M),isNaN(g)||(l.area=g),l.invalidated=!1;}if(l.polyBoundingBox&&!l.handles.textBox.freehand){l.handles.textBox.hasMoved||(l.handles.textBox.x=l.polyBoundingBox.left+l.polyBoundingBox.width,l.handles.textBox.y=l.polyBoundingBox.top+l.polyBoundingBox.height/2);var C=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,r=[];if(t&&void 0!==t.mean){var s="";"CT"===o&&(s=" HU");var l="Mean: ".concat(Nt(t.mean.toFixed(2))).concat(s),c="StdDev: ".concat(Nt(t.stdDev.toFixed(2))).concat(s);if(n&&void 0!==n.mean){l+=" SUV: "+Nt(n.mean.toFixed(2)),c+=" SUV: "+Nt(n.stdDev.toFixed(2));}r.push(l),r.push(c);}if(a){var u=" mm".concat(String.fromCharCode(178));i.rowPixelSpacing&&i.columnPixelSpacing||(u=" pixels".concat(String.fromCharCode(178)));var d="Area: ".concat(Nt(a.toFixed(2))).concat(u);r.push(d);}return r}.call(t,l);Xe(e,r,l.handles.textBox,C,l.handles,v,c,u,0,!0);}});},h=0;h<a.data.length;h++)d(h);}function v(e){return e}}},{key:"addNewMeasurement",value:function(e,t){var n=e.detail;this.configuration;this._drawing=!0,this._startDrawing(n),this._addPoint(n),vn(e);}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return !!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||sn.call(this,e,n),vn(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=e.detail,i=o.element;if(n.hasBoundingBox)Te(e,this,t,n,a);else{var r=this.configuration;r.dragOrigin={x:n.x,y:n.y};var s=this._pointNearHandleAllTools(o),l=s.handleNearby,c=s.toolIndex;this._modifying=!0,r.currentHandle=l,r.currentTool=c,this._activateModify(i),S.isToolLocked=!0,vn(e);}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.element,a=Q(t.element,this.name),o=this.configuration,i=o.currentTool,r=a.data[i],s=t.currentPoints.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(r,t);var l=this._pointNearHandle(n,r,s);void 0!==l&&!l.hasBoundingBox&&l<r.handles.length-1&&(o.mouseLocation.handles.start.x=r.handles[l].x,o.mouseLocation.handles.start.y=r.handles[l].y),f.cornerstone.updateImage(t.element);}},{key:"_drawingMouseDragCallback",value:function(e){var t=e.detail,n=(t.element,Q(t.element,this.name)),a=this.configuration.currentTool,o=n.data[a];t.currentPoints.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(o,t),this._addPointPencilMode(t,o.handles),this._dragging=!0,f.cornerstone.updateImage(t.element);}},{key:"_drawingMouseUpCallback",value:function(e){if(this._dragging){this._dragging=!1;var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=this.configuration,i=o.currentTool,r=Q(t.element,this.name).data[i];this._pointNearHandle(n,r,a);if(!un.end(r.handles)&&r.canComplete){var s=o.currentHandle;this._endDrawing(n,s);}vn(e);}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=this.configuration,i=o.currentTool,r=Q(t.element,this.name).data[i],s=this._pointNearHandle(n,r,a);if(!un.end(r.handles)&&r.canComplete){var l=o.currentHandle;this._endDrawing(n,l);}else void 0===s&&this._addPoint(t);vn(e);}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=Q(t.element,this.name),a=this.configuration,o=n.data[a.currentTool],i=a.currentHandle;if(this._getMouseLocation(t),o.handles.invalidHandlePlacement=un.modify(o.handles,i),o.active=!0,o.highlight=!0,o.handles[i].x=a.mouseLocation.handles.start.x,o.handles[i].y=a.mouseLocation.handles.start.y,0!==i){var r=o.handles[i-1].lines.length-1,s=o.handles[i-1].lines[r];s.x=a.mouseLocation.handles.start.x,s.y=a.mouseLocation.handles.start.y;}f.cornerstone.updateImage(t.element);}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,a=Q(t.element,this.name);this._deactivateModify(n),this._dropHandle(t,a),this._endDrawing(n),S.isToolLocked=!1,f.cornerstone.updateImage(t.element);}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,a=n.currentTool,o=t.data[a].handles;if(o.invalidHandlePlacement){var i,r=n.currentHandle,s=o[r];if(0===r)i=o[o.length-1];else i=o[r-1];s.x=n.dragOrigin.x,s.y=n.dragOrigin.y,i.lines[0]=s,o.invalidHandlePlacement=!1;}}},{key:"_startDrawing",value:function(e){var t=this.createNewMeasurement(e),n=e.element,a=this.configuration;S.isToolLocked=!0,this._referencedElement=n,this._activateDraw(n),this._getMouseLocation(e),J(e.element,this.name,t);var o=Q(e.element,this.name);a.currentTool=o.data.length-1;}},{key:"_addPoint",value:function(e){var t=Q(e.element,this.name),n=this.configuration,a=t.data[n.currentTool];if(!a.handles.invalidHandlePlacement){var o=new dn(e.currentPoints.image);a.handles.length&&a.handles[n.currentHandle-1].lines.push(e.currentPoints.image),a.handles.push(o),n.currentHandle+=1,f.cornerstone.updateImage(e.element);}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,a=this.configuration,o=e.element,i=a.mouseLocation.handles.start;t.every(function(e){return n._isDistanceLargerThanSpacingCanvas(o,e,i)})&&this._addPoint(e);}},{key:"_endDrawing",value:function(e,t){var n=Q(e,this.name),a=this.configuration,o=n.data[a.currentTool];o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,void 0!==t&&o.handles[a.currentHandle-1].lines.push(o.handles[0]),this._modifying&&(this._modifying=!1,o.invalidated=!0),a.currentHandle=0,a.currentTool=-1,o.canComplete=!1,this._drawing&&(this._drawing=!1,S.isToolLocked=!1,this._deactivateDraw(e)),f.cornerstone.updateImage(e);}},{key:"_pointNearHandle",value:function(e,t,n){var a=this.configuration;if(void 0!==t.handles&&!1!==t.visible){for(var o=0;o<t.handles.length;o++){var i=f.cornerstone.pixelToCanvas(e,t.handles[o]);if(f.cornerstoneMath.point.distance(i,n)<a.spacing)return o}return t.handles.textBox&&ne(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.element,n=e.currentPoints.canvas,a=Q(t,this.name);if(a)for(var o,i=0;i<a.data.length;i++)if(void 0!==(o=this._pointNearHandle(t,a.data[i],n)))return {handleNearby:o,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,le(t.mouseLocation.handles.start,e.image);}},{key:"_checkInvalidHandleLocation",value:function(e,t){var n;this.configuration;if(e.handles.length<2)return !0;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n;}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,a=t.element,o=n.mouseLocation.handles.start,i=e.handles,r=!1;return e.canComplete=!1,this._isDistanceSmallerThanSpacingCanvas(a,i[0],o)&&!un.end(i)?(e.canComplete=!0,r=!1):r=un.newHandle(o,i),r}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,a=e.handles,o=un.newHandle(n,a);return !1===o&&(o=this._invalidHandlePencilMode(e,t)),o}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,a=t.element,o=n.mouseLocation.handles.start,i=e.handles;if(this._isDistanceSmallerThanSpacingCanvas(a,i[0],o))return e.canComplete=!0,!1;e.canComplete=!1;for(var r=1;r<i.length-1;r++)if(this._isDistanceSmallerThanSpacingCanvas(a,i[r],o))return !0;return !1}},{key:"_isDistanceSmallerThanSpacingCanvas",value:function(e,t,n){return this._compareDistanceToSpacingCanvas(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacingCanvas",value:function(e,t,n){return this._compareDistanceToSpacingCanvas(e,t,n,">")}},{key:"_compareDistanceToSpacingCanvas",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",o=this.configuration;f.cornerstone.pixelToCanvas(e,t),f.cornerstone.pixelToCanvas(e,n);return ">"===a?f.cornerstoneMath.point.distance(t,n)>o.spacing:f.cornerstoneMath.point.distance(t,n)<o.spacing}},{key:"_activateDraw",value:function(e){e.addEventListener(x.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(x.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(x.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),f.cornerstone.updateImage(e);}},{key:"_deactivateDraw",value:function(e){e.removeEventListener(x.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(x.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(x.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),f.cornerstone.updateImage(e);}},{key:"_activateModify",value:function(e){e.addEventListener(x.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(x.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(x.MOUSE_CLICK,this._editMouseUpCallback),f.cornerstone.updateImage(e);}},{key:"_deactivateModify",value:function(e){e.removeEventListener(x.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(x.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(x.MOUSE_CLICK,this._editMouseUpCallback),f.cornerstone.updateImage(e);}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e);}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e);}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e);}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),f.cornerstone.updateImage(e);}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,f.cornerstone.updateImage(this.element);}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,f.cornerstone.updateImage(this.element);}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,f.cornerstone.updateImage(this.element);}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,f.cornerstone.updateImage(this.element);}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,f.cornerstone.updateImage(this.element);}}]),t}(Me);function vn(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();}var gn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Length",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,a=t.y;return {visible:!0,active:!0,color:void 0,handles:{start:{x:n,y:a,highlight:!0,active:!1},end:{x:n,y:a,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.start&&t.handles.end;return a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!(!a||!1===t.visible)&&tt(e,t.handles.start,t.handles.end,n)<25}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,o=a.handleRadius,i=a.drawHandlesOnHover,r=Q(e.currentTarget,this.name);if(r){var s,l,c=Ze(n.canvasContext.canvas),u=n.image,d=n.element,h=Ie.getToolWidth(),v=f.cornerstone.metaData.get("imagePlaneModule",u.imageId);v?(s=v.rowPixelSpacing||v.rowImagePixelSpacing,l=v.columnPixelSpacing||v.colImagePixelSpacing):(s=u.rowPixelSpacing,l=u.columnPixelSpacing);for(var g=function(e){var a=r.data[e];if(!1===a.visible)return "continue";Oe(c,function(e){Qe(e,t.configuration);var r=_e.getColorIfActive(a);Le(e,d,a.handles.start,a.handles.end,{color:r});var c={color:r,handleRadius:o,drawHandlesIfActive:i};Ne(e,n,a.handles,c);var u=(a.handles.end.x-a.handles.start.x)*(l||1),v=(a.handles.end.y-a.handles.start.y)*(s||1),g=Math.sqrt(u*u+v*v);if(a.length=g,!a.handles.textBox.hasMoved){var m={x:Math.max(a.handles.start.x,a.handles.end.x)};m.x===a.handles.start.x?m.y=a.handles.start.y:m.y=a.handles.end.y,a.handles.textBox.x=m.x,a.handles.textBox.y=m.y;}var f=function(e,t,n){var a=" mm";t&&n||(a=" pixels");return "".concat(e.length.toFixed(2)).concat(a)}(a,s,l);Xe(e,d,a.handles.textBox,f,a.handles,p,r,h,10,!0);});},m=0;m<r.data.length;m++)g(m);}function p(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return [e.start,t,e.end]}}}]),t}(Me),mn=function(e,t,n,a,o){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i,r,s,l=f.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(r=0;r<o;r++)for(s=0;s<a;s++){var h=d[i=4*((r+n)*l.image.columns+(s+t))],v=d[i+1],g=d[i+2],m=d[i+3];c[u++]=h,c[u++]=v,c[u++]=g,c[u++]=m;}return c},fn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Probe",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return {visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};console.error("required eventData not supplieed to tool ".concat(this.name,"'s createNewMeasurement"));}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.end;if(a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return !1;var o=f.cornerstone.pixelToCanvas(e,t.handles.end);return f.cornerstoneMath.point.distance(o,n)<5}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration.handleRadius,a=Q(e.currentTarget,this.name);if(a)for(var o=Ze(t.canvasContext.canvas),i=t.image,r=ze.getFontSize(),s=function(e){var s=a.data[e];if(!1===s.visible)return "continue";Oe(o,function(e){var a=_e.getColorIfActive(s);Ne(e,t,s.handles,{handleRadius:n,color:a});var o,l,c,u=Math.round(s.handles.end.x),d=Math.round(s.handles.end.y);if(u>=0&&d>=0&&u<i.columns&&d<i.rows){if(l="".concat(u,", ").concat(d),i.color)o=mn(t.element,u,d,1,1),c="R: ".concat(o[0]," G: ").concat(o[1]," B: ").concat(o[2]);else{var h=(o=f.cornerstone.getStoredPixels(t.element,u,d,1,1))[0],v=h*i.slope+i.intercept,g=Rt(i,h);c="SP: ".concat(h," MO: ").concat(parseFloat(v.toFixed(3))),g&&(c+=" SUV: ".concat(parseFloat(g.toFixed(3))));}var m={x:s.handles.end.x+3,y:s.handles.end.y-3},p=f.cornerstone.pixelToCanvas(t.element,m);Ye(e,c,p.x,p.y+r+5,a),Ye(e,l,p.x,p.y,a);}});},l=0;l<a.data.length;l++)s(l);}}]),t}(Me),pn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return {visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return !1;var o=f.cornerstone.pixelToCanvas(e,t.handles.start),i=f.cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(o.x,i.x),top:Math.min(o.y,i.y),width:Math.abs(o.x-i.x),height:Math.abs(o.y-i.y)};return f.cornerstoneMath.rect.distanceToPoint(r,n)<5}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=this.configuration,o=a.handleRadius,i=a.drawHandlesOnHover,r=Q(e.currentTarget,this.name);if(r){var s,l=Ze(n.canvasContext.canvas),c=n.image,u=n.element,d=Ie.getToolWidth(),h=f.cornerstone.metaData.get("generalSeriesModule",c.imageId),v=f.cornerstone.metaData.get("imagePlaneModule",c.imageId),g=c.rowPixelSpacing,m=c.columnPixelSpacing;v&&(g=v.rowPixelSpacing||v.rowImagePixelSpacing,m=v.columnPixelSpacing||v.colImagePixelSpacing),h&&(s=h.modality);for(var p=function(e){var a=r.data[e];if(!1===a.visible)return "continue";Oe(l,function(e){Qe(e,t.configuration);var r=_e.getColorIfActive(a);Ke(e,u,a.handles.start,a.handles.end,{color:r});var l,h,v,p={color:r,handleRadius:o,drawHandlesIfActive:i};if(Ne(e,n,a.handles,p),!1===a.invalidated)h=a.meanStdDev,v=a.meanStdDevSUV,l=a.area;else{var y={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)};if(!c.color){var T=f.cornerstone.getPixels(u,y.left,y.top,y.width,y.height);h=yn(T,y),"PT"===s&&(v={mean:Rt(c,(h.mean-c.intercept)/c.slope),stdDev:Rt(c,(h.stdDev-c.intercept)/c.slope)}),h&&!isNaN(h.mean)&&(a.meanStdDev=h,a.meanStdDevSUV=v);}l=y.width*(m||1)*(y.height*(g||1)),isNaN(l)||(a.area=l),a.invalidated=!1;}var b=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,o=[];if(t&&void 0!==t.mean){var i="";"CT"===s&&(i=" HU");var r="Mean: ".concat(Nt(t.mean.toFixed(2))).concat(i),l="StdDev: ".concat(Nt(t.stdDev.toFixed(2))).concat(i);if(n&&void 0!==n.mean){r+=" SUV: "+Nt(n.mean.toFixed(2)),l+=" SUV: "+Nt(n.stdDev.toFixed(2));}o.push(r),o.push(l);}if(a){var c=" mm".concat(String.fromCharCode(178));g&&m||(c=" pixels".concat(String.fromCharCode(178)));var u="Area: ".concat(Nt(a.toFixed(2))).concat(c);o.push(u);}return o}(a);a.handles.textBox.hasMoved||(a.handles.textBox.x=Math.max(a.handles.start.x,a.handles.end.x),a.handles.textBox.y=(a.handles.start.y+a.handles.end.y)/2),Xe(e,u,a.handles.textBox,b,a.handles,x,r,d,0,!0);});},y=0;y<r.data.length;y++)p(y);}function x(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),o=Math.abs(e.start.y-e.end.y);return [{x:t+a/2,y:n},{x:t,y:n+o/2},{x:t+a/2,y:n+o},{x:t+a,y:n+o/2}]}}}]),t}(Me),yn=function(e,t){for(var n=0,a=0,o=0,i=0,r=t.top;r<t.top+t.height;r++)for(var s=t.left;s<t.left+t.width;s++)n+=e[i],a+=e[i]*e[i],o++,i++;if(0===o)return {count:o,mean:0,variance:0,stdDev:0};var l=n/o,c=a/o-l*l;return {count:o,mean:l,variance:c,stdDev:Math.sqrt(c)}},xn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:Tn}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e.touchPressCallback=e._changeText.bind(ut()(ut()(e))),e.doubleClickCallback=e._changeText.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(f.cornerstoneMath.point.insideRect(n.handles.end,a)){var o=t.markers.indexOf(t.current);return (o+=t.ascending?1:-1)>=t.markers.length?o=t.loop?0:-1:o<0&&(o=t.loop?t.markers.length:-1),t.current=t.markers[o],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return !1;if(t.handles.end.boundingBox){var a=f.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),o=ne(t.handles.end,n);return a<10||o}}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,a=Q(t.element,this.name);if(a)for(var o=Ze(t.canvasContext.canvas),i=function(e){var i=a.data[e];if(!1===i.visible)return "continue";var r=_e.getColorIfActive(i);Oe(o,function(e){Qe(e,n);var a=f.cornerstone.pixelToCanvas(t.element,i.handles.end);i.handles.end.boundingBox=Ye(e,i.text,a.x,a.y-10,r,{centering:{x:!0,y:!0}});});},r=0;r<a.data.length;r++)i(r);}},{key:"_changeText",value:function(e){var t,n=e.detail,a=n.element,o=n.currentPoints;function i(e,t,n){!0===n?$(a,this.name,e):e.text=t,e.active=!1,f.cornerstone.updateImage(a);}var r=this.configuration,s=o.canvas,l=Q(a,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(a,t,s))return t.active=!0,f.cornerstone.updateImage(a),r.changeTextCallback(t,n,i),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(Me),Tn=function(e,t,n){n(e,prompt("Change your annotation:"));},bn=_.modules.brush,En=bn.state,Mn=bn.setters,Cn=function(e){function t(e){var n,a=e.name,i=e.strategies,r=e.defaultStrategy,s=e.configuration,c=e.supportedInteractionTypes,d=e.mixins;return o()(this,t),s.referencedToolData="brush",(n=l()(this,u()(t).call(this,{name:a,strategies:i,defaultStrategy:r,configuration:s,supportedInteractionTypes:c,mixins:d}))).hasCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(ut()(ut()(n))),n}return h()(t,e),r()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){this._startPainting(e);}},{key:"preMouseDownCallback",value:function(e){return this._startPainting(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element;this._paint(e),this._drawing=!0,this._startListeningForMouseUp(n),this._lastImageCoords=t.currentPoints.image;}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image;}},{key:"passiveCallback",value:function(e){f.cornerstone.updateImage(this.element);}},{key:"renderToolData",value:function(e){(function(e,t){return "active"===O(e,t).mode})(e.detail.element,this.name)&&this.renderBrush(e);}},{key:"_getBrushColor",value:function(e){var t=f.cornerstone.colors.getColormap(En.colorMapId).getColor(e);return this._drawing?"rgba(".concat(t[[0]],", ").concat(t[[1]],", ").concat(t[[2]],", 1.0 )"):"rgba(".concat(t[[0]],", ").concat(t[[1]],", ").concat(t[[2]],", 0.8 )")}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t);}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(x.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(x.MOUSE_CLICK,this._drawingMouseUpCallback),f.cornerstone.updateImage(e);}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(x.MOUSE_CLICK,this._drawingMouseUpCallback),f.cornerstone.updateImage(e);}},{key:"nextSegmentation",value:function(){var e=this.constructor.getNumberOfColors(),t=En.drawColorId+1;t===e&&(t=0),En.drawColorId=t;}},{key:"previousSegmentation",value:function(){var e=this.constructor.getNumberOfColors(),t=En.drawColorId-1;t<0&&(t=e-1),En.drawColorId=t;}},{key:"increaseBrushSize",value:function(){var e=En.radius,t=Math.floor(1.2*e);t===e&&(t+=1),Mn.radius(t);}},{key:"decreaseBrushSize",value:function(){var e=En.radius,t=Math.floor(.8*e);Mn.radius(t);}},{key:"showSegmentationOnElement",value:function(e){var t=this._getEnabledElement(),n=t.uuid;Mn.brushVisibilityForElement(n,e,!0),f.cornerstone.updateImage(t.element);}},{key:"hideSegmentationOnElement",value:function(e){var t=this._getEnabledElement(),n=t.uuid;Mn.brushVisibilityForElement(n,e,!1),f.cornerstone.updateImage(t.element);}},{key:"showAllSegmentationsOnElement",value:function(){for(var e=this._getEnabledElement(),t=e.uuid,n=f.cornerstone.colors.getColormap(En.colorMapId).getNumberOfColors(),a=0;a<n;a++)Mn.brushVisibilityForElement(t,a,!0);f.cornerstone.updateImage(e.element);}},{key:"hideAllSegmentationsOnElement",value:function(){for(var e=this._getEnabledElement(),t=e.uuid,n=f.cornerstone.colors.getColormap(En.colorMapId).getNumberOfColors(),a=0;a<n;a++)Mn.brushVisibilityForElement(t,a,!1);f.cornerstone.updateImage(e.element);}},{key:"_getEnabledElement",value:function(){return f.cornerstone.getEnabledElement(this.element)}},{key:"alpha",get:function(){En.alpha;},set:function(e){var t=this._getEnabledElement();En.alpha=e,f.cornerstone.updateImage(t.element);}},{key:"hiddenButActiveAlpha",get:function(){En.hiddenButActiveAlpha;},set:function(e){var t=this._getEnabledElement();En.hiddenButActiveAlpha=e,f.cornerstone.updateImage(t.element);}}],[{key:"getNumberOfColors",value:function(){return f.cornerstone.colors.getColormap(En.colorMapId).getNumberOfColors()}},{key:"getReferencedToolDataName",value:function(){return "brush"}}]),t}(Y);var wn={drawBrushPixels:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.forEach(function(e){var o,i=(o=e[0],e[1]*n+o);t[i]=a?0:1;});},drawBrushOnCanvas:function(e,t,n,a){var o=f.cornerstone.pixelToCanvas(a,{x:0,y:0}),i=f.cornerstone.pixelToCanvas(a,{x:1,y:1}),r=i.x-o.x,s=i.y-o.y;Oe(t,function(t){e.forEach(function(e){var o=f.cornerstone.pixelToCanvas(a,{x:e[0],y:e[1]}),i={left:o.x,top:o.y,width:r,height:s};Ge(t,i,n);});});},getCircle:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=Math.round(a),r=Math.round(o);if(1===e)return [[i,r]];for(var s=[],l=0,c=-e;c<=e;c++){var u=r+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var h=i+d;h>n||h<0||d*d+c*c<e*e&&(s[l++]=[i+d,r+c]);}}return s}},In=wn.drawBrushPixels,Sn=wn.getCircle,kn=_.modules.brush.state,Pn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Brush",supportedInteractionTypes:["Mouse"],strategies:{overlapping:_n,nonOverlapping:On},defaultStrategy:"overlapping",configuration:{}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"renderBrush",value:function(e){var t,n=e.detail,a=n.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=_.state.mousePositionImage,t){var o=n.image,i=o.rows,r=o.columns,s=t,l=s.x,c=s.y;if(!(l<0||l>r||c<0||c>i)){this._configuration;var u=kn.radius,d=n.canvasContext,h=n.element,v=kn.drawColorId,g=this._getBrushColor(v);d.setTransform(1,0,0,1,0,0);var m=f.cornerstone,p=u*a.scale,y=m.pixelToCanvas(h,t);d.beginPath(),d.strokeStyle=g,d.ellipse(y.x,y.y,p,p,0,0,2*Math.PI),d.stroke();}}}},{key:"_paint",value:function(e){this.applyActiveStrategy(e,this.configuration),f.cornerstone.updateImage(e.detail.element);}}]),t}(Cn);function _n(e,t){var n=e.detail,a=n.element,o=n.image,i=o.rows,r=o.columns,s=n.currentPoints.image,l=s.x,c=s.y,u=Q(a,t.referencedToolData),d=!1;Dn(n)&&(console.log("ctrlDown"),d=!0);var h=kn.drawColorId;if(!u.data[h].pixelData){var v=new Uint8ClampedArray(n.image.width*n.image.height);u.data[h].pixelData=v;}var g=u.data[h].pixelData,m=kn.radius;if(!(l<0||l>r||c<0||c>i)){var f=Sn(m,i,r,l,c);In(f,g,r,d),u.data[h].invalidated=!0;}}function On(e,t){var n=e.detail,a=n.element,o=n.image,i=o.rows,r=o.columns,s=n.currentPoints.image,l=s.x,c=s.y,u=Q(a,t.referencedToolData).data,d=!1;Dn(n)&&(console.log("ctrlDown"),d=!0);var h=kn.drawColorId;if(!u[h].pixelData){var v=new Uint8ClampedArray(n.image.width*n.image.height);u[h].pixelData=v;}var g=u[h].pixelData,m=kn.radius;if(!(l<0||l>r||c<0||c>i)){var f=Sn(m,i,r,l,c);In(f,g,r,d),u[h].invalidated=!0;for(var p=Cn.getNumberOfColors(),y=0;y<p;y++)y!==h&&u[y]&&u[y].pixelData&&(In(f,u[y].pixelData,r,!0),u[y].invalidated=!0);}}function Dn(e){return e.event&&e.event.ctrlKey||e.ctrlKey}var Ln,An,Hn;var Rn={setStartLoadHandler:function(e){Ln=e;},getStartLoadHandler:function(){return Ln},setEndLoadHandler:function(e){An=e;},getEndLoadHandler:function(){return An},setErrorLoadingHandler:function(e){Hn=e;},getErrorLoadingHandler:function(){return Hn}};function Un(e){var t=f.cornerstoneMath;return e instanceof t.Vector3?e:new t.Vector3(e[0],e[1],e[2])}function Nn(e,t){var n=Un(t.rowCosines),a=Un(t.columnCosines),o=Un(t.imagePositionPatient),i=e.clone().sub(o);return {x:n.dot(i)/t.columnPixelSpacing,y:a.dot(i)/t.rowPixelSpacing}}function Bn(e,t){var n=Un(t.rowCosines),a=Un(t.columnCosines),o=Un(t.imagePositionPatient),i=n.clone().multiplyScalar(e.x);i.multiplyScalar(t.columnPixelSpacing);var r=a.clone().multiplyScalar(e.y);r.multiplyScalar(t.rowPixelSpacing);var s=i.add(r);return s.add(o),s}function Fn(e,t){var n=Un(e.rowCosines),a=Un(e.columnCosines),o=Un(e.imagePositionPatient),i=Un(t.rowCosines),r=Un(t.columnCosines),s=Un(t.imagePositionPatient),l=n.clone().cross(a),c=new f.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,o);var u=i.clone().cross(r),d=new f.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var h=d.clone().intersectPlane(c),v=h.origin,g=h.direction,m=Bn({x:t.columns,y:t.rows},t),p=s.distanceTo(m),y=new f.cornerstoneMath.Line3;y.start=v,y.end=v.clone().add(g.multiplyScalar(p));var x=function(e,t){var n=[];return Object.keys(t).forEach(function(a){var o=t[a],i=e.intersectLine(o);i&&n.push(i);}),n}(y,function(e){var t=Bn({x:0,y:0},e),n=Bn({x:e.columns,y:0},e),a=Bn({x:0,y:e.rows},e),o=Bn({x:e.columns,y:e.rows},e);return {top:new f.cornerstoneMath.Line3(t,n),left:new f.cornerstoneMath.Line3(t,a),right:new f.cornerstoneMath.Line3(n,o),bottom:new f.cornerstoneMath.Line3(a,o)}}(t));if(2===x.length)return {start:x[0],end:x[1]}}var Vn={};function jn(e,t){if(!Vn[e])return {};var n=Vn[e].find(function(e){return e.element===t});return n?n.options:{}}function zn(e,t,n){if(Vn[e]){var a=Vn[e].findIndex(function(e){return e.element===t});if(-1===a)Vn[e].push({element:t,options:n});else{var o=Vn[e][a].options||{};Vn[e][a].options=Object.assign(o,n);}}else Vn[e]=[{element:t,options:n}];}var Wn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.mouseDownCallback=e._chooseLocation.bind(ut()(ut()(e))),e.mouseDragCallback=e._chooseLocation.bind(ut()(ut()(e))),e.touchDragCallback=e._chooseLocation.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var a=Q(n,this.name);if(a){var o=n,i=f.cornerstone.getEnabledElement(o).image.imageId,r=f.cornerstone.metaData.get("imagePlaneModule",i);if(r){var s=Bn(t.currentPoints.image,r);a.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==o){var t=Number.MAX_VALUE,n=-1,a=Q(e,"stack");if(void 0!==a){var i=a.data[0];if(i.imageIds.forEach(function(e,a){var o=f.cornerstone.metaData.get("imagePlaneModule",e);if(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines){var i=Un(o.imagePositionPatient),r=Un(o.rowCosines),l=Un(o.columnCosines).clone().cross(r.clone()),c=Math.abs(l.clone().dot(i)-l.clone().dot(s));c<t&&(t=c,n=a);}}),n!==i.currentImageIdIndex&&-1!==n&&void 0!==i.imageIds[n]){var r=Rn.getStartLoadHandler(),l=Rn.getEndLoadHandler(),c=Rn.getErrorLoadingHandler();r&&r(e),(!0===i.preventCache?f.cornerstone.loadImage(i.imageIds[n]):f.cornerstone.loadAndCacheImage(i.imageIds[n])).then(function(t){var a=f.cornerstone.getViewport(e);i.currentImageIdIndex=n,f.cornerstone.displayImage(e,t,a),l&&l(e,t);},function(t){var a=i.imageIds[n];c&&c(e,a,t);});}}}});}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,a=t.synchronizationContext;zn(this.name,e,{mouseButtonMask:n}),ee(e,this.name),J(e,this.name,{synchronizationContext:a});}}]),t}(Y),Gn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;f.cornerstone.fitToWindow(t.element);}}]),t}(Y),qn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"DragProbe",strategies:{default:Yn,minimal:Xn},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).touchDragCallback=e._movingEventCallback.bind(ut()(ut()(e))),e.touchEndCallback=e._endMovingEventCallback.bind(ut()(ut()(e))),e.mouseDragCallback=e._movingEventCallback.bind(ut()(ut()(e))),e.mouseUpCallback=e._endMovingEventCallback.bind(ut()(ut()(e))),e.initialConfiguration=i,e.dragEventData={},e}return h()(t,e),r()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,f.cornerstone.updateImage(n);}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},f.cornerstone.updateImage(t);}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e));}}]),t}(Y),Yn=function(e,t){var n=f.cornerstone,a=e.detail,o=a.element,i=a.image,r=a.currentPoints,s=a.canvasContext,l=Ze(s.canvas),c=_e.getActiveColor(),u=ze.getFontSize(),d=Math.round(r.image.x),h=Math.round(r.image.y);d<0||h<0||d>=i.columns||h>=i.rows||Oe(l,function(e){Qe(e,t);var a,s,l="".concat(d,", ").concat(h);if(i.color)a=mn(o,d,h,1,1),s="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]," A: ").concat(a[3]);else{var v=(a=n.getStoredPixels(o,d,h,1,1))[0],g=v*i.slope+i.intercept,m=Rt(i,v);s="SP: ".concat(v," MO: ").concat(parseFloat(g.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))));}var f={x:r.canvas.x+5,y:r.canvas.y-5};Ye(e,s,f.x,f.y+u+5,c),Ye(e,l,f.x,f.y,c);});},Xn=function(e,t){var n=f.cornerstone,a=e.detail,o=a.element,i=a.image,r=a.currentPoints,s=a.canvasContext,l=a.isTouchEvent,c=Ze(s.canvas),u=_e.getActiveColor(),d=r.page.y-ze.getFontSize()/2;l&&(d=r.page.y-4*ze.getFontSize());var h=n.pageToPixel(o,r.page.x,d);h.x<0||h.y<0||h.x>=i.columns||h.y>=i.rows||Oe(c,function(e){Qe(e,t);var a,r=n.metaData.get("generalSeriesModule",i.imageId),s=r&&r.modality,c="";if(i.color)a=mn(o,h.x,h.y,1,1),c="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]);else{var d=(a=n.getStoredPixels(o,h.x,h.y,1,1))[0],v=d*i.slope+i.intercept,g=parseFloat(v.toFixed(2));if("CT"===s)c+="HU: ".concat(g);else if("PT"===s){c+=g;var m=Rt(i,d);m&&(c+=" SUV: ".concat(parseFloat(m.toFixed(2))));}else c+=g;}var f=n.pixelToCanvas(o,h),p={x:12,y:-(ze.getFontSize()+10)/2},y=qe(e,c,5);l&&(p={x:-y/2,y:-ze.getFontSize()-10-12}),Re(e,o,f,6,{color:u},"canvas"),Ye(e,c,f.x+p.x,f.y+p.y,u);});},Kn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Eraser",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.preMouseDownCallback=e._deleteAllNearbyTools.bind(ut()(ut()(e))),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;S.tools.forEach(function(e){var a=Q(n,e.name);a&&a.data.forEach(function(a){"function"==typeof e.pointNearTool&&e.pointNearTool(n,a,t)&&($(n,e.name,a),f.cornerstone.updateImage(n));});});return !0}}]),t}(Y),Zn=rn.FreehandHandleData,Jn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"FreehandSculpterMouse",referencedToolName:"FreehandMouse",supportedInteractionTypes:["Mouse"],mixins:["activeOrDisabledBinaryTool"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:5,maxSpacing:20,currentTool:null,dragColor:_e.getActiveColor(),hoverColor:_e.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).hasCursor=!0,e.initialConfiguration=i,e.referencedToolName=i.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(ut()(ut()(e))),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return !1;if(this._active){var n=t.canvasContext.canvas.getContext("2d"),a={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};Ne(n,t,this.configuration.mouseLocation.handles,a);}else this.configuration.showCursorOnHover&&this._renderHoverCursor(e);}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),f.cornerstone.updateImage(t.element);}},{key:"preMouseDownCallback",value:function(e){var t=e.detail;return null===this.configuration.currentTool?this._selectFreehandTool(t):this._initialiseSculpting(t),f.cornerstone.updateImage(t.element),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,a=Q(n.element,this.referencedToolName);if(a){var o=a.data[t.currentTool].handles;this._getMouseLocation(n),this._sculpt(n,o),f.cornerstone.updateImage(n.element);}}}},{key:"activeMouseUpCallback",value:function(e){var t=e.detail,n=t.element,a=this.configuration;this._active=!1,S.isToolLocked=!1,this._getMouseLocation(t),this._invalidateToolData(t),a.mouseUpRender=!0,this._deactivateSculpt(n),f.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();}(e);}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,a=n.element,o=n.canvasContext.canvas.getContext("2d"),i=Q(a,this.referencedToolName).data[this.configuration.currentTool];this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=S.mousePositionImage;var r=O(a,this.referencedToolName).distanceFromPointCanvas(a,i,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=r;r=this._limitCursorRadiusCanvas(n,r),s>this.configuration.hoverCursorFadeDistance*r&&(o.globalAlpha=this.configuration.hoverCursorFadeAlpha);}var l={fill:null,color:this.configuration.hoverColor,handleRadius:r};Ne(o,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(o.globalAlpha=1);}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e);}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e);}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e);}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e);}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,a=this._getClosestFreehandToolOnElement(n,e);void 0!==a&&(t.currentTool=a);}},{key:"_activateFreehandTool",value:function(e,t){var n=Q(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var a=0;a<n.length;a++)n[a].active=a===t;}},{key:"_initialiseSculpting",value:function(e){var t=e.element,n=this.configuration;this._active=!0,S.isToolLocked=!0,this._configureToolSize(e),this._getMouseLocation(e),this._activateFreehandTool(t,n.currentTool),this._activateSculpt(t);}},{key:"_sculpt",value:function(e,t){var n=this.configuration,a={element:e.element,image:e.image,mousePoint:e.currentPoints.image,dataHandles:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:n.maxSpacing};this._pushHandles(a),this._insertNewHandles(a),this._consolidateHandles(a);}},{key:"_pushHandles",value:function(e){for(var t=e.dataHandles,n=e.mousePoint,a=e.toolSize,o=0;o<t.length;o++){var i=f.cornerstoneMath.point.distance(t[o],n);i<a&&this._pushOneHandle(e,o,i);}}},{key:"_pushOneHandle",value:function(e,t,n){var a=e.dataHandles,o=a[t],i=e.mousePoint,r=e.toolSize,s=e.image,l=(o.x-i.x)/n,c=(o.y-i.y)/n,u={x:i.x+r*l,y:i.y+r*c};le(u,s),o.x=u.x,o.y=u.y;var d=this.constructor._getPreviousHandleIndex(t,a.length);a[d].lines.pop(),a[d].lines.push(o);}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,a=0;a<t.length;a++){var o=t[a]+1+n;this._insertHandleRadially(e,o),n++;}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=e.element,n=e.dataHandles,a=[],o=0;o<n.length;o++){var i=f.cornerstone.pixelToCanvas(t,n[o]),r=this.constructor._getNextHandleIndex(o,n.length),s=f.cornerstone.pixelToCanvas(t,n[r]);f.cornerstoneMath.point.distance(i,s)>e.maxSpacing&&a.push(o);}return a}},{key:"_insertHandleRadially",value:function(e,t){var n=e.dataHandles,a=t-1,o=this.constructor._getNextHandleIndexBeforeInsert(t,n.length),i=this.constructor._getInsertPosition(e,t,a,o),r=new Zn(i);n.splice(t,0,r),n[a].lines.pop(),n[a].lines.push(n[t]),t===n.length-1?n[t].lines.push(n[0]):n[t].lines.push(n[t+1]);}},{key:"_consolidateHandles",value:function(e){if(e.dataHandles.length>3){var t=this._findCloseHandlePairs(e);this._mergeCloseHandles(e,t);}}},{key:"_findCloseHandlePairs",value:function(e){for(var t=e.dataHandles,n=e.element,a=e.minSpacing,o=[],i=t.length,r=0;r<i;r++){var s=f.cornerstone.pixelToCanvas(n,t[r]),l=this.constructor._getNextHandleIndex(r,t.length),c=f.cornerstone.pixelToCanvas(n,t[l]);if(f.cornerstoneMath.point.distance(s,c)<a){var u=[r,l];o.push(u),0===r&&(i-=1),r++;}}return o}},{key:"_mergeCloseHandles",value:function(e,t){for(var n=0,a=0;a<t.length;a++){var o=this.constructor._getCorrectedPair(t[a],n);this._combineHandles(e,o),n++;}var i=this._findCloseHandlePairs(e);i.length&&this._mergeCloseHandles(e,i);}},{key:"_combineHandles",value:function(e,t){var n=e.dataHandles,a=e.image,o={x:(n[t[0]].x+n[t[1]].x)/2,y:(n[t[0]].y+n[t[1]].y)/2};le(o,a),n[t[0]].x=o.x,n[t[0]].y=o.y;var i=this.constructor._getNextHandleIndex(t[1],n.length);n[t[0]].lines.pop(),n[t[0]].lines.push(n[i]),n.splice(t[1],1);}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,a=n.currentTool,o=e.currentPoints.image,i=Q(t,this.referencedToolName).data[a],r=O(t,this.referencedToolName),s=r.distanceFromPoint(t,i,o),l=r.distanceFromPointCanvas(t,i,o);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l;}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,le(t.mouseLocation.handles.start,e.image);}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(x.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(x.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(x.MOUSE_DRAG,this.activeMouseDragCallback),f.cornerstone.updateImage(e);}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(x.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(x.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(x.MOUSE_DRAG,this.activeMouseDragCallback),f.cornerstone.updateImage(e);}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;Q(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0;}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=Q(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var a=0;a<n.data.length;a++)n.data[a].active=!1;f.cornerstone.updateImage(this.element);}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.element,o=e.image,i=this.configuration,r=Q(a,this.referencedToolName).data[i.currentTool],s=1;if(n){var l=f.cornerstone.pixelToCanvas(a,{x:0,y:0}),c=f.cornerstone.pixelToCanvas(a,{x:o.width,y:o.height});s=(c.x-l.x)*(c.y-l.y)/(o.width*o.height);}var u=r.area*s,d=Math.pow(u/Math.PI,.5);return Math.min(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=O(e,this.referencedToolName),a=Q(e,this.referencedToolName);if(a){for(var o=a.data,i=t.currentPoints.image,r={distance:1/0,toolIndex:null},s=0;s<o.length;s++){var l=n.distanceFromPoint(e,o[s],i);-1!==l&&(l<r.distance&&(r.distance=l,r.toolIndex=s));}return r.toolIndex}}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e;}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e;}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,f.cornerstone.updateImage(this.element);}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,f.cornerstone.updateImage(this.element);}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,f.cornerstone.updateImage(this.element);}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,f.cornerstone.updateImage(this.element);}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}},{key:"_getInsertPosition",value:function(e,t,n,a){var o,i=e.toolSize,r=e.mousePoint,s=e.dataHandles,l=e.image,c={x:(s[n].x+s[a].x)/2,y:(s[n].y+s[a].y)/2},u=f.cornerstoneMath.point.distance(r,c);if(u<i){var d={x:(c.x-r.x)/u,y:(c.y-r.y)/u};o={x:r.x+i*d.x,y:r.y+i*d.y};}else o=c;return le(o,l),o}}]),t}(Y);var Qn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(ut()(ut()(e))),e.enabledCallback=e._createMagnificationCanvas.bind(ut()(ut()(e))),e.disabledCallback=e._destroyMagnificationCanvas.bind(ut()(ut()(e))),e.postTouchStartCallback=e._addMagnifyingGlass.bind(ut()(ut()(e))),e.touchDragCallback=e._updateMagnifyingGlass.bind(ut()(ut()(e))),e.touchEndCallback=e._removeMagnifyingGlass.bind(ut()(ut()(e))),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(ut()(ut()(e))),e.postMouseDownCallback=e._addMagnifyingGlass.bind(ut()(ut()(e))),e.mouseDragCallback=e._updateMagnifyingGlass.bind(ut()(ut()(e))),e.mouseUpCallback=e._removeMagnifyingGlass.bind(ut()(ut()(e))),e.mouseClickCallback=e._removeMagnifyingGlass.bind(ut()(ut()(e))),e.newImageCallback=e._drawMagnificationTool.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame(function(){return t._drawMagnificationTool(e)}),e.preventDefault(),e.stopPropagation();}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation();}},{key:"_removeMagnifyingGlass",value:function(e){e.detail.element.querySelector(".magnifyTool").style.display="none",document.body.style.cursor="default",this._removeZoomElement();}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var a=t.querySelector("canvas:not(.magnifyTool)"),o=Ze(n),i=f.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),r=Math.min(this.configuration.magnifySize,a.width,a.height),s=this.configuration.magnificationLevel;n.width=r,n.height=r,i.x=Math.max(i.x,.5*r/s),i.x=Math.min(i.x,a.width-.5*r/s),i.y=Math.max(i.y,.5*r/s),i.y=Math.min(i.y,a.height-.5*r/s);var l={x:i.x*s-.5*r,y:i.y*s-.5*r};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),o.drawImage(this.zoomCanvas,l.x,l.y,r,r,0,0,r,r);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(i.y-.5*r-c,0),left:Math.max(i.x-.5*r,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,a.height-d.height),u.left=Math.min(u.left,a.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block",document.body.style.cursor="none";}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=f.cornerstone.getEnabledElement(t));var a=this.configuration.magnificationLevel,o=n.canvas,i=n.image;this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*a,this.zoomElement.height=o.height*a,f.cornerstone.enable(this.zoomElement,n.options);var r=f.cornerstone.getEnabledElement(this.zoomElement),s=f.cornerstone.getViewport(n.element);this.zoomCanvas=r.canvas,this.zoomCanvas.width=o.width*a,this.zoomCanvas.height=o.height*a,r.viewport=Object.assign({},s),s.scale*=a,f.cornerstone.displayImage(this.zoomElement,i),f.cornerstone.setViewport(this.zoomElement,s);}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(f.cornerstone.disable(this.zoomCanvas),this.zoomElement=void 0,this.zoomCanvas=void 0);}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t);}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");n&&t.removeChild(n);}}]),t}(Y),$n=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.multiTouchDragCallback=e._dragCallback.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport;if(t.numPointers===this.configuration.touchPointers){var o=this._getTranslation(t);this._applyTranslation(a,o),f.cornerstone.setViewport(n,a);}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,o=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/o,y:a.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y;}}]),t}(Y),ea=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Pan",supportedInteractionTypes:["Mouse","Touch"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.touchDragCallback=e._dragCallback.bind(ut()(ut()(e))),e.mouseDragCallback=e._dragCallback.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=this._getTranslation(t);this._applyTranslation(a,o),f.cornerstone.setViewport(n,a);}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,o=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/o,y:a.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y;}}]),t}(Y),ta=n(7),na=n.n(ta),aa=n(8),oa=n.n(aa),ia=function(e,t,n,a){var o=f.cornerstone,i=o.getEnabledElement(n).image,r=o.getEnabledElement(a).image;if(i&&r){var s=o.metaData.get("imagePlaneModule",i.imageId),l=o.metaData.get("imagePlaneModule",r.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=Un(s.rowCosines),s.columnCosines=Un(s.columnCosines),s.imagePositionPatient=Un(s.imagePositionPatient),l.rowCosines=Un(l.rowCosines),l.columnCosines=Un(l.columnCosines),l.imagePositionPatient=Un(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var h=function(e,t){var n=Fn(e,t);if(n)return {start:Nn(n.start,e),end:Nn(n.end,e)}}(s,l);if(h){var v=_e.getActiveColor();e.setTransform(1,0,0,1,0,0),Oe(e,function(e){Le(e,t.element,h.start,h.end,{color:v});});}}}}},ra=function(e){return new Promise(function(t){return setTimeout(t,e)})};function sa(e){try{var t=f.cornerstone.getEnabledElement(e);return t.image?t:ra(250).then(function(){return sa(e)})}catch(e){return null}}var la,ca=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:ia}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e.renderer=null,e.synchronizationContext=null,e}var n;return h()(t,e),r()(t,[{key:"enabledCallback",value:(n=oa()(na.a.mark(function e(t){var n,a,o,i=arguments;return na.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},a=n.synchronizationContext,o=this.configuration.renderer,e.next=4,sa(t);case 4:if(e.sent&&o&&a){e.next=8;break}return console.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=o,this.synchronizationContext=a,this.forceImageUpdate(t);case 11:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e);}},{key:"forceImageUpdate",value:function(e){f.cornerstone.getEnabledElement(e).image&&f.cornerstone.updateImage(e);}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var a=this.synchronizationContext.getSourceElements(),o=Ze(n.canvasContext.canvas);f.cornerstone.setToPixelCoordinateSystem(n.enabledElement,o),a.forEach(function(a){a!==e.currentTarget&&t.renderer(o,n,e.currentTarget,a);});}}}]),t}(Y),ua=function(e,t,n){var a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),i=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return {angle:180*Math.acos((Math.pow(a,2)+Math.pow(o,2)-Math.pow(i,2))/(2*a*o))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},da=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Rotate",strategies:{default:ha,horizontal:va,vertical:ga},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"]},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e);}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e);}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation;}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e,this.configuration),f.cornerstone.setViewport(e.detail.element,e.detail.viewport);}}]),t}(Y),ha=function(e){var t=e.detail,n=t.element,a=t.viewport,o=a.initialRotation,i=n.getBoundingClientRect(n),r=n.clientWidth,s=n.clientHeight,l={x:t.startPoints.client.x,y:t.startPoints.client.y},c=a.scale,u=a.translation,d={x:i.left+r/2+u.x*c,y:i.top+s/2+u.y*c},h={x:t.currentPoints.client.x,y:t.currentPoints.client.y},v=ua(d,l,h);v.direction<0&&(v.angle=-v.angle),a.rotation=o+v.angle;},va=function(e){var t=e.detail,n=t.viewport,a=t.deltaPoints;n.rotation+=a.page.x/n.scale;},ga=function(e){var t=e.detail,n=t.viewport,a=t.deltaPoints;n.rotation+=a.page.y/n.scale;},ma=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.rotation;a.rotation+=o,f.cornerstone.setViewport(n,a);}}]),t}(Y),fa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e);}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e);}},{key:"forceImageUpdate",value:function(e){f.cornerstone.getEnabledElement(e).image&&f.cornerstone.updateImage(e);}},{key:"renderToolData",value:function(e){var t=e.detail,n=Ze(t.canvasContext.canvas),a=t.image,o=t.viewport,i=t.element,r=a.rowPixelSpacing,s=a.columnPixelSpacing,l=f.cornerstone.metaData.get("imagePlaneModule",a.imageId);if(l&&(r=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),r&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/r*o.scale,d=10/s*o.scale,h=pa(c,.25,.05),v=pa(c,.05,.15);if(c.width&&c.height&&h&&v){var g=_e.getToolColor(),m=Ie.getToolWidth(),p=Object.assign({},{hscaleBounds:h,vscaleBounds:v,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:v.bottomRight.x,y:v.topLeft.y},end:{x:v.bottomRight.x,y:v.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:g,lineWidth:m},this.configuration);Oe(n,function(e){Qe(e,p),Le(e,i,p.verticalLine.start,p.verticalLine.end,{color:g,lineWidth:m},"canvas"),ya(e,i,p),Le(e,i,p.horizontalLine.start,p.horizontalLine.end,{color:g,lineWidth:m},"canvas"),xa(e,i,p);});}}else console.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"));}}]),t}(Y),pa=function(e,t,n){var a=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),i={left:a,top:o,width:e.width-2*a,height:e.height-2*o};return {topLeft:{x:i.left,y:i.top},bottomRight:{x:i.left+i.width,y:i.top+i.height}}},ya=function(e,t,n){for(var a=0;n.verticalLine.start.y+a*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var o=n.color,i=n.lineWidth,r={x:n.verticalLine.start.x,y:n.verticalLine.start.y+a*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+a*n.verticalMinorTick};s.x=a%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Le(e,t,r,s,{color:o,lineWidth:i},"canvas"),a++;}},xa=function(e,t,n){for(var a=0;n.horizontalLine.start.x+a*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var o=n.color,i=n.lineWidth,r={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:0};s.y=a%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Le(e,t,r,s,{color:o,lineWidth:i},"canvas"),a++;}},Ta={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function ba(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return /trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function Ea(){return la||Ma()}function Ma(){var e=ba().split(" "),t=e[0],n=e[1],a=Ta[t];return a?a[n]?a[n]:a.default:Ta.default}var Ca={interaction:[],thumbnail:[],prefetch:[]},wa={interaction:0,thumbnail:0,prefetch:0},Ia={interaction:6,thumbnail:6,prefetch:5},Sa=!1,ka=20;function Pa(){Sa&&setTimeout(function(){Oa();},ka);}function _a(e){var t=f.cornerstone,n=e.type;wa[n]++,Sa=!0;var a=e.imageId,o=e.doneCallback,i=e.failCallback,r=t.imageCache.getImageLoadObject(a);if(r)r.promise.then(function(e){wa[n]--,o(e),Pa();},function(e){wa[n]--,i(e),Pa();});else{var s=function(e){return "prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(a,{priority:s,type:e.type}):t.loadAndCacheImage(a,{priority:s,type:e.type})).then(function(e){wa[n]--,o(e),Pa();},function(e){wa[n]--,i(e),Pa();});}}function Oa(){var e=Ea();Ia={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(wa.interaction+wa.thumbnail+wa.prefetch),n=0;n<t;n++){var a=Da();a&&_a(a);}}function Da(){return Ca.interaction.length&&wa.interaction<Ia.interaction?Ca.interaction.shift():Ca.thumbnail.length&&wa.thumbnail<Ia.thumbnail?Ca.thumbnail.shift():Ca.prefetch.length&&wa.prefetch<Ia.prefetch?Ca.prefetch.shift():(Ca.interaction.length||Ca.thumbnail.length||Ca.prefetch.length||(Sa=!1),!1)}var La={addRequest:function(e,t,n,a,o,i,r){if(!Ca.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var s={type:n,imageId:t,preventCache:a,doneCallback:o,failCallback:i},l=f.cornerstone.imageCache.getImageLoadObject(t);l?l.promise.then(function(e){o(e);},function(e){i(e);}):(r?Ca[n].unshift(s):Ca[n].push(s),Sa=!0);}},clearRequestStack:function(e){if(!Ca.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");Ca[e]=[];},startGrabbing:Oa,getRequestPool:function(){return Ca}},Aa=function(e,t){var n=Q(e,"stack");if(n&&n.data&&n.data.length){var a,o=f.cornerstone;if(n.data.length>1){var i=Q(e,"stackRenderer");i&&i.data&&i.data.length&&(a=i.data[0]);}var r=n.data[0];t<0&&(t+=r.imageIds.length);var s=Rn.getStartLoadHandler(),l=Rn.getEndLoadHandler(),c=Rn.getErrorLoadingHandler();if(t!==r.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-r.currentImageIdIndex};r.currentImageIdIndex=t;var d=r.imageIds[t];(Boolean(r.preventCache)?o.loadImage(d):o.loadAndCacheImage(d)).then(function(i){if(r.currentImageIdIndex===t){try{o.getEnabledElement(e);}catch(e){return}a?(a.currentImageIdIndex=t,a.render(e,n.data)):o.displayImage(e,i),l&&l(e,i);}},function(n){var a=r.imageIds[t];c&&c(e,a,n);}),La.startGrabbing(),T(e,x.STACK_SCROLL,u);}}},Ha=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Q(e,"stack");if(o&&o.data&&o.data.length){var i=o.data[0];i.pending||(i.pending=[]);var r=i.currentImageIdIndex+t;if(n)r%=i.imageIds.length;else r=se(r,0,i.imageIds.length-1);if(a)Aa(e,r);else{var s={index:r};i.pending.push(s),function e(t,n,a){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],a));a.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,function e(o){t.imageIds.indexOf(o.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),a.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,e),t.pending.length>0&&function e(t,n,a){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],a));a.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,function o(i){t.imageIds.indexOf(i.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),a.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,o),t.pending.length>0&&e(t,t.pending[0],a));}),Aa(a,n.index);}}(t,t.pending[0],a));}),Aa(a,n.index);}}(i,s,e);}}};var Ua=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,a=t.element,o=this.configuration,i=o.loop,r=o.allowSkipping,s=o.invert;Ha(a,s?-n:n,i,r);}}]),t}(Y),Na=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.multiTouchDragCallback=e._dragCallback.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,a=t.deltaPoints,o=this.configuration,i=o.loop,r=o.allowSkipping,s=jn(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);Ha(n,u,i,r),s.deltaY=c%l;}else s.deltaY=c;zn(this.name,n,s);}}},{key:"_getDeltaY",value:function(e,t){return (jn(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(Y),Ba=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.mouseDragCallback=e._dragCallback.bind(ut()(ut()(e))),e.touchDragCallback=e._dragCallback.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.deltaPoints,o=this.configuration,i=o.loop,r=o.allowSkipping,s=jn(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);Ha(n,u,i,r),s.deltaY=c%l;}else s.deltaY=c;zn(this.name,n,s);}}},{key:"_getDeltaY",value:function(e,t){return (jn(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(Y),Fa=function(e,t,n,a,o){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i,r,s,l=f.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(r=0;r<o;r++)for(s=0;s<a;s++){var h=d[i=4*((r+n)*l.columns+(s+t))],v=d[i+1],g=d[i+2];c[u++]=.2126*h+.7152*v+.0722*g;}else for(r=0;r<o;r++)for(s=0;s<a;s++)i=(r+n)*l.columns+(s+t),c[u++]=d[i]*l.slope+l.intercept;return c},Va=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(ut()(ut()(e))),e.touchDragCallback=e._setHandlesAndUpdate.bind(ut()(ut()(e))),e.touchEndCallback=e._applyStrategy.bind(ut()(ut()(e))),e.postMouseDownCallback=e._startOutliningRegion.bind(ut()(ut()(e))),e.mouseClickCallback=e._startOutliningRegion.bind(ut()(ut()(e))),e.mouseDragCallback=e._setHandlesAndUpdate.bind(ut()(ut()(e))),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(ut()(ut()(e))),e.mouseUpCallback=e._applyStrategy.bind(ut()(ut()(e))),e}return h()(t,e),r()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,o=_e.getColorIfActive({active:!0}),i=Ze(n.canvasContext.canvas);Oe(i,function(e){Ke(e,a,t.handles.start,t.handles.end,{color:o});});}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return ja(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),f.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,f.cornerstone.updateImage(t);}},{key:"_applyStrategy",value:function(e){ja(this.handles.start)||ja(this.handles.end)||(e.detail.handles=this.handles,za(e,this.configuration),this._resetHandles());}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}};}}]),t}(Y),ja=function(e){return 0===Object.keys(e).length&&e.constructor===Object},za=function(e,t){var n=e.detail,a=n.image,o=n.element,i=e.detail.handles,r=i.start,s=i.end,l=Math.min(r.x,s.x),c=Math.min(r.y,s.y),u=Math.abs(r.x-s.x),d=Math.abs(r.y-s.y);l=se(l,0,a.width),c=se(c,0,a.height),u=Math.floor(Math.min(u,Math.abs(a.width-l))),d=Math.floor(Math.min(d,Math.abs(a.height-c)));var h=Fa(o,l,c,u,d),v=Wa(h,a.minPixelValue,a.maxPixelValue),g=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),g.voi.windowWidth=Math.max(Math.abs(v.max-v.min),t.minWindowWidth),g.voi.windowCenter=v.mean,f.cornerstone.setViewport(o,g),f.cornerstone.updateImage(o);},Wa=function(e,t,n){var a=e.length,o=n,i=t,r=0;if(a<2)return {min:o,max:i,mean:(t+n)/2};for(var s=0;s<a;s++){var l=e[s];o=Math.min(o,l),i=Math.max(i,l),r+=l;}return {min:o,max:i,mean:r/a}},Ga=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Wwwc",strategies:{basicLevelingStrategy:qa},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),f.cornerstone.setViewport(e.detail.element,e.detail.viewport);}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),f.cornerstone.setViewport(e.detail.element,e.detail.viewport);}}]),t}(Y);function qa(e,t){var n=t.orientation,a=e.detail,o=(a.image.maxPixelValue*a.image.slope+a.image.intercept-(a.image.minPixelValue*a.image.slope+a.image.intercept))/1024,i=a.deltaPoints.page.x*o,r=a.deltaPoints.page.y*o;0===n?(a.viewport.voi.windowWidth+=i,a.viewport.voi.windowCenter+=r):(a.viewport.voi.windowWidth+=r,a.viewport.voi.windowCenter+=i);}var Ya=function(e,t,n){var a=n.maxScale,o=n.minScale,i=Math.log(e.scale)/Math.log(1.7)+t,r=Math.pow(1.7,i);return e.scale=a&&r>a?a:o&&r<o?o:r,e},Xa={changeViewportScale:Ya,correctShift:function(e,t){var n=t.hflip,a=t.vflip,o=t.rotation;if(e.x*=n?-1:1,e.y*=a?-1:1,0!==o){var i=o*Math.PI/180,r=Math.cos(i),s=Math.sin(i),l=e.x*r-e.y*s,c=e.x*s+e.y*r;e.x=l,e.y=c;}return e}},Ka=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.spinY,i=this.configuration,r=i.invert,s=i.maxScale,l=i.minScale,c=Ya(a,r?o/4:-o/4,{maxScale:s,minScale:l});f.cornerstone.setViewport(n,c);}}]),t}(Y),Za=Xa.correctShift,Ja=Xa.changeViewportScale,Qa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Zoom",strategies:{default:eo,translate:to,zoomToCenter:no},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20}},i=Object.assign(a,n);return (e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"touchDragCallback",value:function(e){$a.call(this,e);}},{key:"mouseDragCallback",value:function(e){$a.call(this,e);}}]),t}(Y),$a=function(e){if(!e.detail.deltaPoints.page.y)return !1;this.applyActiveStrategy(e,this.configuration),f.cornerstone.setViewport(e.detail.element,e.detail.viewport);};function eo(e,t){var n=t.invert,a=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],v=u[2],g=u[3],m=Ja(c,r,{maxScale:a,minScale:o});f.cornerstone.setViewport(l,m);var p=f.cornerstone.pageToPixel(l,d,h),y={x:v-p.x,y:g-p.y};y=Za(y,m),c.translation.x-=y.x,c.translation.y-=y.y;}function to(e,t){var n=t.invert,a=t.preventZoomOutsideImage,o=t.maxScale,i=t.minScale,r=e.detail.deltaPoints.page.y,s=n?-r/100:r/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],v=Ja(c,s,{maxScale:o,minScale:i}),g={x:0,y:0};if(s<0)v.scale<3&&(Math.abs(v.translation.x)<.01?v.translation.x=0:g.x=v.translation.x/8,Math.abs(v.translation.y)<.01?v.translation.y=0:g.y=v.translation.y/8);else{a&&le(e.detail.startPoints.image,l);var m={x:l.width/2-d,y:l.height/2-h};m=Za(m,v);var f={x:v.translation.x-m.x,y:v.translation.y-m.y};Math.abs(f.x)<.01?v.translation.x=m.x:g.x=f.x/8,Math.abs(f.y)<.01?v.translation.y=m.y:g.y=f.y/8;}v.translation.x-=g.x,v.translation.y-=g.y;}function no(e,t){var n=t.invert,a=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail.viewport;Ja(s,r,{maxScale:a,minScale:o});}var ao=Xa.correctShift,oo=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}},n);return (e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.scaleChange,i=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],r=i[0],s=i[1],l=i[2],c=i[3],u=this.configuration,d=u.maxScale,h=u.minScale;a.scale+=o*a.scale,d&&a.scale>d?a.scale=d:h&&a.scale<h&&(a.scale=h),f.cornerstone.setViewport(n,a);var v=f.cornerstone.pageToPixel(n,r,s),g={x:l-v.x,y:c-v.y};g=ao(g,a),a.translation.x-=g.x,a.translation.y-=g.y,f.cornerstone.setViewport(n,a);}}]),t}(Y),io=function(e){return {page:ro(e.page),image:ro(e.image),client:ro(e.client),canvas:ro(e.canvas)}};function ro(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return {x:e.x,y:e.y}}var so,lo={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",13:"RETURN",8:"BACKSPACE",9:"TAB",46:"DELETE",12:"DELETE",27:"ESCAPE",20:"CAPSLOCK",173:"-",189:"-",109:"-",61:"+",187:"+",107:"+",219:"[",221:"]",59:";",186:";",188:",",190:".",199:"/"},co={"base/BaseTool":Y,"base/BaseAnnotationTool":Me,"base/BaseBrushTool":Cn,"manipulators/anyHandlesOutsideImage":re,"manipulators/getHandleNearImagePoint":oe,"manipulators/handleActivator":ie,"manipulators/moveAllHandles":de,"manipulators/moveHandle":me,"manipulators/moveNewHandle":ye,"manipulators/moveHandleNearImagePoint":Te,"manipulators/findHandleDataNearImagePoint":be,"manipulators/moveAnnotation":Ee,"mixins/activeOrDisabledBinaryTool":q.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":q.enabledOrDisabledBinaryTool,"drawing/getNewContext":Ze,"drawing/draw":Oe,"drawing/path":De,"drawing/setShadow":Qe,"drawing/drawLine":Le,"drawing/drawLines":function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";De(e,a,function(e){n.forEach(function(n){var a=n.start,i=n.end;if("pixel"===o){var r=f.cornerstone;a=r.pixelToCanvas(t,a),i=r.pixelToCanvas(t,i);}e.moveTo(a.x,a.y),e.lineTo(i.x,i.y);});});},"drawing/drawJoinedLines":Ae,"drawing/drawCircle":Re,"drawing/drawEllipse":Ue,"drawing/drawRect":Ke,"drawing/fillOutsideRect":function(e,t,n,a,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=f.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a);}var r=Math.min(n.x,a.x),s=Math.min(n.y,a.y),l=Math.abs(n.x-a.x),c=Math.abs(n.y-a.y);De(e,o,function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(r+l,s,-l,c);});},"drawing/drawTextBox":Ye,"drawing/drawArrow":He,"drawing/fillBox":Ge,"drawing/fillTextLines":We,"drawing/drawLink":Be,"drawing/drawLinkedTextBox":Xe,"drawing/drawHandles":Ne,"drawing/textBoxWidth":qe,"util/getLuminance":Fa,"util/copyPoints":io,"util/calculateSUV":Rt,"util/setContextToDisplayFontSize":function(e,t,n){return f.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":Aa,"util/scroll":Ha,"util/roundToDecimal":nt,"util/projectPatientPointToImagePlane":Nn,"util/imagePointToPatientPoint":Bn,"util/planePlaneIntersection":Fn,"util/pointInsideBoundingBox":ne,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return !1},!0===t&&(e.style.pointerEvents="none");},"util/getRGBPixels":mn,"util/getDefaultSimultaneousRequests":Ma,"util/getMaxSimultaneousRequests":Ea,"util/getBrowserInfo":ba,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":ua,"util/getKeyFromKeyCode":function(e){return lo[e]},"util/numbersWithCommas":Nt,"util/lineSegDistance":tt,"util/triggerEvent":T,"util/convertToVectro3":Un,"util/ellipseUtils":Ft,"util/freehandUtils":rn,"util/brushUtils":wn,"util/zoomUtils":Xa},uo=function(e){return co[e]},ho=!0,vo=200;function go(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function mo(){ho=!1;}function fo(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){var a=x.MOUSE_DOUBLE_CLICK,o={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=f.cornerstone.pixelToCanvas(t,o.image);var i=io(o);console.log("double-click: ".concat(go(e))),T(t,a,{event:e,buttons:go(e),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:i,currentPoints:o,deltaPoints:{x:0,y:0},type:a});}}function po(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){so=setTimeout(mo,vo),t.removeEventListener("mousemove",yo);var a={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=f.cornerstone.pixelToCanvas(t,a.image);var o=io(a),i={event:e,buttons:go(e),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:a,deltaPoints:{x:0,y:0},type:x.MOUSE_DOWN};T(i.element,x.MOUSE_DOWN,i)&&(i.type=x.MOUSE_DOWN_ACTIVATE,T(i.element,x.MOUSE_DOWN_ACTIVATE,i)),document.addEventListener("mousemove",r),document.addEventListener("mouseup",function e(i){clearTimeout(so);var s=x.MOUSE_UP;ho&&(s=x.MOUSE_CLICK);var l={page:f.cornerstoneMath.point.pageToPoint(i),image:f.cornerstone.pageToPixel(t,i.pageX,i.pageY),client:{x:i.clientX,y:i.clientY}};l.canvas=f.cornerstone.pixelToCanvas(t,l.image);var c={page:f.cornerstoneMath.point.subtract(l.page,o.page),image:f.cornerstoneMath.point.subtract(l.image,o.image),client:f.cornerstoneMath.point.subtract(l.client,o.client),canvas:f.cornerstoneMath.point.subtract(l.canvas,o.canvas)};console.log("mouseup: ".concat(go(i)));var u={event:i,buttons:go(i),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:l,deltaPoints:c,type:s};T(u.element,s,u),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e),t.addEventListener("mousemove",yo),ho=!0;});}function r(e){var i=x.MOUSE_DRAG,r={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=f.cornerstone.pixelToCanvas(t,r.image);var s={page:f.cornerstoneMath.point.subtract(r.page,o.page),image:f.cornerstoneMath.point.subtract(r.image,o.image),client:f.cornerstoneMath.point.subtract(r.client,o.client),canvas:f.cornerstoneMath.point.subtract(r.canvas,o.canvas)};console.log("mousemove ".concat(go(e)));var l={buttons:go(e),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:r,deltaPoints:s,type:i,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};T(l.element,i,l),o=io(r);}}function yo(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){var a=x.MOUSE_MOVE,o={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=f.cornerstone.pixelToCanvas(t,o.image);var i=io(o),r={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=f.cornerstone.pixelToCanvas(t,r.image);var s={page:f.cornerstoneMath.point.subtract(r.page,i.page),image:f.cornerstoneMath.point.subtract(r.image,i.image),client:f.cornerstoneMath.point.subtract(r.client,i.client),canvas:f.cornerstoneMath.point.subtract(r.canvas,i.canvas)};T(t,a,{viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:i,currentPoints:r,deltaPoints:s,type:a}),i=io(r);}}function xo(e){e.removeEventListener("mousedown",po),e.removeEventListener("mousemove",yo),e.removeEventListener("dblclick",fo);}var To={enable:function(e){xo(e),e.addEventListener("mousedown",po),e.addEventListener("mousemove",yo),e.addEventListener("dblclick",fo);},disable:xo},bo=function(e){var t=0,n=0,a=0,o=0;return "detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),a=10*t,o=10*n,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(a=e.deltaX),(a||o)&&e.deltaMode&&(1===e.deltaMode?(a*=40,o*=40):(a*=800,o*=800)),a&&!t&&(t=a<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:t,spinY:n,pixelX:a,pixelY:o}};function Eo(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){e.preventDefault();var a=e.pageX,o=e.pageY,i=f.cornerstone.pageToPixel(t,a,o),r=bo(e),s=r.spinX,l=r.spinY,c=r.pixelX,u=r.pixelY,d=l<0?-1:1,h={element:t,viewport:f.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:a,pageY:o,imageX:i.x,imageY:i.y};T(t,x.MOUSE_WHEEL,h);}}function Mo(e){e.removeEventListener("wheel",Eo,{passive:!1});}var Co,wo,Io={enable:function(e){Mo(e),e.addEventListener("wheel",Eo,{passive:!1});},disable:Mo},So=2e3,ko={mouse:0,touch:1};function Po(e,t){var n=Date.now();if(e!==Co){if(n-wo<=So)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;Co=e;}wo=n;}var _o=Po.bind(null,ko.mouse),Oo=Po.bind(null,ko.touch);function Do(e,t,n){var a=n?_o:Oo;t.forEach(function(t){e.addEventListener(t,a,{passive:!1});});}function Lo(e,t,n){var a=n?_o:Oo;t.forEach(function(t){e.removeEventListener(t,a);});}var Ao=["mousedown","mouseup"],Ho=["touchstart","touchend"];function Ro(e){Lo(e,Ao,ko.mouse),Lo(e,Ho,ko.touch);}var Uo,No,Bo,Fo,Vo,jo,zo,Wo,Go,qo={enable:function(e){Ro(e),Do(e,Ao,ko.mouse),Do(e,Ho,ko.touch);},disable:Ro},Yo=1,Xo=0,Ko=!1,Zo=!1,Jo=700,Qo=5,$o="touchInput";function ei(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){var a,o,i,r;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(Zo=!1,clearTimeout(zo)),e.type){case"tap":Zo=!1,clearTimeout(zo),(No={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,No.image),a=x.TAP,Vo={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:No,type:a,isTouchEvent:!0},T(t,a,Vo);break;case"doubletap":Zo=!1,clearTimeout(zo),(No={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,No.image),a=x.DOUBLE_TAP,Vo={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:No,type:a,isTouchEvent:!0},T(t,a,Vo);break;case"pinchstart":Zo=!1,clearTimeout(zo),Yo=1;break;case"pinchmove":if(Zo=!1,clearTimeout(zo),!0===Ko){Yo=e.scale,Ko=!1;break}o=(e.scale-Yo)/Yo,(Uo={page:e.center,image:f.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=f.cornerstone.pixelToCanvas(t,Uo.image),a=x.TOUCH_PINCH,Vo={event:e,startPoints:Uo,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:o,type:a,isTouchEvent:!0},T(t,a,Vo),Yo=e.scale;break;case"touchstart":Yo=1,clearTimeout(zo),clearTimeout(jo),jo=setTimeout(function(){(Uo={page:f.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Uo.image),a=x.TOUCH_START,e.touches.length>1&&(a=x.MULTI_TOUCH_START),Vo={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Uo,currentPoints:Uo,type:a,isTouchEvent:!0},!0===T(t,a,Vo)&&(a=x.TOUCH_START_ACTIVE,e.touches.length>1&&(a=x.MULTI_TOUCH_START_ACTIVE),Vo.type=a,T(t,a,Vo)),Bo=io(Uo);},50),Zo=!0,Wo=0,zo=setTimeout(function(){Zo&&((No={page:f.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Uo.image),a=x.TOUCH_PRESS,Vo={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:No,type:a,isTouchEvent:!0},T(t,a,Vo));},Jo);break;case"touchend":Yo=1,Zo=!1,clearTimeout(zo),setTimeout(function(){(Uo={page:f.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:f.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Uo.image),a=x.TOUCH_END,Vo={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Uo,currentPoints:Uo,type:a,isTouchEvent:!0},T(t,a,Vo);},50);break;case"panmove":i={x:e.deltaX-Go.x,y:e.deltaY-Go.y},Go={x:e.deltaX,y:e.deltaY},(No={page:{x:Bo.page.x+i.x,y:Bo.page.y+i.y},image:f.cornerstone.pageToPixel(t,Bo.page.x+i.x,Bo.page.y+i.y),client:{x:Bo.client.x+i.x,y:Bo.client.y+i.y}}).canvas=f.cornerstone.pixelToCanvas(t,No.image),Fo={page:f.cornerstoneMath.point.subtract(No.page,Bo.page),image:f.cornerstoneMath.point.subtract(No.image,Bo.image),client:f.cornerstoneMath.point.subtract(No.client,Bo.client),canvas:f.cornerstoneMath.point.subtract(No.canvas,Bo.canvas)},(Wo+=Math.sqrt(Fo.page.x*Fo.page.x+Fo.page.y*Fo.page.y))>Qo&&(Zo=!1,clearTimeout(zo)),a=x.TOUCH_DRAG,e.pointers.length>1&&(a=x.MULTI_TOUCH_DRAG),Vo={viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Uo,lastPoints:Bo,currentPoints:No,deltaPoints:Fo,numPointers:e.pointers.length,type:a,isTouchEvent:!0},T(t,a,Vo),Bo=io(No);break;case"panstart":Go={x:e.deltaX,y:e.deltaY},(No={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,No.image),Bo=io(No);break;case"panend":if(Zo=!1,clearTimeout(zo),!Bo)return !1;(No={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,No.image),Fo={page:f.cornerstoneMath.point.subtract(No.page,Bo.page),image:f.cornerstoneMath.point.subtract(No.image,Bo.image),client:f.cornerstoneMath.point.subtract(No.client,Bo.client),canvas:f.cornerstoneMath.point.subtract(No.canvas,Bo.canvas)},a=x.TOUCH_DRAG_END,Vo={event:e.srcEvent,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Uo,lastPoints:Bo,currentPoints:No,deltaPoints:Fo,type:a,isTouchEvent:!0},T(t,a,Vo),2===e.pointers.length-e.changedPointers.length&&(Ko=!0);break;case"rotatemove":Zo=!1,clearTimeout(zo),r=e.rotation-Xo,Xo=e.rotation,a=x.TOUCH_ROTATE,Vo={event:e.srcEvent,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,rotation:r,type:a},T(t,a,Vo);}return !1}}function ti(e){qo.disable(e);["touchstart","touchend"].forEach(function(t){e.removeEventListener(t,ei);});var t=jn($o,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",ei);}var ni={enable:function(e){ti(e);var t=f.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},a=new t.Manager(e,n),o={pointers:0,direction:t.DIRECTION_ALL,threshold:0},i=new t.Pan(o),r=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});r.recognizeWith(i),r.recognizeWith(s),s.recognizeWith(i);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(i),a.add([l,i,s,r]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",ei),qo.enable(e),["touchstart","touchend"].forEach(function(t){e.addEventListener(t,ei,{passive:!1});});var c=jn($o,e);c.hammer=a,zn($o,e,c);},disable:ti},ai=function(e,t,n){return t.filter(function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])})};"createImageBitmap"in window||(window.createImageBitmap=function(){var e=oa()(na.a.mark(function e(t){return na.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var n=document.createElement("img");n.addEventListener("load",function(){e(this);});var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0,0,0,a.width,a.height),n.src=a.toDataURL();}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var oi=_.modules.brush,ii=oi.state,ri=oi.getters,si=oi.setters;function li(e,t,n){var a=e.detail.element,o=n.toolData,i=n.visibleSegmentations;return !!o.data[t].pixelData&&(!!i[t]||ii.drawColorId===t&&ai(a,_.state.tools).filter(function(e){return e instanceof Cn}).length>0)}function ci(e,t,n){var a=n.toolData,o=n.imageBitmapCache,i=n.visibleSegmentations;o&&o[t]&&function(e,t,n){var a=e.detail,o=Ze(a.canvasContext.canvas),i=f.cornerstone.pixelToCanvas(a.element,{x:0,y:0}),r=f.cornerstone.pixelToCanvas(a.element,{x:a.image.width,y:0}),s=f.cornerstone.pixelToCanvas(a.element,{x:a.image.width,y:a.image.height}),l=f.cornerstoneMath.point.distance(i,r),c=f.cornerstoneMath.point.distance(r,s),u=a.canvasContext.canvas,d=a.viewport;o.imageSmoothingEnabled=!1,o.globalAlpha=function(e){if(e)return ii.alpha;return ii.hiddenButActiveAlpha}(n),$e(o,u,d);var h={x:d.translation.x*d.scale,y:d.translation.y*d.scale};o.drawImage(t,u.width/2-l/2+h.x,u.height/2-c/2+h.y,l,c),o.globalAlpha=1,et(o);}(e,o[t],i[t]),a.data[t].invalidated&&function(e,t,n){var a=e.detail,o=a.element,i=f.cornerstone.getEnabledElement(o),r=t.data[n].pixelData,s=ii.colorMapId,l=[[0,0,0,0],f.cornerstone.colors.getColormap(s).getColor(n)],c=new ImageData(a.image.width,a.image.height),u={stats:{},minPixelValue:0,getPixelData:function(){return r}};f.cornerstone.storedPixelDataToCanvasImageDataColorLUT(u,l,c.data),window.createImageBitmap(c).then(function(e){si.imageBitmapCacheForElement(i.uuid,n,e),t.data[n].invalidated=!1,f.cornerstone.updateImage(a.element);});}(e,a,t);}var ui=function(e){var t=e.detail.element,n=S.tools.filter(function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)});n.filter(function(e){return e instanceof Cn}).length>0&&function(e){var t=e.detail,n=t.element,a=Cn.getNumberOfColors(),o=Q(n,Cn.getReferencedToolDataName());if(!o){for(var i=0;i<a;i++)J(n,Cn.getReferencedToolDataName(),{});o=Q(n,Cn.getReferencedToolDataName());var r=new Uint8ClampedArray(t.image.width*t.image.height);o.data[0].pixelData=r,o=Q(n,Cn.getReferencedToolDataName());}for(var s=f.cornerstone.getEnabledElement(n).uuid,l={visibleSegmentations:ri.visibleSegmentationsForElement(s),imageBitmapCache:ri.imageBitmapCacheForElement(s),toolData:o},c=0;c<a;c++)li(e,c,l)&&ci(e,c,l);}(e),n.forEach(function(t){t.renderToolData&&t.renderToolData(e);});},di=function(e){e.addEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,ui);},hi=function(e){e.removeEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,ui);},vi=function(e,t,n){if(S.isToolLocked)return !1;var a=n.detail.element,o=S.tools.filter(function(t){return t.supportedInteractionTypes.includes(e)});if(0===(o=(o=ai(a,o,e)).filter(function(e){return "function"==typeof e[t]})).length)return !1;o[0][t](n);},gi=function(e,t,n){var a="mouse"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")?S.clickProximity:S.touchProximity;return t.filter(function(t){for(var o=Q(e,t.name),i=0;i<o.data.length;i++)if(void 0!==oe(e,o.data[i].handles,n,a))return !0;return !1})},mi=function(e,t){return t.filter(function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)})},fi=function(e,t){return t.filter(function(t){var n=Q(e,t.name);return n&&n.data.length>0})},pi=function(e){if(!S.isToolLocked){var t=e.detail,n=e.detail.element,a=e.detail.currentPoints.canvas,o=mi(n,k.mouseTools()),i=o.filter(function(e){return "active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive});if(i.length>0){var r=i.find(function(e){return "function"==typeof e.preMouseDownCallback});if(r)if(r.preMouseDownCallback(e))return}var s=fi(n,o),l=gi(n,s,a,"mouse");if(l.length>0){var c=l[0],u=Q(n,c.name),d=be(n,u,c.name,a),h=d.handle,v=d.data;c.handleSelectedCallback(e,v,h,"mouse");}else{var g=o.filter(function(e){var t=Q(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a,"mouse")})});if(g.length>0){var m=g[0],f=Q(n,m.name).data.find(function(e){return m.pointNearTool(n,e,a)});m.toolSelectedCallback(e,f,"mouse");}else if(i.length>0){var p=i.find(function(e){return "function"==typeof e.postMouseDownCallback});if(p)if(p.postMouseDownCallback(e))return}}}},yi=function(e){if(!S.isToolLocked){var t=e.detail,n=t.element,a=ai(n,k.mouseTools());if(0!==(a=a.filter(function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive})).length){var o=a[0];if("function"==typeof o.preMouseDownActivateCallback)if(o.preMouseDownActivateCallback(e))return;o.addNewMeasurement?o.addNewMeasurement(e,"mouse"):o instanceof Me&&function(e,t){e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,o=t.createNewMeasurement(n);o&&(J(a,t.name,o),f.cornerstone.updateImage(a),(1===Object.keys(o.handles).length?me:ye)(n,t.name,o,o.handles.end,t.options,"mouse"));}(e,o);}}},xi=function(e){if(!S.isToolLocked){var t,n=e.detail,a=n.element;if(0!==(t=(t=(t=ai(a,k.mouseTools())).filter(function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive})).filter(function(e){return "function"==typeof e.mouseDragCallback})).length)t[0].mouseDragCallback(e);}},Ti=function(e){if(!S.isToolLocked){var t,n=e.detail,a=n.element,o=n.currentPoints;S.mousePositionImage=o.image;var i=(t=mi(a,k.mouseTools())).filter(function(e){return "active"===e.mode&&e.options.isMouseActive}),r=!1;i.length>0&&(r=i.some(function(e){return e.hasCursor})),t=fi(a,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(r=l.mouseMoveCallback(e)||r);}!0===r&&f.cornerstone.updateImage(a);}},bi=vi.bind(null,"Mouse","mouseClickCallback"),Ei=vi.bind(null,"Mouse","doubleClickCallback"),Mi=vi.bind(null,"Mouse","mouseUpCallback"),Ci=vi.bind(null,"MouseWheel","mouseWheelCallback"),wi=function(e){e.addEventListener(x.MOUSE_CLICK,bi),e.addEventListener(x.MOUSE_DOWN,pi),e.addEventListener(x.MOUSE_DOWN_ACTIVATE,yi),e.addEventListener(x.MOUSE_DOUBLE_CLICK,Ei),e.addEventListener(x.MOUSE_DRAG,xi),e.addEventListener(x.MOUSE_MOVE,Ti),e.addEventListener(x.MOUSE_UP,Mi),e.addEventListener(x.MOUSE_WHEEL,Ci);},Ii=function(e){e.removeEventListener(x.MOUSE_CLICK,bi),e.removeEventListener(x.MOUSE_DOWN,pi),e.removeEventListener(x.MOUSE_DOWN_ACTIVATE,yi),e.removeEventListener(x.MOUSE_DOUBLE_CLICK,Ei),e.removeEventListener(x.MOUSE_DRAG,xi),e.removeEventListener(x.MOUSE_MOVE,Ti),e.removeEventListener(x.MOUSE_UP,Mi),e.removeEventListener(x.MOUSE_WHEEL,Ci);},Si=(_.modules.brush.setters,function(e){if(S.isToolLocked)return !1;var t=e.detail.element,n=S.tools.filter(function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)});if(0===n.length)return !1;n.forEach(function(t){t.newImageCallback&&t.newImageCallback(e);}),n.filter(function(e){return e instanceof Cn}).length>0&&function(e){var t=e.detail,n=t.element,a=Q(n,Cn.getReferencedToolDataName());if(!a){for(var o=Cn.getNumberOfColors(),i=0;i<o;i++)J(n,Cn.getReferencedToolDataName(),{});a=Q(n,Cn.getReferencedToolDataName());var r=new Uint8ClampedArray(t.image.width*t.image.height);a.data[0].pixelData=r,a=Q(n,Cn.getReferencedToolDataName());}f.cornerstone.getEnabledElement(n);for(var s=Cn.getNumberOfColors(),l=0;l<s;l++)a.data[l].invalidated=!0;f.cornerstone.updateImage(t.element);}(e);}),ki=function(e){e.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,Si);},Pi=function(e){e.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,Si);},_i=function(e){if(S.isToolLocked)return !1;var t=e.detail,n=t.element,a=t.numPointers,o=S.tools.filter(function(e){return e.supportedInteractionTypes.includes("MultiTouch")});if(0===(o=(o=ai(n,o,"MultiTouch")).filter(function(e){return "function"==typeof e.multiTouchDragCallback&&a===e.configuration.touchPointers})).length)return !1;o[0].multiTouchDragCallback(e);},Oi=function(e){if(!S.isToolLocked){var t=e.detail.element,n=ai(t,k.touchTools());if(0!==(n=n.filter(function(e){return e.options.isTouchActive})).length){var a=n[0];a&&a.addNewMeasurement?a.addNewMeasurement(e,"touch"):a instanceof Me&&function(e,t){console.log("touch: addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,o=t.createNewMeasurement(n);if(o){if(J(a,t.name,o),1===Object.keys(o.handles).length&&n.type===x.TAP)return o.active=!1,o.handles.end.active=!1,o.handles.end.highlight=!1,o.invalidated=!0,(S.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&re(n,o.handles)&&$(a,t.name,o),void f.cornerstone.updateImage(a);f.cornerstone.updateImage(a),ye(n,t.name,o,o.handles.end,t.options,"touch");}}(e,a);}}},Di=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&Li(n.handles);}};function Li(e){Object.keys(e).forEach(function(t){e[t].active=!1;});}var Ai=function(e){if(!S.isToolLocked){var t,n=e.detail.element,a=e.detail.currentPoints.canvas;t=ai(n,k.touchTools());var o=(t=fi(n,t)).filter(function(e){for(var t=Q(n,e.name),o=0;o<t.data.length;o++)if(void 0!==oe(n,t.data[o].handles,a,28))return !0;return !1});if(o.length>0){var i=o[0],r=Q(n,i.name),s=r.data.find(function(e){return void 0!==oe(n,e.handles,a,28)});r.data.active=!0,s.active=!0,f.cornerstone.updateImage(n);var l=Object.assign({},{doneMovingCallback:function(){Di(r);}},i.options);return me(e.detail,i.name,r.data,s,l,"touch"),e.stopImmediatePropagation(),void e.preventDefault()}var c=t.filter(function(e){var t=Q(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a)})});if(c.length>0){var u=c[0],d=Q(n,u.name),h=d.data.find(function(e){return u.pointNearTool(n,e,a)});h.active=!0,f.cornerstone.updateImage(n);var v=Object.assign({},{doneMovingCallback:function(){Di(d);}},u.options);return de(e.detail,u.name,h,null,v,"touch"),e.stopImmediatePropagation(),void e.preventDefault()}var g=ai(n,k.touchTools());return g.length>0&&g[0].touchStartActiveCallback?g[0].touchStartActiveCallback(e):Oi(e),!1}},Hi=function(e){if(!S.isToolLocked){var t=e.detail,n=t.element,a=t.startPoints.canvas,o=mi(n,k.touchTools()),i=o.filter(function(e){return "active"===e.mode&&e.options.isTouchActive});if(i.length>0){var r=i.find(function(e){return "function"==typeof e.preTouchStartCallback});if(r)if(r.preTouchStartCallback(e))return}var s=fi(n,o),l=gi(n,s,a,"touch");if(l.length>0){var c=l[0],u=Q(n,c.name),d=be(n,u,c.name,a,"touch"),h=d.handle,v=d.data;c.handleSelectedCallback(e,v,h,"touch");}else{var g=s.filter(function(e){var t=Q(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a,"touch")})});if(g.length>0){var m=g[0],f=Q(n,m.name).data.find(function(e){return m.pointNearTool(n,e,a)});m.toolSelectedCallback(e,f,"touch");}else if(i.length>0){var p=i.find(function(e){return "function"==typeof e.postTouchStartCallback});if(p)if(p.postTouchStartCallback(e))return}}}},Ri=vi.bind(null,"DoubleTap","doubleTapCallback"),Ui=vi.bind(null,"Touch","touchDragCallback"),Ni=vi.bind(null,"Touch","touchEndCallback"),Bi=vi.bind(null,"TouchPinch","touchPinchCallback"),Fi=vi.bind(null,"Touch","touchPressCallback"),Vi=vi.bind(null,"TouchRotate","touchRotateCallback"),ji=function(e){e.addEventListener(x.TAP,Ai),e.addEventListener(x.TOUCH_START,Hi,{passive:!1}),e.addEventListener(x.TOUCH_DRAG,Ui,{passive:!1}),e.addEventListener(x.TOUCH_END,Ni),e.addEventListener(x.TOUCH_START_ACTIVE,Oi),e.addEventListener(x.TOUCH_PRESS,Fi),e.addEventListener(x.DOUBLE_TAP,Ri),e.addEventListener(x.TOUCH_PINCH,Bi),e.addEventListener(x.TOUCH_ROTATE,Vi),e.addEventListener(x.MULTI_TOUCH_DRAG,_i);},zi=function(e){e.removeEventListener(x.TAP,Ai),e.removeEventListener(x.TOUCH_START,Hi),e.removeEventListener(x.TOUCH_DRAG,Ui),e.removeEventListener(x.TOUCH_END,Ni),e.removeEventListener(x.TOUCH_START_ACTIVE,Oi),e.removeEventListener(x.TOUCH_PRESS,Fi),e.removeEventListener(x.DOUBLE_TAP,Ri),e.removeEventListener(x.TOUCH_PINCH,Bi),e.removeEventListener(x.TOUCH_ROTATE,Vi),e.removeEventListener(x.MULTI_TOUCH_DRAG,_i);},Wi=function(e,t,n){var a=new t(n);O(e,a.name)?console.warn("".concat(a.name," has already been added to the target element")):(a.element=e,_.state.tools.push(a));},Gi=function(e,t){qi(e,t),_.state.enabledElements.forEach(function(n){Wi(n,e,t);});},qi=function(e,t){if(_.modules.globalConfiguration.state.globalToolSyncEnabled){var n=new e(t);void 0!==_.state.globalTools[n.name]?console.warn("".concat(n.name," has already been added globally")):_.state.globalTools[n.name]={tool:e,configuration:t,activeBindings:[]};}},Yi=function(e){console.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;di(t),ki(t),_.modules.globalConfiguration.state.mouseEnabled&&(To.enable(t),Io.enable(t),wi(t)),_.modules.globalConfiguration.state.touchEnabled&&(ni.enable(t),ji(t)),Xi(t);},Xi=function(e){_.state.enabledElements.push(e),_.modules&&function(e){var t=_.modules;Object.keys(t).forEach(function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e);});}(e),function(e){if(!_.modules.globalConfiguration.state.globalToolSyncEnabled)return;Object.keys(_.state.globalTools).forEach(function(t){var n=_.state.globalTools[t],a=n.tool,o=n.configuration;Wi(e,a,o);});}(e),function(e){if(!_.modules.globalConfiguration.state.globalToolSyncEnabled)return;var t={active:D,passive:N,enabled:R,disabled:A};_.state.globalToolChangeHistory.forEach(function(n){var a=n.args.slice(0);a.unshift(e),t[n.mode].apply(null,a);});}(e);};var Ki=function(e){console.info("EVENT:ELEMENT_DISABLED");var t=e.detail.element;hi(t),Pi(t),_.modules.globalConfiguration.state.mouseEnabled&&(To.disable(t),Io.disable(t),Ii(t)),_.modules.globalConfiguration.state.touchEnabled&&(ni.disable(t),zi(t)),Zi(t),Ji(t);},Zi=function(e){_.state.tools=_.state.tools.filter(function(t){return t.element!==e});},Ji=function(e){_.modules&&function(e){var t=_.modules;Object.keys(t).forEach(function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e);});}(e);var t=_.state.enabledElements.findIndex(function(t){return t===e});t>-1?_.state.enabledElements.splice(t,1):console.warn("unable to remove element");};var Qi,$i=function(){window.removeEventListener("resize",er,!1);};function er(){Qi||(Qi=setTimeout(function(){Qi=null,tr();},66));}var tr=function(){S.enabledElements.forEach(function(e){f.cornerstone.resize(e);});},nr=function(){$i(),window.addEventListener("resize",er,!1);},ar=function(e){var t;!function(){!function(){var e=f.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,Yi),e.events.removeEventListener(n,Ki);}();var e=f.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,Yi),e.events.addEventListener(n,Ki);}(),t=_.modules,Object.keys(t).forEach(function(e){"function"==typeof t[e].onRegisterCallback&&t[e].onRegisterCallback();}),nr(),_.modules.globalConfiguration.state=Object.assign({},_.modules.globalConfiguration.state,e);};var or,ir="stackPrefetch",rr="prefetch",sr={maxImagesToPrefetch:1/0},lr=10;var cr=function(e){return Math.max.apply(null,e)},ur=function(e){return Math.min.apply(null,e)};function dr(e){var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],a=Q(e,ir);if(a){var o=a.data[0]||{};if(o.indicesToRequest&&o.indicesToRequest.length||(o.enabled=!1),!1!==o.enabled)if(a.data[0].indicesToRequest.sort(function(e,t){return e-t}),o.indicesToRequest.slice().forEach(function(e){var t=n.imageIds[e];t&&(f.cornerstone.imageCache.getImageLoadObject(t)&&b(e));}),o.indicesToRequest.length){La.clearRequestStack(rr);for(var i,r,s,l,c,u,d=(i=o.indicesToRequest,r=n.currentImageIdIndex,s=[],l=[],i.forEach(function(e){e<r?s.push(e):e>r&&l.push(e);}),{low:i.indexOf(cr(s)),high:i.indexOf(ur(l))}),h=Rn.getErrorLoadingHandler(),v=d.low,g=d.high;v>=0||g<o.indicesToRequest.length;){var m=n.currentImageIdIndex,p=m-o.indicesToRequest[v]>sr.maxImagesToPrefetch,y=o.indicesToRequest[g]-m>sr.maxImagesToPrefetch,x=!p&&v>=0,T=!y&&g<o.indicesToRequest.length;if(!T&&!x)break;x&&(u=o.indicesToRequest[v--],c=n.imageIds[u],La.addRequest(e,c,rr,!1,E,M)),T&&(u=o.indicesToRequest[g++],c=n.imageIds[u],La.addRequest(e,c,rr,!1,E,M));}La.startGrabbing();}}}function b(e){var t=o.indicesToRequest.indexOf(e);t>-1&&o.indicesToRequest.splice(t,1);}function E(e){b(n.imageIds.indexOf(e.imageId));}function M(t){console.log("prefetch errored: ".concat(t)),h&&h(e,c,t,"stackPrefetch");}}function hr(e){return function(t){var n,a=t.detail;try{n=Q(e,"stack");}catch(e){return}if(n&&n.data&&n.data.length){var o=n.data[0].imageIds.indexOf(a.imageId);if(!(o<0)){var i=Q(e,ir);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(o);}}}}function vr(e){clearTimeout(or),or=setTimeout(function(){var t=e.target;try{dr(t);}catch(e){return}},lr);}var gr={enable:function(e){Q(e,ir).data=[];var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var a={indicesToRequest:function(e,t){e=Math.round(e)||0;var n=[],a=(t=Math.round(t)||0)-e+1;if(a<=0)return n;for(;a--;)n[a]=t--;return n}(0,n.imageIds.length-1),enabled:!0,direction:1},o=a.indicesToRequest.indexOf(n.currentImageIdIndex);a.indicesToRequest.splice(o,1),J(e,ir,a),dr(e),e.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,vr),e.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,vr);var i=hr(e);f.cornerstone.events.removeEventListener(f.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i),f.cornerstone.events.addEventListener(f.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i);}else console.warn("A stack that should not be cached was given the stackPrefetch");}},disable:function(e){clearTimeout(or),e.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,vr);var t=hr(e);f.cornerstone.events.removeEventListener(f.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=Q(e,ir);n&&n.data.length&&(n.data[0].enabled=!1,La.clearRequestStack(rr));},getConfiguration:function(){return sr},setConfiguration:function(e){var t;sr=e,e.maxSimultaneousRequests&&(t=e.maxSimultaneousRequests,la=t);}},mr=function(){function e(){o()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0;}return r()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=Q(e,"stack").data);var a=f.cornerstone,o=t[0],i=o.imageIds[this.currentImageIdIndex],r=t.slice(1,t.length);a.loadAndCacheImage(i).then(function(t){var s=n.layerIds[0];s?a.setLayerImage(e,t,s):(s=a.addLayer(e,t,o.options),n.layerIds.push(s)),a.displayImage(e,t),r.forEach(function(t,o){var r=n.findImageFn(t.imageIds,i),l=o+1,c=n.layerIds[l];c||(c=a.addLayer(e,void 0,t.options),n.layerIds.push(c)),r?a.loadAndCacheImage(r).then(function(t){a.setLayerImage(e,t,c),a.updateImage(e);}):(a.setLayerImage(e,void 0,c),a.setActiveLayer(e,s),a.updateImage(e));});});}}]),e}(),fr={};fr.FusionRenderer=mr;var pr=fr,yr="playClip";function xr(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t));}function Tr(e,t){var n,a;if(void 0===e)throw new Error("playClip: element must not be undefined");var o=Q(e,"stack");if(o&&o.data&&o.data.length){var i,r=f.cornerstone;if(o.data.length>1){var s=Q(e,"stackRenderer");s&&s.data&&s.data.length&&(i=s.data[0]);}var l=o.data[0],c=Q(e,yr);c&&c.data&&c.data.length?xr(n=c.data[0]):J(e,yr,n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(a=function(e,t){var n,a,o,i=0,r=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<r;n++)o=Number(e[n])/t|0,s.push(o),1===n?a=o:o!==a&&(s.isTimeVarying=!0),i+=o;return s.length>0&&(o=s.isTimeVarying?i/s.length|0:s[0],s.push(o)),s}(n.frameTimeVector,n.speed));var u=function(){var t,a,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return xr(n),void function(e){var t={element:e};T(e,x.CLIP_STOPPED,t);}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=Rn.getStartLoadHandler(),a=Rn.getEndLoadHandler(),s=Rn.getErrorLoadingHandler(),t&&t(e),(!0===l.preventCache?r.loadImage(l.imageIds[c]):r.loadAndCacheImage(l.imageIds[c])).then(function(t){try{l.currentImageIdIndex=c,i?(i.currentImageIdIndex=c,i.render(e,o.data)):r.displayImage(e,t),a&&a(e,t);}catch(e){return}},function(t){var n=l.imageIds[c];s&&s(e,n,t);}));};a&&a.length>0&&a.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout(function e(){n.intervalId=setTimeout(e,a[l.currentImageIdIndex]),u();},0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)));}}function br(e){var t=Q(e,yr);t&&t.data&&t.data.length&&xr(t.data[0]);}var Er=function(e,t){var n=_.state.tools.findIndex(function(n){return n.element===e&&n.name===t});n>=0&&_.state.tools.splice(n,1);},Mr=function(e){Cr(e),_.state.enabledElements.forEach(function(t){Er(t,e);});},Cr=function(e){_.modules.globalConfiguration.state.globalToolSyncEnabled&&_.state.globalTools[e]&&delete _.state.globalTools[e];},wr=function(e,t,n){var a=O(e,t);a&&a.mergeOptions(n);},Ir=function(e,t){S.enabledElements.forEach(function(e){wr(e,t);});};function Sr(e,t){var n={};return {get:function(a,o){return e.indexOf(o)>=0?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(a,o)},add:function(a,o,i){if(!(e.indexOf(o)>=0))return t.add(a,o,i);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(i);},saveToolState:function(){return n},restoreToolState:function(e){n=e;},toolState:n}}function Pr(e,t){var n=Z(e);n||(n=K);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var o=Sr(a,n);te(e,o);}var _r={newStackSpecificToolStateManager:Sr,addStackStateManager:Pr};function Or(){var e={};return {get:function(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}},add:function(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(a);},remove:function(t,n,a){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n)){for(var i=o[n],r=-1,s=0;s<i.data.length;s++)i.data[s]===a&&(r=s);-1!==r&&i.data.splice(r,1);}}}}}var Dr=Or(),Lr={getOrientationString:function(e){for(var t=Un(e),n="",a=t.x<0?"R":"L",o=t.y<0?"A":"P",i=t.z<0?"F":"H",r=new f.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=0;s<3;s++)if(r.x>1e-4&&r.x>r.y&&r.x>r.z)n+=a,r.x=0;else if(r.y>1e-4&&r.y>r.x&&r.y>r.z)n+=o,r.y=0;else{if(!(r.z>1e-4&&r.z>r.x&&r.z>r.y))break;n+=i,r.z=0;}return n},invertOrientationString:function(e){var t=e.replace("H","f");return t=(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},Ar=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=e.querySelector("canvas");if(a.msToBlob){var o=a.msToBlob();return window.navigator.msSaveBlob(o,t)}var i=document.createElement("a");if(i.download=t,i.href=a.toDataURL(n,1),document.createEvent){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(r);}else i.fireEvent&&i.fireEvent("onclick");},Hr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(function(e){return Object.keys(P).some(function(t){return t===e})}(e)){if(console.warn("A module with the name ".concat(e," is already registered")),!n)return;console.warn("Overwriting module ".concat(e));}P[e]=t;};var Rr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(function(e){return void 0!==q[e]}(e)){if(console.warn("mixins/".concat(e," is already registered")),!n)return;console.warn("Overwriting mixins/".concat(e));}q[e]=t,co["mixins/".concat(e)]=q[e];};var Ur=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(function(e,t){return void 0!==co["".concat(e,"/").concat(t)]}(e,t)){if(console.warn("".concat(e,"/").concat(t," is already registered")),!a)return;console.warn("Overwriting ".concat(e,"/").concat(t));}co["".concat(e,"/").concat(t)]=n;};var Nr=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(function(e,t,n){if(!e)return console.warn("The type must be given in order to register."),!1;if(!t)return console.warn("The ".concat(e," must have a name in order to register.")),!1;if("object"!==y()(n)&&"function"!=typeof n)return console.warn("The ".concat(n," is a ").concat(y()(n),", it should be an Object or a function.")),!1;return !0}(e,t,n))switch(e){case"module":Hr(t,n,a);break;case"mixin":Rr(t,n,a);break;default:Ur(e,t,n,a),console.warn("unrecognised type ".concat(e,", not registering ").concat(t));}};var Br=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;n<e.length;n++){var a=e[n],o=a.type,i=a.name,r=a.item;Nr(o,i,r,t);}},Fr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.voi.windowWidth===o.voi.windowWidth&&i.voi.windowCenter===o.voi.windowCenter&&i.invert===o.invert||(i.voi.windowWidth=o.voi.windowWidth,i.voi.windowCenter=o.voi.windowCenter,i.invert=o.invert,e.setViewport(n,i));}},Vr=function(e,t,n){n!==t&&f.cornerstone.updateImage(n);};function jr(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})}var zr=function(e,t){var n=f.cornerstone,a=this,o=[],i=[],r=!1,s={},l=t;function c(e,t){var n=!a.enabled,c=!o.length||!i.length;n||c||(r=!0,i.forEach(function(n){var r=i.indexOf(n);if(-1!==r){var c=s.imageIds.targetElements[r],u=o.indexOf(e);if(-1!==u){var d,h=s.imageIds.sourceElements[u];h===c?d=0:void 0!==s.distances[h]&&(d=s.distances[h][c]),l(a,e,n,t,d);}}}),r=!1);}function u(e){var t=e.detail;!0!==r&&c(e.currentTarget,t);}function d(e){var t=e.detail.element;a.remove(t),function(e){for(var t in Vn)Vn[t]=Vn[t].filter(function(t){return t.element!==e});}(t);}this.enabled=!0,this.setHandler=function(e){l=e;},this.getHandler=function(){return l},this.getDistances=function(){o.length&&i.length&&(s.distances={},s.imageIds={sourceElements:[],targetElements:[]},o.forEach(function(e){var t=n.getEnabledElement(e);if(t&&t.image){var a=t.image.imageId,o=n.metaData.get("imagePlaneModule",a);if(o&&o.imagePositionPatient){var r=Un(o.imagePositionPatient);s.hasOwnProperty(t)||(s.distances[a]={},s.imageIds.sourceElements.push(a),i.forEach(function(t){var o=n.getEnabledElement(t);if(o&&o.image){var i=o.image.imageId;if(s.imageIds.targetElements.push(i),e!==t&&a!==i&&!s.distances[a].hasOwnProperty(i)){var l=n.metaData.get("imagePlaneModule",i);if(l&&l.imagePositionPatient){var c=Un(l.imagePositionPatient);s.distances[a][i]=c.clone().sub(r);}}}}),Object.keys(s.distances[a]).length||delete s.distances[a]);}}}));},this.addSource=function(t){-1===o.indexOf(t)&&(o.push(t),e.split(" ").forEach(function(e){t.addEventListener(e,u);}),a.getDistances(),a.updateDisableHandlers());},this.addTarget=function(e){-1===i.indexOf(e)&&(i.push(e),a.getDistances(),l(a,e,e,0),a.updateDisableHandlers());},this.add=function(e){a.addSource(e),a.addTarget(e);},this.removeSource=function(t){var n=o.indexOf(t);-1!==n&&(o.splice(n,1),e.split(" ").forEach(function(e){t.removeEventListener(e,u);}),a.getDistances(),c(t),a.updateDisableHandlers());},this.removeTarget=function(e){var t=i.indexOf(e);-1!==t&&(i.splice(t,1),a.getDistances(),l(a,e,e,0),a.updateDisableHandlers());},this.remove=function(e){a.removeTarget(e),a.removeSource(e);},this.getSourceElements=function(){return o},this.getTargetElements=function(){return i},this.displayImage=function(e,t,a){r=!0,n.displayImage(e,t,a),r=!1;},this.setViewport=function(e,t){r=!0,n.setViewport(e,t),r=!1;},this.updateDisableHandlers=function(){jr(o.concat(i)).forEach(function(e){e.removeEventListener(f.cornerstone.EVENTS.ELEMENT_DISABLED,d),e.addEventListener(f.cornerstone.EVENTS.ELEMENT_DISABLED,d);});},this.destroy=function(){jr(o.concat(i)).forEach(function(e){a.remove(e);});};},Wr=function(e,t,n,a){if(t!==n&&a&&a.direction){var o=f.cornerstone,i=Q(n,"stack").data[0],r=i.currentImageIdIndex+a.direction;if(r=se(r,0,i.imageIds.length-1),i.currentImageIdIndex!==r){var s=Rn.getStartLoadHandler(),l=Rn.getEndLoadHandler(),c=Rn.getErrorLoadingHandler();i.currentImageIdIndex=r;var u=i.imageIds[r];s&&s(n),(!0===i.preventCache?o.loadImage(u):o.loadAndCacheImage(u)).then(function(t){var a=o.getViewport(n);i.currentImageIdIndex===r&&(e.displayImage(n,t,a),l&&l(n,t));},function(e){var t=i.imageIds[r];c&&c(n,t,e);});}}},Gr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=Q(t,"stack").data[0],i=o.imageIds[o.currentImageIdIndex],r=a.metaData.get("imagePlaneModule",i);if(void 0!==r&&void 0!==r.imagePositionPatient){var s=Un(r.imagePositionPatient),l=Q(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach(function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=Un(n.imagePositionPatient).distanceToSquared(s);o<c&&(c=o,u=t);}}),u!==l.currentImageIdIndex){var d=Rn.getStartLoadHandler(),h=Rn.getEndLoadHandler(),v=Rn.getErrorLoadingHandler();l.currentImageIdIndex=u;var g=l.imageIds[u];if(d&&d(n),-1!==u)(!0===l.preventCache?a.loadImage(g):a.loadAndCacheImage(g)).then(function(t){var o=a.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,o),h&&h(n,t));},function(e){var t=l.imageIds[u];v&&v(n,t,e);});}}}},qr=function(e,t,n,a,o){if(n!==t){var i=f.cornerstone,r=Q(t,"stack").data[0],s=r.imageIds[r.currentImageIdIndex],l=i.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=Un(l.imagePositionPatient),u=Q(n,"stack").data[0],d=Number.MAX_VALUE,h=-1;if(o){var v=c.clone().add(o);if(u.imageIds.forEach(function(e,t){var n=i.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=Un(n.imagePositionPatient),o=v.distanceToSquared(a);o<d&&(d=o,h=t);}}),h!==u.currentImageIdIndex&&-1!==h){var g=Rn.getStartLoadHandler(),m=Rn.getEndLoadHandler(),p=Rn.getErrorLoadingHandler();u.currentImageIdIndex=h;var y=u.imageIds[h];g&&g(n),(!0===u.preventCache?i.loadImage(y):i.loadAndCacheImage(y)).then(function(t){var a=i.getViewport(n);u.currentImageIdIndex===h&&(e.displayImage(n,t,a),m&&m(n,t));},function(e){var t=u.imageIds[h];p&&p(n,t,e);});}}}}},Yr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=Q(t,"stack").data[0],i=Q(n,"stack").data[0],r=o.currentImageIdIndex;if((r=se(r,0,i.imageIds.length-1))!==i.currentImageIdIndex){var s=Rn.getStartLoadHandler(),l=Rn.getEndLoadHandler(),c=Rn.getErrorLoadingHandler();s&&s(n),(!0===i.preventCache?a.loadImage(i.imageIds[r]):a.loadAndCacheImage(i.imageIds[r])).then(function(t){var o=a.getViewport(n);i.currentImageIdIndex=r,e.displayImage(n,t,o),l&&l(n,t);},function(e){var t=i.imageIds[r];c&&c(n,t,e);});}}},Xr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.scale===o.scale&&i.translation.x===o.translation.x&&i.translation.y===o.translation.y||(i.scale=o.scale,i.translation.x=o.translation.x,i.translation.y=o.translation.y,e.setViewport(n,i));}};n.d(t,"AngleTool",function(){return ot}),n.d(t,"ArrowAnnotateTool",function(){return it}),n.d(t,"BidirectionalTool",function(){return At}),n.d(t,"CobbAngleTool",function(){return Ht}),n.d(t,"EllipticalRoiTool",function(){return zt}),n.d(t,"FreehandMouseTool",function(){return hn}),n.d(t,"LengthTool",function(){return gn}),n.d(t,"ProbeTool",function(){return fn}),n.d(t,"RectangleRoiTool",function(){return pn}),n.d(t,"TextMarkerTool",function(){return xn}),n.d(t,"BrushTool",function(){return Pn}),n.d(t,"CrosshairsTool",function(){return Wn}),n.d(t,"DoubleTapFitToWindowTool",function(){return Gn}),n.d(t,"DragProbeTool",function(){return qn}),n.d(t,"EraserTool",function(){return Kn}),n.d(t,"FreehandSculpterMouseTool",function(){return Jn}),n.d(t,"MagnifyTool",function(){return Qn}),n.d(t,"PanMultiTouchTool",function(){return $n}),n.d(t,"PanTool",function(){return ea}),n.d(t,"ReferenceLinesTool",function(){return ca}),n.d(t,"RotateTool",function(){return da}),n.d(t,"RotateTouchTool",function(){return ma}),n.d(t,"ScaleOverlayTool",function(){return fa}),n.d(t,"StackScrollMouseWheelTool",function(){return Ua}),n.d(t,"StackScrollMultiTouchTool",function(){return Na}),n.d(t,"StackScrollTool",function(){return Ba}),n.d(t,"WwwcRegionTool",function(){return Va}),n.d(t,"WwwcTool",function(){return Ga}),n.d(t,"ZoomMouseWheelTool",function(){return Ka}),n.d(t,"ZoomTool",function(){return Qa}),n.d(t,"ZoomTouchPinchTool",function(){return oo}),n.d(t,"init",function(){return ar}),n.d(t,"stackPrefetch",function(){return gr}),n.d(t,"stackRenderers",function(){return pr}),n.d(t,"playClip",function(){return Tr}),n.d(t,"stopClip",function(){return br}),n.d(t,"store",function(){return _}),n.d(t,"getToolForElement",function(){return O}),n.d(t,"addTool",function(){return Gi}),n.d(t,"addToolForElement",function(){return Wi}),n.d(t,"removeTool",function(){return Mr}),n.d(t,"removeToolForElement",function(){return Er}),n.d(t,"setToolOptions",function(){return Ir}),n.d(t,"setToolOptionsForElement",function(){return wr}),n.d(t,"setToolActive",function(){return L}),n.d(t,"setToolActiveForElement",function(){return D}),n.d(t,"setToolEnabled",function(){return U}),n.d(t,"setToolEnabledForElement",function(){return R}),n.d(t,"setToolDisabled",function(){return H}),n.d(t,"setToolDisabledForElement",function(){return A}),n.d(t,"setToolPassive",function(){return B}),n.d(t,"setToolPassiveForElement",function(){return N}),n.d(t,"addToolState",function(){return J}),n.d(t,"getToolState",function(){return Q}),n.d(t,"removeToolState",function(){return $}),n.d(t,"clearToolState",function(){return ee}),n.d(t,"setElementToolStateManager",function(){return te}),n.d(t,"getElementToolStateManager",function(){return Z}),n.d(t,"textStyle",function(){return ze}),n.d(t,"toolStyle",function(){return Ie}),n.d(t,"toolColors",function(){return _e}),n.d(t,"toolCoordinates",function(){return xt}),n.d(t,"stackSpecificStateManager",function(){return _r}),n.d(t,"newStackSpecificToolStateManager",function(){return Sr}),n.d(t,"addStackStateManager",function(){return Pr}),n.d(t,"loadHandlerManager",function(){return Rn}),n.d(t,"newImageIdSpecificToolStateManager",function(){return X}),n.d(t,"globalImageIdSpecificToolStateManager",function(){return K}),n.d(t,"newFrameOfReferenceSpecificToolStateManager",function(){return Or}),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",function(){return Dr}),n.d(t,"forceEnabledElementResize",function(){return tr}),n.d(t,"orientation",function(){return Lr}),n.d(t,"SaveAs",function(){return Ar}),n.d(t,"register",function(){return Nr}),n.d(t,"registerSome",function(){return Br}),n.d(t,"wwwcSynchronizer",function(){return Fr}),n.d(t,"updateImageSynchronizer",function(){return Vr}),n.d(t,"Synchronizer",function(){return zr}),n.d(t,"stackScrollSynchronizer",function(){return Wr}),n.d(t,"stackImagePositionSynchronizer",function(){return Gr}),n.d(t,"stackImagePositionOffsetSynchronizer",function(){return qr}),n.d(t,"stackImageIndexSynchronizer",function(){return Yr}),n.d(t,"panZoomSynchronizer",function(){return Xr}),n.d(t,"requestPoolManager",function(){return La}),n.d(t,"external",function(){return f}),n.d(t,"EVENTS",function(){return x}),n.d(t,"version",function(){return "3.0.0-b.1512"}),n.d(t,"import",function(){return uo});var Kr={AngleTool:ot,ArrowAnnotateTool:it,BidirectionalTool:At,CobbAngleTool:Ht,EllipticalRoiTool:zt,FreehandMouseTool:hn,LengthTool:gn,ProbeTool:fn,RectangleRoiTool:pn,TextMarkerTool:xn,BrushTool:Pn,CrosshairsTool:Wn,DoubleTapFitToWindowTool:Gn,DragProbeTool:qn,EraserTool:Kn,FreehandSculpterMouseTool:Jn,MagnifyTool:Qn,PanMultiTouchTool:$n,PanTool:ea,ReferenceLinesTool:ca,RotateTool:da,RotateTouchTool:ma,ScaleOverlayTool:fa,StackScrollMouseWheelTool:Ua,StackScrollMultiTouchTool:Na,StackScrollTool:Ba,WwwcRegionTool:Va,WwwcTool:Ga,ZoomMouseWheelTool:Ka,ZoomTool:Qa,ZoomTouchPinchTool:oo,init:ar,stackPrefetch:gr,stackRenderers:pr,playClip:Tr,stopClip:br,store:_,getToolForElement:O,addTool:Gi,addToolForElement:Wi,removeTool:Mr,removeToolForElement:Er,setToolOptions:Ir,setToolOptionsForElement:wr,setToolActive:L,setToolActiveForElement:D,setToolEnabled:U,setToolEnabledForElement:R,setToolDisabled:H,setToolDisabledForElement:A,setToolPassive:B,setToolPassiveForElement:N,addToolState:J,getToolState:Q,removeToolState:$,clearToolState:ee,setElementToolStateManager:te,getElementToolStateManager:Z,textStyle:ze,toolStyle:Ie,toolColors:_e,toolCoordinates:xt,stackSpecificStateManager:_r,newStackSpecificToolStateManager:Sr,addStackStateManager:Pr,loadHandlerManager:Rn,newImageIdSpecificToolStateManager:X,globalImageIdSpecificToolStateManager:K,newFrameOfReferenceSpecificToolStateManager:Or,globalFrameOfReferenceSpecificToolStateManager:Dr,forceEnabledElementResize:tr,orientation:Lr,SaveAs:Ar,import:uo,register:Nr,registerSome:Br,wwwcSynchronizer:Fr,updateImageSynchronizer:Vr,Synchronizer:zr,stackScrollSynchronizer:Wr,stackImagePositionSynchronizer:Gr,stackImagePositionOffsetSynchronizer:qr,stackImageIndexSynchronizer:Yr,panZoomSynchronizer:Xr,requestPoolManager:La,external:f,EVENTS:x,version:"3.0.0-b.1512"};t.default=Kr;},function(e,t){!function(t){var n,a=Object.prototype,o=a.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=T;var d="suspendedStart",h="suspendedYield",v="executing",g="completed",m={},f={};f[r]=function(){return this};var p=Object.getPrototypeOf,y=p&&p(p(O([])));y&&y!==a&&o.call(y,r)&&(f=y);var x=C.prototype=E.prototype=Object.create(f);M.prototype=x.constructor=C,C.constructor=M,C[l]=M.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return !!t&&(t===M||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(x),e},u.awrap=function(e){return {__await:e}},w(I.prototype),I.prototype[s]=function(){return this},u.AsyncIterator=I,u.async=function(e,t,n,a){var o=new I(T(e,t,n,a));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(x),x[l]="Generator",x[r]=function(){return this},x.toString=function(){return "[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},u.values=O,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n);},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,o){return s.type="throw",s.arg=e,t.next=a,o&&(t.method="next",t.arg=n),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var l=o.call(r,"catchLoc"),c=o.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return "break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;P(n);}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:O(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),m}};}function T(e,t,n,a){var o=t&&t.prototype instanceof E?t:E,i=Object.create(o.prototype),r=new _(a||[]);return i._invoke=function(e,t,n){var a=d;return function(o,i){if(a===v)throw new Error("Generator is already running");if(a===g){if("throw"===o)throw i;return D()}for(n.method=o,n.arg=i;;){var r=n.delegate;if(r){var s=S(r,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=g,n.arg;n.dispatchException(n.arg);}else"return"===n.method&&n.abrupt("return",n.arg);a=v;var l=b(e,t,n);if("normal"===l.type){if(a=n.done?g:h,l.arg===m)continue;return {value:l.arg,done:n.done}}"throw"===l.type&&(a=g,n.method="throw",n.arg=l.arg);}}}(e,n,r),i}function b(e,t,n){try{return {type:"normal",arg:e.call(t,n)}}catch(e){return {type:"throw",arg:e}}}function E(){}function M(){}function C(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)};});}function I(e){var t;this._invoke=function(n,a){function i(){return new Promise(function(t,i){!function t(n,a,i,r){var s=b(e[n],e,a);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,r);},function(e){t("throw",e,i,r);}):Promise.resolve(c).then(function(e){l.value=e,i(l);},function(e){return t("throw",e,i,r)})}r(s.arg);}(n,a,t,i);})}return t=t?t.then(i,i):i()};}function S(e,t){var a=e.iterator[t.method];if(a===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,S(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method");}return m}var o=b(a,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,m;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t);}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t;}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0);}function O(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(o.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}return {next:D}}function D(){return {value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")());},function(e,t,n){var a=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,i=o&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,e.exports=n(11),o)a.regeneratorRuntime=i;else try{delete a.regeneratorRuntime;}catch(e){a.regeneratorRuntime=void 0;}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}};},function(e,t){function n(t,a){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,a)}e.exports=n;}])});

  });

  var cornerstoneTools$1 = unwrapExports(cornerstoneTools_min);

  var hammer = createCommonjsModule(function (module) {
  /*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */
  (function(window, document, exportName, undefined) {

  var VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];
  var TEST_ELEMENT = document.createElement('div');

  var TYPE_FUNCTION = 'function';

  var round = Math.round;
  var abs = Math.abs;
  var now = Date.now;

  /**
   * set a timeout with a given scope
   * @param {Function} fn
   * @param {Number} timeout
   * @param {Object} context
   * @returns {number}
   */
  function setTimeoutContext(fn, timeout, context) {
      return setTimeout(bindFn(fn, context), timeout);
  }

  /**
   * if the argument is an array, we want to execute the fn on each entry
   * if it aint an array we don't want to do a thing.
   * this is used by all the methods that accept a single and array argument.
   * @param {*|Array} arg
   * @param {String} fn
   * @param {Object} [context]
   * @returns {Boolean}
   */
  function invokeArrayArg(arg, fn, context) {
      if (Array.isArray(arg)) {
          each(arg, context[fn], context);
          return true;
      }
      return false;
  }

  /**
   * walk objects and arrays
   * @param {Object} obj
   * @param {Function} iterator
   * @param {Object} context
   */
  function each(obj, iterator, context) {
      var i;

      if (!obj) {
          return;
      }

      if (obj.forEach) {
          obj.forEach(iterator, context);
      } else if (obj.length !== undefined) {
          i = 0;
          while (i < obj.length) {
              iterator.call(context, obj[i], i, obj);
              i++;
          }
      } else {
          for (i in obj) {
              obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);
          }
      }
  }

  /**
   * wrap a method with a deprecation warning and stack trace
   * @param {Function} method
   * @param {String} name
   * @param {String} message
   * @returns {Function} A new function wrapping the supplied method.
   */
  function deprecate(method, name, message) {
      var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\n' + message + ' AT \n';
      return function() {
          var e = new Error('get-stack-trace');
          var stack = e && e.stack ? e.stack.replace(/^[^\(]+?[\n$]/gm, '')
              .replace(/^\s+at\s+/gm, '')
              .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';

          var log = window.console && (window.console.warn || window.console.log);
          if (log) {
              log.call(window.console, deprecationMessage, stack);
          }
          return method.apply(this, arguments);
      };
  }

  /**
   * extend object.
   * means that properties in dest will be overwritten by the ones in src.
   * @param {Object} target
   * @param {...Object} objects_to_assign
   * @returns {Object} target
   */
  var assign;
  if (typeof Object.assign !== 'function') {
      assign = function assign(target) {
          if (target === undefined || target === null) {
              throw new TypeError('Cannot convert undefined or null to object');
          }

          var output = Object(target);
          for (var index = 1; index < arguments.length; index++) {
              var source = arguments[index];
              if (source !== undefined && source !== null) {
                  for (var nextKey in source) {
                      if (source.hasOwnProperty(nextKey)) {
                          output[nextKey] = source[nextKey];
                      }
                  }
              }
          }
          return output;
      };
  } else {
      assign = Object.assign;
  }

  /**
   * extend object.
   * means that properties in dest will be overwritten by the ones in src.
   * @param {Object} dest
   * @param {Object} src
   * @param {Boolean} [merge=false]
   * @returns {Object} dest
   */
  var extend = deprecate(function extend(dest, src, merge) {
      var keys = Object.keys(src);
      var i = 0;
      while (i < keys.length) {
          if (!merge || (merge && dest[keys[i]] === undefined)) {
              dest[keys[i]] = src[keys[i]];
          }
          i++;
      }
      return dest;
  }, 'extend', 'Use `assign`.');

  /**
   * merge the values from src in the dest.
   * means that properties that exist in dest will not be overwritten by src
   * @param {Object} dest
   * @param {Object} src
   * @returns {Object} dest
   */
  var merge = deprecate(function merge(dest, src) {
      return extend(dest, src, true);
  }, 'merge', 'Use `assign`.');

  /**
   * simple class inheritance
   * @param {Function} child
   * @param {Function} base
   * @param {Object} [properties]
   */
  function inherit(child, base, properties) {
      var baseP = base.prototype,
          childP;

      childP = child.prototype = Object.create(baseP);
      childP.constructor = child;
      childP._super = baseP;

      if (properties) {
          assign(childP, properties);
      }
  }

  /**
   * simple function bind
   * @param {Function} fn
   * @param {Object} context
   * @returns {Function}
   */
  function bindFn(fn, context) {
      return function boundFn() {
          return fn.apply(context, arguments);
      };
  }

  /**
   * let a boolean value also be a function that must return a boolean
   * this first item in args will be used as the context
   * @param {Boolean|Function} val
   * @param {Array} [args]
   * @returns {Boolean}
   */
  function boolOrFn(val, args) {
      if (typeof val == TYPE_FUNCTION) {
          return val.apply(args ? args[0] || undefined : undefined, args);
      }
      return val;
  }

  /**
   * use the val2 when val1 is undefined
   * @param {*} val1
   * @param {*} val2
   * @returns {*}
   */
  function ifUndefined(val1, val2) {
      return (val1 === undefined) ? val2 : val1;
  }

  /**
   * addEventListener with multiple events at once
   * @param {EventTarget} target
   * @param {String} types
   * @param {Function} handler
   */
  function addEventListeners(target, types, handler) {
      each(splitStr(types), function(type) {
          target.addEventListener(type, handler, false);
      });
  }

  /**
   * removeEventListener with multiple events at once
   * @param {EventTarget} target
   * @param {String} types
   * @param {Function} handler
   */
  function removeEventListeners(target, types, handler) {
      each(splitStr(types), function(type) {
          target.removeEventListener(type, handler, false);
      });
  }

  /**
   * find if a node is in the given parent
   * @method hasParent
   * @param {HTMLElement} node
   * @param {HTMLElement} parent
   * @return {Boolean} found
   */
  function hasParent(node, parent) {
      while (node) {
          if (node == parent) {
              return true;
          }
          node = node.parentNode;
      }
      return false;
  }

  /**
   * small indexOf wrapper
   * @param {String} str
   * @param {String} find
   * @returns {Boolean} found
   */
  function inStr(str, find) {
      return str.indexOf(find) > -1;
  }

  /**
   * split string on whitespace
   * @param {String} str
   * @returns {Array} words
   */
  function splitStr(str) {
      return str.trim().split(/\s+/g);
  }

  /**
   * find if a array contains the object using indexOf or a simple polyFill
   * @param {Array} src
   * @param {String} find
   * @param {String} [findByKey]
   * @return {Boolean|Number} false when not found, or the index
   */
  function inArray(src, find, findByKey) {
      if (src.indexOf && !findByKey) {
          return src.indexOf(find);
      } else {
          var i = 0;
          while (i < src.length) {
              if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {
                  return i;
              }
              i++;
          }
          return -1;
      }
  }

  /**
   * convert array-like objects to real arrays
   * @param {Object} obj
   * @returns {Array}
   */
  function toArray(obj) {
      return Array.prototype.slice.call(obj, 0);
  }

  /**
   * unique array with objects based on a key (like 'id') or just by the array's value
   * @param {Array} src [{id:1},{id:2},{id:1}]
   * @param {String} [key]
   * @param {Boolean} [sort=False]
   * @returns {Array} [{id:1},{id:2}]
   */
  function uniqueArray(src, key, sort) {
      var results = [];
      var values = [];
      var i = 0;

      while (i < src.length) {
          var val = key ? src[i][key] : src[i];
          if (inArray(values, val) < 0) {
              results.push(src[i]);
          }
          values[i] = val;
          i++;
      }

      if (sort) {
          if (!key) {
              results = results.sort();
          } else {
              results = results.sort(function sortUniqueArray(a, b) {
                  return a[key] > b[key];
              });
          }
      }

      return results;
  }

  /**
   * get the prefixed property
   * @param {Object} obj
   * @param {String} property
   * @returns {String|Undefined} prefixed
   */
  function prefixed(obj, property) {
      var prefix, prop;
      var camelProp = property[0].toUpperCase() + property.slice(1);

      var i = 0;
      while (i < VENDOR_PREFIXES.length) {
          prefix = VENDOR_PREFIXES[i];
          prop = (prefix) ? prefix + camelProp : property;

          if (prop in obj) {
              return prop;
          }
          i++;
      }
      return undefined;
  }

  /**
   * get a unique id
   * @returns {number} uniqueId
   */
  var _uniqueId = 1;
  function uniqueId() {
      return _uniqueId++;
  }

  /**
   * get the window object of an element
   * @param {HTMLElement} element
   * @returns {DocumentView|Window}
   */
  function getWindowForElement(element) {
      var doc = element.ownerDocument || element;
      return (doc.defaultView || doc.parentWindow || window);
  }

  var MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;

  var SUPPORT_TOUCH = ('ontouchstart' in window);
  var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;
  var SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);

  var INPUT_TYPE_TOUCH = 'touch';
  var INPUT_TYPE_PEN = 'pen';
  var INPUT_TYPE_MOUSE = 'mouse';
  var INPUT_TYPE_KINECT = 'kinect';

  var COMPUTE_INTERVAL = 25;

  var INPUT_START = 1;
  var INPUT_MOVE = 2;
  var INPUT_END = 4;
  var INPUT_CANCEL = 8;

  var DIRECTION_NONE = 1;
  var DIRECTION_LEFT = 2;
  var DIRECTION_RIGHT = 4;
  var DIRECTION_UP = 8;
  var DIRECTION_DOWN = 16;

  var DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;
  var DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;
  var DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;

  var PROPS_XY = ['x', 'y'];
  var PROPS_CLIENT_XY = ['clientX', 'clientY'];

  /**
   * create new input type manager
   * @param {Manager} manager
   * @param {Function} callback
   * @returns {Input}
   * @constructor
   */
  function Input(manager, callback) {
      var self = this;
      this.manager = manager;
      this.callback = callback;
      this.element = manager.element;
      this.target = manager.options.inputTarget;

      // smaller wrapper around the handler, for the scope and the enabled state of the manager,
      // so when disabled the input events are completely bypassed.
      this.domHandler = function(ev) {
          if (boolOrFn(manager.options.enable, [manager])) {
              self.handler(ev);
          }
      };

      this.init();

  }

  Input.prototype = {
      /**
       * should handle the inputEvent data and trigger the callback
       * @virtual
       */
      handler: function() { },

      /**
       * bind the events
       */
      init: function() {
          this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);
          this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);
          this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);
      },

      /**
       * unbind the events
       */
      destroy: function() {
          this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);
          this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);
          this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);
      }
  };

  /**
   * create new input type manager
   * called by the Manager constructor
   * @param {Hammer} manager
   * @returns {Input}
   */
  function createInputInstance(manager) {
      var Type;
      var inputClass = manager.options.inputClass;

      if (inputClass) {
          Type = inputClass;
      } else if (SUPPORT_POINTER_EVENTS) {
          Type = PointerEventInput;
      } else if (SUPPORT_ONLY_TOUCH) {
          Type = TouchInput;
      } else if (!SUPPORT_TOUCH) {
          Type = MouseInput;
      } else {
          Type = TouchMouseInput;
      }
      return new (Type)(manager, inputHandler);
  }

  /**
   * handle input events
   * @param {Manager} manager
   * @param {String} eventType
   * @param {Object} input
   */
  function inputHandler(manager, eventType, input) {
      var pointersLen = input.pointers.length;
      var changedPointersLen = input.changedPointers.length;
      var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));
      var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));

      input.isFirst = !!isFirst;
      input.isFinal = !!isFinal;

      if (isFirst) {
          manager.session = {};
      }

      // source event is the normalized value of the domEvents
      // like 'touchstart, mouseup, pointerdown'
      input.eventType = eventType;

      // compute scale, rotation etc
      computeInputData(manager, input);

      // emit secret event
      manager.emit('hammer.input', input);

      manager.recognize(input);
      manager.session.prevInput = input;
  }

  /**
   * extend the data with some usable properties like scale, rotate, velocity etc
   * @param {Object} manager
   * @param {Object} input
   */
  function computeInputData(manager, input) {
      var session = manager.session;
      var pointers = input.pointers;
      var pointersLength = pointers.length;

      // store the first input to calculate the distance and direction
      if (!session.firstInput) {
          session.firstInput = simpleCloneInputData(input);
      }

      // to compute scale and rotation we need to store the multiple touches
      if (pointersLength > 1 && !session.firstMultiple) {
          session.firstMultiple = simpleCloneInputData(input);
      } else if (pointersLength === 1) {
          session.firstMultiple = false;
      }

      var firstInput = session.firstInput;
      var firstMultiple = session.firstMultiple;
      var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;

      var center = input.center = getCenter(pointers);
      input.timeStamp = now();
      input.deltaTime = input.timeStamp - firstInput.timeStamp;

      input.angle = getAngle(offsetCenter, center);
      input.distance = getDistance(offsetCenter, center);

      computeDeltaXY(session, input);
      input.offsetDirection = getDirection(input.deltaX, input.deltaY);

      var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);
      input.overallVelocityX = overallVelocity.x;
      input.overallVelocityY = overallVelocity.y;
      input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;

      input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;
      input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;

      input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >
          session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);

      computeIntervalInputData(session, input);

      // find the correct target
      var target = manager.element;
      if (hasParent(input.srcEvent.target, target)) {
          target = input.srcEvent.target;
      }
      input.target = target;
  }

  function computeDeltaXY(session, input) {
      var center = input.center;
      var offset = session.offsetDelta || {};
      var prevDelta = session.prevDelta || {};
      var prevInput = session.prevInput || {};

      if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {
          prevDelta = session.prevDelta = {
              x: prevInput.deltaX || 0,
              y: prevInput.deltaY || 0
          };

          offset = session.offsetDelta = {
              x: center.x,
              y: center.y
          };
      }

      input.deltaX = prevDelta.x + (center.x - offset.x);
      input.deltaY = prevDelta.y + (center.y - offset.y);
  }

  /**
   * velocity is calculated every x ms
   * @param {Object} session
   * @param {Object} input
   */
  function computeIntervalInputData(session, input) {
      var last = session.lastInterval || input,
          deltaTime = input.timeStamp - last.timeStamp,
          velocity, velocityX, velocityY, direction;

      if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {
          var deltaX = input.deltaX - last.deltaX;
          var deltaY = input.deltaY - last.deltaY;

          var v = getVelocity(deltaTime, deltaX, deltaY);
          velocityX = v.x;
          velocityY = v.y;
          velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;
          direction = getDirection(deltaX, deltaY);

          session.lastInterval = input;
      } else {
          // use latest velocity info if it doesn't overtake a minimum period
          velocity = last.velocity;
          velocityX = last.velocityX;
          velocityY = last.velocityY;
          direction = last.direction;
      }

      input.velocity = velocity;
      input.velocityX = velocityX;
      input.velocityY = velocityY;
      input.direction = direction;
  }

  /**
   * create a simple clone from the input used for storage of firstInput and firstMultiple
   * @param {Object} input
   * @returns {Object} clonedInputData
   */
  function simpleCloneInputData(input) {
      // make a simple copy of the pointers because we will get a reference if we don't
      // we only need clientXY for the calculations
      var pointers = [];
      var i = 0;
      while (i < input.pointers.length) {
          pointers[i] = {
              clientX: round(input.pointers[i].clientX),
              clientY: round(input.pointers[i].clientY)
          };
          i++;
      }

      return {
          timeStamp: now(),
          pointers: pointers,
          center: getCenter(pointers),
          deltaX: input.deltaX,
          deltaY: input.deltaY
      };
  }

  /**
   * get the center of all the pointers
   * @param {Array} pointers
   * @return {Object} center contains `x` and `y` properties
   */
  function getCenter(pointers) {
      var pointersLength = pointers.length;

      // no need to loop when only one touch
      if (pointersLength === 1) {
          return {
              x: round(pointers[0].clientX),
              y: round(pointers[0].clientY)
          };
      }

      var x = 0, y = 0, i = 0;
      while (i < pointersLength) {
          x += pointers[i].clientX;
          y += pointers[i].clientY;
          i++;
      }

      return {
          x: round(x / pointersLength),
          y: round(y / pointersLength)
      };
  }

  /**
   * calculate the velocity between two points. unit is in px per ms.
   * @param {Number} deltaTime
   * @param {Number} x
   * @param {Number} y
   * @return {Object} velocity `x` and `y`
   */
  function getVelocity(deltaTime, x, y) {
      return {
          x: x / deltaTime || 0,
          y: y / deltaTime || 0
      };
  }

  /**
   * get the direction between two points
   * @param {Number} x
   * @param {Number} y
   * @return {Number} direction
   */
  function getDirection(x, y) {
      if (x === y) {
          return DIRECTION_NONE;
      }

      if (abs(x) >= abs(y)) {
          return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;
      }
      return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;
  }

  /**
   * calculate the absolute distance between two points
   * @param {Object} p1 {x, y}
   * @param {Object} p2 {x, y}
   * @param {Array} [props] containing x and y keys
   * @return {Number} distance
   */
  function getDistance(p1, p2, props) {
      if (!props) {
          props = PROPS_XY;
      }
      var x = p2[props[0]] - p1[props[0]],
          y = p2[props[1]] - p1[props[1]];

      return Math.sqrt((x * x) + (y * y));
  }

  /**
   * calculate the angle between two coordinates
   * @param {Object} p1
   * @param {Object} p2
   * @param {Array} [props] containing x and y keys
   * @return {Number} angle
   */
  function getAngle(p1, p2, props) {
      if (!props) {
          props = PROPS_XY;
      }
      var x = p2[props[0]] - p1[props[0]],
          y = p2[props[1]] - p1[props[1]];
      return Math.atan2(y, x) * 180 / Math.PI;
  }

  /**
   * calculate the rotation degrees between two pointersets
   * @param {Array} start array of pointers
   * @param {Array} end array of pointers
   * @return {Number} rotation
   */
  function getRotation(start, end) {
      return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);
  }

  /**
   * calculate the scale factor between two pointersets
   * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out
   * @param {Array} start array of pointers
   * @param {Array} end array of pointers
   * @return {Number} scale
   */
  function getScale(start, end) {
      return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);
  }

  var MOUSE_INPUT_MAP = {
      mousedown: INPUT_START,
      mousemove: INPUT_MOVE,
      mouseup: INPUT_END
  };

  var MOUSE_ELEMENT_EVENTS = 'mousedown';
  var MOUSE_WINDOW_EVENTS = 'mousemove mouseup';

  /**
   * Mouse events input
   * @constructor
   * @extends Input
   */
  function MouseInput() {
      this.evEl = MOUSE_ELEMENT_EVENTS;
      this.evWin = MOUSE_WINDOW_EVENTS;

      this.pressed = false; // mousedown state

      Input.apply(this, arguments);
  }

  inherit(MouseInput, Input, {
      /**
       * handle mouse events
       * @param {Object} ev
       */
      handler: function MEhandler(ev) {
          var eventType = MOUSE_INPUT_MAP[ev.type];

          // on start we want to have the left mouse button down
          if (eventType & INPUT_START && ev.button === 0) {
              this.pressed = true;
          }

          if (eventType & INPUT_MOVE && ev.which !== 1) {
              eventType = INPUT_END;
          }

          // mouse must be down
          if (!this.pressed) {
              return;
          }

          if (eventType & INPUT_END) {
              this.pressed = false;
          }

          this.callback(this.manager, eventType, {
              pointers: [ev],
              changedPointers: [ev],
              pointerType: INPUT_TYPE_MOUSE,
              srcEvent: ev
          });
      }
  });

  var POINTER_INPUT_MAP = {
      pointerdown: INPUT_START,
      pointermove: INPUT_MOVE,
      pointerup: INPUT_END,
      pointercancel: INPUT_CANCEL,
      pointerout: INPUT_CANCEL
  };

  // in IE10 the pointer types is defined as an enum
  var IE10_POINTER_TYPE_ENUM = {
      2: INPUT_TYPE_TOUCH,
      3: INPUT_TYPE_PEN,
      4: INPUT_TYPE_MOUSE,
      5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816
  };

  var POINTER_ELEMENT_EVENTS = 'pointerdown';
  var POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';

  // IE10 has prefixed support, and case-sensitive
  if (window.MSPointerEvent && !window.PointerEvent) {
      POINTER_ELEMENT_EVENTS = 'MSPointerDown';
      POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';
  }

  /**
   * Pointer events input
   * @constructor
   * @extends Input
   */
  function PointerEventInput() {
      this.evEl = POINTER_ELEMENT_EVENTS;
      this.evWin = POINTER_WINDOW_EVENTS;

      Input.apply(this, arguments);

      this.store = (this.manager.session.pointerEvents = []);
  }

  inherit(PointerEventInput, Input, {
      /**
       * handle mouse events
       * @param {Object} ev
       */
      handler: function PEhandler(ev) {
          var store = this.store;
          var removePointer = false;

          var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');
          var eventType = POINTER_INPUT_MAP[eventTypeNormalized];
          var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;

          var isTouch = (pointerType == INPUT_TYPE_TOUCH);

          // get index of the event in the store
          var storeIndex = inArray(store, ev.pointerId, 'pointerId');

          // start and mouse must be down
          if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {
              if (storeIndex < 0) {
                  store.push(ev);
                  storeIndex = store.length - 1;
              }
          } else if (eventType & (INPUT_END | INPUT_CANCEL)) {
              removePointer = true;
          }

          // it not found, so the pointer hasn't been down (so it's probably a hover)
          if (storeIndex < 0) {
              return;
          }

          // update the event in the store
          store[storeIndex] = ev;

          this.callback(this.manager, eventType, {
              pointers: store,
              changedPointers: [ev],
              pointerType: pointerType,
              srcEvent: ev
          });

          if (removePointer) {
              // remove from the store
              store.splice(storeIndex, 1);
          }
      }
  });

  var SINGLE_TOUCH_INPUT_MAP = {
      touchstart: INPUT_START,
      touchmove: INPUT_MOVE,
      touchend: INPUT_END,
      touchcancel: INPUT_CANCEL
  };

  var SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';
  var SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';

  /**
   * Touch events input
   * @constructor
   * @extends Input
   */
  function SingleTouchInput() {
      this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;
      this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;
      this.started = false;

      Input.apply(this, arguments);
  }

  inherit(SingleTouchInput, Input, {
      handler: function TEhandler(ev) {
          var type = SINGLE_TOUCH_INPUT_MAP[ev.type];

          // should we handle the touch events?
          if (type === INPUT_START) {
              this.started = true;
          }

          if (!this.started) {
              return;
          }

          var touches = normalizeSingleTouches.call(this, ev, type);

          // when done, reset the started state
          if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {
              this.started = false;
          }

          this.callback(this.manager, type, {
              pointers: touches[0],
              changedPointers: touches[1],
              pointerType: INPUT_TYPE_TOUCH,
              srcEvent: ev
          });
      }
  });

  /**
   * @this {TouchInput}
   * @param {Object} ev
   * @param {Number} type flag
   * @returns {undefined|Array} [all, changed]
   */
  function normalizeSingleTouches(ev, type) {
      var all = toArray(ev.touches);
      var changed = toArray(ev.changedTouches);

      if (type & (INPUT_END | INPUT_CANCEL)) {
          all = uniqueArray(all.concat(changed), 'identifier', true);
      }

      return [all, changed];
  }

  var TOUCH_INPUT_MAP = {
      touchstart: INPUT_START,
      touchmove: INPUT_MOVE,
      touchend: INPUT_END,
      touchcancel: INPUT_CANCEL
  };

  var TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';

  /**
   * Multi-user touch events input
   * @constructor
   * @extends Input
   */
  function TouchInput() {
      this.evTarget = TOUCH_TARGET_EVENTS;
      this.targetIds = {};

      Input.apply(this, arguments);
  }

  inherit(TouchInput, Input, {
      handler: function MTEhandler(ev) {
          var type = TOUCH_INPUT_MAP[ev.type];
          var touches = getTouches.call(this, ev, type);
          if (!touches) {
              return;
          }

          this.callback(this.manager, type, {
              pointers: touches[0],
              changedPointers: touches[1],
              pointerType: INPUT_TYPE_TOUCH,
              srcEvent: ev
          });
      }
  });

  /**
   * @this {TouchInput}
   * @param {Object} ev
   * @param {Number} type flag
   * @returns {undefined|Array} [all, changed]
   */
  function getTouches(ev, type) {
      var allTouches = toArray(ev.touches);
      var targetIds = this.targetIds;

      // when there is only one touch, the process can be simplified
      if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {
          targetIds[allTouches[0].identifier] = true;
          return [allTouches, allTouches];
      }

      var i,
          targetTouches,
          changedTouches = toArray(ev.changedTouches),
          changedTargetTouches = [],
          target = this.target;

      // get target touches from touches
      targetTouches = allTouches.filter(function(touch) {
          return hasParent(touch.target, target);
      });

      // collect touches
      if (type === INPUT_START) {
          i = 0;
          while (i < targetTouches.length) {
              targetIds[targetTouches[i].identifier] = true;
              i++;
          }
      }

      // filter changed touches to only contain touches that exist in the collected target ids
      i = 0;
      while (i < changedTouches.length) {
          if (targetIds[changedTouches[i].identifier]) {
              changedTargetTouches.push(changedTouches[i]);
          }

          // cleanup removed touches
          if (type & (INPUT_END | INPUT_CANCEL)) {
              delete targetIds[changedTouches[i].identifier];
          }
          i++;
      }

      if (!changedTargetTouches.length) {
          return;
      }

      return [
          // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'
          uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),
          changedTargetTouches
      ];
  }

  /**
   * Combined touch and mouse input
   *
   * Touch has a higher priority then mouse, and while touching no mouse events are allowed.
   * This because touch devices also emit mouse events while doing a touch.
   *
   * @constructor
   * @extends Input
   */

  var DEDUP_TIMEOUT = 2500;
  var DEDUP_DISTANCE = 25;

  function TouchMouseInput() {
      Input.apply(this, arguments);

      var handler = bindFn(this.handler, this);
      this.touch = new TouchInput(this.manager, handler);
      this.mouse = new MouseInput(this.manager, handler);

      this.primaryTouch = null;
      this.lastTouches = [];
  }

  inherit(TouchMouseInput, Input, {
      /**
       * handle mouse and touch events
       * @param {Hammer} manager
       * @param {String} inputEvent
       * @param {Object} inputData
       */
      handler: function TMEhandler(manager, inputEvent, inputData) {
          var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),
              isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);

          if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {
              return;
          }

          // when we're in a touch event, record touches to  de-dupe synthetic mouse event
          if (isTouch) {
              recordTouches.call(this, inputEvent, inputData);
          } else if (isMouse && isSyntheticEvent.call(this, inputData)) {
              return;
          }

          this.callback(manager, inputEvent, inputData);
      },

      /**
       * remove the event listeners
       */
      destroy: function destroy() {
          this.touch.destroy();
          this.mouse.destroy();
      }
  });

  function recordTouches(eventType, eventData) {
      if (eventType & INPUT_START) {
          this.primaryTouch = eventData.changedPointers[0].identifier;
          setLastTouch.call(this, eventData);
      } else if (eventType & (INPUT_END | INPUT_CANCEL)) {
          setLastTouch.call(this, eventData);
      }
  }

  function setLastTouch(eventData) {
      var touch = eventData.changedPointers[0];

      if (touch.identifier === this.primaryTouch) {
          var lastTouch = {x: touch.clientX, y: touch.clientY};
          this.lastTouches.push(lastTouch);
          var lts = this.lastTouches;
          var removeLastTouch = function() {
              var i = lts.indexOf(lastTouch);
              if (i > -1) {
                  lts.splice(i, 1);
              }
          };
          setTimeout(removeLastTouch, DEDUP_TIMEOUT);
      }
  }

  function isSyntheticEvent(eventData) {
      var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;
      for (var i = 0; i < this.lastTouches.length; i++) {
          var t = this.lastTouches[i];
          var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);
          if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {
              return true;
          }
      }
      return false;
  }

  var PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');
  var NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;

  // magical touchAction value
  var TOUCH_ACTION_COMPUTE = 'compute';
  var TOUCH_ACTION_AUTO = 'auto';
  var TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented
  var TOUCH_ACTION_NONE = 'none';
  var TOUCH_ACTION_PAN_X = 'pan-x';
  var TOUCH_ACTION_PAN_Y = 'pan-y';
  var TOUCH_ACTION_MAP = getTouchActionProps();

  /**
   * Touch Action
   * sets the touchAction property or uses the js alternative
   * @param {Manager} manager
   * @param {String} value
   * @constructor
   */
  function TouchAction(manager, value) {
      this.manager = manager;
      this.set(value);
  }

  TouchAction.prototype = {
      /**
       * set the touchAction value on the element or enable the polyfill
       * @param {String} value
       */
      set: function(value) {
          // find out the touch-action by the event handlers
          if (value == TOUCH_ACTION_COMPUTE) {
              value = this.compute();
          }

          if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {
              this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;
          }
          this.actions = value.toLowerCase().trim();
      },

      /**
       * just re-set the touchAction value
       */
      update: function() {
          this.set(this.manager.options.touchAction);
      },

      /**
       * compute the value for the touchAction property based on the recognizer's settings
       * @returns {String} value
       */
      compute: function() {
          var actions = [];
          each(this.manager.recognizers, function(recognizer) {
              if (boolOrFn(recognizer.options.enable, [recognizer])) {
                  actions = actions.concat(recognizer.getTouchAction());
              }
          });
          return cleanTouchActions(actions.join(' '));
      },

      /**
       * this method is called on each input cycle and provides the preventing of the browser behavior
       * @param {Object} input
       */
      preventDefaults: function(input) {
          var srcEvent = input.srcEvent;
          var direction = input.offsetDirection;

          // if the touch action did prevented once this session
          if (this.manager.session.prevented) {
              srcEvent.preventDefault();
              return;
          }

          var actions = this.actions;
          var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];
          var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];
          var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];

          if (hasNone) {
              //do not prevent defaults if this is a tap gesture

              var isTapPointer = input.pointers.length === 1;
              var isTapMovement = input.distance < 2;
              var isTapTouchTime = input.deltaTime < 250;

              if (isTapPointer && isTapMovement && isTapTouchTime) {
                  return;
              }
          }

          if (hasPanX && hasPanY) {
              // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent
              return;
          }

          if (hasNone ||
              (hasPanY && direction & DIRECTION_HORIZONTAL) ||
              (hasPanX && direction & DIRECTION_VERTICAL)) {
              return this.preventSrc(srcEvent);
          }
      },

      /**
       * call preventDefault to prevent the browser's default behavior (scrolling in most cases)
       * @param {Object} srcEvent
       */
      preventSrc: function(srcEvent) {
          this.manager.session.prevented = true;
          srcEvent.preventDefault();
      }
  };

  /**
   * when the touchActions are collected they are not a valid value, so we need to clean things up. *
   * @param {String} actions
   * @returns {*}
   */
  function cleanTouchActions(actions) {
      // none
      if (inStr(actions, TOUCH_ACTION_NONE)) {
          return TOUCH_ACTION_NONE;
      }

      var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);
      var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);

      // if both pan-x and pan-y are set (different recognizers
      // for different directions, e.g. horizontal pan but vertical swipe?)
      // we need none (as otherwise with pan-x pan-y combined none of these
      // recognizers will work, since the browser would handle all panning
      if (hasPanX && hasPanY) {
          return TOUCH_ACTION_NONE;
      }

      // pan-x OR pan-y
      if (hasPanX || hasPanY) {
          return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;
      }

      // manipulation
      if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {
          return TOUCH_ACTION_MANIPULATION;
      }

      return TOUCH_ACTION_AUTO;
  }

  function getTouchActionProps() {
      if (!NATIVE_TOUCH_ACTION) {
          return false;
      }
      var touchMap = {};
      var cssSupports = window.CSS && window.CSS.supports;
      ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {

          // If css.supports is not supported but there is native touch-action assume it supports
          // all values. This is the case for IE 10 and 11.
          touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;
      });
      return touchMap;
  }

  /**
   * Recognizer flow explained; *
   * All recognizers have the initial state of POSSIBLE when a input session starts.
   * The definition of a input session is from the first input until the last input, with all it's movement in it. *
   * Example session for mouse-input: mousedown -> mousemove -> mouseup
   *
   * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed
   * which determines with state it should be.
   *
   * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to
   * POSSIBLE to give it another change on the next cycle.
   *
   *               Possible
   *                  |
   *            +-----+---------------+
   *            |                     |
   *      +-----+-----+               |
   *      |           |               |
   *   Failed      Cancelled          |
   *                          +-------+------+
   *                          |              |
   *                      Recognized       Began
   *                                         |
   *                                      Changed
   *                                         |
   *                                  Ended/Recognized
   */
  var STATE_POSSIBLE = 1;
  var STATE_BEGAN = 2;
  var STATE_CHANGED = 4;
  var STATE_ENDED = 8;
  var STATE_RECOGNIZED = STATE_ENDED;
  var STATE_CANCELLED = 16;
  var STATE_FAILED = 32;

  /**
   * Recognizer
   * Every recognizer needs to extend from this class.
   * @constructor
   * @param {Object} options
   */
  function Recognizer(options) {
      this.options = assign({}, this.defaults, options || {});

      this.id = uniqueId();

      this.manager = null;

      // default is enable true
      this.options.enable = ifUndefined(this.options.enable, true);

      this.state = STATE_POSSIBLE;

      this.simultaneous = {};
      this.requireFail = [];
  }

  Recognizer.prototype = {
      /**
       * @virtual
       * @type {Object}
       */
      defaults: {},

      /**
       * set options
       * @param {Object} options
       * @return {Recognizer}
       */
      set: function(options) {
          assign(this.options, options);

          // also update the touchAction, in case something changed about the directions/enabled state
          this.manager && this.manager.touchAction.update();
          return this;
      },

      /**
       * recognize simultaneous with an other recognizer.
       * @param {Recognizer} otherRecognizer
       * @returns {Recognizer} this
       */
      recognizeWith: function(otherRecognizer) {
          if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {
              return this;
          }

          var simultaneous = this.simultaneous;
          otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
          if (!simultaneous[otherRecognizer.id]) {
              simultaneous[otherRecognizer.id] = otherRecognizer;
              otherRecognizer.recognizeWith(this);
          }
          return this;
      },

      /**
       * drop the simultaneous link. it doesnt remove the link on the other recognizer.
       * @param {Recognizer} otherRecognizer
       * @returns {Recognizer} this
       */
      dropRecognizeWith: function(otherRecognizer) {
          if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {
              return this;
          }

          otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
          delete this.simultaneous[otherRecognizer.id];
          return this;
      },

      /**
       * recognizer can only run when an other is failing
       * @param {Recognizer} otherRecognizer
       * @returns {Recognizer} this
       */
      requireFailure: function(otherRecognizer) {
          if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {
              return this;
          }

          var requireFail = this.requireFail;
          otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
          if (inArray(requireFail, otherRecognizer) === -1) {
              requireFail.push(otherRecognizer);
              otherRecognizer.requireFailure(this);
          }
          return this;
      },

      /**
       * drop the requireFailure link. it does not remove the link on the other recognizer.
       * @param {Recognizer} otherRecognizer
       * @returns {Recognizer} this
       */
      dropRequireFailure: function(otherRecognizer) {
          if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {
              return this;
          }

          otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);
          var index = inArray(this.requireFail, otherRecognizer);
          if (index > -1) {
              this.requireFail.splice(index, 1);
          }
          return this;
      },

      /**
       * has require failures boolean
       * @returns {boolean}
       */
      hasRequireFailures: function() {
          return this.requireFail.length > 0;
      },

      /**
       * if the recognizer can recognize simultaneous with an other recognizer
       * @param {Recognizer} otherRecognizer
       * @returns {Boolean}
       */
      canRecognizeWith: function(otherRecognizer) {
          return !!this.simultaneous[otherRecognizer.id];
      },

      /**
       * You should use `tryEmit` instead of `emit` directly to check
       * that all the needed recognizers has failed before emitting.
       * @param {Object} input
       */
      emit: function(input) {
          var self = this;
          var state = this.state;

          function emit(event) {
              self.manager.emit(event, input);
          }

          // 'panstart' and 'panmove'
          if (state < STATE_ENDED) {
              emit(self.options.event + stateStr(state));
          }

          emit(self.options.event); // simple 'eventName' events

          if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)
              emit(input.additionalEvent);
          }

          // panend and pancancel
          if (state >= STATE_ENDED) {
              emit(self.options.event + stateStr(state));
          }
      },

      /**
       * Check that all the require failure recognizers has failed,
       * if true, it emits a gesture event,
       * otherwise, setup the state to FAILED.
       * @param {Object} input
       */
      tryEmit: function(input) {
          if (this.canEmit()) {
              return this.emit(input);
          }
          // it's failing anyway
          this.state = STATE_FAILED;
      },

      /**
       * can we emit?
       * @returns {boolean}
       */
      canEmit: function() {
          var i = 0;
          while (i < this.requireFail.length) {
              if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {
                  return false;
              }
              i++;
          }
          return true;
      },

      /**
       * update the recognizer
       * @param {Object} inputData
       */
      recognize: function(inputData) {
          // make a new copy of the inputData
          // so we can change the inputData without messing up the other recognizers
          var inputDataClone = assign({}, inputData);

          // is is enabled and allow recognizing?
          if (!boolOrFn(this.options.enable, [this, inputDataClone])) {
              this.reset();
              this.state = STATE_FAILED;
              return;
          }

          // reset when we've reached the end
          if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {
              this.state = STATE_POSSIBLE;
          }

          this.state = this.process(inputDataClone);

          // the recognizer has recognized a gesture
          // so trigger an event
          if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {
              this.tryEmit(inputDataClone);
          }
      },

      /**
       * return the state of the recognizer
       * the actual recognizing happens in this method
       * @virtual
       * @param {Object} inputData
       * @returns {Const} STATE
       */
      process: function(inputData) { }, // jshint ignore:line

      /**
       * return the preferred touch-action
       * @virtual
       * @returns {Array}
       */
      getTouchAction: function() { },

      /**
       * called when the gesture isn't allowed to recognize
       * like when another is being recognized or it is disabled
       * @virtual
       */
      reset: function() { }
  };

  /**
   * get a usable string, used as event postfix
   * @param {Const} state
   * @returns {String} state
   */
  function stateStr(state) {
      if (state & STATE_CANCELLED) {
          return 'cancel';
      } else if (state & STATE_ENDED) {
          return 'end';
      } else if (state & STATE_CHANGED) {
          return 'move';
      } else if (state & STATE_BEGAN) {
          return 'start';
      }
      return '';
  }

  /**
   * direction cons to string
   * @param {Const} direction
   * @returns {String}
   */
  function directionStr(direction) {
      if (direction == DIRECTION_DOWN) {
          return 'down';
      } else if (direction == DIRECTION_UP) {
          return 'up';
      } else if (direction == DIRECTION_LEFT) {
          return 'left';
      } else if (direction == DIRECTION_RIGHT) {
          return 'right';
      }
      return '';
  }

  /**
   * get a recognizer by name if it is bound to a manager
   * @param {Recognizer|String} otherRecognizer
   * @param {Recognizer} recognizer
   * @returns {Recognizer}
   */
  function getRecognizerByNameIfManager(otherRecognizer, recognizer) {
      var manager = recognizer.manager;
      if (manager) {
          return manager.get(otherRecognizer);
      }
      return otherRecognizer;
  }

  /**
   * This recognizer is just used as a base for the simple attribute recognizers.
   * @constructor
   * @extends Recognizer
   */
  function AttrRecognizer() {
      Recognizer.apply(this, arguments);
  }

  inherit(AttrRecognizer, Recognizer, {
      /**
       * @namespace
       * @memberof AttrRecognizer
       */
      defaults: {
          /**
           * @type {Number}
           * @default 1
           */
          pointers: 1
      },

      /**
       * Used to check if it the recognizer receives valid input, like input.distance > 10.
       * @memberof AttrRecognizer
       * @param {Object} input
       * @returns {Boolean} recognized
       */
      attrTest: function(input) {
          var optionPointers = this.options.pointers;
          return optionPointers === 0 || input.pointers.length === optionPointers;
      },

      /**
       * Process the input and return the state for the recognizer
       * @memberof AttrRecognizer
       * @param {Object} input
       * @returns {*} State
       */
      process: function(input) {
          var state = this.state;
          var eventType = input.eventType;

          var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);
          var isValid = this.attrTest(input);

          // on cancel input and we've recognized before, return STATE_CANCELLED
          if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {
              return state | STATE_CANCELLED;
          } else if (isRecognized || isValid) {
              if (eventType & INPUT_END) {
                  return state | STATE_ENDED;
              } else if (!(state & STATE_BEGAN)) {
                  return STATE_BEGAN;
              }
              return state | STATE_CHANGED;
          }
          return STATE_FAILED;
      }
  });

  /**
   * Pan
   * Recognized when the pointer is down and moved in the allowed direction.
   * @constructor
   * @extends AttrRecognizer
   */
  function PanRecognizer() {
      AttrRecognizer.apply(this, arguments);

      this.pX = null;
      this.pY = null;
  }

  inherit(PanRecognizer, AttrRecognizer, {
      /**
       * @namespace
       * @memberof PanRecognizer
       */
      defaults: {
          event: 'pan',
          threshold: 10,
          pointers: 1,
          direction: DIRECTION_ALL
      },

      getTouchAction: function() {
          var direction = this.options.direction;
          var actions = [];
          if (direction & DIRECTION_HORIZONTAL) {
              actions.push(TOUCH_ACTION_PAN_Y);
          }
          if (direction & DIRECTION_VERTICAL) {
              actions.push(TOUCH_ACTION_PAN_X);
          }
          return actions;
      },

      directionTest: function(input) {
          var options = this.options;
          var hasMoved = true;
          var distance = input.distance;
          var direction = input.direction;
          var x = input.deltaX;
          var y = input.deltaY;

          // lock to axis?
          if (!(direction & options.direction)) {
              if (options.direction & DIRECTION_HORIZONTAL) {
                  direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;
                  hasMoved = x != this.pX;
                  distance = Math.abs(input.deltaX);
              } else {
                  direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;
                  hasMoved = y != this.pY;
                  distance = Math.abs(input.deltaY);
              }
          }
          input.direction = direction;
          return hasMoved && distance > options.threshold && direction & options.direction;
      },

      attrTest: function(input) {
          return AttrRecognizer.prototype.attrTest.call(this, input) &&
              (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));
      },

      emit: function(input) {

          this.pX = input.deltaX;
          this.pY = input.deltaY;

          var direction = directionStr(input.direction);

          if (direction) {
              input.additionalEvent = this.options.event + direction;
          }
          this._super.emit.call(this, input);
      }
  });

  /**
   * Pinch
   * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).
   * @constructor
   * @extends AttrRecognizer
   */
  function PinchRecognizer() {
      AttrRecognizer.apply(this, arguments);
  }

  inherit(PinchRecognizer, AttrRecognizer, {
      /**
       * @namespace
       * @memberof PinchRecognizer
       */
      defaults: {
          event: 'pinch',
          threshold: 0,
          pointers: 2
      },

      getTouchAction: function() {
          return [TOUCH_ACTION_NONE];
      },

      attrTest: function(input) {
          return this._super.attrTest.call(this, input) &&
              (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);
      },

      emit: function(input) {
          if (input.scale !== 1) {
              var inOut = input.scale < 1 ? 'in' : 'out';
              input.additionalEvent = this.options.event + inOut;
          }
          this._super.emit.call(this, input);
      }
  });

  /**
   * Press
   * Recognized when the pointer is down for x ms without any movement.
   * @constructor
   * @extends Recognizer
   */
  function PressRecognizer() {
      Recognizer.apply(this, arguments);

      this._timer = null;
      this._input = null;
  }

  inherit(PressRecognizer, Recognizer, {
      /**
       * @namespace
       * @memberof PressRecognizer
       */
      defaults: {
          event: 'press',
          pointers: 1,
          time: 251, // minimal time of the pointer to be pressed
          threshold: 9 // a minimal movement is ok, but keep it low
      },

      getTouchAction: function() {
          return [TOUCH_ACTION_AUTO];
      },

      process: function(input) {
          var options = this.options;
          var validPointers = input.pointers.length === options.pointers;
          var validMovement = input.distance < options.threshold;
          var validTime = input.deltaTime > options.time;

          this._input = input;

          // we only allow little movement
          // and we've reached an end event, so a tap is possible
          if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {
              this.reset();
          } else if (input.eventType & INPUT_START) {
              this.reset();
              this._timer = setTimeoutContext(function() {
                  this.state = STATE_RECOGNIZED;
                  this.tryEmit();
              }, options.time, this);
          } else if (input.eventType & INPUT_END) {
              return STATE_RECOGNIZED;
          }
          return STATE_FAILED;
      },

      reset: function() {
          clearTimeout(this._timer);
      },

      emit: function(input) {
          if (this.state !== STATE_RECOGNIZED) {
              return;
          }

          if (input && (input.eventType & INPUT_END)) {
              this.manager.emit(this.options.event + 'up', input);
          } else {
              this._input.timeStamp = now();
              this.manager.emit(this.options.event, this._input);
          }
      }
  });

  /**
   * Rotate
   * Recognized when two or more pointer are moving in a circular motion.
   * @constructor
   * @extends AttrRecognizer
   */
  function RotateRecognizer() {
      AttrRecognizer.apply(this, arguments);
  }

  inherit(RotateRecognizer, AttrRecognizer, {
      /**
       * @namespace
       * @memberof RotateRecognizer
       */
      defaults: {
          event: 'rotate',
          threshold: 0,
          pointers: 2
      },

      getTouchAction: function() {
          return [TOUCH_ACTION_NONE];
      },

      attrTest: function(input) {
          return this._super.attrTest.call(this, input) &&
              (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);
      }
  });

  /**
   * Swipe
   * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.
   * @constructor
   * @extends AttrRecognizer
   */
  function SwipeRecognizer() {
      AttrRecognizer.apply(this, arguments);
  }

  inherit(SwipeRecognizer, AttrRecognizer, {
      /**
       * @namespace
       * @memberof SwipeRecognizer
       */
      defaults: {
          event: 'swipe',
          threshold: 10,
          velocity: 0.3,
          direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,
          pointers: 1
      },

      getTouchAction: function() {
          return PanRecognizer.prototype.getTouchAction.call(this);
      },

      attrTest: function(input) {
          var direction = this.options.direction;
          var velocity;

          if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {
              velocity = input.overallVelocity;
          } else if (direction & DIRECTION_HORIZONTAL) {
              velocity = input.overallVelocityX;
          } else if (direction & DIRECTION_VERTICAL) {
              velocity = input.overallVelocityY;
          }

          return this._super.attrTest.call(this, input) &&
              direction & input.offsetDirection &&
              input.distance > this.options.threshold &&
              input.maxPointers == this.options.pointers &&
              abs(velocity) > this.options.velocity && input.eventType & INPUT_END;
      },

      emit: function(input) {
          var direction = directionStr(input.offsetDirection);
          if (direction) {
              this.manager.emit(this.options.event + direction, input);
          }

          this.manager.emit(this.options.event, input);
      }
  });

  /**
   * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur
   * between the given interval and position. The delay option can be used to recognize multi-taps without firing
   * a single tap.
   *
   * The eventData from the emitted event contains the property `tapCount`, which contains the amount of
   * multi-taps being recognized.
   * @constructor
   * @extends Recognizer
   */
  function TapRecognizer() {
      Recognizer.apply(this, arguments);

      // previous time and center,
      // used for tap counting
      this.pTime = false;
      this.pCenter = false;

      this._timer = null;
      this._input = null;
      this.count = 0;
  }

  inherit(TapRecognizer, Recognizer, {
      /**
       * @namespace
       * @memberof PinchRecognizer
       */
      defaults: {
          event: 'tap',
          pointers: 1,
          taps: 1,
          interval: 300, // max time between the multi-tap taps
          time: 250, // max time of the pointer to be down (like finger on the screen)
          threshold: 9, // a minimal movement is ok, but keep it low
          posThreshold: 10 // a multi-tap can be a bit off the initial position
      },

      getTouchAction: function() {
          return [TOUCH_ACTION_MANIPULATION];
      },

      process: function(input) {
          var options = this.options;

          var validPointers = input.pointers.length === options.pointers;
          var validMovement = input.distance < options.threshold;
          var validTouchTime = input.deltaTime < options.time;

          this.reset();

          if ((input.eventType & INPUT_START) && (this.count === 0)) {
              return this.failTimeout();
          }

          // we only allow little movement
          // and we've reached an end event, so a tap is possible
          if (validMovement && validTouchTime && validPointers) {
              if (input.eventType != INPUT_END) {
                  return this.failTimeout();
              }

              var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;
              var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;

              this.pTime = input.timeStamp;
              this.pCenter = input.center;

              if (!validMultiTap || !validInterval) {
                  this.count = 1;
              } else {
                  this.count += 1;
              }

              this._input = input;

              // if tap count matches we have recognized it,
              // else it has began recognizing...
              var tapCount = this.count % options.taps;
              if (tapCount === 0) {
                  // no failing requirements, immediately trigger the tap event
                  // or wait as long as the multitap interval to trigger
                  if (!this.hasRequireFailures()) {
                      return STATE_RECOGNIZED;
                  } else {
                      this._timer = setTimeoutContext(function() {
                          this.state = STATE_RECOGNIZED;
                          this.tryEmit();
                      }, options.interval, this);
                      return STATE_BEGAN;
                  }
              }
          }
          return STATE_FAILED;
      },

      failTimeout: function() {
          this._timer = setTimeoutContext(function() {
              this.state = STATE_FAILED;
          }, this.options.interval, this);
          return STATE_FAILED;
      },

      reset: function() {
          clearTimeout(this._timer);
      },

      emit: function() {
          if (this.state == STATE_RECOGNIZED) {
              this._input.tapCount = this.count;
              this.manager.emit(this.options.event, this._input);
          }
      }
  });

  /**
   * Simple way to create a manager with a default set of recognizers.
   * @param {HTMLElement} element
   * @param {Object} [options]
   * @constructor
   */
  function Hammer(element, options) {
      options = options || {};
      options.recognizers = ifUndefined(options.recognizers, Hammer.defaults.preset);
      return new Manager(element, options);
  }

  /**
   * @const {string}
   */
  Hammer.VERSION = '2.0.7';

  /**
   * default settings
   * @namespace
   */
  Hammer.defaults = {
      /**
       * set if DOM events are being triggered.
       * But this is slower and unused by simple implementations, so disabled by default.
       * @type {Boolean}
       * @default false
       */
      domEvents: false,

      /**
       * The value for the touchAction property/fallback.
       * When set to `compute` it will magically set the correct value based on the added recognizers.
       * @type {String}
       * @default compute
       */
      touchAction: TOUCH_ACTION_COMPUTE,

      /**
       * @type {Boolean}
       * @default true
       */
      enable: true,

      /**
       * EXPERIMENTAL FEATURE -- can be removed/changed
       * Change the parent input target element.
       * If Null, then it is being set the to main element.
       * @type {Null|EventTarget}
       * @default null
       */
      inputTarget: null,

      /**
       * force an input class
       * @type {Null|Function}
       * @default null
       */
      inputClass: null,

      /**
       * Default recognizer setup when calling `Hammer()`
       * When creating a new Manager these will be skipped.
       * @type {Array}
       */
      preset: [
          // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]
          [RotateRecognizer, {enable: false}],
          [PinchRecognizer, {enable: false}, ['rotate']],
          [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],
          [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],
          [TapRecognizer],
          [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],
          [PressRecognizer]
      ],

      /**
       * Some CSS properties can be used to improve the working of Hammer.
       * Add them to this method and they will be set when creating a new Manager.
       * @namespace
       */
      cssProps: {
          /**
           * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.
           * @type {String}
           * @default 'none'
           */
          userSelect: 'none',

          /**
           * Disable the Windows Phone grippers when pressing an element.
           * @type {String}
           * @default 'none'
           */
          touchSelect: 'none',

          /**
           * Disables the default callout shown when you touch and hold a touch target.
           * On iOS, when you touch and hold a touch target such as a link, Safari displays
           * a callout containing information about the link. This property allows you to disable that callout.
           * @type {String}
           * @default 'none'
           */
          touchCallout: 'none',

          /**
           * Specifies whether zooming is enabled. Used by IE10>
           * @type {String}
           * @default 'none'
           */
          contentZooming: 'none',

          /**
           * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.
           * @type {String}
           * @default 'none'
           */
          userDrag: 'none',

          /**
           * Overrides the highlight color shown when the user taps a link or a JavaScript
           * clickable element in iOS. This property obeys the alpha value, if specified.
           * @type {String}
           * @default 'rgba(0,0,0,0)'
           */
          tapHighlightColor: 'rgba(0,0,0,0)'
      }
  };

  var STOP = 1;
  var FORCED_STOP = 2;

  /**
   * Manager
   * @param {HTMLElement} element
   * @param {Object} [options]
   * @constructor
   */
  function Manager(element, options) {
      this.options = assign({}, Hammer.defaults, options || {});

      this.options.inputTarget = this.options.inputTarget || element;

      this.handlers = {};
      this.session = {};
      this.recognizers = [];
      this.oldCssProps = {};

      this.element = element;
      this.input = createInputInstance(this);
      this.touchAction = new TouchAction(this, this.options.touchAction);

      toggleCssProps(this, true);

      each(this.options.recognizers, function(item) {
          var recognizer = this.add(new (item[0])(item[1]));
          item[2] && recognizer.recognizeWith(item[2]);
          item[3] && recognizer.requireFailure(item[3]);
      }, this);
  }

  Manager.prototype = {
      /**
       * set options
       * @param {Object} options
       * @returns {Manager}
       */
      set: function(options) {
          assign(this.options, options);

          // Options that need a little more setup
          if (options.touchAction) {
              this.touchAction.update();
          }
          if (options.inputTarget) {
              // Clean up existing event listeners and reinitialize
              this.input.destroy();
              this.input.target = options.inputTarget;
              this.input.init();
          }
          return this;
      },

      /**
       * stop recognizing for this session.
       * This session will be discarded, when a new [input]start event is fired.
       * When forced, the recognizer cycle is stopped immediately.
       * @param {Boolean} [force]
       */
      stop: function(force) {
          this.session.stopped = force ? FORCED_STOP : STOP;
      },

      /**
       * run the recognizers!
       * called by the inputHandler function on every movement of the pointers (touches)
       * it walks through all the recognizers and tries to detect the gesture that is being made
       * @param {Object} inputData
       */
      recognize: function(inputData) {
          var session = this.session;
          if (session.stopped) {
              return;
          }

          // run the touch-action polyfill
          this.touchAction.preventDefaults(inputData);

          var recognizer;
          var recognizers = this.recognizers;

          // this holds the recognizer that is being recognized.
          // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED
          // if no recognizer is detecting a thing, it is set to `null`
          var curRecognizer = session.curRecognizer;

          // reset when the last recognizer is recognized
          // or when we're in a new session
          if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {
              curRecognizer = session.curRecognizer = null;
          }

          var i = 0;
          while (i < recognizers.length) {
              recognizer = recognizers[i];

              // find out if we are allowed try to recognize the input for this one.
              // 1.   allow if the session is NOT forced stopped (see the .stop() method)
              // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one
              //      that is being recognized.
              // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.
              //      this can be setup with the `recognizeWith()` method on the recognizer.
              if (session.stopped !== FORCED_STOP && ( // 1
                      !curRecognizer || recognizer == curRecognizer || // 2
                      recognizer.canRecognizeWith(curRecognizer))) { // 3
                  recognizer.recognize(inputData);
              } else {
                  recognizer.reset();
              }

              // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the
              // current active recognizer. but only if we don't already have an active recognizer
              if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {
                  curRecognizer = session.curRecognizer = recognizer;
              }
              i++;
          }
      },

      /**
       * get a recognizer by its event name.
       * @param {Recognizer|String} recognizer
       * @returns {Recognizer|Null}
       */
      get: function(recognizer) {
          if (recognizer instanceof Recognizer) {
              return recognizer;
          }

          var recognizers = this.recognizers;
          for (var i = 0; i < recognizers.length; i++) {
              if (recognizers[i].options.event == recognizer) {
                  return recognizers[i];
              }
          }
          return null;
      },

      /**
       * add a recognizer to the manager
       * existing recognizers with the same event name will be removed
       * @param {Recognizer} recognizer
       * @returns {Recognizer|Manager}
       */
      add: function(recognizer) {
          if (invokeArrayArg(recognizer, 'add', this)) {
              return this;
          }

          // remove existing
          var existing = this.get(recognizer.options.event);
          if (existing) {
              this.remove(existing);
          }

          this.recognizers.push(recognizer);
          recognizer.manager = this;

          this.touchAction.update();
          return recognizer;
      },

      /**
       * remove a recognizer by name or instance
       * @param {Recognizer|String} recognizer
       * @returns {Manager}
       */
      remove: function(recognizer) {
          if (invokeArrayArg(recognizer, 'remove', this)) {
              return this;
          }

          recognizer = this.get(recognizer);

          // let's make sure this recognizer exists
          if (recognizer) {
              var recognizers = this.recognizers;
              var index = inArray(recognizers, recognizer);

              if (index !== -1) {
                  recognizers.splice(index, 1);
                  this.touchAction.update();
              }
          }

          return this;
      },

      /**
       * bind event
       * @param {String} events
       * @param {Function} handler
       * @returns {EventEmitter} this
       */
      on: function(events, handler) {
          if (events === undefined) {
              return;
          }
          if (handler === undefined) {
              return;
          }

          var handlers = this.handlers;
          each(splitStr(events), function(event) {
              handlers[event] = handlers[event] || [];
              handlers[event].push(handler);
          });
          return this;
      },

      /**
       * unbind event, leave emit blank to remove all handlers
       * @param {String} events
       * @param {Function} [handler]
       * @returns {EventEmitter} this
       */
      off: function(events, handler) {
          if (events === undefined) {
              return;
          }

          var handlers = this.handlers;
          each(splitStr(events), function(event) {
              if (!handler) {
                  delete handlers[event];
              } else {
                  handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);
              }
          });
          return this;
      },

      /**
       * emit event to the listeners
       * @param {String} event
       * @param {Object} data
       */
      emit: function(event, data) {
          // we also want to trigger dom events
          if (this.options.domEvents) {
              triggerDomEvent(event, data);
          }

          // no handlers, so skip it all
          var handlers = this.handlers[event] && this.handlers[event].slice();
          if (!handlers || !handlers.length) {
              return;
          }

          data.type = event;
          data.preventDefault = function() {
              data.srcEvent.preventDefault();
          };

          var i = 0;
          while (i < handlers.length) {
              handlers[i](data);
              i++;
          }
      },

      /**
       * destroy the manager and unbinds all events
       * it doesn't unbind dom events, that is the user own responsibility
       */
      destroy: function() {
          this.element && toggleCssProps(this, false);

          this.handlers = {};
          this.session = {};
          this.input.destroy();
          this.element = null;
      }
  };

  /**
   * add/remove the css properties as defined in manager.options.cssProps
   * @param {Manager} manager
   * @param {Boolean} add
   */
  function toggleCssProps(manager, add) {
      var element = manager.element;
      if (!element.style) {
          return;
      }
      var prop;
      each(manager.options.cssProps, function(value, name) {
          prop = prefixed(element.style, name);
          if (add) {
              manager.oldCssProps[prop] = element.style[prop];
              element.style[prop] = value;
          } else {
              element.style[prop] = manager.oldCssProps[prop] || '';
          }
      });
      if (!add) {
          manager.oldCssProps = {};
      }
  }

  /**
   * trigger dom event
   * @param {String} event
   * @param {Object} data
   */
  function triggerDomEvent(event, data) {
      var gestureEvent = document.createEvent('Event');
      gestureEvent.initEvent(event, true, true);
      gestureEvent.gesture = data;
      data.target.dispatchEvent(gestureEvent);
  }

  assign(Hammer, {
      INPUT_START: INPUT_START,
      INPUT_MOVE: INPUT_MOVE,
      INPUT_END: INPUT_END,
      INPUT_CANCEL: INPUT_CANCEL,

      STATE_POSSIBLE: STATE_POSSIBLE,
      STATE_BEGAN: STATE_BEGAN,
      STATE_CHANGED: STATE_CHANGED,
      STATE_ENDED: STATE_ENDED,
      STATE_RECOGNIZED: STATE_RECOGNIZED,
      STATE_CANCELLED: STATE_CANCELLED,
      STATE_FAILED: STATE_FAILED,

      DIRECTION_NONE: DIRECTION_NONE,
      DIRECTION_LEFT: DIRECTION_LEFT,
      DIRECTION_RIGHT: DIRECTION_RIGHT,
      DIRECTION_UP: DIRECTION_UP,
      DIRECTION_DOWN: DIRECTION_DOWN,
      DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,
      DIRECTION_VERTICAL: DIRECTION_VERTICAL,
      DIRECTION_ALL: DIRECTION_ALL,

      Manager: Manager,
      Input: Input,
      TouchAction: TouchAction,

      TouchInput: TouchInput,
      MouseInput: MouseInput,
      PointerEventInput: PointerEventInput,
      TouchMouseInput: TouchMouseInput,
      SingleTouchInput: SingleTouchInput,

      Recognizer: Recognizer,
      AttrRecognizer: AttrRecognizer,
      Tap: TapRecognizer,
      Pan: PanRecognizer,
      Swipe: SwipeRecognizer,
      Pinch: PinchRecognizer,
      Rotate: RotateRecognizer,
      Press: PressRecognizer,

      on: addEventListeners,
      off: removeEventListeners,
      each: each,
      merge: merge,
      extend: extend,
      assign: assign,
      inherit: inherit,
      bindFn: bindFn,
      prefixed: prefixed
  });

  // this prevents errors when Hammer is loaded in the presence of an AMD
  //  style loader but by script tag, not by the loader.
  var freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line
  freeGlobal.Hammer = Hammer;

  if (typeof undefined === 'function' && undefined.amd) {
      undefined(function() {
          return Hammer;
      });
  } else if (module.exports) {
      module.exports = Hammer;
  } else {
      window[exportName] = Hammer;
  }

  })(window, document, 'Hammer');
  });

  var homepage = "http://localhost:3000";

  window.info = {
    //sha,
    //version,
    homepage: homepage
  }; // For debugging

  window.cornerstone = cornerstone$3;
  window.cornerstoneTools = cornerstoneTools$1;
  window.cornerstoneWADOImageLoader = cornerstoneWADOImageLoader$1;
  cornerstoneTools$1.external.cornerstone = cornerstone$3;
  cornerstoneTools$1.external.Hammer = hammer;
  cornerstoneTools$1.external.cornerstoneMath = cornerstoneMath$1;
  cornerstoneTools$1.init();
  cornerstoneWADOImageLoader$1.external.cornerstone = cornerstone$3;
  cornerstoneWADOImageLoader$1.external.dicomParser = dicomParser;
  OHIF$1.external.cornerstone = cornerstone$3;
  OHIF$1.external.cornerstoneTools = cornerstoneTools$1;
  OHIF$1.external.cornerstoneMath = cornerstoneMath$1;
  OHIF$1.external.cornerstoneWADOImageLoader = cornerstoneWADOImageLoader$1; // TODO: Is there a better way to guess ROOT_URL?

  var ROOT_URL = window.location.pathname; // If the page we are on is not a subset of the expected homepage
  // provided in the package.json file, we might be doing local development.
  // In this case, set the base URL to the current location's origin.

  if (homepage.includes(window.location.origin) === false) {
    ROOT_URL = window.location.origin;
  }

  var config = {
    maxWebWorkers: Math.max(navigator.hardwareConcurrency - 1, 1),
    startWebWorkersOnDemand: true,
    webWorkerPath: ROOT_URL + '/cornerstoneWADOImageLoaderWebWorker.min.js',
    taskConfiguration: {
      decodeTask: {
        loadCodecsOnStartup: true,
        initializeCodecsOnStartup: false,
        codecsPath: ROOT_URL + '/cornerstoneWADOImageLoaderCodecs.min.js',
        usePDFJS: false,
        strict: false
      }
    }
  };
  cornerstoneWADOImageLoader$1.webWorkerManager.initialize(config);

  OHIF$1.user.getAccessToken = function () {
    // TODO: Get the Redux store from somewhere else
    var state = window.store.getState();

    if (!state.oidc || !state.oidc.user) {
      return;
    }

    return state.oidc.user.access_token;
  };

  cornerstoneWADOImageLoader$1.configure({
    beforeSend: function beforeSend(xhr) {
      var headers = OHIF$1.DICOMWeb.getAuthorizationHeader();

      if (headers.Authorization) {
        xhr.setRequestHeader("Authorization", headers.Authorization);
      }
    }
  }); // Set the tool font and font size
  // context.font = "[style] [variant] [weight] [size]/[line height] [font family]";

  var fontFamily = 'Roboto, OpenSans, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif';
  cornerstoneTools$1.textStyle.setFont("16px ".concat(fontFamily)); // Set the tool width

  cornerstoneTools$1.toolStyle.setToolWidth(2); // Set color for inactive tools

  cornerstoneTools$1.toolColors.setToolColor('rgb(255, 255, 0)'); // Set color for active tools

  cornerstoneTools$1.toolColors.setActiveColor('rgb(0, 255, 0)');
  cornerstoneTools$1.store.state.touchProximity = 40;

  var defaultState$4 = {
    leftSidebarOpen: true,
    rightSidebarOpen: false
  };

  var ui$1 = function ui() {
    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultState$4;
    var action = arguments.length > 1 ? arguments[1] : undefined;

    switch (action.type) {
      case 'SET_LEFT_SIDEBAR_OPEN':
        return Object.assign({}, state, {
          leftSidebarOpen: action.state
        });

      case 'SET_RIGHT_SIDEBAR_OPEN':
        return Object.assign({}, state, {
          rightSidebarOpen: action.state
        });

      default:
        return state;
    }
  };

  function asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator$1(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _classCallCheck$c(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties$2(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass$2(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$2(Constructor.prototype,protoProps);if(staticProps)_defineProperties$2(Constructor,staticProps);return Constructor;}function _defineProperty$3(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _extends$c(){_extends$c=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};return _extends$c.apply(this,arguments);}function _objectSpread$2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty$3(target,key,source[key]);});}return target;}function _inherits$c(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf$1(subClass,superClass);}function _getPrototypeOf$1(o){_getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf$1(o);}function _setPrototypeOf$1(o,p){_setPrototypeOf$1=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf$1(o,p);}function _assertThisInitialized$3(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _possibleConstructorReturn$c(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call;}return _assertThisInitialized$3(self);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread();}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2;}}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}var commonjsGlobal$2=typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};function unwrapExports$2(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,'default')?x.default:x;}function createCommonjsModule$2(fn,module){return module={exports:{}},fn(module,module.exports),module.exports;}/*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */ /* eslint-disable no-unused-vars */var getOwnPropertySymbols$3=Object.getOwnPropertySymbols;var hasOwnProperty$1=Object.prototype.hasOwnProperty;var propIsEnumerable$1=Object.prototype.propertyIsEnumerable;function toObject$1(val){if(val===null||val===undefined){throw new TypeError('Object.assign cannot be called with null or undefined');}return Object(val);}function shouldUseNative$1(){try{if(!Object.assign){return false;}// Detect buggy property enumeration order in older V8 versions.
  // https://bugs.chromium.org/p/v8/issues/detail?id=4118
  var test1=new String('abc');// eslint-disable-line no-new-wrappers
  test1[5]='de';if(Object.getOwnPropertyNames(test1)[0]==='5'){return false;}// https://bugs.chromium.org/p/v8/issues/detail?id=3056
  var test2={};for(var i=0;i<10;i++){test2['_'+String.fromCharCode(i)]=i;}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n];});if(order2.join('')!=='0123456789'){return false;}// https://bugs.chromium.org/p/v8/issues/detail?id=3056
  var test3={};'abcdefghijklmnopqrst'.split('').forEach(function(letter){test3[letter]=letter;});if(Object.keys(Object.assign({},test3)).join('')!=='abcdefghijklmnopqrst'){return false;}return true;}catch(err){// We don't expect any of the above to throw, but better to be safe.
  return false;}}var objectAssign$1=shouldUseNative$1()?Object.assign:function(target,source){var from;var to=toObject$1(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty$1.call(from,key)){to[key]=from[key];}}if(getOwnPropertySymbols$3){symbols=getOwnPropertySymbols$3(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable$1.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]];}}}}return to;};/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */var ReactPropTypesSecret$2='SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';var ReactPropTypesSecret_1$1=ReactPropTypesSecret$2;var printWarning$4=function(){};if(process.env.NODE_ENV!=='production'){var ReactPropTypesSecret$1$1=ReactPropTypesSecret_1$1;var loggedTypeFailures$1={};printWarning$4=function(text){var message='Warning: '+text;if(typeof console!=='undefined'){console.error(message);}try{// --- Welcome to debugging React ---
  // This error was thrown as a convenience so that you can use this stack
  // to find the callsite that caused this warning to fire.
  throw new Error(message);}catch(x){}};}/**
   * Assert that the values match with the type specs.
   * Error messages are memorized and will only be shown once.
   *
   * @param {object} typeSpecs Map of name to a ReactPropType
   * @param {object} values Runtime values that need to be type-checked
   * @param {string} location e.g. "prop", "context", "child context"
   * @param {string} componentName Name of the component for error messages.
   * @param {?Function} getStack Returns the component stack.
   * @private
   */function checkPropTypes$1(typeSpecs,values,location,componentName,getStack){if(process.env.NODE_ENV!=='production'){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;// Prop type validation may throw. In case they do, we don't want to
  // fail the render phase where it didn't fail before. So we log it.
  // After these have been cleaned up, we'll let them throw.
  try{// This is intentionally an invariant that gets caught. It's the same
  // behavior as without this statement except with a better message.
  if(typeof typeSpecs[typeSpecName]!=='function'){var err=Error((componentName||'React class')+': '+location+' type `'+typeSpecName+'` is invalid; '+'it must be a function, usually from the `prop-types` package, but received `'+typeof typeSpecs[typeSpecName]+'`.');err.name='Invariant Violation';throw err;}error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret$1$1);}catch(ex){error=ex;}if(error&&!(error instanceof Error)){printWarning$4((componentName||'React class')+': type specification of '+location+' `'+typeSpecName+'` is invalid; the type checker '+'function must return `null` or an `Error` but returned a '+typeof error+'. '+'You may have forgotten to pass an argument to the type checker '+'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and '+'shape all require an argument).');}if(error instanceof Error&&!(error.message in loggedTypeFailures$1)){// Only monitor this failure once because there tends to be a lot of the
  // same error.
  loggedTypeFailures$1[error.message]=true;var stack=getStack?getStack():'';printWarning$4('Failed '+location+' type: '+error.message+(stack!=null?stack:''));}}}}}var checkPropTypes_1$1=checkPropTypes$1;var printWarning$1$1=function(){};if(process.env.NODE_ENV!=='production'){printWarning$1$1=function(text){var message='Warning: '+text;if(typeof console!=='undefined'){console.error(message);}try{// --- Welcome to debugging React ---
  // This error was thrown as a convenience so that you can use this stack
  // to find the callsite that caused this warning to fire.
  throw new Error(message);}catch(x){}};}function emptyFunctionThatReturnsNull$1(){return null;}var factoryWithTypeCheckers$1=function(isValidElement,throwOnDirectAccess){/* global Symbol */var ITERATOR_SYMBOL=typeof Symbol==='function'&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL='@@iterator';// Before Symbol spec.
  /**
     * Returns the iterator method function contained on the iterable object.
     *
     * Be sure to invoke the function with the iterable as context:
     *
     *     var iteratorFn = getIteratorFn(myIterable);
     *     if (iteratorFn) {
     *       var iterator = iteratorFn.call(myIterable);
     *       ...
     *     }
     *
     * @param {?object} maybeIterable
     * @return {?function}
     */function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==='function'){return iteratorFn;}}/**
     * Collection of methods that allow declaration and validation of props that are
     * supplied to React components. Example usage:
     *
     *   var Props = require('ReactPropTypes');
     *   var MyArticle = React.createClass({
     *     propTypes: {
     *       // An optional string prop named "description".
     *       description: Props.string,
     *
     *       // A required enum prop named "category".
     *       category: Props.oneOf(['News','Photos']).isRequired,
     *
     *       // A prop named "dialog" that requires an instance of Dialog.
     *       dialog: Props.instanceOf(Dialog).isRequired
     *     },
     *     render: function() { ... }
     *   });
     *
     * A more formal specification of how these methods are used:
     *
     *   type := array|bool|func|object|number|string|oneOf([...])|instanceOf(...)
     *   decl := ReactPropTypes.{type}(.isRequired)?
     *
     * Each and every declaration produces a function with the same signature. This
     * allows the creation of custom validation functions. For example:
     *
     *  var MyLink = React.createClass({
     *    propTypes: {
     *      // An optional string or URI prop named "href".
     *      href: function(props, propName, componentName) {
     *        var propValue = props[propName];
     *        if (propValue != null && typeof propValue !== 'string' &&
     *            !(propValue instanceof URI)) {
     *          return new Error(
     *            'Expected a string or an URI for ' + propName + ' in ' +
     *            componentName
     *          );
     *        }
     *      }
     *    },
     *    render: function() {...}
     *  });
     *
     * @internal
     */var ANONYMOUS='<<anonymous>>';// Important!
  // Keep this list in sync with production version in `./factoryWithThrowingShims.js`.
  var ReactPropTypes={array:createPrimitiveTypeChecker('array'),bool:createPrimitiveTypeChecker('boolean'),func:createPrimitiveTypeChecker('function'),number:createPrimitiveTypeChecker('number'),object:createPrimitiveTypeChecker('object'),string:createPrimitiveTypeChecker('string'),symbol:createPrimitiveTypeChecker('symbol'),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker,exact:createStrictShapeTypeChecker};/**
     * inlined Object.is polyfill to avoid requiring consumers ship their own
     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is
     */ /*eslint-disable no-self-compare*/function is(x,y){// SameValue algorithm
  if(x===y){// Steps 1-5, 7-10
  // Steps 6.b-6.e: +0 != -0
  return x!==0||1/x===1/y;}else{// Step 6.a: NaN == NaN
  return x!==x&&y!==y;}}/*eslint-enable no-self-compare*/ /**
     * We use an Error-like object for backward compatibility as people may call
     * PropTypes directly and inspect their output. However, we don't use real
     * Errors anymore. We don't inspect their stack anyway, and creating them
     * is prohibitively expensive if they are created too often, such as what
     * happens in oneOfType() for any type before the one that matched.
     */function PropTypeError(message){this.message=message;this.stack='';}// Make `instanceof Error` still work for returned errors.
  PropTypeError.prototype=Error.prototype;function createChainableTypeChecker(validate){if(process.env.NODE_ENV!=='production'){var manualPropTypeCallCache={};var manualPropTypeWarningCount=0;}function checkType(isRequired,props,propName,componentName,location,propFullName,secret){componentName=componentName||ANONYMOUS;propFullName=propFullName||propName;if(secret!==ReactPropTypesSecret_1$1){if(throwOnDirectAccess){// New behavior only for users of `prop-types` package
  var err=new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. '+'Use `PropTypes.checkPropTypes()` to call them. '+'Read more at http://fb.me/use-check-prop-types');err.name='Invariant Violation';throw err;}else if(process.env.NODE_ENV!=='production'&&typeof console!=='undefined'){// Old behavior for people using React.PropTypes
  var cacheKey=componentName+':'+propName;if(!manualPropTypeCallCache[cacheKey]&&// Avoid spamming the console because they are often not actionable except for lib authors
  manualPropTypeWarningCount<3){printWarning$1$1('You are manually calling a React.PropTypes validation '+'function for the `'+propFullName+'` prop on `'+componentName+'`. This is deprecated '+'and will throw in the standalone `prop-types` package. '+'You may be seeing this warning due to a third-party PropTypes '+'library. See https://fb.me/react-warning-dont-call-proptypes '+'for details.');manualPropTypeCallCache[cacheKey]=true;manualPropTypeWarningCount++;}}}if(props[propName]==null){if(isRequired){if(props[propName]===null){return new PropTypeError('The '+location+' `'+propFullName+'` is marked as required '+('in `'+componentName+'`, but its value is `null`.'));}return new PropTypeError('The '+location+' `'+propFullName+'` is marked as required in '+('`'+componentName+'`, but its value is `undefined`.'));}return null;}else{return validate(props,propName,componentName,location,propFullName);}}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType;}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName];var propType=getPropType(propValue);if(propType!==expectedType){// `propValue` being instance of, say, date/regexp, pass the 'object'
  // check, but we can offer a more precise error message here rather than
  // 'of type `object`'.
  var preciseType=getPreciseType(propValue);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+preciseType+'` supplied to `'+componentName+'`, expected ')+('`'+expectedType+'`.'));}return null;}return createChainableTypeChecker(validate);}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunctionThatReturnsNull$1);}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=='function'){return new PropTypeError('Property `'+propFullName+'` of component `'+componentName+'` has invalid PropType notation inside arrayOf.');}var propValue=props[propName];if(!Array.isArray(propValue)){var propType=getPropType(propValue);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+propType+'` supplied to `'+componentName+'`, expected an array.'));}for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+'['+i+']',ReactPropTypesSecret_1$1);if(error instanceof Error){return error;}}return null;}return createChainableTypeChecker(validate);}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!isValidElement(propValue)){var propType=getPropType(propValue);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+propType+'` supplied to `'+componentName+'`, expected a single ReactElement.'));}return null;}return createChainableTypeChecker(validate);}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS;var actualClassName=getClassName(props[propName]);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+actualClassName+'` supplied to `'+componentName+'`, expected ')+('instance of `'+expectedClassName+'`.'));}return null;}return createChainableTypeChecker(validate);}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues)){process.env.NODE_ENV!=='production'?printWarning$1$1('Invalid argument supplied to oneOf, expected an instance of array.'):void 0;return emptyFunctionThatReturnsNull$1;}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];for(var i=0;i<expectedValues.length;i++){if(is(propValue,expectedValues[i])){return null;}}var valuesString=JSON.stringify(expectedValues);return new PropTypeError('Invalid '+location+' `'+propFullName+'` of value `'+propValue+'` '+('supplied to `'+componentName+'`, expected one of '+valuesString+'.'));}return createChainableTypeChecker(validate);}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=='function'){return new PropTypeError('Property `'+propFullName+'` of component `'+componentName+'` has invalid PropType notation inside objectOf.');}var propValue=props[propName];var propType=getPropType(propValue);if(propType!=='object'){return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type '+('`'+propType+'` supplied to `'+componentName+'`, expected an object.'));}for(var key in propValue){if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+'.'+key,ReactPropTypesSecret_1$1);if(error instanceof Error){return error;}}}return null;}return createChainableTypeChecker(validate);}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers)){process.env.NODE_ENV!=='production'?printWarning$1$1('Invalid argument supplied to oneOfType, expected an instance of array.'):void 0;return emptyFunctionThatReturnsNull$1;}for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(typeof checker!=='function'){printWarning$1$1('Invalid argument supplied to oneOfType. Expected an array of check functions, but '+'received '+getPostfixForTypeWarning(checker)+' at index '+i+'.');return emptyFunctionThatReturnsNull$1;}}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(checker(props,propName,componentName,location,propFullName,ReactPropTypesSecret_1$1)==null){return null;}}return new PropTypeError('Invalid '+location+' `'+propFullName+'` supplied to '+('`'+componentName+'`.'));}return createChainableTypeChecker(validate);}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){if(!isNode(props[propName])){return new PropTypeError('Invalid '+location+' `'+propFullName+'` supplied to '+('`'+componentName+'`, expected a ReactNode.'));}return null;}return createChainableTypeChecker(validate);}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=='object'){return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type `'+propType+'` '+('supplied to `'+componentName+'`, expected `object`.'));}for(var key in shapeTypes){var checker=shapeTypes[key];if(!checker){continue;}var error=checker(propValue,key,componentName,location,propFullName+'.'+key,ReactPropTypesSecret_1$1);if(error){return error;}}return null;}return createChainableTypeChecker(validate);}function createStrictShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=='object'){return new PropTypeError('Invalid '+location+' `'+propFullName+'` of type `'+propType+'` '+('supplied to `'+componentName+'`, expected `object`.'));}// We need to check all keys in case some are required but missing from
  // props.
  var allKeys=objectAssign$1({},props[propName],shapeTypes);for(var key in allKeys){var checker=shapeTypes[key];if(!checker){return new PropTypeError('Invalid '+location+' `'+propFullName+'` key `'+key+'` supplied to `'+componentName+'`.'+'\nBad object: '+JSON.stringify(props[propName],null,'  ')+'\nValid keys: '+JSON.stringify(Object.keys(shapeTypes),null,'  '));}var error=checker(propValue,key,componentName,location,propFullName+'.'+key,ReactPropTypesSecret_1$1);if(error){return error;}}return null;}return createChainableTypeChecker(validate);}function isNode(propValue){switch(typeof propValue){case'number':case'string':case'undefined':return true;case'boolean':return !propValue;case'object':if(Array.isArray(propValue)){return propValue.every(isNode);}if(propValue===null||isValidElement(propValue)){return true;}var iteratorFn=getIteratorFn(propValue);if(iteratorFn){var iterator=iteratorFn.call(propValue);var step;if(iteratorFn!==propValue.entries){while(!(step=iterator.next()).done){if(!isNode(step.value)){return false;}}}else{// Iterator will provide entry [k,v] tuples rather than values.
  while(!(step=iterator.next()).done){var entry=step.value;if(entry){if(!isNode(entry[1])){return false;}}}}}else{return false;}return true;default:return false;}}function isSymbol(propType,propValue){// Native Symbol.
  if(propType==='symbol'){return true;}// 19.4.3.5 Symbol.prototype[@@toStringTag] === 'Symbol'
  if(propValue['@@toStringTag']==='Symbol'){return true;}// Fallback for non-spec compliant Symbols which are polyfilled.
  if(typeof Symbol==='function'&&propValue instanceof Symbol){return true;}return false;}// Equivalent of `typeof` but with special handling for array and regexp.
  function getPropType(propValue){var propType=typeof propValue;if(Array.isArray(propValue)){return 'array';}if(propValue instanceof RegExp){// Old webkits (at least until Android 4.0) return 'function' rather than
  // 'object' for typeof a RegExp. We'll normalize this here so that /bla/
  // passes PropTypes.object.
  return 'object';}if(isSymbol(propType,propValue)){return 'symbol';}return propType;}// This handles more types than `getPropType`. Only used for error messages.
  // See `createPrimitiveTypeChecker`.
  function getPreciseType(propValue){if(typeof propValue==='undefined'||propValue===null){return ''+propValue;}var propType=getPropType(propValue);if(propType==='object'){if(propValue instanceof Date){return 'date';}else if(propValue instanceof RegExp){return 'regexp';}}return propType;}// Returns a string that is postfixed to a warning about an invalid type.
  // For example, "undefined" or "of type array"
  function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case'array':case'object':return 'an '+type;case'boolean':case'date':case'regexp':return 'a '+type;default:return type;}}// Returns class name of the object, if any.
  function getClassName(propValue){if(!propValue.constructor||!propValue.constructor.name){return ANONYMOUS;}return propValue.constructor.name;}ReactPropTypes.checkPropTypes=checkPropTypes_1$1;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes;};function emptyFunction$1(){}var factoryWithThrowingShims$1=function(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret_1$1){// It is still safe when called from React.
  return;}var err=new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. '+'Use PropTypes.checkPropTypes() to call them. '+'Read more at http://fb.me/use-check-prop-types');err.name='Invariant Violation';throw err;}shim.isRequired=shim;function getShim(){return shim;}// Important!
  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.
  var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim};ReactPropTypes.checkPropTypes=emptyFunction$1;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes;};var propTypes$1=createCommonjsModule$2(function(module){/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */if(process.env.NODE_ENV!=='production'){var REACT_ELEMENT_TYPE=typeof Symbol==='function'&&Symbol.for&&Symbol.for('react.element')||0xeac7;var isValidElement=function(object){return typeof object==='object'&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE;};// By explicitly using `prop-types` you are opting into new development behavior.
  // http://fb.me/prop-types-in-prod
  var throwOnDirectAccess=true;module.exports=factoryWithTypeCheckers$1(isValidElement,throwOnDirectAccess);}else{// By explicitly using `prop-types` you are opting into new production behavior.
  // http://fb.me/prop-types-in-prod
  module.exports=factoryWithThrowingShims$1();}});function styleInject(css,ref){if(ref===void 0)ref={};var insertAt=ref.insertAt;if(!css||typeof document==='undefined'){return;}var head=document.head||document.getElementsByTagName('head')[0];var style=document.createElement('style');style.type='text/css';if(insertAt==='top'){if(head.firstChild){head.insertBefore(style,head.firstChild);}else{head.appendChild(style);}}else{head.appendChild(style);}if(style.styleSheet){style.styleSheet.cssText=css;}else{style.appendChild(document.createTextNode(css));}}var css=".CineDialog {\n  background: var(--ui-gray-darkest);\n  color: var(--text-secondary-color);\n  filter: drop-shadow(0 0 3px var(--ui-gray-darkest));\n  border: none;\n  border-radius: 8px;\n  width: inherit;\n}\n.CineDialog h5 {\n  font-size: 20px;\n  line-height: 35px;\n  margin: 0;\n}\n.CineDialog h5,\n.CineDialog label {\n  font-weight: 400;\n}\n.CineDialog .cine-navigation,\n.CineDialog .cine-controls,\n.CineDialog .cine-options {\n  cursor: default;\n}\n.CineDialog .fps-section input[type=\"range\"] {\n  background-color: transparent;\n  border: 0 none;\n  outline: 0 none;\n}\n.CineDialog .fps-section input[type=\"range\"]::-ms-tooltip {\n  display: none;\n}\n.CineDialog .double-row-style {\n  box-sizing: border-box;\n  width: 290px;\n  height: 80px;\n  padding: 10px;\n  top: 2%;\n  left: 35%;\n}\n.CineDialog .double-row-style .cine-navigation {\n  position: absolute;\n  right: 16px;\n  top: 10px;\n}\n.CineDialog .double-row-style .cine-navigation .btn {\n  padding: 0 4px;\n}\n.CineDialog .double-row-style .cine-navigation .btn i {\n  font-size: 32px;\n  line-height: 32px;\n}\n.CineDialog .double-row-style .cine-controls {\n  left: 0px;\n}\n.CineDialog .double-row-style .cine-options {\n  padding: 0px 0;\n}\n.CineDialog .double-row-style .cine-options .fps-section {\n  width: 175px;\n  float: left;\n}\n.CineDialog .double-row-style .cine-options .fps {\n  float: right;\n  margin: 5px 20px 0 0;\n}\n.CineDialog .single-row-style {\n  box-sizing: content-box;\n  width: 425px;\n  height: 45px;\n  padding: 4px 8px;\n  top: 2%;\n  left: 35%;\n}\n.CineDialog .single-row-style .cine-navigation {\n  float: right;\n  overflow: hidden;\n  padding-right: 12px;\n  position: relative;\n}\n.CineDialog .single-row-style .cine-navigation .btn {\n  padding: 0 2px;\n  margin: 0 0 0 2px;\n  border: 0 none;\n}\n.CineDialog .single-row-style .cine-navigation .btn:first-of-type {\n  margin-left: 0;\n}\n.CineDialog .single-row-style .cine-navigation .btn i {\n  font-size: 32px;\n  line-height: 45px;\n}\n.CineDialog .single-row-style .cine-controls {\n  position: relative;\n  float: left;\n  overflow: hidden;\n}\n.CineDialog .single-row-style .cine-controls .btn {\n  font-size: 22px;\n  line-height: 45px;\n  min-width: 28px;\n  padding: 0 0px;\n  margin: 0 4px;\n  border: 0 none;\n}\n.CineDialog .single-row-style .cine-options {\n  display: block;\n  position: relative;\n  width: 150px;\n  float: left;\n  overflow: hidden;\n  padding: 0;\n  margin: 0 0 0 10px;\n}\n.CineDialog .single-row-style .cine-options .fps-section {\n  display: block;\n  float: left;\n  width: 80px;\n}\n.CineDialog .single-row-style .cine-options .fps-section input[type=\"range\"] {\n  line-height: 45px;\n  height: 45px;\n}\n.CineDialog .single-row-style .cine-options .fps {\n  display: block;\n  width: 68px;\n  float: left;\n  padding: 0;\n  margin: 0 0 0 2px;\n  text-align: center;\n  line-height: 45px;\n  font-size: 14px;\n  line-height: 1.42857143;\n}\n.CineDialog .btn {\n  color: var(--text-secondary-color);\n  background-color: transparent;\n  border: 0;\n  border-radius: 4px;\n  font-size: 15px;\n  font-weight: normal;\n  height: 37px;\n  line-height: 37px;\n  padding: 0 12px;\n}\n.CineDialog .btn:hover,\n.CineDialog .btn:active,\n.CineDialog .btn.active {\n  color: var(--hover-color);\n}\n.CineDialog .btn[disabled]:hover {\n  color: inherit;\n}\n.CineDialog .btn[disabled]:active {\n  color: var(--text-secondary-color);\n}\n.CineDialog .btn.btn-primary,\n.CineDialog .btn.btn-secondary,\n.CineDialog .btn.btn-danger {\n  transition: background-color 0.3s ease;\n}\n.CineDialog .btn.btn-primary:hover,\n.CineDialog .btn.btn-secondary:hover,\n.CineDialog .btn.btn-danger:hover,\n.CineDialog .btn.btn-primary:active,\n.CineDialog .btn.btn-secondary:active,\n.CineDialog .btn.btn-danger:active,\n.CineDialog .btn.btn-primary:focus,\n.CineDialog .btn.btn-secondary:focus,\n.CineDialog .btn.btn-danger:focus {\n  opacity: 0.8;\n}\n.CineDialog .btn.btn-primary {\n  background-color: var(--active-color);\n  color: var(--primary-background-color);\n}\n.CineDialog .btn.btn-secondary {\n  background-color: var(--text-secondary-color);\n  color: var(--primary-background-color);\n}\n.CineDialog .btn.btn-danger {\n  background-color: var(--text-destructive-color);\n  color: var(--text-primary-color);\n}\n.CineDialog .btn.active {\n  box-shadow: inset 1px 1px 2px var(--ui-gray-darkest);\n}\n";styleInject(css);var CineDialog=/*#__PURE__*/function(_PureComponent){_inherits$c(CineDialog,_PureComponent);function CineDialog(props){var _this;_classCallCheck$c(this,CineDialog);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(CineDialog).call(this,props));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"handleInputChange",function(event){var target=event.target;var value=target.value;if(target.type==='range'){value=parseFloat(target.value);}var name=target.name;_this.setState(_defineProperty$3({},name,value));if(name==='cineFrameRate'&&_this.props.onFrameRateChanged){_this.props.onFrameRateChanged(parseFloat(value));}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClickPlayPause",function(){var value=!_this.state.isPlaying;_this.setState({isPlaying:value});if(_this.props.onPlayPauseChanged){_this.props.onPlayPauseChanged(value);}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClickNextButton",function(event){if(_this.props.onClickNextButton){_this.props.onClickNextButton(event);}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClickBackButton",function(event){if(_this.props.onClickBackButton){_this.props.onClickBackButton(event);}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClickSkipToStart",function(event){if(_this.props.onClickSkipToStart){_this.props.onClickSkipToStart(event);}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClickSkipToEnd",function(event){if(_this.props.onClickSkipToEnd){_this.props.onClickSkipToEnd(event);}});_this.state={cineFrameRate:props.cineFrameRate,isPlaying:props.isPlaying};return _this;}_createClass$2(CineDialog,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){// TODO: Not sure if we should just switch this to a stateless
  // fully-controlled component instead
  if(this.props.isPlaying!==prevProps.isPlaying||this.props.isPlaying!==this.state.isPlaying){this.setState({isPlaying:this.props.isPlaying});}if(this.props.cineFrameRate!==prevProps.cineFrameRate||this.props.cineFrameRate!==this.state.cineFrameRate){this.setState({cineFrameRate:this.props.cineFrameRate});}}},{key:"render",// TODO:
  // - Add next / previous display set buttons which just call
  // onClickNextDisplaySet and onClickPreviousDisplaySet which are passed in as props.
  // See https://github.com/OHIF/Viewers/blob/master/Packages/ohif-viewerbase/client/components/viewer/cineDialog/cineDialog.html#L38
  // - Add 'isEnabled' prop: https://github.com/OHIF/Viewers/blob/master/Packages/ohif-viewerbase/client/components/viewer/cineDialog/cineDialog.js#L301
  value:function render(){return React__default.createElement("div",{className:"CineDialog"},React__default.createElement("div",{className:"noselect double-row-style"},React__default.createElement("div",{className:"cine-controls"},React__default.createElement("div",{className:"btn-group"},React__default.createElement("button",{id:"cineFirstButton",title:"Skip to first image",className:"btn","data-toggle":"tooltip",onClick:this.onClickSkipToStart},React__default.createElement("i",{className:"fa fa-lg fa-fast-backward"})),React__default.createElement("button",{id:"cineBackButton",title:"Previous image",className:"btn","data-toggle":"tooltip",onClick:this.onClickBackButton},React__default.createElement("i",{className:"fa fa-lg fa-step-backward"})),React__default.createElement("button",{id:"cinePlayButton",title:"Play / Stop",className:"btn","data-toggle":"tooltip",onClick:this.onClickPlayPause},React__default.createElement("i",{className:this.state.isPlaying?'fa fa-lg fa-stop':'fa fa-lg fa-play'})),React__default.createElement("button",{id:"cineNextButton",title:"Next image",className:"btn","data-toggle":"tooltip",onClick:this.onClickNextButton},React__default.createElement("i",{className:"fa fa-lg fa-step-forward"})),React__default.createElement("button",{id:"cineLastButton",title:"Skip to last image",className:"btn","data-toggle":"tooltip",onClick:this.onClickSkipToEnd},React__default.createElement("i",{className:"fa fa-lg fa-fast-forward"})))),React__default.createElement("div",{className:"cine-options"},React__default.createElement("div",{className:"fps-section"},React__default.createElement("input",{type:"range",name:"cineFrameRate",id:"cineSlider",min:this.props.cineMinFrameRate,max:this.props.cineMaxFrameRate,step:this.props.cineStepFrameRate,value:this.state.cineFrameRate,onChange:this.handleInputChange})),React__default.createElement("span",{className:"fps"},this.state.cineFrameRate.toFixed(1)," fps"))));}}]);return CineDialog;}(React.PureComponent);_defineProperty$3(CineDialog,"propTypes",{cineMinFrameRate:propTypes$1.number.isRequired,cineMaxFrameRate:propTypes$1.number.isRequired,cineStepFrameRate:propTypes$1.number.isRequired,cineFrameRate:propTypes$1.number.isRequired,isPlaying:propTypes$1.bool.isRequired,onPlayPauseChanged:propTypes$1.func,onFrameRateChanged:propTypes$1.func,onClickNextButton:propTypes$1.func,onClickBackButton:propTypes$1.func,onClickSkipToStart:propTypes$1.func,onClickSkipToEnd:propTypes$1.func});_defineProperty$3(CineDialog,"defaultProps",{cineMinFrameRate:1,cineMaxFrameRate:90,cineStepFrameRate:1,cineFrameRate:24,isPlaying:false});var interfaces=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var HandlerRole;(function(HandlerRole){HandlerRole["SOURCE"]="SOURCE";HandlerRole["TARGET"]="TARGET";})(HandlerRole=exports.HandlerRole||(exports.HandlerRole={}));});unwrapExports$2(interfaces);var interfaces_1=interfaces.HandlerRole;function symbolObservablePonyfill$1(root){var result;var Symbol=root.Symbol;if(typeof Symbol==='function'){if(Symbol.observable){result=Symbol.observable;}else{result=Symbol('observable');Symbol.observable=result;}}else{result='@@observable';}return result;}/* global window */var root$1;if(typeof self!=='undefined'){root$1=self;}else if(typeof window!=='undefined'){root$1=window;}else if(typeof global!=='undefined'){root$1=global;}else if(typeof module!=='undefined'){root$1=module;}else{root$1=Function('return this')();}var result$1=symbolObservablePonyfill$1(root$1);/**
   * These are private action types reserved by Redux.
   * For any unknown actions, you must return the current state.
   * If the current state is undefined, you must return the initial state.
   * Do not reference these action types directly in your code.
   */var randomString$1=function randomString(){return Math.random().toString(36).substring(7).split('').join('.');};var ActionTypes$1={INIT:"@@redux/INIT"+randomString$1(),REPLACE:"@@redux/REPLACE"+randomString$1(),PROBE_UNKNOWN_ACTION:function PROBE_UNKNOWN_ACTION(){return "@@redux/PROBE_UNKNOWN_ACTION"+randomString$1();}};/**
   * @param {any} obj The object to inspect.
   * @returns {boolean} True if the argument appears to be a plain object.
   */function isPlainObject$2(obj){if(typeof obj!=='object'||obj===null)return false;var proto=obj;while(Object.getPrototypeOf(proto)!==null){proto=Object.getPrototypeOf(proto);}return Object.getPrototypeOf(obj)===proto;}/**
   * Creates a Redux store that holds the state tree.
   * The only way to change the data in the store is to call `dispatch()` on it.
   *
   * There should only be a single store in your app. To specify how different
   * parts of the state tree respond to actions, you may combine several reducers
   * into a single reducer function by using `combineReducers`.
   *
   * @param {Function} reducer A function that returns the next state tree, given
   * the current state tree and the action to handle.
   *
   * @param {any} [preloadedState] The initial state. You may optionally specify it
   * to hydrate the state from the server in universal apps, or to restore a
   * previously serialized user session.
   * If you use `combineReducers` to produce the root reducer function, this must be
   * an object with the same shape as `combineReducers` keys.
   *
   * @param {Function} [enhancer] The store enhancer. You may optionally specify it
   * to enhance the store with third-party capabilities such as middleware,
   * time travel, persistence, etc. The only store enhancer that ships with Redux
   * is `applyMiddleware()`.
   *
   * @returns {Store} A Redux store that lets you read the state, dispatch actions
   * and subscribe to changes.
   */function createStore$1(reducer,preloadedState,enhancer){var _ref2;if(typeof preloadedState==='function'&&typeof enhancer==='function'||typeof enhancer==='function'&&typeof arguments[3]==='function'){throw new Error('It looks like you are passing several store enhancers to '+'createStore(). This is not supported. Instead, compose them '+'together to a single function');}if(typeof preloadedState==='function'&&typeof enhancer==='undefined'){enhancer=preloadedState;preloadedState=undefined;}if(typeof enhancer!=='undefined'){if(typeof enhancer!=='function'){throw new Error('Expected the enhancer to be a function.');}return enhancer(createStore$1)(reducer,preloadedState);}if(typeof reducer!=='function'){throw new Error('Expected the reducer to be a function.');}var currentReducer=reducer;var currentState=preloadedState;var currentListeners=[];var nextListeners=currentListeners;var isDispatching=false;function ensureCanMutateNextListeners(){if(nextListeners===currentListeners){nextListeners=currentListeners.slice();}}/**
     * Reads the state tree managed by the store.
     *
     * @returns {any} The current state tree of your application.
     */function getState(){if(isDispatching){throw new Error('You may not call store.getState() while the reducer is executing. '+'The reducer has already received the state as an argument. '+'Pass it down from the top reducer instead of reading it from the store.');}return currentState;}/**
     * Adds a change listener. It will be called any time an action is dispatched,
     * and some part of the state tree may potentially have changed. You may then
     * call `getState()` to read the current state tree inside the callback.
     *
     * You may call `dispatch()` from a change listener, with the following
     * caveats:
     *
     * 1. The subscriptions are snapshotted just before every `dispatch()` call.
     * If you subscribe or unsubscribe while the listeners are being invoked, this
     * will not have any effect on the `dispatch()` that is currently in progress.
     * However, the next `dispatch()` call, whether nested or not, will use a more
     * recent snapshot of the subscription list.
     *
     * 2. The listener should not expect to see all state changes, as the state
     * might have been updated multiple times during a nested `dispatch()` before
     * the listener is called. It is, however, guaranteed that all subscribers
     * registered before the `dispatch()` started will be called with the latest
     * state by the time it exits.
     *
     * @param {Function} listener A callback to be invoked on every dispatch.
     * @returns {Function} A function to remove this change listener.
     */function subscribe(listener){if(typeof listener!=='function'){throw new Error('Expected the listener to be a function.');}if(isDispatching){throw new Error('You may not call store.subscribe() while the reducer is executing. '+'If you would like to be notified after the store has been updated, subscribe from a '+'component and invoke store.getState() in the callback to access the latest state. '+'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');}var isSubscribed=true;ensureCanMutateNextListeners();nextListeners.push(listener);return function unsubscribe(){if(!isSubscribed){return;}if(isDispatching){throw new Error('You may not unsubscribe from a store listener while the reducer is executing. '+'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');}isSubscribed=false;ensureCanMutateNextListeners();var index=nextListeners.indexOf(listener);nextListeners.splice(index,1);};}/**
     * Dispatches an action. It is the only way to trigger a state change.
     *
     * The `reducer` function, used to create the store, will be called with the
     * current state tree and the given `action`. Its return value will
     * be considered the **next** state of the tree, and the change listeners
     * will be notified.
     *
     * The base implementation only supports plain object actions. If you want to
     * dispatch a Promise, an Observable, a thunk, or something else, you need to
     * wrap your store creating function into the corresponding middleware. For
     * example, see the documentation for the `redux-thunk` package. Even the
     * middleware will eventually dispatch plain object actions using this method.
     *
     * @param {Object} action A plain object representing what changed. It is
     * a good idea to keep actions serializable so you can record and replay user
     * sessions, or use the time travelling `redux-devtools`. An action must have
     * a `type` property which may not be `undefined`. It is a good idea to use
     * string constants for action types.
     *
     * @returns {Object} For convenience, the same action object you dispatched.
     *
     * Note that, if you use a custom middleware, it may wrap `dispatch()` to
     * return something else (for example, a Promise you can await).
     */function dispatch(action){if(!isPlainObject$2(action)){throw new Error('Actions must be plain objects. '+'Use custom middleware for async actions.');}if(typeof action.type==='undefined'){throw new Error('Actions may not have an undefined "type" property. '+'Have you misspelled a constant?');}if(isDispatching){throw new Error('Reducers may not dispatch actions.');}try{isDispatching=true;currentState=currentReducer(currentState,action);}finally{isDispatching=false;}var listeners=currentListeners=nextListeners;for(var i=0;i<listeners.length;i++){var listener=listeners[i];listener();}return action;}/**
     * Replaces the reducer currently used by the store to calculate the state.
     *
     * You might need this if your app implements code splitting and you want to
     * load some of the reducers dynamically. You might also need this if you
     * implement a hot reloading mechanism for Redux.
     *
     * @param {Function} nextReducer The reducer for the store to use instead.
     * @returns {void}
     */function replaceReducer(nextReducer){if(typeof nextReducer!=='function'){throw new Error('Expected the nextReducer to be a function.');}currentReducer=nextReducer;dispatch({type:ActionTypes$1.REPLACE});}/**
     * Interoperability point for observable/reactive libraries.
     * @returns {observable} A minimal observable of state changes.
     * For more information, see the observable proposal:
     * https://github.com/tc39/proposal-observable
     */function observable(){var _ref;var outerSubscribe=subscribe;return _ref={/**
         * The minimal observable subscription method.
         * @param {Object} observer Any object that can be used as an observer.
         * The observer object should have a `next` method.
         * @returns {subscription} An object with an `unsubscribe` method that can
         * be used to unsubscribe the observable from the store, and prevent further
         * emission of values from the observable.
         */subscribe:function subscribe(observer){if(typeof observer!=='object'||observer===null){throw new TypeError('Expected the observer to be an object.');}function observeState(){if(observer.next){observer.next(getState());}}observeState();var unsubscribe=outerSubscribe(observeState);return {unsubscribe:unsubscribe};}},_ref[result$1]=function(){return this;},_ref;}// When a store is created, an "INIT" action is dispatched so that every
  // reducer returns their initial state. This effectively populates
  // the initial state tree.
  dispatch({type:ActionTypes$1.INIT});return _ref2={dispatch:dispatch,subscribe:subscribe,getState:getState,replaceReducer:replaceReducer},_ref2[result$1]=observable,_ref2;}/**
   * Prints a warning in the console if it exists.
   *
   * @param {String} message The warning message.
   * @returns {void}
   */function warning$5(message){/* eslint-disable no-console */if(typeof console!=='undefined'&&typeof console.error==='function'){console.error(message);}/* eslint-enable no-console */try{// This error was thrown as a convenience so that if you enable
  // "break on all exceptions" in your console,
  // it would pause the execution at this line.
  throw new Error(message);}catch(e){}// eslint-disable-line no-empty
  }function getUndefinedStateErrorMessage$1(key,action){var actionType=action&&action.type;var actionDescription=actionType&&"action \""+String(actionType)+"\""||'an action';return "Given "+actionDescription+", reducer \""+key+"\" returned undefined. "+"To ignore an action, you must explicitly return the previous state. "+"If you want this reducer to hold no value, you can return null instead of undefined.";}function getUnexpectedStateShapeWarningMessage$1(inputState,reducers,action,unexpectedKeyCache){var reducerKeys=Object.keys(reducers);var argumentName=action&&action.type===ActionTypes$1.INIT?'preloadedState argument passed to createStore':'previous state received by the reducer';if(reducerKeys.length===0){return 'Store does not have a valid reducer. Make sure the argument passed '+'to combineReducers is an object whose values are reducers.';}if(!isPlainObject$2(inputState)){return "The "+argumentName+" has unexpected type of \""+{}.toString.call(inputState).match(/\s([a-z|A-Z]+)/)[1]+"\". Expected argument to be an object with the following "+("keys: \""+reducerKeys.join('", "')+"\"");}var unexpectedKeys=Object.keys(inputState).filter(function(key){return !reducers.hasOwnProperty(key)&&!unexpectedKeyCache[key];});unexpectedKeys.forEach(function(key){unexpectedKeyCache[key]=true;});if(action&&action.type===ActionTypes$1.REPLACE)return;if(unexpectedKeys.length>0){return "Unexpected "+(unexpectedKeys.length>1?'keys':'key')+" "+("\""+unexpectedKeys.join('", "')+"\" found in "+argumentName+". ")+"Expected to find one of the known reducer keys instead: "+("\""+reducerKeys.join('", "')+"\". Unexpected keys will be ignored.");}}function assertReducerShape$1(reducers){Object.keys(reducers).forEach(function(key){var reducer=reducers[key];var initialState=reducer(undefined,{type:ActionTypes$1.INIT});if(typeof initialState==='undefined'){throw new Error("Reducer \""+key+"\" returned undefined during initialization. "+"If the state passed to the reducer is undefined, you must "+"explicitly return the initial state. The initial state may "+"not be undefined. If you don't want to set a value for this reducer, "+"you can use null instead of undefined.");}if(typeof reducer(undefined,{type:ActionTypes$1.PROBE_UNKNOWN_ACTION()})==='undefined'){throw new Error("Reducer \""+key+"\" returned undefined when probed with a random type. "+("Don't try to handle "+ActionTypes$1.INIT+" or other actions in \"redux/*\" ")+"namespace. They are considered private. Instead, you must return the "+"current state for any unknown actions, unless it is undefined, "+"in which case you must return the initial state, regardless of the "+"action type. The initial state may not be undefined, but can be null.");}});}/**
   * Turns an object whose values are different reducer functions, into a single
   * reducer function. It will call every child reducer, and gather their results
   * into a single state object, whose keys correspond to the keys of the passed
   * reducer functions.
   *
   * @param {Object} reducers An object whose values correspond to different
   * reducer functions that need to be combined into one. One handy way to obtain
   * it is to use ES6 `import * as reducers` syntax. The reducers may never return
   * undefined for any action. Instead, they should return their initial state
   * if the state passed to them was undefined, and the current state for any
   * unrecognized action.
   *
   * @returns {Function} A reducer function that invokes every reducer inside the
   * passed object, and builds a state object with the same shape.
   */function combineReducers$1(reducers){var reducerKeys=Object.keys(reducers);var finalReducers={};for(var i=0;i<reducerKeys.length;i++){var key=reducerKeys[i];if(process.env.NODE_ENV!=='production'){if(typeof reducers[key]==='undefined'){warning$5("No reducer provided for key \""+key+"\"");}}if(typeof reducers[key]==='function'){finalReducers[key]=reducers[key];}}var finalReducerKeys=Object.keys(finalReducers);var unexpectedKeyCache;if(process.env.NODE_ENV!=='production'){unexpectedKeyCache={};}var shapeAssertionError;try{assertReducerShape$1(finalReducers);}catch(e){shapeAssertionError=e;}return function combination(state,action){if(state===void 0){state={};}if(shapeAssertionError){throw shapeAssertionError;}if(process.env.NODE_ENV!=='production'){var warningMessage=getUnexpectedStateShapeWarningMessage$1(state,finalReducers,action,unexpectedKeyCache);if(warningMessage){warning$5(warningMessage);}}var hasChanged=false;var nextState={};for(var _i=0;_i<finalReducerKeys.length;_i++){var _key=finalReducerKeys[_i];var reducer=finalReducers[_key];var previousStateForKey=state[_key];var nextStateForKey=reducer(previousStateForKey,action);if(typeof nextStateForKey==='undefined'){var errorMessage=getUndefinedStateErrorMessage$1(_key,action);throw new Error(errorMessage);}nextState[_key]=nextStateForKey;hasChanged=hasChanged||nextStateForKey!==previousStateForKey;}return hasChanged?nextState:state;};}function bindActionCreator$1(actionCreator,dispatch){return function(){return dispatch(actionCreator.apply(this,arguments));};}/**
   * Turns an object whose values are action creators, into an object with the
   * same keys, but with every function wrapped into a `dispatch` call so they
   * may be invoked directly. This is just a convenience method, as you can call
   * `store.dispatch(MyActionCreators.doSomething())` yourself just fine.
   *
   * For convenience, you can also pass a single function as the first argument,
   * and get a function in return.
   *
   * @param {Function|Object} actionCreators An object whose values are action
   * creator functions. One handy way to obtain it is to use ES6 `import * as`
   * syntax. You may also pass a single function.
   *
   * @param {Function} dispatch The `dispatch` function available on your Redux
   * store.
   *
   * @returns {Function|Object} The object mimicking the original object, but with
   * every action creator wrapped into the `dispatch` call. If you passed a
   * function as `actionCreators`, the return value will also be a single
   * function.
   */function bindActionCreators$1(actionCreators,dispatch){if(typeof actionCreators==='function'){return bindActionCreator$1(actionCreators,dispatch);}if(typeof actionCreators!=='object'||actionCreators===null){throw new Error("bindActionCreators expected an object or a function, instead received "+(actionCreators===null?'null':typeof actionCreators)+". "+"Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?");}var keys=Object.keys(actionCreators);var boundActionCreators={};for(var i=0;i<keys.length;i++){var key=keys[i];var actionCreator=actionCreators[key];if(typeof actionCreator==='function'){boundActionCreators[key]=bindActionCreator$1(actionCreator,dispatch);}}return boundActionCreators;}function _defineProperty$1$1(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _objectSpread$1$1(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty$1$1(target,key,source[key]);});}return target;}/**
   * Composes single-argument functions from right to left. The rightmost
   * function can take multiple arguments as it provides the signature for
   * the resulting composite function.
   *
   * @param {...Function} funcs The functions to compose.
   * @returns {Function} A function obtained by composing the argument functions
   * from right to left. For example, compose(f, g, h) is identical to doing
   * (...args) => f(g(h(...args))).
   */function compose$1(){for(var _len=arguments.length,funcs=new Array(_len),_key=0;_key<_len;_key++){funcs[_key]=arguments[_key];}if(funcs.length===0){return function(arg){return arg;};}if(funcs.length===1){return funcs[0];}return funcs.reduce(function(a,b){return function(){return a(b.apply(void 0,arguments));};});}/**
   * Creates a store enhancer that applies middleware to the dispatch method
   * of the Redux store. This is handy for a variety of tasks, such as expressing
   * asynchronous actions in a concise manner, or logging every action payload.
   *
   * See `redux-thunk` package as an example of the Redux middleware.
   *
   * Because middleware is potentially asynchronous, this should be the first
   * store enhancer in the composition chain.
   *
   * Note that each middleware will be given the `dispatch` and `getState` functions
   * as named arguments.
   *
   * @param {...Function} middlewares The middleware chain to be applied.
   * @returns {Function} A store enhancer applying the middleware.
   */function applyMiddleware$1(){for(var _len=arguments.length,middlewares=new Array(_len),_key=0;_key<_len;_key++){middlewares[_key]=arguments[_key];}return function(createStore){return function(){var store=createStore.apply(void 0,arguments);var _dispatch=function dispatch(){throw new Error("Dispatching while constructing your middleware is not allowed. "+"Other middleware would not be applied to this dispatch.");};var middlewareAPI={getState:store.getState,dispatch:function dispatch(){return _dispatch.apply(void 0,arguments);}};var chain=middlewares.map(function(middleware){return middleware(middlewareAPI);});_dispatch=compose$1.apply(void 0,chain)(store.dispatch);return _objectSpread$1$1({},store,{dispatch:_dispatch});};};}/*
   * This is a dummy function to check if the function name has been altered by minification.
   * If the function has been minified and NODE_ENV !== 'production', warn the user.
   */function isCrushed$1(){}if(process.env.NODE_ENV!=='production'&&typeof isCrushed$1.name==='string'&&isCrushed$1.name!=='isCrushed'){warning$5('You are currently using minified code outside of NODE_ENV === "production". '+'This means that you are running a slower development build of Redux. '+'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify '+'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) '+'to ensure you have the correct code for your production build.');}var redux$1=/*#__PURE__*/Object.freeze({createStore:createStore$1,combineReducers:combineReducers$1,bindActionCreators:bindActionCreators$1,applyMiddleware:applyMiddleware$1,compose:compose$1,__DO_NOT_USE__ActionTypes:ActionTypes$1});var types=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.INIT_COORDS='dnd-core/INIT_COORDS';exports.BEGIN_DRAG='dnd-core/BEGIN_DRAG';exports.PUBLISH_DRAG_SOURCE='dnd-core/PUBLISH_DRAG_SOURCE';exports.HOVER='dnd-core/HOVER';exports.DROP='dnd-core/DROP';exports.END_DRAG='dnd-core/END_DRAG';});unwrapExports$2(types);var types_1=types.INIT_COORDS;var types_2=types.BEGIN_DRAG;var types_3=types.PUBLISH_DRAG_SOURCE;var types_4=types.HOVER;var types_5=types.DROP;var types_6=types.END_DRAG;var setClientOffset_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function setClientOffset(clientOffset,sourceClientOffset){return {type:types.INIT_COORDS,payload:{sourceClientOffset:sourceClientOffset||null,clientOffset:clientOffset||null}};}exports.setClientOffset=setClientOffset;});unwrapExports$2(setClientOffset_1);var setClientOffset_2=setClientOffset_1.setClientOffset;/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */ /**
   * Use invariant() to assert state which your program assumes to be true.
   *
   * Provide sprintf-style format (only %s is supported) and arguments
   * to provide information about what broke and what you were
   * expecting.
   *
   * The invariant message will be stripped in production, but the invariant
   * will remain to ensure logic does not differ in production.
   */var NODE_ENV$1=process.env.NODE_ENV;var invariant$1=function(condition,format,a,b,c,d,e,f){if(NODE_ENV$1!=='production'){if(format===undefined){throw new Error('invariant requires an error message argument');}}if(!condition){var error;if(format===undefined){error=new Error('Minified exception occurred; use the non-minified dev environment '+'for the full error message and additional helpful warnings.');}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++];}));error.name='Invariant Violation';}error.framesToPop=1;// we don't care about invariant's own frame
  throw error;}};var invariant_1$1=invariant$1;/**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */function isObject$1(value){var type=typeof value;return value!=null&&(type=='object'||type=='function');}var isObject_1=isObject$1;var beginDrag=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var ResetCoordinatesAction={type:types.INIT_COORDS,payload:{clientOffset:null,sourceClientOffset:null}};function createBeginDrag(manager){return function beginDrag(sourceIds,options){if(sourceIds===void 0){sourceIds=[];}if(options===void 0){options={publishSource:true};}var _a=options.publishSource,publishSource=_a===void 0?true:_a,clientOffset=options.clientOffset,getSourceClientOffset=options.getSourceClientOffset;var monitor=manager.getMonitor();var registry=manager.getRegistry();// Initialize the coordinates using the client offset
  manager.dispatch(setClientOffset_1.setClientOffset(clientOffset));verifyInvariants(sourceIds,monitor,registry);// Get the draggable source
  var sourceId=getDraggableSource(sourceIds,monitor);if(sourceId===null){manager.dispatch(ResetCoordinatesAction);return;}// Get the source client offset
  var sourceClientOffset=null;if(clientOffset){verifyGetSourceClientOffsetIsFunction(getSourceClientOffset);sourceClientOffset=getSourceClientOffset(sourceId);}// Initialize the full coordinates
  manager.dispatch(setClientOffset_1.setClientOffset(clientOffset,sourceClientOffset));var source=registry.getSource(sourceId);var item=source.beginDrag(monitor,sourceId);verifyItemIsObject(item);registry.pinSource(sourceId);var itemType=registry.getSourceType(sourceId);return {type:types.BEGIN_DRAG,payload:{itemType:itemType,item:item,sourceId:sourceId,clientOffset:clientOffset||null,sourceClientOffset:sourceClientOffset||null,isSourcePublic:!!publishSource}};};}exports.default=createBeginDrag;function verifyInvariants(sourceIds,monitor,registry){invariant_1$1(!monitor.isDragging(),'Cannot call beginDrag while dragging.');for(var _i=0,sourceIds_1=sourceIds;_i<sourceIds_1.length;_i++){var s=sourceIds_1[_i];invariant_1$1(registry.getSource(s),'Expected sourceIds to be registered.');}}function verifyGetSourceClientOffsetIsFunction(getSourceClientOffset){invariant_1$1(typeof getSourceClientOffset==='function','When clientOffset is provided, getSourceClientOffset must be a function.');}function verifyItemIsObject(item){invariant_1$1(isObject_1(item),'Item must be an object.');}function getDraggableSource(sourceIds,monitor){var sourceId=null;for(var i=sourceIds.length-1;i>=0;i--){if(monitor.canDragSource(sourceIds[i])){sourceId=sourceIds[i];break;}}return sourceId;}});unwrapExports$2(beginDrag);var publishDragSource=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function createPublishDragSource(manager){return function publishDragSource(){var monitor=manager.getMonitor();if(monitor.isDragging()){return {type:types.PUBLISH_DRAG_SOURCE};}};}exports.default=createPublishDragSource;});unwrapExports$2(publishDragSource);var matchesType_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function matchesType(targetType,draggedItemType){if(draggedItemType===null){return targetType===null;}return Array.isArray(targetType)?targetType.some(function(t){return t===draggedItemType;}):targetType===draggedItemType;}exports.default=matchesType;});unwrapExports$2(matchesType_1);var hover=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function createHover(manager){return function hover(targetIdsArg,_a){var clientOffset=(_a===void 0?{}:_a).clientOffset;verifyTargetIdsIsArray(targetIdsArg);var targetIds=targetIdsArg.slice(0);var monitor=manager.getMonitor();var registry=manager.getRegistry();checkInvariants(targetIds,monitor,registry);var draggedItemType=monitor.getItemType();removeNonMatchingTargetIds(targetIds,registry,draggedItemType);hoverAllTargets(targetIds,monitor,registry);return {type:types.HOVER,payload:{targetIds:targetIds,clientOffset:clientOffset||null}};};}exports.default=createHover;function verifyTargetIdsIsArray(targetIdsArg){invariant_1$1(Array.isArray(targetIdsArg),'Expected targetIds to be an array.');}function checkInvariants(targetIds,monitor,registry){invariant_1$1(monitor.isDragging(),'Cannot call hover while not dragging.');invariant_1$1(!monitor.didDrop(),'Cannot call hover after drop.');for(var i=0;i<targetIds.length;i++){var targetId=targetIds[i];invariant_1$1(targetIds.lastIndexOf(targetId)===i,'Expected targetIds to be unique in the passed array.');var target=registry.getTarget(targetId);invariant_1$1(target,'Expected targetIds to be registered.');}}function removeNonMatchingTargetIds(targetIds,registry,draggedItemType){// Remove those targetIds that don't match the targetType.  This
  // fixes shallow isOver which would only be non-shallow because of
  // non-matching targets.
  for(var i=targetIds.length-1;i>=0;i--){var targetId=targetIds[i];var targetType=registry.getTargetType(targetId);if(!matchesType_1.default(targetType,draggedItemType)){targetIds.splice(i,1);}}}function hoverAllTargets(targetIds,monitor,registry){// Finally call hover on all matching targets.
  for(var _i=0,targetIds_1=targetIds;_i<targetIds_1.length;_i++){var targetId=targetIds_1[_i];var target=registry.getTarget(targetId);target.hover(monitor,targetId);}}});unwrapExports$2(hover);var drop=createCommonjsModule$2(function(module,exports){var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});function createDrop(manager){return function drop(options){if(options===void 0){options={};}var monitor=manager.getMonitor();var registry=manager.getRegistry();verifyInvariants(monitor);var targetIds=getDroppableTargets(monitor);// Multiple actions are dispatched here, which is why this doesn't return an action
  targetIds.forEach(function(targetId,index){var dropResult=determineDropResult(targetId,index,registry,monitor);var action={type:types.DROP,payload:{dropResult:__assign({},options,dropResult)}};manager.dispatch(action);});};}exports.default=createDrop;function verifyInvariants(monitor){invariant_1$1(monitor.isDragging(),'Cannot call drop while not dragging.');invariant_1$1(!monitor.didDrop(),'Cannot call drop twice during one drag operation.');}function determineDropResult(targetId,index,registry,monitor){var target=registry.getTarget(targetId);var dropResult=target.drop(monitor,targetId);verifyDropResultType(dropResult);if(typeof dropResult==='undefined'){dropResult=index===0?{}:monitor.getDropResult();}return dropResult;}function verifyDropResultType(dropResult){invariant_1$1(typeof dropResult==='undefined'||isObject_1(dropResult),'Drop result must either be an object or undefined.');}function getDroppableTargets(monitor){var targetIds=monitor.getTargetIds().filter(monitor.canDropOnTarget,monitor);targetIds.reverse();return targetIds;}});unwrapExports$2(drop);var endDrag=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function createEndDrag(manager){return function endDrag(){var monitor=manager.getMonitor();var registry=manager.getRegistry();verifyIsDragging(monitor);var sourceId=monitor.getSourceId();var source=registry.getSource(sourceId,true);source.endDrag(monitor,sourceId);registry.unpinSource();return {type:types.END_DRAG};};}exports.default=createEndDrag;function verifyIsDragging(monitor){invariant_1$1(monitor.isDragging(),'Cannot call endDrag while not dragging.');}});unwrapExports$2(endDrag);var dragDrop=createCommonjsModule$2(function(module,exports){function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p];}Object.defineProperty(exports,"__esModule",{value:true});__export(types);function createDragDropActions(manager){return {beginDrag:beginDrag.default(manager),publishDragSource:publishDragSource.default(manager),hover:hover.default(manager),drop:drop.default(manager),endDrag:endDrag.default(manager)};}exports.default=createDragDropActions;});unwrapExports$2(dragDrop);var equality=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.strictEquality=function(a,b){return a===b;};/**
   * Determine if two cartesian coordinate offsets are equal
   * @param offsetA
   * @param offsetB
   */function areCoordsEqual(offsetA,offsetB){if(!offsetA&&!offsetB){return true;}else if(!offsetA||!offsetB){return false;}else{return offsetA.x===offsetB.x&&offsetA.y===offsetB.y;}}exports.areCoordsEqual=areCoordsEqual;/**
   * Determines if two arrays of items are equal
   * @param a The first array of items
   * @param b The second array of items
   */function areArraysEqual(a,b,isEqual){if(isEqual===void 0){isEqual=exports.strictEquality;}if(a.length!==b.length){return false;}for(var i=0;i<a.length;++i){if(!isEqual(a[i],b[i])){return false;}}return true;}exports.areArraysEqual=areArraysEqual;});unwrapExports$2(equality);var equality_1=equality.strictEquality;var equality_2=equality.areCoordsEqual;var equality_3=equality.areArraysEqual;var dragOffset_1=createCommonjsModule$2(function(module,exports){var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});var initialState={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function dragOffset(state,action){if(state===void 0){state=initialState;}var payload=action.payload;switch(action.type){case dragDrop.INIT_COORDS:case dragDrop.BEGIN_DRAG:return {initialSourceClientOffset:payload.sourceClientOffset,initialClientOffset:payload.clientOffset,clientOffset:payload.clientOffset};case dragDrop.HOVER:if(equality.areCoordsEqual(state.clientOffset,payload.clientOffset)){return state;}return __assign({},state,{clientOffset:payload.clientOffset});case dragDrop.END_DRAG:case dragDrop.DROP:return initialState;default:return state;}}exports.default=dragOffset;});unwrapExports$2(dragOffset_1);var registry=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ADD_SOURCE='dnd-core/ADD_SOURCE';exports.ADD_TARGET='dnd-core/ADD_TARGET';exports.REMOVE_SOURCE='dnd-core/REMOVE_SOURCE';exports.REMOVE_TARGET='dnd-core/REMOVE_TARGET';function addSource(sourceId){return {type:exports.ADD_SOURCE,payload:{sourceId:sourceId}};}exports.addSource=addSource;function addTarget(targetId){return {type:exports.ADD_TARGET,payload:{targetId:targetId}};}exports.addTarget=addTarget;function removeSource(sourceId){return {type:exports.REMOVE_SOURCE,payload:{sourceId:sourceId}};}exports.removeSource=removeSource;function removeTarget(targetId){return {type:exports.REMOVE_TARGET,payload:{targetId:targetId}};}exports.removeTarget=removeTarget;});unwrapExports$2(registry);var registry_1=registry.ADD_SOURCE;var registry_2=registry.ADD_TARGET;var registry_3=registry.REMOVE_SOURCE;var registry_4=registry.REMOVE_TARGET;var registry_5=registry.addSource;var registry_6=registry.addTarget;var registry_7=registry.removeSource;var registry_8=registry.removeTarget;/** Detect free variable `global` from Node.js. */var freeGlobal=typeof commonjsGlobal$2=='object'&&commonjsGlobal$2&&commonjsGlobal$2.Object===Object&&commonjsGlobal$2;var _freeGlobal=freeGlobal;/** Detect free variable `self`. */var freeSelf=typeof self=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root$1$1=_freeGlobal||freeSelf||Function('return this')();var _root=root$1$1;/** Built-in value references. */var Symbol$1=_root.Symbol;var _Symbol=Symbol$1;/** Used for built-in method references. */var objectProto=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$1$1=objectProto.hasOwnProperty;/**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */var nativeObjectToString=objectProto.toString;/** Built-in value references. */var symToStringTag=_Symbol?_Symbol.toStringTag:undefined;/**
   * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the raw `toStringTag`.
   */function getRawTag(value){var isOwn=hasOwnProperty$1$1.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true;}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag;}else{delete value[symToStringTag];}}return result;}var _getRawTag=getRawTag;/** Used for built-in method references. */var objectProto$1=Object.prototype;/**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */var nativeObjectToString$1=objectProto$1.toString;/**
   * Converts `value` to a string using `Object.prototype.toString`.
   *
   * @private
   * @param {*} value The value to convert.
   * @returns {string} Returns the converted string.
   */function objectToString(value){return nativeObjectToString$1.call(value);}var _objectToString=objectToString;/** `Object#toString` result references. */var nullTag='[object Null]',undefinedTag='[object Undefined]';/** Built-in value references. */var symToStringTag$1=_Symbol?_Symbol.toStringTag:undefined;/**
   * The base implementation of `getTag` without fallbacks for buggy environments.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag;}return symToStringTag$1&&symToStringTag$1 in Object(value)?_getRawTag(value):_objectToString(value);}var _baseGetTag=baseGetTag;/** `Object#toString` result references. */var asyncTag='[object AsyncFunction]',funcTag='[object Function]',genTag='[object GeneratorFunction]',proxyTag='[object Proxy]';/**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */function isFunction$1(value){if(!isObject_1(value)){return false;}// The use of `Object#toString` avoids issues with the `typeof` operator
  // in Safari 9 which returns 'object' for typed arrays and other constructors.
  var tag=_baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag;}var isFunction_1=isFunction$1;/** Used to detect overreaching core-js shims. */var coreJsData=_root['__core-js_shared__'];var _coreJsData=coreJsData;/** Used to detect methods masquerading as native. */var maskSrcKey=function(){var uid=/[^.]+$/.exec(_coreJsData&&_coreJsData.keys&&_coreJsData.keys.IE_PROTO||'');return uid?'Symbol(src)_1.'+uid:'';}();/**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */function isMasked(func){return !!maskSrcKey&&maskSrcKey in func;}var _isMasked=isMasked;/** Used for built-in method references. */var funcProto=Function.prototype;/** Used to resolve the decompiled source of functions. */var funcToString=funcProto.toString;/**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to convert.
   * @returns {string} Returns the source code.
   */function toSource(func){if(func!=null){try{return funcToString.call(func);}catch(e){}try{return func+'';}catch(e){}}return '';}var _toSource=toSource;/**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;/** Used to detect host constructors (Safari). */var reIsHostCtor=/^\[object .+?Constructor\]$/;/** Used for built-in method references. */var funcProto$1=Function.prototype,objectProto$2=Object.prototype;/** Used to resolve the decompiled source of functions. */var funcToString$1=funcProto$1.toString;/** Used to check objects for own properties. */var hasOwnProperty$2=objectProto$2.hasOwnProperty;/** Used to detect if a method is native. */var reIsNative=RegExp('^'+funcToString$1.call(hasOwnProperty$2).replace(reRegExpChar,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');/**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */function baseIsNative(value){if(!isObject_1(value)||_isMasked(value)){return false;}var pattern=isFunction_1(value)?reIsNative:reIsHostCtor;return pattern.test(_toSource(value));}var _baseIsNative=baseIsNative;/**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */function getValue(object,key){return object==null?undefined:object[key];}var _getValue=getValue;/**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */function getNative(object,key){var value=_getValue(object,key);return _baseIsNative(value)?value:undefined;}var _getNative=getNative;/* Built-in method references that are verified to be native. */var nativeCreate=_getNative(Object,'create');var _nativeCreate=nativeCreate;/**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */function hashClear(){this.__data__=_nativeCreate?_nativeCreate(null):{};this.size=0;}var _hashClear=hashClear;/**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result;}var _hashDelete=hashDelete;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED='__lodash_hash_undefined__';/** Used for built-in method references. */var objectProto$3=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$3=objectProto$3.hasOwnProperty;/**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function hashGet(key){var data=this.__data__;if(_nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result;}return hasOwnProperty$3.call(data,key)?data[key]:undefined;}var _hashGet=hashGet;/** Used for built-in method references. */var objectProto$4=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$4=objectProto$4.hasOwnProperty;/**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function hashHas(key){var data=this.__data__;return _nativeCreate?data[key]!==undefined:hasOwnProperty$4.call(data,key);}var _hashHas=hashHas;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED$1='__lodash_hash_undefined__';/**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=_nativeCreate&&value===undefined?HASH_UNDEFINED$1:value;return this;}var _hashSet=hashSet;/**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}// Add methods to `Hash`.
  Hash.prototype.clear=_hashClear;Hash.prototype['delete']=_hashDelete;Hash.prototype.get=_hashGet;Hash.prototype.has=_hashHas;Hash.prototype.set=_hashSet;var _Hash=Hash;/**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */function listCacheClear(){this.__data__=[];this.size=0;}var _listCacheClear=listCacheClear;/**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */function eq(value,other){return value===other||value!==value&&other!==other;}var eq_1=eq;/**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function assocIndexOf(array,key){var length=array.length;while(length--){if(eq_1(array[length][0],key)){return length;}}return -1;}var _assocIndexOf=assocIndexOf;/** Used for built-in method references. */var arrayProto=Array.prototype;/** Built-in value references. */var splice=arrayProto.splice;/**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function listCacheDelete(key){var data=this.__data__,index=_assocIndexOf(data,key);if(index<0){return false;}var lastIndex=data.length-1;if(index==lastIndex){data.pop();}else{splice.call(data,index,1);}--this.size;return true;}var _listCacheDelete=listCacheDelete;/**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function listCacheGet(key){var data=this.__data__,index=_assocIndexOf(data,key);return index<0?undefined:data[index][1];}var _listCacheGet=listCacheGet;/**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function listCacheHas(key){return _assocIndexOf(this.__data__,key)>-1;}var _listCacheHas=listCacheHas;/**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */function listCacheSet(key,value){var data=this.__data__,index=_assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value]);}else{data[index][1]=value;}return this;}var _listCacheSet=listCacheSet;/**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}// Add methods to `ListCache`.
  ListCache.prototype.clear=_listCacheClear;ListCache.prototype['delete']=_listCacheDelete;ListCache.prototype.get=_listCacheGet;ListCache.prototype.has=_listCacheHas;ListCache.prototype.set=_listCacheSet;var _ListCache=ListCache;/* Built-in method references that are verified to be native. */var Map$1=_getNative(_root,'Map');var _Map=Map$1;/**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */function mapCacheClear(){this.size=0;this.__data__={'hash':new _Hash(),'map':new(_Map||_ListCache)(),'string':new _Hash()};}var _mapCacheClear=mapCacheClear;/**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */function isKeyable(value){var type=typeof value;return type=='string'||type=='number'||type=='symbol'||type=='boolean'?value!=='__proto__':value===null;}var _isKeyable=isKeyable;/**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */function getMapData(map,key){var data=map.__data__;return _isKeyable(key)?data[typeof key=='string'?'string':'hash']:data.map;}var _getMapData=getMapData;/**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function mapCacheDelete(key){var result=_getMapData(this,key)['delete'](key);this.size-=result?1:0;return result;}var _mapCacheDelete=mapCacheDelete;/**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function mapCacheGet(key){return _getMapData(this,key).get(key);}var _mapCacheGet=mapCacheGet;/**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function mapCacheHas(key){return _getMapData(this,key).has(key);}var _mapCacheHas=mapCacheHas;/**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */function mapCacheSet(key,value){var data=_getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this;}var _mapCacheSet=mapCacheSet;/**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}// Add methods to `MapCache`.
  MapCache.prototype.clear=_mapCacheClear;MapCache.prototype['delete']=_mapCacheDelete;MapCache.prototype.get=_mapCacheGet;MapCache.prototype.has=_mapCacheHas;MapCache.prototype.set=_mapCacheSet;var _MapCache=MapCache;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED$2='__lodash_hash_undefined__';/**
   * Adds `value` to the array cache.
   *
   * @private
   * @name add
   * @memberOf SetCache
   * @alias push
   * @param {*} value The value to cache.
   * @returns {Object} Returns the cache instance.
   */function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED$2);return this;}var _setCacheAdd=setCacheAdd;/**
   * Checks if `value` is in the array cache.
   *
   * @private
   * @name has
   * @memberOf SetCache
   * @param {*} value The value to search for.
   * @returns {number} Returns `true` if `value` is found, else `false`.
   */function setCacheHas(value){return this.__data__.has(value);}var _setCacheHas=setCacheHas;/**
   *
   * Creates an array cache object to store unique values.
   *
   * @private
   * @constructor
   * @param {Array} [values] The values to cache.
   */function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new _MapCache();while(++index<length){this.add(values[index]);}}// Add methods to `SetCache`.
  SetCache.prototype.add=SetCache.prototype.push=_setCacheAdd;SetCache.prototype.has=_setCacheHas;var _SetCache=SetCache;/**
   * The base implementation of `_.findIndex` and `_.findLastIndex` without
   * support for iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {Function} predicate The function invoked per iteration.
   * @param {number} fromIndex The index to search from.
   * @param {boolean} [fromRight] Specify iterating from right to left.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index;}}return -1;}var _baseFindIndex=baseFindIndex;/**
   * The base implementation of `_.isNaN` without support for number objects.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.
   */function baseIsNaN(value){return value!==value;}var _baseIsNaN=baseIsNaN;/**
   * A specialized version of `_.indexOf` which performs strict equality
   * comparisons of values, i.e. `===`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index;}}return -1;}var _strictIndexOf=strictIndexOf;/**
   * The base implementation of `_.indexOf` without `fromIndex` bounds checks.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function baseIndexOf(array,value,fromIndex){return value===value?_strictIndexOf(array,value,fromIndex):_baseFindIndex(array,_baseIsNaN,fromIndex);}var _baseIndexOf=baseIndexOf;/**
   * A specialized version of `_.includes` for arrays without support for
   * specifying an index to search from.
   *
   * @private
   * @param {Array} [array] The array to inspect.
   * @param {*} target The value to search for.
   * @returns {boolean} Returns `true` if `target` is found, else `false`.
   */function arrayIncludes(array,value){var length=array==null?0:array.length;return !!length&&_baseIndexOf(array,value,0)>-1;}var _arrayIncludes=arrayIncludes;/**
   * This function is like `arrayIncludes` except that it accepts a comparator.
   *
   * @private
   * @param {Array} [array] The array to inspect.
   * @param {*} target The value to search for.
   * @param {Function} comparator The comparator invoked per element.
   * @returns {boolean} Returns `true` if `target` is found, else `false`.
   */function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true;}}return false;}var _arrayIncludesWith=arrayIncludesWith;/**
   * A specialized version of `_.map` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the new mapped array.
   */function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array);}return result;}var _arrayMap=arrayMap;/**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */function baseUnary(func){return function(value){return func(value);};}var _baseUnary=baseUnary;/**
   * Checks if a `cache` value for `key` exists.
   *
   * @private
   * @param {Object} cache The cache to query.
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function cacheHas(cache,key){return cache.has(key);}var _cacheHas=cacheHas;/** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE=200;/**
   * The base implementation of methods like `_.difference` without support
   * for excluding multiple arrays or iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {Array} values The values to exclude.
   * @param {Function} [iteratee] The iteratee invoked per element.
   * @param {Function} [comparator] The comparator invoked per element.
   * @returns {Array} Returns the new array of filtered values.
   */function baseDifference(array,values,iteratee,comparator){var index=-1,includes=_arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result;}if(iteratee){values=_arrayMap(values,_baseUnary(iteratee));}if(comparator){includes=_arrayIncludesWith;isCommon=false;}else if(values.length>=LARGE_ARRAY_SIZE){includes=_cacheHas;isCommon=false;values=new _SetCache(values);}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer;}}result.push(value);}else if(!includes(values,computed,comparator)){result.push(value);}}return result;}var _baseDifference=baseDifference;/**
   * This method returns the first argument it receives.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Util
   * @param {*} value Any value.
   * @returns {*} Returns `value`.
   * @example
   *
   * var object = { 'a': 1 };
   *
   * console.log(_.identity(object) === object);
   * // => true
   */function identity(value){return value;}var identity_1=identity;/**
   * A faster alternative to `Function#apply`, this function invokes `func`
   * with the `this` binding of `thisArg` and the arguments of `args`.
   *
   * @private
   * @param {Function} func The function to invoke.
   * @param {*} thisArg The `this` binding of `func`.
   * @param {Array} args The arguments to invoke `func` with.
   * @returns {*} Returns the result of `func`.
   */function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2]);}return func.apply(thisArg,args);}var _apply=apply;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeMax=Math.max;/**
   * A specialized version of `baseRest` which transforms the rest array.
   *
   * @private
   * @param {Function} func The function to apply a rest parameter to.
   * @param {number} [start=func.length-1] The start position of the rest parameter.
   * @param {Function} transform The rest array transform.
   * @returns {Function} Returns the new function.
   */function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index];}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index];}otherArgs[start]=transform(array);return _apply(func,this,otherArgs);};}var _overRest=overRest;/**
   * Creates a function that returns `value`.
   *
   * @static
   * @memberOf _
   * @since 2.4.0
   * @category Util
   * @param {*} value The value to return from the new function.
   * @returns {Function} Returns the new constant function.
   * @example
   *
   * var objects = _.times(2, _.constant({ 'a': 1 }));
   *
   * console.log(objects);
   * // => [{ 'a': 1 }, { 'a': 1 }]
   *
   * console.log(objects[0] === objects[1]);
   * // => true
   */function constant(value){return function(){return value;};}var constant_1=constant;var defineProperty$3=function(){try{var func=_getNative(Object,'defineProperty');func({},'',{});return func;}catch(e){}}();var _defineProperty$2$1=defineProperty$3;/**
   * The base implementation of `setToString` without support for hot loop shorting.
   *
   * @private
   * @param {Function} func The function to modify.
   * @param {Function} string The `toString` result.
   * @returns {Function} Returns `func`.
   */var baseSetToString=!_defineProperty$2$1?identity_1:function(func,string){return _defineProperty$2$1(func,'toString',{'configurable':true,'enumerable':false,'value':constant_1(string),'writable':true});};var _baseSetToString=baseSetToString;/** Used to detect hot functions by number of calls within a span of milliseconds. */var HOT_COUNT=800,HOT_SPAN=16;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeNow=Date.now;/**
   * Creates a function that'll short out and invoke `identity` instead
   * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`
   * milliseconds.
   *
   * @private
   * @param {Function} func The function to restrict.
   * @returns {Function} Returns the new shortable function.
   */function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0];}}else{count=0;}return func.apply(undefined,arguments);};}var _shortOut=shortOut;/**
   * Sets the `toString` method of `func` to return `string`.
   *
   * @private
   * @param {Function} func The function to modify.
   * @param {Function} string The `toString` result.
   * @returns {Function} Returns `func`.
   */var setToString=_shortOut(_baseSetToString);var _setToString=setToString;/**
   * The base implementation of `_.rest` which doesn't validate or coerce arguments.
   *
   * @private
   * @param {Function} func The function to apply a rest parameter to.
   * @param {number} [start=func.length-1] The start position of the rest parameter.
   * @returns {Function} Returns the new function.
   */function baseRest(func,start){return _setToString(_overRest(func,start,identity_1),func+'');}var _baseRest=baseRest;/** Used as references for various `Number` constants. */var MAX_SAFE_INTEGER=9007199254740991;/**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}var isLength_1=isLength;/**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */function isArrayLike(value){return value!=null&&isLength_1(value.length)&&!isFunction_1(value);}var isArrayLike_1=isArrayLike;/**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */function isObjectLike(value){return value!=null&&typeof value=='object';}var isObjectLike_1=isObjectLike;/**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */function isArrayLikeObject(value){return isObjectLike_1(value)&&isArrayLike_1(value);}var isArrayLikeObject_1=isArrayLikeObject;/**
   * Creates an array excluding all given values using
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons.
   *
   * **Note:** Unlike `_.pull`, this method returns a new array.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Array
   * @param {Array} array The array to inspect.
   * @param {...*} [values] The values to exclude.
   * @returns {Array} Returns the new array of filtered values.
   * @see _.difference, _.xor
   * @example
   *
   * _.without([2, 1, 2, 3], 1, 2);
   * // => [3]
   */var without=_baseRest(function(array,values){return isArrayLikeObject_1(array)?_baseDifference(array,values):[];});var without_1=without;var dragOperation_1=createCommonjsModule$2(function(module,exports){var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});var initialState={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:false,isSourcePublic:null};function dragOperation(state,action){if(state===void 0){state=initialState;}var payload=action.payload;switch(action.type){case dragDrop.BEGIN_DRAG:return __assign({},state,{itemType:payload.itemType,item:payload.item,sourceId:payload.sourceId,isSourcePublic:payload.isSourcePublic,dropResult:null,didDrop:false});case dragDrop.PUBLISH_DRAG_SOURCE:return __assign({},state,{isSourcePublic:true});case dragDrop.HOVER:return __assign({},state,{targetIds:payload.targetIds});case registry.REMOVE_TARGET:if(state.targetIds.indexOf(payload.targetId)===-1){return state;}return __assign({},state,{targetIds:without_1(state.targetIds,payload.targetId)});case dragDrop.DROP:return __assign({},state,{dropResult:payload.dropResult,didDrop:true,targetIds:[]});case dragDrop.END_DRAG:return __assign({},state,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:false,isSourcePublic:null,targetIds:[]});default:return state;}}exports.default=dragOperation;});unwrapExports$2(dragOperation_1);var refCount_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function refCount(state,action){if(state===void 0){state=0;}switch(action.type){case registry.ADD_SOURCE:case registry.ADD_TARGET:return state+1;case registry.REMOVE_SOURCE:case registry.REMOVE_TARGET:return state-1;default:return state;}}exports.default=refCount;});unwrapExports$2(refCount_1);/* Built-in method references for those with the same name as other `lodash` methods. */var nativeMin=Math.min;/**
   * The base implementation of methods like `_.intersection`, without support
   * for iteratee shorthands, that accepts an array of arrays to inspect.
   *
   * @private
   * @param {Array} arrays The arrays to inspect.
   * @param {Function} [iteratee] The iteratee invoked per element.
   * @param {Function} [comparator] The comparator invoked per element.
   * @returns {Array} Returns the new array of shared values.
   */function baseIntersection(arrays,iteratee,comparator){var includes=comparator?_arrayIncludesWith:_arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=_arrayMap(array,_baseUnary(iteratee));}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new _SetCache(othIndex&&array):undefined;}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?_cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?_cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer;}}if(seen){seen.push(computed);}result.push(value);}}return result;}var _baseIntersection=baseIntersection;/**
   * Casts `value` to an empty array if it's not an array like object.
   *
   * @private
   * @param {*} value The value to inspect.
   * @returns {Array|Object} Returns the cast array-like object.
   */function castArrayLikeObject(value){return isArrayLikeObject_1(value)?value:[];}var _castArrayLikeObject=castArrayLikeObject;/**
   * Creates an array of unique values that are included in all given arrays
   * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons. The order and references of result values are
   * determined by the first array.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Array
   * @param {...Array} [arrays] The arrays to inspect.
   * @returns {Array} Returns the new array of intersecting values.
   * @example
   *
   * _.intersection([2, 1], [2, 3]);
   * // => [2]
   */var intersection=_baseRest(function(arrays){var mapped=_arrayMap(arrays,_castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?_baseIntersection(mapped):[];});var intersection_1=intersection;var dirtiness=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.NONE=[];exports.ALL=[];/**
   * Determines if the given handler IDs are dirty or not.
   *
   * @param dirtyIds The set of dirty handler ids
   * @param handlerIds The set of handler ids to check
   */function areDirty(dirtyIds,handlerIds){if(dirtyIds===exports.NONE){return false;}if(dirtyIds===exports.ALL||typeof handlerIds==='undefined'){return true;}return intersection_1(handlerIds,dirtyIds).length>0;}exports.areDirty=areDirty;});unwrapExports$2(dirtiness);var dirtiness_1=dirtiness.NONE;var dirtiness_2=dirtiness.ALL;var dirtiness_3=dirtiness.areDirty;/**
   * A specialized version of `_.filter` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {Array} Returns the new filtered array.
   */function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value;}}return result;}var _arrayFilter=arrayFilter;/**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}return array;}var _arrayPush=arrayPush;/** `Object#toString` result references. */var argsTag='[object Arguments]';/**
   * The base implementation of `_.isArguments`.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   */function baseIsArguments(value){return isObjectLike_1(value)&&_baseGetTag(value)==argsTag;}var _baseIsArguments=baseIsArguments;/** Used for built-in method references. */var objectProto$5=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$5=objectProto$5.hasOwnProperty;/** Built-in value references. */var propertyIsEnumerable=objectProto$5.propertyIsEnumerable;/**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */var isArguments=_baseIsArguments(function(){return arguments;}())?_baseIsArguments:function(value){return isObjectLike_1(value)&&hasOwnProperty$5.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee');};var isArguments_1=isArguments;/**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */var isArray=Array.isArray;var isArray_1=isArray;/** Built-in value references. */var spreadableSymbol=_Symbol?_Symbol.isConcatSpreadable:undefined;/**
   * Checks if `value` is a flattenable `arguments` object or array.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.
   */function isFlattenable(value){return isArray_1(value)||isArguments_1(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol]);}var _isFlattenable=isFlattenable;/**
   * The base implementation of `_.flatten` with support for restricting flattening.
   *
   * @private
   * @param {Array} array The array to flatten.
   * @param {number} depth The maximum recursion depth.
   * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.
   * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.
   * @param {Array} [result=[]] The initial result value.
   * @returns {Array} Returns the new flattened array.
   */function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=_isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){// Recursively flatten arrays (susceptible to call stack limits).
  baseFlatten(value,depth-1,predicate,isStrict,result);}else{_arrayPush(result,value);}}else if(!isStrict){result[result.length]=value;}}return result;}var _baseFlatten=baseFlatten;/* Built-in method references that are verified to be native. */var Set$1=_getNative(_root,'Set');var _Set=Set$1;/**
   * This method returns `undefined`.
   *
   * @static
   * @memberOf _
   * @since 2.3.0
   * @category Util
   * @example
   *
   * _.times(2, _.noop);
   * // => [undefined, undefined]
   */function noop$1(){// No operation performed.
  }var noop_1=noop$1;/**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value;});return result;}var _setToArray=setToArray;/** Used as references for various `Number` constants. */var INFINITY=1/0;/**
   * Creates a set object of `values`.
   *
   * @private
   * @param {Array} values The values to add to the set.
   * @returns {Object} Returns the new set.
   */var createSet=!(_Set&&1/_setToArray(new _Set([,-0]))[1]==INFINITY)?noop_1:function(values){return new _Set(values);};var _createSet=createSet;/** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE$1=200;/**
   * The base implementation of `_.uniqBy` without support for iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {Function} [iteratee] The iteratee invoked per element.
   * @param {Function} [comparator] The comparator invoked per element.
   * @returns {Array} Returns the new duplicate free array.
   */function baseUniq(array,iteratee,comparator){var index=-1,includes=_arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=_arrayIncludesWith;}else if(length>=LARGE_ARRAY_SIZE$1){var set=iteratee?null:_createSet(array);if(set){return _setToArray(set);}isCommon=false;includes=_cacheHas;seen=new _SetCache();}else{seen=iteratee?[]:result;}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer;}}if(iteratee){seen.push(computed);}result.push(value);}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed);}result.push(value);}}return result;}var _baseUniq=baseUniq;/**
   * The base implementation of methods like `_.xor`, without support for
   * iteratee shorthands, that accepts an array of arrays to inspect.
   *
   * @private
   * @param {Array} arrays The arrays to inspect.
   * @param {Function} [iteratee] The iteratee invoked per element.
   * @param {Function} [comparator] The comparator invoked per element.
   * @returns {Array} Returns the new array of values.
   */function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2){return length?_baseUniq(arrays[0]):[];}var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length){if(othIndex!=index){result[index]=_baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator);}}}return _baseUniq(_baseFlatten(result,1),iteratee,comparator);}var _baseXor=baseXor;/**
   * Creates an array of unique values that is the
   * [symmetric difference](https://en.wikipedia.org/wiki/Symmetric_difference)
   * of the given arrays. The order of result values is determined by the order
   * they occur in the arrays.
   *
   * @static
   * @memberOf _
   * @since 2.4.0
   * @category Array
   * @param {...Array} [arrays] The arrays to inspect.
   * @returns {Array} Returns the new array of filtered values.
   * @see _.difference, _.without
   * @example
   *
   * _.xor([2, 1], [2, 3]);
   * // => [1, 3]
   */var xor=_baseRest(function(arrays){return _baseXor(_arrayFilter(arrays,isArrayLikeObject_1));});var xor_1=xor;var dirtyHandlerIds_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function dirtyHandlerIds(state,action){if(state===void 0){state=dirtiness.NONE;}switch(action.type){case dragDrop.HOVER:break;case registry.ADD_SOURCE:case registry.ADD_TARGET:case registry.REMOVE_TARGET:case registry.REMOVE_SOURCE:return dirtiness.NONE;case dragDrop.BEGIN_DRAG:case dragDrop.PUBLISH_DRAG_SOURCE:case dragDrop.END_DRAG:case dragDrop.DROP:default:return dirtiness.ALL;}var _a=action.payload,_b=_a.targetIds,targetIds=_b===void 0?[]:_b,_c=_a.prevTargetIds,prevTargetIds=_c===void 0?[]:_c;var result=xor_1(targetIds,prevTargetIds);var didChange=result.length>0||!equality.areArraysEqual(targetIds,prevTargetIds);if(!didChange){return dirtiness.NONE;}// Check the target ids at the innermost position. If they are valid, add them
  // to the result
  var prevInnermostTargetId=prevTargetIds[prevTargetIds.length-1];var innermostTargetId=targetIds[targetIds.length-1];if(prevInnermostTargetId!==innermostTargetId){if(prevInnermostTargetId){result.push(prevInnermostTargetId);}if(innermostTargetId){result.push(innermostTargetId);}}return result;}exports.default=dirtyHandlerIds;});unwrapExports$2(dirtyHandlerIds_1);var stateId_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function stateId(state){if(state===void 0){state=0;}return state+1;}exports.default=stateId;});unwrapExports$2(stateId_1);/** `Object#toString` result references. */var symbolTag='[object Symbol]';/**
   * Checks if `value` is classified as a `Symbol` primitive or object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
   * @example
   *
   * _.isSymbol(Symbol.iterator);
   * // => true
   *
   * _.isSymbol('abc');
   * // => false
   */function isSymbol(value){return typeof value=='symbol'||isObjectLike_1(value)&&_baseGetTag(value)==symbolTag;}var isSymbol_1=isSymbol;/** Used to match property names within property paths. */var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;/**
   * Checks if `value` is a property name and not a property path.
   *
   * @private
   * @param {*} value The value to check.
   * @param {Object} [object] The object to query keys on.
   * @returns {boolean} Returns `true` if `value` is a property name, else `false`.
   */function isKey(value,object){if(isArray_1(value)){return false;}var type=typeof value;if(type=='number'||type=='symbol'||type=='boolean'||value==null||isSymbol_1(value)){return true;}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object);}var _isKey=isKey;/** Error message constants. */var FUNC_ERROR_TEXT='Expected a function';/**
   * Creates a function that memoizes the result of `func`. If `resolver` is
   * provided, it determines the cache key for storing the result based on the
   * arguments provided to the memoized function. By default, the first argument
   * provided to the memoized function is used as the map cache key. The `func`
   * is invoked with the `this` binding of the memoized function.
   *
   * **Note:** The cache is exposed as the `cache` property on the memoized
   * function. Its creation may be customized by replacing the `_.memoize.Cache`
   * constructor with one whose instances implement the
   * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)
   * method interface of `clear`, `delete`, `get`, `has`, and `set`.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Function
   * @param {Function} func The function to have its output memoized.
   * @param {Function} [resolver] The function to resolve the cache key.
   * @returns {Function} Returns the new memoized function.
   * @example
   *
   * var object = { 'a': 1, 'b': 2 };
   * var other = { 'c': 3, 'd': 4 };
   *
   * var values = _.memoize(_.values);
   * values(object);
   * // => [1, 2]
   *
   * values(other);
   * // => [3, 4]
   *
   * object.a = 2;
   * values(object);
   * // => [1, 2]
   *
   * // Modify the result cache.
   * values.cache.set(object, ['a', 'b']);
   * values(object);
   * // => ['a', 'b']
   *
   * // Replace `_.memoize.Cache`.
   * _.memoize.Cache = WeakMap;
   */function memoize(func,resolver){if(typeof func!='function'||resolver!=null&&typeof resolver!='function'){throw new TypeError(FUNC_ERROR_TEXT);}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key);}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result;};memoized.cache=new(memoize.Cache||_MapCache)();return memoized;}// Expose `MapCache`.
  memoize.Cache=_MapCache;var memoize_1=memoize;/** Used as the maximum memoize cache size. */var MAX_MEMOIZE_SIZE=500;/**
   * A specialized version of `_.memoize` which clears the memoized function's
   * cache when it exceeds `MAX_MEMOIZE_SIZE`.
   *
   * @private
   * @param {Function} func The function to have its output memoized.
   * @returns {Function} Returns the new memoized function.
   */function memoizeCapped(func){var result=memoize_1(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear();}return key;});var cache=result.cache;return result;}var _memoizeCapped=memoizeCapped;/** Used to match property names within property paths. */var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;/** Used to match backslashes in property paths. */var reEscapeChar=/\\(\\)?/g;/**
   * Converts `string` to a property path array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the property path array.
   */var stringToPath=_memoizeCapped(function(string){var result=[];if(string.charCodeAt(0)===46/* . */){result.push('');}string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,'$1'):number||match);});return result;});var _stringToPath=stringToPath;/** Used as references for various `Number` constants. */var INFINITY$1=1/0;/** Used to convert symbols to primitives and strings. */var symbolProto=_Symbol?_Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;/**
   * The base implementation of `_.toString` which doesn't convert nullish
   * values to empty strings.
   *
   * @private
   * @param {*} value The value to process.
   * @returns {string} Returns the string.
   */function baseToString(value){// Exit early for strings to avoid a performance hit in some environments.
  if(typeof value=='string'){return value;}if(isArray_1(value)){// Recursively convert values (susceptible to call stack limits).
  return _arrayMap(value,baseToString)+'';}if(isSymbol_1(value)){return symbolToString?symbolToString.call(value):'';}var result=value+'';return result=='0'&&1/value==-INFINITY$1?'-0':result;}var _baseToString=baseToString;/**
   * Converts `value` to a string. An empty string is returned for `null`
   * and `undefined` values. The sign of `-0` is preserved.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to convert.
   * @returns {string} Returns the converted string.
   * @example
   *
   * _.toString(null);
   * // => ''
   *
   * _.toString(-0);
   * // => '-0'
   *
   * _.toString([1, 2, 3]);
   * // => '1,2,3'
   */function toString(value){return value==null?'':_baseToString(value);}var toString_1=toString;/**
   * Casts `value` to a path array if it's not one.
   *
   * @private
   * @param {*} value The value to inspect.
   * @param {Object} [object] The object to query keys on.
   * @returns {Array} Returns the cast property path array.
   */function castPath(value,object){if(isArray_1(value)){return value;}return _isKey(value,object)?[value]:_stringToPath(toString_1(value));}var _castPath=castPath;/** Used as references for various `Number` constants. */var INFINITY$2=1/0;/**
   * Converts `value` to a string key if it's not a string or symbol.
   *
   * @private
   * @param {*} value The value to inspect.
   * @returns {string|symbol} Returns the key.
   */function toKey(value){if(typeof value=='string'||isSymbol_1(value)){return value;}var result=value+'';return result=='0'&&1/value==-INFINITY$2?'-0':result;}var _toKey=toKey;/**
   * The base implementation of `_.get` without support for default values.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Array|string} path The path of the property to get.
   * @returns {*} Returns the resolved value.
   */function baseGet(object,path){path=_castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[_toKey(path[index++])];}return index&&index==length?object:undefined;}var _baseGet=baseGet;/**
   * Gets the value at `path` of `object`. If the resolved value is
   * `undefined`, the `defaultValue` is returned in its place.
   *
   * @static
   * @memberOf _
   * @since 3.7.0
   * @category Object
   * @param {Object} object The object to query.
   * @param {Array|string} path The path of the property to get.
   * @param {*} [defaultValue] The value returned for `undefined` resolved values.
   * @returns {*} Returns the resolved value.
   * @example
   *
   * var object = { 'a': [{ 'b': { 'c': 3 } }] };
   *
   * _.get(object, 'a[0].b.c');
   * // => 3
   *
   * _.get(object, ['a', '0', 'b', 'c']);
   * // => 3
   *
   * _.get(object, 'a.b.c', 'default');
   * // => 'default'
   */function get(object,path,defaultValue){var result=object==null?undefined:_baseGet(object,path);return result===undefined?defaultValue:result;}var get_1=get;var reducers$1=createCommonjsModule$2(function(module,exports){var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});function reduce(state,action){if(state===void 0){state={};}return {dirtyHandlerIds:dirtyHandlerIds_1.default(state.dirtyHandlerIds,{type:action.type,payload:__assign({},action.payload,{prevTargetIds:get_1(state,'dragOperation.targetIds',[])})}),dragOffset:dragOffset_1.default(state.dragOffset,action),refCount:refCount_1.default(state.refCount,action),dragOperation:dragOperation_1.default(state.dragOperation,action),stateId:stateId_1.default(state.stateId)};}exports.default=reduce;});unwrapExports$2(reducers$1);var coords=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});/**
   * Coordinate addition
   * @param a The first coordinate
   * @param b The second coordinate
   */function add(a,b){return {x:a.x+b.x,y:a.y+b.y};}exports.add=add;/**
   * Coordinate subtraction
   * @param a The first coordinate
   * @param b The second coordinate
   */function subtract(a,b){return {x:a.x-b.x,y:a.y-b.y};}exports.subtract=subtract;/**
   * Returns the cartesian distance of the drag source component's position, based on its position
   * at the time when the current drag operation has started, and the movement difference.
   *
   * Returns null if no item is being dragged.
   *
   * @param state The offset state to compute from
   */function getSourceClientOffset(state){var clientOffset=state.clientOffset,initialClientOffset=state.initialClientOffset,initialSourceClientOffset=state.initialSourceClientOffset;if(!clientOffset||!initialClientOffset||!initialSourceClientOffset){return null;}return subtract(add(clientOffset,initialSourceClientOffset),initialClientOffset);}exports.getSourceClientOffset=getSourceClientOffset;/**
   * Determines the x,y offset between the client offset and the initial client offset
   *
   * @param state The offset state to compute from
   */function getDifferenceFromInitialOffset(state){var clientOffset=state.clientOffset,initialClientOffset=state.initialClientOffset;if(!clientOffset||!initialClientOffset){return null;}return subtract(clientOffset,initialClientOffset);}exports.getDifferenceFromInitialOffset=getDifferenceFromInitialOffset;});unwrapExports$2(coords);var coords_1=coords.add;var coords_2=coords.subtract;var coords_3=coords.getSourceClientOffset;var coords_4=coords.getDifferenceFromInitialOffset;var DragDropMonitorImpl_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var DragDropMonitorImpl=/** @class */function(){function DragDropMonitorImpl(store,registry){this.store=store;this.registry=registry;}DragDropMonitorImpl.prototype.subscribeToStateChange=function(listener,options){var _this=this;if(options===void 0){options={handlerIds:undefined};}var handlerIds=options.handlerIds;invariant_1$1(typeof listener==='function','listener must be a function.');invariant_1$1(typeof handlerIds==='undefined'||Array.isArray(handlerIds),'handlerIds, when specified, must be an array of strings.');var prevStateId=this.store.getState().stateId;var handleChange=function(){var state=_this.store.getState();var currentStateId=state.stateId;try{var canSkipListener=currentStateId===prevStateId||currentStateId===prevStateId+1&&!dirtiness.areDirty(state.dirtyHandlerIds,handlerIds);if(!canSkipListener){listener();}}finally{prevStateId=currentStateId;}};return this.store.subscribe(handleChange);};DragDropMonitorImpl.prototype.subscribeToOffsetChange=function(listener){var _this=this;invariant_1$1(typeof listener==='function','listener must be a function.');var previousState=this.store.getState().dragOffset;var handleChange=function(){var nextState=_this.store.getState().dragOffset;if(nextState===previousState){return;}previousState=nextState;listener();};return this.store.subscribe(handleChange);};DragDropMonitorImpl.prototype.canDragSource=function(sourceId){var source=this.registry.getSource(sourceId);invariant_1$1(source,'Expected to find a valid source.');if(this.isDragging()){return false;}return source.canDrag(this,sourceId);};DragDropMonitorImpl.prototype.canDropOnTarget=function(targetId){var target=this.registry.getTarget(targetId);invariant_1$1(target,'Expected to find a valid target.');if(!this.isDragging()||this.didDrop()){return false;}var targetType=this.registry.getTargetType(targetId);var draggedItemType=this.getItemType();return matchesType_1.default(targetType,draggedItemType)&&target.canDrop(this,targetId);};DragDropMonitorImpl.prototype.isDragging=function(){return Boolean(this.getItemType());};DragDropMonitorImpl.prototype.isDraggingSource=function(sourceId){var source=this.registry.getSource(sourceId,true);invariant_1$1(source,'Expected to find a valid source.');if(!this.isDragging()||!this.isSourcePublic()){return false;}var sourceType=this.registry.getSourceType(sourceId);var draggedItemType=this.getItemType();if(sourceType!==draggedItemType){return false;}return source.isDragging(this,sourceId);};DragDropMonitorImpl.prototype.isOverTarget=function(targetId,options){if(options===void 0){options={shallow:false};}var shallow=options.shallow;if(!this.isDragging()){return false;}var targetType=this.registry.getTargetType(targetId);var draggedItemType=this.getItemType();if(draggedItemType&&!matchesType_1.default(targetType,draggedItemType)){return false;}var targetIds=this.getTargetIds();if(!targetIds.length){return false;}var index=targetIds.indexOf(targetId);if(shallow){return index===targetIds.length-1;}else{return index>-1;}};DragDropMonitorImpl.prototype.getItemType=function(){return this.store.getState().dragOperation.itemType;};DragDropMonitorImpl.prototype.getItem=function(){return this.store.getState().dragOperation.item;};DragDropMonitorImpl.prototype.getSourceId=function(){return this.store.getState().dragOperation.sourceId;};DragDropMonitorImpl.prototype.getTargetIds=function(){return this.store.getState().dragOperation.targetIds;};DragDropMonitorImpl.prototype.getDropResult=function(){return this.store.getState().dragOperation.dropResult;};DragDropMonitorImpl.prototype.didDrop=function(){return this.store.getState().dragOperation.didDrop;};DragDropMonitorImpl.prototype.isSourcePublic=function(){return this.store.getState().dragOperation.isSourcePublic;};DragDropMonitorImpl.prototype.getInitialClientOffset=function(){return this.store.getState().dragOffset.initialClientOffset;};DragDropMonitorImpl.prototype.getInitialSourceClientOffset=function(){return this.store.getState().dragOffset.initialSourceClientOffset;};DragDropMonitorImpl.prototype.getClientOffset=function(){return this.store.getState().dragOffset.clientOffset;};DragDropMonitorImpl.prototype.getSourceClientOffset=function(){return coords.getSourceClientOffset(this.store.getState().dragOffset);};DragDropMonitorImpl.prototype.getDifferenceFromInitialOffset=function(){return coords.getDifferenceFromInitialOffset(this.store.getState().dragOffset);};return DragDropMonitorImpl;}();exports.default=DragDropMonitorImpl;});unwrapExports$2(DragDropMonitorImpl_1);var getNextUniqueId_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var nextUniqueId=0;function getNextUniqueId(){return nextUniqueId++;}exports.default=getNextUniqueId;});unwrapExports$2(getNextUniqueId_1);var contracts=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function validateSourceContract(source){invariant_1$1(typeof source.canDrag==='function','Expected canDrag to be a function.');invariant_1$1(typeof source.beginDrag==='function','Expected beginDrag to be a function.');invariant_1$1(typeof source.endDrag==='function','Expected endDrag to be a function.');}exports.validateSourceContract=validateSourceContract;function validateTargetContract(target){invariant_1$1(typeof target.canDrop==='function','Expected canDrop to be a function.');invariant_1$1(typeof target.hover==='function','Expected hover to be a function.');invariant_1$1(typeof target.drop==='function','Expected beginDrag to be a function.');}exports.validateTargetContract=validateTargetContract;function validateType(type,allowArray){if(allowArray&&Array.isArray(type)){type.forEach(function(t){return validateType(t,false);});return;}invariant_1$1(typeof type==='string'||typeof type==='symbol',allowArray?'Type can only be a string, a symbol, or an array of either.':'Type can only be a string or a symbol.');}exports.validateType=validateType;});unwrapExports$2(contracts);var contracts_1=contracts.validateSourceContract;var contracts_2=contracts.validateTargetContract;var contracts_3=contracts.validateType;var domain;// This constructor is used to store event handlers. Instantiating this is
  // faster than explicitly calling `Object.create(null)` to get a "clean" empty
  // object (tested with v8 v4.9).
  function EventHandlers(){}EventHandlers.prototype=Object.create(null);function EventEmitter(){EventEmitter.init.call(this);}// nodejs oddity
  // require('events') === require('events').EventEmitter
  EventEmitter.EventEmitter=EventEmitter;EventEmitter.usingDomains=false;EventEmitter.prototype.domain=undefined;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;// By default EventEmitters will print a warning if more than 10 listeners are
  // added to it. This is a useful default which helps finding memory leaks.
  EventEmitter.defaultMaxListeners=10;EventEmitter.init=function(){this.domain=null;if(EventEmitter.usingDomains){// if there is an active domain, then attach to it.
  if(domain.active&&!(this instanceof domain.Domain));}if(!this._events||this._events===Object.getPrototypeOf(this)._events){this._events=new EventHandlers();this._eventsCount=0;}this._maxListeners=this._maxListeners||undefined;};// Obviously not all Emitters should be limited to 10. This function allows
  // that to be increased. Set to zero for unlimited.
  EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=='number'||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this;};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners;}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this);};// These standalone emit* functions are used to optimize calling of event
  // handlers for fast cases because emit() itself often has a variable number of
  // arguments and can be deoptimized because of that. These functions always have
  // the same number of arguments and thus do not get deoptimized, so the code
  // inside them can execute faster.
  function emitNone(handler,isFn,self){if(isFn)handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self);}}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1);}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2);}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3);}}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].apply(self,args);}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events,domain;var doError=type==='error';events=this._events;if(events)doError=doError&&events.error==null;else if(!doError)return false;domain=this.domain;// If there is no 'error' event listener then throw.
  if(doError){er=arguments[1];if(domain){if(!er)er=new Error('Uncaught, unspecified "error" event');er.domainEmitter=this;er.domain=domain;er.domainThrown=false;domain.emit('error',er);}else if(er instanceof Error){throw er;// Unhandled 'error' event
  }else{// At least give some kind of context to the user
  var err=new Error('Uncaught, unspecified "error" event. ('+er+')');err.context=er;throw err;}return false;}handler=events[type];if(!handler)return false;var isFn=typeof handler==='function';len=arguments.length;switch(len){// fast cases
  case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;// slower
  default:args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args);}return true;};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=='function')throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=new EventHandlers();target._eventsCount=0;}else{// To avoid recursion in the case that type === "newListener"! Before
  // adding it to the listeners, first emit "newListener".
  if(events.newListener){target.emit('newListener',type,listener.listener?listener.listener:listener);// Re-assign `events` because a newListener handler could have caused the
  // this._events to be assigned to a new object
  events=target._events;}existing=events[type];}if(!existing){// Optimize the case of one listener. Don't need the extra array object.
  existing=events[type]=listener;++target._eventsCount;}else{if(typeof existing==='function'){// Adding the second element, need to change to array.
  existing=events[type]=prepend?[listener,existing]:[existing,listener];}else{// If we've already got an array, just append.
  if(prepend){existing.unshift(listener);}else{existing.push(listener);}}// Check for listener leak
  if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error('Possible EventEmitter memory leak detected. '+existing.length+' '+type+' listeners added. '+'Use emitter.setMaxListeners() to increase limit');w.name='MaxListenersExceededWarning';w.emitter=target;w.type=type;w.count=existing.length;emitWarning(w);}}}return target;}function emitWarning(e){typeof console.warn==='function'?console.warn(e):console.log(e);}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false);};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true);};function _onceWrap(target,type,listener){var fired=false;function g(){target.removeListener(type,g);if(!fired){fired=true;listener.apply(target,arguments);}}g.listener=listener;return g;}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=='function')throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this;};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=='function')throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this;};// emits a 'removeListener' event iff the listener was removed
  EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=='function')throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)return this;list=events[type];if(!list)return this;if(list===listener||list.listener&&list.listener===listener){if(--this._eventsCount===0)this._events=new EventHandlers();else{delete events[type];if(events.removeListener)this.emit('removeListener',type,list.listener||listener);}}else if(typeof list!=='function'){position=-1;for(i=list.length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){originalListener=list[i].listener;position=i;break;}}if(position<0)return this;if(list.length===1){list[0]=undefined;if(--this._eventsCount===0){this._events=new EventHandlers();return this;}else{delete events[type];}}else{spliceOne$1(list,position);}if(events.removeListener)this.emit('removeListener',type,originalListener||listener);}return this;};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events;events=this._events;if(!events)return this;// not listening for removeListener, no need to emit
  if(!events.removeListener){if(arguments.length===0){this._events=new EventHandlers();this._eventsCount=0;}else if(events[type]){if(--this._eventsCount===0)this._events=new EventHandlers();else delete events[type];}return this;}// emit removeListener for all listeners on all events
  if(arguments.length===0){var keys=Object.keys(events);for(var i=0,key;i<keys.length;++i){key=keys[i];if(key==='removeListener')continue;this.removeAllListeners(key);}this.removeAllListeners('removeListener');this._events=new EventHandlers();this._eventsCount=0;return this;}listeners=events[type];if(typeof listeners==='function'){this.removeListener(type,listeners);}else if(listeners){// LIFO order
  do{this.removeListener(type,listeners[listeners.length-1]);}while(listeners[0]);}return this;};EventEmitter.prototype.listeners=function listeners(type){var evlistener;var ret;var events=this._events;if(!events)ret=[];else{evlistener=events[type];if(!evlistener)ret=[];else if(typeof evlistener==='function')ret=[evlistener.listener||evlistener];else ret=unwrapListeners(evlistener);}return ret;};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==='function'){return emitter.listenerCount(type);}else{return listenerCount.call(emitter,type);}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==='function'){return 1;}else if(evlistener){return evlistener.length;}}return 0;}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[];};// About 1.5x faster than the two-arg version of Array#splice().
  function spliceOne$1(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop();}function arrayClone(arr,i){var copy=new Array(i);while(i--)copy[i]=arr[i];return copy;}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i];}return ret;}var inherits$1;if(typeof Object.create==='function'){inherits$1=function inherits(ctor,superCtor){// implementation from standard node.js 'util' module
  ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}});};}else{inherits$1=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor();ctor.prototype.constructor=ctor;};}var inherits$1$1=inherits$1;/*
  <!-- LICENSEFILE/ -->

  <h1>License</h1>

  Unless stated otherwise all works are:

  <ul><li>Copyright &copy; 2013+ <a href="http://bevry.me">Bevry Pty Ltd</a></li></ul>

  and licensed under:

  <ul><li><a href="http://spdx.org/licenses/MIT.html">MIT License</a></li></ul>

  <h2>MIT License</h2>

  <pre>
  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  </pre>

  <!-- /LICENSEFILE -->
  */inherits$1$1(Domain,EventEmitter);function createEmitError(d){return emitError;function emitError(e){d.emit('error',e);}}function Domain(){EventEmitter.call(this);this.__emitError=createEmitError(this);}Domain.prototype.add=function(emitter){emitter.on('error',this.__emitError);};Domain.prototype.remove=function(emitter){emitter.removeListener('error',this.__emitError);};Domain.prototype.bind=function(fn){var emitError=this.__emitError;return function(){var args=Array.prototype.slice.call(arguments);try{fn.apply(null,args);}catch(err){emitError(err);}};};Domain.prototype.intercept=function(fn){var emitError=this.__emitError;return function(err){if(err){emitError(err);}else{var args=Array.prototype.slice.call(arguments,1);try{fn.apply(null,args);}catch(err){emitError(err);}}};};Domain.prototype.run=function(fn){var emitError=this.__emitError;try{fn();}catch(err){emitError(err);}return this;};Domain.prototype.dispose=function(){this.removeAllListeners();return this;};Domain.prototype.enter=Domain.prototype.exit=function(){return this;};function createDomain(){return new Domain();}var create=createDomain;var require$$0={Domain:Domain,createDomain:createDomain,create:create};var domain$1;// The domain module is executed on demand
  var hasSetImmediate=typeof setImmediate==="function";// Use the fastest means possible to execute a task in its own turn, with
  // priority over other events including network IO events in Node.js.
  //
  // An exception thrown by a task will permanently interrupt the processing of
  // subsequent tasks. The higher level `asap` function ensures that if an
  // exception is thrown by a task, that the task queue will continue flushing as
  // soon as possible, but if you use `rawAsap` directly, you are responsible to
  // either ensure that no exceptions are thrown from your task, or to manually
  // call `rawAsap.requestFlush` if an exception is thrown.
  var raw=rawAsap;function rawAsap(task){if(!queue.length){requestFlush();flushing=true;}// Avoids a function call
  queue[queue.length]=task;}var queue=[];// Once a flush has been requested, no further calls to `requestFlush` are
  // necessary until the next `flush` completes.
  var flushing=false;// The position of the next task to execute in the task queue. This is
  // preserved between calls to `flush` so that it can be resumed if
  // a task throws an exception.
  var index$2=0;// If a task schedules additional tasks recursively, the task queue can grow
  // unbounded. To prevent memory excaustion, the task queue will periodically
  // truncate already-completed tasks.
  var capacity=1024;// The flush function processes all tasks that have been scheduled with
  // `rawAsap` unless and until one of those tasks throws an exception.
  // If a task throws an exception, `flush` ensures that its state will remain
  // consistent and will resume where it left off when called again.
  // However, `flush` does not make any arrangements to be called again if an
  // exception is thrown.
  function flush(){while(index$2<queue.length){var currentIndex=index$2;// Advance the index before calling the task. This ensures that we will
  // begin flushing on the next task the task throws an error.
  index$2=index$2+1;queue[currentIndex].call();// Prevent leaking memory for long chains of recursive calls to `asap`.
  // If we call `asap` within tasks scheduled by `asap`, the queue will
  // grow, but to avoid an O(n) walk for every task we execute, we don't
  // shift tasks off the queue after they have been executed.
  // Instead, we periodically shift 1024 tasks off the queue.
  if(index$2>capacity){// Manually shift all values starting at the index back to the
  // beginning of the queue.
  for(var scan=0,newLength=queue.length-index$2;scan<newLength;scan++){queue[scan]=queue[scan+index$2];}queue.length-=index$2;index$2=0;}}queue.length=0;index$2=0;flushing=false;}rawAsap.requestFlush=requestFlush;function requestFlush(){// Ensure flushing is not bound to any domain.
  // It is not sufficient to exit the domain, because domains exist on a stack.
  // To execute code outside of any domain, the following dance is necessary.
  var parentDomain=process.domain;if(parentDomain){if(!domain$1){// Lazy execute the domain module.
  // Only employed if the user elects to use domains.
  domain$1=require$$0;}domain$1.active=process.domain=null;}// `setImmediate` is slower that `process.nextTick`, but `process.nextTick`
  // cannot handle recursion.
  // `requestFlush` will only be called recursively from `asap.js`, to resume
  // flushing after an error is thrown into a domain.
  // Conveniently, `setImmediate` was introduced in the same version
  // `process.nextTick` started throwing recursion errors.
  if(flushing&&hasSetImmediate){setImmediate(flush);}else{process.nextTick(flush);}if(parentDomain){domain$1.active=process.domain=parentDomain;}}var freeTasks=[];/**
   * Calls a task as soon as possible after returning, in its own event, with
   * priority over IO events. An exception thrown in a task can be handled by
   * `process.on("uncaughtException") or `domain.on("error")`, but will otherwise
   * crash the process. If the error is handled, all subsequent tasks will
   * resume.
   *
   * @param {{call}} task A callable object, typically a function that takes no
   * arguments.
   */var asap_1=asap;function asap(task){var rawTask;if(freeTasks.length){rawTask=freeTasks.pop();}else{rawTask=new RawTask();}rawTask.task=task;rawTask.domain=process.domain;raw(rawTask);}function RawTask(){this.task=null;this.domain=null;}RawTask.prototype.call=function(){if(this.domain){this.domain.enter();}var threw=true;try{this.task.call();threw=false;// If the task throws an exception (presumably) Node.js restores the
  // domain stack for the next event.
  if(this.domain){this.domain.exit();}}finally{// We use try/finally and a threw flag to avoid messing up stack traces
  // when we catch and release errors.
  if(threw){// In Node.js, uncaught exceptions are considered fatal errors.
  // Re-throw them to interrupt flushing!
  // Ensure that flushing continues if an uncaught exception is
  // suppressed listening process.on("uncaughtException") or
  // domain.on("error").
  raw.requestFlush();}// If the task threw an error, we do not want to exit the domain here.
  // Exiting the domain would prevent the domain from catching the error.
  this.task=null;this.domain=null;freeTasks.push(this);}};var HandlerRegistryImpl_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function getNextHandlerId(role){var id=getNextUniqueId_1.default().toString();switch(role){case interfaces.HandlerRole.SOURCE:return "S"+id;case interfaces.HandlerRole.TARGET:return "T"+id;default:throw new Error("Unknown Handler Role: "+role);}}function parseRoleFromHandlerId(handlerId){switch(handlerId[0]){case'S':return interfaces.HandlerRole.SOURCE;case'T':return interfaces.HandlerRole.TARGET;default:invariant_1$1(false,"Cannot parse handler ID: "+handlerId);}}function mapContainsValue(map,searchValue){var entries=map.entries();var isDone=false;do{var _a=entries.next(),done=_a.done,_b=_a.value,value=_b[1];if(value===searchValue){return true;}isDone=done;}while(!isDone);return false;}var HandlerRegistryImpl=/** @class */function(){function HandlerRegistryImpl(store){this.store=store;this.types=new Map();this.dragSources=new Map();this.dropTargets=new Map();this.pinnedSourceId=null;this.pinnedSource=null;}HandlerRegistryImpl.prototype.addSource=function(type,source){contracts.validateType(type);contracts.validateSourceContract(source);var sourceId=this.addHandler(interfaces.HandlerRole.SOURCE,type,source);this.store.dispatch(registry.addSource(sourceId));return sourceId;};HandlerRegistryImpl.prototype.addTarget=function(type,target){contracts.validateType(type,true);contracts.validateTargetContract(target);var targetId=this.addHandler(interfaces.HandlerRole.TARGET,type,target);this.store.dispatch(registry.addTarget(targetId));return targetId;};HandlerRegistryImpl.prototype.containsHandler=function(handler){return mapContainsValue(this.dragSources,handler)||mapContainsValue(this.dropTargets,handler);};HandlerRegistryImpl.prototype.getSource=function(sourceId,includePinned){if(includePinned===void 0){includePinned=false;}invariant_1$1(this.isSourceId(sourceId),'Expected a valid source ID.');var isPinned=includePinned&&sourceId===this.pinnedSourceId;var source=isPinned?this.pinnedSource:this.dragSources.get(sourceId);return source;};HandlerRegistryImpl.prototype.getTarget=function(targetId){invariant_1$1(this.isTargetId(targetId),'Expected a valid target ID.');return this.dropTargets.get(targetId);};HandlerRegistryImpl.prototype.getSourceType=function(sourceId){invariant_1$1(this.isSourceId(sourceId),'Expected a valid source ID.');return this.types.get(sourceId);};HandlerRegistryImpl.prototype.getTargetType=function(targetId){invariant_1$1(this.isTargetId(targetId),'Expected a valid target ID.');return this.types.get(targetId);};HandlerRegistryImpl.prototype.isSourceId=function(handlerId){var role=parseRoleFromHandlerId(handlerId);return role===interfaces.HandlerRole.SOURCE;};HandlerRegistryImpl.prototype.isTargetId=function(handlerId){var role=parseRoleFromHandlerId(handlerId);return role===interfaces.HandlerRole.TARGET;};HandlerRegistryImpl.prototype.removeSource=function(sourceId){var _this=this;invariant_1$1(this.getSource(sourceId),'Expected an existing source.');this.store.dispatch(registry.removeSource(sourceId));asap_1(function(){_this.dragSources.delete(sourceId);_this.types.delete(sourceId);});};HandlerRegistryImpl.prototype.removeTarget=function(targetId){invariant_1$1(this.getTarget(targetId),'Expected an existing target.');this.store.dispatch(registry.removeTarget(targetId));this.dropTargets.delete(targetId);this.types.delete(targetId);};HandlerRegistryImpl.prototype.pinSource=function(sourceId){var source=this.getSource(sourceId);invariant_1$1(source,'Expected an existing source.');this.pinnedSourceId=sourceId;this.pinnedSource=source;};HandlerRegistryImpl.prototype.unpinSource=function(){invariant_1$1(this.pinnedSource,'No source is pinned at the time.');this.pinnedSourceId=null;this.pinnedSource=null;};HandlerRegistryImpl.prototype.addHandler=function(role,type,handler){var id=getNextHandlerId(role);this.types.set(id,type);if(role===interfaces.HandlerRole.SOURCE){this.dragSources.set(id,handler);}else if(role===interfaces.HandlerRole.TARGET){this.dropTargets.set(id,handler);}return id;};return HandlerRegistryImpl;}();exports.default=HandlerRegistryImpl;});unwrapExports$2(HandlerRegistryImpl_1);var DragDropManagerImpl_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function makeStoreInstance(debugMode){// TODO: if we ever make a react-native version of this,
  // we'll need to consider how to pull off dev-tooling
  var reduxDevTools=typeof window!=='undefined'&&window.__REDUX_DEVTOOLS_EXTENSION__;return redux$1.createStore(reducers$1.default,debugMode&&reduxDevTools&&reduxDevTools({name:'dnd-core',instanceId:'dnd-core'}));}var DragDropManagerImpl=/** @class */function(){function DragDropManagerImpl(createBackend,context,debugMode){if(context===void 0){context={};}if(debugMode===void 0){debugMode=false;}var _this=this;this.context=context;this.isSetUp=false;this.handleRefCountChange=function(){var shouldSetUp=_this.store.getState().refCount>0;if(shouldSetUp&&!_this.isSetUp){_this.backend.setup();_this.isSetUp=true;}else if(!shouldSetUp&&_this.isSetUp){_this.backend.teardown();_this.isSetUp=false;}};var store=makeStoreInstance(debugMode);this.store=store;this.monitor=new DragDropMonitorImpl_1.default(store,new HandlerRegistryImpl_1.default(store));this.backend=createBackend(this);store.subscribe(this.handleRefCountChange);}DragDropManagerImpl.prototype.getContext=function(){return this.context;};DragDropManagerImpl.prototype.getMonitor=function(){return this.monitor;};DragDropManagerImpl.prototype.getBackend=function(){return this.backend;};DragDropManagerImpl.prototype.getRegistry=function(){return this.monitor.registry;};DragDropManagerImpl.prototype.getActions=function(){var manager=this;var dispatch=this.store.dispatch;function bindActionCreator(actionCreator){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i];}var action=actionCreator.apply(manager,args);if(typeof action!=='undefined'){dispatch(action);}};}var actions=dragDrop.default(this);return Object.keys(actions).reduce(function(boundActions,key){var action=actions[key];boundActions[key]=bindActionCreator(action);return boundActions;},{});};DragDropManagerImpl.prototype.dispatch=function(action){this.store.dispatch(action);};return DragDropManagerImpl;}();exports.default=DragDropManagerImpl;});unwrapExports$2(DragDropManagerImpl_1);var factories=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function createDragDropManager(backend,context,debugMode){return new DragDropManagerImpl_1.default(backend,context,debugMode);}exports.createDragDropManager=createDragDropManager;});unwrapExports$2(factories);var factories_1=factories.createDragDropManager;var lib=createCommonjsModule$2(function(module,exports){function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p];}Object.defineProperty(exports,"__esModule",{value:true});__export(interfaces);__export(factories);});unwrapExports$2(lib);var checkDecoratorArguments_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function checkDecoratorArguments(functionName,signature){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i];}if(process.env.NODE_ENV!=='production'){for(var _a=0,args_1=args;_a<args_1.length;_a++){var arg=args_1[_a];if(arg&&arg.prototype&&arg.prototype.render){// tslint:disable-next-line no-console
  console.error('You seem to be applying the arguments in the wrong order. '+("It should be "+functionName+"("+signature+")(Component), not the other way around. ")+'Read more: http://react-dnd.github.io/react-dnd/docs-troubleshooting.html#you-seem-to-be-applying-the-arguments-in-the-wrong-order');return;}}}}exports.default=checkDecoratorArguments;});unwrapExports$2(checkDecoratorArguments_1);var reactIs_production_min$2=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var b="function"===typeof Symbol&&Symbol.for,c=b?Symbol.for("react.element"):60103,d=b?Symbol.for("react.portal"):60106,e=b?Symbol.for("react.fragment"):60107,f=b?Symbol.for("react.strict_mode"):60108,g=b?Symbol.for("react.profiler"):60114,h=b?Symbol.for("react.provider"):60109,k=b?Symbol.for("react.context"):60110,l=b?Symbol.for("react.async_mode"):60111,m=b?Symbol.for("react.concurrent_mode"):60111,n=b?Symbol.for("react.forward_ref"):60112,p=b?Symbol.for("react.suspense"):60113,q=b?Symbol.for("react.memo"):60115,r=b?Symbol.for("react.lazy"):60116;function t(a){if("object"===typeof a&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type,a){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof,a){case k:case n:case h:return a;default:return u;}}case r:case q:case d:return u;}}}function v(a){return t(a)===m;}exports.typeOf=t;exports.AsyncMode=l;exports.ConcurrentMode=m;exports.ContextConsumer=k;exports.ContextProvider=h;exports.Element=c;exports.ForwardRef=n;exports.Fragment=e;exports.Lazy=r;exports.Memo=q;exports.Portal=d;exports.Profiler=g;exports.StrictMode=f;exports.Suspense=p;exports.isValidElementType=function(a){return "string"===typeof a||"function"===typeof a||a===e||a===m||a===g||a===f||a===p||"object"===typeof a&&null!==a&&(a.$$typeof===r||a.$$typeof===q||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n);};exports.isAsyncMode=function(a){return v(a)||t(a)===l;};exports.isConcurrentMode=v;exports.isContextConsumer=function(a){return t(a)===k;};exports.isContextProvider=function(a){return t(a)===h;};exports.isElement=function(a){return "object"===typeof a&&null!==a&&a.$$typeof===c;};exports.isForwardRef=function(a){return t(a)===n;};exports.isFragment=function(a){return t(a)===e;};exports.isLazy=function(a){return t(a)===r;};exports.isMemo=function(a){return t(a)===q;};exports.isPortal=function(a){return t(a)===d;};exports.isProfiler=function(a){return t(a)===g;};exports.isStrictMode=function(a){return t(a)===f;};exports.isSuspense=function(a){return t(a)===p;};});unwrapExports$2(reactIs_production_min$2);var reactIs_production_min_1$1=reactIs_production_min$2.typeOf;var reactIs_production_min_2$1=reactIs_production_min$2.AsyncMode;var reactIs_production_min_3$1=reactIs_production_min$2.ConcurrentMode;var reactIs_production_min_4$1=reactIs_production_min$2.ContextConsumer;var reactIs_production_min_5$1=reactIs_production_min$2.ContextProvider;var reactIs_production_min_6$1=reactIs_production_min$2.Element;var reactIs_production_min_7$1=reactIs_production_min$2.ForwardRef;var reactIs_production_min_8$1=reactIs_production_min$2.Fragment;var reactIs_production_min_9$1=reactIs_production_min$2.Lazy;var reactIs_production_min_10$1=reactIs_production_min$2.Memo;var reactIs_production_min_11$1=reactIs_production_min$2.Portal;var reactIs_production_min_12$1=reactIs_production_min$2.Profiler;var reactIs_production_min_13$1=reactIs_production_min$2.StrictMode;var reactIs_production_min_14$1=reactIs_production_min$2.Suspense;var reactIs_production_min_15$1=reactIs_production_min$2.isValidElementType;var reactIs_production_min_16$1=reactIs_production_min$2.isAsyncMode;var reactIs_production_min_17$1=reactIs_production_min$2.isConcurrentMode;var reactIs_production_min_18$1=reactIs_production_min$2.isContextConsumer;var reactIs_production_min_19$1=reactIs_production_min$2.isContextProvider;var reactIs_production_min_20$1=reactIs_production_min$2.isElement;var reactIs_production_min_21$1=reactIs_production_min$2.isForwardRef;var reactIs_production_min_22$1=reactIs_production_min$2.isFragment;var reactIs_production_min_23$1=reactIs_production_min$2.isLazy;var reactIs_production_min_24$1=reactIs_production_min$2.isMemo;var reactIs_production_min_25$1=reactIs_production_min$2.isPortal;var reactIs_production_min_26$1=reactIs_production_min$2.isProfiler;var reactIs_production_min_27$1=reactIs_production_min$2.isStrictMode;var reactIs_production_min_28$1=reactIs_production_min$2.isSuspense;var reactIs_development$2=createCommonjsModule$2(function(module,exports){if(process.env.NODE_ENV!=="production"){(function(){Object.defineProperty(exports,'__esModule',{value:true});// The Symbol used to tag the ReactElement-like types. If there is no native Symbol
  // nor polyfill, then a plain number is used for performance.
  var hasSymbol=typeof Symbol==='function'&&Symbol.for;var REACT_ELEMENT_TYPE=hasSymbol?Symbol.for('react.element'):0xeac7;var REACT_PORTAL_TYPE=hasSymbol?Symbol.for('react.portal'):0xeaca;var REACT_FRAGMENT_TYPE=hasSymbol?Symbol.for('react.fragment'):0xeacb;var REACT_STRICT_MODE_TYPE=hasSymbol?Symbol.for('react.strict_mode'):0xeacc;var REACT_PROFILER_TYPE=hasSymbol?Symbol.for('react.profiler'):0xead2;var REACT_PROVIDER_TYPE=hasSymbol?Symbol.for('react.provider'):0xeacd;var REACT_CONTEXT_TYPE=hasSymbol?Symbol.for('react.context'):0xeace;var REACT_ASYNC_MODE_TYPE=hasSymbol?Symbol.for('react.async_mode'):0xeacf;var REACT_CONCURRENT_MODE_TYPE=hasSymbol?Symbol.for('react.concurrent_mode'):0xeacf;var REACT_FORWARD_REF_TYPE=hasSymbol?Symbol.for('react.forward_ref'):0xead0;var REACT_SUSPENSE_TYPE=hasSymbol?Symbol.for('react.suspense'):0xead1;var REACT_MEMO_TYPE=hasSymbol?Symbol.for('react.memo'):0xead3;var REACT_LAZY_TYPE=hasSymbol?Symbol.for('react.lazy'):0xead4;function isValidElementType(type){return typeof type==='string'||typeof type==='function'||// Note: its typeof might be other than 'symbol' or 'number' if it's a polyfill.
  type===REACT_FRAGMENT_TYPE||type===REACT_CONCURRENT_MODE_TYPE||type===REACT_PROFILER_TYPE||type===REACT_STRICT_MODE_TYPE||type===REACT_SUSPENSE_TYPE||typeof type==='object'&&type!==null&&(type.$$typeof===REACT_LAZY_TYPE||type.$$typeof===REACT_MEMO_TYPE||type.$$typeof===REACT_PROVIDER_TYPE||type.$$typeof===REACT_CONTEXT_TYPE||type.$$typeof===REACT_FORWARD_REF_TYPE);}/**
   * Forked from fbjs/warning:
   * https://github.com/facebook/fbjs/blob/e66ba20ad5be433eb54423f2b097d829324d9de6/packages/fbjs/src/__forks__/warning.js
   *
   * Only change is we use console.warn instead of console.error,
   * and do nothing when 'console' is not supported.
   * This really simplifies the code.
   * ---
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */var lowPriorityWarning=function(){};{var printWarning=function(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}var argIndex=0;var message='Warning: '+format.replace(/%s/g,function(){return args[argIndex++];});if(typeof console!=='undefined'){console.warn(message);}try{// --- Welcome to debugging React ---
  // This error was thrown as a convenience so that you can use this stack
  // to find the callsite that caused this warning to fire.
  throw new Error(message);}catch(x){}};lowPriorityWarning=function(condition,format){if(format===undefined){throw new Error('`lowPriorityWarning(condition, format, ...args)` requires a warning '+'message argument');}if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2];}printWarning.apply(undefined,[format].concat(args));}};}var lowPriorityWarning$1=lowPriorityWarning;function typeOf(object){if(typeof object==='object'&&object!==null){var $$typeof=object.$$typeof;switch($$typeof){case REACT_ELEMENT_TYPE:var type=object.type;switch(type){case REACT_ASYNC_MODE_TYPE:case REACT_CONCURRENT_MODE_TYPE:case REACT_FRAGMENT_TYPE:case REACT_PROFILER_TYPE:case REACT_STRICT_MODE_TYPE:case REACT_SUSPENSE_TYPE:return type;default:var $$typeofType=type&&type.$$typeof;switch($$typeofType){case REACT_CONTEXT_TYPE:case REACT_FORWARD_REF_TYPE:case REACT_PROVIDER_TYPE:return $$typeofType;default:return $$typeof;}}case REACT_LAZY_TYPE:case REACT_MEMO_TYPE:case REACT_PORTAL_TYPE:return $$typeof;}}return undefined;}// AsyncMode is deprecated along with isAsyncMode
  var AsyncMode=REACT_ASYNC_MODE_TYPE;var ConcurrentMode=REACT_CONCURRENT_MODE_TYPE;var ContextConsumer=REACT_CONTEXT_TYPE;var ContextProvider=REACT_PROVIDER_TYPE;var Element=REACT_ELEMENT_TYPE;var ForwardRef=REACT_FORWARD_REF_TYPE;var Fragment=REACT_FRAGMENT_TYPE;var Lazy=REACT_LAZY_TYPE;var Memo=REACT_MEMO_TYPE;var Portal=REACT_PORTAL_TYPE;var Profiler=REACT_PROFILER_TYPE;var StrictMode=REACT_STRICT_MODE_TYPE;var Suspense=REACT_SUSPENSE_TYPE;var hasWarnedAboutDeprecatedIsAsyncMode=false;// AsyncMode should be deprecated
  function isAsyncMode(object){{if(!hasWarnedAboutDeprecatedIsAsyncMode){hasWarnedAboutDeprecatedIsAsyncMode=true;lowPriorityWarning$1(false,'The ReactIs.isAsyncMode() alias has been deprecated, '+'and will be removed in React 17+. Update your code to use '+'ReactIs.isConcurrentMode() instead. It has the exact same API.');}}return isConcurrentMode(object)||typeOf(object)===REACT_ASYNC_MODE_TYPE;}function isConcurrentMode(object){return typeOf(object)===REACT_CONCURRENT_MODE_TYPE;}function isContextConsumer(object){return typeOf(object)===REACT_CONTEXT_TYPE;}function isContextProvider(object){return typeOf(object)===REACT_PROVIDER_TYPE;}function isElement(object){return typeof object==='object'&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE;}function isForwardRef(object){return typeOf(object)===REACT_FORWARD_REF_TYPE;}function isFragment(object){return typeOf(object)===REACT_FRAGMENT_TYPE;}function isLazy(object){return typeOf(object)===REACT_LAZY_TYPE;}function isMemo(object){return typeOf(object)===REACT_MEMO_TYPE;}function isPortal(object){return typeOf(object)===REACT_PORTAL_TYPE;}function isProfiler(object){return typeOf(object)===REACT_PROFILER_TYPE;}function isStrictMode(object){return typeOf(object)===REACT_STRICT_MODE_TYPE;}function isSuspense(object){return typeOf(object)===REACT_SUSPENSE_TYPE;}exports.typeOf=typeOf;exports.AsyncMode=AsyncMode;exports.ConcurrentMode=ConcurrentMode;exports.ContextConsumer=ContextConsumer;exports.ContextProvider=ContextProvider;exports.Element=Element;exports.ForwardRef=ForwardRef;exports.Fragment=Fragment;exports.Lazy=Lazy;exports.Memo=Memo;exports.Portal=Portal;exports.Profiler=Profiler;exports.StrictMode=StrictMode;exports.Suspense=Suspense;exports.isValidElementType=isValidElementType;exports.isAsyncMode=isAsyncMode;exports.isConcurrentMode=isConcurrentMode;exports.isContextConsumer=isContextConsumer;exports.isContextProvider=isContextProvider;exports.isElement=isElement;exports.isForwardRef=isForwardRef;exports.isFragment=isFragment;exports.isLazy=isLazy;exports.isMemo=isMemo;exports.isPortal=isPortal;exports.isProfiler=isProfiler;exports.isStrictMode=isStrictMode;exports.isSuspense=isSuspense;})();}});unwrapExports$2(reactIs_development$2);var reactIs_development_1$1=reactIs_development$2.typeOf;var reactIs_development_2$1=reactIs_development$2.AsyncMode;var reactIs_development_3$1=reactIs_development$2.ConcurrentMode;var reactIs_development_4$1=reactIs_development$2.ContextConsumer;var reactIs_development_5$1=reactIs_development$2.ContextProvider;var reactIs_development_6$1=reactIs_development$2.Element;var reactIs_development_7$1=reactIs_development$2.ForwardRef;var reactIs_development_8$1=reactIs_development$2.Fragment;var reactIs_development_9$1=reactIs_development$2.Lazy;var reactIs_development_10$1=reactIs_development$2.Memo;var reactIs_development_11$1=reactIs_development$2.Portal;var reactIs_development_12$1=reactIs_development$2.Profiler;var reactIs_development_13$1=reactIs_development$2.StrictMode;var reactIs_development_14$1=reactIs_development$2.Suspense;var reactIs_development_15$1=reactIs_development$2.isValidElementType;var reactIs_development_16$1=reactIs_development$2.isAsyncMode;var reactIs_development_17$1=reactIs_development$2.isConcurrentMode;var reactIs_development_18$1=reactIs_development$2.isContextConsumer;var reactIs_development_19$1=reactIs_development$2.isContextProvider;var reactIs_development_20$1=reactIs_development$2.isElement;var reactIs_development_21$1=reactIs_development$2.isForwardRef;var reactIs_development_22$1=reactIs_development$2.isFragment;var reactIs_development_23$1=reactIs_development$2.isLazy;var reactIs_development_24$1=reactIs_development$2.isMemo;var reactIs_development_25$1=reactIs_development$2.isPortal;var reactIs_development_26$1=reactIs_development$2.isProfiler;var reactIs_development_27$1=reactIs_development$2.isStrictMode;var reactIs_development_28$1=reactIs_development$2.isSuspense;var reactIs$1=createCommonjsModule$2(function(module){if(process.env.NODE_ENV==='production'){module.exports=reactIs_production_min$2;}else{module.exports=reactIs_development$2;}});/**
   * Copyright 2015, Yahoo! Inc.
   * Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
   */var REACT_STATICS$2={childContextTypes:true,contextType:true,contextTypes:true,defaultProps:true,displayName:true,getDefaultProps:true,getDerivedStateFromError:true,getDerivedStateFromProps:true,mixins:true,propTypes:true,type:true};var KNOWN_STATICS$2={name:true,length:true,prototype:true,caller:true,callee:true,arguments:true,arity:true};var FORWARD_REF_STATICS$1={'$$typeof':true,render:true,defaultProps:true,displayName:true,propTypes:true};var TYPE_STATICS$1={};TYPE_STATICS$1[reactIs$1.ForwardRef]=FORWARD_REF_STATICS$1;var defineProperty$1$1=Object.defineProperty;var getOwnPropertyNames$2=Object.getOwnPropertyNames;var getOwnPropertySymbols$1$1=Object.getOwnPropertySymbols;var getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor;var getPrototypeOf$3=Object.getPrototypeOf;var objectPrototype$2=Object.prototype;function hoistNonReactStatics$2(targetComponent,sourceComponent,blacklist){if(typeof sourceComponent!=='string'){// don't hoist over string (html) components
  if(objectPrototype$2){var inheritedComponent=getPrototypeOf$3(sourceComponent);if(inheritedComponent&&inheritedComponent!==objectPrototype$2){hoistNonReactStatics$2(targetComponent,inheritedComponent,blacklist);}}var keys=getOwnPropertyNames$2(sourceComponent);if(getOwnPropertySymbols$1$1){keys=keys.concat(getOwnPropertySymbols$1$1(sourceComponent));}var targetStatics=TYPE_STATICS$1[targetComponent['$$typeof']]||REACT_STATICS$2;var sourceStatics=TYPE_STATICS$1[sourceComponent['$$typeof']]||REACT_STATICS$2;for(var i=0;i<keys.length;++i){var key=keys[i];if(!KNOWN_STATICS$2[key]&&!(blacklist&&blacklist[key])&&!(sourceStatics&&sourceStatics[key])&&!(targetStatics&&targetStatics[key])){var descriptor=getOwnPropertyDescriptor$2(sourceComponent,key);try{// Avoid failures from read-only properties
  defineProperty$1$1(targetComponent,key,descriptor);}catch(e){}}}return targetComponent;}return targetComponent;}var hoistNonReactStatics_cjs$2=hoistNonReactStatics$2;var isClassComponent_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=void 0;var isClassComponent=function isClassComponent(Component$$1){return Boolean(Component$$1&&Component$$1.prototype&&typeof Component$$1.prototype.render==='function');};var _default=isClassComponent;exports.default=_default;});unwrapExports$2(isClassComponent_1);var DragDropContext_1=createCommonjsModule$2(function(module,exports){var __extends=commonjsGlobal$2&&commonjsGlobal$2.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});var _a;var isClassComponent=isClassComponent_1.default;/**
   * Create the React Context
   */exports.Consumer=(_a=React__default.createContext({dragDropManager:undefined}),_a.Consumer),exports.Provider=_a.Provider;/**
   * Creates the context object we're providing
   * @param backend
   * @param context
   */function createChildContext(backend,context,debugMode){return {dragDropManager:lib.createDragDropManager(backend,context,debugMode)};}exports.createChildContext=createChildContext;/**
   * A React component that provides the React-DnD context
   */exports.DragDropContextProvider=function(_a){var backend=_a.backend,context=_a.context,debugMode=_a.debugMode,children=_a.children;var contextValue=createChildContext(backend,context,debugMode);return React__default.createElement(exports.Provider,{value:contextValue},children);};/**
   * Wrap the root component of your application with DragDropContext decorator to set up React DnD.
   * This lets you specify the backend, and sets up the shared DnD state behind the scenes.
   * @param backendFactory The DnD backend factory
   * @param backendContext The backend context
   */function DragDropContext(backendFactory,backendContext,debugMode){checkDecoratorArguments_1.default('DragDropContext','backend',backendFactory);var childContext=createChildContext(backendFactory,backendContext,debugMode);return function decorateContext(DecoratedComponent){var Decorated=DecoratedComponent;var displayName=Decorated.displayName||Decorated.name||'Component';var DragDropContextContainer=/** @class */function(_super){__extends(DragDropContextContainer,_super);function DragDropContextContainer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.ref=React__default.createRef();_this.getManager=function(){return childContext.dragDropManager;};return _this;}DragDropContextContainer.prototype.getDecoratedComponentInstance=function(){invariant_1$1(this.ref.current,'In order to access an instance of the decorated component it can not be a stateless component.');return this.ref.current;};DragDropContextContainer.prototype.render=function(){return React__default.createElement(exports.Provider,{value:childContext},React__default.createElement(Decorated,__assign({},this.props,{ref:isClassComponent(Decorated)?this.ref:undefined})));};DragDropContextContainer.DecoratedComponent=DecoratedComponent;DragDropContextContainer.displayName="DragDropContext("+displayName+")";return DragDropContextContainer;}(React__default.Component);return hoistNonReactStatics_cjs$2(DragDropContextContainer,DecoratedComponent);};}exports.DragDropContext=DragDropContext;});unwrapExports$2(DragDropContext_1);var DragDropContext_2=DragDropContext_1.Consumer;var DragDropContext_3=DragDropContext_1.Provider;var DragDropContext_4=DragDropContext_1.createChildContext;var DragDropContext_5=DragDropContext_1.DragDropContextProvider;var DragDropContext_6=DragDropContext_1.DragDropContext;/**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */function overArg(func,transform){return function(arg){return func(transform(arg));};}var _overArg=overArg;/** Built-in value references. */var getPrototype=_overArg(Object.getPrototypeOf,Object);var _getPrototype=getPrototype;/** `Object#toString` result references. */var objectTag='[object Object]';/** Used for built-in method references. */var funcProto$2=Function.prototype,objectProto$6=Object.prototype;/** Used to resolve the decompiled source of functions. */var funcToString$2=funcProto$2.toString;/** Used to check objects for own properties. */var hasOwnProperty$6=objectProto$6.hasOwnProperty;/** Used to infer the `Object` constructor. */var objectCtorString=funcToString$2.call(Object);/**
   * Checks if `value` is a plain object, that is, an object created by the
   * `Object` constructor or one with a `[[Prototype]]` of `null`.
   *
   * @static
   * @memberOf _
   * @since 0.8.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   * }
   *
   * _.isPlainObject(new Foo);
   * // => false
   *
   * _.isPlainObject([1, 2, 3]);
   * // => false
   *
   * _.isPlainObject({ 'x': 0, 'y': 0 });
   * // => true
   *
   * _.isPlainObject(Object.create(null));
   * // => true
   */function isPlainObject$1$1(value){if(!isObjectLike_1(value)||_baseGetTag(value)!=objectTag){return false;}var proto=_getPrototype(value);if(proto===null){return true;}var Ctor=hasOwnProperty$6.call(proto,'constructor')&&proto.constructor;return typeof Ctor=='function'&&Ctor instanceof Ctor&&funcToString$2.call(Ctor)==objectCtorString;}var isPlainObject_1=isPlainObject$1$1;//
  var shallowequal=function shallowEqual(objA,objB,compare,compareContext){var ret=compare?compare.call(compareContext,objA,objB):void 0;if(ret!==void 0){return !!ret;}if(objA===objB){return true;}if(typeof objA!=="object"||!objA||typeof objB!=="object"||!objB){return false;}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false;}var bHasOwnProperty=Object.prototype.hasOwnProperty.bind(objB);// Test for A's keys different from B.
  for(var idx=0;idx<keysA.length;idx++){var key=keysA[idx];if(!bHasOwnProperty(key)){return false;}var valueA=objA[key];var valueB=objB[key];ret=compare?compare.call(compareContext,valueA,valueB,key):void 0;if(ret===false||ret===void 0&&valueA!==valueB){return false;}}return true;};var DragLayer_1=createCommonjsModule$2(function(module,exports){var __extends=commonjsGlobal$2&&commonjsGlobal$2.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});var isClassComponent=isClassComponent_1.default;function DragLayer(collect,options){if(options===void 0){options={};}checkDecoratorArguments_1.default('DragLayer','collect[, options]',collect,options);invariant_1$1(typeof collect==='function','Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ','Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-layer.html',collect);invariant_1$1(isPlainObject_1(options),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. '+'Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs-drag-layer.html',options);return function decorateLayer(DecoratedComponent){var Decorated=DecoratedComponent;var _a=options.arePropsEqual,arePropsEqual=_a===void 0?shallowequal:_a;var displayName=Decorated.displayName||Decorated.name||'Component';var DragLayerContainer=/** @class */function(_super){__extends(DragLayerContainer,_super);function DragLayerContainer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isCurrentlyMounted=false;_this.ref=React__default.createRef();_this.handleChange=function(){if(!_this.isCurrentlyMounted){return;}var nextState=_this.getCurrentState();if(!shallowequal(nextState,_this.state)){_this.setState(nextState);}};return _this;}DragLayerContainer.prototype.getDecoratedComponentInstance=function(){invariant_1$1(this.ref.current,'In order to access an instance of the decorated component it can not be a stateless component.');return this.ref.current;};DragLayerContainer.prototype.shouldComponentUpdate=function(nextProps,nextState){return !arePropsEqual(nextProps,this.props)||!shallowequal(nextState,this.state);};DragLayerContainer.prototype.componentDidMount=function(){this.isCurrentlyMounted=true;this.handleChange();};DragLayerContainer.prototype.componentWillUnmount=function(){this.isCurrentlyMounted=false;if(this.unsubscribeFromOffsetChange){this.unsubscribeFromOffsetChange();this.unsubscribeFromOffsetChange=undefined;}if(this.unsubscribeFromStateChange){this.unsubscribeFromStateChange();this.unsubscribeFromStateChange=undefined;}};DragLayerContainer.prototype.render=function(){var _this=this;return React__default.createElement(DragDropContext_1.Consumer,null,function(_a){var dragDropManager=_a.dragDropManager;if(dragDropManager===undefined){return null;}_this.receiveDragDropManager(dragDropManager);// Let componentDidMount fire to initialize the collected state
  if(!_this.isCurrentlyMounted){return null;}return React__default.createElement(Decorated,__assign({},_this.props,_this.state,{ref:isClassComponent(Decorated)?_this.ref:undefined}));});};DragLayerContainer.prototype.receiveDragDropManager=function(dragDropManager){if(this.manager!==undefined){return;}this.manager=dragDropManager;invariant_1$1(typeof dragDropManager==='object','Could not find the drag and drop manager in the context of %s. '+'Make sure to wrap the top-level component of your app with DragDropContext. '+'Read more: http://react-dnd.github.io/react-dnd/docs-troubleshooting.html#could-not-find-the-drag-and-drop-manager-in-the-context',displayName,displayName);var monitor=this.manager.getMonitor();this.unsubscribeFromOffsetChange=monitor.subscribeToOffsetChange(this.handleChange);this.unsubscribeFromStateChange=monitor.subscribeToStateChange(this.handleChange);};DragLayerContainer.prototype.getCurrentState=function(){if(!this.manager){return {};}var monitor=this.manager.getMonitor();return collect(monitor,this.props);};DragLayerContainer.displayName="DragLayer("+displayName+")";DragLayerContainer.DecoratedComponent=DecoratedComponent;return DragLayerContainer;}(React__default.Component);return hoistNonReactStatics_cjs$2(DragLayerContainer,DecoratedComponent);};}exports.default=DragLayer;});unwrapExports$2(DragLayer_1);var Disposable_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});/**
   * Provides a set of static methods for creating Disposables.
   * @param {Function} action Action to run during the first call to dispose.
   * The action is guaranteed to be run at most once.
   */var Disposable=/** @class */function(){function Disposable(action){this.isDisposed=false;this.action=isFunction_1(action)?action:noop_1;}/**
       * Validates whether the given object is a disposable
       * @param {Object} Object to test whether it has a dispose method
       * @returns {Boolean} true if a disposable object, else false.
       */Disposable.isDisposable=function(d){return d&&isFunction_1(d.dispose);};Disposable._fixup=function(result){return Disposable.isDisposable(result)?result:Disposable.empty;};/**
       * Creates a disposable object that invokes the specified action when disposed.
       * @param {Function} dispose Action to run during the first call to dispose.
       * The action is guaranteed to be run at most once.
       * @return {Disposable} The disposable object that runs the given action upon disposal.
       */Disposable.create=function(action){return new Disposable(action);};/** Performs the task of cleaning up resources. */Disposable.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true;}};/**
       * Gets the disposable that does nothing when disposed.
       */Disposable.empty={dispose:noop_1};return Disposable;}();exports.Disposable=Disposable;});unwrapExports$2(Disposable_1);var Disposable_2=Disposable_1.Disposable;var SerialDisposable_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});/**
   * Represents a disposable resource whose underlying disposable resource can
   * be replaced by another disposable resource, causing automatic disposal of
   * the previous underlying disposable resource.
   */var SerialDisposable=/** @class */function(){function SerialDisposable(){this.isDisposed=false;}/**
       * Gets the underlying disposable.
       * @returns {Any} the underlying disposable.
       */SerialDisposable.prototype.getDisposable=function(){return this.current;};SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed;if(!shouldDispose){var old=this.current;this.current=value;if(old){old.dispose();}}if(shouldDispose&&value){value.dispose();}};/** Performs the task of cleaning up resources. */SerialDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=undefined;if(old){old.dispose();}}};return SerialDisposable;}();exports.SerialDisposable=SerialDisposable;});unwrapExports$2(SerialDisposable_1);var SerialDisposable_2=SerialDisposable_1.SerialDisposable;var CompositeDisposable_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});/**
   * Represents a group of disposable resources that are disposed together.
   * @constructor
   */var CompositeDisposable=/** @class */function(){function CompositeDisposable(){var disposables=[];for(var _i=0;_i<arguments.length;_i++){disposables[_i]=arguments[_i];}this.isDisposed=false;this.disposables=disposables;}/**
       * Adds a disposable to the CompositeDisposable or disposes the disposable if the CompositeDisposable is disposed.
       * @param {Any} item Disposable to add.
       */CompositeDisposable.prototype.add=function(item){if(this.isDisposed){item.dispose();}else{this.disposables.push(item);}};/**
       * Removes and disposes the first occurrence of a disposable from the CompositeDisposable.
       * @param {Any} item Disposable to remove.
       * @returns {Boolean} true if found; false otherwise.
       */CompositeDisposable.prototype.remove=function(item){var shouldDispose=false;if(!this.isDisposed){var idx=this.disposables.indexOf(item);if(idx!==-1){shouldDispose=true;this.disposables.splice(idx,1);item.dispose();}}return shouldDispose;};/**
       *  Disposes all disposables in the group and removes them from the group but
       *  does not dispose the CompositeDisposable.
       */CompositeDisposable.prototype.clear=function(){if(!this.isDisposed){var len=this.disposables.length;var currentDisposables=new Array(len);for(var i=0;i<len;i++){currentDisposables[i]=this.disposables[i];}this.disposables=[];for(var i=0;i<len;i++){currentDisposables[i].dispose();}}};/**
       *  Disposes all disposables in the group and removes them from the group.
       */CompositeDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var len=this.disposables.length;var currentDisposables=new Array(len);for(var i=0;i<len;i++){currentDisposables[i]=this.disposables[i];}this.disposables=[];for(var i=0;i<len;i++){currentDisposables[i].dispose();}}};return CompositeDisposable;}();exports.CompositeDisposable=CompositeDisposable;});unwrapExports$2(CompositeDisposable_1);var CompositeDisposable_2=CompositeDisposable_1.CompositeDisposable;var disposables=createCommonjsModule$2(function(module,exports){function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p];}Object.defineProperty(exports,"__esModule",{value:true});__export(Disposable_1);__export(SerialDisposable_1);__export(CompositeDisposable_1);});unwrapExports$2(disposables);var decorateHandler_1=createCommonjsModule$2(function(module,exports){var __extends=commonjsGlobal$2&&commonjsGlobal$2.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return extendStatics(d,b);};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=commonjsGlobal$2&&commonjsGlobal$2.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};Object.defineProperty(exports,"__esModule",{value:true});var isClassComponent=isClassComponent_1.default;function decorateHandler(_a){var DecoratedComponent=_a.DecoratedComponent,createHandler=_a.createHandler,createMonitor=_a.createMonitor,createConnector=_a.createConnector,registerHandler=_a.registerHandler,containerDisplayName=_a.containerDisplayName,getType=_a.getType,collect=_a.collect,options=_a.options;var _b=options.arePropsEqual,arePropsEqual=_b===void 0?shallowequal:_b;var Decorated=DecoratedComponent;var displayName=DecoratedComponent.displayName||DecoratedComponent.name||'Component';var DragDropContainer=/** @class */function(_super){__extends(DragDropContainer,_super);function DragDropContainer(props){var _this=_super.call(this,props)||this;_this.isCurrentlyMounted=false;_this.handleChange=function(){if(!_this.isCurrentlyMounted){return;}var nextState=_this.getCurrentState();if(!shallowequal(nextState,_this.state)){_this.setState(nextState);}};_this.disposable=new disposables.SerialDisposable();_this.receiveProps(props);_this.dispose();return _this;}DragDropContainer.prototype.getHandlerId=function(){return this.handlerId;};DragDropContainer.prototype.getDecoratedComponentInstance=function(){if(!this.handler){return null;}return this.handler.ref.current;};DragDropContainer.prototype.shouldComponentUpdate=function(nextProps,nextState){return !arePropsEqual(nextProps,this.props)||!shallowequal(nextState,this.state);};DragDropContainer.prototype.componentDidMount=function(){this.isCurrentlyMounted=true;this.disposable=new disposables.SerialDisposable();this.currentType=undefined;this.receiveProps(this.props);this.handleChange();};DragDropContainer.prototype.componentDidUpdate=function(prevProps){if(!arePropsEqual(this.props,prevProps)){this.receiveProps(this.props);this.handleChange();}};DragDropContainer.prototype.componentWillUnmount=function(){this.dispose();this.isCurrentlyMounted=false;};DragDropContainer.prototype.receiveProps=function(props){if(!this.handler){return;}this.handler.receiveProps(props);this.receiveType(getType(props));};DragDropContainer.prototype.receiveType=function(type){if(!this.handlerMonitor||!this.manager||!this.handlerConnector){return;}if(type===this.currentType){return;}this.currentType=type;var _a=registerHandler(type,this.handler,this.manager),handlerId=_a.handlerId,unregister=_a.unregister;this.handlerId=handlerId;this.handlerMonitor.receiveHandlerId(handlerId);this.handlerConnector.receiveHandlerId(handlerId);var globalMonitor=this.manager.getMonitor();var unsubscribe=globalMonitor.subscribeToStateChange(this.handleChange,{handlerIds:[handlerId]});this.disposable.setDisposable(new disposables.CompositeDisposable(new disposables.Disposable(unsubscribe),new disposables.Disposable(unregister)));};DragDropContainer.prototype.dispose=function(){this.disposable.dispose();if(this.handlerConnector){this.handlerConnector.receiveHandlerId(null);}};DragDropContainer.prototype.getCurrentState=function(){if(!this.handlerConnector){return {};}var nextState=collect(this.handlerConnector.hooks,this.handlerMonitor);if(process.env.NODE_ENV!=='production'){invariant_1$1(isPlainObject_1(nextState),'Expected `collect` specified as the second argument to '+'%s for %s to return a plain object of props to inject. '+'Instead, received %s.',containerDisplayName,displayName,nextState);}return nextState;};DragDropContainer.prototype.render=function(){var _this=this;return React__default.createElement(DragDropContext_1.Consumer,null,function(_a){var dragDropManager=_a.dragDropManager;if(dragDropManager===undefined){return null;}_this.receiveDragDropManager(dragDropManager);// Let componentDidMount fire to initialize the collected state
  if(!_this.isCurrentlyMounted){return null;}return React__default.createElement(Decorated,__assign({},_this.props,_this.state,{ref:_this.handler&&isClassComponent(Decorated)?_this.handler.ref:undefined}));});};DragDropContainer.prototype.receiveDragDropManager=function(dragDropManager){if(this.manager!==undefined){return;}this.manager=dragDropManager;invariant_1$1(typeof dragDropManager==='object','Could not find the drag and drop manager in the context of %s. '+'Make sure to wrap the top-level component of your app with DragDropContext. '+'Read more: http://react-dnd.github.io/react-dnd/docs-troubleshooting.html#could-not-find-the-drag-and-drop-manager-in-the-context',displayName,displayName);this.handlerMonitor=createMonitor(dragDropManager);this.handlerConnector=createConnector(dragDropManager.getBackend());this.handler=createHandler(this.handlerMonitor);};DragDropContainer.DecoratedComponent=DecoratedComponent;DragDropContainer.displayName=containerDisplayName+"("+displayName+")";return DragDropContainer;}(React__default.Component);return hoistNonReactStatics_cjs$2(DragDropContainer,DecoratedComponent);}exports.default=decorateHandler;});unwrapExports$2(decorateHandler_1);var registerSource_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function registerSource(type,source,manager){var registry=manager.getRegistry();var sourceId=registry.addSource(type,source);function unregisterSource(){registry.removeSource(sourceId);}return {handlerId:sourceId,unregister:unregisterSource};}exports.default=registerSource;});unwrapExports$2(registerSource_1);var createSourceFactory_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var ALLOWED_SPEC_METHODS=['canDrag','beginDrag','isDragging','endDrag'];var REQUIRED_SPEC_METHODS=['beginDrag'];function createSourceFactory(spec){Object.keys(spec).forEach(function(key){invariant_1$1(ALLOWED_SPEC_METHODS.indexOf(key)>-1,'Expected the drag source specification to only have '+'some of the following keys: %s. '+'Instead received a specification with an unexpected "%s" key. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',ALLOWED_SPEC_METHODS.join(', '),key);invariant_1$1(typeof spec[key]==='function','Expected %s in the drag source specification to be a function. '+'Instead received a specification with %s: %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',key,key,spec[key]);});REQUIRED_SPEC_METHODS.forEach(function(key){invariant_1$1(typeof spec[key]==='function','Expected %s in the drag source specification to be a function. '+'Instead received a specification with %s: %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',key,key,spec[key]);});var SourceImpl=/** @class */function(){function SourceImpl(monitor){var _this=this;this.monitor=monitor;this.props=null;this.ref=React__default.createRef();this.beginDrag=function(){if(!_this.props){return;}var item=spec.beginDrag(_this.props,_this.monitor,_this.ref.current);if(process.env.NODE_ENV!=='production'){invariant_1$1(isPlainObject_1(item),'beginDrag() must return a plain object that represents the dragged item. '+'Instead received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',item);}return item;};}SourceImpl.prototype.receiveProps=function(props){this.props=props;};SourceImpl.prototype.canDrag=function(){if(!this.props){return false;}if(!spec.canDrag){return true;}return spec.canDrag(this.props,this.monitor);};SourceImpl.prototype.isDragging=function(globalMonitor,sourceId){if(!this.props){return false;}if(!spec.isDragging){return sourceId===globalMonitor.getSourceId();}return spec.isDragging(this.props,this.monitor);};SourceImpl.prototype.endDrag=function(){if(!this.props){return;}if(!spec.endDrag){return;}spec.endDrag(this.props,this.monitor,this.ref.current);};return SourceImpl;}();return function createSource(monitor){return new SourceImpl(monitor);};}exports.default=createSourceFactory;});unwrapExports$2(createSourceFactory_1);var createSourceMonitor_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var isCallingCanDrag=false;var isCallingIsDragging=false;var SourceMonitor=/** @class */function(){function SourceMonitor(manager){this.internalMonitor=manager.getMonitor();}SourceMonitor.prototype.receiveHandlerId=function(sourceId){this.sourceId=sourceId;};SourceMonitor.prototype.canDrag=function(){invariant_1$1(!isCallingCanDrag,'You may not call monitor.canDrag() inside your canDrag() implementation. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source-monitor.html');try{isCallingCanDrag=true;return this.internalMonitor.canDragSource(this.sourceId);}finally{isCallingCanDrag=false;}};SourceMonitor.prototype.isDragging=function(){invariant_1$1(!isCallingIsDragging,'You may not call monitor.isDragging() inside your isDragging() implementation. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source-monitor.html');try{isCallingIsDragging=true;return this.internalMonitor.isDraggingSource(this.sourceId);}finally{isCallingIsDragging=false;}};SourceMonitor.prototype.subscribeToStateChange=function(listener,options){return this.internalMonitor.subscribeToStateChange(listener,options);};SourceMonitor.prototype.isDraggingSource=function(sourceId){return this.internalMonitor.isDraggingSource(sourceId);};SourceMonitor.prototype.isOverTarget=function(targetId,options){return this.internalMonitor.isOverTarget(targetId,options);};SourceMonitor.prototype.getTargetIds=function(){return this.internalMonitor.getTargetIds();};SourceMonitor.prototype.isSourcePublic=function(){return this.internalMonitor.isSourcePublic();};SourceMonitor.prototype.getSourceId=function(){return this.internalMonitor.getSourceId();};SourceMonitor.prototype.subscribeToOffsetChange=function(listener){return this.internalMonitor.subscribeToOffsetChange(listener);};SourceMonitor.prototype.canDragSource=function(sourceId){return this.internalMonitor.canDragSource(sourceId);};SourceMonitor.prototype.canDropOnTarget=function(targetId){return this.internalMonitor.canDropOnTarget(targetId);};SourceMonitor.prototype.getItemType=function(){return this.internalMonitor.getItemType();};SourceMonitor.prototype.getItem=function(){return this.internalMonitor.getItem();};SourceMonitor.prototype.getDropResult=function(){return this.internalMonitor.getDropResult();};SourceMonitor.prototype.didDrop=function(){return this.internalMonitor.didDrop();};SourceMonitor.prototype.getInitialClientOffset=function(){return this.internalMonitor.getInitialClientOffset();};SourceMonitor.prototype.getInitialSourceClientOffset=function(){return this.internalMonitor.getInitialSourceClientOffset();};SourceMonitor.prototype.getSourceClientOffset=function(){return this.internalMonitor.getSourceClientOffset();};SourceMonitor.prototype.getClientOffset=function(){return this.internalMonitor.getClientOffset();};SourceMonitor.prototype.getDifferenceFromInitialOffset=function(){return this.internalMonitor.getDifferenceFromInitialOffset();};return SourceMonitor;}();function createSourceMonitor(manager){return new SourceMonitor(manager);}exports.default=createSourceMonitor;});unwrapExports$2(createSourceMonitor_1);var cloneWithRef_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function cloneWithRef(element,newRef){var previousRef=element.ref;invariant_1$1(typeof previousRef!=='string','Cannot connect React DnD to an element with an existing string ref. '+'Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. '+'Read more: https://facebook.github.io/react/docs/more-about-refs.html#the-ref-callback-attribute');if(!previousRef){// When there is no ref on the element, use the new ref directly
  return React__default.cloneElement(element,{ref:newRef});}return React__default.cloneElement(element,{ref:function(node){newRef(node);if(previousRef){previousRef(node);}}});}exports.default=cloneWithRef;});unwrapExports$2(cloneWithRef_1);var wrapConnectorHooks_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function throwIfCompositeComponentElement(element){// Custom components can no longer be wrapped directly in React DnD 2.0
  // so that we don't need to depend on findDOMNode() from react-dom.
  if(typeof element.type==='string'){return;}var displayName=element.type.displayName||element.type.name||'the component';throw new Error('Only native element nodes can now be passed to React DnD connectors.'+("You can either wrap "+displayName+" into a <div>, or turn it into a ")+'drag source or a drop target itself.');}function wrapHookToRecognizeElement(hook){return function(elementOrNode,options){if(elementOrNode===void 0){elementOrNode=null;}if(options===void 0){options=null;}// When passed a node, call the hook straight away.
  if(!React__default.isValidElement(elementOrNode)){var node=elementOrNode;hook(node,options);return undefined;}// If passed a ReactElement, clone it and attach this function as a ref.
  // This helps us achieve a neat API where user doesn't even know that refs
  // are being used under the hood.
  var element=elementOrNode;throwIfCompositeComponentElement(element);// When no options are passed, use the hook directly
  var ref=options?function(node){return hook(node,options);}:hook;return cloneWithRef_1.default(element,ref);};}function wrapConnectorHooks(hooks){var wrappedHooks={};Object.keys(hooks).forEach(function(key){var hook=hooks[key];var wrappedHook=wrapHookToRecognizeElement(hook);wrappedHooks[key]=function(){return wrappedHook;};});return wrappedHooks;}exports.default=wrapConnectorHooks;});unwrapExports$2(wrapConnectorHooks_1);var createSourceConnector_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function createSourceConnector(backend){var currentHandlerId;var currentDragSourceNode;var currentDragSourceOptions;var disconnectCurrentDragSource;var currentDragPreviewNode;var currentDragPreviewOptions;var disconnectCurrentDragPreview;function reconnectDragSource(){if(disconnectCurrentDragSource){disconnectCurrentDragSource();disconnectCurrentDragSource=undefined;}if(currentHandlerId&&currentDragSourceNode){disconnectCurrentDragSource=backend.connectDragSource(currentHandlerId,currentDragSourceNode,currentDragSourceOptions);}}function reconnectDragPreview(){if(disconnectCurrentDragPreview){disconnectCurrentDragPreview();disconnectCurrentDragPreview=undefined;}if(currentHandlerId&&currentDragPreviewNode){disconnectCurrentDragPreview=backend.connectDragPreview(currentHandlerId,currentDragPreviewNode,currentDragPreviewOptions);}}function receiveHandlerId(handlerId){if(handlerId===currentHandlerId){return;}currentHandlerId=handlerId;reconnectDragSource();reconnectDragPreview();}var hooks=wrapConnectorHooks_1.default({dragSource:function connectDragSource(node,options){if(node===currentDragSourceNode&&shallowequal(options,currentDragSourceOptions)){return;}currentDragSourceNode=node;currentDragSourceOptions=options;reconnectDragSource();},dragPreview:function connectDragPreview(node,options){if(node===currentDragPreviewNode&&shallowequal(options,currentDragPreviewOptions)){return;}currentDragPreviewNode=node;currentDragPreviewOptions=options;reconnectDragPreview();}});return {receiveHandlerId:receiveHandlerId,hooks:hooks};}exports.default=createSourceConnector;});unwrapExports$2(createSourceConnector_1);var isValidType_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function isValidType(type,allowArray){return typeof type==='string'||typeof type==='symbol'||!!allowArray&&Array.isArray(type)&&type.every(function(t){return isValidType(t,false);});}exports.default=isValidType;});unwrapExports$2(isValidType_1);var DragSource_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});/**
   * Decorates a component as a dragsource
   * @param type The dragsource type
   * @param spec The drag source specification
   * @param collect The props collector function
   * @param options DnD options
   */function DragSource(type,spec,collect,options){if(options===void 0){options={};}checkDecoratorArguments_1.default('DragSource','type, spec, collect[, options]',type,spec,collect,options);var getType=type;if(typeof type!=='function'){invariant_1$1(isValidType_1.default(type),'Expected "type" provided as the first argument to DragSource to be '+'a string, or a function that returns a string given the current props. '+'Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',type);getType=function(){return type;};}invariant_1$1(isPlainObject_1(spec),'Expected "spec" provided as the second argument to DragSource to be '+'a plain object. Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',spec);var createSource=createSourceFactory_1.default(spec);invariant_1$1(typeof collect==='function','Expected "collect" provided as the third argument to DragSource to be '+'a function that returns a plain object of props to inject. '+'Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',collect);invariant_1$1(isPlainObject_1(options),'Expected "options" provided as the fourth argument to DragSource to be '+'a plain object when specified. '+'Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drag-source.html',collect);return function decorateSource(DecoratedComponent){return decorateHandler_1.default({containerDisplayName:'DragSource',createHandler:createSource,registerHandler:registerSource_1.default,createMonitor:createSourceMonitor_1.default,createConnector:createSourceConnector_1.default,DecoratedComponent:DecoratedComponent,getType:getType,collect:collect,options:options});};}exports.default=DragSource;});unwrapExports$2(DragSource_1);var registerTarget_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function registerTarget(type,target,manager){var registry=manager.getRegistry();var targetId=registry.addTarget(type,target);function unregisterTarget(){registry.removeTarget(targetId);}return {handlerId:targetId,unregister:unregisterTarget};}exports.default=registerTarget;});unwrapExports$2(registerTarget_1);var createTargetFactory_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var ALLOWED_SPEC_METHODS=['canDrop','hover','drop'];function createTargetFactory(spec){Object.keys(spec).forEach(function(key){invariant_1$1(ALLOWED_SPEC_METHODS.indexOf(key)>-1,'Expected the drop target specification to only have '+'some of the following keys: %s. '+'Instead received a specification with an unexpected "%s" key. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',ALLOWED_SPEC_METHODS.join(', '),key);invariant_1$1(typeof spec[key]==='function','Expected %s in the drop target specification to be a function. '+'Instead received a specification with %s: %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',key,key,spec[key]);});var TargetImpl=/** @class */function(){function TargetImpl(monitor){this.monitor=monitor;this.props=null;this.ref=React__default.createRef();}TargetImpl.prototype.receiveProps=function(props){this.props=props;};TargetImpl.prototype.receiveMonitor=function(monitor){this.monitor=monitor;};TargetImpl.prototype.canDrop=function(){if(!spec.canDrop){return true;}return spec.canDrop(this.props,this.monitor);};TargetImpl.prototype.hover=function(){if(!spec.hover){return;}spec.hover(this.props,this.monitor,this.ref.current);};TargetImpl.prototype.drop=function(){if(!spec.drop){return undefined;}var dropResult=spec.drop(this.props,this.monitor,this.ref.current);if(process.env.NODE_ENV!=='production'){invariant_1$1(typeof dropResult==='undefined'||isPlainObject_1(dropResult),'drop() must either return undefined, or an object that represents the drop result. '+'Instead received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',dropResult);}return dropResult;};return TargetImpl;}();return function createTarget(monitor){return new TargetImpl(monitor);};}exports.default=createTargetFactory;});unwrapExports$2(createTargetFactory_1);var createTargetMonitor_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var isCallingCanDrop=false;var TargetMonitor=/** @class */function(){function TargetMonitor(manager){this.internalMonitor=manager.getMonitor();}TargetMonitor.prototype.receiveHandlerId=function(targetId){this.targetId=targetId;};TargetMonitor.prototype.canDrop=function(){invariant_1$1(!isCallingCanDrop,'You may not call monitor.canDrop() inside your canDrop() implementation. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target-monitor.html');try{isCallingCanDrop=true;return this.internalMonitor.canDropOnTarget(this.targetId);}finally{isCallingCanDrop=false;}};TargetMonitor.prototype.isOver=function(options){return this.internalMonitor.isOverTarget(this.targetId,options);};TargetMonitor.prototype.getItemType=function(){return this.internalMonitor.getItemType();};TargetMonitor.prototype.getItem=function(){return this.internalMonitor.getItem();};TargetMonitor.prototype.getDropResult=function(){return this.internalMonitor.getDropResult();};TargetMonitor.prototype.didDrop=function(){return this.internalMonitor.didDrop();};TargetMonitor.prototype.getInitialClientOffset=function(){return this.internalMonitor.getInitialClientOffset();};TargetMonitor.prototype.getInitialSourceClientOffset=function(){return this.internalMonitor.getInitialSourceClientOffset();};TargetMonitor.prototype.getSourceClientOffset=function(){return this.internalMonitor.getSourceClientOffset();};TargetMonitor.prototype.getClientOffset=function(){return this.internalMonitor.getClientOffset();};TargetMonitor.prototype.getDifferenceFromInitialOffset=function(){return this.internalMonitor.getDifferenceFromInitialOffset();};return TargetMonitor;}();exports.TargetMonitor=TargetMonitor;function createTargetMonitor(manager){return new TargetMonitor(manager);}exports.default=createTargetMonitor;});unwrapExports$2(createTargetMonitor_1);var createTargetMonitor_2=createTargetMonitor_1.TargetMonitor;var createTargetConnector_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function createTargetConnector(backend){var currentHandlerId;var currentDropTargetNode;var currentDropTargetOptions;var disconnectCurrentDropTarget;function reconnectDropTarget(){if(disconnectCurrentDropTarget){disconnectCurrentDropTarget();disconnectCurrentDropTarget=undefined;}if(currentHandlerId&&currentDropTargetNode){disconnectCurrentDropTarget=backend.connectDropTarget(currentHandlerId,currentDropTargetNode,currentDropTargetOptions);}}function receiveHandlerId(handlerId){if(handlerId===currentHandlerId){return;}currentHandlerId=handlerId;reconnectDropTarget();}var hooks=wrapConnectorHooks_1.default({dropTarget:function connectDropTarget(node,options){if(node===currentDropTargetNode&&shallowequal(options,currentDropTargetOptions)){return;}currentDropTargetNode=node;currentDropTargetOptions=options;reconnectDropTarget();}});return {receiveHandlerId:receiveHandlerId,hooks:hooks};}exports.default=createTargetConnector;});unwrapExports$2(createTargetConnector_1);var DropTarget_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function DropTarget(type,spec,collect,options){if(options===void 0){options={};}checkDecoratorArguments_1.default('DropTarget','type, spec, collect[, options]',type,spec,collect,options);var getType=type;if(typeof type!=='function'){invariant_1$1(isValidType_1.default(type,true),'Expected "type" provided as the first argument to DropTarget to be '+'a string, an array of strings, or a function that returns either given '+'the current props. Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',type);getType=function(){return type;};}invariant_1$1(isPlainObject_1(spec),'Expected "spec" provided as the second argument to DropTarget to be '+'a plain object. Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',spec);var createTarget=createTargetFactory_1.default(spec);invariant_1$1(typeof collect==='function','Expected "collect" provided as the third argument to DropTarget to be '+'a function that returns a plain object of props to inject. '+'Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',collect);invariant_1$1(isPlainObject_1(options),'Expected "options" provided as the fourth argument to DropTarget to be '+'a plain object when specified. '+'Instead, received %s. '+'Read more: http://react-dnd.github.io/react-dnd/docs-drop-target.html',collect);return function decorateTarget(DecoratedComponent){return decorateHandler_1.default({containerDisplayName:'DropTarget',createHandler:createTarget,registerHandler:registerTarget_1.default,createMonitor:createTargetMonitor_1.default,createConnector:createTargetConnector_1.default,DecoratedComponent:DecoratedComponent,getType:getType,collect:collect,options:options});};}exports.default=DropTarget;});unwrapExports$2(DropTarget_1);var lib$1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.DragDropContext=DragDropContext_1.DragDropContext;exports.DragDropContextProvider=DragDropContext_1.DragDropContextProvider;exports.DragLayer=DragLayer_1.default;exports.DragSource=DragSource_1.default;exports.DropTarget=DropTarget_1.default;});unwrapExports$2(lib$1);var lib_1=lib$1.DragDropContext;var lib_2=lib$1.DragDropContextProvider;var lib_3=lib$1.DragLayer;var lib_4=lib$1.DragSource;var lib_5=lib$1.DropTarget;var css$1=".ExampleDropTarget {\n  display: flex;\n  justify-content: center;\n  flex-direction: column;\n\n  width: 100%;\n  min-height: 100px;\n\n  border: 2px dashed black;\n  padding: 20px;\n  transition: 0.2s all ease;\n}\n\n.ExampleDropTarget h4,\n.ExampleDropTarger p {\n  text-align: center;\n  word-break: break-word;\n}\n\n.ExampleDropTarget.can-drop {\n  border: 2px dashed #20a5d6;\n  background-color: #fafafa;\n  color: black;\n}\n\n.ExampleDropTarget.hovered {\n  border: 2px dashed #20a5d6;\n  background-color: black;\n  color: #91b9cd;\n}\n";styleInject(css$1);// if they have the same string type.
  var Types={THUMBNAIL:'thumbnail'};var divTarget={drop:function drop(props,monitor,component){// Note: For this example we use setState, but in
  // OHIF we will update the redux store instead
  var item=monitor.getItem();component.setState({item:{id:item.id,seriesDescription:item.seriesDescription}});return {id:'ExampleDropTarget'};}};// TODO: Find out why we can't move this into the Example app instead.
  // It looks like the context isn't properly shared.
  var ExampleDropTarget=/*#__PURE__*/function(_Component){_inherits$c(ExampleDropTarget,_Component);function ExampleDropTarget(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,ExampleDropTarget);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(ExampleDropTarget)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"state",{item:null});return _this;}_createClass$2(ExampleDropTarget,[{key:"render",value:function render(){var _this$props=this.props,canDrop=_this$props.canDrop,isOver=_this$props.isOver,connectDropTarget=_this$props.connectDropTarget;var isActive=canDrop&&isOver;var className=ExampleDropTarget.className;if(isActive){className+=' hovered';}else if(canDrop){className+=' can-drop';}return connectDropTarget(React__default.createElement("div",{className:className},React__default.createElement("h4",null,isActive?'Release to drop':'Drag / Drop something from the Study Browser here'),React__default.createElement("p",{className:"study-drop-results"},this.state.item&&JSON.stringify(this.state.item))));}}]);return ExampleDropTarget;}(React.Component);_defineProperty$3(ExampleDropTarget,"className",'ExampleDropTarget');_defineProperty$3(ExampleDropTarget,"defaultProps",{isOver:false});_defineProperty$3(ExampleDropTarget,"propTypes",{connectDropTarget:propTypes$1.func.isRequired,canDrop:propTypes$1.bool.isRequired,isOver:propTypes$1.bool.isRequired});var collect=function collect(connect,monitor){return {connectDropTarget:connect.dropTarget(),isOver:monitor.isOver(),canDrop:monitor.canDrop()};};var ExampleDropTarget$1=lib_5(Types.THUMBNAIL,divTarget,collect)(ExampleDropTarget);var css$2=".layoutChooser {\n  border: 1px solid rgba(77,99,110,0.81);\n  border-radius: 8px;\n  padding: 5px 0;\n  position: absolute;\n  z-index: 5000;\n}\n.layoutChooser .selectedBefore {\n  background-color: #5cc3eb;\n}\n.layoutChooser table {\n  margin: 0 auto;\n}\n.layoutChooser table td {\n  cursor: pointer;\n}\n.layoutChooser table td:hover,\n.layoutChooser table td.hover {\n  background-color: #209ac9;\n}\n";styleInject(css$2);/**
   * Adds the 'hover' class to cells above and to the left of the current cell
   * This is used to "fill in" the grid that the user will change the layout to,
   * if they click on a specific table cell.
   **/var LayoutChooser=/*#__PURE__*/function(_PureComponent){_inherits$c(LayoutChooser,_PureComponent);function LayoutChooser(props){var _this;_classCallCheck$c(this,LayoutChooser);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(LayoutChooser).call(this,props));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"isRange",function(cell,parentCell){return cell.row<=parentCell.row&&cell.col<=parentCell.col;});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"highlightCells",function(currentCell){var table=[];for(var row=0;row<_this.props.rows;row++){var newRow=[];for(var col=0;col<_this.props.columns;col++){var cell={row:row,col:col};if(_this.isRange(cell,currentCell)){cell.className='hover';}else if(_this.isRange(currentCell,_this.emptyCell)&&_this.isRange(cell,_this.state.selectedCell)){cell.className='selectedBefore';}newRow.push(cell);}table.push(newRow);}_this.setState({table:table});});_this.emptyCell={row:-1,column:-1};_this.state={table:[[]],selectedCell:_this.props.selectedCell};return _this;}_createClass$2(LayoutChooser,[{key:"componentDidMount",value:function componentDidMount(){this.highlightCells(this.emptyCell);}},{key:"onClick",value:function onClick(currentCell){this.setState({selectedCell:currentCell});this.highlightCells(currentCell);if(this.props.onClick){this.props.onClick(currentCell);}if(this.props.onChange){this.props.onChange(currentCell);}}},{key:"render",value:function render(){var _this2=this;var columns=this.props.columns;var style={display:this.props.visible?'block':'none',minWidth:columns*this.props.boxSize+(columns+5)*this.props.cellBorder};return React__default.createElement("div",{className:"layoutChooser pull-left dropdown-menu",role:"menu",style:style},React__default.createElement("table",null,React__default.createElement("tbody",null,this.state.table.map(function(row,i){return React__default.createElement("tr",{key:i},row.map(function(cell,j){return React__default.createElement("td",{className:cell.className,style:{width:_this2.props.boxSize,height:_this2.props.boxSize,border:'solid 1px black'},key:j,onMouseEnter:function onMouseEnter(){return _this2.highlightCells(cell);},onMouseLeave:function onMouseLeave(){return _this2.highlightCells(_this2.emptyCell);},onClick:function onClick(){return _this2.onClick(cell);}});}));}))));}}]);return LayoutChooser;}(React.PureComponent);_defineProperty$3(LayoutChooser,"propTypes",{rows:propTypes$1.number.isRequired,columns:propTypes$1.number.isRequired,visible:propTypes$1.bool.isRequired,selectedCell:propTypes$1.object,boxSize:propTypes$1.number.isRequired,cellBorder:propTypes$1.number.isRequired,onClick:propTypes$1.func,onChange:propTypes$1.func});_defineProperty$3(LayoutChooser,"defaultProps",{rows:3,columns:3,visible:true,boxSize:20,cellBorder:1,selectedCell:{row:-1,col:-1}});var LayoutButton=/*#__PURE__*/function(_PureComponent){_inherits$c(LayoutButton,_PureComponent);function LayoutButton(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,LayoutButton);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(LayoutButton)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"state",{dropdownVisible:_this.props.dropdownVisible});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClick",function(){_this.setState({dropdownVisible:!_this.state.dropdownVisible});});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onChange",function(selectedCell){if(_this.props.onChange){_this.props.onChange(selectedCell);}});return _this;}_createClass$2(LayoutButton,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){if(this.props.dropdownVisible!==prevProps.dropdownVisible){this.setState({dropdownVisible:this.props.dropdownVisible});}}},{key:"render",value:function render(){return React__default.createElement("div",{className:"btn-group"},React__default.createElement("button",{id:"layout",type:"button",className:"btn btn-sm btn-default dropdown-toggle","data-container":"body","data-toggle":"dropdown","aria-expanded":"false","data-placement":"right",title:"Layout",rel:"tooltip",onClick:this.onClick},React__default.createElement("span",{className:"fa fa-th-large"})),React__default.createElement(LayoutChooser,{visible:this.state.dropdownVisible,onChange:this.onChange,onClick:this.onClick,selectedCell:this.props.selectedCell}));}}]);return LayoutButton;}(React.PureComponent);LayoutButton.defaultProps={dropdownVisible:false};LayoutButton.propTypes={dropdownVisible:propTypes$1.bool.isRequired,onChange:propTypes$1.func,selectedCell:propTypes$1.object};var css$3=".viewport-container {\n  float: left;\n\n  border: var(--viewport-border-thickness) solid var(--ui-border-color);\n}\n\n.viewport-container.active {\n  border: var(--viewport-border-thickness) solid var(--active-color);\n}\n\n.EmptyViewport {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  color: var(--text-secondary-color);\n}\n";styleInject(css$3);var css$4=".LayoutPanelDropTarget {\n  width: 100%;\n  height: 100%;\n\n  opacity: 1;\n  transition: 0.3s all ease;\n}\n\n.LayoutPanelDropTarget.hovered {\n  opacity: 0.5;\n}\n";styleInject(css$4);// if they have the same string type.
  var Types$1={THUMBNAIL:'thumbnail'};var divTarget$1={drop:function drop(props,monitor,component){var item=monitor.getItem();if(props.onDrop){props.onDrop({viewportIndex:props.viewportIndex,item:item});}return {id:"LayoutPanelDropTarget-".concat(props.viewportIndex),viewportIndex:props.viewportIndex,item:item};}};// TODO: Find out why we can't move this into the Example app instead.
  // It looks like the context isn't properly shared.
  var LayoutPanelDropTarget=/*#__PURE__*/function(_Component){_inherits$c(LayoutPanelDropTarget,_Component);function LayoutPanelDropTarget(){_classCallCheck$c(this,LayoutPanelDropTarget);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(LayoutPanelDropTarget).apply(this,arguments));}_createClass$2(LayoutPanelDropTarget,[{key:"render",value:function render(){var _this$props=this.props,canDrop=_this$props.canDrop,isOver=_this$props.isOver,connectDropTarget=_this$props.connectDropTarget;var isActive=canDrop&&isOver;var className=LayoutPanelDropTarget.className;if(isActive){className+=' hovered';}else if(canDrop){className+=' can-drop';}return connectDropTarget(React__default.createElement("div",{className:className},this.props.children));}}]);return LayoutPanelDropTarget;}(React.Component);_defineProperty$3(LayoutPanelDropTarget,"className",'LayoutPanelDropTarget');_defineProperty$3(LayoutPanelDropTarget,"defaultProps",{isOver:false,canDrop:false});_defineProperty$3(LayoutPanelDropTarget,"propTypes",{connectDropTarget:propTypes$1.func.isRequired,canDrop:propTypes$1.bool.isRequired,isOver:propTypes$1.bool.isRequired,viewportComponent:propTypes$1.object});var collect$1=function collect(connect,monitor){return {connectDropTarget:connect.dropTarget(),canDrop:monitor.canDrop(),isOver:monitor.isOver()};};var LayoutPanelDropTarget$1=lib_5(Types$1.THUMBNAIL,divTarget$1,collect$1)(LayoutPanelDropTarget);function defaultViewportPlugin(props){return React__default.createElement("div",null,JSON.stringify(props));}function EmptyViewport(){return React__default.createElement("div",{className:"EmptyViewport"},React__default.createElement("p",null,"Please drag a stack here to view images."));}var LayoutManager=/*#__PURE__*/function(_Component){_inherits$c(LayoutManager,_Component);function LayoutManager(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,LayoutManager);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(LayoutManager)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onDrop",function(_ref){var viewportIndex=_ref.viewportIndex,item=_ref.item;if(_this.props.setViewportData){_this.props.setViewportData({viewportIndex:viewportIndex,item:item});}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getPluginComponent",function(plugin){var pluginComponent=_this.props.availablePlugins[plugin||_this.props.defaultPlugin];if(!pluginComponent){throw new Error("No Viewport Plugin available for plugin ".concat(plugin,". Available plugins: ").concat(JSON.stringify(_this.props.availablePlugins)));}return pluginComponent;});return _this;}_createClass$2(LayoutManager,[{key:"getChildComponent",value:function getChildComponent(plugin,data,viewportIndex){if(data.displaySet){var PluginComponent=this.getPluginComponent(plugin);return React__default.createElement(PluginComponent,{viewportData:data,viewportIndex:viewportIndex});}return React__default.createElement(EmptyViewport,null);}},{key:"getContent",value:function getContent(childComponent,supportsDragAndDrop,viewportIndex){if(supportsDragAndDrop){return React__default.createElement(LayoutPanelDropTarget$1,{onDrop:this.onDrop,viewportIndex:viewportIndex},childComponent);}return React__default.createElement("div",{className:"LayoutPanel"},childComponent);}},{key:"render",value:function render(){var _this2=this;if(!this.props.viewportData.length){return '';}var _this$props=this.props,supportsDragAndDrop=_this$props.supportsDragAndDrop,studies=_this$props.studies,viewportData=_this$props.viewportData;var viewports=this.props.layout.viewports;var viewportElements=viewports.map(function(layout,viewportIndex){var displaySet=viewportData[viewportIndex];var data={displaySet:displaySet,studies:studies};var childComponent=_this2.getChildComponent(layout.plugin,data,viewportIndex);var content=_this2.getContent(childComponent,supportsDragAndDrop,viewportIndex);var className='viewport-container';if(_this2.props.activeViewportIndex===viewportIndex){className+=' active';}return React__default.createElement("div",{key:viewportIndex,className:className,style:_objectSpread$2({},layout)},content);});return React__default.createElement("div",{className:LayoutManager.className},viewportElements);}}]);return LayoutManager;}(React.Component);_defineProperty$3(LayoutManager,"className",'LayoutManager');_defineProperty$3(LayoutManager,"defaultProps",{viewportData:[],layout:{viewports:[{top:0,left:0,height:'100%',width:'100%'}]},activeViewportIndex:0,supportsDragAndDrop:true,availablePlugins:{defaultViewportPlugin:defaultViewportPlugin},defaultPlugin:'defaultViewportPlugin'});_defineProperty$3(LayoutManager,"propTypes",{viewportData:propTypes$1.array.isRequired,supportsDragAndDrop:propTypes$1.bool.isRequired,activeViewportIndex:propTypes$1.number.isRequired,layout:propTypes$1.object.isRequired,availablePlugins:propTypes$1.object.isRequired,setViewportData:propTypes$1.func,studies:propTypes$1.array});var css$5=".tableList {\n  background-color: var(--primary-background-color);\n  height: 100%;\n  width: 100%;\n}\n.tableList .tableListHeader {\n  background-color: var(--ui-gray-darker);\n  color: var(--text-secondary-color);\n  fill: var(--text-secondary-color);\n  display: flex;\n  height: 63px;\n  line-height: 63px;\n  margin-top: 2px;\n  overflow: hidden;\n  width: 100%;\n}\n.tableList .tableListHeader .tableListHeaderTitle {\n  color: var(--text-secondary-color);\n  font-size: 22px;\n  font-weight: 300;\n  line-height: 63px;\n  padding: 0 10px;\n  text-align: left;\n  flex: 1;\n}\n.tableList .tableListHeader .numberOfItems {\n  color: var(--ui-sky-blue);\n  float: right;\n  font-weight: 300;\n  font-size: 40px;\n  max-width: 54px;\n  height: 63px;\n  line-height: 66px;\n  flex: 1;\n}\n";styleInject(css$5);var TableList=/*#__PURE__*/function(_Component){_inherits$c(TableList,_Component);function TableList(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,TableList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(TableList)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getHeader",function(){if(_this.props.customHeader){return _this.props.customHeader;}else{return React__default.createElement(React__default.Fragment,null,React__default.createElement("div",{className:"tableListHeaderTitle"},_this.props.headerTitle),React__default.createElement("div",{className:"numberOfItems"},_this.props.children.length));}});return _this;}_createClass$2(TableList,[{key:"render",value:function render(){return React__default.createElement("div",{className:"tableList"},React__default.createElement("div",{className:"tableListHeader",onClick:this.onHeaderClick},this.getHeader()),React__default.createElement("div",{className:"tableListContent"},this.props.children));}}]);return TableList;}(React.Component);_defineProperty$3(TableList,"propTypes",{customHeader:propTypes$1.node,defaultItems:propTypes$1.object,children:propTypes$1.node.isRequired,headerTitle:propTypes$1.string});var css$6=".tableListItem {\n  display: flex;\n  margin-left: -6px;\n  margin-top: 2px;\n  padding-left: 6px;\n  opacity: 0.7;\n  width: calc(100% + 6px);\n}\n.tableListItem:hover {\n  opacity: 1;\n}\n.tableListItem.selected {\n  opacity: 1;\n}\n.tableListItem.selected .itemIndex {\n  color: $activeColor;\n}\n.tableListItem .itemIndex {\n  background-color: var(--ui-gray);\n  color: var(--text-secondary-color);\n  cursor: pointer;\n  flex: 1;\n  max-width: 40px;\n  font-size: 14px;\n  font-weight: 400;\n  margin-right: 5px;\n  padding: 10px;\n  text-align: center;\n}\n.tableListItem .itemContent {\n  flex: 1;\n  color: var(--text-secondary-color);\n  font-weight: 400;\n  margin-left: -2px;\n}\n";styleInject(css$6);var TableListItem=/*#__PURE__*/function(_Component){_inherits$c(TableListItem,_Component);function TableListItem(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,TableListItem);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(TableListItem)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onItemClick",function(event){if(_this.props.onItemClick){event.preventDefault();event.stopPropagation();_this.props.onItemClick(event,_this.props);}});return _this;}_createClass$2(TableListItem,[{key:"render",value:function render(){return React__default.createElement("div",{className:"tableListItem ".concat(this.props.itemClass),onClick:this.onItemClick},React__default.createElement("div",{className:"itemIndex"},this.props.itemIndex+1),React__default.createElement("div",{className:"itemContent"},this.props.children));}}]);return TableListItem;}(React.Component);_defineProperty$3(TableListItem,"propTypes",{children:propTypes$1.node,itemClass:propTypes$1.string,itemIndex:propTypes$1.number,onItemClick:propTypes$1.func.isRequired});var css$7=".measurementItem .rowActions {\n  background-color: var(--ui-gray-darker);\n  height: 0;\n  overflow: hidden;\n  transition: all 0.3s ease;\n  visibility: hidden;\n  padding-left: 14px;\n}\n.measurementItem .rowActions .btnAction {\n  background-color: transparent;\n  border: none;\n  color: var(--default-color);\n  cursor: pointer;\n  line-height: 35px;\n  transition: all 0.3s ease;\n}\n.measurementItem .rowActions .btnAction:hover,\n.measurementItem .rowActions .btnAction:active {\n  color: var(--text-primary-color);\n}\n.measurementItem .rowActions .btnAction i {\n  margin-right: 4px;\n}\n.measurementItem.selected .rowActions {\n  height: 35px;\n  visibility: visible;\n}\n.measurementItem .measurementLocation {\n  margin-left: 9px;\n  margin-top: 9px;\n}\n.measurementItem .measurementDisplayText {\n  display: inline-block;\n  margin-top: 9px;\n  margin-left: 9px;\n  padding-left: 9px;\n  width: 90px;\n  border-left: 1px solid var(--text-secondary-color);\n  color: var(--text-primary-color);\n}\n";styleInject(css$7);var MeasurementTableItem=/*#__PURE__*/function(_Component){_inherits$c(MeasurementTableItem,_Component);function MeasurementTableItem(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,MeasurementTableItem);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(MeasurementTableItem)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getDataDisplayText",function(){return _this.props.measurementData.data.map(function(data,index){return React__default.createElement("div",{key:"displayText_".concat(index),className:"measurementDisplayText"},data.displayText?data.displayText:'...');});});return _this;}_createClass$2(MeasurementTableItem,[{key:"render",value:function render(){return React__default.createElement(TableListItem,{itemKey:this.props.itemKey,itemClass:"measurementItem ".concat(this.props.itemClass),itemIndex:this.props.itemIndex,onItemClick:this.props.onItemClick},React__default.createElement("div",null,React__default.createElement("div",{className:"measurementLocation"},this.props.measurementData.label),React__default.createElement("div",null,this.getDataDisplayText()),React__default.createElement("div",{className:"rowActions"},React__default.createElement("button",{className:"btnAction",onClick:this.props.onRelabel},React__default.createElement("i",{className:"fa fa-edit"}),"Relabel"),React__default.createElement("button",{className:"btnAction",onClick:this.props.onEditDescription},React__default.createElement("i",{className:"fa fa-edit"}),"Description"),React__default.createElement("button",{className:"btnAction",onClick:this.props.onDelete},React__default.createElement("i",{className:"fa fa-trash-o"}),"Delete"))));}}]);return MeasurementTableItem;}(React.Component);_defineProperty$3(MeasurementTableItem,"propTypes",{measurementData:propTypes$1.object.isRequired,onItemClick:propTypes$1.func.isRequired,onRelabel:propTypes$1.func.isRequired,onDelete:propTypes$1.func.isRequired,onEditDescription:propTypes$1.func.isRequired,itemKey:propTypes$1.string.isRequired,itemClass:propTypes$1.string,itemIndex:propTypes$1.number});function throttled(delay,fn){var lastCall=0;return function(){var now=new Date().getTime();if(now-lastCall<delay){return;}lastCall=now;return fn.apply(void 0,arguments);};}/**
   * Get the vertical and horizontal scrollbar sizes
   * Got from https://stackoverflow.com/questions/986937/how-can-i-get-the-browsers-scrollbar-sizes
   *
   * @returns {Array} Array containing the scrollbar horizontal and vertical sizes
   */function getScrollbarSize$1(){var inner=document.createElement('p');inner.style.width='100%';inner.style.height='100%';var outer=document.createElement('div');outer.style.position='absolute';outer.style.top='0px';outer.style.left='0px';outer.style.visibility='hidden';outer.style.width='100px';outer.style.height='100px';outer.style.overflow='hidden';outer.appendChild(inner);document.body.appendChild(outer);var w1=inner.offsetWidth;var h1=inner.offsetHeight;outer.style.overflow='scroll';var w2=inner.offsetWidth;var h2=inner.offsetHeight;if(w1===w2){w2=outer.clientWidth;}if(h1===h2){h2=outer.clientHeight;}document.body.removeChild(outer);return [w1-w2,h1-h2];}var css$8=".scrollArea {\n  overflow: hidden;\n  position: relative;\n}\n.scrollArea .scrollable {\n  max-height: inherit;\n  overflow: hidden;\n  zoom: 1;\n}\n.scrollArea .scrollable.scrollX {\n  overflow-x: scroll;\n}\n.scrollArea .scrollable.scrollY {\n  overflow-y: scroll;\n}\n.scrollArea.fit {\n  height: 100%;\n  width: 100%;\n}\n.scrollArea.fit .scrollable {\n  bottom: 0;\n  left: 0;\n  max-height: none;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.scrollArea .scrollNav {\n  background-color: rgba(0,0,0,0.75);\n  box-shadow: 0 0 10px 10px rgba(0,0,0,0.75);\n  cursor: pointer;\n  height: 24px;\n  left: 10px;\n  opacity: 0;\n  position: absolute;\n  right: 10px;\n  transition: all 0.3s ease;\n}\n.scrollArea .scrollNav:after {\n  color: var(--active-color);\n  display: block;\n  font-family: FontAwesome;\n  font-size: 20px;\n  text-align: center;\n  transition: color 0.3s ease;\n}\n.scrollArea .scrollNav:hover {\n  background-color: rgba(0,0,0,0.9);\n  box-shadow: 0 0 10px 10px rgba(0,0,0,0.9);\n}\n.scrollArea .scrollNav:hover:after {\n  color: var(--hover-color);\n}\n.scrollArea .scrollNavUp {\n  border-bottom-left-radius: 24px/2;\n  border-bottom-right-radius: 24px/2;\n  top: 0;\n  transform: ranslateY(-24px);\n}\n.scrollArea .scrollNavUp:after {\n  content: '\\f102';\n}\n.scrollArea .scrollNavDown {\n  border-top-left-radius: 24px/2;\n  border-top-right-radius: 24px/2;\n  bottom: 0;\n  transform: translateY(24px);\n}\n.scrollArea .scrollNavDown:after {\n  content: '\\f103';\n}\n.scrollArea.canScrollUp .scrollNavUp,\n.scrollArea.canScrollDown .scrollNavDown {\n  opacity: 1;\n  transform: translateY(0);\n}\n";styleInject(css$8);var ScrollableArea=/*#__PURE__*/function(_Component){_inherits$c(ScrollableArea,_Component);function ScrollableArea(props){var _this;_classCallCheck$c(this,ScrollableArea);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(ScrollableArea).call(this,props));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"scrollNavDown",function(event){var _this$scrollableEleme=_this.scrollableElement,currentTop=_this$scrollableEleme.scrollTop,height=_this$scrollableEleme.offsetHeight,scrollHeight=_this$scrollableEleme.scrollHeight;var limit=scrollHeight-height;var scrollTop=currentTop+_this.props.scrollStep;scrollTop=scrollTop>limit?limit:scrollTop;_this.scrollableElement.scrollTop=scrollTop;});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"scrollNavUp",function(event){var currentTop=_this.scrollableElement.scrollTop;var scrollTop=currentTop-_this.props.scrollStep;scrollTop=scrollTop<0?0:scrollTop;_this.scrollableElement.scrollTop=scrollTop;});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"adjustMargins",function(){if(_this.props.hideScrollbar){var x=_this.props.scrollX?1:0;var y=_this.props.scrollY?1:0;var scrollbarSize=getScrollbarSize$1();_this.scrollableElement.style.marginRight="".concat(0-scrollbarSize[0]*y,"px");_this.scrollableElement.style.marginBottom="".concat(0-scrollbarSize[1]*x,"px");}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"scrollHandler",function(){var _this$scrollableEleme2=_this.scrollableElement,height=_this$scrollableEleme2.offsetHeight,scrollTop=_this$scrollableEleme2.scrollTop,scrollHeight=_this$scrollableEleme2.scrollHeight;var scrollAreaClasses='';// Stop here if unable to scroll
  if(scrollHeight<=height)return;// Check if can scroll up
  if(scrollTop){scrollAreaClasses+='canScrollUp';}// Check if can scroll down
  if(scrollTop+height<scrollHeight){scrollAreaClasses+=' canScrollDown';}if(_this.state.scrollAreaClasses!==scrollAreaClasses){_this.setState({scrollAreaClasses:scrollAreaClasses});}});_this.state={scrollAreaClasses:''};_this.scrollHandlerThrottled=throttled(150,_this.scrollHandler);return _this;}_createClass$2(ScrollableArea,[{key:"render",value:function render(){var _this2=this;var scrollableClass='scrollable';if(this.props.scrollableClass){scrollableClass+=" ".concat(this.props.scrollableClass);}if(this.props.scrollX){scrollableClass+=" scrollX";}if(this.props.scrollY){scrollableClass+=" scrollY";}return React__default.createElement("div",{className:"scrollArea ".concat(this.props.class," ").concat(this.state.scrollAreaClasses)},React__default.createElement("div",{className:scrollableClass,ref:function ref(element){_this2.scrollableElement=element;},onScroll:this.scrollHandlerThrottled,onMouseEnter:this.scrollHandlerThrottled,onTransitionEnd:this.scrollHandlerThrottled},this.props.children),React__default.createElement("div",{className:"scrollNav scrollNavUp",onClick:this.scrollNavUp}),React__default.createElement("div",{className:"scrollNav scrollNavDown",onClick:this.scrollNavDown}));}},{key:"componentDidMount",value:function componentDidMount(){this.adjustMargins();this.scrollHandler();window.addEventListener('resize',this.adjustMargins);}},{key:"componentWillUnmount",value:function componentWillUnmount(){window.removeEventListener('resize',this.adjustMargins);}}]);return ScrollableArea;}(React.Component);_defineProperty$3(ScrollableArea,"propTypes",{children:propTypes$1.node.isRequired,class:propTypes$1.string,scrollableClass:propTypes$1.string,scrollX:propTypes$1.bool,scrollY:propTypes$1.bool,hideScrollbar:propTypes$1.bool,scrollStep:propTypes$1.number});_defineProperty$3(ScrollableArea,"defaultProps",{hideScrollbar:true,class:'flex-grow fit',scrollY:true,scrollX:false,scrollStep:100});var css$9=".measurementTable {\n  background-color: var(--primary-background-color);\n  height: 100%;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n}\n.measurementTable .maxMeasurements {\n  border-radius: 3px;\n  color: var(--primary-background-color);\n  font-size: 12px;\n  font-weight: 500;\n  height: 19px;\n  line-height: 17px;\n  margin-top: 22px;\n  margin-right: 15px;\n  padding: 2px 6px 0;\n  text-transform: uppercase;\n  transition: all 0.3s ease;\n  background-color: var(--default-color);\n}\n.measurementTable .measurementTableHeader {\n  padding-left: 45px;\n}\n.measurementTable .measurementTableHeader .measurementTableHeaderItem {\n  display: inline-block;\n  margin-top: 9px;\n  margin-left: 9px;\n  padding-left: 9px;\n  width: 90px;\n  border-left: 1px solid var(--text-secondary-color);\n  color: var(--text-primary-color);\n}\n.measurementTable .measurementTableHeader .measurementTableHeaderItem .timepointLabel {\n  color: var(--text-secondary-color);\n  font-size: 12px;\n}\n";styleInject(css$9);var MeasurementTable=/*#__PURE__*/function(_Component){_inherits$c(MeasurementTable,_Component);function MeasurementTable(props){var _this;_classCallCheck$c(this,MeasurementTable);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(MeasurementTable).call(this,props));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getMeasurementsGroups",function(){return _this.props.measurementCollection.map(function(measureGroup,index){return React__default.createElement(TableList,{key:index,customHeader:_this.getCustomHeader(measureGroup)},_this.getMeasurements(measureGroup));});});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getMeasurements",function(measureGroup){return measureGroup.measurements.map(function(measurement,index){var key="".concat(measureGroup.groupName,"_").concat(index);return React__default.createElement(MeasurementTableItem,{key:key,itemIndex:index,itemKey:key,itemClass:_this.state.selectedKey===key?'selected':'',measurementData:measurement,onItemClick:_this.onItemClick,onRelabel:function onRelabel(){alert('relabel');},onDelete:function onDelete(){alert('delete');},onEditDescription:function onEditDescription(){alert('editDescription');}});});});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getCustomHeader",function(measureGroup){return React__default.createElement(React__default.Fragment,null,React__default.createElement("div",{className:"tableListHeaderTitle"},measureGroup.groupName),measureGroup.maxMeasurements&&React__default.createElement("div",{className:"maxMeasurements"},"MAX ",measureGroup.maxMeasurements),React__default.createElement("div",{className:"numberOfItems"},measureGroup.measurements.length));});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getTimepointsHeader",function(){return _this.props.timepoints.map(function(timepoint,index){return React__default.createElement("div",{key:index,className:"measurementTableHeaderItem"},React__default.createElement("div",{className:"timepointLabel"},timepoint.label),React__default.createElement("div",{className:"timepointDate"},timepoint.date));});});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onItemClick",function(event,itemProps){_this.setState({selectedKey:itemProps.itemKey});});_this.state={selectedKey:null};return _this;}_createClass$2(MeasurementTable,[{key:"render",value:function render(){return React__default.createElement("div",{className:"measurementTable"},React__default.createElement("div",{className:"measurementTableHeader"},this.getTimepointsHeader()),React__default.createElement(ScrollableArea,null,React__default.createElement("div",null,this.getMeasurementsGroups())));}}]);return MeasurementTable;}(React.Component);_defineProperty$3(MeasurementTable,"propTypes",{measurementCollection:propTypes$1.array.isRequired,timepoints:propTypes$1.array.isRequired});var PlayClipButton=/*#__PURE__*/function(_Component){_inherits$c(PlayClipButton,_Component);function PlayClipButton(){_classCallCheck$c(this,PlayClipButton);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(PlayClipButton).apply(this,arguments));}_createClass$2(PlayClipButton,[{key:"render",value:function render(){var playClass='fa-stop';if(this.props.isPlaying){playClass='fa-play';}return React__default.createElement("div",{className:"btn-group"},React__default.createElement("button",{id:"playClip",type:"button",className:"imageViewerCommand btn btn-sm btn-default","data-container":"body","data-toggle":"tooltip","data-placement":"bottom",title:"Play/Stop Clip"},React__default.createElement("span",{className:"fa ".concat(playClass)})),React__default.createElement("button",{id:"toggleCineDialog",type:"button",className:"imageViewerCommand btn btn-sm btn-default","data-container":"body","data-toggle":"tooltip","data-placement":"bottom",title:"Toggle CINE Dialog"},React__default.createElement("span",{className:"fa fa-youtube-play"})));}}]);return PlayClipButton;}(React.Component);PlayClipButton.propTypes={isPlaying:propTypes$1.bool.isRequired};PlayClipButton.defaultProps={isPlaying:false};var classnames=createCommonjsModule$2(function(module){/*!
    Copyright (c) 2017 Jed Watson.
    Licensed under the MIT License (MIT), see
    http://jedwatson.github.io/classnames
  */ /* global define */(function(){var hasOwn={}.hasOwnProperty;function classNames(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==='string'||argType==='number'){classes.push(arg);}else if(Array.isArray(arg)&&arg.length){var inner=classNames.apply(null,arg);if(inner){classes.push(inner);}}else if(argType==='object'){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key);}}}}return classes.join(' ');}if(module.exports){classNames.default=classNames;module.exports=classNames;}else{window.classNames=classNames;}})();});var css$a=".RoundedButtonGroup {\n  --height: 25px;\n\n  position: relative;\n  z-index: 0;\n}\n\n.roundedButtonWrapper {\n  cursor: pointer;\n  display: inline-block;\n  float: left;\n  margin-left: -2px;\n  text-decoration: none;\n  text-align: center;\n}\n\n.roundedButtonWrapper.disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.RoundedButtonGroup .roundedButtonWrapper .roundedButton {\n  align-items: center;\n  background-color: var(--ui-gray-dark);\n  border: 2px solid var(--ui-border-color-dark);\n  color: var(--text-secondary-color);\n  display: flex;\n  font-size: 11px;\n  font-weight: 500;\n  justify-content: center;\n  height: var(--height);\n  line-height: var(--height);\n  padding: 0 22px;\n  position: relative;\n  text-transform: uppercase;\n  transition: var(--sidebar-transition);\n  z-index: 1;\n}\n\n.roundedButtonWrapper .roundedButton svg {\n  fill: var(--default-color);\n  stroke: var(--default-color);\n}\n\n.roundedButtonWrapper\n  .roundedButton\n  svg\n  .roundedButtonWrapper\n  .roundedButton\n  span {\n  margin: 0 2px;\n}\n\n.roundedButtonWrapper .roundedButton i {\n  line-height: 15px;\n  font-size: 15px;\n}\n\n.bottomLabel {\n  color: var(--text-secondary-color);\n  font-size: 12px;\n  font-weight: 500;\n  line-height: 12px;\n  margin-top: 8px;\n}\n\n.roundedButtonWrapper:first-child {\n  margin-left: 0;\n}\n\n.RoundedButtonGroup .roundedButtonWrapper:first-child .roundedButton {\n  border-bottom-left-radius: var(--height);\n  border-top-left-radius: var(--height);\n}\n\n.RoundedButtonGroup .roundedButtonWrapper:last-child .roundedButton {\n  border-bottom-right-radius: var(--height);\n  border-top-right-radius: var(--height);\n}\n\n.roundedButtonWrapper:hover .roundedButton {\n  background-color: var(--box-background-color);\n  color: var(--ui-gray-dark);\n}\n\n.roundedButtonWrapper.active .roundedButton {\n  background-color: var(--active-color);\n  border-color: var(--ui-border-color-active);\n  color: var(--ui-gray-dark);\n  z-index: 2;\n}\n\n.roundedButtonWrapper:hover .roundedButton svg,\n.roundedButtonWrapper.active .roundedButton svg {\n  fill: var(--ui-gray-dark);\n  stroke: var(--ui-gray-dark);\n}\n";styleInject(css$a);var RoundedButtonGroup=/*#__PURE__*/function(_Component){_inherits$c(RoundedButtonGroup,_Component);function RoundedButtonGroup(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,RoundedButtonGroup);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(RoundedButtonGroup)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClickOption",function(value){var newValue=value;if(_this.props.value===value){newValue=null;}if(_this.props.onValueChanged){_this.props.onValueChanged(newValue);}});return _this;}_createClass$2(RoundedButtonGroup,[{key:"render",value:function render(){var _this2=this;var className=classnames(RoundedButtonGroup.className,'clearfix center-table');var buttons=this.props.options.map(function(option,index){var className=classnames({roundedButtonWrapper:true,noselect:true,active:_this2.props.value===option.value});var optionSVG;if(option.svgLink){var svgStyle={width:"".concat(option.svgWidth,"px"),height:"".concat(option.svgHeight,"px")};optionSVG=React__default.createElement("svg",{style:svgStyle},React__default.createElement("use",{xlinkHref:option.svgLink}));}var optionText=option.text&&React__default.createElement("span",null,option.text);var optionIcon=option.iconClasses&&React__default.createElement("i",{className:option.iconClasses});var bottomLabel=option.bottomLabel&&React__default.createElement("div",{className:"bottomLabel"},option.bottomLabel);return React__default.createElement("div",{key:index,className:className,onClick:function onClick(){return _this2.onClickOption(option.value);}},React__default.createElement("div",{className:"roundedButton"},optionSVG,optionText,optionIcon),bottomLabel);});return React__default.createElement("div",{className:className},buttons);}}]);return RoundedButtonGroup;}(React.Component);_defineProperty$3(RoundedButtonGroup,"className",'RoundedButtonGroup');_defineProperty$3(RoundedButtonGroup,"propTypes",{options:propTypes$1.array,value:propTypes$1.string,onValueChanged:propTypes$1.func});_defineProperty$3(RoundedButtonGroup,"defaultProps",{options:[],value:null});var css$b=".dd-menu {\n  float: left;\n  margin-right: 10px;\n  cursor: pointer;\n  position: relative;\n  z-index: 999;\n}\n\n.dd-title {\n  font-size: 13px;\n}\n\n.dd-menu-toggle {\n  display: inline-block;\n}\n\n.dd-caret-down {\n  display: inline-block;\n  width: 0;\n  height: 0;\n  margin-top: 0.5rem;\n  margin-left: 0.5rem;\n  border-top: 5px solid;\n  border-right: 5px solid transparent;\n  border-left: 5px solid transparent;\n}\n\n.dd-menu-list {\n  position: absolute;\n  top: 100%;\n  margin-top: 10px;\n  background: white;\n  border-radius: 5px;\n  -webkit-border-radius: 5px;\n  -moz-border-radius: 5px;\n  -ms-border-radius: 5px;\n  -o-border-radius: 5px;\n  overflow: hidden;\n  transition: all 300ms ease;\n  -webkit-transition: all 300ms ease;\n  -moz-transition: all 300ms ease;\n  -ms-transition: all 300ms ease;\n  -o-transition: all 300ms ease;\n}\n\n.dd-menu-list.open {\n  display: inline-block;\n}\n\n.dd-menu-list.left {\n  left: 0;\n}\n\n.dd-menu-list.right {\n  right: 0;\n}\n\n.dd-menu-list.center {\n  left: 50%;\n  transform: translateX(-50%);\n  -webkit-transform: translateX(-50%);\n  -moz-transform: translateX(-50%);\n  -ms-transform: translateX(-50%);\n  -o-transform: translateX(-50%);\n}\n\n.dd-item {\n  display: flex;\n  color: var(--text-color-active);\n  padding: 10px 15px;\n  border-bottom: 1px solid #ccc;\n}\n\n.dd-item:hover {\n  text-decoration: none;\n  background: #eee;\n}\n\n.dd-item:last-child {\n  border-bottom: none;\n}\n\n.dd-item-icon {\n  width: 10px;\n  text-align: center;\n  margin-right: 10px;\n}\n\n.dd-item-icon:before {\n  vertical-align: middle;\n}\n";styleInject(css$b);var Dropdown=/*#__PURE__*/function(_Component){_inherits$c(Dropdown,_Component);function Dropdown(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,Dropdown);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(Dropdown)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"state",{open:false});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"renderList",function(){var _this$props=_this.props,list=_this$props.list,align=_this$props.align;if(!_this.state.open){return null;}return React__default.createElement("div",{className:"dd-menu-list ".concat(align||'left')},list.map(function(_ref,key){var icon=_ref.icon,title=_ref.title,link=_ref.link,_onClick=_ref.onClick;return React__default.createElement("a",{href:link||'#',key:key,className:"dd-item",onClick:function onClick(){return _this.handleOnClick(_onClick);}},icon&&React__default.createElement("span",{className:"dd-item-icon ".concat(icon)}),React__default.createElement("span",null,title));}));});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"handleOnClick",function(onClick){_this.toggleList();if(onClick){onClick();}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"handleMouseClick",function(e){if(_this.node.contains(e.target)){return;}_this.toggleList();});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"renderTitleElement",function(){var _this$props2=_this.props,titleElement=_this$props2.titleElement,title=_this$props2.title;if(titleElement){return titleElement;}return React__default.createElement(React__default.Fragment,null,React__default.createElement("span",{className:"dd-title"},title),React__default.createElement("span",{className:"dd-caret-down"}));});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"toggleList",function(){var open=_this.state.open;var state=true;document.addEventListener('mousedown',_this.handleMouseClick,false);if(open){document.removeEventListener('mousedown',_this.handleMouseClick,false);state=false;}_this.setState({open:state});});return _this;}_createClass$2(Dropdown,[{key:"render",value:function render(){var _this2=this;return React__default.createElement("div",{className:"dd-menu",ref:function ref(node){return _this2.node=node;}},React__default.createElement("div",{className:"dd-menu-toggle",onClick:this.toggleList},this.renderTitleElement()),this.renderList());}}]);return Dropdown;}(React.Component);_defineProperty$3(Dropdown,"propTypes",{titleElement:propTypes$1.node,title:propTypes$1.string,align:propTypes$1.oneOf(['left','center','right']),list:propTypes$1.arrayOf(propTypes$1.shape({title:propTypes$1.string.isRequired,icon:propTypes$1.string,onClick:propTypes$1.func,link:propTypes$1.string}))});var InputRadio=/*#__PURE__*/function(_Component){_inherits$c(InputRadio,_Component);function InputRadio(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,InputRadio);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(InputRadio)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onSelected",function(evt){_this.props.onSelected(evt,_this.props.itemData);});return _this;}_createClass$2(InputRadio,[{key:"render",value:function render(){var labelClass=this.props.labelClass?this.props.labelClass:'';return React__default.createElement("label",{className:'wrapperLabel radioLabel '+labelClass,htmlFor:this.props.id},React__default.createElement("input",{type:"radio",id:this.props.id,className:"radioInput",value:this.props.value,onChange:this.onSelected}),React__default.createElement("span",{className:"wrapperText"},this.props.label));}}]);return InputRadio;}(React.Component);InputRadio.propTypes={value:propTypes$1.string,label:propTypes$1.string.isRequired,itemData:propTypes$1.object.isRequired,labelClass:propTypes$1.string,id:propTypes$1.string.isRequired,onSelected:propTypes$1.func.isRequired};var SelectTreeBreadcrumb=/*#__PURE__*/function(_Component){_inherits$c(SelectTreeBreadcrumb,_Component);function SelectTreeBreadcrumb(){_classCallCheck$c(this,SelectTreeBreadcrumb);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(SelectTreeBreadcrumb).apply(this,arguments));}_createClass$2(SelectTreeBreadcrumb,[{key:"render",value:function render(){return React__default.createElement("div",{className:"selectTreeBreadcrumb"},React__default.createElement("label",{className:"wrapperLabel radioLabel",htmlFor:"selectTreeBreadcrumb"},React__default.createElement("input",{type:"radio",id:"selectTreeBreadcrumb",className:"treeNode radioInput",value:this.props.value,onChange:this.props.onSelected}),React__default.createElement("span",{className:"wrapperText"},React__default.createElement("span",{className:"backIcon"},React__default.createElement("svg",null,React__default.createElement("use",{xlinkHref:"/icons.svg#fast-backward"}))),this.props.label)));}}]);return SelectTreeBreadcrumb;}(React.Component);SelectTreeBreadcrumb.propTypes={label:propTypes$1.string.isRequired,value:propTypes$1.string.isRequired,onSelected:propTypes$1.func.isRequired};var lodash_clonedeep$1=createCommonjsModule$2(function(module,exports){/**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */ /** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE=200;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED='__lodash_hash_undefined__';/** Used as references for various `Number` constants. */var MAX_SAFE_INTEGER=9007199254740991;/** `Object#toString` result references. */var argsTag='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',genTag='[object GeneratorFunction]',mapTag='[object Map]',numberTag='[object Number]',objectTag='[object Object]',promiseTag='[object Promise]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',symbolTag='[object Symbol]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',dataViewTag='[object DataView]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';/**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;/** Used to match `RegExp` flags from their coerced string values. */var reFlags=/\w*$/;/** Used to detect host constructors (Safari). */var reIsHostCtor=/^\[object .+?Constructor\]$/;/** Used to detect unsigned integer values. */var reIsUint=/^(?:0|[1-9]\d*)$/;/** Used to identify `toStringTag` values supported by `_.clone`. */var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;/** Detect free variable `global` from Node.js. */var freeGlobal=typeof commonjsGlobal$2=='object'&&commonjsGlobal$2&&commonjsGlobal$2.Object===Object&&commonjsGlobal$2;/** Detect free variable `self`. */var freeSelf=typeof self=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root=freeGlobal||freeSelf||Function('return this')();/** Detect free variable `exports`. */var freeExports=exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&'object'=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/**
   * Adds the key-value `pair` to `map`.
   *
   * @private
   * @param {Object} map The map to modify.
   * @param {Array} pair The key-value pair to add.
   * @returns {Object} Returns `map`.
   */function addMapEntry(map,pair){// Don't return `map.set` because it's not chainable in IE 11.
  map.set(pair[0],pair[1]);return map;}/**
   * Adds `value` to `set`.
   *
   * @private
   * @param {Object} set The set to modify.
   * @param {*} value The value to add.
   * @returns {Object} Returns `set`.
   */function addSetEntry(set,value){// Don't return `set.add` because it's not chainable in IE 11.
  set.add(value);return set;}/**
   * A specialized version of `_.forEach` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */function arrayEach(array,iteratee){var index=-1,length=array?array.length:0;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}return array;}/**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}return array;}/**
   * A specialized version of `_.reduce` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the first element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;if(initAccum&&length){accumulator=array[++index];}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}return accumulator;}/**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}return result;}/**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */function getValue(object,key){return object==null?undefined:object[key];}/**
   * Checks if `value` is a host object in IE < 9.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
   */function isHostObject(value){// Many host objects are `Object` objects that can coerce to strings
  // despite having improperly defined `toString` methods.
  var result=false;if(value!=null&&typeof value.toString!='function'){try{result=!!(value+'');}catch(e){}}return result;}/**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value];});return result;}/**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */function overArg(func,transform){return function(arg){return func(transform(arg));};}/**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value;});return result;}/** Used for built-in method references. */var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;/** Used to detect overreaching core-js shims. */var coreJsData=root['__core-js_shared__'];/** Used to detect methods masquerading as native. */var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||'');return uid?'Symbol(src)_1.'+uid:'';}();/** Used to resolve the decompiled source of functions. */var funcToString=funcProto.toString;/** Used to check objects for own properties. */var hasOwnProperty=objectProto.hasOwnProperty;/**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */var objectToString=objectProto.toString;/** Used to detect if a method is native. */var reIsNative=RegExp('^'+funcToString.call(hasOwnProperty).replace(reRegExpChar,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');/** Built-in value references. */var Buffer=moduleExports?root.Buffer:undefined,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeKeys=overArg(Object.keys,Object);/* Built-in method references that are verified to be native. */var DataView=getNative(root,'DataView'),Map=getNative(root,'Map'),Promise=getNative(root,'Promise'),Set=getNative(root,'Set'),WeakMap=getNative(root,'WeakMap'),nativeCreate=getNative(Object,'create');/** Used to detect maps, sets, and weakmaps. */var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);/** Used to convert symbols to primitives and strings. */var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;/**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};}/**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function hashDelete(key){return this.has(key)&&delete this.__data__[key];}/**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result;}return hasOwnProperty.call(data,key)?data[key]:undefined;}/**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key);}/**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this;}// Add methods to `Hash`.
  Hash.prototype.clear=hashClear;Hash.prototype['delete']=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;/**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */function listCacheClear(){this.__data__=[];}/**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false;}var lastIndex=data.length-1;if(index==lastIndex){data.pop();}else{splice.call(data,index,1);}return true;}/**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1];}/**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1;}/**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value]);}else{data[index][1]=value;}return this;}// Add methods to `ListCache`.
  ListCache.prototype.clear=listCacheClear;ListCache.prototype['delete']=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;/**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */function mapCacheClear(){this.__data__={'hash':new Hash(),'map':new(Map||ListCache)(),'string':new Hash()};}/**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function mapCacheDelete(key){return getMapData(this,key)['delete'](key);}/**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function mapCacheGet(key){return getMapData(this,key).get(key);}/**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function mapCacheHas(key){return getMapData(this,key).has(key);}/**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this;}// Add methods to `MapCache`.
  MapCache.prototype.clear=mapCacheClear;MapCache.prototype['delete']=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;/**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Stack(entries){this.__data__=new ListCache(entries);}/**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */function stackClear(){this.__data__=new ListCache();}/**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function stackDelete(key){return this.__data__['delete'](key);}/**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function stackGet(key){return this.__data__.get(key);}/**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function stackHas(key){return this.__data__.has(key);}/**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);return this;}cache=this.__data__=new MapCache(pairs);}cache.set(key,value);return this;}// Add methods to `Stack`.
  Stack.prototype.clear=stackClear;Stack.prototype['delete']=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;/**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */function arrayLikeKeys(value,inherited){// Safari 8.1 makes `arguments.callee` enumerable in strict mode.
  // Safari 9 makes `arguments.length` enumerable in strict mode.
  var result=isArray(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=='length'||isIndex(key,length)))){result.push(key);}}return result;}/**
   * Assigns `value` to `key` of `object` if the existing value is not equivalent
   * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons.
   *
   * @private
   * @param {Object} object The object to modify.
   * @param {string} key The key of the property to assign.
   * @param {*} value The value to assign.
   */function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value;}}/**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length;}}return -1;}/**
   * The base implementation of `_.assign` without support for multiple sources
   * or `customizer` functions.
   *
   * @private
   * @param {Object} object The destination object.
   * @param {Object} source The source object.
   * @returns {Object} Returns `object`.
   */function baseAssign(object,source){return object&&copyObject(source,keys(source),object);}/**
   * The base implementation of `_.clone` and `_.cloneDeep` which tracks
   * traversed objects.
   *
   * @private
   * @param {*} value The value to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @param {boolean} [isFull] Specify a clone including symbols.
   * @param {Function} [customizer] The function to customize cloning.
   * @param {string} [key] The key of `value`.
   * @param {Object} [object] The parent object of `value`.
   * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
   * @returns {*} Returns the cloned value.
   */function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value);}if(result!==undefined){return result;}if(!isObject(value)){return value;}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result);}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep);}if(tag==objectTag||tag==argsTag||isFunc&&!object){if(isHostObject(value)){return object?value:{};}result=initCloneObject(isFunc?{}:value);if(!isDeep){return copySymbols(value,baseAssign(result,value));}}else{if(!cloneableTags[tag]){return object?value:{};}result=initCloneByTag(value,tag,baseClone,isDeep);}}// Check for circular references and return its corresponding clone.
  stack||(stack=new Stack());var stacked=stack.get(value);if(stacked){return stacked;}stack.set(value,result);if(!isArr){var props=isFull?getAllKeys(value):keys(value);}arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key];}// Recursively populate clone (susceptible to call stack limits).
  assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack));});return result;}/**
   * The base implementation of `_.create` without support for assigning
   * properties to the created object.
   *
   * @private
   * @param {Object} prototype The object to inherit from.
   * @returns {Object} Returns the new object.
   */function baseCreate(proto){return isObject(proto)?objectCreate(proto):{};}/**
   * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
   * `keysFunc` and `symbolsFunc` to get the enumerable property names and
   * symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Function} keysFunc The function to get the keys of `object`.
   * @param {Function} symbolsFunc The function to get the symbols of `object`.
   * @returns {Array} Returns the array of property names and symbols.
   */function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object));}/**
   * The base implementation of `getTag`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */function baseGetTag(value){return objectToString.call(value);}/**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false;}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value));}/**
   * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object);}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!='constructor'){result.push(key);}}return result;}/**
   * Creates a clone of  `buffer`.
   *
   * @private
   * @param {Buffer} buffer The buffer to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Buffer} Returns the cloned buffer.
   */function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice();}var result=new buffer.constructor(buffer.length);buffer.copy(result);return result;}/**
   * Creates a clone of `arrayBuffer`.
   *
   * @private
   * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
   * @returns {ArrayBuffer} Returns the cloned array buffer.
   */function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result;}/**
   * Creates a clone of `dataView`.
   *
   * @private
   * @param {Object} dataView The data view to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned data view.
   */function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength);}/**
   * Creates a clone of `map`.
   *
   * @private
   * @param {Object} map The map to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned map.
   */function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),true):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor());}/**
   * Creates a clone of `regexp`.
   *
   * @private
   * @param {Object} regexp The regexp to clone.
   * @returns {Object} Returns the cloned regexp.
   */function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result;}/**
   * Creates a clone of `set`.
   *
   * @private
   * @param {Object} set The set to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned set.
   */function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),true):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor());}/**
   * Creates a clone of the `symbol` object.
   *
   * @private
   * @param {Object} symbol The symbol object to clone.
   * @returns {Object} Returns the cloned symbol object.
   */function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{};}/**
   * Creates a clone of `typedArray`.
   *
   * @private
   * @param {Object} typedArray The typed array to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned typed array.
   */function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length);}/**
   * Copies the values of `source` to `array`.
   *
   * @private
   * @param {Array} source The array to copy values from.
   * @param {Array} [array=[]] The array to copy values to.
   * @returns {Array} Returns `array`.
   */function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}return array;}/**
   * Copies properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy properties from.
   * @param {Array} props The property identifiers to copy.
   * @param {Object} [object={}] The object to copy properties to.
   * @param {Function} [customizer] The function to customize copied values.
   * @returns {Object} Returns `object`.
   */function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue);}return object;}/**
   * Copies own symbol properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy symbols from.
   * @param {Object} [object={}] The object to copy symbols to.
   * @returns {Object} Returns `object`.
   */function copySymbols(source,object){return copyObject(source,getSymbols(source),object);}/**
   * Creates an array of own enumerable property names and symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names and symbols.
   */function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols);}/**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=='string'?'string':'hash']:data.map;}/**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined;}/**
   * Creates an array of the own enumerable symbol properties of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of symbols.
   */var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):stubArray;/**
   * Gets the `toStringTag` of `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */var getTag=baseGetTag;// Fallback for data views, maps, sets, and weak maps in IE 11,
  // for data views in Edge < 14, and promises in Node.js.
  if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map())!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set())!=setTag||WeakMap&&getTag(new WeakMap())!=weakMapTag){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):undefined;if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag;}}return result;};}/**
   * Initializes an array clone.
   *
   * @private
   * @param {Array} array The array to clone.
   * @returns {Array} Returns the initialized clone.
   */function initCloneArray(array){var length=array.length,result=array.constructor(length);// Add properties assigned by `RegExp#exec`.
  if(length&&typeof array[0]=='string'&&hasOwnProperty.call(array,'index')){result.index=array.index;result.input=array.input;}return result;}/**
   * Initializes an object clone.
   *
   * @private
   * @param {Object} object The object to clone.
   * @returns {Object} Returns the initialized clone.
   */function initCloneObject(object){return typeof object.constructor=='function'&&!isPrototype(object)?baseCreate(getPrototype(object)):{};}/**
   * Initializes an object clone based on its `toStringTag`.
   *
   * **Note:** This function only supports cloning values with tags of
   * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
   *
   * @private
   * @param {Object} object The object to clone.
   * @param {string} tag The `toStringTag` of the object to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the initialized clone.
   */function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object);}}/**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return !!length&&(typeof value=='number'||reIsUint.test(value))&&value>-1&&value%1==0&&value<length;}/**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */function isKeyable(value){var type=typeof value;return type=='string'||type=='number'||type=='symbol'||type=='boolean'?value!=='__proto__':value===null;}/**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */function isMasked(func){return !!maskSrcKey&&maskSrcKey in func;}/**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=='function'&&Ctor.prototype||objectProto;return value===proto;}/**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to process.
   * @returns {string} Returns the source code.
   */function toSource(func){if(func!=null){try{return funcToString.call(func);}catch(e){}try{return func+'';}catch(e){}}return '';}/**
   * This method is like `_.clone` except that it recursively clones `value`.
   *
   * @static
   * @memberOf _
   * @since 1.0.0
   * @category Lang
   * @param {*} value The value to recursively clone.
   * @returns {*} Returns the deep cloned value.
   * @see _.clone
   * @example
   *
   * var objects = [{ 'a': 1 }, { 'b': 2 }];
   *
   * var deep = _.cloneDeep(objects);
   * console.log(deep[0] === objects[0]);
   * // => false
   */function cloneDeep(value){return baseClone(value,true,true);}/**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */function eq(value,other){return value===other||value!==value&&other!==other;}/**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */function isArguments(value){// Safari 8.1 makes `arguments.callee` enumerable in strict mode.
  return isArrayLikeObject(value)&&hasOwnProperty.call(value,'callee')&&(!propertyIsEnumerable.call(value,'callee')||objectToString.call(value)==argsTag);}/**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */var isArray=Array.isArray;/**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value);}/**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value);}/**
   * Checks if `value` is a buffer.
   *
   * @static
   * @memberOf _
   * @since 4.3.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
   * @example
   *
   * _.isBuffer(new Buffer(2));
   * // => true
   *
   * _.isBuffer(new Uint8Array(2));
   * // => false
   */var isBuffer=nativeIsBuffer||stubFalse;/**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */function isFunction(value){// The use of `Object#toString` avoids issues with the `typeof` operator
  // in Safari 8-9 which returns 'object' for typed array and other constructors.
  var tag=isObject(value)?objectToString.call(value):'';return tag==funcTag||tag==genTag;}/**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}/**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */function isObject(value){var type=typeof value;return !!value&&(type=='object'||type=='function');}/**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */function isObjectLike(value){return !!value&&typeof value=='object';}/**
   * Creates an array of the own enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects. See the
   * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * for more details.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keys(new Foo);
   * // => ['a', 'b'] (iteration order is not guaranteed)
   *
   * _.keys('hi');
   * // => ['0', '1']
   */function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object);}/**
   * This method returns a new empty array.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {Array} Returns the new empty array.
   * @example
   *
   * var arrays = _.times(2, _.stubArray);
   *
   * console.log(arrays);
   * // => [[], []]
   *
   * console.log(arrays[0] === arrays[1]);
   * // => false
   */function stubArray(){return [];}/**
   * This method returns `false`.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {boolean} Returns `false`.
   * @example
   *
   * _.times(2, _.stubFalse);
   * // => [false, false]
   */function stubFalse(){return false;}module.exports=cloneDeep;});var css$c=".selectTreeRoot {\n  text-align: initial;\n  width: 320px;\n  max-height: inherit;\n  font-size: 14px;\n  line-height: 26px;\n}\n.selectTreeRoot .treeContent {\n  max-height: inherit;\n  overflow: hidden;\n  border: 1px solid #c4c4c4;\n  border-radius: 5px;\n  background-color: #fff;\n  display: flex;\n  flex-direction: column;\n}\n.selectTreeRoot .treeHeader {\n  background-color: #c0c0c0;\n  border-bottom: 1px solid #c4c4c4;\n  color: #303030;\n  padding: 5px;\n  text-align: center;\n}\n.selectTreeRoot .treeHeader .wrapperText {\n  font-weight: bold;\n  padding-bottom: 2px;\n}\n.selectTreeRoot .treeHeader .wrapperSearch {\n  width: 100%;\n}\n.selectTreeRoot .treeHeader .searchIcon {\n  position: absolute;\n  width: 18px;\n  height: 15px;\n  margin: 10px;\n  color: #a3a3a3;\n}\n.selectTreeRoot .treeHeader .searchInput {\n  width: 100%;\n  height: 34px;\n  padding: 6px 12px 6px 35px;\n  background-color: #fff;\n  background-image: none;\n  border: 1px solid #9b9b9b;\n  border-radius: 4px;\n  font-size: 14px;\n  line-height: 1.42857143;\n  color: #555;\n  box-shadow: inset 0 1px 1px rgba(0,0,0,0.075);\n  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n.selectTreeRoot .treeHeader .searchInput:focus {\n  outline: 0;\n  box-shadow: inset 0 1px 1px rgba(0,0,0,0.075), 0 0 8px rgba(102,175,233,0.6);\n}\n.selectTreeRoot .wrapperText {\n  white-space: nowrap;\n  cursor: pointer;\n}\n.selectTreeRoot .selectTreeBreadcrumb .wrapperLabel {\n  cursor: pointer;\n  padding: 0 12px;\n  height: 41px;\n  width: 100%;\n  line-height: 41px;\n}\n.selectTreeRoot .selectTreeBreadcrumb .backIcon {\n  padding-right: 10px;\n}\n.selectTreeRoot .selectTreeBreadcrumb .backIcon svg {\n  width: 14px;\n  height: 14px;\n  position: relative;\n  top: 2px;\n  color: #457fb0;\n}\n.selectTreeRoot .treeOptions {\n  overflow: auto;\n  height: 100%;\n}\n.selectTreeRoot .treeOptions .selectTreeBreadcrumb + .treeInputsWrapper .treeInputs .treeLeaf {\n  border: none;\n  height: initial;\n  line-height: 26px;\n}\n.selectTreeRoot .treeOptions > .treeInputsWrapper > .treeInputs .treeLeaf {\n  border-bottom: 1px solid #ccc;\n  height: 41px;\n  line-height: 41px;\n}\n.selectTreeRoot .treeNode,\n.selectTreeRoot .treeLeaf {\n  cursor: pointer;\n  display: block;\n  overflow: hidden;\n  font-weight: normal;\n  box-shadow: 0 0 0 200px transparent;\n  padding: 0 12px;\n}\n.selectTreeRoot .treeNode {\n  border-bottom: 1px solid #ccc;\n  height: 41px;\n  line-height: 41px;\n}\n.selectTreeRoot .radioLabel .radioInput {\n  display: none;\n}\n";styleInject(css$c);var SelectTree=/*#__PURE__*/function(_Component){_inherits$c(SelectTree,_Component);function SelectTree(props){var _this;_classCallCheck$c(this,SelectTree);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(SelectTree).call(this,props));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"componentDidUpdate",function(){_this.props.onComponentChange();});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"isLeafSelected",function(item){return item&&!Array.isArray(item.items);});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"getLabelClass",function(item){var labelClass='treeLeaf';if(_this.state.searchTerm||Array.isArray(item.items)){labelClass='treeNode';}return labelClass;});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"headerItem",function(){var title=_this.props.selectTreeFirstTitle;if(_this.state.currentNode&&_this.props.selectTreeSecondTitle){title=_this.props.selectTreeSecondTitle;}return React__default.createElement("div",{className:"wrapperLabel treeHeader"},React__default.createElement("div",{className:"wrapperText"},title),_this.props.searchEnabled&&React__default.createElement("div",{className:"wrapperSearch"},React__default.createElement("i",{className:"fa fa-lg fa-search searchIcon"}),React__default.createElement("input",{type:"text",className:"searchInput",placeholder:"Search labels",autoFocus:true,onChange:_this.searchLocations,value:_this.state.searchTerm?_this.state.searchTerm:''})));});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"searchLocations",function(evt){_this.setState({currentNode:null,searchTerm:evt.currentTarget.value});});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onSelected",function(event,item){if(_this.isLeafSelected(item)){_this.setState({searchTerm:null,currentNode:null,value:null});return _this.props.onSelected(event,item);}else{_this.setState({currentNode:item});}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onBreadcrumbSelected",function(){_this.setState({currentNode:null});});_this.state={searchTerm:null,currentNode:null,value:null};return _this;}_createClass$2(SelectTree,[{key:"render",value:function render(){var treeItems=this.getTreeItems();return React__default.createElement("div",{className:"selectTree selectTreeRoot"},React__default.createElement("div",{className:"treeContent"},this.headerItem(),React__default.createElement("div",{className:"treeOptions"},this.state.currentNode&&React__default.createElement(SelectTreeBreadcrumb,{onSelected:this.onBreadcrumbSelected,label:this.state.currentNode.label,value:this.state.currentNode.value}),React__default.createElement("div",{className:"treeInputsWrapper"},React__default.createElement("div",{className:"treeInputs"},treeItems)))));}},{key:"getTreeItems",value:function getTreeItems(){var _this2=this;var storageKey='SelectTree';var treeItems;if(this.state.searchTerm){var filteredItems=[];var rawItems=lodash_clonedeep$1(this.props.items);rawItems.forEach(function(item){if(Array.isArray(item.items)){item.items.forEach(function(item){var label=item.label.toLowerCase();var searchTerm=_this2.state.searchTerm.toLowerCase();if(label.indexOf(searchTerm)!==-1){filteredItems.push(item);}});}});treeItems=filteredItems;}else if(this.state.currentNode){treeItems=lodash_clonedeep$1(this.state.currentNode.items);}else{treeItems=lodash_clonedeep$1(this.props.items);}return treeItems.map(function(item,index){var itemKey=index;if(_this2.state.currentNode){itemKey+="_".concat(_this2.state.currentNode.value);}return React__default.createElement(InputRadio,{key:itemKey,id:"".concat(storageKey,"_").concat(item.value),name:index,itemData:item,value:item.value,label:item.label,labelClass:_this2.getLabelClass(item),onSelected:_this2.onSelected});});}}]);return SelectTree;}(React.Component);_defineProperty$3(SelectTree,"defaultProps",{searchEnabled:true,selectTreeFirstTitle:'First Level itens',items:[]});SelectTree.propTypes={searchEnabled:propTypes$1.bool,selectTreeFirstTitle:propTypes$1.string,selectTreeSecondTitle:propTypes$1.string,onComponentChange:propTypes$1.func,items:propTypes$1.array.isRequired,onSelected:propTypes$1.func.isRequired};var css$d=".simpleDialog {\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  z-index: 1000;\n  border: 0;\n  border-radius: 6px;\n  background-color: var(--ui-gray-darker);\n}\n.simpleDialog .header {\n  border-bottom: 3px solid var(--primary-background-color);\n  padding: 19px 22px 17px;\n  position: relative;\n}\n.simpleDialog .header .title {\n  font-size: 20px;\n  font-weight: 600;\n  line-height: 24px;\n  padding-right: 40px;\n  color: var(--text-secondary-color);\n  margin: 0;\n}\n.simpleDialog .header .closeBtn {\n  -webkit-transform: translateY(-50%);\n  color: var(--text-secondary-color);\n  height: 20px;\n  opacity: 1;\n  overflow: hidden;\n  padding: 2px;\n  position: absolute;\n  right: 21px;\n  text-align: center;\n  text-shadow: none;\n  top: 50%;\n  transform: translateY(-50%);\n  transition: color 0.3s ease;\n  width: 20px;\n}\n.simpleDialog .header .closeIcon {\n  color: transparent;\n  display: block;\n  font-size: 0;\n  height: 100%;\n  line-height: 0;\n  overflow: hidden;\n  position: relative;\n  width: 100%;\n}\n.simpleDialog .header .closeIcon:after,\n.simpleDialog .header .closeIcon:before {\n  content: ' ';\n  display: block;\n  height: 2px;\n  transition: background-color 0.3s ease;\n  width: 19px;\n  background-color: var(--text-secondary-color);\n}\n.simpleDialog .header .closeIcon:before {\n  left: 1px;\n  position: absolute;\n  top: 1px;\n  -webkit-transform: rotate(45deg);\n  transform: rotate(45deg);\n  -webkit-transform-origin: 1px 50%;\n  transform-origin: 1px 50%;\n}\n.simpleDialog .header .closeIcon:after {\n  right: 1px;\n  position: absolute;\n  top: 1px;\n  -webkit-transform: rotate(-45deg);\n  transform: rotate(-45deg);\n  -webkit-transform-origin: calc(100% - 1px) 50%;\n  transform-origin: calc(100% - 1px) 50%;\n}\n.simpleDialog .content {\n  padding: 16px 22px 25px;\n  position: relative;\n  color: var(--text-primary-color);\n}\n.simpleDialog .content .simpleDialogSelect,\n.simpleDialog .content .simpleDialogInput {\n  background-color: var(--input-background-color);\n  color: var(--text-primary-color);\n  border: 0;\n  border-radius: 2px;\n  font-size: 14px;\n  height: 30px;\n  width: 100%;\n  line-height: 16px;\n  padding: 8px 9px 6px;\n  margin-top: 10px;\n  display: block;\n}\n.simpleDialog .content .simpleDialogLabelFor {\n  font-size: 14px;\n  font-weight: 700;\n  line-height: 16px;\n  margin: 10px 0 0 0;\n  color: var(--text-primary-color);\n}\n.simpleDialog .footer {\n  padding: 15px;\n  text-align: right;\n}\n.simpleDialog .footer .btn {\n  margin-left: 5px;\n}\n";styleInject(css$d);var SimpleDialog=/*#__PURE__*/function(_Component){_inherits$c(SimpleDialog,_Component);function SimpleDialog(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,SimpleDialog);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(SimpleDialog)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClose",function(event){event.preventDefault();event.stopPropagation();_this.props.onClose();});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onConfirm",function(event){event.preventDefault();event.stopPropagation();_this.props.onConfirm();});return _this;}_createClass$2(SimpleDialog,[{key:"render",value:function render(){return React__default.createElement(React__default.Fragment,null,this.props.isOpen&&React__default.createElement("div",{className:"simpleDialog ".concat(this.props.rootClass," "),ref:this.props.componentRef,style:this.props.componentStyle},React__default.createElement("form",null,React__default.createElement("div",{className:"header"},React__default.createElement("span",{className:"closeBtn",onClick:this.onClose},React__default.createElement("span",{className:"closeIcon"},"x")),React__default.createElement("h4",{className:"title"},this.props.headerTitle)),React__default.createElement("div",{className:"content"},this.props.children),React__default.createElement("div",{className:"footer"},React__default.createElement("button",{className:"btn btn-default",onClick:this.onClose},"Cancel"),React__default.createElement("button",{className:"btn btn-primary",onClick:this.onConfirm},"Confirm")))));}}]);return SimpleDialog;}(React.Component);_defineProperty$3(SimpleDialog,"defaultProps",{isOpen:true,componentStyle:{},rootClass:''});SimpleDialog.propTypes={headerTitle:propTypes$1.string.isRequired,onClose:propTypes$1.func.isRequired,onConfirm:propTypes$1.func.isRequired};function ViewportLoadingIndicator(props){return React__default.createElement("div",{className:"loadingIndicator",style:{position:'absolute',top:0,left:0,right:0,bottom:0,margin:'auto',textAlign:'center',pointerEvents:'none'}},"Loading ",props.percentComplete);}ViewportLoadingIndicator.propTypes={percentComplete:propTypes$1.number};function ViewportErrorIndicator(props){return React__default.createElement("div",{className:"loadingIndicator",style:{position:'absolute',top:0,left:0,right:0,bottom:0,margin:'auto',textAlign:'center',pointerEvents:'none'}},React__default.createElement("p",null,"Error"),React__default.createElement("p",{className:"description"},"An error has occurred."),React__default.createElement("p",{className:"details"},props.details));}ViewportErrorIndicator.propTypes={details:propTypes$1.string};var css$e=":root {\n  --text-secondary-color: #91b9cd;\n  --active-color: #20a5d6;\n  --primary-background-color: #000;\n  --ui-border-color-dark: #3c5d80;\n  --sidebar-transition: all 0.3s ease;\n}\n.ThumbnailEntry.active .ImageThumbnail {\n  border-color: var(--active-color);\n  box-shadow: none;\n  transition: var(--sidebar-transition);\n}\n.ImageThumbnail {\n  background-color: var(--primary-background-color);\n  box-shadow: inset 0 0 0 1px var(--ui-border-color-dark);\n  border: 5px solid transparent;\n  border-radius: 12px;\n  height: 135px;\n  margin: 0 auto;\n  padding: 5px;\n  position: relative;\n  transition: var(--sidebar-transition);\n  width: 217px;\n  -moz-background-clip: padding;\n  -webkit-background-clip: padding;\n  background-clip: padding-box;\n}\n.image-thumbnail-canvas {\n  height: 100%;\n  overflow: hidden;\n  display: flex;\n  justify-content: center;\n}\n.image-thumbnail-canvas img {\n  -webkit-user-drag: none;\n}\n.thumbnailLoadingIndicator {\n  display: none;\n  pointer-events: none;\n  color: var(--text-secondary-color);\n  height: 20px;\n  width: 100%;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  margin: auto;\n  position: absolute;\n}\n.thumbnailLoadingIndicator.d-block {\n  display: block;\n}\n.thumbnailLoadingIndicator p {\n  text-align: center;\n  font-size: 10pt;\n}\n.image-thumbnail-progress-bar {\n  position: relative;\n  width: 100%;\n  height: 3px;\n  top: -5px;\n}\n.image-thumbnail-progress-bar .image-thumbnail-progress-bar-inner {\n  height: 100%;\n  width: 0;\n  border-radius: 5px;\n  background-color: var(--active-color);\n}\n";styleInject(css$e);// - Passed in as a prop?
  // - Set as external dependency?
  // - Pass in the entire load and render function as a prop?
  //import cornerstone from 'cornerstone-core';
  /**
   * Asynchronous wrapper around Cornerstone's renderToCanvas method.
   *
   * @param {HTMLElement} canvasElement An HTML <canvas> element
   * @param {Image} image A Cornerstone Image
   *
   * @return {Promise} A promise tracking the progress of the rendering. Resolves empty.
   */function renderAsync(canvasElement,image){return new Promise(function(resolve,reject){try{cornerstone.renderToCanvas(canvasElement,image);resolve();}catch(error){reject(error);}});}var ImageThumbnail=/*#__PURE__*/function(_PureComponent){_inherits$c(ImageThumbnail,_PureComponent);function ImageThumbnail(props){var _this;_classCallCheck$c(this,ImageThumbnail);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(ImageThumbnail).call(this,props));_this.canvas=React__default.createRef();var renderIntoCanvas=_this.props.imageId&&!_this.props.imageSrc;_this.state={loading:renderIntoCanvas};return _this;}_createClass$2(ImageThumbnail,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var renderIntoCanvas=this.props.imageId&&!this.props.imageSrc;if(renderIntoCanvas){var imageId=this.props.imageId;var canvas=this.canvas.current;cornerstone.loadAndCacheImage(imageId).then(function(image){renderAsync(canvas,image).then(function(){_this2.setState({loading:false});},function(error){// TODO: Set state?
  throw new Error(error);});},function(error){// TODO: Set state?
  throw new Error(error);});}}},{key:"render",value:function render(){var loadingOrError;if(this.props.error){loadingOrError=React__default.createElement(ViewportErrorIndicator,null);}else if(this.state.loading){loadingOrError=React__default.createElement(ViewportLoadingIndicator,null);}var showStackLoadingProgressBar=this.props.stackPercentComplete!==undefined;var renderIntoCanvas=this.props.imageId&&!this.props.imageSrc;return React__default.createElement("div",{className:"ImageThumbnail"},React__default.createElement("div",{className:"image-thumbnail-canvas"},renderIntoCanvas?React__default.createElement("canvas",{ref:this.canvas,width:this.props.width,height:this.props.height}):React__default.createElement("img",{className:"static-image",src:this.props.imageSrc//width={this.props.width}
  ,height:this.props.height,alt:''})),loadingOrError,showStackLoadingProgressBar&&React__default.createElement("div",{className:"image-thumbnail-progress-bar"},React__default.createElement("div",{className:"image-thumbnail-progress-bar-inner",style:{width:"".concat(this.props.stackPercentComplete,"%")}})));}}]);return ImageThumbnail;}(React.PureComponent);_defineProperty$3(ImageThumbnail,"propTypes",{imageSrc:propTypes$1.string,imageId:propTypes$1.string,error:propTypes$1.bool.isRequired,width:propTypes$1.number.isRequired,height:propTypes$1.number.isRequired,stackPercentComplete:propTypes$1.number.isRequired});_defineProperty$3(ImageThumbnail,"defaultProps",{error:false,stackPercentComplete:0,width:217,height:123});var css$f=":root {\n  --series-count-background-color: #678696;\n  --text-primary-color: #fff;\n  --text-secondary-color: #91b9cd;\n  --active-color: #20a5d6;\n}\n.ThumbnailEntry {\n  cursor: pointer;\n  display: table;\n}\n.ThumbnailEntry .p-x-1 {\n  padding: 0 1rem;\n}\n.ThumbnailEntry .series-details {\n  display: flex;\n  flex-direction: row;\n  color: var(--text-primary-color);\n  font-size: 14px;\n  line-height: 1.3em;\n  margin-top: 5px;\n  margin-left: 1rem;\n  margin-right: 1rem;\n  max-width: 217px;\n  min-height: 36px;\n  position: relative;\n  word-wrap: break-word;\n}\n.ThumbnailEntry .series-details .series-description {\n  flex-grow: 1;\n}\n.ThumbnailEntry .series-details.info-only .series-description {\n  display: none;\n}\n.ThumbnailEntry .series-details.info-only .series-information {\n  display: flex;\n  flex-grow: 1;\n  float: none;\n  max-width: none;\n  padding-right: 0;\n}\n.ThumbnailEntry .series-details.info-only .series-information .item {\n  flex: 1;\n  text-align: center;\n}\n.ThumbnailEntry .series-details.info-only .series-information .item .icon,\n.ThumbnailEntry .series-details.info-only .series-information .item .value {\n  display: inline;\n  float: none;\n  line-height: 25px;\n}\n.ThumbnailEntry .series-details.info-only .series-information .item .value {\n  margin-left: 0;\n  width: auto;\n}\n.ThumbnailEntry .series-information {\n  padding-right: 4px;\n  max-width: 50px;\n}\n.ThumbnailEntry .series-information .item-frames .icon {\n  height: 18px;\n}\n.ThumbnailEntry .series-information .value {\n  color: var(--text-secondary-color);\n  display: inline-block;\n  float: right;\n  font-size: 12px;\n  margin-left: 4px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  width: calc(100% - 15px);\n}\n.ThumbnailEntry .series-information .icon {\n  color: var(--active-color);\n  display: inline-block;\n  float: left;\n  font-size: 10px;\n  font-weight: 900;\n  text-align: right;\n  width: 11px;\n}\n.ThumbnailEntry .series-information .icon div {\n  background-color: var(--series-count-background-color);\n  margin-top: 6px;\n  position: relative;\n}\n.ThumbnailEntry .series-information .icon div:after {\n  background-color: var(--active-color);\n  box-shadow: 1px 1px rgba(0,0,0,0.115);\n  left: -5px;\n  position: absolute;\n  top: -5px;\n}\n.ThumbnailEntry .series-information .icon div,\n.ThumbnailEntry .series-information .icon div:after {\n  border: 1px solid var(--series-count-background-color);\n  content: '';\n  display: inline-block;\n  height: 11px;\n  width: 11px;\n}\n.image-thumbnail-clone {\n  z-index: 100000;\n  pointer-events: none;\n}\n.image-thumbnail-clone:hover {\n  border-color: var(--hover-color);\n  box-shadow: none;\n}\n";styleInject(css$f);var ThumbnailEntry=/*#__PURE__*/function(_Component){_inherits$c(ThumbnailEntry,_Component);function ThumbnailEntry(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,ThumbnailEntry);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(ThumbnailEntry)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onClick",function(){if(_this.props.onClick){_this.props.onClick();}});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onDoubleClick",function(){if(_this.props.onDoubleClick){_this.props.onDoubleClick();}});return _this;}_createClass$2(ThumbnailEntry,[{key:"render",value:function render(){var hasInstanceNumber=this.props.instanceNumber!==undefined;var className=classnames('ThumbnailEntry noselect',{active:this.props.active});return React__default.createElement("div",{className:className,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:this.onMouseDown},React__default.createElement("div",{className:"p-x-1"},React__default.createElement(ImageThumbnail,{imageSrc:this.props.imageSrc,imageId:this.props.imageId,error:this.props.error,stackPercentComplete:this.props.stackPercentComplete})),React__default.createElement("div",{className:'series-details'},React__default.createElement("div",{className:"series-description"},this.props.seriesDescription),React__default.createElement("div",{className:"series-information"},React__default.createElement("div",{className:"item item-series clearfix"},React__default.createElement("div",{className:"icon"},"S:"),React__default.createElement("div",{className:"value"},this.props.seriesNumber)),hasInstanceNumber&&React__default.createElement("div",{className:"item item-series clearfix"},React__default.createElement("div",{className:"icon"},"I:"),React__default.createElement("div",{className:"value"},this.props.instanceNumber)),React__default.createElement("div",{className:"item item-frames clearfix"},React__default.createElement("div",{className:"icon"},React__default.createElement("div",null)),React__default.createElement("div",{className:"value"},this.props.numImageFrames)))));}}]);return ThumbnailEntry;}(React.Component);_defineProperty$3(ThumbnailEntry,"defaultProps",{active:false,error:false,stackPercentComplete:0});_defineProperty$3(ThumbnailEntry,"propTypes",{id:propTypes$1.string.isRequired,imageSrc:propTypes$1.string,imageId:propTypes$1.string,error:propTypes$1.bool.isRequired,active:propTypes$1.bool.isRequired,stackPercentComplete:propTypes$1.number,seriesDescription:propTypes$1.string,seriesNumber:propTypes$1.string,instanceNumber:propTypes$1.string,numImageFrames:propTypes$1.number,onDoubleClick:propTypes$1.func,onClick:propTypes$1.func});// if they have the same string type.
  var Types$2={THUMBNAIL:'thumbnail'};var thumbnailSource={/*canDrag(props) {
      return props.error === false;
    },*/beginDrag:function beginDrag(props){return props;},endDrag:function endDrag(props,monitor){//const item = monitor.getItem();
  var dropResult=monitor.getDropResult();}};var ThumbnailEntryDragSource=/*#__PURE__*/function(_Component){_inherits$c(ThumbnailEntryDragSource,_Component);function ThumbnailEntryDragSource(){_classCallCheck$c(this,ThumbnailEntryDragSource);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(ThumbnailEntryDragSource).apply(this,arguments));}_createClass$2(ThumbnailEntryDragSource,[{key:"render",value:function render(){var connectDragSource=this.props.connectDragSource;var dropEffect='copy';return connectDragSource(React__default.createElement("div",{className:"ThumbnailEntryContainer"},React__default.createElement(ThumbnailEntry,this.props)),{dropEffect:dropEffect});}}]);return ThumbnailEntryDragSource;}(React.Component);_defineProperty$3(ThumbnailEntryDragSource,"propTypes",{connectDragSource:propTypes$1.func.isRequired,isDragging:propTypes$1.bool.isRequired});_defineProperty$3(ThumbnailEntryDragSource,"defaultProps",{isDragging:false});var collect$2=function collect(connect,monitor){return {connectDragSource:connect.dragSource(),isDragging:monitor.isDragging()};};var ThumbnailEntryDragSource$1=lib_4(Types$2.THUMBNAIL,thumbnailSource,collect$2)(ThumbnailEntryDragSource);var css$g=".StudyBrowser {\n  float: left;\n  height: 100%;\n  width: 100%;\n  overflow: hidden;\n  background-color: #000;\n  padding-bottom: 20px;\n}\n.StudyBrowser .scrollable-study-thumbnails {\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding-bottom: 50px;\n  padding-right: 16px;\n  padding-left: 4px;\n  margin-right: -16px;\n  display: flex;\n  flex-direction: column;\n}\n.StudyBrowser .scrollable-study-thumbnails::-webkit-scrollbar {\n  display: none;\n}\n.StudyBrowser .scrollable-study-thumbnails .ThumbnailEntryContainer {\n  margin: 0 auto;\n  padding-top: 1rem;\n  padding-bottom: 1.5rem;\n}\n.draggable {\n  cursor: copy;\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n}\n";styleInject(css$g);var StudyBrowser=/*#__PURE__*/function(_Component){_inherits$c(StudyBrowser,_Component);function StudyBrowser(){_classCallCheck$c(this,StudyBrowser);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(StudyBrowser).apply(this,arguments));}_createClass$2(StudyBrowser,[{key:"render",value:function render(){var _this=this;var studies=this.props.studies;var thumbnails=studies.map(function(study,studyIndex){return study.thumbnails.map(function(thumb,thumbIndex){if(_this.props.supportsDragAndDrop){return React__default.createElement(ThumbnailEntryDragSource$1,_extends$c({key:"".concat(studyIndex,"_").concat(thumbIndex)},study,thumb,{id:"".concat(studyIndex,"_").concat(thumbIndex),onClick:_this.props.onThumbnailClick,onDoubleClick:_this.props.onThumbnailDoubleClick}));}else{return React__default.createElement("div",{className:"ThumbnailEntryContainer"},React__default.createElement(ThumbnailEntry,_extends$c({key:"".concat(studyIndex,"_").concat(thumbIndex)},study,thumb,{id:"".concat(studyIndex,"_").concat(thumbIndex),onClick:_this.props.onThumbnailClick,onDoubleClick:_this.props.onThumbnailDoubleClick})));}});});var components=thumbnails.flat();return React__default.createElement("div",{className:"StudyBrowser"},React__default.createElement("div",{className:"scrollable-study-thumbnails"},components));}}]);return StudyBrowser;}(React.Component);_defineProperty$3(StudyBrowser,"defaultProps",{studies:[],supportsDragAndDrop:true});_defineProperty$3(StudyBrowser,"propTypes",{studies:propTypes$1.array.isRequired,supportsDragAndDrop:propTypes$1.bool.isRequired,onThumbnailClick:propTypes$1.func,onThumbnailDoubleClick:propTypes$1.func});var runtime$1=createCommonjsModule$2(function(module){/**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */!function(global){var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;// More compressible than void 0.
  var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";var runtime=global.regeneratorRuntime;if(runtime){{// If regeneratorRuntime is defined globally and we're in a module,
  // make the exports object identical to regeneratorRuntime.
  module.exports=runtime;}// Don't bother evaluating the rest of this file if the runtime was
  // already defined globally.
  return;}// Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime=global.regeneratorRuntime=module.exports;function wrap(innerFn,outerFn,self,tryLocsList){// If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
  var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);// The ._invoke method unifies the implementations of the .next,
  // .throw, and .return methods.
  generator._invoke=makeInvokeMethod(innerFn,self,context);return generator;}runtime.wrap=wrap;// Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn,obj,arg){try{return {type:"normal",arg:fn.call(obj,arg)};}catch(err){return {type:"throw",arg:err};}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";// Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel={};// Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}// This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this;};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){// This environment has a native %IteratorPrototype%; use it instead
  // of the polyfill.
  IteratorPrototype=NativeIteratorPrototype;}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction";// Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg);};});}runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||// For the native GeneratorFunction constructor, the best we can
  // do is to check its .name property.
  (ctor.displayName||ctor.name)==="GeneratorFunction":false;};runtime.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype);}else{genFun.__proto__=GeneratorFunctionPrototype;if(!(toStringTagSymbol in genFun)){genFun[toStringTagSymbol]="GeneratorFunction";}}genFun.prototype=Object.create(Gp);return genFun;};// Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  runtime.awrap=function(arg){return {__await:arg};};function AsyncIterator(generator){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg);}else{var result=record.arg;var value=result.value;if(value&&typeof value==="object"&&hasOwn.call(value,"__await")){return Promise.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);});}return Promise.resolve(value).then(function(unwrapped){// When a yielded Promise is resolved, its final value becomes
  // the .value of the Promise<{value,done}> result for the
  // current iteration.
  result.value=unwrapped;resolve(result);},function(error){// If a rejected Promise was yielded, throw the rejection back
  // into the async generator function so it can be handled there.
  return invoke("throw",error,resolve,reject);});}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=// If enqueue has been called before, then we want to wait until
  // all previous Promises have been resolved before calling invoke,
  // so that results are always delivered in the correct order. If
  // enqueue has not been called before, then it is important to
  // call invoke immediately, without waiting on a callback to fire,
  // so that the async generator function has the opportunity to do
  // any necessary setup in a predictable way. This predictability
  // is why the Promise constructor synchronously invokes its
  // executor callback, and why async functions synchronously
  // execute code before the first await. Since we implement simple
  // async functions in terms of async generators, it is especially
  // important to get this right, even though it requires care.
  previousPromise?previousPromise.then(callInvokeWithMethodAndArg,// Avoid propagating failures to Promises returned by later
  // invocations of the iterator.
  callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}// Define the unified helper method that is used to implement .next,
  // .throw, and .return (see defineIteratorMethods).
  this._invoke=enqueue;}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this;};runtime.AsyncIterator=AsyncIterator;// Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter// If outerFn is a generator, return the full iterator.
  :iter.next().then(function(result){return result.done?result.value:iter.next();});};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running");}if(state===GenStateCompleted){if(method==="throw"){throw arg;}// Be forgiving, per 25.3.3.3.3 of the spec:
  // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
  return doneResult();}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if(context.method==="next"){// Setting context._sent for legacy support of Babel's
  // function.sent implementation.
  context.sent=context._sent=context.arg;}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg;}context.dispatchException(context.arg);}else if(context.method==="return"){context.abrupt("return",context.arg);}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){// If an exception is thrown from innerFn, we leave state ===
  // GenStateExecuting and loop back for another invocation.
  state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue;}return {value:record.arg,done:context.done};}else if(record.type==="throw"){state=GenStateCompleted;// Dispatch the exception by looping back around to the
  // context.dispatchException(context.arg) call above.
  context.method="throw";context.arg=record.arg;}}};}// Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){// A .throw or .return when the delegate iterator has no .throw
  // method always terminates the yield* loop.
  context.delegate=null;if(context.method==="throw"){if(delegate.iterator.return){// If the delegate iterator has a return method, give it a
  // chance to clean up.
  context.method="return";context.arg=undefined;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){// If maybeInvokeDelegate(context) changed context.method from
  // "return" to "throw", let that override the TypeError below.
  return ContinueSentinel;}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method");}return ContinueSentinel;}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel;}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel;}if(info.done){// Assign the result of the finished delegate to the temporary
  // variable specified by delegate.resultName (see delegateYield).
  context[delegate.resultName]=info.value;// Resume execution at the desired location (see delegateYield).
  context.next=delegate.nextLoc;// If context.method was "throw" but the delegate handled the
  // exception, let the outer generator proceed normally. If
  // context.method was "next", forget context.arg since it has been
  // "consumed" by the delegate iterator. If context.method was
  // "return", allow the original .return call to continue in the
  // outer generator.
  if(context.method!=="return"){context.method="next";context.arg=undefined;}}else{// Re-yield the result returned by the delegate method.
  return info;}// The delegate iterator is finished, so forget it and continue with
  // the outer generator.
  context.delegate=null;return ContinueSentinel;}// Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);Gp[toStringTagSymbol]="Generator";// A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol]=function(){return this;};Gp.toString=function(){return "[object Generator]";};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1];}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3];}this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record;}function Context(tryLocsList){// The root entry object (effectively a try statement without a catch
  // or a finally block) gives us a place to store values thrown from
  // locations where there is no enclosing try statement.
  this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true);}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key);}keys.reverse();// Rather than returning an object with a next method, we keep
  // things simple and return the next function itself.
  return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next;}}// To avoid creating an additional object, we just hang the .value
  // and .done properties off the next function object itself. This
  // also ensures that the minifier will not anonymize the function.
  next.done=true;return next;};};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable);}if(typeof iterable.next==="function"){return iterable;}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next;}}next.value=undefined;next.done=true;return next;};return next.next=next;}}// Return an iterator with no values.
  return {next:doneResult};}runtime.values=values;function doneResult(){return {value:undefined,done:true};}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;// Resetting context._sent for legacy support of Babel's
  // function.sent implementation.
  this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.method="next";this.arg=undefined;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){// Not sure about the optimal order of these conditions:
  if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined;}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg;}return this.rval;},dispatchException:function(exception){if(this.done){throw exception;}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){// If the dispatched exception was caught by a catch block,
  // then let that catch block handle the exception normally.
  context.method="next";context.arg=undefined;}return !!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){// Exception thrown outside of any try block that could handle
  // it, so set the completion value of the entire function to
  // throw the exception.
  return handle("end");}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else{throw new Error("try statement without catch or finally");}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){// Ignore the finally entry if control is not jumping to a
  // location outside the try/catch block.
  finallyEntry=null;}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel;}return this.complete(record);},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg;}if(record.type==="break"||record.type==="continue"){this.next=record.arg;}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end";}else if(record.type==="normal"&&afterLoc){this.next=afterLoc;}return ContinueSentinel;},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel;}}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}// The context.catch method must only be called with a location
  // argument that corresponds to a known catch block.
  throw new Error("illegal catch attempt");},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){// Deliberately forget the last sent value so that we don't
  // accidentally pass it on to the delegate.
  this.arg=undefined;}return ContinueSentinel;}};}(// In sloppy mode, unbound `this` refers to the global object, fallback to
  // Function constructor if we're in global strict mode. That is sadly a form
  // of indirect eval which violates Content Security Policy.
  function(){return this||typeof self==="object"&&self;}()||Function("return this")());});/**
   * Copyright (c) 2014-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */ // This method of obtaining a reference to the global object needs to be
  // kept identical to the way it is obtained in runtime.js
  var g$1=function(){return this||typeof self==="object"&&self;}()||Function("return this")();// Use `getOwnPropertyNames` because not all browsers support calling
  // `hasOwnProperty` on the global `self` object in a worker. See #183.
  var hadRuntime$1=g$1.regeneratorRuntime&&Object.getOwnPropertyNames(g$1).indexOf("regeneratorRuntime")>=0;// Save the old regeneratorRuntime in case it needs to be restored later.
  var oldRuntime$1=hadRuntime$1&&g$1.regeneratorRuntime;// Force reevalutation of runtime.js.
  g$1.regeneratorRuntime=undefined;var runtimeModule$1=runtime$1;if(hadRuntime$1){// Restore the original runtime.
  g$1.regeneratorRuntime=oldRuntime$1;}else{// Remove the global property added by runtime.js.
  try{delete g$1.regeneratorRuntime;}catch(e){g$1.regeneratorRuntime=undefined;}}var regenerator$1=runtimeModule$1;var css$h=".studyListToolbar {\n  background-color: var(--ui-gray-darker);\n  height: 75px;\n  margin-bottom: 2px;\n  padding: 0 8%;\n}\n.studyListToolbar>div {\n  display: inline-block;\n}\n.studyListToolbar .header {\n  font-size: 22px;\n  font-weight: 300;\n  color: var(--table-text-secondary-color);\n  line-height: 75px;\n}\n.studyListToolbar .studylistToolbar {\n  height: 75px;\n  line-height: 75px;\n}\n.studyListToolbar .studyCount {\n  color: var(--large-numbers-color);\n  font-size: 40px;\n  font-weight: 100;\n  line-height: 75px;\n}\n.theadBackground {\n  height: 121px;\n  position: absolute;\n  width: 100%;\n}\n.theadBackground:before,\n.theadBackground:after {\n  content: '';\n  display: block;\n  left: 0;\n  position: absolute;\n  width: 100%;\n}\n.theadBackground:before {\n  background-color: var(--ui-gray-darker);\n  height: 100%;\n  top: 0;\n  z-index: 1;\n}\n.theadBackground:after {\n  background-color: var(--large-numbers-color);\n  bottom: -1px;\n  height: 1px;\n  z-index: 3;\n}\n#studyListContainer {\n  width: 100%;\n  padding: 0 8%;\n  position: absolute;\n  z-index: 2;\n}\n#studyListContainer .loadingTextDiv {\n  color: var(--table-text-secondary-color);\n  font-size: 30px;\n}\n#studyListContainer .notFound {\n  color: var(--table-text-secondary-color);\n  font-size: 30px;\n  font-weight: 200;\n  text-align: center;\n}\n#studyListContainer table#tblStudyList tr {\n  height: 20px;\n}\n#studyListContainer table#tblStudyList thead {\n  white-space: nowrap;\n}\n#studyListContainer table#tblStudyList thead tr th {\n  padding: 0;\n  border-bottom: solid 1px var(--ui-border-color-active);\n  width: 100%;\n}\n#studyListContainer table#tblStudyList thead tr th.studyDate {\n  min-width: 230px;\n}\n#studyListContainer table#tblStudyList thead tr th div.sortingCell {\n  display: inline-block;\n  cursor: pointer;\n  width: 100%;\n  min-width: 95px;\n  margin: 0 auto;\n  color: var(--table-text-primary-color);\n  font-weight: 400;\n  padding: 20px;\n}\n#studyListContainer table#tblStudyList thead tr th div.sortingCell span {\n  font-size: 15px;\n  float: left;\n}\n#studyListContainer table#tblStudyList thead tr th div.sortingCell i {\n  margin: 0 5px;\n}\n#studyListContainer table#tblStudyList thead tr th div.sortingCell:hover {\n  color: var(--active-color);\n}\n#studyListContainer table#tblStudyList thead tr th div.sortingCell.active,\n#studyListContainer table#tblStudyList thead tr th div.sortingCell:active {\n  color: var(--active-color);\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search {\n  height: 40px;\n  margin: 0 5px 20px 5px;\n  padding: 0 20px;\n  cursor: pointer;\n  border: none;\n  background-color: var(--input-background-color);\n  color: var(--input-placeholder-color);\n  font-size: 10pt;\n  font-weight: normal;\n  width: calc(100% - 10px);\n  border-radius: 4px;\n  box-sizing: border-box;\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search::-webkit-input-placeholder {\n  color: var(--input-placeholder-color);\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search:-moz-placeholder {\n  color: var(--input-placeholder-color);\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search::-moz-placeholder {\n  color: var(--input-placeholder-color);\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search:-ms-input-placeholder {\n  color: var(--input-placeholder-color);\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search.invisible {\n  visibility: hidden;\n}\n#studyListContainer table#tblStudyList thead tr th input.studylist-search:active,\n#studyListContainer table#tblStudyList thead tr th input.studylist-search:hover {\n  background-color: var(--input-background-color);\n}\n#studyListContainer table#tblStudyList thead ::-webkit-datetime-edit-year-field:not([aria-valuenow]),\n#studyListContainer table#tblStudyList thead ::-webkit-datetime-edit-month-field:not([aria-valuenow]),\n#studyListContainer table#tblStudyList thead ::-webkit-datetime-edit-day-field:not([aria-valuenow]) {\n  color: transparent;\n}\n#studyListContainer table#tblStudyList tbody tr {\n  padding: 5px;\n  background-color: #000;\n}\n#studyListContainer table#tblStudyList tbody tr:nth-child(even) {\n  background-color: var(--ui-gray-darker);\n}\n#studyListContainer table#tblStudyList tbody tr td {\n  height: 40px;\n  line-height: 40px;\n  color: var(--table-text-primary-color);\n  font-weight: 300;\n  border-top: 1px solid var(--ui-border-color-active);\n  border-bottom: 1px solid var(--ui-border-color-active);\n  white-space: nowrap;\n}\n#studyListContainer table#tblStudyList tbody tr td.emptyValue {\n  color: var(--ui-gray-light);\n}\n#studyListContainer table#tblStudyList tbody tr:hover,\n#studyListContainer table#tblStudyList tbody tr:active,\n#studyListContainer table#tblStudyList tbody tr.active {\n  background-color: var(--table-hover-color);\n  color: var(--text-primary-color);\n}\n#studyListContainer table#tblStudyList tbody tr:hover td,\n#studyListContainer table#tblStudyList tbody tr:active td,\n#studyListContainer table#tblStudyList tbody tr.active td {\n  border-top: 1px solid var(--ui-border-color-active);\n  border-bottom: 1px solid var(--ui-border-color-active);\n  background-color: var(--table-hover-color);\n}\n@media only screen and (max-width: 1362px) {\n  #studyListContainer {\n    padding: 0 5%;\n  }\n  #studyListContainer table#tblStudyList thead tr th:first-child,\n  #studyListContainer table#tblStudyList tbody tr th:first-child,\n  #studyListContainer table#tblStudyList thead tr td:first-child,\n  #studyListContainer table#tblStudyList tbody tr td:first-child {\n    padding-left: 5%;\n  }\n  #studyListContainer table#tblStudyList thead tr th:last-child,\n  #studyListContainer table#tblStudyList tbody tr th:last-child,\n  #studyListContainer table#tblStudyList thead tr td:last-child,\n  #studyListContainer table#tblStudyList tbody tr td:last-child {\n    padding-right: 5%;\n  }\n}\n@media only screen and (max-width: 1161px) {\n  #studyListContainer {\n    padding: 0 $tablePaddingBigWidth;\n  }\n  #studyListContainer table#tblStudyList thead tr th:first-child,\n  #studyListContainer table#tblStudyList tbody tr th:first-child,\n  #studyListContainer table#tblStudyList thead tr td:first-child,\n  #studyListContainer table#tblStudyList tbody tr td:first-child {\n    padding-left: 3%;\n  }\n  #studyListContainer table#tblStudyList thead tr th:last-child,\n  #studyListContainer table#tblStudyList tbody tr th:last-child,\n  #studyListContainer table#tblStudyList thead tr td:last-child,\n  #studyListContainer table#tblStudyList tbody tr td:last-child {\n    padding-right: 3%;\n  }\n}\n@media only screen and (max-width: 1069px) {\n  .theadBackground {\n    height: 101px;\n  }\n  .studylist-pagination > .row {\n    margin-right: 0;\n  }\n  .studyListToolbar {\n    padding: 0 5px;\n  }\n  #studyListContainer {\n    padding: 0;\n  }\n  #studyListContainer table#tblStudyList thead > tr > th:first-child {\n    padding-left: 5px;\n  }\n  #studyListContainer table#tblStudyList thead > tr > th:last-child {\n    padding-right: 5px;\n  }\n  #studyListContainer table#tblStudyList thead > tr > th input.worklist-search {\n    padding: 10px;\n  }\n  #studyListContainer table#tblStudyList thead > tr > th div.sortingCell {\n    padding: 10px 5px;\n  }\n  #studyListContainer table#tblStudyList thead > tr > th div.sortingCell i {\n    width: auto;\n  }\n  #studyListContainer table#tblStudyList tbody > tr > td:first-child {\n    padding-left: 5px;\n  }\n  #studyListContainer table#tblStudyList tbody > tr > td:last-child {\n    padding-right: 5px;\n  }\n  #studyListContainer .worklistPagination .row {\n    margin-left: 0;\n    margin-right: 0;\n  }\n}\n";styleInject(css$h);var css$i=".studyListToolbar .addNewStudy {\n  margin: 0 10px;\n}\n.studyListToolbar .addNewStudy label {\n  color: var(--text-secondary-color);\n  font-weight: 400;\n  cursor: pointer;\n}\n.studyListToolbar .addNewStudy:hover {\n  color: var(--hover-color);\n}\n.studyListToolbar .addNewStudy:active {\n  color: var(--active-color);\n}\n.studyListToolbar .addNewStudy input {\n  width: 0.1px;\n  height: 0.1px;\n  opacity: 0;\n  overflow: hidden;\n  position: absolute;\n  z-index: -1;\n}\n";styleInject(css$i);var StudylistToolbar=/*#__PURE__*/function(_PureComponent){_inherits$c(StudylistToolbar,_PureComponent);function StudylistToolbar(){_classCallCheck$c(this,StudylistToolbar);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(StudylistToolbar).apply(this,arguments));}_createClass$2(StudylistToolbar,[{key:"clear",value:function clear(e){e.target.value=null;}},{key:"getImportTool",value:function getImportTool(){if(this.props.onImport&&this.props.studyListFunctionsEnabled){return React__default.createElement("div",{className:"addNewStudy btn-file"},React__default.createElement("label",{htmlFor:"btnImport"},React__default.createElement("i",{className:"fa fa-plus"}),"Import study"),React__default.createElement("input",{id:"btnImport",onChange:this.props.onImport,onClick:this.clear,className:"js-import-files",type:"file",webkitdirectory:"true",directory:"true",multiple:true}));}}},{key:"render",value:function render(){return React__default.createElement("div",{className:"studylistToolbar"},this.getImportTool());}}]);return StudylistToolbar;}(React.PureComponent);_defineProperty$3(StudylistToolbar,"propTypes",{studyListFunctionsEnabled:propTypes$1.bool.isRequired,onImport:propTypes$1.func});_defineProperty$3(StudylistToolbar,"defaultProps",{studyListFunctionsEnabled:true});function LoadingText(){return React__default.createElement("div",{className:"loadingTextDiv"},React__default.createElement("h5",null,"Loading... ",React__default.createElement("i",{className:"fa fa-spinner fa-pulse"})));}var css$j=":root {\n  --text-secondary-color: #91b9cd;\n  --default-color: #9ccef9;\n  --active-color: #20a5d6;\n  --hover-color: #fff;\n  --ui-gray: #263340;\n  --ui-gray-dark: #16202b;\n  --ui-gray-darkest: #14202a;\n  --ui-gray-darker: #151a1f;\n  --ui-gray-light: #516873;\n  --primary-background-color: #000;\n}\n.pagination-area {\n  color: var(--text-secondary-color);\n  font-size: 13px;\n  font-weight: normal !important;\n}\n.pagination-area label {\n  font-weight: normal;\n}\n.pagination-area select {\n  margin: 5px;\n  background-color: var(--primary-background-color);\n  color: #fff;\n}\n.rows-per-page label.wrapperLabel {\n  display: inline-table !important;\n  margin: 0 4px;\n}\n.rows-per-page label.wrapperLabel select {\n  margin: 0px 4px 0px 4px;\n  width: 42px;\n}\n.page-buttons {\n  margin: 0;\n  text-align: right;\n}\n.page-buttons label {\n  font-weight: normal;\n}\n.page-buttons label ul.pagination-control {\n  margin: 0;\n}\n.page-buttons label ul.pagination-control li {\n  display: table-cell;\n  padding: 5px 2px;\n}\n.page-buttons label ul.pagination-control li button {\n  padding: 4px 8px;\n  background-color: var(--primary-background-color);\n  border-color: var(--ui-gray);\n  color: var(--ui-gray-darkest);\n  color: #fff;\n  text-decoration: none;\n}\n.page-buttons label ul.pagination-control li button:hover:enabled {\n  color: var(--active-color);\n}\n.page-buttons label ul.pagination-control li .active button {\n  background-color: var(--ui-gray);\n  border-color: #ddd;\n  color: #fff;\n}\n";styleInject(css$j);var PaginationArea=/*#__PURE__*/function(_PureComponent){_inherits$c(PaginationArea,_PureComponent);function PaginationArea(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,PaginationArea);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(PaginationArea)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"nextPage",function(){_this.props.nextPageFunc(_this.props.currentPage);});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"prevPage",function(){_this.props.prevPageFunc(_this.props.currentPage);});_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"onRowsPerPageChange",function(event){_this.props.onRowsPerPageChange(parseInt(event.target.value));});return _this;}_createClass$2(PaginationArea,[{key:"renderPaginationButtons",value:function renderPaginationButtons(){return React__default.createElement("div",{className:"col-xs-8 col-sm-9 col-md-9"},React__default.createElement("div",{className:"form-inline form-group page-buttons noselect"},React__default.createElement("label",null,React__default.createElement("ul",{className:"pagination-control no-margins"},React__default.createElement("li",{className:"page-item prev"},React__default.createElement("button",{onClick:this.prevPage,disabled:this.props.currentPage===0,className:"btn page-link"},"Previous")),React__default.createElement("li",{className:"page-item next"},React__default.createElement("button",{onClick:this.nextPage,disabled:this.props.currentPage===this.props.numberOfPages-1,className:"btn page-link"},"Next"))))));}},{key:"renderRowsPerPageDropdown",value:function renderRowsPerPageDropdown(){return React__default.createElement("div",{className:"form-inline form-group rows-per-page"},React__default.createElement("span",null,"Show"),React__default.createElement("select",{onChange:this.onRowsPerPageChange,defaultValue:this.props.rowsPerPage},this.props.pageOptions.map(function(pageNumber){return React__default.createElement("option",{key:pageNumber,value:pageNumber},pageNumber);})),React__default.createElement("span",null,"rows per page"));}},{key:"render",value:function render(){return React__default.createElement("div",{name:"paginationArea"},React__default.createElement("div",{className:"pagination-area"},React__default.createElement("div",{className:"row"},React__default.createElement("div",{className:"col-xs-4 col-sm-3 col-md-3"},this.renderRowsPerPageDropdown()),React__default.createElement("div",{className:"col-xs-8 col-sm-9 col-md-9"},React__default.createElement("div",{className:"form-inline form-group page-number pull-right"},this.renderPaginationButtons())))));}}]);return PaginationArea;}(React.PureComponent);_defineProperty$3(PaginationArea,"defaultProps",{pageOptions:[5,10,25,50,100],rowsPerPage:25,currentPage:0,numberOfPages:1});_defineProperty$3(PaginationArea,"propTypes",{pageOptions:propTypes$1.array.isRequired,rowsPerPage:propTypes$1.number.isRequired,currentPage:propTypes$1.number.isRequired,numberOfPages:propTypes$1.number.isRequired,nextPageFunc:propTypes$1.func,prevPageFunc:propTypes$1.func,onRowsPerPageChange:propTypes$1.func});var StudyList=/*#__PURE__*/function(_Component){_inherits$c(StudyList,_Component);function StudyList(props){var _this;_classCallCheck$c(this,StudyList);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(StudyList).call(this,props));var sortData={};var sortClasses={patientName:StudyList.DEFAULT_SORTABLE_ICON_CLS,patientId:StudyList.DEFAULT_SORTABLE_ICON_CLS,accessionNumber:StudyList.DEFAULT_SORTABLE_ICON_CLS,studyDate:StudyList.DEFAULT_SORTABLE_ICON_CLS,modality:StudyList.DEFAULT_SORTABLE_ICON_CLS,studyDescription:StudyList.DEFAULT_SORTABLE_ICON_CLS};if(props.defaultSort){sortData.field=props.defaultSort.field;sortData.order=props.defaultSort.order;sortClasses[props.defaultSort.field]=props.defaultSort.order==='desc'?StudyList.DESC_SORT_ICON_CLS:StudyList.ASC_SORT_ICON_CLS;}_this.state={loading:false,error:false,sortClasses:sortClasses,searchData:{sortData:sortData,currentPage:_this.props.currentPage,rowsPerPage:_this.props.rowsPerPage},highlightedItem:''};_this.getChangeHandler=_this.getChangeHandler.bind(_assertThisInitialized$3(_assertThisInitialized$3(_this)));_this.onInputKeydown=_this.onInputKeydown.bind(_assertThisInitialized$3(_assertThisInitialized$3(_this)));_this.nextPage=_this.nextPage.bind(_assertThisInitialized$3(_assertThisInitialized$3(_this)));_this.prevPage=_this.prevPage.bind(_assertThisInitialized$3(_assertThisInitialized$3(_this)));_this.onRowsPerPageChange=_this.onRowsPerPageChange.bind(_assertThisInitialized$3(_assertThisInitialized$3(_this)));return _this;}_createClass$2(StudyList,[{key:"getChangeHandler",value:function getChangeHandler(key){var _this2=this;return function(event){_this2.setSearchData(key,event.target.value);};}},{key:"setSearchData",value:function setSearchData(key,value,callback){var searchData=this.state.searchData;searchData[key]=value;this.setState({searchData:searchData},callback);}},{key:"setSearchDataBatch",value:function setSearchDataBatch(keyValues,callback){var searchData=this.state.searchData;Object.keys(keyValues).forEach(function(key){searchData[key]=keyValues[key];});this.setState({searchData:searchData},callback);}},{key:"onInputKeydown",value:function(){var _onInputKeydown=_asyncToGenerator$1(/*#__PURE__*/regenerator$1.mark(function _callee(event){return regenerator$1.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(event.key==='Enter'){event.preventDefault();event.stopPropagation();// reset the page because user is doing a new search
  this.setSearchData('currentPage',0,this.search);}case 1:case"end":return _context.stop();}}},_callee,this);}));function onInputKeydown(_x){return _onInputKeydown.apply(this,arguments);}return onInputKeydown;}()},{key:"search",value:function(){var _search=_asyncToGenerator$1(/*#__PURE__*/regenerator$1.mark(function _callee2(){return regenerator$1.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;this.setState({loading:true,error:false});_context2.next=4;return this.props.onSearch(this.state.searchData);case 4:_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2["catch"](0);this.setState({error:true});throw new Error(_context2.t0);case 10:_context2.prev=10;this.setState({loading:false});return _context2.finish(10);case 13:case"end":return _context2.stop();}}},_callee2,this,[[0,6,10,13]]);}));function search(){return _search.apply(this,arguments);}return search;}()},{key:"renderNoMachingResults",value:function renderNoMachingResults(){if(!this.props.studies.length&&!this.state.error){return React__default.createElement("div",{className:"notFound"},"No matching results");}}},{key:"renderHasError",value:function renderHasError(){if(this.state.error){return React__default.createElement("div",{className:"notFound"},"There was an error fetching studies");}}},{key:"renderIsLoading",value:function renderIsLoading(){if(this.state.loading){return React__default.createElement("div",{className:"loading"},React__default.createElement(LoadingText,null));}}},{key:"nextPage",value:function nextPage(currentPage){currentPage=currentPage+1;this.setSearchData('currentPage',currentPage,this.search);}},{key:"prevPage",value:function prevPage(currentPage){currentPage=currentPage-1;this.setSearchData('currentPage',currentPage,this.search);}},{key:"onRowsPerPageChange",value:function onRowsPerPageChange(rowsPerPage){this.setSearchDataBatch({rowsPerPage:rowsPerPage,currentPage:0},this.search);}},{key:"onSortClick",value:function onSortClick(key){var _this3=this;return function(){var sortClasses=_this3.state.sortClasses;var order;if(sortClasses[key]===StudyList.ASC_SORT_ICON_CLS){sortClasses[key]=StudyList.DESC_SORT_ICON_CLS;order='desc';}else{sortClasses[key]=StudyList.ASC_SORT_ICON_CLS;order='asc';}Object.keys(sortClasses).forEach(function(sortClassKey){if(sortClassKey!==key){sortClasses[sortClassKey]=StudyList.DEFAULT_SORTABLE_ICON_CLS;}});_this3.setState({sortClasses:sortClasses},function(){_this3.setSearchData('sortData',{field:key,order:order},_this3.search);});};}},{key:"onHighlightItem",value:function onHighlightItem(studyItemUid){this.setState({highlightedItem:studyItemUid});}},{key:"renderTableRow",value:function renderTableRow(study){var _this4=this;return React__default.createElement("tr",{key:study.studyInstanceUID,className:this.state.highlightedItem===study.studyInstanceUID?'studylistStudy noselect active':'studylistStudy noselect',onClick:function onClick(){_this4.onHighlightItem(study.studyInstanceUID);},onMouseDown:function onMouseDown(event){// middle/wheel click
  if(event.button===1){_this4.props.onSelectItem(study.studyInstanceUID);}},onDoubleClick:function onDoubleClick(){_this4.props.onSelectItem(study.studyInstanceUID);}},React__default.createElement("td",{className:"patientName"},study.patientName),React__default.createElement("td",{className:"patientId"},study.patientId),React__default.createElement("td",{className:"accessionNumber"},study.accessionNumber),React__default.createElement("td",{className:"studyDate"},study.studyDate),React__default.createElement("td",{className:"modalities"},study.modalities),React__default.createElement("td",{className:"studyDescription"},study.studyDescription));}},{key:"render",value:function render(){var _this5=this;return React__default.createElement("div",{className:"StudyList"},React__default.createElement("div",{className:"studyListToolbar clearfix"},React__default.createElement("div",{className:"header pull-left"},"Study List"),React__default.createElement("div",{className:"studyCount pull-right"},this.props.studyCount),React__default.createElement("div",{className:"pull-right"},React__default.createElement(StudylistToolbar,{studyListFunctionsEnabled:this.props.studyListFunctionsEnabled,onImport:this.props.onImport}))),React__default.createElement("div",{className:"theadBackground"}),React__default.createElement("div",{id:"studyListContainer"},React__default.createElement("table",{id:"tblStudyList",className:"studylistResult table noselect"},React__default.createElement("thead",null,React__default.createElement("tr",null,React__default.createElement("th",{className:"patientName"},React__default.createElement("div",{id:"_patientName",className:"sortingCell",onClick:this.onSortClick('patientName')},React__default.createElement("span",null,"Patient Name"),React__default.createElement("i",{className:this.state.sortClasses.patientName},"\xA0")),React__default.createElement("input",{type:"text",className:"form-control studylist-search",id:"patientName",value:this.state.patientName,onKeyDown:this.onInputKeydown,onChange:this.getChangeHandler('patientName')})),React__default.createElement("th",{className:"patientId"},React__default.createElement("div",{id:"_patientId",className:"sortingCell",onClick:this.onSortClick('patientId')},React__default.createElement("span",null,"MRN"),React__default.createElement("i",{className:this.state.sortClasses.patientId},"\xA0")),React__default.createElement("input",{type:"text",className:"form-control studylist-search",id:"patientId",value:this.state.patientId,onKeyDown:this.onInputKeydown,onChange:this.getChangeHandler('patientId')})),React__default.createElement("th",{className:"accessionNumber"},React__default.createElement("div",{id:"_accessionNumber",className:"sortingCell",onClick:this.onSortClick('accessionNumber')},React__default.createElement("span",null,"Accession #"),React__default.createElement("i",{className:this.state.sortClasses.accessionNumber},"\xA0")),React__default.createElement("input",{type:"text",className:"form-control studylist-search",id:"accessionNumber",value:this.state.accessionNumber,onKeyDown:this.onInputKeydown,onChange:this.getChangeHandler('accessionNumber')})),React__default.createElement("th",{className:"studyDate"},React__default.createElement("div",{id:"_studyDate",className:"sortingCell",onClick:this.onSortClick('studyDate')},React__default.createElement("span",null,"Study Date"),React__default.createElement("i",{className:this.state.sortClasses.studyDate},"\xA0")),React__default.createElement("input",{type:"text",className:"form-control studylist-search",name:"daterange",id:"studyDate",value:this.state.studyDateRange,onChange:this.getChangeHandler('studyDateRange')})),React__default.createElement("th",{className:"modality"},React__default.createElement("div",{id:"_modality",className:"sortingCell",onClick:this.onSortClick('modality')},React__default.createElement("span",null,"Modality"),React__default.createElement("i",{className:this.state.sortClasses.modality},"\xA0")),React__default.createElement("input",{type:"text",className:"form-control studylist-search",id:"modality",onKeyDown:this.onInputKeydown,value:this.state.modality,onChange:this.getChangeHandler('modality')})),React__default.createElement("th",{className:"studyDescription"},React__default.createElement("div",{id:"_studyDescription",className:"sortingCell",onClick:this.onSortClick('studyDescription')},React__default.createElement("span",null,"Study Description"),React__default.createElement("i",{className:this.state.sortClasses.studyDescription},"\xA0")),React__default.createElement("input",{type:"text",className:"form-control studylist-search",id:"studyDescription",onKeyDown:this.onInputKeydown,value:this.state.studyDescription,onChange:this.getChangeHandler('studyDescription')})))),React__default.createElement("tbody",{id:"studyListData"},this.props.studies.map(function(study){return _this5.renderTableRow(study);}))),this.renderIsLoading(),this.renderHasError(),this.renderNoMachingResults(),React__default.createElement(PaginationArea,{currentPage:this.state.searchData.currentPage,nextPageFunc:this.nextPage,prevPageFunc:this.prevPage,onRowsPerPageChange:this.onRowsPerPageChange,rowsPerPage:this.state.searchData.rowsPerPage,numberOfPages:Math.ceil(this.props.studyCount/this.state.searchData.rowsPerPage)})));}}]);return StudyList;}(React.Component);_defineProperty$3(StudyList,"propTypes",{studies:propTypes$1.array.isRequired,onSelectItem:propTypes$1.func.isRequired,onSearch:propTypes$1.func.isRequired,studyCount:propTypes$1.number.isRequired,currentPage:propTypes$1.number,rowsPerPage:propTypes$1.number,studyListFunctionsEnabled:propTypes$1.bool,defaultSort:propTypes$1.shape({field:propTypes$1.string.isRequired,order:propTypes$1.oneOf(['desc','asc']).isRequired}),onImport:propTypes$1.func});_defineProperty$3(StudyList,"defaultProps",{currentPage:0,rowsPerPage:25});_defineProperty$3(StudyList,"DEFAULT_SORTABLE_ICON_CLS",'fa fa-fw fa-sort');_defineProperty$3(StudyList,"DESC_SORT_ICON_CLS",'fa fa-fw fa-sort-desc');_defineProperty$3(StudyList,"ASC_SORT_ICON_CLS",'fa fa-fw fa-sort-asc');function SimpleToolbarButton(props){var className=classnames(props.className,'btn btn-sm btn-default');return React__default.createElement("button",{id:props.id,type:"button",className:className,"data-container":"body","data-toggle":"tooltip","data-placement":"bottom",title:props.title},React__default.createElement("span",{className:props.iconClassName}));}SimpleToolbarButton.propTypes={iconClassName:propTypes$1.string,title:propTypes$1.string,className:propTypes$1.string,id:propTypes$1.string,onClick:propTypes$1.func};function getDefaultButtonData(){var buttonData=[];buttonData.push({id:'wwwc',title:'WW/WC',className:'imageViewerTool',iconClassName:'fa fa-sun-o'});buttonData.push({id:'wwwcRegion',title:'Window by Region',className:'imageViewerTool',iconClassName:'fa fa-square'});buttonData.push({id:'magnify',title:'Magnify',className:'imageViewerTool',iconClassName:'fa fa-circle'});buttonData.push({id:'annotate',title:'Annotation',className:'imageViewerTool',iconClassName:'fa fa-arrows-h'});buttonData.push({id:'invert',title:'Invert',className:'imageViewerCommand',iconClassName:'fa fa-adjust'});buttonData.push({id:'zoom',title:'Zoom',className:'imageViewerTool',iconClassName:'fa fa-search'});buttonData.push({id:'pan',title:'Pan',className:'imageViewerTool',iconClassName:'fa fa-arrows'});buttonData.push({id:'stackScroll',title:'Stack Scroll',className:'imageViewerTool',iconClassName:'fa fa-bars'});buttonData.push({id:'length',title:'Length Measurement',className:'imageViewerTool',iconClassName:'fa fa-arrows-v'});buttonData.push({id:'angle',title:'Angle Measurement',className:'imageViewerTool',iconClassName:'fa fa-angle-left'});buttonData.push({id:'dragProbe',title:'Pixel Probe',className:'imageViewerTool',iconClassName:'fa fa-dot-circle-o'});buttonData.push({id:'ellipticalRoi',title:'Elliptical ROI',className:'imageViewerTool',iconClassName:'fa fa-circle-o'});buttonData.push({id:'rectangleRoi',title:'Rectangle ROI',className:'imageViewerTool',iconClassName:'fa fa-square-o'});buttonData.push({id:'resetViewport',title:'Reset Viewport',className:'imageViewerCommand',iconClassName:'fa fa-undo'});buttonData.push({id:'clearTools',title:'Clear tools',className:'imageViewerCommand',iconClassName:'fa fa-trash'});return buttonData;}var Toolbar=/*#__PURE__*/function(_Component){_inherits$c(Toolbar,_Component);function Toolbar(){_classCallCheck$c(this,Toolbar);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(Toolbar).apply(this,arguments));}_createClass$2(Toolbar,[{key:"render",value:function render(){var maybePlayClipButton;if(this.props.includePlayClipButton){maybePlayClipButton=React__default.createElement(PlayClipButton,null);}var maybeLayoutButton;if(this.props.includeLayoutButton){maybeLayoutButton=React__default.createElement(LayoutButton,null);}return React__default.createElement("div",{id:"toolbar"},React__default.createElement("div",{className:"btn-group"},this.props.buttons.map(function(button,i){return React__default.createElement(SimpleToolbarButton,_extends$c({},button,{key:i}));}),maybePlayClipButton,maybeLayoutButton));}}]);return Toolbar;}(React.Component);Toolbar.propTypes={buttons:propTypes$1.array.isRequired,includeLayoutButton:propTypes$1.bool.isRequired,includePlayClipButton:propTypes$1.bool.isRequired};Toolbar.defaultProps={buttons:getDefaultButtonData(),includeLayoutButton:true,includePlayClipButton:true};var css$k=".ToolbarButton {\n  height: 48px;\n  color: var(--default-color);\n  float: left;\n  text-align: center;\n  padding: 0 1rem;\n  cursor: pointer;\n  -webkit-touch-callout: none; /* iOS Safari */\n  -webkit-user-select: none; /* Safari */\n  -khtml-user-select: none; /* Konqueror HTML */\n  -moz-user-select: none; /* Firefox */\n  -ms-user-select: none; /* Internet Explorer/Edge */\n  user-select: none; /* Non-prefixed version, currently\n                                  supported by Chrome and Opera */\n}\n.ToolbarButton svg {\n  height: 21px;\n  width: 21px;\n  margin: 2px;\n  fill: var(--default-color);\n  stroke: var(--default-color);\n}\n.ToolbarButton i {\n  font-size: 18px;\n  line-height: 30px;\n}\n.ToolbarButton:hover {\n  color: var(--hover-color);\n}\n.ToolbarButton:hover svg {\n  fill: var(--hover-color);\n  stroke: var(--hover-color);\n}\n.ToolbarButton:hover i {\n  color: var(--hover-color);\n}\n.ToolbarButton.active,\n.ToolbarButton:active {\n  color: var(--active-color);\n}\n.ToolbarButton.active svg,\n.ToolbarButton:active svg {\n  fill: var(--active-color);\n  stroke: var(--active-color);\n}\n.ToolbarButton.active i,\n.ToolbarButton:active i {\n  color: var(--active-color);\n}\n.ToolbarButton span.toolbar-button-label {\n  font-size: 12px;\n  font-weight: 500;\n  display: block;\n}\n";styleInject(css$k);function ToolbarButton(props){var onClick=function onClick(event){if(props.onClick){props.onClick(event,props);}if(props.setToolActive){props.setToolActive(props);}};var className=classnames(props.className,{active:props.active});var active=props.active,svgUrlActive=props.svgUrlActive,iconClassesActive=props.iconClassesActive,textActive=props.textActive;var svgUrl=props.svgUrl;if(active&&svgUrlActive){svgUrl=svgUrlActive;}var iconClasses=props.iconClasses;if(active&&iconClassesActive){iconClasses=iconClassesActive;}var label=props.text;if(active&&textActive){label=textActive;}return React__default.createElement("div",{className:className,onClick:onClick},svgUrl&&React__default.createElement("svg",null,React__default.createElement("use",{xlinkHref:svgUrl})),iconClasses&&React__default.createElement("i",{className:iconClasses}),React__default.createElement("span",{className:"toolbar-button-label"},label));}ToolbarButton.defaultProps={command:'ToolbarButton',onClick:function onClick(){//console.log(`ToolbarButton does not have an onClick event`);
  },className:'ToolbarButton'};ToolbarButton.propTypes={active:propTypes$1.bool.isRequired,className:propTypes$1.string.isRequired,text:propTypes$1.string.isRequired,textActive:propTypes$1.string,iconClasses:propTypes$1.string,iconClassesActive:propTypes$1.string,svgUrl:propTypes$1.string,svgUrlActive:propTypes$1.string,onClick:propTypes$1.func,setToolActive:propTypes$1.func};var css$l=".ToolbarSection {\n  float: left;\n  background-color: var(--primary-background-color);\n  border-radius: 8px;\n}\n";styleInject(css$l);var ToolbarSection=/*#__PURE__*/function(_PureComponent){_inherits$c(ToolbarSection,_PureComponent);function ToolbarSection(){_classCallCheck$c(this,ToolbarSection);return _possibleConstructorReturn$c(this,_getPrototypeOf$1(ToolbarSection).apply(this,arguments));}_createClass$2(ToolbarSection,[{key:"render",value:function render(){var _this=this;var items=this.props.buttons.map(function(item,index){return React__default.createElement(ToolbarButton,_extends$c({key:index},item,{active:item.command===_this.props.activeCommand,setToolActive:_this.props.setToolActive}));});return React__default.createElement("div",{className:'ToolbarSection'},items);}}]);return ToolbarSection;}(React.PureComponent);ToolbarSection.propTypes={buttons:propTypes$1.array.isRequired,activeCommand:propTypes$1.string,setToolActive:propTypes$1.func};var range=function range(start,end){return new Array(end-start).fill().map(function(d,i){return i+start;});};var allowedKeys=[8,13,27,32,46].concat([12,106,107,109,110,111],_toConsumableArray(range(218,220)),_toConsumableArray(range(185,190)),_toConsumableArray(range(111,131)),_toConsumableArray(range(32,41)),_toConsumableArray(range(47,58)),_toConsumableArray(range(64,91)));var specialKeys={8:'backspace',9:'tab',13:'return',16:'shift',17:'ctrl',18:'alt',19:'pause',20:'capslock',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',45:'insert',46:'del',96:'0',97:'1',98:'2',99:'3',100:'4',101:'5',102:'6',103:'7',104:'8',105:'9',106:'*',107:'+',109:'-',110:'.',111:'/',112:'f1',113:'f2',114:'f3',115:'f4',116:'f5',117:'f6',118:'f7',119:'f8',120:'f9',121:'f10',122:'f11',123:'f12',144:'numlock',145:'scroll',191:'/',224:'meta'};var HotKeysPreferences=/*#__PURE__*/function(_Component){_inherits$c(HotKeysPreferences,_Component);function HotKeysPreferences(props){var _this;_classCallCheck$c(this,HotKeysPreferences);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(HotKeysPreferences).call(this,props));_this.columns={};Object.keys(_this.props.hotKeysData).forEach(function(key){var hotKey=_this.props.hotKeysData[key];if(_this.columns.hasOwnProperty(hotKey.column)){_this.columns[hotKey.column].push(key);}else{_this.columns[hotKey.column]=[key];}});_this.columnClass="col-md-".concat(12/Object.keys(_this.columns).length||1);_this.state={hotKeys:_this.props.hotKeysData,errorMessages:{}};_this.onInputKeyDown=_this.onInputKeyDown.bind(_assertThisInitialized$3(_assertThisInitialized$3(_this)));return _this;}_createClass$2(HotKeysPreferences,[{key:"getKeysPressedArray",value:function getKeysPressedArray(event){var keysPressedArray=[];if(event.ctrlKey&&!event.altKey){keysPressedArray.push('CTRL');}if(event.shiftKey&&!event.altKey){keysPressedArray.push('SHIFT');}if(event.altKey&&!event.ctrlKey){keysPressedArray.push('ALT');}return keysPressedArray;}},{key:"getConflictingCommand",value:function getConflictingCommand(currentToolKey,hotKeyCommand){var _this2=this;return Object.keys(this.state.hotKeys).find(function(tool){var value=_this2.state.hotKeys[tool].command;return value&&value===hotKeyCommand&&tool!==currentToolKey;});}},{key:"updateInputText",value:function updateInputText(toolKey,event){var displayPressedKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var pressedKeys=this.getKeysPressedArray(event);if(displayPressedKey){var specialKeyName=specialKeys[event.which];var keyName=specialKeyName||event.key||String.fromCharCode(event.keyCode);pressedKeys.push(keyName.toUpperCase());}this.updateHotKeysState(toolKey,pressedKeys.join('+'));}},{key:"updateHotKeysState",value:function updateHotKeysState(toolKey,command){var callback=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var hotKeys=this.state.hotKeys;hotKeys[toolKey].command=command;this.setState(hotKeys,callback);}},{key:"updateErrorsState",value:function updateErrorsState(toolKey,errorMessage){var callback=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var errorMessages=this.state.errorMessages;errorMessages[toolKey]=errorMessage;this.setState({errorMessages:errorMessages},callback);}},{key:"onInputKeyDown",value:function onInputKeyDown(event,toolKey){// Prevent ESC key from propagating and closing the modal
  if(event.key==='Escape'){event.stopPropagation();}if(allowedKeys.includes(event.keyCode)){this.updateInputText(toolKey,event,true);}else{this.updateInputText(toolKey,event,false);}event.preventDefault();}},{key:"onChange",value:function onChange(event,toolKey){var _this3=this;if(event.ctrlKey||event.altKey||event.shiftKey){return;}var hotKey=this.state.hotKeys[toolKey];var command=hotKey.command;var pressedKeys=command.split('+');var lastPressedKey=pressedKeys[pressedKeys.length-1].toUpperCase();// clear the prior errors
  this.setState({errorMessages:{}},function(){// Check if it has a valid modifier
  var isModifier=['CTRL','ALT','SHIFT'].includes(lastPressedKey);if(isModifier){_this3.updateHotKeysState(toolKey,'');_this3.updateErrorsState(toolKey,"It's not possible to define only modifier keys (CTRL, ALT and SHIFT) as a shortcut");return;}/*
           * Check if it has some conflict
           */var conflictedCommandKey=_this3.getConflictingCommand(toolKey,command);if(conflictedCommandKey){var conflictedCommand=_this3.state.hotKeys[conflictedCommandKey];_this3.updateErrorsState(toolKey,"\"".concat(conflictedCommand.label,"\" is already using the \"").concat(conflictedCommand.command,"\" shortcut."));_this3.updateErrorsState(conflictedCommandKey,'');_this3.updateHotKeysState(toolKey,'');return;}/*
           * Check if is a valid combination
           */var modifierCommand=pressedKeys.slice(0,pressedKeys.length-1).join('+').toUpperCase();var disallowedCombinations$$1=HotKeysPreferences.disallowedCombinations[modifierCommand];var hasDisallowedCombinations=disallowedCombinations$$1?disallowedCombinations$$1.includes(lastPressedKey):false;if(hasDisallowedCombinations){_this3.updateHotKeysState(toolKey,'');_this3.updateErrorsState(toolKey,"It's not possible to define only modifier keys (CTRL, ALT and SHIFT) as a shortcut");return;}});}},{key:"renderRow",value:function renderRow(toolKey,hotKey){var _this4=this;return React__default.createElement("tr",{key:toolKey},React__default.createElement("td",{className:"text-right p-r-1"},hotKey.label),React__default.createElement("td",{width:"200"},React__default.createElement("label",{className:"wrapperLabel ".concat(this.state.errorMessages[toolKey]!==undefined?'state-error':''," "),ref:function ref(input){return _this4[toolKey]=input;},"data-key":"defaultTool"},React__default.createElement("input",{readOnly:true,type:"text",value:hotKey.command,vali:"true",className:"form-control hotkey text-center",onKeyDown:function onKeyDown(event){return _this4.onInputKeyDown(event,toolKey);},onKeyUp:function onKeyUp(event){return _this4.onChange(event,toolKey);}}),React__default.createElement("span",{className:"wrapperText"}),React__default.createElement("span",{className:"errorMessage"},this.state.errorMessages[toolKey]))));}},{key:"renderColumn",value:function renderColumn(columnIndex,hotkeysColumn){var _this5=this;return React__default.createElement("div",{key:columnIndex,className:this.columnClass},React__default.createElement("table",{className:"full-width"},React__default.createElement("thead",null,React__default.createElement("tr",null,React__default.createElement("th",{className:"text-right p-r-1"},"Function"),React__default.createElement("th",{className:"text-center"},"Shortcut"))),React__default.createElement("tbody",null,hotkeysColumn.map(function(keyTool){return _this5.renderRow(keyTool,_this5.state.hotKeys[keyTool]);}))));}},{key:"render",value:function render(){var _this6=this;return React__default.createElement("div",{className:"row"},Object.keys(this.columns).sort().map(function(columnIndex){return _this6.renderColumn(columnIndex,_this6.columns[columnIndex]);}));}}]);return HotKeysPreferences;}(React.Component);_defineProperty$3(HotKeysPreferences,"propTypes",{hotKeysData:propTypes$1.object.isRequired,onChange:propTypes$1.func});var css$m=":root {\n  --text-secondary-color: #91b9cd;\n  --default-color: #9ccef9;\n  --active-color: #20a5d6;\n  --hover-color: #fff;\n  --ui-gray: #263340;\n  --ui-gray-dark: #16202b;\n  --ui-gray-darkest: #14202a;\n  --ui-gray-darker: #151a1f;\n  --ui-gray-light: #516873;\n  --text-primary-color: #fff;\n}\n.form-themed table {\n  color: var(--text-primary-color);\n}\n.form-themed table th,\n.form-themed table td {\n  font-size: 15px;\n  font-weight: normal;\n}\n.form-themed table th {\n  line-height: 60px;\n}\n.form-themed table td {\n  line-height: 18px;\n}\n.form-themed .p-r-1 {\n  padding-right: 1rem !important;\n}\n.form-themed label {\n  margin-bottom: 5px;\n}\n.form-themed label.wrapperLabel {\n  cursor: pointer;\n}\n.form-themed label.wrapperLabel:not(.checkboxLabel) {\n  cursor: pointer;\n  display: flex;\n  flex-direction: column;\n}\n.form-themed label.wrapperLabel:not(.checkboxLabel) .wrapperText {\n  display: block;\n  order: -1;\n}\n.form-themed .btn[disabled],\n.form-themed input[type=text][disabled],\n.form-themed input[type=password][disabled],\n.form-themed input[type=number][disabled],\n.form-themed .btn.disabled,\n.form-themed input[type=text].disabled,\n.form-themed input[type=password].disabled,\n.form-themed input[type=number].disabled,\n.form-themed .btn[disabled]:hover,\n.form-themed input[type=text][disabled]:hover,\n.form-themed input[type=password][disabled]:hover,\n.form-themed input[type=number][disabled]:hover,\n.form-themed .btn.disabled:hover,\n.form-themed input[type=text].disabled:hover,\n.form-themed input[type=password].disabled:hover,\n.form-themed input[type=number].disabled:hover,\n.form-themed .btn[disabled]:active,\n.form-themed input[type=text][disabled]:active,\n.form-themed input[type=password][disabled]:active,\n.form-themed input[type=number][disabled]:active,\n.form-themed .btn.disabled:active,\n.form-themed input[type=text].disabled:active,\n.form-themed input[type=password].disabled:active,\n.form-themed input[type=number].disabled:active {\n  background-color: var(--ui-gray-darker);\n  border-color: var(--ui-gray-light);\n  color: var(--text-primary-color);\n}\n.form-themed .btn[disabled] + .wrapperText,\n.form-themed input[type=text][disabled] + .wrapperText,\n.form-themed input[type=password][disabled] + .wrapperText,\n.form-themed input[type=number][disabled] + .wrapperText,\n.form-themed .btn.disabled + .wrapperText,\n.form-themed input[type=text].disabled + .wrapperText,\n.form-themed input[type=password].disabled + .wrapperText,\n.form-themed input[type=number].disabled + .wrapperText,\n.form-themed .btn[disabled]:hover + .wrapperText,\n.form-themed input[type=text][disabled]:hover + .wrapperText,\n.form-themed input[type=password][disabled]:hover + .wrapperText,\n.form-themed input[type=number][disabled]:hover + .wrapperText,\n.form-themed .btn.disabled:hover + .wrapperText,\n.form-themed input[type=text].disabled:hover + .wrapperText,\n.form-themed input[type=password].disabled:hover + .wrapperText,\n.form-themed input[type=number].disabled:hover + .wrapperText,\n.form-themed .btn[disabled]:active + .wrapperText,\n.form-themed input[type=text][disabled]:active + .wrapperText,\n.form-themed input[type=password][disabled]:active + .wrapperText,\n.form-themed input[type=number][disabled]:active + .wrapperText,\n.form-themed .btn.disabled:active + .wrapperText,\n.form-themed input[type=text].disabled:active + .wrapperText,\n.form-themed input[type=password].disabled:active + .wrapperText,\n.form-themed input[type=number].disabled:active + .wrapperText {\n  color: var(--text-primary-color);\n  cursor: auto;\n}\n.form-themed input[type=text],\n.form-themed input[type=password],\n.form-themed input[type=number] {\n  background-color: var(--ui-gray);\n  border-color: var(--ui-border-color);\n  color: var(--text-primary-color);\n  font-weight: normal;\n}\n.form-themed input[type=text]:active,\n.form-themed input[type=password]:active,\n.form-themed input[type=number]:active,\n.form-themed input[type=text]:focus,\n.form-themed input[type=password]:focus,\n.form-themed input[type=number]:focus {\n  background-color: var(--ui-gray-dark);\n  border: 2px solid var(--active-color);\n  box-shadow: none;\n}\n.form-themed input[type=text]:active + .wrapperText,\n.form-themed input[type=password]:active + .wrapperText,\n.form-themed input[type=number]:active + .wrapperText,\n.form-themed input[type=text]:focus + .wrapperText,\n.form-themed input[type=password]:focus + .wrapperText,\n.form-themed input[type=number]:focus + .wrapperText {\n  color: var(--active-color);\n}\n.form-themed .btn-primary {\n  background-color: var(--active-color);\n  border-collapse: var(--ui-border-color-active);\n  color: var(--ui-text-color-active);\n}\n.form-themed .btn-primary:hover,\n.form-themed .btn-primary:active,\n.form-themed .btn-primary:focus,\n.form-themed .btn-primary:focus:active {\n  background-color: var(--ui-active-color);\n  border-collapse: var(--ui-border-color-active);\n  color: var(--ui-text-color-active);\n}\n.form-themed .form-control {\n  background-color: #fff;\n  border: 0;\n  font-size: 14px;\n  height: 30px;\n  line-height: 16px;\n  padding: 8px 9px 6px;\n}\n:root {\n  --active-color: #20a5d6;\n}\n.nav-tabs {\n  border-bottom: 0;\n  margin-bottom: 3px;\n  position: relative;\n  z-index: 1;\n}\n.nav-tabs :hover {\n  cursor: pointer;\n}\n.nav-tabs>li {\n  font-size: 14px;\n  font-weight: normal;\n  height: 40px;\n  line-height: 40px;\n  margin-bottom: 0;\n}\n.nav-tabs>li>button {\n  display: block;\n  width: 100%;\n  line-height: inherit;\n  margin: 0;\n  height: inherit;\n  padding: 0 10px 0 10px;\n  outline: none;\n}\n.nav-tabs>li>button:after {\n  background-color: transparent;\n  bottom: -3px;\n  content: ' ';\n  display: block;\n  height: 3px;\n  width: 100%;\n}\n.nav-tabs>li>button,\n.nav-tabs>li.active>button,\n.nav-tabs>li>button:hover,\n.nav-tabs>li.active>button:hover,\n.nav-tabs>li>button:active,\n.nav-tabs>li.active>button:active,\n.nav-tabs>li>button:focus,\n.nav-tabs>li.active>button:focus {\n  color: var(--active-color);\n  background-color: transparent;\n  border: 0;\n}\n.nav-tabs>li.active>button {\n  font-weight: bold;\n}\n.nav-tabs>li.active>button:after {\n  background-color: var(--active-color);\n}\n:root {\n  --state-error: #fcc;\n  --state-error-border: #933;\n  --state-error-text: #fcc;\n}\n.form-themed .state-error.wrapperLabel input + .wrapperText,\n.state-error.wrapperLabel input + .wrapperText {\n  color: var(--state-error-text);\n}\n.form-themed .state-error+.tooltip .tooltip-inner,\n.state-error+.tooltip .tooltip-inner {\n  color: #fff;\n  background-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.top .tooltip-arrow,\n.state-error+.tooltip.top .tooltip-arrow {\n  border-top-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.right .tooltip-arrow,\n.state-error+.tooltip.right .tooltip-arrow {\n  border-right-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.bottom .tooltip-arrow,\n.state-error+.tooltip.bottom .tooltip-arrow {\n  border-bottom-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.left .tooltip-arrow,\n.state-error+.tooltip.left .tooltip-arrow {\n  border-left-color: var(--state-error-border);\n}\n.form-themed .state-error:not(.component-group).form-control,\n.state-error:not(.component-group).form-control,\n.form-themed .state-error:not(.component-group) .form-control,\n.state-error:not(.component-group) .form-control {\n  background-color: var(--state-error-border);\n  border-color: var(--state-error-border);\n}\n.full-width {\n  width: 100%;\n}\n.full-height {\n  height: 100%;\n}\n.flex-h {\n  display: flex;\n  flex-direction: row;\n}\n.flex-v {\n  display: flex;\n  flex-direction: column;\n}\n.flex-grow {\n  flex-grow: 1;\n}\n.nowrap {\n  white-space: nowrap;\n}\n.modal-body {\n  overflow: hidden;\n}\n.errorMessage {\n  color: var(--state-error-text);\n  font-size: 10px;\n  text-transform: uppercase;\n}\n.form-content {\n  border-bottom: 3px solid var(--primary-background-color);\n  margin-bottom: 20px;\n  margin-left: -22px;\n  margin-right: -22px;\n  max-height: 70vh;\n  overflow-y: auto;\n  padding: 22px;\n}\n.popover {\n  width: 300px;\n}\n.presetIndex {\n  padding: 0px 10px 0px 10px;\n}\n";styleInject(css$m);var WindowLevelPreferences=/*#__PURE__*/function(_Component){_inherits$c(WindowLevelPreferences,_Component);function WindowLevelPreferences(props){var _this;_classCallCheck$c(this,WindowLevelPreferences);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(WindowLevelPreferences).call(this,props));_this.state={data:_this.props.windowLevelData};return _this;}_createClass$2(WindowLevelPreferences,[{key:"onChange",value:function onChange(event,key,field){var data=this.state.data;var entry=data[key];entry[field]=event.target.value;this.setState({data:data});if(this.props.onChange){this.props.onChange(data);}}},{key:"getWLPreferencesRows",value:function getWLPreferencesRows(key){var _this2=this;var entry=this.state.data[key];return React__default.createElement("tr",{key:key},React__default.createElement("td",{className:"p-r-1 text-center"},key),React__default.createElement("td",{className:"p-r-1"},React__default.createElement("label",{className:"wrapperLabel"},React__default.createElement("input",{value:entry.description,type:"text",className:"form-control",onChange:function onChange(event){_this2.onChange(event,key,'description');}}))),React__default.createElement("td",{className:"p-r-1"},React__default.createElement("label",{className:"wrapperLabel"},React__default.createElement("input",{value:entry.window,type:"number",className:"form-control",onChange:function onChange(event){_this2.onChange(event,key,'window');}}))),React__default.createElement("td",{className:"p-r-1"},React__default.createElement("label",{className:"wrapperLabel"},React__default.createElement("input",{value:entry.level,type:"number",className:"form-control",onChange:function onChange(event){_this2.onChange(event,key,'level');}}))));}},{key:"render",value:function render(){var _this3=this;return React__default.createElement("table",{className:"full-width"},React__default.createElement("thead",null,React__default.createElement("tr",null,React__default.createElement("th",{className:"p-x-1 text-center presetIndex"},"Preset"),React__default.createElement("th",{className:"p-x-1"},"Description"),React__default.createElement("th",{className:"p-x-1"},"Window"),React__default.createElement("th",{className:"p-x-1"},"Level"))),React__default.createElement("tbody",null,Object.keys(this.state.data).map(function(key){return _this3.getWLPreferencesRows(key);})));}}]);return WindowLevelPreferences;}(React.Component);_defineProperty$3(WindowLevelPreferences,"propTypes",{windowLevelData:propTypes$1.object.isRequired,onChange:propTypes$1.func});var css$n=":root {\n  --text-secondary-color: #91b9cd;\n  --default-color: #9ccef9;\n  --active-color: #20a5d6;\n  --hover-color: #fff;\n  --ui-gray: #263340;\n  --ui-gray-dark: #16202b;\n  --ui-gray-darkest: #14202a;\n  --ui-gray-darker: #151a1f;\n  --ui-gray-light: #516873;\n  --text-primary-color: #fff;\n}\n.form-themed table {\n  color: var(--text-primary-color);\n}\n.form-themed table th,\n.form-themed table td {\n  font-size: 15px;\n  font-weight: normal;\n}\n.form-themed table th {\n  line-height: 60px;\n}\n.form-themed table td {\n  line-height: 18px;\n}\n.form-themed .p-r-1 {\n  padding-right: 1rem !important;\n}\n.form-themed label {\n  margin-bottom: 5px;\n}\n.form-themed label.wrapperLabel {\n  cursor: pointer;\n}\n.form-themed label.wrapperLabel:not(.checkboxLabel) {\n  cursor: pointer;\n  display: flex;\n  flex-direction: column;\n}\n.form-themed label.wrapperLabel:not(.checkboxLabel) .wrapperText {\n  display: block;\n  order: -1;\n}\n.form-themed .btn[disabled],\n.form-themed input[type=text][disabled],\n.form-themed input[type=password][disabled],\n.form-themed input[type=number][disabled],\n.form-themed .btn.disabled,\n.form-themed input[type=text].disabled,\n.form-themed input[type=password].disabled,\n.form-themed input[type=number].disabled,\n.form-themed .btn[disabled]:hover,\n.form-themed input[type=text][disabled]:hover,\n.form-themed input[type=password][disabled]:hover,\n.form-themed input[type=number][disabled]:hover,\n.form-themed .btn.disabled:hover,\n.form-themed input[type=text].disabled:hover,\n.form-themed input[type=password].disabled:hover,\n.form-themed input[type=number].disabled:hover,\n.form-themed .btn[disabled]:active,\n.form-themed input[type=text][disabled]:active,\n.form-themed input[type=password][disabled]:active,\n.form-themed input[type=number][disabled]:active,\n.form-themed .btn.disabled:active,\n.form-themed input[type=text].disabled:active,\n.form-themed input[type=password].disabled:active,\n.form-themed input[type=number].disabled:active {\n  background-color: var(--ui-gray-darker);\n  border-color: var(--ui-gray-light);\n  color: var(--text-primary-color);\n}\n.form-themed .btn[disabled] + .wrapperText,\n.form-themed input[type=text][disabled] + .wrapperText,\n.form-themed input[type=password][disabled] + .wrapperText,\n.form-themed input[type=number][disabled] + .wrapperText,\n.form-themed .btn.disabled + .wrapperText,\n.form-themed input[type=text].disabled + .wrapperText,\n.form-themed input[type=password].disabled + .wrapperText,\n.form-themed input[type=number].disabled + .wrapperText,\n.form-themed .btn[disabled]:hover + .wrapperText,\n.form-themed input[type=text][disabled]:hover + .wrapperText,\n.form-themed input[type=password][disabled]:hover + .wrapperText,\n.form-themed input[type=number][disabled]:hover + .wrapperText,\n.form-themed .btn.disabled:hover + .wrapperText,\n.form-themed input[type=text].disabled:hover + .wrapperText,\n.form-themed input[type=password].disabled:hover + .wrapperText,\n.form-themed input[type=number].disabled:hover + .wrapperText,\n.form-themed .btn[disabled]:active + .wrapperText,\n.form-themed input[type=text][disabled]:active + .wrapperText,\n.form-themed input[type=password][disabled]:active + .wrapperText,\n.form-themed input[type=number][disabled]:active + .wrapperText,\n.form-themed .btn.disabled:active + .wrapperText,\n.form-themed input[type=text].disabled:active + .wrapperText,\n.form-themed input[type=password].disabled:active + .wrapperText,\n.form-themed input[type=number].disabled:active + .wrapperText {\n  color: var(--text-primary-color);\n  cursor: auto;\n}\n.form-themed input[type=text],\n.form-themed input[type=password],\n.form-themed input[type=number] {\n  background-color: var(--ui-gray);\n  border-color: var(--ui-border-color);\n  color: var(--text-primary-color);\n  font-weight: normal;\n}\n.form-themed input[type=text]:active,\n.form-themed input[type=password]:active,\n.form-themed input[type=number]:active,\n.form-themed input[type=text]:focus,\n.form-themed input[type=password]:focus,\n.form-themed input[type=number]:focus {\n  background-color: var(--ui-gray-dark);\n  border: 2px solid var(--active-color);\n  box-shadow: none;\n}\n.form-themed input[type=text]:active + .wrapperText,\n.form-themed input[type=password]:active + .wrapperText,\n.form-themed input[type=number]:active + .wrapperText,\n.form-themed input[type=text]:focus + .wrapperText,\n.form-themed input[type=password]:focus + .wrapperText,\n.form-themed input[type=number]:focus + .wrapperText {\n  color: var(--active-color);\n}\n.form-themed .btn-primary {\n  background-color: var(--active-color);\n  border-collapse: var(--ui-border-color-active);\n  color: var(--ui-text-color-active);\n}\n.form-themed .btn-primary:hover,\n.form-themed .btn-primary:active,\n.form-themed .btn-primary:focus,\n.form-themed .btn-primary:focus:active {\n  background-color: var(--ui-active-color);\n  border-collapse: var(--ui-border-color-active);\n  color: var(--ui-text-color-active);\n}\n.form-themed .form-control {\n  background-color: #fff;\n  border: 0;\n  font-size: 14px;\n  height: 30px;\n  line-height: 16px;\n  padding: 8px 9px 6px;\n}\n:root {\n  --active-color: #20a5d6;\n}\n.nav-tabs {\n  border-bottom: 0;\n  margin-bottom: 3px;\n  position: relative;\n  z-index: 1;\n}\n.nav-tabs :hover {\n  cursor: pointer;\n}\n.nav-tabs>li {\n  font-size: 14px;\n  font-weight: normal;\n  height: 40px;\n  line-height: 40px;\n  margin-bottom: 0;\n}\n.nav-tabs>li>button {\n  display: block;\n  width: 100%;\n  line-height: inherit;\n  margin: 0;\n  height: inherit;\n  padding: 0 10px 0 10px;\n  outline: none;\n}\n.nav-tabs>li>button:after {\n  background-color: transparent;\n  bottom: -3px;\n  content: ' ';\n  display: block;\n  height: 3px;\n  width: 100%;\n}\n.nav-tabs>li>button,\n.nav-tabs>li.active>button,\n.nav-tabs>li>button:hover,\n.nav-tabs>li.active>button:hover,\n.nav-tabs>li>button:active,\n.nav-tabs>li.active>button:active,\n.nav-tabs>li>button:focus,\n.nav-tabs>li.active>button:focus {\n  color: var(--active-color);\n  background-color: transparent;\n  border: 0;\n}\n.nav-tabs>li.active>button {\n  font-weight: bold;\n}\n.nav-tabs>li.active>button:after {\n  background-color: var(--active-color);\n}\n:root {\n  --state-error: #fcc;\n  --state-error-border: #933;\n  --state-error-text: #fcc;\n}\n.form-themed .state-error.wrapperLabel input + .wrapperText,\n.state-error.wrapperLabel input + .wrapperText {\n  color: var(--state-error-text);\n}\n.form-themed .state-error+.tooltip .tooltip-inner,\n.state-error+.tooltip .tooltip-inner {\n  color: #fff;\n  background-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.top .tooltip-arrow,\n.state-error+.tooltip.top .tooltip-arrow {\n  border-top-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.right .tooltip-arrow,\n.state-error+.tooltip.right .tooltip-arrow {\n  border-right-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.bottom .tooltip-arrow,\n.state-error+.tooltip.bottom .tooltip-arrow {\n  border-bottom-color: var(--state-error-border);\n}\n.form-themed .state-error+.tooltip.left .tooltip-arrow,\n.state-error+.tooltip.left .tooltip-arrow {\n  border-left-color: var(--state-error-border);\n}\n.form-themed .state-error:not(.component-group).form-control,\n.state-error:not(.component-group).form-control,\n.form-themed .state-error:not(.component-group) .form-control,\n.state-error:not(.component-group) .form-control {\n  background-color: var(--state-error-border);\n  border-color: var(--state-error-border);\n}\n.full-width {\n  width: 100%;\n}\n.full-height {\n  height: 100%;\n}\n.flex-h {\n  display: flex;\n  flex-direction: row;\n}\n.flex-v {\n  display: flex;\n  flex-direction: column;\n}\n.flex-grow {\n  flex-grow: 1;\n}\n.nowrap {\n  white-space: nowrap;\n}\n.modal-body {\n  overflow: hidden;\n}\n.errorMessage {\n  color: var(--state-error-text);\n  font-size: 10px;\n  text-transform: uppercase;\n}\n.form-content {\n  border-bottom: 3px solid var(--primary-background-color);\n  margin-bottom: 20px;\n  margin-left: -22px;\n  margin-right: -22px;\n  max-height: 70vh;\n  overflow-y: auto;\n  padding: 22px;\n}\n.popover {\n  width: 300px;\n}\n";styleInject(css$n);var UserPreferences=/*#__PURE__*/function(_Component){_inherits$c(UserPreferences,_Component);function UserPreferences(){var _getPrototypeOf2;var _this;_classCallCheck$c(this,UserPreferences);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn$c(this,(_getPrototypeOf2=_getPrototypeOf$1(UserPreferences)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"state",{tabIndex:0});return _this;}_createClass$2(UserPreferences,[{key:"tabClick",value:function tabClick(tabIndex){this.setState({tabIndex:tabIndex});}},{key:"renderHotkeysTab",value:function renderHotkeysTab(){return React__default.createElement("form",{className:"form-themed themed"},React__default.createElement("div",{className:"form-content"},React__default.createElement(HotKeysPreferences,{hotKeysData:this.props.hotKeysData})));}},{key:"renderWindowLevelTab",value:function renderWindowLevelTab(){if(this.props.windowLevelData){return React__default.createElement("form",{className:"form-themed themed"},React__default.createElement("div",{className:"form-content"},React__default.createElement(WindowLevelPreferences,{windowLevelData:this.props.windowLevelData})));}}},{key:"renderTabs",value:function renderTabs(tabIndex){if(tabIndex===0){return this.renderHotkeysTab();}else{return this.renderWindowLevelTab();}}},{key:"getTabClass",value:function getTabClass(tabIndex){return tabIndex===this.state.tabIndex?'nav-link active':'nav-link';}},{key:"render",value:function render(){var _this2=this;return React__default.createElement("div",null,React__default.createElement("div",{className:"dialog-separator-after"},React__default.createElement("ul",{className:"nav nav-tabs"},React__default.createElement("li",{onClick:function onClick(){_this2.tabClick(0);},className:this.getTabClass(0)},React__default.createElement("button",null,"Hotkeys")),React__default.createElement("li",{onClick:function onClick(){_this2.tabClick(1);},className:this.getTabClass(1)},React__default.createElement("button",null,"Window Level")))),this.renderTabs(this.state.tabIndex));}}]);return UserPreferences;}(React.Component);_defineProperty$3(UserPreferences,"defaultProps",{hotKeysData:{},windowLevelData:{}});_defineProperty$3(UserPreferences,"propTypes",{hotKeysData:propTypes$1.object.isRequired,windowLevelData:propTypes$1.object.isRequired});var createChainableTypeChecker_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=createChainableTypeChecker;/**
   * Copyright 2013-present, Facebook, Inc.
   * All rights reserved.
   *
   * This source code is licensed under the BSD-style license found in the
   * LICENSE file in the root directory of this source tree. An additional grant
   * of patent rights can be found in the PATENTS file in the same directory.
   */ // Mostly taken from ReactPropTypes.
  function createChainableTypeChecker(validate){function checkType(isRequired,props,propName,componentName,location,propFullName){var componentNameSafe=componentName||'<<anonymous>>';var propFullNameSafe=propFullName||propName;if(props[propName]==null){if(isRequired){return new Error('Required '+location+' `'+propFullNameSafe+'` was not specified '+('in `'+componentNameSafe+'`.'));}return null;}for(var _len=arguments.length,args=Array(_len>6?_len-6:0),_key=6;_key<_len;_key++){args[_key-6]=arguments[_key];}return validate.apply(undefined,[props,propName,componentNameSafe,location,propFullNameSafe].concat(args));}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType;}module.exports=exports['default'];});unwrapExports$2(createChainableTypeChecker_1);var componentOrElement=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _react2=_interopRequireDefault(React__default);var _createChainableTypeChecker2=_interopRequireDefault(createChainableTypeChecker_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=typeof propValue==='undefined'?'undefined':_typeof(propValue);if(_react2.default.isValidElement(propValue)){return new Error('Invalid '+location+' `'+propFullName+'` of type ReactElement '+('supplied to `'+componentName+'`, expected a ReactComponent or a ')+'DOMElement. You can usually obtain a ReactComponent or DOMElement '+'from a ReactElement by attaching a ref to it.');}if((propType!=='object'||typeof propValue.render!=='function')&&propValue.nodeType!==1){return new Error('Invalid '+location+' `'+propFullName+'` of value `'+propValue+'` '+('supplied to `'+componentName+'`, expected a ReactComponent or a ')+'DOMElement.');}return null;}exports.default=(0, _createChainableTypeChecker2.default)(validate);module.exports=exports['default'];});unwrapExports$2(componentOrElement);var interopRequireDefault=createCommonjsModule$2(function(module){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}module.exports=_interopRequireDefault;});unwrapExports$2(interopRequireDefault);var ownerDocument_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=ownerDocument;function ownerDocument(node){return node&&node.ownerDocument||document;}module.exports=exports["default"];});unwrapExports$2(ownerDocument_1);var activeElement_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=activeElement;var _ownerDocument=interopRequireDefault(ownerDocument_1);function activeElement(doc){if(doc===void 0){doc=(0, _ownerDocument.default)();}try{return doc.activeElement;}catch(e){/* ie throws if no active element */}}module.exports=exports["default"];});unwrapExports$2(activeElement_1);var inDOM=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=void 0;var _default=!!(typeof window!=='undefined'&&window.document&&window.document.createElement);exports.default=_default;module.exports=exports["default"];});unwrapExports$2(inDOM);var contains=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=void 0;var _inDOM=interopRequireDefault(inDOM);var _default=function(){// HTML DOM and SVG DOM may have different support levels,
  // so we need to check on context instead of a document root element.
  return _inDOM.default?function(context,node){if(context.contains){return context.contains(node);}else if(context.compareDocumentPosition){return context===node||!!(context.compareDocumentPosition(node)&16);}else{return fallback(context,node);}}:fallback;}();exports.default=_default;function fallback(context,node){if(node)do{if(node===context)return true;}while(node=node.parentNode);return false;}module.exports=exports["default"];});unwrapExports$2(contains);/**
   * Copyright 2014-2015, Facebook, Inc.
   * All rights reserved.
   *
   * This source code is licensed under the BSD-style license found in the
   * LICENSE file in the root directory of this source tree. An additional grant
   * of patent rights can be found in the PATENTS file in the same directory.
   */ /**
   * Similar to invariant but only logs a warning if the condition is not met.
   * This can be used to log issues in development environments in critical
   * paths. Removing the logging code for production environments will keep the
   * same logic and follow the same code paths.
   */var __DEV__$3=process.env.NODE_ENV!=='production';var warning$1$1=function(){};if(__DEV__$3){warning$1$1=function(condition,format,args){var len=arguments.length;args=new Array(len>2?len-2:0);for(var key=2;key<len;key++){args[key-2]=arguments[key];}if(format===undefined){throw new Error('`warning(condition, format, ...args)` requires a warning '+'message argument');}if(format.length<10||/^[s\W]*$/.test(format)){throw new Error('The warning format should be able to uniquely identify this '+'warning. Please, use a more descriptive format than: '+format);}if(!condition){var argIndex=0;var message='Warning: '+format.replace(/%s/g,function(){return args[argIndex++];});if(typeof console!=='undefined'){console.error(message);}try{// This error was thrown as a convenience so that you can use this stack
  // to find the callsite that caused this warning to fire.
  throw new Error(message);}catch(x){}}};}var warning_1$3=warning$1$1;var deprecated_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=deprecated;var _warning2=_interopRequireDefault(warning_1$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var warned={};function deprecated(validator,reason){return function validate(props,propName,componentName,location,propFullName){var componentNameSafe=componentName||'<<anonymous>>';var propFullNameSafe=propFullName||propName;if(props[propName]!=null){var messageKey=componentName+'.'+propName;(0, _warning2.default)(warned[messageKey],'The '+location+' `'+propFullNameSafe+'` of '+('`'+componentNameSafe+'` is deprecated. '+reason+'.'));warned[messageKey]=true;}for(var _len=arguments.length,args=Array(_len>5?_len-5:0),_key=5;_key<_len;_key++){args[_key-5]=arguments[_key];}return validator.apply(undefined,[props,propName,componentName,location,propFullName].concat(args));};}/* eslint-disable no-underscore-dangle */function _resetWarned(){warned={};}deprecated._resetWarned=_resetWarned;/* eslint-enable no-underscore-dangle */module.exports=exports['default'];});unwrapExports$2(deprecated_1);var elementType_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _react2=_interopRequireDefault(React__default);var _createChainableTypeChecker2=_interopRequireDefault(createChainableTypeChecker_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function elementType(props,propName,componentName,location,propFullName){var propValue=props[propName];if(_react2.default.isValidElement(propValue)){return new Error('Invalid '+location+' `'+propFullName+'` of type ReactElement '+('supplied to `'+componentName+'`,expected an element type (a string ')+', component class, or function component).');}if(!(0, reactIs$1.isValidElementType)(propValue)){return new Error('Invalid '+location+' `'+propFullName+'` of value `'+propValue+'` '+('supplied to `'+componentName+'`, expected an element type (a string ')+', component class, or function component).');}return null;}exports.default=(0, _createChainableTypeChecker2.default)(elementType);module.exports=exports['default'];});unwrapExports$2(elementType_1);var hasClass_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=hasClass;function hasClass(element,className){if(element.classList)return !!className&&element.classList.contains(className);else return (" "+(element.className.baseVal||element.className)+" ").indexOf(" "+className+" ")!==-1;}module.exports=exports["default"];});unwrapExports$2(hasClass_1);var addClass_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=addClass;var _hasClass=interopRequireDefault(hasClass_1);function addClass(element,className){if(element.classList)element.classList.add(className);else if(!(0, _hasClass.default)(element,className))if(typeof element.className==='string')element.className=element.className+' '+className;else element.setAttribute('class',(element.className&&element.className.baseVal||'')+' '+className);}module.exports=exports["default"];});unwrapExports$2(addClass_1);function replaceClassName(origClass,classToRemove){return origClass.replace(new RegExp('(^|\\s)'+classToRemove+'(?:\\s|$)','g'),'$1').replace(/\s+/g,' ').replace(/^\s*|\s*$/g,'');}var removeClass=function removeClass(element,className){if(element.classList)element.classList.remove(className);else if(typeof element.className==='string')element.className=replaceClassName(element.className,className);else element.setAttribute('class',replaceClassName(element.className&&element.className.baseVal||'',className));};var _class=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=void 0;var _addClass=interopRequireDefault(addClass_1);exports.addClass=_addClass.default;var _removeClass=interopRequireDefault(removeClass);exports.removeClass=_removeClass.default;var _hasClass=interopRequireDefault(hasClass_1);exports.hasClass=_hasClass.default;var _default={addClass:_addClass.default,removeClass:_removeClass.default,hasClass:_hasClass.default};exports.default=_default;});unwrapExports$2(_class);var _class_1=_class.addClass;var _class_2=_class.removeClass;var _class_3=_class.hasClass;var camelize_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=camelize;var rHyphen=/-(.)/g;function camelize(string){return string.replace(rHyphen,function(_,chr){return chr.toUpperCase();});}module.exports=exports["default"];});unwrapExports$2(camelize_1);var camelizeStyle=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=camelizeStyleName;var _camelize=interopRequireDefault(camelize_1);/**
   * Copyright 2014-2015, Facebook, Inc.
   * All rights reserved.
   * https://github.com/facebook/react/blob/2aeb8a2a6beb00617a4217f7f8284924fa2ad819/src/vendor/core/camelizeStyleName.js
   */var msPattern=/^-ms-/;function camelizeStyleName(string){return (0, _camelize.default)(string.replace(msPattern,'ms-'));}module.exports=exports["default"];});unwrapExports$2(camelizeStyle);var hyphenate_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=hyphenate;var rUpper=/([A-Z])/g;function hyphenate(string){return string.replace(rUpper,'-$1').toLowerCase();}module.exports=exports["default"];});unwrapExports$2(hyphenate_1);var hyphenateStyle=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=hyphenateStyleName;var _hyphenate=interopRequireDefault(hyphenate_1);/**
   * Copyright 2013-2014, Facebook, Inc.
   * All rights reserved.
   * https://github.com/facebook/react/blob/2aeb8a2a6beb00617a4217f7f8284924fa2ad819/src/vendor/core/hyphenateStyleName.js
   */var msPattern=/^ms-/;function hyphenateStyleName(string){return (0, _hyphenate.default)(string).replace(msPattern,'-ms-');}module.exports=exports["default"];});unwrapExports$2(hyphenateStyle);var getComputedStyle=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=_getComputedStyle;var _camelizeStyle=interopRequireDefault(camelizeStyle);var rposition=/^(top|right|bottom|left)$/;var rnumnonpx=/^([+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|))(?!px)[a-z%]+$/i;function _getComputedStyle(node){if(!node)throw new TypeError('No Element passed to `getComputedStyle()`');var doc=node.ownerDocument;return 'defaultView'in doc?doc.defaultView.opener?node.ownerDocument.defaultView.getComputedStyle(node,null):window.getComputedStyle(node,null):{//ie 8 "magic" from: https://github.com/jquery/jquery/blob/1.11-stable/src/css/curCSS.js#L72
  getPropertyValue:function getPropertyValue(prop){var style=node.style;prop=(0, _camelizeStyle.default)(prop);if(prop=='float')prop='styleFloat';var current=node.currentStyle[prop]||null;if(current==null&&style&&style[prop])current=style[prop];if(rnumnonpx.test(current)&&!rposition.test(prop)){// Remember the original values
  var left=style.left;var runStyle=node.runtimeStyle;var rsLeft=runStyle&&runStyle.left;// Put in the new values to get a computed value out
  if(rsLeft)runStyle.left=node.currentStyle.left;style.left=prop==='fontSize'?'1em':current;current=style.pixelLeft+'px';// Revert the changed values
  style.left=left;if(rsLeft)runStyle.left=rsLeft;}return current;}};}module.exports=exports["default"];});unwrapExports$2(getComputedStyle);var removeStyle_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=removeStyle;function removeStyle(node,key){return 'removeProperty'in node.style?node.style.removeProperty(key):node.style.removeAttribute(key);}module.exports=exports["default"];});unwrapExports$2(removeStyle_1);var properties=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=exports.animationEnd=exports.animationDelay=exports.animationTiming=exports.animationDuration=exports.animationName=exports.transitionEnd=exports.transitionDuration=exports.transitionDelay=exports.transitionTiming=exports.transitionProperty=exports.transform=void 0;var _inDOM=interopRequireDefault(inDOM);var transform='transform';exports.transform=transform;var prefix,transitionEnd,animationEnd;exports.animationEnd=animationEnd;exports.transitionEnd=transitionEnd;var transitionProperty,transitionDuration,transitionTiming,transitionDelay;exports.transitionDelay=transitionDelay;exports.transitionTiming=transitionTiming;exports.transitionDuration=transitionDuration;exports.transitionProperty=transitionProperty;var animationName,animationDuration,animationTiming,animationDelay;exports.animationDelay=animationDelay;exports.animationTiming=animationTiming;exports.animationDuration=animationDuration;exports.animationName=animationName;if(_inDOM.default){var _getTransitionPropert=getTransitionProperties();prefix=_getTransitionPropert.prefix;exports.transitionEnd=transitionEnd=_getTransitionPropert.transitionEnd;exports.animationEnd=animationEnd=_getTransitionPropert.animationEnd;exports.transform=transform=prefix+"-"+transform;exports.transitionProperty=transitionProperty=prefix+"-transition-property";exports.transitionDuration=transitionDuration=prefix+"-transition-duration";exports.transitionDelay=transitionDelay=prefix+"-transition-delay";exports.transitionTiming=transitionTiming=prefix+"-transition-timing-function";exports.animationName=animationName=prefix+"-animation-name";exports.animationDuration=animationDuration=prefix+"-animation-duration";exports.animationTiming=animationTiming=prefix+"-animation-delay";exports.animationDelay=animationDelay=prefix+"-animation-timing-function";}var _default={transform:transform,end:transitionEnd,property:transitionProperty,timing:transitionTiming,delay:transitionDelay,duration:transitionDuration};exports.default=_default;function getTransitionProperties(){var style=document.createElement('div').style;var vendorMap={O:function O(e){return "o"+e.toLowerCase();},Moz:function Moz(e){return e.toLowerCase();},Webkit:function Webkit(e){return "webkit"+e;},ms:function ms(e){return "MS"+e;}};var vendors=Object.keys(vendorMap);var transitionEnd,animationEnd;var prefix='';for(var i=0;i<vendors.length;i++){var vendor=vendors[i];if(vendor+"TransitionProperty"in style){prefix="-"+vendor.toLowerCase();transitionEnd=vendorMap[vendor]('TransitionEnd');animationEnd=vendorMap[vendor]('AnimationEnd');break;}}if(!transitionEnd&&'transitionProperty'in style)transitionEnd='transitionend';if(!animationEnd&&'animationName'in style)animationEnd='animationend';style=null;return {animationEnd:animationEnd,transitionEnd:transitionEnd,prefix:prefix};}});unwrapExports$2(properties);var properties_1=properties.animationEnd;var properties_2=properties.animationDelay;var properties_3=properties.animationTiming;var properties_4=properties.animationDuration;var properties_5=properties.animationName;var properties_6=properties.transitionEnd;var properties_7=properties.transitionDuration;var properties_8=properties.transitionDelay;var properties_9=properties.transitionTiming;var properties_10=properties.transitionProperty;var properties_11=properties.transform;var isTransform_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=isTransform;var supportedTransforms=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function isTransform(property){return !!(property&&supportedTransforms.test(property));}module.exports=exports["default"];});unwrapExports$2(isTransform_1);var style_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=style;var _camelizeStyle=interopRequireDefault(camelizeStyle);var _hyphenateStyle=interopRequireDefault(hyphenateStyle);var _getComputedStyle2=interopRequireDefault(getComputedStyle);var _removeStyle=interopRequireDefault(removeStyle_1);var _isTransform=interopRequireDefault(isTransform_1);function style(node,property,value){var css='';var transforms='';var props=property;if(typeof property==='string'){if(value===undefined){return node.style[(0, _camelizeStyle.default)(property)]||(0, _getComputedStyle2.default)(node).getPropertyValue((0, _hyphenateStyle.default)(property));}else{(props={})[property]=value;}}Object.keys(props).forEach(function(key){var value=props[key];if(!value&&value!==0){(0, _removeStyle.default)(node,(0, _hyphenateStyle.default)(key));}else if((0, _isTransform.default)(key)){transforms+=key+"("+value+") ";}else{css+=(0, _hyphenateStyle.default)(key)+": "+value+";";}});if(transforms){css+=properties.transform+": "+transforms+";";}node.style.cssText+=';'+css;}module.exports=exports["default"];});unwrapExports$2(style_1);var scrollbarSize_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=scrollbarSize;var _inDOM=interopRequireDefault(inDOM);var size;function scrollbarSize(recalc){if(!size&&size!==0||recalc){if(_inDOM.default){var scrollDiv=document.createElement('div');scrollDiv.style.position='absolute';scrollDiv.style.top='-9999px';scrollDiv.style.width='50px';scrollDiv.style.height='50px';scrollDiv.style.overflow='scroll';document.body.appendChild(scrollDiv);size=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv);}}return size;}module.exports=exports["default"];});unwrapExports$2(scrollbarSize_1);var isWindow=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=getWindow;function getWindow(node){return node===node.window?node:node.nodeType===9?node.defaultView||node.parentWindow:false;}module.exports=exports["default"];});unwrapExports$2(isWindow);var isOverflowing_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=isOverflowing;var _isWindow2=_interopRequireDefault(isWindow);var _ownerDocument2=_interopRequireDefault(ownerDocument_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function isBody(node){return node&&node.tagName.toLowerCase()==='body';}function bodyIsOverflowing(node){var doc=(0, _ownerDocument2.default)(node);var win=(0, _isWindow2.default)(doc);var fullWidth=win.innerWidth;// Support: ie8, no innerWidth
  if(!fullWidth){var documentElementRect=doc.documentElement.getBoundingClientRect();fullWidth=documentElementRect.right-Math.abs(documentElementRect.left);}return doc.body.clientWidth<fullWidth;}function isOverflowing(container){var win=(0, _isWindow2.default)(container);return win||isBody(container)?bodyIsOverflowing(container):container.scrollHeight>container.clientHeight;}module.exports=exports['default'];});unwrapExports$2(isOverflowing_1);var manageAriaHidden=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.ariaHidden=ariaHidden;exports.hideSiblings=hideSiblings;exports.showSiblings=showSiblings;var BLACKLIST=['template','script','style'];var isHidable=function isHidable(_ref){var nodeType=_ref.nodeType,tagName=_ref.tagName;return nodeType===1&&BLACKLIST.indexOf(tagName.toLowerCase())===-1;};var siblings=function siblings(container,mount,cb){mount=[].concat(mount);[].forEach.call(container.children,function(node){if(mount.indexOf(node)===-1&&isHidable(node)){cb(node);}});};function ariaHidden(show,node){if(!node){return;}if(show){node.setAttribute('aria-hidden','true');}else{node.removeAttribute('aria-hidden');}}function hideSiblings(container,mountNode){siblings(container,mountNode,function(node){return ariaHidden(true,node);});}function showSiblings(container,mountNode){siblings(container,mountNode,function(node){return ariaHidden(false,node);});}});unwrapExports$2(manageAriaHidden);var manageAriaHidden_1=manageAriaHidden.ariaHidden;var manageAriaHidden_2=manageAriaHidden.hideSiblings;var manageAriaHidden_3=manageAriaHidden.showSiblings;var ModalManager_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _class2=_interopRequireDefault(_class);var _style2=_interopRequireDefault(style_1);var _scrollbarSize2=_interopRequireDefault(scrollbarSize_1);var _isOverflowing2=_interopRequireDefault(isOverflowing_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function findIndexOf(arr,cb){var idx=-1;arr.some(function(d,i){if(cb(d,i)){idx=i;return true;}});return idx;}function findContainer(data,modal){return findIndexOf(data,function(d){return d.modals.indexOf(modal)!==-1;});}function setContainerStyle(state,container){var style={overflow:'hidden'};// we are only interested in the actual `style` here
  // becasue we will override it
  state.style={overflow:container.style.overflow,paddingRight:container.style.paddingRight};if(state.overflowing){// use computed style, here to get the real padding
  // to add our scrollbar width
  style.paddingRight=parseInt((0, _style2.default)(container,'paddingRight')||0,10)+(0, _scrollbarSize2.default)()+'px';}(0, _style2.default)(container,style);}function removeContainerStyle(_ref,container){var style=_ref.style;Object.keys(style).forEach(function(key){return container.style[key]=style[key];});}/**
   * Proper state managment for containers and the modals in those containers.
   *
   * @internal Used by the Modal to ensure proper styling of containers.
   */var ModalManager=function ModalManager(){var _this=this;var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$hideSiblingNode=_ref2.hideSiblingNodes,hideSiblingNodes=_ref2$hideSiblingNode===undefined?true:_ref2$hideSiblingNode,_ref2$handleContainer=_ref2.handleContainerOverflow,handleContainerOverflow=_ref2$handleContainer===undefined?true:_ref2$handleContainer;_classCallCheck(this,ModalManager);this.add=function(modal,container,className){var modalIdx=_this.modals.indexOf(modal);var containerIdx=_this.containers.indexOf(container);if(modalIdx!==-1){return modalIdx;}modalIdx=_this.modals.length;_this.modals.push(modal);if(_this.hideSiblingNodes){(0, manageAriaHidden.hideSiblings)(container,modal.mountNode);}if(containerIdx!==-1){_this.data[containerIdx].modals.push(modal);return modalIdx;}var data={modals:[modal],//right now only the first modal of a container will have its classes applied
  classes:className?className.split(/\s+/):[],overflowing:(0, _isOverflowing2.default)(container)};if(_this.handleContainerOverflow){setContainerStyle(data,container);}data.classes.forEach(_class2.default.addClass.bind(null,container));_this.containers.push(container);_this.data.push(data);return modalIdx;};this.remove=function(modal){var modalIdx=_this.modals.indexOf(modal);if(modalIdx===-1){return;}var containerIdx=findContainer(_this.data,modal);var data=_this.data[containerIdx];var container=_this.containers[containerIdx];data.modals.splice(data.modals.indexOf(modal),1);_this.modals.splice(modalIdx,1);// if that was the last modal in a container,
  // clean up the container
  if(data.modals.length===0){data.classes.forEach(_class2.default.removeClass.bind(null,container));if(_this.handleContainerOverflow){removeContainerStyle(data,container);}if(_this.hideSiblingNodes){(0, manageAriaHidden.showSiblings)(container,modal.mountNode);}_this.containers.splice(containerIdx,1);_this.data.splice(containerIdx,1);}else if(_this.hideSiblingNodes){//otherwise make sure the next top modal is visible to a SR
  (0, manageAriaHidden.ariaHidden)(false,data.modals[data.modals.length-1].mountNode);}};this.isTopModal=function(modal){return !!_this.modals.length&&_this.modals[_this.modals.length-1]===modal;};this.hideSiblingNodes=hideSiblingNodes;this.handleContainerOverflow=handleContainerOverflow;this.modals=[];this.containers=[];this.data=[];};exports.default=ModalManager;module.exports=exports['default'];});unwrapExports$2(ModalManager_1);var getContainer_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=getContainer;var _reactDom2=_interopRequireDefault(reactDom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function getContainer(container,defaultContainer){container=typeof container==='function'?container():container;return _reactDom2.default.findDOMNode(container)||defaultContainer;}module.exports=exports['default'];});unwrapExports$2(getContainer_1);var ownerDocument$1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=function(componentOrElement){return (0, _ownerDocument2.default)(_reactDom2.default.findDOMNode(componentOrElement));};var _reactDom2=_interopRequireDefault(reactDom);var _ownerDocument2=_interopRequireDefault(ownerDocument_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}module.exports=exports['default'];});unwrapExports$2(ownerDocument$1);var LegacyPortal=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _propTypes2=_interopRequireDefault(propTypes$1);var _componentOrElement2=_interopRequireDefault(componentOrElement);var _react2=_interopRequireDefault(React__default);var _reactDom2=_interopRequireDefault(reactDom);var _getContainer2=_interopRequireDefault(getContainer_1);var _ownerDocument2=_interopRequireDefault(ownerDocument$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}/**
   * The `<Portal/>` component renders its children into a new "subtree" outside of current component hierarchy.
   * You can think of it as a declarative `appendChild()`, or jQuery's `$.fn.appendTo()`.
   * The children of `<Portal/>` component will be appended to the `container` specified.
   */var Portal=function(_React$Component){_inherits(Portal,_React$Component);function Portal(){var _temp,_this,_ret;_classCallCheck(this,Portal);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,_React$Component.call.apply(_React$Component,[this].concat(args))),_this),_this._mountOverlayTarget=function(){if(!_this._overlayTarget){_this._overlayTarget=document.createElement('div');_this._portalContainerNode=(0, _getContainer2.default)(_this.props.container,(0, _ownerDocument2.default)(_this).body);_this._portalContainerNode.appendChild(_this._overlayTarget);}},_this._unmountOverlayTarget=function(){if(_this._overlayTarget){_this._portalContainerNode.removeChild(_this._overlayTarget);_this._overlayTarget=null;}_this._portalContainerNode=null;},_this._renderOverlay=function(){var overlay=!_this.props.children?null:_react2.default.Children.only(_this.props.children);// Save reference for future access.
  if(overlay!==null){_this._mountOverlayTarget();var initialRender=!_this._overlayInstance;_this._overlayInstance=_reactDom2.default.unstable_renderSubtreeIntoContainer(_this,overlay,_this._overlayTarget,function(){if(initialRender&&_this.props.onRendered){_this.props.onRendered();}});}else{// Unrender if the component is null for transitions to null
  _this._unrenderOverlay();_this._unmountOverlayTarget();}},_this._unrenderOverlay=function(){if(_this._overlayTarget){_reactDom2.default.unmountComponentAtNode(_this._overlayTarget);_this._overlayInstance=null;}},_this.getMountNode=function(){return _this._overlayTarget;},_temp),_possibleConstructorReturn(_this,_ret);}Portal.prototype.componentDidMount=function componentDidMount(){this._isMounted=true;this._renderOverlay();};Portal.prototype.componentDidUpdate=function componentDidUpdate(){this._renderOverlay();};Portal.prototype.componentWillReceiveProps=function componentWillReceiveProps(nextProps){if(this._overlayTarget&&nextProps.container!==this.props.container){this._portalContainerNode.removeChild(this._overlayTarget);this._portalContainerNode=(0, _getContainer2.default)(nextProps.container,(0, _ownerDocument2.default)(this).body);this._portalContainerNode.appendChild(this._overlayTarget);}};Portal.prototype.componentWillUnmount=function componentWillUnmount(){this._isMounted=false;this._unrenderOverlay();this._unmountOverlayTarget();};Portal.prototype.render=function render(){return null;};return Portal;}(_react2.default.Component);Portal.displayName='Portal';Portal.propTypes={/**
     * A Node, Component instance, or function that returns either. The `container` will have the Portal children
     * appended to it.
     */container:_propTypes2.default.oneOfType([_componentOrElement2.default,_propTypes2.default.func]),onRendered:_propTypes2.default.func};exports.default=Portal;module.exports=exports['default'];});unwrapExports$2(LegacyPortal);var Portal_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _propTypes2=_interopRequireDefault(propTypes$1);var _componentOrElement2=_interopRequireDefault(componentOrElement);var _react2=_interopRequireDefault(React__default);var _reactDom2=_interopRequireDefault(reactDom);var _getContainer2=_interopRequireDefault(getContainer_1);var _ownerDocument2=_interopRequireDefault(ownerDocument$1);var _LegacyPortal2=_interopRequireDefault(LegacyPortal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}/**
   * The `<Portal/>` component renders its children into a new "subtree" outside of current component hierarchy.
   * You can think of it as a declarative `appendChild()`, or jQuery's `$.fn.appendTo()`.
   * The children of `<Portal/>` component will be appended to the `container` specified.
   */var Portal=function(_React$Component){_inherits(Portal,_React$Component);function Portal(){var _temp,_this,_ret;_classCallCheck(this,Portal);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,_React$Component.call.apply(_React$Component,[this].concat(args))),_this),_this.setContainer=function(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.props;_this._portalContainerNode=(0, _getContainer2.default)(props.container,(0, _ownerDocument2.default)(_this).body);},_this.getMountNode=function(){return _this._portalContainerNode;},_temp),_possibleConstructorReturn(_this,_ret);}Portal.prototype.componentDidMount=function componentDidMount(){this.setContainer();this.forceUpdate(this.props.onRendered);};Portal.prototype.componentWillReceiveProps=function componentWillReceiveProps(nextProps){if(nextProps.container!==this.props.container){this.setContainer(nextProps);}};Portal.prototype.componentWillUnmount=function componentWillUnmount(){this._portalContainerNode=null;};Portal.prototype.render=function render(){return this.props.children&&this._portalContainerNode?_reactDom2.default.createPortal(this.props.children,this._portalContainerNode):null;};return Portal;}(_react2.default.Component);Portal.displayName='Portal';Portal.propTypes={/**
     * A Node, Component instance, or function that returns either. The `container` will have the Portal children
     * appended to it.
     */container:_propTypes2.default.oneOfType([_componentOrElement2.default,_propTypes2.default.func]),onRendered:_propTypes2.default.func};exports.default=_reactDom2.default.createPortal?Portal:_LegacyPortal2.default;module.exports=exports['default'];});unwrapExports$2(Portal_1);var RefHolder_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _propTypes2=_interopRequireDefault(propTypes$1);var _react2=_interopRequireDefault(React__default);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var propTypes$$1={children:_propTypes2.default.node};/**
   * Internal helper component to allow attaching a non-conflicting ref to a
   * child element that may not accept refs.
   */var RefHolder=function(_React$Component){_inherits(RefHolder,_React$Component);function RefHolder(){_classCallCheck(this,RefHolder);return _possibleConstructorReturn(this,_React$Component.apply(this,arguments));}RefHolder.prototype.render=function render(){return this.props.children;};return RefHolder;}(_react2.default.Component);RefHolder.propTypes=propTypes$$1;exports.default=RefHolder;module.exports=exports['default'];});unwrapExports$2(RefHolder_1);var on_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=void 0;var _inDOM=interopRequireDefault(inDOM);var on=function on(){};if(_inDOM.default){on=function(){if(document.addEventListener)return function(node,eventName,handler,capture){return node.addEventListener(eventName,handler,capture||false);};else if(document.attachEvent)return function(node,eventName,handler){return node.attachEvent('on'+eventName,function(e){e=e||window.event;e.target=e.target||e.srcElement;e.currentTarget=node;handler.call(node,e);});};}();}var _default=on;exports.default=_default;module.exports=exports["default"];});unwrapExports$2(on_1);var off_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=void 0;var _inDOM=interopRequireDefault(inDOM);var off=function off(){};if(_inDOM.default){off=function(){if(document.addEventListener)return function(node,eventName,handler,capture){return node.removeEventListener(eventName,handler,capture||false);};else if(document.attachEvent)return function(node,eventName,handler){return node.detachEvent('on'+eventName,handler);};}();}var _default=off;exports.default=_default;module.exports=exports["default"];});unwrapExports$2(off_1);var addEventListener$1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=function(node,event,handler,capture){(0, _on2.default)(node,event,handler,capture);return {remove:function remove(){(0, _off2.default)(node,event,handler,capture);}};};var _on2=_interopRequireDefault(on_1);var _off2=_interopRequireDefault(off_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}module.exports=exports['default'];});unwrapExports$2(addEventListener$1);var addFocusListener_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=addFocusListener;/**
   * Firefox doesn't have a focusin event so using capture is easiest way to get bubbling
   * IE8 can't do addEventListener, but does have onfocusin, so we use that in ie8
   *
   * We only allow one Listener at a time to avoid stack overflows
   */function addFocusListener(handler){var useFocusin=!document.addEventListener;var remove=void 0;if(useFocusin){document.attachEvent('onfocusin',handler);remove=function remove(){return document.detachEvent('onfocusin',handler);};}else{document.addEventListener('focus',handler,true);remove=function remove(){return document.removeEventListener('focus',handler,true);};}return {remove:remove};}module.exports=exports['default'];});unwrapExports$2(addFocusListener_1);var Modal_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _activeElement2=_interopRequireDefault(activeElement_1);var _contains2=_interopRequireDefault(contains);var _inDOM2=_interopRequireDefault(inDOM);var _propTypes2=_interopRequireDefault(propTypes$1);var _componentOrElement2=_interopRequireDefault(componentOrElement);var _deprecated2=_interopRequireDefault(deprecated_1);var _elementType2=_interopRequireDefault(elementType_1);var _react2=_interopRequireDefault(React__default);var _reactDom2=_interopRequireDefault(reactDom);var _warning2=_interopRequireDefault(warning_1$3);var _ModalManager2=_interopRequireDefault(ModalManager_1);var _Portal2=_interopRequireDefault(Portal_1);var _RefHolder2=_interopRequireDefault(RefHolder_1);var _addEventListener2=_interopRequireDefault(addEventListener$1);var _addFocusListener2=_interopRequireDefault(addFocusListener_1);var _getContainer2=_interopRequireDefault(getContainer_1);var _ownerDocument2=_interopRequireDefault(ownerDocument$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}/* eslint-disable react/prop-types */var modalManager=new _ModalManager2.default();/**
   * Love them or hate them, `<Modal/>` provides a solid foundation for creating dialogs, lightboxes, or whatever else.
   * The Modal component renders its `children` node in front of a backdrop component.
   *
   * The Modal offers a few helpful features over using just a `<Portal/>` component and some styles:
   *
   * - Manages dialog stacking when one-at-a-time just isn't enough.
   * - Creates a backdrop, for disabling interaction below the modal.
   * - It properly manages focus; moving to the modal content, and keeping it there until the modal is closed.
   * - It disables scrolling of the page content while open.
   * - Adds the appropriate ARIA roles are automatically.
   * - Easily pluggable animations via a `<Transition/>` component.
   *
   * Note that, in the same way the backdrop element prevents users from clicking or interacting
   * with the page content underneath the Modal, Screen readers also need to be signaled to not to
   * interact with page content while the Modal is open. To do this, we use a common technique of applying
   * the `aria-hidden='true'` attribute to the non-Modal elements in the Modal `container`. This means that for
   * a Modal to be truly modal, it should have a `container` that is _outside_ your app's
   * React hierarchy (such as the default: document.body).
   */var Modal=function(_React$Component){_inherits(Modal,_React$Component);function Modal(){var _temp,_this,_ret;_classCallCheck(this,Modal);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,_React$Component.call.apply(_React$Component,[this].concat(args))),_this),_initialiseProps.call(_this),_temp),_possibleConstructorReturn(_this,_ret);}Modal.prototype.omitProps=function omitProps(props,propTypes$$1){var keys=Object.keys(props);var newProps={};keys.map(function(prop){if(!Object.prototype.hasOwnProperty.call(propTypes$$1,prop)){newProps[prop]=props[prop];}});return newProps;};Modal.prototype.render=function render(){var _props=this.props,show=_props.show,container=_props.container,children=_props.children,Transition=_props.transition,backdrop=_props.backdrop,className=_props.className,style=_props.style,onExit=_props.onExit,onExiting=_props.onExiting,onEnter=_props.onEnter,onEntering=_props.onEntering,onEntered=_props.onEntered;var dialog=_react2.default.Children.only(children);var filteredProps=this.omitProps(this.props,Modal.propTypes);var mountModal=show||Transition&&!this.state.exited;if(!mountModal){return null;}var _dialog$props=dialog.props,role=_dialog$props.role,tabIndex=_dialog$props.tabIndex;if(role===undefined||tabIndex===undefined){dialog=(0, React__default.cloneElement)(dialog,{role:role===undefined?'document':role,tabIndex:tabIndex==null?'-1':tabIndex});}if(Transition){dialog=_react2.default.createElement(Transition,{appear:true,unmountOnExit:true,'in':show,onExit:onExit,onExiting:onExiting,onExited:this.handleHidden,onEnter:onEnter,onEntering:onEntering,onEntered:onEntered},dialog);}return _react2.default.createElement(_Portal2.default,{ref:this.setMountNode,container:container,onRendered:this.onPortalRendered},_react2.default.createElement('div',_extends({ref:this.setModalNodeRef,role:role||'dialog'},filteredProps,{style:style,className:className}),backdrop&&this.renderBackdrop(),_react2.default.createElement(_RefHolder2.default,{ref:this.setDialogRef},dialog)));};Modal.prototype.componentWillReceiveProps=function componentWillReceiveProps(nextProps){if(nextProps.show){this.setState({exited:false});}else if(!nextProps.transition){// Otherwise let handleHidden take care of marking exited.
  this.setState({exited:true});}};Modal.prototype.componentWillUpdate=function componentWillUpdate(nextProps){if(!this.props.show&&nextProps.show){this.checkForFocus();}};Modal.prototype.componentDidMount=function componentDidMount(){this._isMounted=true;if(this.props.show){this.onShow();}};Modal.prototype.componentDidUpdate=function componentDidUpdate(prevProps){var transition=this.props.transition;if(prevProps.show&&!this.props.show&&!transition){// Otherwise handleHidden will call this.
  this.onHide();}else if(!prevProps.show&&this.props.show){this.onShow();}};Modal.prototype.componentWillUnmount=function componentWillUnmount(){var _props2=this.props,show=_props2.show,transition=_props2.transition;this._isMounted=false;if(show||transition&&!this.state.exited){this.onHide();}};Modal.prototype.autoFocus=function autoFocus(){if(!this.props.autoFocus){return;}var dialogElement=this.getDialogElement();var currentActiveElement=(0, _activeElement2.default)((0, _ownerDocument2.default)(this));if(dialogElement&&!(0, _contains2.default)(dialogElement,currentActiveElement)){this.lastFocus=currentActiveElement;if(!dialogElement.hasAttribute('tabIndex')){(0, _warning2.default)(false,'The modal content node does not accept focus. For the benefit of '+'assistive technologies, the tabIndex of the node is being set '+'to "-1".');dialogElement.setAttribute('tabIndex',-1);}dialogElement.focus();}};Modal.prototype.restoreLastFocus=function restoreLastFocus(){// Support: <=IE11 doesn't support `focus()` on svg elements (RB: #917)
  if(this.lastFocus&&this.lastFocus.focus){this.lastFocus.focus();this.lastFocus=null;}};Modal.prototype.getDialogElement=function getDialogElement(){return _reactDom2.default.findDOMNode(this.dialog);};Modal.prototype.isTopModal=function isTopModal(){return this.props.manager.isTopModal(this);};return Modal;}(_react2.default.Component);Modal.propTypes=_extends({},_Portal2.default.propTypes,{/**
     * Set the visibility of the Modal
     */show:_propTypes2.default.bool,/**
     * A Node, Component instance, or function that returns either. The Modal is appended to it's container element.
     *
     * For the sake of assistive technologies, the container should usually be the document body, so that the rest of the
     * page content can be placed behind a virtual backdrop as well as a visual one.
     */container:_propTypes2.default.oneOfType([_componentOrElement2.default,_propTypes2.default.func]),/**
     * A callback fired when the Modal is opening.
     */onShow:_propTypes2.default.func,/**
     * A callback fired when either the backdrop is clicked, or the escape key is pressed.
     *
     * The `onHide` callback only signals intent from the Modal,
     * you must actually set the `show` prop to `false` for the Modal to close.
     */onHide:_propTypes2.default.func,/**
     * Include a backdrop component.
     */backdrop:_propTypes2.default.oneOfType([_propTypes2.default.bool,_propTypes2.default.oneOf(['static'])]),/**
     * A function that returns a backdrop component. Useful for custom
     * backdrop rendering.
     *
     * ```js
     *  renderBackdrop={props => <MyBackdrop {...props} />}
     * ```
     */renderBackdrop:_propTypes2.default.func,/**
     * A callback fired when the escape key, if specified in `keyboard`, is pressed.
     */onEscapeKeyDown:_propTypes2.default.func,/**
     * Support for this function will be deprecated. Please use `onEscapeKeyDown` instead
     * A callback fired when the escape key, if specified in `keyboard`, is pressed.
     * @deprecated
     */onEscapeKeyUp:(0, _deprecated2.default)(_propTypes2.default.func,'Please use onEscapeKeyDown instead for consistency'),/**
     * A callback fired when the backdrop, if specified, is clicked.
     */onBackdropClick:_propTypes2.default.func,/**
     * A style object for the backdrop component.
     */backdropStyle:_propTypes2.default.object,/**
     * A css class or classes for the backdrop component.
     */backdropClassName:_propTypes2.default.string,/**
     * A css class or set of classes applied to the modal container when the modal is open,
     * and removed when it is closed.
     */containerClassName:_propTypes2.default.string,/**
     * Close the modal when escape key is pressed
     */keyboard:_propTypes2.default.bool,/**
     * A `react-transition-group@2.0.0` `<Transition/>` component used
     * to control animations for the dialog component.
     */transition:_elementType2.default,/**
     * A `react-transition-group@2.0.0` `<Transition/>` component used
     * to control animations for the backdrop components.
     */backdropTransition:_elementType2.default,/**
     * When `true` The modal will automatically shift focus to itself when it opens, and
     * replace it to the last focused element when it closes. This also
     * works correctly with any Modal children that have the `autoFocus` prop.
     *
     * Generally this should never be set to `false` as it makes the Modal less
     * accessible to assistive technologies, like screen readers.
     */autoFocus:_propTypes2.default.bool,/**
     * When `true` The modal will prevent focus from leaving the Modal while open.
     *
     * Generally this should never be set to `false` as it makes the Modal less
     * accessible to assistive technologies, like screen readers.
     */enforceFocus:_propTypes2.default.bool,/**
     * When `true` The modal will restore focus to previously focused element once
     * modal is hidden
     */restoreFocus:_propTypes2.default.bool,/**
     * Callback fired before the Modal transitions in
     */onEnter:_propTypes2.default.func,/**
     * Callback fired as the Modal begins to transition in
     */onEntering:_propTypes2.default.func,/**
     * Callback fired after the Modal finishes transitioning in
     */onEntered:_propTypes2.default.func,/**
     * Callback fired right before the Modal transitions out
     */onExit:_propTypes2.default.func,/**
     * Callback fired as the Modal begins to transition out
     */onExiting:_propTypes2.default.func,/**
     * Callback fired after the Modal finishes transitioning out
     */onExited:_propTypes2.default.func,/**
     * A ModalManager instance used to track and manage the state of open
     * Modals. Useful when customizing how modals interact within a container
     */manager:_propTypes2.default.object.isRequired});Modal.defaultProps={show:false,backdrop:true,keyboard:true,autoFocus:true,enforceFocus:true,restoreFocus:true,onHide:function onHide(){},manager:modalManager,renderBackdrop:function renderBackdrop(props){return _react2.default.createElement('div',props);}};var _initialiseProps=function _initialiseProps(){var _this2=this;this.state={exited:!this.props.show};this.renderBackdrop=function(){var _props3=_this2.props,backdropStyle=_props3.backdropStyle,backdropClassName=_props3.backdropClassName,renderBackdrop=_props3.renderBackdrop,Transition=_props3.backdropTransition;var backdropRef=function backdropRef(ref){return _this2.backdrop=ref;};var backdrop=renderBackdrop({ref:backdropRef,style:backdropStyle,className:backdropClassName,onClick:_this2.handleBackdropClick});if(Transition){backdrop=_react2.default.createElement(Transition,{appear:true,'in':_this2.props.show},backdrop);}return backdrop;};this.onPortalRendered=function(){_this2.autoFocus();if(_this2.props.onShow){_this2.props.onShow();}};this.onShow=function(){var doc=(0, _ownerDocument2.default)(_this2);var container=(0, _getContainer2.default)(_this2.props.container,doc.body);_this2.props.manager.add(_this2,container,_this2.props.containerClassName);_this2._onDocumentKeydownListener=(0, _addEventListener2.default)(doc,'keydown',_this2.handleDocumentKeyDown);_this2._onDocumentKeyupListener=(0, _addEventListener2.default)(doc,'keyup',_this2.handleDocumentKeyUp);_this2._onFocusinListener=(0, _addFocusListener2.default)(_this2.enforceFocus);};this.onHide=function(){_this2.props.manager.remove(_this2);_this2._onDocumentKeydownListener.remove();_this2._onDocumentKeyupListener.remove();_this2._onFocusinListener.remove();if(_this2.props.restoreFocus){_this2.restoreLastFocus();}};this.setMountNode=function(ref){_this2.mountNode=ref?ref.getMountNode():ref;};this.setModalNodeRef=function(ref){_this2.modalNode=ref;};this.setDialogRef=function(ref){_this2.dialog=ref;};this.handleHidden=function(){_this2.setState({exited:true});_this2.onHide();if(_this2.props.onExited){var _props4;(_props4=_this2.props).onExited.apply(_props4,arguments);}};this.handleBackdropClick=function(e){if(e.target!==e.currentTarget){return;}if(_this2.props.onBackdropClick){_this2.props.onBackdropClick(e);}if(_this2.props.backdrop===true){_this2.props.onHide();}};this.handleDocumentKeyDown=function(e){if(_this2.props.keyboard&&e.keyCode===27&&_this2.isTopModal()){if(_this2.props.onEscapeKeyDown){_this2.props.onEscapeKeyDown(e);}_this2.props.onHide();}};this.handleDocumentKeyUp=function(e){if(_this2.props.keyboard&&e.keyCode===27&&_this2.isTopModal()){if(_this2.props.onEscapeKeyUp){_this2.props.onEscapeKeyUp(e);}}};this.checkForFocus=function(){if(_inDOM2.default){_this2.lastFocus=(0, _activeElement2.default)();}};this.enforceFocus=function(){if(!_this2.props.enforceFocus||!_this2._isMounted||!_this2.isTopModal()){return;}var dialogElement=_this2.getDialogElement();var currentActiveElement=(0, _activeElement2.default)((0, _ownerDocument2.default)(_this2));if(dialogElement&&!(0, _contains2.default)(dialogElement,currentActiveElement)){dialogElement.focus();}};};Modal.Manager=_ModalManager2.default;exports.default=Modal;module.exports=exports['default'];});unwrapExports$2(Modal_1);/**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */function componentWillMount(){// Call this.constructor.gDSFP to support sub-classes.
  var state=this.constructor.getDerivedStateFromProps(this.props,this.state);if(state!==null&&state!==undefined){this.setState(state);}}function componentWillReceiveProps(nextProps){// Call this.constructor.gDSFP to support sub-classes.
  // Use the setState() updater to ensure state isn't stale in certain edge cases.
  function updater(prevState){var state=this.constructor.getDerivedStateFromProps(nextProps,prevState);return state!==null&&state!==undefined?state:null;}// Binding "this" is important for shallow renderer support.
  this.setState(updater.bind(this));}function componentWillUpdate(nextProps,nextState){try{var prevProps=this.props;var prevState=this.state;this.props=nextProps;this.state=nextState;this.__reactInternalSnapshotFlag=true;this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(prevProps,prevState);}finally{this.props=prevProps;this.state=prevState;}}// React may warn about cWM/cWRP/cWU methods being deprecated.
  // Add a flag to suppress these warnings for this special case.
  componentWillMount.__suppressDeprecationWarning=true;componentWillReceiveProps.__suppressDeprecationWarning=true;componentWillUpdate.__suppressDeprecationWarning=true;function polyfill(Component$$1){var prototype=Component$$1.prototype;if(!prototype||!prototype.isReactComponent){throw new Error('Can only polyfill class components');}if(typeof Component$$1.getDerivedStateFromProps!=='function'&&typeof prototype.getSnapshotBeforeUpdate!=='function'){return Component$$1;}// If new component APIs are defined, "unsafe" lifecycles won't be called.
  // Error if any of these lifecycles are present,
  // Because they would work differently between older and newer (16.3+) versions of React.
  var foundWillMountName=null;var foundWillReceivePropsName=null;var foundWillUpdateName=null;if(typeof prototype.componentWillMount==='function'){foundWillMountName='componentWillMount';}else if(typeof prototype.UNSAFE_componentWillMount==='function'){foundWillMountName='UNSAFE_componentWillMount';}if(typeof prototype.componentWillReceiveProps==='function'){foundWillReceivePropsName='componentWillReceiveProps';}else if(typeof prototype.UNSAFE_componentWillReceiveProps==='function'){foundWillReceivePropsName='UNSAFE_componentWillReceiveProps';}if(typeof prototype.componentWillUpdate==='function'){foundWillUpdateName='componentWillUpdate';}else if(typeof prototype.UNSAFE_componentWillUpdate==='function'){foundWillUpdateName='UNSAFE_componentWillUpdate';}if(foundWillMountName!==null||foundWillReceivePropsName!==null||foundWillUpdateName!==null){var componentName=Component$$1.displayName||Component$$1.name;var newApiName=typeof Component$$1.getDerivedStateFromProps==='function'?'getDerivedStateFromProps()':'getSnapshotBeforeUpdate()';throw Error('Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n'+componentName+' uses '+newApiName+' but also contains the following legacy lifecycles:'+(foundWillMountName!==null?'\n  '+foundWillMountName:'')+(foundWillReceivePropsName!==null?'\n  '+foundWillReceivePropsName:'')+(foundWillUpdateName!==null?'\n  '+foundWillUpdateName:'')+'\n\nThe above lifecycles should be removed. Learn more about this warning here:\n'+'https://fb.me/react-async-component-lifecycle-hooks');}// React <= 16.2 does not support static getDerivedStateFromProps.
  // As a workaround, use cWM and cWRP to invoke the new static lifecycle.
  // Newer versions of React will ignore these lifecycles if gDSFP exists.
  if(typeof Component$$1.getDerivedStateFromProps==='function'){prototype.componentWillMount=componentWillMount;prototype.componentWillReceiveProps=componentWillReceiveProps;}// React <= 16.2 does not support getSnapshotBeforeUpdate.
  // As a workaround, use cWU to invoke the new lifecycle.
  // Newer versions of React will ignore that lifecycle if gSBU exists.
  if(typeof prototype.getSnapshotBeforeUpdate==='function'){if(typeof prototype.componentDidUpdate!=='function'){throw new Error('Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype');}prototype.componentWillUpdate=componentWillUpdate;var componentDidUpdate=prototype.componentDidUpdate;prototype.componentDidUpdate=function componentDidUpdatePolyfill(prevProps,prevState,maybeSnapshot){// 16.3+ will not execute our will-update method;
  // It will pass a snapshot value to did-update though.
  // Older versions will require our polyfilled will-update value.
  // We need to handle both cases, but can't just check for the presence of "maybeSnapshot",
  // Because for <= 15.x versions this might be a "prevContext" object.
  // We also can't just check "__reactInternalSnapshot",
  // Because get-snapshot might return a falsy value.
  // So check for the explicit __reactInternalSnapshotFlag flag to determine behavior.
  var snapshot=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:maybeSnapshot;componentDidUpdate.call(this,prevProps,prevState,snapshot);};}return Component$$1;}var reactLifecyclesCompat_es=/*#__PURE__*/Object.freeze({polyfill:polyfill});var PropTypes=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.transitionTimeout=transitionTimeout;exports.classNamesShape=exports.timeoutsShape=void 0;var _propTypes=_interopRequireDefault(propTypes$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function transitionTimeout(transitionType){var timeoutPropName='transition'+transitionType+'Timeout';var enabledPropName='transition'+transitionType;return function(props){// If the transition is enabled
  if(props[enabledPropName]){// If no timeout duration is provided
  if(props[timeoutPropName]==null){return new Error(timeoutPropName+' wasn\'t supplied to CSSTransitionGroup: '+'this can cause unreliable animations and won\'t be supported in '+'a future version of React. See '+'https://fb.me/react-animation-transition-group-timeout for more '+'information.');// If the duration isn't a number
  }else if(typeof props[timeoutPropName]!=='number'){return new Error(timeoutPropName+' must be a number (in milliseconds)');}}return null;};}var timeoutsShape=_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number}).isRequired]);exports.timeoutsShape=timeoutsShape;var classNamesShape=_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.shape({enter:_propTypes.default.string,exit:_propTypes.default.string,active:_propTypes.default.string}),_propTypes.default.shape({enter:_propTypes.default.string,enterDone:_propTypes.default.string,enterActive:_propTypes.default.string,exit:_propTypes.default.string,exitDone:_propTypes.default.string,exitActive:_propTypes.default.string})]);exports.classNamesShape=classNamesShape;});unwrapExports$2(PropTypes);var PropTypes_1=PropTypes.transitionTimeout;var PropTypes_2=PropTypes.classNamesShape;var PropTypes_3=PropTypes.timeoutsShape;var Transition_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;exports.default=exports.EXITING=exports.ENTERED=exports.ENTERING=exports.EXITED=exports.UNMOUNTED=void 0;var PropTypes$$1=_interopRequireWildcard(propTypes$1);var _react=_interopRequireDefault(React__default);var _reactDom=_interopRequireDefault(reactDom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}}newObj.default=obj;return newObj;}}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return {};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass;}var UNMOUNTED='unmounted';exports.UNMOUNTED=UNMOUNTED;var EXITED='exited';exports.EXITED=EXITED;var ENTERING='entering';exports.ENTERING=ENTERING;var ENTERED='entered';exports.ENTERED=ENTERED;var EXITING='exiting';/**
   * The Transition component lets you describe a transition from one component
   * state to another _over time_ with a simple declarative API. Most commonly
   * it's used to animate the mounting and unmounting of a component, but can also
   * be used to describe in-place transition states as well.
   *
   * By default the `Transition` component does not alter the behavior of the
   * component it renders, it only tracks "enter" and "exit" states for the components.
   * It's up to you to give meaning and effect to those states. For example we can
   * add styles to a component when it enters or exits:
   *
   * ```jsx
   * import Transition from 'react-transition-group/Transition';
   *
   * const duration = 300;
   *
   * const defaultStyle = {
   *   transition: `opacity ${duration}ms ease-in-out`,
   *   opacity: 0,
   * }
   *
   * const transitionStyles = {
   *   entering: { opacity: 0 },
   *   entered:  { opacity: 1 },
   * };
   *
   * const Fade = ({ in: inProp }) => (
   *   <Transition in={inProp} timeout={duration}>
   *     {(state) => (
   *       <div style={{
   *         ...defaultStyle,
   *         ...transitionStyles[state]
   *       }}>
   *         I'm a fade Transition!
   *       </div>
   *     )}
   *   </Transition>
   * );
   * ```
   *
   * As noted the `Transition` component doesn't _do_ anything by itself to its child component.
   * What it does do is track transition states over time so you can update the
   * component (such as by adding styles or classes) when it changes states.
   *
   * There are 4 main states a Transition can be in:
   *  - `'entering'`
   *  - `'entered'`
   *  - `'exiting'`
   *  - `'exited'`
   *
   * Transition state is toggled via the `in` prop. When `true` the component begins the
   * "Enter" stage. During this stage, the component will shift from its current transition state,
   * to `'entering'` for the duration of the transition and then to the `'entered'` stage once
   * it's complete. Let's take the following example:
   *
   * ```jsx
   * state = { in: false };
   *
   * toggleEnterState = () => {
   *   this.setState({ in: true });
   * }
   *
   * render() {
   *   return (
   *     <div>
   *       <Transition in={this.state.in} timeout={500} />
   *       <button onClick={this.toggleEnterState}>Click to Enter</button>
   *     </div>
   *   );
   * }
   * ```
   *
   * When the button is clicked the component will shift to the `'entering'` state and
   * stay there for 500ms (the value of `timeout`) before it finally switches to `'entered'`.
   *
   * When `in` is `false` the same thing happens except the state moves from `'exiting'` to `'exited'`.
   *
   * ## Timing
   *
   * Timing is often the trickiest part of animation, mistakes can result in slight delays
   * that are hard to pin down. A common example is when you want to add an exit transition,
   * you should set the desired final styles when the state is `'exiting'`. That's when the
   * transition to those styles will start and, if you matched the `timeout` prop with the
   * CSS Transition duration, it will end exactly when the state changes to `'exited'`.
   *
   * > **Note**: For simpler transitions the `Transition` component might be enough, but
   * > take into account that it's platform-agnostic, while the `CSSTransition` component
   * > [forces reflows](https://github.com/reactjs/react-transition-group/blob/5007303e729a74be66a21c3e2205e4916821524b/src/CSSTransition.js#L208-L215)
   * > in order to make more complex transitions more predictable. For example, even though
   * > classes `example-enter` and `example-enter-active` are applied immediately one after
   * > another, you can still transition from one to the other because of the forced reflow
   * > (read [this issue](https://github.com/reactjs/react-transition-group/issues/159#issuecomment-322761171)
   * > for more info). Take this into account when choosing between `Transition` and
   * > `CSSTransition`.
   */exports.EXITING=EXITING;var Transition=/*#__PURE__*/function(_React$Component){_inheritsLoose(Transition,_React$Component);function Transition(props,context){var _this;_this=_React$Component.call(this,props,context)||this;var parentGroup=context.transitionGroup;// In the context of a TransitionGroup all enters are really appears
  var appear=parentGroup&&!parentGroup.isMounting?props.enter:props.appear;var initialStatus;_this.appearStatus=null;if(props.in){if(appear){initialStatus=EXITED;_this.appearStatus=ENTERING;}else{initialStatus=ENTERED;}}else{if(props.unmountOnExit||props.mountOnEnter){initialStatus=UNMOUNTED;}else{initialStatus=EXITED;}}_this.state={status:initialStatus};_this.nextCallback=null;return _this;}var _proto=Transition.prototype;_proto.getChildContext=function getChildContext(){return {transitionGroup:null// allows for nested Transitions
  };};Transition.getDerivedStateFromProps=function getDerivedStateFromProps(_ref,prevState){var nextIn=_ref.in;if(nextIn&&prevState.status===UNMOUNTED){return {status:EXITED};}return null;};// getSnapshotBeforeUpdate(prevProps) {
  //   let nextStatus = null
  //   if (prevProps !== this.props) {
  //     const { status } = this.state
  //     if (this.props.in) {
  //       if (status !== ENTERING && status !== ENTERED) {
  //         nextStatus = ENTERING
  //       }
  //     } else {
  //       if (status === ENTERING || status === ENTERED) {
  //         nextStatus = EXITING
  //       }
  //     }
  //   }
  //   return { nextStatus }
  // }
  _proto.componentDidMount=function componentDidMount(){this.updateStatus(true,this.appearStatus);};_proto.componentDidUpdate=function componentDidUpdate(prevProps){var nextStatus=null;if(prevProps!==this.props){var status=this.state.status;if(this.props.in){if(status!==ENTERING&&status!==ENTERED){nextStatus=ENTERING;}}else{if(status===ENTERING||status===ENTERED){nextStatus=EXITING;}}}this.updateStatus(false,nextStatus);};_proto.componentWillUnmount=function componentWillUnmount(){this.cancelNextCallback();};_proto.getTimeouts=function getTimeouts(){var timeout=this.props.timeout;var exit,enter,appear;exit=enter=appear=timeout;if(timeout!=null&&typeof timeout!=='number'){exit=timeout.exit;enter=timeout.enter;appear=timeout.appear;}return {exit:exit,enter:enter,appear:appear};};_proto.updateStatus=function updateStatus(mounting,nextStatus){if(mounting===void 0){mounting=false;}if(nextStatus!==null){// nextStatus will always be ENTERING or EXITING.
  this.cancelNextCallback();var node=_reactDom.default.findDOMNode(this);if(nextStatus===ENTERING){this.performEnter(node,mounting);}else{this.performExit(node);}}else if(this.props.unmountOnExit&&this.state.status===EXITED){this.setState({status:UNMOUNTED});}};_proto.performEnter=function performEnter(node,mounting){var _this2=this;var enter=this.props.enter;var appearing=this.context.transitionGroup?this.context.transitionGroup.isMounting:mounting;var timeouts=this.getTimeouts();// no enter animation skip right to ENTERED
  // if we are mounting and running this it means appear _must_ be set
  if(!mounting&&!enter){this.safeSetState({status:ENTERED},function(){_this2.props.onEntered(node);});return;}this.props.onEnter(node,appearing);this.safeSetState({status:ENTERING},function(){_this2.props.onEntering(node,appearing);// FIXME: appear timeout?
  _this2.onTransitionEnd(node,timeouts.enter,function(){_this2.safeSetState({status:ENTERED},function(){_this2.props.onEntered(node,appearing);});});});};_proto.performExit=function performExit(node){var _this3=this;var exit=this.props.exit;var timeouts=this.getTimeouts();// no exit animation skip right to EXITED
  if(!exit){this.safeSetState({status:EXITED},function(){_this3.props.onExited(node);});return;}this.props.onExit(node);this.safeSetState({status:EXITING},function(){_this3.props.onExiting(node);_this3.onTransitionEnd(node,timeouts.exit,function(){_this3.safeSetState({status:EXITED},function(){_this3.props.onExited(node);});});});};_proto.cancelNextCallback=function cancelNextCallback(){if(this.nextCallback!==null){this.nextCallback.cancel();this.nextCallback=null;}};_proto.safeSetState=function safeSetState(nextState,callback){// This shouldn't be necessary, but there are weird race conditions with
  // setState callbacks and unmounting in testing, so always make sure that
  // we can cancel any pending setState callbacks after we unmount.
  callback=this.setNextCallback(callback);this.setState(nextState,callback);};_proto.setNextCallback=function setNextCallback(callback){var _this4=this;var active=true;this.nextCallback=function(event){if(active){active=false;_this4.nextCallback=null;callback(event);}};this.nextCallback.cancel=function(){active=false;};return this.nextCallback;};_proto.onTransitionEnd=function onTransitionEnd(node,timeout,handler){this.setNextCallback(handler);if(node){if(this.props.addEndListener){this.props.addEndListener(node,this.nextCallback);}if(timeout!=null){setTimeout(this.nextCallback,timeout);}}else{setTimeout(this.nextCallback,0);}};_proto.render=function render(){var status=this.state.status;if(status===UNMOUNTED){return null;}var _this$props=this.props,children=_this$props.children,childProps=_objectWithoutPropertiesLoose(_this$props,["children"]);// filter props for Transtition
  delete childProps.in;delete childProps.mountOnEnter;delete childProps.unmountOnExit;delete childProps.appear;delete childProps.enter;delete childProps.exit;delete childProps.timeout;delete childProps.addEndListener;delete childProps.onEnter;delete childProps.onEntering;delete childProps.onEntered;delete childProps.onExit;delete childProps.onExiting;delete childProps.onExited;if(typeof children==='function'){return children(status,childProps);}var child=_react.default.Children.only(children);return _react.default.cloneElement(child,childProps);};return Transition;}(_react.default.Component);Transition.contextTypes={transitionGroup:PropTypes$$1.object};Transition.childContextTypes={transitionGroup:function transitionGroup(){}};Transition.propTypes=process.env.NODE_ENV!=="production"?{/**
     * A `function` child can be used instead of a React element.
     * This function is called with the current transition status
     * ('entering', 'entered', 'exiting', 'exited', 'unmounted'), which can be used
     * to apply context specific props to a component.
     *
     * ```jsx
     * <Transition timeout={150}>
     *   {(status) => (
     *     <MyComponent className={`fade fade-${status}`} />
     *   )}
     * </Transition>
     * ```
     */children:PropTypes$$1.oneOfType([PropTypes$$1.func.isRequired,PropTypes$$1.element.isRequired]).isRequired,/**
     * Show the component; triggers the enter or exit states
     */in:PropTypes$$1.bool,/**
     * By default the child component is mounted immediately along with
     * the parent `Transition` component. If you want to "lazy mount" the component on the
     * first `in={true}` you can set `mountOnEnter`. After the first enter transition the component will stay
     * mounted, even on "exited", unless you also specify `unmountOnExit`.
     */mountOnEnter:PropTypes$$1.bool,/**
     * By default the child component stays mounted after it reaches the `'exited'` state.
     * Set `unmountOnExit` if you'd prefer to unmount the component after it finishes exiting.
     */unmountOnExit:PropTypes$$1.bool,/**
     * Normally a component is not transitioned if it is shown when the `<Transition>` component mounts.
     * If you want to transition on the first mount set `appear` to `true`, and the
     * component will transition in as soon as the `<Transition>` mounts.
     *
     * > Note: there are no specific "appear" states. `appear` only adds an additional `enter` transition.
     */appear:PropTypes$$1.bool,/**
     * Enable or disable enter transitions.
     */enter:PropTypes$$1.bool,/**
     * Enable or disable exit transitions.
     */exit:PropTypes$$1.bool,/**
     * The duration of the transition, in milliseconds.
     * Required unless `addEndListener` is provided
     *
     * You may specify a single timeout for all transitions like: `timeout={500}`,
     * or individually like:
     *
     * ```jsx
     * timeout={{
     *  enter: 300,
     *  exit: 500,
     * }}
     * ```
     *
     * @type {number | { enter?: number, exit?: number }}
     */timeout:function timeout(props){var pt=process.env.NODE_ENV!=="production"?PropTypes.timeoutsShape:{};if(!props.addEndListener)pt=pt.isRequired;for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return pt.apply(void 0,[props].concat(args));},/**
     * Add a custom transition end trigger. Called with the transitioning
     * DOM node and a `done` callback. Allows for more fine grained transition end
     * logic. **Note:** Timeouts are still used as a fallback if provided.
     *
     * ```jsx
     * addEndListener={(node, done) => {
     *   // use the css transitionend event to mark the finish of a transition
     *   node.addEventListener('transitionend', done, false);
     * }}
     * ```
     */addEndListener:PropTypes$$1.func,/**
     * Callback fired before the "entering" status is applied. An extra parameter
     * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount
     *
     * @type Function(node: HtmlElement, isAppearing: bool) -> void
     */onEnter:PropTypes$$1.func,/**
     * Callback fired after the "entering" status is applied. An extra parameter
     * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount
     *
     * @type Function(node: HtmlElement, isAppearing: bool)
     */onEntering:PropTypes$$1.func,/**
     * Callback fired after the "entered" status is applied. An extra parameter
     * `isAppearing` is supplied to indicate if the enter stage is occurring on the initial mount
     *
     * @type Function(node: HtmlElement, isAppearing: bool) -> void
     */onEntered:PropTypes$$1.func,/**
     * Callback fired before the "exiting" status is applied.
     *
     * @type Function(node: HtmlElement) -> void
     */onExit:PropTypes$$1.func,/**
     * Callback fired after the "exiting" status is applied.
     *
     * @type Function(node: HtmlElement) -> void
     */onExiting:PropTypes$$1.func,/**
     * Callback fired after the "exited" status is applied.
     *
     * @type Function(node: HtmlElement) -> void
     */onExited:PropTypes$$1.func// Name the function so it is clearer in the documentation
  }:{};function noop(){}Transition.defaultProps={in:false,mountOnEnter:false,unmountOnExit:false,appear:false,enter:true,exit:true,onEnter:noop,onEntering:noop,onEntered:noop,onExit:noop,onExiting:noop,onExited:noop};Transition.UNMOUNTED=0;Transition.EXITED=1;Transition.ENTERING=2;Transition.ENTERED=3;Transition.EXITING=4;var _default=(0, reactLifecyclesCompat_es.polyfill)(Transition);exports.default=_default;});unwrapExports$2(Transition_1);var Transition_2=Transition_1.EXITING;var Transition_3=Transition_1.ENTERED;var Transition_4=Transition_1.ENTERING;var Transition_5=Transition_1.EXITED;var Transition_6=Transition_1.UNMOUNTED;var Fade_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _fadeStyles;var _react2=_interopRequireDefault(React__default);var _Transition2=_interopRequireDefault(Transition_1);var _classnames2=_interopRequireDefault(classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var fadeStyles=(_fadeStyles={},_fadeStyles[Transition_1.ENTERING]='in',_fadeStyles[Transition_1.ENTERED]='in',_fadeStyles);var Fade=function(_React$Component){_inherits(Fade,_React$Component);function Fade(props,context){_classCallCheck(this,Fade);return _possibleConstructorReturn(this,_React$Component.call(this,props,context));}Fade.prototype.render=function render(){var _props=this.props,className=_props.className,children=_props.children,props=_objectWithoutProperties(_props,['className','children']);return _react2.default.createElement(_Transition2.default,props,function(status,innerProps){return _react2.default.cloneElement(children,_extends({},innerProps,{className:(0, _classnames2.default)('fade',className,children.props.className,fadeStyles[status])}));});};return Fade;}(_react2.default.Component);exports.default=Fade;module.exports=exports['default'];});unwrapExports$2(Fade_1);var Body=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(propTypes$1);var _classnames2=_interopRequireDefault(classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ModalBody=function(_React$Component){_inherits(ModalBody,_React$Component);function ModalBody(){_classCallCheck(this,ModalBody);return _possibleConstructorReturn(this,_React$Component.apply(this,arguments));}ModalBody.getDefaultPrefix=function getDefaultPrefix(){return 'modal';};ModalBody.prototype.render=function render(){var _props=this.props,modalPrefix=_props.modalPrefix,children=_props.children,className=_props.className,props=_objectWithoutProperties(_props,['modalPrefix','children','className']);var prefix=modalPrefix||ModalBody.getDefaultPrefix();return _react2.default.createElement('div',_extends({},props,{className:(0, _classnames2.default)(className,prefix+'-body')}),children);};return ModalBody;}(_react2.default.Component);ModalBody.propTypes={/**
     * A css class applied to the Component
     */modalPrefix:_propTypes2.default.string};exports.default=ModalBody;module.exports=exports['default'];});unwrapExports$2(Body);var Dismiss_1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(propTypes$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var chain=function chain(a,b){return function(){a&&a.apply(undefined,arguments);b&&b.apply(undefined,arguments);};};var Dismiss=function(_React$Component){_inherits(Dismiss,_React$Component);function Dismiss(){_classCallCheck(this,Dismiss);return _possibleConstructorReturn(this,_React$Component.apply(this,arguments));}Dismiss.prototype.render=function render(){var _props=this.props,Tag=_props.component,children=_props.children,props=_objectWithoutProperties(_props,['component','children']);return _react2.default.createElement(Tag,_extends({},props,{onClick:chain(props.onClick,this.context.onModalHide)}),children);};return Dismiss;}(_react2.default.Component);Dismiss.propTypes={component:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.func])};Dismiss.defaultProps={component:'button'};Dismiss.contextTypes={onModalHide:_propTypes2.default.func};exports.default=Dismiss;module.exports=exports['default'];});unwrapExports$2(Dismiss_1);var Header=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(propTypes$1);var _classnames2=_interopRequireDefault(classnames);var _Dismiss2=_interopRequireDefault(Dismiss_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ModalHeader=function(_React$Component){_inherits(ModalHeader,_React$Component);function ModalHeader(){_classCallCheck(this,ModalHeader);return _possibleConstructorReturn(this,_React$Component.apply(this,arguments));}ModalHeader.getDefaultPrefix=function getDefaultPrefix(){return 'modal';};ModalHeader.prototype.render=function render(){var _props=this.props,modalPrefix=_props.modalPrefix,closeButton=_props.closeButton,children=_props.children,className=_props.className,label=_props['aria-label'],props=_objectWithoutProperties(_props,['modalPrefix','closeButton','children','className','aria-label']);var prefix=modalPrefix||ModalHeader.getDefaultPrefix();return _react2.default.createElement('div',_extends({},props,{className:(0, _classnames2.default)(className,prefix+'-header')}),closeButton&&_react2.default.createElement(_Dismiss2.default,{className:'close','aria-label':label},_react2.default.createElement('span',{'aria-hidden':'true'},'\xD7')),children);};return ModalHeader;}(_react2.default.Component);ModalHeader._isModalHeader=true;ModalHeader.propTypes={closeButton:_propTypes2.default.bool,/**
     * A css class applied to the Component
     */modalPrefix:_propTypes2.default.string,'aria-label':_propTypes2.default.string};ModalHeader.defaultProps={closeButton:false,'aria-label':'Close Modal'};ModalHeader.contextTypes={onModalHide:_propTypes2.default.func};exports.default=ModalHeader;module.exports=exports['default'];});unwrapExports$2(Header);var Title=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(propTypes$1);var _classnames2=_interopRequireDefault(classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ModalTitle=function(_React$Component){_inherits(ModalTitle,_React$Component);function ModalTitle(){_classCallCheck(this,ModalTitle);return _possibleConstructorReturn(this,_React$Component.apply(this,arguments));}ModalTitle.getDefaultPrefix=function getDefaultPrefix(){return 'modal';};ModalTitle.prototype.render=function render(){var _props=this.props,modalPrefix=_props.modalPrefix,className=_props.className,props=_objectWithoutProperties(_props,['modalPrefix','className']);var prefix=modalPrefix||ModalTitle.getDefaultPrefix();return _react2.default.createElement('h4',_extends({},props,{className:(0, _classnames2.default)(className,prefix+'-title')}));};return ModalTitle;}(_react2.default.Component);ModalTitle.propTypes={/**
     * A css class applied to the Component
     */modalPrefix:_propTypes2.default.string};exports.default=ModalTitle;module.exports=exports['default'];});unwrapExports$2(Title);var Footer=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(propTypes$1);var _classnames2=_interopRequireDefault(classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ModalFooter=function(_React$Component){_inherits(ModalFooter,_React$Component);function ModalFooter(){_classCallCheck(this,ModalFooter);return _possibleConstructorReturn(this,_React$Component.apply(this,arguments));}ModalFooter.getDefaultPrefix=function getDefaultPrefix(){return 'modal';};ModalFooter.prototype.render=function render(){var _props=this.props,modalPrefix=_props.modalPrefix,children=_props.children,className=_props.className,props=_objectWithoutProperties(_props,['modalPrefix','children','className']);var prefix=modalPrefix||ModalFooter.getDefaultPrefix();return _react2.default.createElement('div',_extends({},props,{className:(0, _classnames2.default)(className,prefix+'-footer')}),children);};return ModalFooter;}(_react2.default.Component);ModalFooter.propTypes={/**
     * A css class applied to the Component
     */modalPrefix:_propTypes2.default.string};exports.default=ModalFooter;module.exports=exports['default'];});unwrapExports$2(Footer);var Modal_1$1=createCommonjsModule$2(function(module,exports){exports.__esModule=true;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _propTypes2=_interopRequireDefault(propTypes$1);var _react2=_interopRequireDefault(React__default);var _componentOrElement2=_interopRequireDefault(componentOrElement);var _Modal2=_interopRequireDefault(Modal_1);var _isOverflowing2=_interopRequireDefault(isOverflowing_1);var _Fade2=_interopRequireDefault(Fade_1);var _Body2=_interopRequireDefault(Body);var _Header2=_interopRequireDefault(Header);var _Title2=_interopRequireDefault(Title);var _Footer2=_interopRequireDefault(Footer);var _Dismiss2=_interopRequireDefault(Dismiss_1);var _ownerDocument2=_interopRequireDefault(ownerDocument_1);var _inDOM2=_interopRequireDefault(inDOM);var _scrollbarSize2=_interopRequireDefault(scrollbarSize_1);var _style2=_interopRequireDefault(style_1);var _classnames2=_interopRequireDefault(classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var baseIndex={};var PREFIX='modal';var getZIndex=void 0;var omit=function omit(obj,keys){return Object.keys(obj).reduce(function(o,key){if(keys.indexOf(key)===-1)o[key]=obj[key];return o;},{});};function DialogTransition(props){return _react2.default.createElement(_Fade2.default,_extends({},props,{timeout:Modal.TRANSITION_DURATION}));}function BackdropTransition(props){return _react2.default.createElement(_Fade2.default,_extends({},props,{timeout:Modal.BACKDROP_TRANSITION_DURATION}));}var Modal=function(_React$Component){_inherits(Modal,_React$Component);Modal.getDefaultPrefix=function getDefaultPrefix(){return PREFIX;};Modal.prototype.getChildContext=function getChildContext(){return this._context||(this._context={onModalHide:this.props.onHide});};function Modal(){_classCallCheck(this,Modal);var _this=_possibleConstructorReturn(this,_React$Component.call(this));_this.handleEntering=_this.handleEntering.bind(_this);_this.handleExiting=_this.handleExiting.bind(_this);_this.state={classes:''};return _this;}Modal.prototype.componentDidMount=function componentDidMount(){var _this2=this;getZIndex=getZIndex||function(){var modal=document.createElement('div'),backdrop=document.createElement('div'),zIndexFactor=void 0;modal.className='modal hide';backdrop.className='modal-backdrop hide';document.body.appendChild(modal);document.body.appendChild(backdrop);baseIndex.modal=+(0, _style2.default)(modal,'z-index');baseIndex.backdrop=+(0, _style2.default)(backdrop,'z-index');zIndexFactor=baseIndex.modal-baseIndex.backdrop;document.body.removeChild(modal);document.body.removeChild(backdrop);return function(type){return baseIndex[type]+zIndexFactor*(_this2.props.manager.modals.length-1);};}();};Modal.prototype.handleEntering=function handleEntering(){this._show.apply(this,arguments);if(this.props.onEntering){this.props.onEntering();}};Modal.prototype.handleExiting=function handleExiting(){this._removeAttentionClasses();if(this.props.onExiting){this.props.onExiting();}};Modal.prototype.render=function render(){var _this3=this;var _props=this.props,className=_props.className,children=_props.children,keyboard=_props.keyboard,transition=_props.transition,modalPrefix=_props.modalPrefix,dialogClassName=_props.dialogClassName,container=_props.container,onEnter=_props.onEnter,onEntered=_props.onEntered,onExit=_props.onExit,onExited=_props.onExited,props=_objectWithoutProperties(_props,['className','children','keyboard','transition','modalPrefix','dialogClassName','container','onEnter','onEntered','onExit','onExited']);var _state=this.state,dialog=_state.dialog,classes=_state.classes,backdrop=_state.backdrop;delete props.manager;var elementProps=omit(props,Object.keys(Modal.propTypes));var prefix=modalPrefix||Modal.getDefaultPrefix();if(transition===true)transition=DialogTransition;var modal=_react2.default.createElement('div',_extends({},elementProps,{ref:function ref(r){return _this3.dialog=r;},style:dialog,className:(0, _classnames2.default)(className,prefix,{in:props.show&&!transition}),onClick:this.props.backdrop?function(e){return _this3.handleBackdropClick(e);}:null}),_react2.default.createElement('div',{key:'modal',ref:function ref(r){return _this3.innerRef=r;},className:(0, _classnames2.default)(prefix+'-dialog',dialogClassName,classes,(props.small||props.sm)&&prefix+'-sm',(props.large||props.lg)&&prefix+'-lg')},_react2.default.createElement('div',{className:prefix+'-content'},children)));return _react2.default.createElement(_Modal2.default,{keyboard:keyboard,ref:function ref(_ref){_this3.modal=_ref&&_ref.modal;_this3.backdrop=_ref&&_ref.backdrop;},container:container,backdrop:props.backdrop,show:props.show,backdropStyle:backdrop,backdropClassName:prefix+'-backdrop',containerClassName:prefix+'-open',transition:transition||undefined,backdropTransition:transition?BackdropTransition:undefined,onHide:this.props.onHide,onEnter:onEnter,onEntering:this.handleEntering,onEntered:onEntered,onExit:onExit,onExiting:this.handleExiting,onExited:onExited},modal);};Modal.prototype.attention=function attention(){var _this4=this;var attentionClass=this.props.attentionClass;if(attentionClass)this.setState({classes:''},function(){if(_this4.props.show){// eslint-disable-next-line no-unused-expressions
  _this4.innerRef.offsetWidth;_this4.setState({classes:attentionClass+' animated'});}});};Modal.prototype.handleBackdropClick=function handleBackdropClick(e){if(e.target!==e.currentTarget)return;if(this.props.backdrop==='static')return this.attention();this.props.onHide();};Modal.prototype._show=function _show(){if(this.props.show)this.setState(this._getStyles());};Modal.prototype._getStyles=function _getStyles(){if(!_inDOM2.default)return {};var node=(0, reactDom.findDOMNode)(this.dialog),doc=(0, _ownerDocument2.default)(node),scrollHt=node.scrollHeight,bodyIsOverflowing=(0, _isOverflowing2.default)(this.props.container||doc.body),modalIsOverflowing=scrollHt>doc.documentElement.clientHeight;return {dialog:{zIndex:getZIndex('modal'),paddingRight:bodyIsOverflowing&&!modalIsOverflowing?(0, _scrollbarSize2.default)():void 0,paddingLeft:!bodyIsOverflowing&&modalIsOverflowing?(0, _scrollbarSize2.default)():void 0},backdrop:{zIndex:getZIndex('backdrop')}};};Modal.prototype._removeAttentionClasses=function _removeAttentionClasses(){this.setState({classes:''});};return Modal;}(_react2.default.Component);Modal.propTypes={show:_propTypes2.default.bool,/** sizes **/small:_propTypes2.default.bool,sm:_propTypes2.default.bool,large:_propTypes2.default.bool,lg:_propTypes2.default.bool,/** --- **/backdrop:_propTypes2.default.oneOf(['static',true,false]),keyboard:_propTypes2.default.bool,animate:_propTypes2.default.bool,transition:_propTypes2.default.any,container:_propTypes2.default.oneOfType([_componentOrElement2.default,_propTypes2.default.func]),onHide:_propTypes2.default.func,onEnter:_propTypes2.default.func,onEntering:_propTypes2.default.func,onEntered:_propTypes2.default.func,onExit:_propTypes2.default.func,onExiting:_propTypes2.default.func,onExited:_propTypes2.default.func,modalPrefix:_propTypes2.default.string,dialogClassName:_propTypes2.default.string,attentionClass:_propTypes2.default.string};Modal.defaultProps={backdrop:true,keyboard:true,animate:true,transition:true,container:_inDOM2.default?document.body:null,attentionClass:'shake',manager:(_Modal2.default.getDefaultProps?_Modal2.default.getDefaultProps():_Modal2.default.defaultProps).manager};Modal.childContextTypes={onModalHide:_propTypes2.default.func};Modal.injectCSSPrefix=function(prefix){PREFIX=prefix;};function getDefaultPrefix(){return PREFIX;}_Body2.default.getDefaultPrefix=getDefaultPrefix;_Header2.default.getDefaultPrefix=getDefaultPrefix;_Title2.default.getDefaultPrefix=getDefaultPrefix;_Footer2.default.getDefaultPrefix=getDefaultPrefix;Modal.Body=_Body2.default;Modal.Header=_Header2.default;Modal.Title=_Title2.default;Modal.Footer=_Footer2.default;Modal.Dismiss=_Dismiss2.default;Modal.BaseModal=Modal;Modal.TRANSITION_DURATION=300;Modal.BACKDROP_TRANSITION_DURATION=150;exports.default=Modal;module.exports=exports['default'];});var Modal$1=unwrapExports$2(Modal_1$1);var css$o="/* Licensed MIT; Copyright (c) 2011-2014 Twitter, Inc <https://github.com/twbs/bootstrap/blob/master/LICENSE> */\n/* Licensed MIT; Copyright (c) 2011-2014 Twitter, Inc <https://github.com/twbs/bootstrap/blob/master/LICENSE> */\n/*\nAnimate.css - http://daneden.me/animate\nLicensed under the  license (http://licence.visualidiot.com/)\nCopyright (c) 2012 Dan Eden*/\n.animated {\n  -webkit-animation-duration: 1s;\n  -moz-animation-duration: 1s;\n  -o-animation-duration: 1s;\n  animation-duration: 1s;\n  -webkit-animation-fill-mode: both;\n  -moz-animation-fill-mode: both;\n  -o-animation-fill-mode: both;\n  animation-fill-mode: both;\n}\n@-webkit-keyframes shake {\n  0%,\n  100% {\n    -webkit-transform: translateX(0);\n  }\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    -webkit-transform: translateX(-10px);\n  }\n  20%,\n  40%,\n  60%,\n  80% {\n    -webkit-transform: translateX(10px);\n  }\n}\n@-moz-keyframes shake {\n  0%,\n  100% {\n    -moz-transform: translateX(0);\n  }\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    -moz-transform: translateX(-10px);\n  }\n  20%,\n  40%,\n  60%,\n  80% {\n    -moz-transform: translateX(10px);\n  }\n}\n@-o-keyframes shake {\n  0%,\n  100% {\n    -o-transform: translateX(0);\n  }\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    -o-transform: translateX(-10px);\n  }\n  20%,\n  40%,\n  60%,\n  80% {\n    -o-transform: translateX(10px);\n  }\n}\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-10px);\n  }\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(10px);\n  }\n}\n.shake {\n  -webkit-animation-name: shake;\n  -moz-animation-name: shake;\n  -o-animation-name: shake;\n  animation-name: shake;\n}\n.modal {\n  display: block;\n}\n.modal-content > .close {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n}\n@media (min-width: 768px) {\n  .modal-sm > .modal-dialog {\n    width: 300px;\n  }\n}\n@media (min-width: 992px) {\n  .modal-lg > .modal-dialog {\n    width: 900px;\n  }\n}\n";styleInject(css$o);var lodash_isequal=createCommonjsModule$2(function(module,exports){/**
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright JS Foundation and other contributors <https://js.foundation/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */ /** Used as the size to enable large array optimizations. */var LARGE_ARRAY_SIZE=200;/** Used to stand-in for `undefined` hash values. */var HASH_UNDEFINED='__lodash_hash_undefined__';/** Used to compose bitmasks for value comparisons. */var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;/** Used as references for various `Number` constants. */var MAX_SAFE_INTEGER=9007199254740991;/** `Object#toString` result references. */var argsTag='[object Arguments]',arrayTag='[object Array]',asyncTag='[object AsyncFunction]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',genTag='[object GeneratorFunction]',mapTag='[object Map]',numberTag='[object Number]',nullTag='[object Null]',objectTag='[object Object]',promiseTag='[object Promise]',proxyTag='[object Proxy]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',symbolTag='[object Symbol]',undefinedTag='[object Undefined]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',dataViewTag='[object DataView]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';/**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;/** Used to detect host constructors (Safari). */var reIsHostCtor=/^\[object .+?Constructor\]$/;/** Used to detect unsigned integer values. */var reIsUint=/^(?:0|[1-9]\d*)$/;/** Used to identify `toStringTag` values of typed arrays. */var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;/** Detect free variable `global` from Node.js. */var freeGlobal=typeof commonjsGlobal$2=='object'&&commonjsGlobal$2&&commonjsGlobal$2.Object===Object&&commonjsGlobal$2;/** Detect free variable `self`. */var freeSelf=typeof self=='object'&&self&&self.Object===Object&&self;/** Used as a reference to the global object. */var root=freeGlobal||freeSelf||Function('return this')();/** Detect free variable `exports`. */var freeExports=exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&'object'=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/** Detect free variable `process` from Node.js. */var freeProcess=moduleExports&&freeGlobal.process;/** Used to access faster Node.js helpers. */var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding('util');}catch(e){}}();/* Node.js helper references. */var nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;/**
   * A specialized version of `_.filter` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {Array} Returns the new filtered array.
   */function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value;}}return result;}/**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}return array;}/**
   * A specialized version of `_.some` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if any element passes the predicate check,
   *  else `false`.
   */function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true;}}return false;}/**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}return result;}/**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */function baseUnary(func){return function(value){return func(value);};}/**
   * Checks if a `cache` value for `key` exists.
   *
   * @private
   * @param {Object} cache The cache to query.
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function cacheHas(cache,key){return cache.has(key);}/**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */function getValue(object,key){return object==null?undefined:object[key];}/**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value];});return result;}/**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */function overArg(func,transform){return function(arg){return func(transform(arg));};}/**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value;});return result;}/** Used for built-in method references. */var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;/** Used to detect overreaching core-js shims. */var coreJsData=root['__core-js_shared__'];/** Used to resolve the decompiled source of functions. */var funcToString=funcProto.toString;/** Used to check objects for own properties. */var hasOwnProperty=objectProto.hasOwnProperty;/** Used to detect methods masquerading as native. */var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||'');return uid?'Symbol(src)_1.'+uid:'';}();/**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */var nativeObjectToString=objectProto.toString;/** Used to detect if a method is native. */var reIsNative=RegExp('^'+funcToString.call(hasOwnProperty).replace(reRegExpChar,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');/** Built-in value references. */var Buffer=moduleExports?root.Buffer:undefined,Symbol=root.Symbol,Uint8Array=root.Uint8Array,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,symToStringTag=Symbol?Symbol.toStringTag:undefined;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeKeys=overArg(Object.keys,Object);/* Built-in method references that are verified to be native. */var DataView=getNative(root,'DataView'),Map=getNative(root,'Map'),Promise=getNative(root,'Promise'),Set=getNative(root,'Set'),WeakMap=getNative(root,'WeakMap'),nativeCreate=getNative(Object,'create');/** Used to detect maps, sets, and weakmaps. */var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);/** Used to convert symbols to primitives and strings. */var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;/**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0;}/**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result;}/**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result;}return hasOwnProperty.call(data,key)?data[key]:undefined;}/**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key);}/**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this;}// Add methods to `Hash`.
  Hash.prototype.clear=hashClear;Hash.prototype['delete']=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;/**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */function listCacheClear(){this.__data__=[];this.size=0;}/**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false;}var lastIndex=data.length-1;if(index==lastIndex){data.pop();}else{splice.call(data,index,1);}--this.size;return true;}/**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1];}/**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1;}/**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value]);}else{data[index][1]=value;}return this;}// Add methods to `ListCache`.
  ListCache.prototype.clear=listCacheClear;ListCache.prototype['delete']=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;/**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1]);}}/**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */function mapCacheClear(){this.size=0;this.__data__={'hash':new Hash(),'map':new(Map||ListCache)(),'string':new Hash()};}/**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function mapCacheDelete(key){var result=getMapData(this,key)['delete'](key);this.size-=result?1:0;return result;}/**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function mapCacheGet(key){return getMapData(this,key).get(key);}/**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function mapCacheHas(key){return getMapData(this,key).has(key);}/**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this;}// Add methods to `MapCache`.
  MapCache.prototype.clear=mapCacheClear;MapCache.prototype['delete']=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;/**
   *
   * Creates an array cache object to store unique values.
   *
   * @private
   * @constructor
   * @param {Array} [values] The values to cache.
   */function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache();while(++index<length){this.add(values[index]);}}/**
   * Adds `value` to the array cache.
   *
   * @private
   * @name add
   * @memberOf SetCache
   * @alias push
   * @param {*} value The value to cache.
   * @returns {Object} Returns the cache instance.
   */function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this;}/**
   * Checks if `value` is in the array cache.
   *
   * @private
   * @name has
   * @memberOf SetCache
   * @param {*} value The value to search for.
   * @returns {number} Returns `true` if `value` is found, else `false`.
   */function setCacheHas(value){return this.__data__.has(value);}// Add methods to `SetCache`.
  SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;/**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size;}/**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */function stackClear(){this.__data__=new ListCache();this.size=0;}/**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */function stackDelete(key){var data=this.__data__,result=data['delete'](key);this.size=data.size;return result;}/**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */function stackGet(key){return this.__data__.get(key);}/**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */function stackHas(key){return this.__data__.has(key);}/**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this;}data=this.__data__=new MapCache(pairs);}data.set(key,value);this.size=data.size;return this;}// Add methods to `Stack`.
  Stack.prototype.clear=stackClear;Stack.prototype['delete']=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;/**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(// Safari 9 has enumerable `arguments.length` in strict mode.
  key=='length'||// Node.js 0.10 has enumerable non-index properties on buffers.
  isBuff&&(key=='offset'||key=='parent')||// PhantomJS 2 has enumerable non-index properties on typed arrays.
  isType&&(key=='buffer'||key=='byteLength'||key=='byteOffset')||// Skip index properties.
  isIndex(key,length)))){result.push(key);}}return result;}/**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length;}}return -1;}/**
   * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
   * `keysFunc` and `symbolsFunc` to get the enumerable property names and
   * symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Function} keysFunc The function to get the keys of `object`.
   * @param {Function} symbolsFunc The function to get the symbols of `object`.
   * @returns {Array} Returns the array of property names and symbols.
   */function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object));}/**
   * The base implementation of `getTag` without fallbacks for buggy environments.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag;}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value);}/**
   * The base implementation of `_.isArguments`.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   */function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag;}/**
   * The base implementation of `_.isEqual` which supports partial comparisons
   * and tracks traversed objects.
   *
   * @private
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @param {boolean} bitmask The bitmask flags.
   *  1 - Unordered comparison
   *  2 - Partial comparison
   * @param {Function} [customizer] The function to customize comparisons.
   * @param {Object} [stack] Tracks traversed `value` and `other` objects.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   */function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true;}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other;}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack);}/**
   * A specialized version of `baseIsEqual` for arrays and objects which performs
   * deep comparisons and tracks traversed objects enabling objects with circular
   * references to be compared.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
   * @param {Function} customizer The function to customize comparisons.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Object} [stack] Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false;}objIsArr=true;objIsObj=false;}if(isSameTag&&!objIsObj){stack||(stack=new Stack());return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack);}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,'__wrapped__'),othIsWrapped=othIsObj&&hasOwnProperty.call(other,'__wrapped__');if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack());return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack);}}if(!isSameTag){return false;}stack||(stack=new Stack());return equalObjects(object,other,bitmask,customizer,equalFunc,stack);}/**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false;}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value));}/**
   * The base implementation of `_.isTypedArray` without Node.js optimizations.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   */function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)];}/**
   * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object);}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!='constructor'){result.push(key);}}return result;}/**
   * A specialized version of `baseIsEqualDeep` for arrays with support for
   * partial deep comparisons.
   *
   * @private
   * @param {Array} array The array to compare.
   * @param {Array} other The other array to compare.
   * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
   * @param {Function} customizer The function to customize comparisons.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Object} stack Tracks traversed `array` and `other` objects.
   * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
   */function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false;}// Assume cyclic values are equal.
  var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other;}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache():undefined;stack.set(array,other);stack.set(other,array);// Ignore non-index properties.
  while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);}if(compared!==undefined){if(compared){continue;}result=false;break;}// Recursively compare arrays (susceptible to call stack limits).
  if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex);}})){result=false;break;}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break;}}stack['delete'](array);stack['delete'](other);return result;}/**
   * A specialized version of `baseIsEqualDeep` for comparing objects of
   * the same `toStringTag`.
   *
   * **Note:** This function only supports comparing values with tags of
   * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {string} tag The `toStringTag` of the objects to compare.
   * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
   * @param {Function} customizer The function to customize comparisons.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Object} stack Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false;}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false;}return true;case boolTag:case dateTag:case numberTag:// Coerce booleans to `1` or `0` and dates to milliseconds.
  // Invalid dates are coerced to `NaN`.
  return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:// Coerce regexes to strings and treat strings, primitives and objects,
  // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring
  // for more details.
  return object==other+'';case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false;}// Assume cyclic values are equal.
  var stacked=stack.get(object);if(stacked){return stacked==other;}bitmask|=COMPARE_UNORDERED_FLAG;// Recursively compare objects (susceptible to call stack limits).
  stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack['delete'](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other);}}return false;}/**
   * A specialized version of `baseIsEqualDeep` for objects with support for
   * partial deep comparisons.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
   * @param {Function} customizer The function to customize comparisons.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Object} stack Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false;}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false;}}// Assume cyclic values are equal.
  var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other;}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);}// Recursively compare objects (susceptible to call stack limits).
  if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break;}skipCtor||(skipCtor=key=='constructor');}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;// Non `Object` object instances with different constructors are not equal.
  if(objCtor!=othCtor&&'constructor'in object&&'constructor'in other&&!(typeof objCtor=='function'&&objCtor instanceof objCtor&&typeof othCtor=='function'&&othCtor instanceof othCtor)){result=false;}}stack['delete'](object);stack['delete'](other);return result;}/**
   * Creates an array of own enumerable property names and symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names and symbols.
   */function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols);}/**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=='string'?'string':'hash']:data.map;}/**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined;}/**
   * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the raw `toStringTag`.
   */function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true;}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag;}else{delete value[symToStringTag];}}return result;}/**
   * Creates an array of the own enumerable symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of symbols.
   */var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return [];}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol);});};/**
   * Gets the `toStringTag` of `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */var getTag=baseGetTag;// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.
  if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map())!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set())!=setTag||WeakMap&&getTag(new WeakMap())!=weakMapTag){getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):'';if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag;}}return result;};}/**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return !!length&&(typeof value=='number'||reIsUint.test(value))&&value>-1&&value%1==0&&value<length;}/**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */function isKeyable(value){var type=typeof value;return type=='string'||type=='number'||type=='symbol'||type=='boolean'?value!=='__proto__':value===null;}/**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */function isMasked(func){return !!maskSrcKey&&maskSrcKey in func;}/**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=='function'&&Ctor.prototype||objectProto;return value===proto;}/**
   * Converts `value` to a string using `Object.prototype.toString`.
   *
   * @private
   * @param {*} value The value to convert.
   * @returns {string} Returns the converted string.
   */function objectToString(value){return nativeObjectToString.call(value);}/**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to convert.
   * @returns {string} Returns the source code.
   */function toSource(func){if(func!=null){try{return funcToString.call(func);}catch(e){}try{return func+'';}catch(e){}}return '';}/**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */function eq(value,other){return value===other||value!==value&&other!==other;}/**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */var isArguments=baseIsArguments(function(){return arguments;}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee');};/**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */var isArray=Array.isArray;/**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value);}/**
   * Checks if `value` is a buffer.
   *
   * @static
   * @memberOf _
   * @since 4.3.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
   * @example
   *
   * _.isBuffer(new Buffer(2));
   * // => true
   *
   * _.isBuffer(new Uint8Array(2));
   * // => false
   */var isBuffer=nativeIsBuffer||stubFalse;/**
   * Performs a deep comparison between two values to determine if they are
   * equivalent.
   *
   * **Note:** This method supports comparing arrays, array buffers, booleans,
   * date objects, error objects, maps, numbers, `Object` objects, regexes,
   * sets, strings, symbols, and typed arrays. `Object` objects are compared
   * by their own, not inherited, enumerable properties. Functions and DOM
   * nodes are compared by strict equality, i.e. `===`.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.isEqual(object, other);
   * // => true
   *
   * object === other;
   * // => false
   */function isEqual(value,other){return baseIsEqual(value,other);}/**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */function isFunction(value){if(!isObject(value)){return false;}// The use of `Object#toString` avoids issues with the `typeof` operator
  // in Safari 9 which returns 'object' for typed arrays and other constructors.
  var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag;}/**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}/**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */function isObject(value){var type=typeof value;return value!=null&&(type=='object'||type=='function');}/**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */function isObjectLike(value){return value!=null&&typeof value=='object';}/**
   * Checks if `value` is classified as a typed array.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   * @example
   *
   * _.isTypedArray(new Uint8Array);
   * // => true
   *
   * _.isTypedArray([]);
   * // => false
   */var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;/**
   * Creates an array of the own enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects. See the
   * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * for more details.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keys(new Foo);
   * // => ['a', 'b'] (iteration order is not guaranteed)
   *
   * _.keys('hi');
   * // => ['0', '1']
   */function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object);}/**
   * This method returns a new empty array.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {Array} Returns the new empty array.
   * @example
   *
   * var arrays = _.times(2, _.stubArray);
   *
   * console.log(arrays);
   * // => [[], []]
   *
   * console.log(arrays[0] === arrays[1]);
   * // => false
   */function stubArray(){return [];}/**
   * This method returns `false`.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {boolean} Returns `false`.
   * @example
   *
   * _.times(2, _.stubFalse);
   * // => [false, false]
   */function stubFalse(){return false;}module.exports=isEqual;});var css$p=":root {\n  --default-color: #9ccef9;\n  --active-color: #20a5d6;\n  --hover-color: #fff;\n  --ui-gray: #263340;\n  --ui-gray-dark: #16202b;\n  --ui-gray-darkest: #14202a;\n  --ui-gray-darker: #151a1f;\n  --ui-gray-light: #516873;\n  --text-primary-color: #fff;\n  --text-secondary-color: #91b9cd;\n  --ui-border-color: #44626f;\n}\n.modal-dialog .modal-content {\n  background-color: var(--ui-gray-darker);\n  border-color: var(--ui-border-color);\n  color: var(--text-secondary-color);\n  border: 0;\n}\n.modal-dialog .modal-content .modal-header,\n.modal-dialog .modal-content .modal-footer {\n  border-color: var(--ui-border-color);\n}\n.modal-dialog .modal-content .dialog-separator,\n.modal-dialog .modal-content .dialog-separator-before,\n.modal-dialog .modal-content .dialog-separator-after {\n  position: relative;\n}\n.modal-dialog .modal-content .dialog-separator:before,\n.modal-dialog .modal-content .dialog-separator:after,\n.modal-dialog .modal-content .dialog-separator-before:before,\n.modal-dialog .modal-content .dialog-separator-after:after {\n  background-color: #000;\n  content: ' ';\n  display: block;\n  height: 3px;\n  left: 0;\n  position: absolute;\n  width: 100%;\n}\n.modal-dialog .modal-content .dialog-separator:before,\n.modal-dialog .modal-content .dialog-separator-before:before {\n  top: -3px;\n}\n.modal-dialog .modal-content .dialog-separator:after,\n.modal-dialog .modal-content .dialog-separator-after:after {\n  bottom: -3px;\n}\n.modal-dialog .modal-content .modal-body {\n  color: var(--text-primary-color);\n  padding: 16px 22px 0px;\n  position: relative;\n}\n.modal-dialog .modal-content .modal-body ::-webkit-scrollbar {\n  width: 6px;\n  background-color: var(--ui-gray-dark);\n}\n.modal-dialog .modal-content .modal-body ::-webkit-scrollbar-thumb {\n  background-color: var(--ui-gray-light);\n  border-radius: 5px;\n}\n.modal-dialog .modal-content .modal-header {\n  border-bottom-width: 3px;\n  border-bottom-style: solid;\n  border-bottom-color: #000;\n  padding: 19px 22px 17px;\n  position: relative;\n}\n.modal-dialog .modal-content .modal-header h4 {\n  color: var(--text-secondary-color);\n  font-size: 20px;\n  font-weight: 500;\n  line-height: 24px;\n  padding-right: 24px;\n}\n.modal-dialog .modal-content .modal-footer {\n  border-top: 0;\n  padding-top: 0;\n}\n.modal-dialog .card-round {\n  background-color: var(--ui-gray-dark);\n  padding: 10px;\n}\n.modal-dialog .modal-header {\n  position: relative;\n}\n.button-close,\n.modal-dialog button.close {\n  color: var(--text-secondary-color);\n  height: 25px;\n  opacity: 1;\n  overflow: hidden;\n  text-align: center;\n  text-shadow: none;\n  width: 25px;\n  font-size: 25px;\n  font-weight: lighter;\n}\n";styleInject(css$p);var UserPreferencesModal=/*#__PURE__*/function(_Component){_inherits$c(UserPreferencesModal,_Component);// TODO: Make this component more generic to allow things other than W/L and hotkeys...
  function UserPreferencesModal(props){var _this;_classCallCheck$c(this,UserPreferencesModal);_this=_possibleConstructorReturn$c(this,_getPrototypeOf$1(UserPreferencesModal).call(this,props));_defineProperty$3(_assertThisInitialized$3(_assertThisInitialized$3(_this)),"save",function(){_this.props.onSave({windowLevelData:_this.state.windowLevelData,hotKeysData:_this.state.hotKeysData});});_this.state={windowLevelData:lodash_clonedeep$1(props.windowLevelData),hotKeysData:lodash_clonedeep$1(props.hotKeysData)};return _this;}_createClass$2(UserPreferencesModal,[{key:"componentDidUpdate",value:function componentDidUpdate(prev,next){var newStateData={};if(!lodash_isequal(prev.windowLevelData,next.windowLevelData)){newStateData.windowLevelData=prev.windowLevelData;}if(!lodash_isequal(prev.hotKeysData,next.hotKeysData)){newStateData.hotKeysData=prev.hotKeysData;}if(newStateData.hotKeysData||newStateData.windowLevelData){this.setState(newStateData);}}},{key:"render",value:function render(){return React__default.createElement(Modal$1,{show:this.props.isOpen,onHide:this.props.onCancel,"aria-labelledby":"ModalHeader",className:"modal fade themed in",backdrop:false,large:true,keyboard:false},React__default.createElement(Modal$1.Header,{closeButton:true},React__default.createElement(Modal$1.Title,null,"User Preferences")),React__default.createElement(Modal$1.Body,null,React__default.createElement(UserPreferences,{windowLevelData:this.state.windowLevelData,hotKeysData:this.state.hotKeysData})),React__default.createElement(Modal$1.Footer,null,React__default.createElement("button",{className:"btn btn-danger pull-left",onClick:this.props.onResetToDefaults},"Reset to Defaults"),React__default.createElement(Modal$1.Dismiss,{className:"btn btn-default"},"Cancel"),React__default.createElement("button",{className:"btn btn-primary",onClick:this.save},"Save")));}}]);return UserPreferencesModal;}(React.Component);_defineProperty$3(UserPreferencesModal,"propTypes",{isOpen:propTypes$1.bool.isRequired,onCancel:propTypes$1.func,onSave:propTypes$1.func,onResetToDefaults:propTypes$1.func,windowLevelData:propTypes$1.object,hotKeysData:propTypes$1.object});_defineProperty$3(UserPreferencesModal,"defaultProps",{isOpen:false});/**
   * Creates an array of unique values, in order, from all given arrays using
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Array
   * @param {...Array} [arrays] The arrays to inspect.
   * @returns {Array} Returns the new array of combined values.
   * @example
   *
   * _.union([2], [1, 2]);
   * // => [2, 1]
   */var union=_baseRest(function(arrays){return _baseUniq(_baseFlatten(arrays,1,isArrayLikeObject_1,true));});var union_1=union;var EnterLeaveCounter_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var EnterLeaveCounter=/** @class */function(){function EnterLeaveCounter(isNodeInDocument){this.entered=[];this.isNodeInDocument=isNodeInDocument;}EnterLeaveCounter.prototype.enter=function(enteringNode){var _this=this;var previousLength=this.entered.length;var isNodeEntered=function(node){return _this.isNodeInDocument(node)&&(!node.contains||node.contains(enteringNode));};this.entered=union_1(this.entered.filter(isNodeEntered),[enteringNode]);return previousLength===0&&this.entered.length>0;};EnterLeaveCounter.prototype.leave=function(leavingNode){var previousLength=this.entered.length;this.entered=without_1(this.entered.filter(this.isNodeInDocument),leavingNode);return previousLength>0&&this.entered.length===0;};EnterLeaveCounter.prototype.reset=function(){this.entered=[];};return EnterLeaveCounter;}();exports.default=EnterLeaveCounter;});unwrapExports$2(EnterLeaveCounter_1);var BrowserDetector=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.isFirefox=memoize_1(function(){return /firefox/i.test(navigator.userAgent);});exports.isSafari=memoize_1(function(){return Boolean(window.safari);});});unwrapExports$2(BrowserDetector);var BrowserDetector_1=BrowserDetector.isFirefox;var BrowserDetector_2=BrowserDetector.isSafari;var MonotonicInterpolant_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var MonotonicInterpolant=/** @class */function(){function MonotonicInterpolant(xs,ys){var length=xs.length;// Rearrange xs and ys so that xs is sorted
  var indexes=[];for(var i=0;i<length;i++){indexes.push(i);}indexes.sort(function(a,b){return xs[a]<xs[b]?-1:1;});var dxs=[];var ms=[];var dx;var dy;for(var i=0;i<length-1;i++){dx=xs[i+1]-xs[i];dy=ys[i+1]-ys[i];dxs.push(dx);ms.push(dy/dx);}// Get degree-1 coefficients
  var c1s=[ms[0]];for(var i=0;i<dxs.length-1;i++){var m2=ms[i];var mNext=ms[i+1];if(m2*mNext<=0){c1s.push(0);}else{dx=dxs[i];var dxNext=dxs[i+1];var common=dx+dxNext;c1s.push(3*common/((common+dxNext)/m2+(common+dx)/mNext));}}c1s.push(ms[ms.length-1]);// Get degree-2 and degree-3 coefficients
  var c2s=[];var c3s=[];var m;for(var i=0;i<c1s.length-1;i++){m=ms[i];var c1=c1s[i];var invDx=1/dxs[i];var common=c1+c1s[i+1]-m-m;c2s.push((m-c1-common)*invDx);c3s.push(common*invDx*invDx);}this.xs=xs;this.ys=ys;this.c1s=c1s;this.c2s=c2s;this.c3s=c3s;}MonotonicInterpolant.prototype.interpolate=function(x){var _a=this,xs=_a.xs,ys=_a.ys,c1s=_a.c1s,c2s=_a.c2s,c3s=_a.c3s;// The rightmost point in the dataset should give an exact result
  var i=xs.length-1;if(x===xs[i]){return ys[i];}// Search for the interval x is in, returning the corresponding y if x is one of the original xs
  var low=0;var high=c3s.length-1;var mid;while(low<=high){mid=Math.floor(0.5*(low+high));var xHere=xs[mid];if(xHere<x){low=mid+1;}else if(xHere>x){high=mid-1;}else{return ys[mid];}}i=Math.max(0,high);// Interpolate
  var diff=x-xs[i];var diffSq=diff*diff;return ys[i]+c1s[i]*diff+c2s[i]*diffSq+c3s[i]*diff*diffSq;};return MonotonicInterpolant;}();exports.default=MonotonicInterpolant;});unwrapExports$2(MonotonicInterpolant_1);var OffsetUtils=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var ELEMENT_NODE=1;function getNodeClientOffset(node){var el=node.nodeType===ELEMENT_NODE?node:node.parentElement;if(!el){return null;}var _a=el.getBoundingClientRect(),top=_a.top,left=_a.left;return {x:left,y:top};}exports.getNodeClientOffset=getNodeClientOffset;function getEventClientOffset(e){return {x:e.clientX,y:e.clientY};}exports.getEventClientOffset=getEventClientOffset;function isImageNode(node){return node.nodeName==='IMG'&&(BrowserDetector.isFirefox()||!document.documentElement.contains(node));}function getDragPreviewSize(isImage,dragPreview,sourceWidth,sourceHeight){var dragPreviewWidth=isImage?dragPreview.width:sourceWidth;var dragPreviewHeight=isImage?dragPreview.height:sourceHeight;// Work around @2x coordinate discrepancies in browsers
  if(BrowserDetector.isSafari()&&isImage){dragPreviewHeight/=window.devicePixelRatio;dragPreviewWidth/=window.devicePixelRatio;}return {dragPreviewWidth:dragPreviewWidth,dragPreviewHeight:dragPreviewHeight};}function getDragPreviewOffset(sourceNode,dragPreview,clientOffset,anchorPoint,offsetPoint){// The browsers will use the image intrinsic size under different conditions.
  // Firefox only cares if it's an image, but WebKit also wants it to be detached.
  var isImage=isImageNode(dragPreview);var dragPreviewNode=isImage?sourceNode:dragPreview;var dragPreviewNodeOffsetFromClient=getNodeClientOffset(dragPreviewNode);var offsetFromDragPreview={x:clientOffset.x-dragPreviewNodeOffsetFromClient.x,y:clientOffset.y-dragPreviewNodeOffsetFromClient.y};var sourceWidth=sourceNode.offsetWidth,sourceHeight=sourceNode.offsetHeight;var anchorX=anchorPoint.anchorX,anchorY=anchorPoint.anchorY;var _a=getDragPreviewSize(isImage,dragPreview,sourceWidth,sourceHeight),dragPreviewWidth=_a.dragPreviewWidth,dragPreviewHeight=_a.dragPreviewHeight;var calculateYOffset=function(){var interpolantY=new MonotonicInterpolant_1.default([0,0.5,1],[// Dock to the top
  offsetFromDragPreview.y,// Align at the center
  offsetFromDragPreview.y/sourceHeight*dragPreviewHeight,// Dock to the bottom
  offsetFromDragPreview.y+dragPreviewHeight-sourceHeight]);var y=interpolantY.interpolate(anchorY);// Work around Safari 8 positioning bug
  if(BrowserDetector.isSafari()&&isImage){// We'll have to wait for @3x to see if this is entirely correct
  y+=(window.devicePixelRatio-1)*dragPreviewHeight;}return y;};var calculateXOffset=function(){// Interpolate coordinates depending on anchor point
  // If you know a simpler way to do this, let me know
  var interpolantX=new MonotonicInterpolant_1.default([0,0.5,1],[// Dock to the left
  offsetFromDragPreview.x,// Align at the center
  offsetFromDragPreview.x/sourceWidth*dragPreviewWidth,// Dock to the right
  offsetFromDragPreview.x+dragPreviewWidth-sourceWidth]);return interpolantX.interpolate(anchorX);};// Force offsets if specified in the options.
  var offsetX=offsetPoint.offsetX,offsetY=offsetPoint.offsetY;var isManualOffsetX=offsetX===0||offsetX;var isManualOffsetY=offsetY===0||offsetY;return {x:isManualOffsetX?offsetX:calculateXOffset(),y:isManualOffsetY?offsetY:calculateYOffset()};}exports.getDragPreviewOffset=getDragPreviewOffset;});unwrapExports$2(OffsetUtils);var OffsetUtils_1=OffsetUtils.getNodeClientOffset;var OffsetUtils_2=OffsetUtils.getEventClientOffset;var OffsetUtils_3=OffsetUtils.getDragPreviewOffset;var NativeTypes=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.FILE='__NATIVE_FILE__';exports.URL='__NATIVE_URL__';exports.TEXT='__NATIVE_TEXT__';});unwrapExports$2(NativeTypes);var NativeTypes_1=NativeTypes.FILE;var NativeTypes_2=NativeTypes.URL;var NativeTypes_3=NativeTypes.TEXT;var NativeDragSources=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _a;function getDataFromDataTransfer(dataTransfer,typesToTry,defaultValue){var result=typesToTry.reduce(function(resultSoFar,typeToTry){return resultSoFar||dataTransfer.getData(typeToTry);},null);return result!=null?result:defaultValue;}var nativeTypesConfig=(_a={},_a[NativeTypes.FILE]={exposeProperty:'files',matchesTypes:['Files'],getData:function(dataTransfer){return Array.prototype.slice.call(dataTransfer.files);}},_a[NativeTypes.URL]={exposeProperty:'urls',matchesTypes:['Url','text/uri-list'],getData:function(dataTransfer,matchesTypes){return getDataFromDataTransfer(dataTransfer,matchesTypes,'').split('\n');}},_a[NativeTypes.TEXT]={exposeProperty:'text',matchesTypes:['Text','text/plain'],getData:function(dataTransfer,matchesTypes){return getDataFromDataTransfer(dataTransfer,matchesTypes,'');}},_a);function createNativeDragSource(type){var _a=nativeTypesConfig[type],exposeProperty=_a.exposeProperty,matchesTypes=_a.matchesTypes,getData=_a.getData;return(/** @class */function(){function NativeDragSource(){var _a;this.item=(_a={},Object.defineProperty(_a,exposeProperty,{get:function(){// tslint:disable-next-line no-console
  console.warn("Browser doesn't allow reading \""+exposeProperty+"\" until the drop event.");return null;},enumerable:true,configurable:true}),_a);}NativeDragSource.prototype.mutateItemByReadingDataTransfer=function(dataTransfer){delete this.item[exposeProperty];this.item[exposeProperty]=getData(dataTransfer,matchesTypes);};NativeDragSource.prototype.canDrag=function(){return true;};NativeDragSource.prototype.beginDrag=function(){return this.item;};NativeDragSource.prototype.isDragging=function(monitor,handle){return handle===monitor.getSourceId();};NativeDragSource.prototype.endDrag=function(){// empty
  };return NativeDragSource;}());}exports.createNativeDragSource=createNativeDragSource;function matchNativeItemType(dataTransfer){var dataTransferTypes=Array.prototype.slice.call(dataTransfer.types||[]);return Object.keys(nativeTypesConfig).filter(function(nativeItemType){var matchesTypes=nativeTypesConfig[nativeItemType].matchesTypes;return matchesTypes.some(function(t){return dataTransferTypes.indexOf(t)>-1;});})[0]||null;}exports.matchNativeItemType=matchNativeItemType;});unwrapExports$2(NativeDragSources);var NativeDragSources_1=NativeDragSources.createNativeDragSource;var NativeDragSources_2=NativeDragSources.matchNativeItemType;/** Used as references for various `Number` constants. */var MAX_SAFE_INTEGER$1=9007199254740991;/** Used to detect unsigned integer values. */var reIsUint=/^(?:0|[1-9]\d*)$/;/**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */function isIndex(value,length){var type=typeof value;length=length==null?MAX_SAFE_INTEGER$1:length;return !!length&&(type=='number'||type!='symbol'&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length;}var _isIndex=isIndex;/**
   * Checks if the given arguments are from an iteratee call.
   *
   * @private
   * @param {*} value The potential iteratee value argument.
   * @param {*} index The potential iteratee index or key argument.
   * @param {*} object The potential iteratee object argument.
   * @returns {boolean} Returns `true` if the arguments are from an iteratee call,
   *  else `false`.
   */function isIterateeCall(value,index,object){if(!isObject_1(object)){return false;}var type=typeof index;if(type=='number'?isArrayLike_1(object)&&_isIndex(index,object.length):type=='string'&&index in object){return eq_1(object[index],value);}return false;}var _isIterateeCall=isIterateeCall;/**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}return result;}var _baseTimes=baseTimes;/**
   * This method returns `false`.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {boolean} Returns `false`.
   * @example
   *
   * _.times(2, _.stubFalse);
   * // => [false, false]
   */function stubFalse(){return false;}var stubFalse_1=stubFalse;var isBuffer_1=createCommonjsModule$2(function(module,exports){/** Detect free variable `exports`. */var freeExports=exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&'object'=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/** Built-in value references. */var Buffer=moduleExports?_root.Buffer:undefined;/* Built-in method references for those with the same name as other `lodash` methods. */var nativeIsBuffer=Buffer?Buffer.isBuffer:undefined;/**
   * Checks if `value` is a buffer.
   *
   * @static
   * @memberOf _
   * @since 4.3.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
   * @example
   *
   * _.isBuffer(new Buffer(2));
   * // => true
   *
   * _.isBuffer(new Uint8Array(2));
   * // => false
   */var isBuffer=nativeIsBuffer||stubFalse_1;module.exports=isBuffer;});/** `Object#toString` result references. */var argsTag$1='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag$1='[object Function]',mapTag='[object Map]',numberTag='[object Number]',objectTag$1='[object Object]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',dataViewTag='[object DataView]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';/** Used to identify `toStringTag` values of typed arrays. */var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag$1]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;/**
   * The base implementation of `_.isTypedArray` without Node.js optimizations.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   */function baseIsTypedArray(value){return isObjectLike_1(value)&&isLength_1(value.length)&&!!typedArrayTags[_baseGetTag(value)];}var _baseIsTypedArray=baseIsTypedArray;var _nodeUtil=createCommonjsModule$2(function(module,exports){/** Detect free variable `exports`. */var freeExports=exports&&!exports.nodeType&&exports;/** Detect free variable `module`. */var freeModule=freeExports&&'object'=='object'&&module&&!module.nodeType&&module;/** Detect the popular CommonJS extension `module.exports`. */var moduleExports=freeModule&&freeModule.exports===freeExports;/** Detect free variable `process` from Node.js. */var freeProcess=moduleExports&&_freeGlobal.process;/** Used to access faster Node.js helpers. */var nodeUtil=function(){try{// Use `util.types` for Node.js 10+.
  var types=freeModule&&freeModule.require&&freeModule.require('util').types;if(types){return types;}// Legacy `process.binding('util')` for Node.js < 10.
  return freeProcess&&freeProcess.binding&&freeProcess.binding('util');}catch(e){}}();module.exports=nodeUtil;});/* Node.js helper references. */var nodeIsTypedArray=_nodeUtil&&_nodeUtil.isTypedArray;/**
   * Checks if `value` is classified as a typed array.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   * @example
   *
   * _.isTypedArray(new Uint8Array);
   * // => true
   *
   * _.isTypedArray([]);
   * // => false
   */var isTypedArray=nodeIsTypedArray?_baseUnary(nodeIsTypedArray):_baseIsTypedArray;var isTypedArray_1=isTypedArray;/** Used for built-in method references. */var objectProto$7=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$7=objectProto$7.hasOwnProperty;/**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */function arrayLikeKeys(value,inherited){var isArr=isArray_1(value),isArg=!isArr&&isArguments_1(value),isBuff=!isArr&&!isArg&&isBuffer_1(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray_1(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?_baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty$7.call(value,key))&&!(skipIndexes&&(// Safari 9 has enumerable `arguments.length` in strict mode.
  key=='length'||// Node.js 0.10 has enumerable non-index properties on buffers.
  isBuff&&(key=='offset'||key=='parent')||// PhantomJS 2 has enumerable non-index properties on typed arrays.
  isType&&(key=='buffer'||key=='byteLength'||key=='byteOffset')||// Skip index properties.
  _isIndex(key,length)))){result.push(key);}}return result;}var _arrayLikeKeys=arrayLikeKeys;/** Used for built-in method references. */var objectProto$8=Object.prototype;/**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=='function'&&Ctor.prototype||objectProto$8;return value===proto;}var _isPrototype=isPrototype;/**
   * This function is like
   * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * except that it includes inherited enumerable properties.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key);}}return result;}var _nativeKeysIn=nativeKeysIn;/** Used for built-in method references. */var objectProto$9=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$8=objectProto$9.hasOwnProperty;/**
   * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */function baseKeysIn(object){if(!isObject_1(object)){return _nativeKeysIn(object);}var isProto=_isPrototype(object),result=[];for(var key in object){if(!(key=='constructor'&&(isProto||!hasOwnProperty$8.call(object,key)))){result.push(key);}}return result;}var _baseKeysIn=baseKeysIn;/**
   * Creates an array of the own and inherited enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keysIn(new Foo);
   * // => ['a', 'b', 'c'] (iteration order is not guaranteed)
   */function keysIn(object){return isArrayLike_1(object)?_arrayLikeKeys(object,true):_baseKeysIn(object);}var keysIn_1=keysIn;/** Used for built-in method references. */var objectProto$a=Object.prototype;/** Used to check objects for own properties. */var hasOwnProperty$9=objectProto$a.hasOwnProperty;/**
   * Assigns own and inherited enumerable string keyed properties of source
   * objects to the destination object for all destination properties that
   * resolve to `undefined`. Source objects are applied from left to right.
   * Once a property is set, additional values of the same property are ignored.
   *
   * **Note:** This method mutates `object`.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The destination object.
   * @param {...Object} [sources] The source objects.
   * @returns {Object} Returns `object`.
   * @see _.defaultsDeep
   * @example
   *
   * _.defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
   * // => { 'a': 1, 'b': 2 }
   */var defaults=_baseRest(function(object,sources){object=Object(object);var index=-1;var length=sources.length;var guard=length>2?sources[2]:undefined;if(guard&&_isIterateeCall(sources[0],sources[1],guard)){length=1;}while(++index<length){var source=sources[index];var props=keysIn_1(source);var propsIndex=-1;var propsLength=props.length;while(++propsIndex<propsLength){var key=props[propsIndex];var value=object[key];if(value===undefined||eq_1(value,objectProto$a[key])&&!hasOwnProperty$9.call(object,key)){object[key]=source[key];}}}return object;});var defaults_1=defaults;var HTML5Backend_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var HTML5Backend=/** @class */function(){function HTML5Backend(manager){var _this=this;this.sourcePreviewNodes=new Map();this.sourcePreviewNodeOptions=new Map();this.sourceNodes=new Map();this.sourceNodeOptions=new Map();this.dragStartSourceIds=null;this.dropTargetIds=[];this.dragEnterTargetIds=[];this.currentNativeSource=null;this.currentNativeHandle=null;this.currentDragSourceNode=null;this.altKeyPressed=false;this.mouseMoveTimeoutTimer=null;this.asyncEndDragFrameId=null;this.dragOverTargetIds=null;this.getSourceClientOffset=function(sourceId){return OffsetUtils.getNodeClientOffset(_this.sourceNodes.get(sourceId));};this.endDragNativeItem=function(){if(!_this.isDraggingNativeItem()){return;}_this.actions.endDrag();_this.registry.removeSource(_this.currentNativeHandle);_this.currentNativeHandle=null;_this.currentNativeSource=null;};this.isNodeInDocument=function(node){// Check the node either in the main document or in the current context
  return !!document&&document.body.contains(node)||!!_this.window&&_this.window.document.body.contains(node);};this.endDragIfSourceWasRemovedFromDOM=function(){var node=_this.currentDragSourceNode;if(_this.isNodeInDocument(node)){return;}if(_this.clearCurrentDragSourceNode()){_this.actions.endDrag();}};this.handleTopDragStartCapture=function(){_this.clearCurrentDragSourceNode();_this.dragStartSourceIds=[];};this.handleTopDragStart=function(e){var dragStartSourceIds=_this.dragStartSourceIds;_this.dragStartSourceIds=null;var clientOffset=OffsetUtils.getEventClientOffset(e);// Avoid crashing if we missed a drop event or our previous drag died
  if(_this.monitor.isDragging()){_this.actions.endDrag();}// Don't publish the source just yet (see why below)
  _this.actions.beginDrag(dragStartSourceIds||[],{publishSource:false,getSourceClientOffset:_this.getSourceClientOffset,clientOffset:clientOffset});var dataTransfer=e.dataTransfer;var nativeType=NativeDragSources.matchNativeItemType(dataTransfer);if(_this.monitor.isDragging()){if(typeof dataTransfer.setDragImage==='function'){// Use custom drag image if user specifies it.
  // If child drag source refuses drag but parent agrees,
  // use parent's node as drag image. Neither works in IE though.
  var sourceId=_this.monitor.getSourceId();var sourceNode=_this.sourceNodes.get(sourceId);var dragPreview=_this.sourcePreviewNodes.get(sourceId)||sourceNode;var _a=_this.getCurrentSourcePreviewNodeOptions(),anchorX=_a.anchorX,anchorY=_a.anchorY,offsetX=_a.offsetX,offsetY=_a.offsetY;var anchorPoint={anchorX:anchorX,anchorY:anchorY};var offsetPoint={offsetX:offsetX,offsetY:offsetY};var dragPreviewOffset=OffsetUtils.getDragPreviewOffset(sourceNode,dragPreview,clientOffset,anchorPoint,offsetPoint);dataTransfer.setDragImage(dragPreview,dragPreviewOffset.x,dragPreviewOffset.y);}try{// Firefox won't drag without setting data
  dataTransfer.setData('application/json',{});}catch(err){}// IE doesn't support MIME types in setData
  // Store drag source node so we can check whether
  // it is removed from DOM and trigger endDrag manually.
  _this.setCurrentDragSourceNode(e.target);// Now we are ready to publish the drag source.. or are we not?
  var captureDraggingState=_this.getCurrentSourcePreviewNodeOptions().captureDraggingState;if(!captureDraggingState){// Usually we want to publish it in the next tick so that browser
  // is able to screenshot the current (not yet dragging) state.
  //
  // It also neatly avoids a situation where render() returns null
  // in the same tick for the source element, and browser freaks out.
  setTimeout(function(){return _this.actions.publishDragSource();},0);}else{// In some cases the user may want to override this behavior, e.g.
  // to work around IE not supporting custom drag previews.
  //
  // When using a custom drag layer, the only way to prevent
  // the default drag preview from drawing in IE is to screenshot
  // the dragging state in which the node itself has zero opacity
  // and height. In this case, though, returning null from render()
  // will abruptly end the dragging, which is not obvious.
  //
  // This is the reason such behavior is strictly opt-in.
  _this.actions.publishDragSource();}}else if(nativeType){// A native item (such as URL) dragged from inside the document
  _this.beginDragNativeItem(nativeType);}else if(!dataTransfer.types&&(!e.target.hasAttribute||!e.target.hasAttribute('draggable'))){// Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.
  // Just let it drag. It's a native type (URL or text) and will be picked up in
  // dragenter handler.
  return;}else{// If by this time no drag source reacted, tell browser not to drag.
  e.preventDefault();}};this.handleTopDragEndCapture=function(){if(_this.clearCurrentDragSourceNode()){// Firefox can dispatch this event in an infinite loop
  // if dragend handler does something like showing an alert.
  // Only proceed if we have not handled it already.
  _this.actions.endDrag();}};this.handleTopDragEnterCapture=function(e){_this.dragEnterTargetIds=[];var isFirstEnter=_this.enterLeaveCounter.enter(e.target);if(!isFirstEnter||_this.monitor.isDragging()){return;}var dataTransfer=e.dataTransfer;var nativeType=NativeDragSources.matchNativeItemType(dataTransfer);if(nativeType){// A native item (such as file or URL) dragged from outside the document
  _this.beginDragNativeItem(nativeType);}};this.handleTopDragEnter=function(e){var dragEnterTargetIds=_this.dragEnterTargetIds;_this.dragEnterTargetIds=[];if(!_this.monitor.isDragging()){// This is probably a native item type we don't understand.
  return;}_this.altKeyPressed=e.altKey;if(!BrowserDetector.isFirefox()){// Don't emit hover in `dragenter` on Firefox due to an edge case.
  // If the target changes position as the result of `dragenter`, Firefox
  // will still happily dispatch `dragover` despite target being no longer
  // there. The easy solution is to only fire `hover` in `dragover` on FF.
  _this.actions.hover(dragEnterTargetIds,{clientOffset:OffsetUtils.getEventClientOffset(e)});}var canDrop=dragEnterTargetIds.some(function(targetId){return _this.monitor.canDropOnTarget(targetId);});if(canDrop){// IE requires this to fire dragover events
  e.preventDefault();e.dataTransfer.dropEffect=_this.getCurrentDropEffect();}};this.handleTopDragOverCapture=function(){_this.dragOverTargetIds=[];};this.handleTopDragOver=function(e){var dragOverTargetIds=_this.dragOverTargetIds;_this.dragOverTargetIds=[];if(!_this.monitor.isDragging()){// This is probably a native item type we don't understand.
  // Prevent default "drop and blow away the whole document" action.
  e.preventDefault();e.dataTransfer.dropEffect='none';return;}_this.altKeyPressed=e.altKey;_this.actions.hover(dragOverTargetIds||[],{clientOffset:OffsetUtils.getEventClientOffset(e)});var canDrop=(dragOverTargetIds||[]).some(function(targetId){return _this.monitor.canDropOnTarget(targetId);});if(canDrop){// Show user-specified drop effect.
  e.preventDefault();e.dataTransfer.dropEffect=_this.getCurrentDropEffect();}else if(_this.isDraggingNativeItem()){// Don't show a nice cursor but still prevent default
  // "drop and blow away the whole document" action.
  e.preventDefault();e.dataTransfer.dropEffect='none';}else{e.preventDefault();e.dataTransfer.dropEffect='none';}};this.handleTopDragLeaveCapture=function(e){if(_this.isDraggingNativeItem()){e.preventDefault();}var isLastLeave=_this.enterLeaveCounter.leave(e.target);if(!isLastLeave){return;}if(_this.isDraggingNativeItem()){_this.endDragNativeItem();}};this.handleTopDropCapture=function(e){_this.dropTargetIds=[];e.preventDefault();if(_this.isDraggingNativeItem()){_this.currentNativeSource.mutateItemByReadingDataTransfer(e.dataTransfer);}_this.enterLeaveCounter.reset();};this.handleTopDrop=function(e){var dropTargetIds=_this.dropTargetIds;_this.dropTargetIds=[];_this.actions.hover(dropTargetIds,{clientOffset:OffsetUtils.getEventClientOffset(e)});_this.actions.drop({dropEffect:_this.getCurrentDropEffect()});if(_this.isDraggingNativeItem()){_this.endDragNativeItem();}else{_this.endDragIfSourceWasRemovedFromDOM();}};this.handleSelectStart=function(e){var target=e.target;// Only IE requires us to explicitly say
  // we want drag drop operation to start
  if(typeof target.dragDrop!=='function'){return;}// Inputs and textareas should be selectable
  if(target.tagName==='INPUT'||target.tagName==='SELECT'||target.tagName==='TEXTAREA'||target.isContentEditable){return;}// For other targets, ask IE
  // to enable drag and drop
  e.preventDefault();target.dragDrop();};this.actions=manager.getActions();this.monitor=manager.getMonitor();this.registry=manager.getRegistry();this.context=manager.getContext();this.enterLeaveCounter=new EnterLeaveCounter_1.default(this.isNodeInDocument);}Object.defineProperty(HTML5Backend.prototype,"window",{// public for test
  get:function(){if(this.context&&this.context.window){return this.context.window;}else if(typeof window!=='undefined'){return window;}return undefined;},enumerable:true,configurable:true});HTML5Backend.prototype.setup=function(){if(this.window===undefined){return;}if(this.window.__isReactDndBackendSetUp){throw new Error('Cannot have two HTML5 backends at the same time.');}this.window.__isReactDndBackendSetUp=true;this.addEventListeners(this.window);};HTML5Backend.prototype.teardown=function(){if(this.window===undefined){return;}this.window.__isReactDndBackendSetUp=false;this.removeEventListeners(this.window);this.clearCurrentDragSourceNode();if(this.asyncEndDragFrameId){this.window.cancelAnimationFrame(this.asyncEndDragFrameId);}};HTML5Backend.prototype.connectDragPreview=function(sourceId,node,options){var _this=this;this.sourcePreviewNodeOptions.set(sourceId,options);this.sourcePreviewNodes.set(sourceId,node);return function(){_this.sourcePreviewNodes.delete(sourceId);_this.sourcePreviewNodeOptions.delete(sourceId);};};HTML5Backend.prototype.connectDragSource=function(sourceId,node,options){var _this=this;this.sourceNodes.set(sourceId,node);this.sourceNodeOptions.set(sourceId,options);var handleDragStart=function(e){return _this.handleDragStart(e,sourceId);};var handleSelectStart=function(e){return _this.handleSelectStart(e);};node.setAttribute('draggable',true);node.addEventListener('dragstart',handleDragStart);node.addEventListener('selectstart',handleSelectStart);return function(){_this.sourceNodes.delete(sourceId);_this.sourceNodeOptions.delete(sourceId);node.removeEventListener('dragstart',handleDragStart);node.removeEventListener('selectstart',handleSelectStart);node.setAttribute('draggable',false);};};HTML5Backend.prototype.connectDropTarget=function(targetId,node){var _this=this;var handleDragEnter=function(e){return _this.handleDragEnter(e,targetId);};var handleDragOver=function(e){return _this.handleDragOver(e,targetId);};var handleDrop=function(e){return _this.handleDrop(e,targetId);};node.addEventListener('dragenter',handleDragEnter);node.addEventListener('dragover',handleDragOver);node.addEventListener('drop',handleDrop);return function(){node.removeEventListener('dragenter',handleDragEnter);node.removeEventListener('dragover',handleDragOver);node.removeEventListener('drop',handleDrop);};};HTML5Backend.prototype.addEventListeners=function(target){// SSR Fix (https://github.com/react-dnd/react-dnd/pull/813
  if(!target.addEventListener){return;}target.addEventListener('dragstart',this.handleTopDragStart);target.addEventListener('dragstart',this.handleTopDragStartCapture,true);target.addEventListener('dragend',this.handleTopDragEndCapture,true);target.addEventListener('dragenter',this.handleTopDragEnter);target.addEventListener('dragenter',this.handleTopDragEnterCapture,true);target.addEventListener('dragleave',this.handleTopDragLeaveCapture,true);target.addEventListener('dragover',this.handleTopDragOver);target.addEventListener('dragover',this.handleTopDragOverCapture,true);target.addEventListener('drop',this.handleTopDrop);target.addEventListener('drop',this.handleTopDropCapture,true);};HTML5Backend.prototype.removeEventListeners=function(target){// SSR Fix (https://github.com/react-dnd/react-dnd/pull/813
  if(!target.removeEventListener){return;}target.removeEventListener('dragstart',this.handleTopDragStart);target.removeEventListener('dragstart',this.handleTopDragStartCapture,true);target.removeEventListener('dragend',this.handleTopDragEndCapture,true);target.removeEventListener('dragenter',this.handleTopDragEnter);target.removeEventListener('dragenter',this.handleTopDragEnterCapture,true);target.removeEventListener('dragleave',this.handleTopDragLeaveCapture,true);target.removeEventListener('dragover',this.handleTopDragOver);target.removeEventListener('dragover',this.handleTopDragOverCapture,true);target.removeEventListener('drop',this.handleTopDrop);target.removeEventListener('drop',this.handleTopDropCapture,true);};HTML5Backend.prototype.getCurrentSourceNodeOptions=function(){var sourceId=this.monitor.getSourceId();var sourceNodeOptions=this.sourceNodeOptions.get(sourceId);return defaults_1(sourceNodeOptions||{},{dropEffect:this.altKeyPressed?'copy':'move'});};HTML5Backend.prototype.getCurrentDropEffect=function(){if(this.isDraggingNativeItem()){// It makes more sense to default to 'copy' for native resources
  return 'copy';}return this.getCurrentSourceNodeOptions().dropEffect;};HTML5Backend.prototype.getCurrentSourcePreviewNodeOptions=function(){var sourceId=this.monitor.getSourceId();var sourcePreviewNodeOptions=this.sourcePreviewNodeOptions.get(sourceId);return defaults_1(sourcePreviewNodeOptions||{},{anchorX:0.5,anchorY:0.5,captureDraggingState:false});};HTML5Backend.prototype.isDraggingNativeItem=function(){var itemType=this.monitor.getItemType();return Object.keys(NativeTypes).some(function(key){return NativeTypes[key]===itemType;});};HTML5Backend.prototype.beginDragNativeItem=function(type){this.clearCurrentDragSourceNode();var SourceType=NativeDragSources.createNativeDragSource(type);this.currentNativeSource=new SourceType();this.currentNativeHandle=this.registry.addSource(type,this.currentNativeSource);this.actions.beginDrag([this.currentNativeHandle]);};HTML5Backend.prototype.setCurrentDragSourceNode=function(node){var _this=this;this.clearCurrentDragSourceNode();this.currentDragSourceNode=node;// A timeout of > 0 is necessary to resolve Firefox issue referenced
  // See:
  //   * https://github.com/react-dnd/react-dnd/pull/928
  //   * https://github.com/react-dnd/react-dnd/issues/869
  var MOUSE_MOVE_TIMEOUT=1000;// Receiving a mouse event in the middle of a dragging operation
  // means it has ended and the drag source node disappeared from DOM,
  // so the browser didn't dispatch the dragend event.
  //
  // We need to wait before we start listening for mousemove events.
  // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event
  // immediately in some browsers.
  //
  // See:
  //   * https://github.com/react-dnd/react-dnd/pull/928
  //   * https://github.com/react-dnd/react-dnd/issues/869
  //
  this.mouseMoveTimeoutTimer=setTimeout(function(){return _this.window&&_this.window.addEventListener('mousemove',_this.endDragIfSourceWasRemovedFromDOM,true);},MOUSE_MOVE_TIMEOUT);};HTML5Backend.prototype.clearCurrentDragSourceNode=function(){if(this.currentDragSourceNode){this.currentDragSourceNode=null;if(this.window){this.window.clearTimeout(this.mouseMoveTimeoutTimer);this.window.removeEventListener('mousemove',this.endDragIfSourceWasRemovedFromDOM,true);}this.mouseMoveTimeoutTimer=null;return true;}return false;};HTML5Backend.prototype.handleDragStart=function(e,sourceId){if(!this.dragStartSourceIds){this.dragStartSourceIds=[];}this.dragStartSourceIds.unshift(sourceId);};HTML5Backend.prototype.handleDragEnter=function(e,targetId){this.dragEnterTargetIds.unshift(targetId);};HTML5Backend.prototype.handleDragOver=function(e,targetId){if(this.dragOverTargetIds===null){this.dragOverTargetIds=[];}this.dragOverTargetIds.unshift(targetId);};HTML5Backend.prototype.handleDrop=function(e,targetId){this.dropTargetIds.unshift(targetId);};return HTML5Backend;}();exports.default=HTML5Backend;});unwrapExports$2(HTML5Backend_1);var getEmptyImage_1=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var emptyImage;function getEmptyImage(){if(!emptyImage){emptyImage=new Image();emptyImage.src='data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';}return emptyImage;}exports.default=getEmptyImage;});unwrapExports$2(getEmptyImage_1);var lib$2=createCommonjsModule$2(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.getEmptyImage=getEmptyImage_1.default;exports.NativeTypes=NativeTypes;function createHTML5Backend(manager){return new HTML5Backend_1.default(manager);}exports.default=createHTML5Backend;});var HTML5Backend$1=unwrapExports$2(lib$2);var lib_1$1=lib$2.getEmptyImage;var lib_2$1=lib$2.NativeTypes;// TODO: Find a way for this context to be used in the parent application as well.
  function ViewerbaseDragDropContext(DecoratedClass){return lib_1(HTML5Backend$1,null,true)(DecoratedClass);}

  function styleInject$1(css, ref) {
    if ( ref === void 0 ) ref = {};
    var insertAt = ref.insertAt;

    if (!css || typeof document === 'undefined') { return; }

    var head = document.head || document.getElementsByTagName('head')[0];
    var style = document.createElement('style');
    style.type = 'text/css';

    if (insertAt === 'top') {
      if (head.firstChild) {
        head.insertBefore(style, head.firstChild);
      } else {
        head.appendChild(style);
      }
    } else {
      head.appendChild(style);
    }

    if (style.styleSheet) {
      style.styleSheet.cssText = css;
    } else {
      style.appendChild(document.createTextNode(css));
    }
  }

  var css$q = ".entry-header {\n  padding: 10px 10px 0;\n  height: var(--top-bar-height);\n}\n\n.entry-header.header-big {\n  background: rgba(21,25,30,0.7);\n  padding: 10px var(--study-list-padding);\n  height: auto;\n  display: inline-block;\n  width: 100%;\n}\n\n.header-left-box {\n  display: inline-block;\n  position: relative;\n}\n\n.header-viewerLink {\n  float: left;\n}\n\n.header-brand {\n  height: 30px;\n  text-decoration: none;\n  float: left;\n  clear: both;\n}\n\n.entry-header.header-big .header-brand {\n  height: auto;\n  padding: 25px 0;\n}\n\n\n.header-logo-image {\n  fill: transparent;\n  height: 100%;\n  margin: 0 8px 0 0;\n  width: 30px;\n  float: left;\n}\n\n.entry-header.header-big .header-logo-image {\n  margin: 0 20px 0 0;\n  width: 50px;\n  height: 50px;\n}\n\n.header-logo-text {\n  display: inline-block;\n  font-family: var(--logo-font-family);\n  font-size: 14px;\n  font-weight: var(--logo-font-weight);\n  color: var(--text-primary-color);\n  line-height: 30px;\n}\n\n.entry-header.header-big .header-logo-text {\n  font-size: 30px;\n  line-height: 36px;\n}\n\n.header-btn {\n  color: var(--text-secondary-color);\n  cursor: pointer;\n  font-size: 13px;\n  font-weight: 500;\n  line-height: 26px;\n}\n\n.header-btn:hover {\n  color: var(--hover-color);\n}\n\n.header-btn:active {\n  color: var(--active-color);\n}\n\n.header-studyListLinkSection {\n  border-left: var(--ui-border-thickness) solid var(--ui-border-color);\n  margin: 3px 0 0 10px;\n  padding: 0 0 0 10px;\n  display: inline-block;\n}\n\n.header-menu {\n  color: var(--text-primary-color);\n  float: right;\n  padding: 4px 0;\n  font-size: 13px;\n  font-weight: 400;\n  line-height: 18px;\n  text-decoration: none;\n  margin-right: 10px;\n}\n\n.entry-header.header-big .header-menu {\n  margin-right: 0;\n}\n\n.header-menu .research-use {\n  float: left;\n  font-size: 13px;\n  font-weight: 700;\n  color: #91b9cd;\n  margin-right: 1rem;\n}\n";
  styleInject$1(css$q);

  var list = [
    {
      "title": "Preferences",
      "icon": "fa fa-user",
      "link": "http://www.google.com"
    },
    {
      "title": "About",
      "icon": "fa fa-info",
      "link": "http://ohif.org"
    }
  ]
  ;

  var Icons = '/icons.svg';

  function Header$1(_ref) {
    var home = _ref.home,
        location = _ref.location;
    var state = location.state;
    return React__default.createElement("div", {
      className: "entry-header ".concat(home ? 'header-big' : '')
    }, React__default.createElement("div", {
      className: "header-left-box"
    }, state && state.studyLink && React__default.createElement(Link, {
      to: state.studyLink,
      className: "header-btn header-viewerLink"
    }, "Back to Viewer"), React__default.createElement("a", {
      target: "_blank",
      rel: "noopener noreferrer",
      className: "header-brand",
      href: "http://ohif.org"
    }, React__default.createElement("svg", {
      className: "header-logo-image"
    }, React__default.createElement("use", {
      xlinkHref: "".concat(Icons, "#icon-ohif-logo")
    })), React__default.createElement("div", {
      className: "header-logo-text"
    }, "Open Health Imaging Foundation")), !home && React__default.createElement(Link, {
      className: "header-btn header-studyListLinkSection",
      to: {
        pathname: "/",
        state: {
          studyLink: location.pathname
        }
      }
    }, "Study list")), React__default.createElement("div", {
      className: "header-menu"
    }, React__default.createElement("span", {
      className: "research-use"
    }, "INVESTIGATIONAL USE ONLY"), React__default.createElement(Dropdown, {
      title: "Options",
      list: list,
      align: "right"
    })));
  }

  Header$1.propTypes = {
    home: propTypes.bool.isRequired,
    location: propTypes.object.isRequired
  };
  Header$1.defaultProps = {
    home: true
  };
  var Header$2 = withRouter(Header$1);

  var lodash_clonedeep$2 = createCommonjsModule(function (module, exports) {
  /**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */

  /** Used as the size to enable large array optimizations. */
  var LARGE_ARRAY_SIZE = 200;

  /** Used to stand-in for `undefined` hash values. */
  var HASH_UNDEFINED = '__lodash_hash_undefined__';

  /** Used as references for various `Number` constants. */
  var MAX_SAFE_INTEGER = 9007199254740991;

  /** `Object#toString` result references. */
  var argsTag = '[object Arguments]',
      arrayTag = '[object Array]',
      boolTag = '[object Boolean]',
      dateTag = '[object Date]',
      errorTag = '[object Error]',
      funcTag = '[object Function]',
      genTag = '[object GeneratorFunction]',
      mapTag = '[object Map]',
      numberTag = '[object Number]',
      objectTag = '[object Object]',
      promiseTag = '[object Promise]',
      regexpTag = '[object RegExp]',
      setTag = '[object Set]',
      stringTag = '[object String]',
      symbolTag = '[object Symbol]',
      weakMapTag = '[object WeakMap]';

  var arrayBufferTag = '[object ArrayBuffer]',
      dataViewTag = '[object DataView]',
      float32Tag = '[object Float32Array]',
      float64Tag = '[object Float64Array]',
      int8Tag = '[object Int8Array]',
      int16Tag = '[object Int16Array]',
      int32Tag = '[object Int32Array]',
      uint8Tag = '[object Uint8Array]',
      uint8ClampedTag = '[object Uint8ClampedArray]',
      uint16Tag = '[object Uint16Array]',
      uint32Tag = '[object Uint32Array]';

  /**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */
  var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;

  /** Used to match `RegExp` flags from their coerced string values. */
  var reFlags = /\w*$/;

  /** Used to detect host constructors (Safari). */
  var reIsHostCtor = /^\[object .+?Constructor\]$/;

  /** Used to detect unsigned integer values. */
  var reIsUint = /^(?:0|[1-9]\d*)$/;

  /** Used to identify `toStringTag` values supported by `_.clone`. */
  var cloneableTags = {};
  cloneableTags[argsTag] = cloneableTags[arrayTag] =
  cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =
  cloneableTags[boolTag] = cloneableTags[dateTag] =
  cloneableTags[float32Tag] = cloneableTags[float64Tag] =
  cloneableTags[int8Tag] = cloneableTags[int16Tag] =
  cloneableTags[int32Tag] = cloneableTags[mapTag] =
  cloneableTags[numberTag] = cloneableTags[objectTag] =
  cloneableTags[regexpTag] = cloneableTags[setTag] =
  cloneableTags[stringTag] = cloneableTags[symbolTag] =
  cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =
  cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
  cloneableTags[errorTag] = cloneableTags[funcTag] =
  cloneableTags[weakMapTag] = false;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = typeof commonjsGlobal == 'object' && commonjsGlobal && commonjsGlobal.Object === Object && commonjsGlobal;

  /** Detect free variable `self`. */
  var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

  /** Used as a reference to the global object. */
  var root = freeGlobal || freeSelf || Function('return this')();

  /** Detect free variable `exports`. */
  var freeExports = exports && !exports.nodeType && exports;

  /** Detect free variable `module`. */
  var freeModule = freeExports && 'object' == 'object' && module && !module.nodeType && module;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports = freeModule && freeModule.exports === freeExports;

  /**
   * Adds the key-value `pair` to `map`.
   *
   * @private
   * @param {Object} map The map to modify.
   * @param {Array} pair The key-value pair to add.
   * @returns {Object} Returns `map`.
   */
  function addMapEntry(map, pair) {
    // Don't return `map.set` because it's not chainable in IE 11.
    map.set(pair[0], pair[1]);
    return map;
  }

  /**
   * Adds `value` to `set`.
   *
   * @private
   * @param {Object} set The set to modify.
   * @param {*} value The value to add.
   * @returns {Object} Returns `set`.
   */
  function addSetEntry(set, value) {
    // Don't return `set.add` because it's not chainable in IE 11.
    set.add(value);
    return set;
  }

  /**
   * A specialized version of `_.forEach` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */
  function arrayEach(array, iteratee) {
    var index = -1,
        length = array ? array.length : 0;

    while (++index < length) {
      if (iteratee(array[index], index, array) === false) {
        break;
      }
    }
    return array;
  }

  /**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */
  function arrayPush(array, values) {
    var index = -1,
        length = values.length,
        offset = array.length;

    while (++index < length) {
      array[offset + index] = values[index];
    }
    return array;
  }

  /**
   * A specialized version of `_.reduce` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the first element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */
  function arrayReduce(array, iteratee, accumulator, initAccum) {
    var index = -1,
        length = array ? array.length : 0;

    if (initAccum && length) {
      accumulator = array[++index];
    }
    while (++index < length) {
      accumulator = iteratee(accumulator, array[index], index, array);
    }
    return accumulator;
  }

  /**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */
  function baseTimes(n, iteratee) {
    var index = -1,
        result = Array(n);

    while (++index < n) {
      result[index] = iteratee(index);
    }
    return result;
  }

  /**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */
  function getValue(object, key) {
    return object == null ? undefined : object[key];
  }

  /**
   * Checks if `value` is a host object in IE < 9.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
   */
  function isHostObject(value) {
    // Many host objects are `Object` objects that can coerce to strings
    // despite having improperly defined `toString` methods.
    var result = false;
    if (value != null && typeof value.toString != 'function') {
      try {
        result = !!(value + '');
      } catch (e) {}
    }
    return result;
  }

  /**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */
  function mapToArray(map) {
    var index = -1,
        result = Array(map.size);

    map.forEach(function(value, key) {
      result[++index] = [key, value];
    });
    return result;
  }

  /**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */
  function overArg(func, transform) {
    return function(arg) {
      return func(transform(arg));
    };
  }

  /**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */
  function setToArray(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = value;
    });
    return result;
  }

  /** Used for built-in method references. */
  var arrayProto = Array.prototype,
      funcProto = Function.prototype,
      objectProto = Object.prototype;

  /** Used to detect overreaching core-js shims. */
  var coreJsData = root['__core-js_shared__'];

  /** Used to detect methods masquerading as native. */
  var maskSrcKey = (function() {
    var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
    return uid ? ('Symbol(src)_1.' + uid) : '';
  }());

  /** Used to resolve the decompiled source of functions. */
  var funcToString = funcProto.toString;

  /** Used to check objects for own properties. */
  var hasOwnProperty = objectProto.hasOwnProperty;

  /**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */
  var objectToString = objectProto.toString;

  /** Used to detect if a method is native. */
  var reIsNative = RegExp('^' +
    funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
    .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
  );

  /** Built-in value references. */
  var Buffer = moduleExports ? root.Buffer : undefined,
      Symbol = root.Symbol,
      Uint8Array = root.Uint8Array,
      getPrototype = overArg(Object.getPrototypeOf, Object),
      objectCreate = Object.create,
      propertyIsEnumerable = objectProto.propertyIsEnumerable,
      splice = arrayProto.splice;

  /* Built-in method references for those with the same name as other `lodash` methods. */
  var nativeGetSymbols = Object.getOwnPropertySymbols,
      nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,
      nativeKeys = overArg(Object.keys, Object);

  /* Built-in method references that are verified to be native. */
  var DataView = getNative(root, 'DataView'),
      Map = getNative(root, 'Map'),
      Promise = getNative(root, 'Promise'),
      Set = getNative(root, 'Set'),
      WeakMap = getNative(root, 'WeakMap'),
      nativeCreate = getNative(Object, 'create');

  /** Used to detect maps, sets, and weakmaps. */
  var dataViewCtorString = toSource(DataView),
      mapCtorString = toSource(Map),
      promiseCtorString = toSource(Promise),
      setCtorString = toSource(Set),
      weakMapCtorString = toSource(WeakMap);

  /** Used to convert symbols to primitives and strings. */
  var symbolProto = Symbol ? Symbol.prototype : undefined,
      symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;

  /**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function Hash(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */
  function hashClear() {
    this.__data__ = nativeCreate ? nativeCreate(null) : {};
  }

  /**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function hashDelete(key) {
    return this.has(key) && delete this.__data__[key];
  }

  /**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function hashGet(key) {
    var data = this.__data__;
    if (nativeCreate) {
      var result = data[key];
      return result === HASH_UNDEFINED ? undefined : result;
    }
    return hasOwnProperty.call(data, key) ? data[key] : undefined;
  }

  /**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function hashHas(key) {
    var data = this.__data__;
    return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);
  }

  /**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */
  function hashSet(key, value) {
    var data = this.__data__;
    data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
    return this;
  }

  // Add methods to `Hash`.
  Hash.prototype.clear = hashClear;
  Hash.prototype['delete'] = hashDelete;
  Hash.prototype.get = hashGet;
  Hash.prototype.has = hashHas;
  Hash.prototype.set = hashSet;

  /**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function ListCache(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */
  function listCacheClear() {
    this.__data__ = [];
  }

  /**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function listCacheDelete(key) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    if (index < 0) {
      return false;
    }
    var lastIndex = data.length - 1;
    if (index == lastIndex) {
      data.pop();
    } else {
      splice.call(data, index, 1);
    }
    return true;
  }

  /**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function listCacheGet(key) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    return index < 0 ? undefined : data[index][1];
  }

  /**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function listCacheHas(key) {
    return assocIndexOf(this.__data__, key) > -1;
  }

  /**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */
  function listCacheSet(key, value) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    if (index < 0) {
      data.push([key, value]);
    } else {
      data[index][1] = value;
    }
    return this;
  }

  // Add methods to `ListCache`.
  ListCache.prototype.clear = listCacheClear;
  ListCache.prototype['delete'] = listCacheDelete;
  ListCache.prototype.get = listCacheGet;
  ListCache.prototype.has = listCacheHas;
  ListCache.prototype.set = listCacheSet;

  /**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function MapCache(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */
  function mapCacheClear() {
    this.__data__ = {
      'hash': new Hash,
      'map': new (Map || ListCache),
      'string': new Hash
    };
  }

  /**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function mapCacheDelete(key) {
    return getMapData(this, key)['delete'](key);
  }

  /**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function mapCacheGet(key) {
    return getMapData(this, key).get(key);
  }

  /**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function mapCacheHas(key) {
    return getMapData(this, key).has(key);
  }

  /**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */
  function mapCacheSet(key, value) {
    getMapData(this, key).set(key, value);
    return this;
  }

  // Add methods to `MapCache`.
  MapCache.prototype.clear = mapCacheClear;
  MapCache.prototype['delete'] = mapCacheDelete;
  MapCache.prototype.get = mapCacheGet;
  MapCache.prototype.has = mapCacheHas;
  MapCache.prototype.set = mapCacheSet;

  /**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function Stack(entries) {
    this.__data__ = new ListCache(entries);
  }

  /**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */
  function stackClear() {
    this.__data__ = new ListCache;
  }

  /**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function stackDelete(key) {
    return this.__data__['delete'](key);
  }

  /**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function stackGet(key) {
    return this.__data__.get(key);
  }

  /**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function stackHas(key) {
    return this.__data__.has(key);
  }

  /**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */
  function stackSet(key, value) {
    var cache = this.__data__;
    if (cache instanceof ListCache) {
      var pairs = cache.__data__;
      if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
        pairs.push([key, value]);
        return this;
      }
      cache = this.__data__ = new MapCache(pairs);
    }
    cache.set(key, value);
    return this;
  }

  // Add methods to `Stack`.
  Stack.prototype.clear = stackClear;
  Stack.prototype['delete'] = stackDelete;
  Stack.prototype.get = stackGet;
  Stack.prototype.has = stackHas;
  Stack.prototype.set = stackSet;

  /**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */
  function arrayLikeKeys(value, inherited) {
    // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
    // Safari 9 makes `arguments.length` enumerable in strict mode.
    var result = (isArray(value) || isArguments(value))
      ? baseTimes(value.length, String)
      : [];

    var length = result.length,
        skipIndexes = !!length;

    for (var key in value) {
      if ((inherited || hasOwnProperty.call(value, key)) &&
          !(skipIndexes && (key == 'length' || isIndex(key, length)))) {
        result.push(key);
      }
    }
    return result;
  }

  /**
   * Assigns `value` to `key` of `object` if the existing value is not equivalent
   * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * for equality comparisons.
   *
   * @private
   * @param {Object} object The object to modify.
   * @param {string} key The key of the property to assign.
   * @param {*} value The value to assign.
   */
  function assignValue(object, key, value) {
    var objValue = object[key];
    if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||
        (value === undefined && !(key in object))) {
      object[key] = value;
    }
  }

  /**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function assocIndexOf(array, key) {
    var length = array.length;
    while (length--) {
      if (eq(array[length][0], key)) {
        return length;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `_.assign` without support for multiple sources
   * or `customizer` functions.
   *
   * @private
   * @param {Object} object The destination object.
   * @param {Object} source The source object.
   * @returns {Object} Returns `object`.
   */
  function baseAssign(object, source) {
    return object && copyObject(source, keys(source), object);
  }

  /**
   * The base implementation of `_.clone` and `_.cloneDeep` which tracks
   * traversed objects.
   *
   * @private
   * @param {*} value The value to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @param {boolean} [isFull] Specify a clone including symbols.
   * @param {Function} [customizer] The function to customize cloning.
   * @param {string} [key] The key of `value`.
   * @param {Object} [object] The parent object of `value`.
   * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
   * @returns {*} Returns the cloned value.
   */
  function baseClone(value, isDeep, isFull, customizer, key, object, stack) {
    var result;
    if (customizer) {
      result = object ? customizer(value, key, object, stack) : customizer(value);
    }
    if (result !== undefined) {
      return result;
    }
    if (!isObject(value)) {
      return value;
    }
    var isArr = isArray(value);
    if (isArr) {
      result = initCloneArray(value);
      if (!isDeep) {
        return copyArray(value, result);
      }
    } else {
      var tag = getTag(value),
          isFunc = tag == funcTag || tag == genTag;

      if (isBuffer(value)) {
        return cloneBuffer(value, isDeep);
      }
      if (tag == objectTag || tag == argsTag || (isFunc && !object)) {
        if (isHostObject(value)) {
          return object ? value : {};
        }
        result = initCloneObject(isFunc ? {} : value);
        if (!isDeep) {
          return copySymbols(value, baseAssign(result, value));
        }
      } else {
        if (!cloneableTags[tag]) {
          return object ? value : {};
        }
        result = initCloneByTag(value, tag, baseClone, isDeep);
      }
    }
    // Check for circular references and return its corresponding clone.
    stack || (stack = new Stack);
    var stacked = stack.get(value);
    if (stacked) {
      return stacked;
    }
    stack.set(value, result);

    if (!isArr) {
      var props = isFull ? getAllKeys(value) : keys(value);
    }
    arrayEach(props || value, function(subValue, key) {
      if (props) {
        key = subValue;
        subValue = value[key];
      }
      // Recursively populate clone (susceptible to call stack limits).
      assignValue(result, key, baseClone(subValue, isDeep, isFull, customizer, key, value, stack));
    });
    return result;
  }

  /**
   * The base implementation of `_.create` without support for assigning
   * properties to the created object.
   *
   * @private
   * @param {Object} prototype The object to inherit from.
   * @returns {Object} Returns the new object.
   */
  function baseCreate(proto) {
    return isObject(proto) ? objectCreate(proto) : {};
  }

  /**
   * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
   * `keysFunc` and `symbolsFunc` to get the enumerable property names and
   * symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Function} keysFunc The function to get the keys of `object`.
   * @param {Function} symbolsFunc The function to get the symbols of `object`.
   * @returns {Array} Returns the array of property names and symbols.
   */
  function baseGetAllKeys(object, keysFunc, symbolsFunc) {
    var result = keysFunc(object);
    return isArray(object) ? result : arrayPush(result, symbolsFunc(object));
  }

  /**
   * The base implementation of `getTag`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */
  function baseGetTag(value) {
    return objectToString.call(value);
  }

  /**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */
  function baseIsNative(value) {
    if (!isObject(value) || isMasked(value)) {
      return false;
    }
    var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;
    return pattern.test(toSource(value));
  }

  /**
   * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */
  function baseKeys(object) {
    if (!isPrototype(object)) {
      return nativeKeys(object);
    }
    var result = [];
    for (var key in Object(object)) {
      if (hasOwnProperty.call(object, key) && key != 'constructor') {
        result.push(key);
      }
    }
    return result;
  }

  /**
   * Creates a clone of  `buffer`.
   *
   * @private
   * @param {Buffer} buffer The buffer to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Buffer} Returns the cloned buffer.
   */
  function cloneBuffer(buffer, isDeep) {
    if (isDeep) {
      return buffer.slice();
    }
    var result = new buffer.constructor(buffer.length);
    buffer.copy(result);
    return result;
  }

  /**
   * Creates a clone of `arrayBuffer`.
   *
   * @private
   * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
   * @returns {ArrayBuffer} Returns the cloned array buffer.
   */
  function cloneArrayBuffer(arrayBuffer) {
    var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
    new Uint8Array(result).set(new Uint8Array(arrayBuffer));
    return result;
  }

  /**
   * Creates a clone of `dataView`.
   *
   * @private
   * @param {Object} dataView The data view to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned data view.
   */
  function cloneDataView(dataView, isDeep) {
    var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;
    return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);
  }

  /**
   * Creates a clone of `map`.
   *
   * @private
   * @param {Object} map The map to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned map.
   */
  function cloneMap(map, isDeep, cloneFunc) {
    var array = isDeep ? cloneFunc(mapToArray(map), true) : mapToArray(map);
    return arrayReduce(array, addMapEntry, new map.constructor);
  }

  /**
   * Creates a clone of `regexp`.
   *
   * @private
   * @param {Object} regexp The regexp to clone.
   * @returns {Object} Returns the cloned regexp.
   */
  function cloneRegExp(regexp) {
    var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
    result.lastIndex = regexp.lastIndex;
    return result;
  }

  /**
   * Creates a clone of `set`.
   *
   * @private
   * @param {Object} set The set to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned set.
   */
  function cloneSet(set, isDeep, cloneFunc) {
    var array = isDeep ? cloneFunc(setToArray(set), true) : setToArray(set);
    return arrayReduce(array, addSetEntry, new set.constructor);
  }

  /**
   * Creates a clone of the `symbol` object.
   *
   * @private
   * @param {Object} symbol The symbol object to clone.
   * @returns {Object} Returns the cloned symbol object.
   */
  function cloneSymbol(symbol) {
    return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};
  }

  /**
   * Creates a clone of `typedArray`.
   *
   * @private
   * @param {Object} typedArray The typed array to clone.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the cloned typed array.
   */
  function cloneTypedArray(typedArray, isDeep) {
    var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
    return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);
  }

  /**
   * Copies the values of `source` to `array`.
   *
   * @private
   * @param {Array} source The array to copy values from.
   * @param {Array} [array=[]] The array to copy values to.
   * @returns {Array} Returns `array`.
   */
  function copyArray(source, array) {
    var index = -1,
        length = source.length;

    array || (array = Array(length));
    while (++index < length) {
      array[index] = source[index];
    }
    return array;
  }

  /**
   * Copies properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy properties from.
   * @param {Array} props The property identifiers to copy.
   * @param {Object} [object={}] The object to copy properties to.
   * @param {Function} [customizer] The function to customize copied values.
   * @returns {Object} Returns `object`.
   */
  function copyObject(source, props, object, customizer) {
    object || (object = {});

    var index = -1,
        length = props.length;

    while (++index < length) {
      var key = props[index];

      var newValue = customizer
        ? customizer(object[key], source[key], key, object, source)
        : undefined;

      assignValue(object, key, newValue === undefined ? source[key] : newValue);
    }
    return object;
  }

  /**
   * Copies own symbol properties of `source` to `object`.
   *
   * @private
   * @param {Object} source The object to copy symbols from.
   * @param {Object} [object={}] The object to copy symbols to.
   * @returns {Object} Returns `object`.
   */
  function copySymbols(source, object) {
    return copyObject(source, getSymbols(source), object);
  }

  /**
   * Creates an array of own enumerable property names and symbols of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names and symbols.
   */
  function getAllKeys(object) {
    return baseGetAllKeys(object, keys, getSymbols);
  }

  /**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */
  function getMapData(map, key) {
    var data = map.__data__;
    return isKeyable(key)
      ? data[typeof key == 'string' ? 'string' : 'hash']
      : data.map;
  }

  /**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */
  function getNative(object, key) {
    var value = getValue(object, key);
    return baseIsNative(value) ? value : undefined;
  }

  /**
   * Creates an array of the own enumerable symbol properties of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of symbols.
   */
  var getSymbols = nativeGetSymbols ? overArg(nativeGetSymbols, Object) : stubArray;

  /**
   * Gets the `toStringTag` of `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */
  var getTag = baseGetTag;

  // Fallback for data views, maps, sets, and weak maps in IE 11,
  // for data views in Edge < 14, and promises in Node.js.
  if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
      (Map && getTag(new Map) != mapTag) ||
      (Promise && getTag(Promise.resolve()) != promiseTag) ||
      (Set && getTag(new Set) != setTag) ||
      (WeakMap && getTag(new WeakMap) != weakMapTag)) {
    getTag = function(value) {
      var result = objectToString.call(value),
          Ctor = result == objectTag ? value.constructor : undefined,
          ctorString = Ctor ? toSource(Ctor) : undefined;

      if (ctorString) {
        switch (ctorString) {
          case dataViewCtorString: return dataViewTag;
          case mapCtorString: return mapTag;
          case promiseCtorString: return promiseTag;
          case setCtorString: return setTag;
          case weakMapCtorString: return weakMapTag;
        }
      }
      return result;
    };
  }

  /**
   * Initializes an array clone.
   *
   * @private
   * @param {Array} array The array to clone.
   * @returns {Array} Returns the initialized clone.
   */
  function initCloneArray(array) {
    var length = array.length,
        result = array.constructor(length);

    // Add properties assigned by `RegExp#exec`.
    if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {
      result.index = array.index;
      result.input = array.input;
    }
    return result;
  }

  /**
   * Initializes an object clone.
   *
   * @private
   * @param {Object} object The object to clone.
   * @returns {Object} Returns the initialized clone.
   */
  function initCloneObject(object) {
    return (typeof object.constructor == 'function' && !isPrototype(object))
      ? baseCreate(getPrototype(object))
      : {};
  }

  /**
   * Initializes an object clone based on its `toStringTag`.
   *
   * **Note:** This function only supports cloning values with tags of
   * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
   *
   * @private
   * @param {Object} object The object to clone.
   * @param {string} tag The `toStringTag` of the object to clone.
   * @param {Function} cloneFunc The function to clone values.
   * @param {boolean} [isDeep] Specify a deep clone.
   * @returns {Object} Returns the initialized clone.
   */
  function initCloneByTag(object, tag, cloneFunc, isDeep) {
    var Ctor = object.constructor;
    switch (tag) {
      case arrayBufferTag:
        return cloneArrayBuffer(object);

      case boolTag:
      case dateTag:
        return new Ctor(+object);

      case dataViewTag:
        return cloneDataView(object, isDeep);

      case float32Tag: case float64Tag:
      case int8Tag: case int16Tag: case int32Tag:
      case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:
        return cloneTypedArray(object, isDeep);

      case mapTag:
        return cloneMap(object, isDeep, cloneFunc);

      case numberTag:
      case stringTag:
        return new Ctor(object);

      case regexpTag:
        return cloneRegExp(object);

      case setTag:
        return cloneSet(object, isDeep, cloneFunc);

      case symbolTag:
        return cloneSymbol(object);
    }
  }

  /**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */
  function isIndex(value, length) {
    length = length == null ? MAX_SAFE_INTEGER : length;
    return !!length &&
      (typeof value == 'number' || reIsUint.test(value)) &&
      (value > -1 && value % 1 == 0 && value < length);
  }

  /**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */
  function isKeyable(value) {
    var type = typeof value;
    return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
      ? (value !== '__proto__')
      : (value === null);
  }

  /**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */
  function isMasked(func) {
    return !!maskSrcKey && (maskSrcKey in func);
  }

  /**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */
  function isPrototype(value) {
    var Ctor = value && value.constructor,
        proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

    return value === proto;
  }

  /**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to process.
   * @returns {string} Returns the source code.
   */
  function toSource(func) {
    if (func != null) {
      try {
        return funcToString.call(func);
      } catch (e) {}
      try {
        return (func + '');
      } catch (e) {}
    }
    return '';
  }

  /**
   * This method is like `_.clone` except that it recursively clones `value`.
   *
   * @static
   * @memberOf _
   * @since 1.0.0
   * @category Lang
   * @param {*} value The value to recursively clone.
   * @returns {*} Returns the deep cloned value.
   * @see _.clone
   * @example
   *
   * var objects = [{ 'a': 1 }, { 'b': 2 }];
   *
   * var deep = _.cloneDeep(objects);
   * console.log(deep[0] === objects[0]);
   * // => false
   */
  function cloneDeep(value) {
    return baseClone(value, true, true);
  }

  /**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */
  function eq(value, other) {
    return value === other || (value !== value && other !== other);
  }

  /**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */
  function isArguments(value) {
    // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
    return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&
      (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);
  }

  /**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */
  var isArray = Array.isArray;

  /**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */
  function isArrayLike(value) {
    return value != null && isLength(value.length) && !isFunction(value);
  }

  /**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */
  function isArrayLikeObject(value) {
    return isObjectLike(value) && isArrayLike(value);
  }

  /**
   * Checks if `value` is a buffer.
   *
   * @static
   * @memberOf _
   * @since 4.3.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
   * @example
   *
   * _.isBuffer(new Buffer(2));
   * // => true
   *
   * _.isBuffer(new Uint8Array(2));
   * // => false
   */
  var isBuffer = nativeIsBuffer || stubFalse;

  /**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */
  function isFunction(value) {
    // The use of `Object#toString` avoids issues with the `typeof` operator
    // in Safari 8-9 which returns 'object' for typed array and other constructors.
    var tag = isObject(value) ? objectToString.call(value) : '';
    return tag == funcTag || tag == genTag;
  }

  /**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */
  function isLength(value) {
    return typeof value == 'number' &&
      value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
  }

  /**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */
  function isObject(value) {
    var type = typeof value;
    return !!value && (type == 'object' || type == 'function');
  }

  /**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */
  function isObjectLike(value) {
    return !!value && typeof value == 'object';
  }

  /**
   * Creates an array of the own enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects. See the
   * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * for more details.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keys(new Foo);
   * // => ['a', 'b'] (iteration order is not guaranteed)
   *
   * _.keys('hi');
   * // => ['0', '1']
   */
  function keys(object) {
    return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
  }

  /**
   * This method returns a new empty array.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {Array} Returns the new empty array.
   * @example
   *
   * var arrays = _.times(2, _.stubArray);
   *
   * console.log(arrays);
   * // => [[], []]
   *
   * console.log(arrays[0] === arrays[1]);
   * // => false
   */
  function stubArray() {
    return [];
  }

  /**
   * This method returns `false`.
   *
   * @static
   * @memberOf _
   * @since 4.13.0
   * @category Util
   * @returns {boolean} Returns `false`.
   * @example
   *
   * _.times(2, _.stubFalse);
   * // => [false, false]
   */
  function stubFalse() {
    return false;
  }

  module.exports = cloneDeep;
  });

  // - Determine in which display set is active from Redux (activeViewportIndex and layout viewportData)
  // - Pass in errors and stack loading progress from Redux

  var mapStateToProps = function mapStateToProps(state, ownProps) {
    // If we know that the stack loading progress details have changed,
    // we can try to update the component state so that the thumbnail
    // progress bar is updated
    var stackLoadingProgressMap = state.loading.progress;
    var studiesWithLoadingData = lodash_clonedeep$2(ownProps.studies);
    studiesWithLoadingData.forEach(function (study) {
      study.thumbnails.forEach(function (data) {
        var displaySetInstanceUid = data.displaySetInstanceUid;
        var stackId = "StackProgress:".concat(displaySetInstanceUid);
        var stackProgressData = stackLoadingProgressMap[stackId];
        var stackPercentComplete = 0;

        if (stackProgressData) {
          stackPercentComplete = stackProgressData.percentComplete;
        }

        data.stackPercentComplete = stackPercentComplete;
      });
    });
    return {
      studies: studiesWithLoadingData
    };
  };

  var ConnectedStudyBrowser = connect(mapStateToProps, null)(StudyBrowser);

  var mapStateToProps$1 = function mapStateToProps(state) {
    var viewportPluginIds = state.plugins.availablePlugins.filter(function (plugin) {
      return plugin.type === OHIF$1.plugins.PLUGIN_TYPES.VIEWPORT;
    }).map(function (plugin) {
      return plugin.id;
    });
    var availablePlugins = {};
    viewportPluginIds.forEach(function (id) {
      var plugin = OHIF$1.plugins.availablePlugins.find(function (plugin) {
        return plugin.id === id;
      });

      if (plugin) {
        availablePlugins[id] = plugin.component;
      }
    }); // TODO Use something like state.plugins.defaultPlugin[OHIF.plugins.PLUGIN_TYPES.VIEWPORT]

    var defaultPlugin;

    if (viewportPluginIds && viewportPluginIds.length) {
      defaultPlugin = viewportPluginIds[0];
    }

    return {
      layout: state.viewports.layout,
      activeViewportIndex: state.viewports.activeViewportIndex,
      availablePlugins: availablePlugins,
      defaultPlugin: defaultPlugin
    };
  };

  var ConnectedLayoutManager = connect(mapStateToProps$1, null)(LayoutManager);

  var css$r = "#viewer {\n  height: calc(100% - var(--top-bar-height));\n}\n\n#viewer > .loadingTextDiv {\n  color: var(--text-secondary-color);\n  font-size: 30px;\n  height: 100%;\n  line-height: calc(100% - var(--top-bar-height));\n}\n\n.ViewerMain {\n  width: 100%;\n  height: 100%;\n  transition: all 0.3s ease;\n}\n\n.ViewerMain>div {\n  width: 100%;\n  height: 100%;\n}\n\n.ViewerMain #imageViewerViewports .viewportContainer {\n  /*theme('border', '%s solid $uiBorderColorDark' % $viewportBorderThickness)*/\n  /*float: left;\n  position: relative;*/\n  outline: 0; /* Prevent blue outline in Chrome */\n}\n\n.ViewerMain #imageViewerViewports .viewportContainer:hover,\n.ViewerMain #imageViewerViewports .viewportContainer:active,\n.ViewerMain #imageViewerViewports .viewportContainer:hover.active {\n  outline: 0; /* Prevent blue outline in Chrome */\n}\n\n/*    &:hover\n      //theme('border', '%s solid $uiBorderColor' % $viewportBorderThickness)\n\n    &.active, &:hover.active\n      //theme('border', '%s solid $uiBorderColorActive' % $viewportBorderThickness)\n*/\n";
  styleInject$1(css$r);

  cornerstoneTools$1.external.cornerstoneMath = cornerstoneMath$1;

  var ViewerMain =
  /*#__PURE__*/
  function (_Component) {
    inherits(ViewerMain, _Component);

    function ViewerMain() {
      var _getPrototypeOf2;

      var _this;

      classCallCheck(this, ViewerMain);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = possibleConstructorReturn(this, (_getPrototypeOf2 = getPrototypeOf(ViewerMain)).call.apply(_getPrototypeOf2, [this].concat(args)));

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "state", {
        viewportData: []
      });

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "setViewportData", function (_ref) {
        var viewportIndex = _ref.viewportIndex,
            item = _ref.item;
        // TODO: Replace this with mapDispatchToProps call
        // if we decide to put viewport info into redux
        // Note: Use Slice because React does a shallow equality check. Mutating the array
        // would not trigger a re-render. We have to create a copy.
        debugger;
        console.warn(item);

        var updatedViewportData = _this.state.viewportData.slice(0);

        var displaySet = _this.findDisplaySet(_this.props.studies, item.studyInstanceUid, item.displaySetInstanceUid);

        console.warn(displaySet);
        updatedViewportData[viewportIndex] = Object.assign({}, displaySet);

        _this.setState({
          viewportData: updatedViewportData
        });
      });

      return _this;
    }

    createClass(ViewerMain, [{
      key: "getDisplaySetsWithImages",
      value: function getDisplaySetsWithImages(studies$$1) {
        var displaySets = [];
        studies$$1.forEach(function (study) {
          study.displaySets.forEach(function (dSet) {
            if (dSet.images.length) {
              displaySets.push(dSet);
            }
          });
        });
        return displaySets;
      }
    }, {
      key: "findDisplaySet",
      value: function findDisplaySet(studies$$1, studyInstanceUid, displaySetInstanceUid) {
        var study = studies$$1.find(function (study) {
          return study.studyInstanceUid === studyInstanceUid;
        });

        if (!study) {
          return;
        }

        return study.displaySets.find(function (displaySet) {
          return displaySet.displaySetInstanceUid === displaySetInstanceUid;
        });
      }
    }, {
      key: "componentDidMount",
      value: function componentDidMount() {
        // Add beforeUnload event handler to check for unsaved changes
        //window.addEventListener('beforeunload', unloadHandlers.beforeUnload);
        // Get all the display sets for the viewer studies
        var displaySets = this.getDisplaySetsWithImages(this.props.studies);
        this.setState({
          viewportData: displaySets
        });
      }
    }, {
      key: "render",
      value: function render() {
        return React__default.createElement("div", {
          className: "ViewerMain"
        }, React__default.createElement(ConnectedLayoutManager, {
          studies: this.props.studies,
          viewportData: this.state.viewportData,
          setViewportData: this.setViewportData
        }));
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        // Remove beforeUnload event handler...
        //window.removeEventListener('beforeunload', unloadHandlers.beforeUnload);
        // Destroy the synchronizer used to update reference lines
        OHIF$1.viewer.updateImageSynchronizer.destroy(); // TODO: Instruct all plugins to clean up themselves
        //
        // Clear references to all stacks in the StackManager
        //StackManager.clearStacks();
        // @TypeSafeStudies
        // Clears OHIF.viewer.Studies collection
        //OHIF.viewer.Studies.removeAll();
        // @TypeSafeStudies
        // Clears OHIF.viewer.StudyMetadataList collection
        //OHIF.viewer.StudyMetadataList.removeAll();
      }
    }]);

    return ViewerMain;
  }(React.Component);

  defineProperty(ViewerMain, "propTypes", {
    studies: propTypes.array.isRequired
  });

  var css$s = ".FlexboxLayout {\n    display: flex;\n    flex: 1;\n    flex-flow: row nowrap;\n    align-items: stretch;\n    height: calc(100% - var(--toolbar-height));\n    width: 100%;\n}\n\n.sidebar-menu {\n    height: 100%;\n    /* required transformation to make inner fixed elements relative to this one*/\n    transform: scale(1);\n    transition: var(--sidebar-transition);\n}\n\n.sidebar-left {\n    border-right: var(--ui-border-thickness) solid var(--ui-border-color);\n    flex: 1;\n    margin-left: calc(var(--left-sidebar-menu-width) * -1);\n    max-width: var(--left-sidebar-menu-width);\n    order: 1\n}\n\n.sidebar-left.sidebar-open {\n    margin-left: 0\n}\n\n.main-content {\n    flex: 1;\n    height: 100%;\n    order: 2;\n    overflow: hidden;\n    transition: var(--sidebar-transition);\n    width: 100%;\n}\n\n.sidebar-right {\n    flex: 1;\n    margin-right: calc(var(--right-sidebar-menu-width) * -1);\n    max-width: var(--right-sidebar-menu-width);\n    order: 3;\n}\n\n.sidebar-right.sidebar-open {\n    margin-right: 0;\n}\n";
  styleInject$1(css$s);

  var FlexboxLayout =
  /*#__PURE__*/
  function (_Component) {
    inherits(FlexboxLayout, _Component);

    function FlexboxLayout() {
      var _getPrototypeOf2;

      var _this;

      classCallCheck(this, FlexboxLayout);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = possibleConstructorReturn(this, (_getPrototypeOf2 = getPrototypeOf(FlexboxLayout)).call.apply(_getPrototypeOf2, [this].concat(args)));

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "state", {
        studiesForBrowser: []
      });

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "getStudiesForBrowser", function () {
        var studies = _this.props.studies; // TODO[react]:
        // - Add sorting of display sets
        // - Add useMiddleSeriesInstanceAsThumbnail
        // - Add showStackLoadingProgressBar option

        return studies.map(function (study) {
          var studyInstanceUid = study.studyInstanceUid;
          var thumbnails = study.displaySets.map(function (displaySet) {
            var displaySetInstanceUid = displaySet.displaySetInstanceUid,
                seriesDescription = displaySet.seriesDescription,
                seriesNumber = displaySet.seriesNumber,
                instanceNumber = displaySet.instanceNumber,
                numImageFrames = displaySet.numImageFrames;
            var imageId = displaySet.images[0].getImageId();
            return {
              imageId: imageId,
              displaySetInstanceUid: displaySetInstanceUid,
              seriesDescription: seriesDescription,
              seriesNumber: seriesNumber,
              instanceNumber: instanceNumber,
              numImageFrames: numImageFrames
            };
          });
          return {
            studyInstanceUid: studyInstanceUid,
            thumbnails: thumbnails
          };
        });
      });

      return _this;
    }

    createClass(FlexboxLayout, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var studiesForBrowser = this.getStudiesForBrowser();
        this.setState({
          studiesForBrowser: studiesForBrowser
        });
      }
    }, {
      key: "render",
      value: function render() {
        var mainContentClassName = "main-content";

        if (this.props.leftSidebarOpen) {
          mainContentClassName += ' sidebar-left-open';
        }

        if (this.props.rightSidebarOpen) {
          mainContentClassName += ' sidebar-right-open';
        } // TODO[react]: Add measurementLightTable


        return React__default.createElement("div", {
          className: "FlexboxLayout"
        }, React__default.createElement("div", {
          className: this.props.leftSidebarOpen ? "sidebar-menu sidebar-left sidebar-open" : "sidebar-menu sidebar-left"
        }, React__default.createElement(ConnectedStudyBrowser, {
          studies: this.state.studiesForBrowser
        })), React__default.createElement("div", {
          className: mainContentClassName
        }, React__default.createElement(ViewerMain, {
          studies: this.props.studies
        })));
      }
    }]);

    return FlexboxLayout;
  }(React.Component);

  defineProperty(FlexboxLayout, "propTypes", {
    studies: propTypes.array.isRequired,
    leftSidebarOpen: propTypes.bool.isRequired,
    rightSidebarOpen: propTypes.bool.isRequired
  });

  var mapStateToProps$2 = function mapStateToProps(state) {
    return {
      leftSidebarOpen: state.ui.leftSidebarOpen,
      rightSidebarOpen: state.ui.rightSidebarOpen
    };
  };

  var ConnectedFlexboxLayout = connect(mapStateToProps$2, null)(FlexboxLayout);

  var _setToolActive = OHIF$1.redux.actions.setToolActive;

  var mapStateToProps$3 = function mapStateToProps(state) {
    var activeButton = state.tools.buttons.find(function (tool) {
      return tool.active === true;
    });
    return {
      buttons: state.tools.buttons,
      activeCommand: activeButton && activeButton.command
    };
  };

  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    return {
      setToolActive: function setToolActive(tool) {
        dispatch(_setToolActive(tool.command));
      }
    };
  };

  var ConnectedToolbarSection = connect(mapStateToProps$3, mapDispatchToProps)(ToolbarSection);

  var setLayout$1 = OHIF$1.redux.actions.setLayout;

  var mapStateToProps$4 = function mapStateToProps(state) {
    return {
      currentLayout: state.viewports.layout
    };
  };

  var mapDispatchToProps$1 = function mapDispatchToProps(dispatch) {
    return {
      // TODO: Change if layout switched becomes more complex
      onChange: function onChange(selectedCell) {
        var viewports = [];
        var rows = selectedCell.row + 1;
        var columns = selectedCell.col + 1;
        var numViewports = rows * columns;

        for (var i = 0; i < numViewports; i++) {
          viewports.push({
            height: "".concat(100 / rows, "%"),
            width: "".concat(100 / columns, "%")
          });
        }

        var layout = {
          viewports: viewports
        };
        dispatch(setLayout$1(layout));
      }
    };
  };

  var ConnectedLayoutButton = connect(mapStateToProps$4, mapDispatchToProps$1)(LayoutButton);

  var setViewportSpecificData$1 = OHIF$1.redux.actions.setViewportSpecificData; // TODO: I'm guessing this function will be used in other connect locations
  // so we might want to put it somewhere shared

  function getActiveViewportSpecificData(state) {
    var _state$viewports = state.viewports,
        viewportSpecificData = _state$viewports.viewportSpecificData,
        activeViewportIndex = _state$viewports.activeViewportIndex;
    return viewportSpecificData[activeViewportIndex];
  }

  var mapStateToProps$5 = function mapStateToProps(state) {
    // TODO:
    // - Test if including CineDialog in the toolbarRow will prevent it
    // from hovering over the rest of the UI when visible.
    //
    // - Create custom ToolbarButton which just shows Play state
    // - Connect this ToolbarButton to Redux
    var activeViewportSpecificData = getActiveViewportSpecificData(state);
    var stack = {
      imageIds: [],
      currentImageIdIndex: 0
    };

    if (activeViewportSpecificData && activeViewportSpecificData.stack) {
      stack = activeViewportSpecificData.stack;
    }

    var cine = {
      isPlaying: false,
      cineFrameRate: 24
    };

    if (activeViewportSpecificData && activeViewportSpecificData.cine) {
      cine = activeViewportSpecificData.cine;
    } // TODO: activeViewportStackData won't currently change anything on
    // CornerstoneViewport. The updates are too frequent and it's killing
    // performance. Need to revisit how we can do this.


    return {
      activeViewportStackData: stack,
      activeViewportCineData: cine,
      activeViewportIndex: state.viewports.activeViewportIndex
    };
  };

  var mapDispatchToProps$2 = function mapDispatchToProps(dispatch) {
    return {
      dispatchSetViewportSpecificData: function dispatchSetViewportSpecificData(viewportIndex, data) {
        dispatch(setViewportSpecificData$1(viewportIndex, data));
      }
    };
  };

  var mergeProps = function mergeProps(propsFromState, propsFromDispatch, ownProps) {
    var activeViewportStackData = propsFromState.activeViewportStackData,
        activeViewportCineData = propsFromState.activeViewportCineData,
        activeViewportIndex = propsFromState.activeViewportIndex;
    return {
      cineFrameRate: activeViewportCineData.cineFrameRate,
      isPlaying: activeViewportCineData.isPlaying,
      onPlayPauseChanged: function onPlayPauseChanged(isPlaying) {
        var cine = lodash_clonedeep$2(activeViewportCineData);
        cine.isPlaying = !cine.isPlaying;
        propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {
          cine: cine
        });
      },
      onFrameRateChanged: function onFrameRateChanged(frameRate) {
        var cine = lodash_clonedeep$2(activeViewportCineData);
        cine.cineFrameRate = frameRate;
        propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {
          cine: cine
        });
      },
      onClickNextButton: function onClickNextButton() {
        var stack = lodash_clonedeep$2(activeViewportStackData);
        var largestPossibleIndex = stack.imageIds.length - 1;
        stack.currentImageIdIndex = Math.min(stack.currentImageIdIndex + 1, largestPossibleIndex);
        propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {
          stack: stack
        });
      },
      onClickBackButton: function onClickBackButton() {
        var stack = lodash_clonedeep$2(activeViewportStackData);
        stack.currentImageIdIndex = Math.max(stack.currentImageIdIndex - 1, 0);
        propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {
          stack: stack
        });
      },
      onClickSkipToStart: function onClickSkipToStart() {
        var stack = lodash_clonedeep$2(activeViewportStackData);
        stack.currentImageIdIndex = 0;
        propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {
          stack: stack
        });
      },
      onClickSkipToEnd: function onClickSkipToEnd() {
        var stack = lodash_clonedeep$2(activeViewportStackData);
        stack.currentImageIdIndex = stack.imageIds.length;
        propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {
          stack: stack
        });
      }
    };
  };

  var ConnectedCineDialog = connect(mapStateToProps$5, mapDispatchToProps$2, mergeProps)(CineDialog);

  var css$t = ".ToolbarRow {\n    border-bottom: var(--ui-border-thickness) solid var(--ui-border-color);\n    flex: 0 0 auto;\n    height: var(--toolbar-height);\n    padding-top: 6px;\n    padding-left: 1rem;\n    padding-right: 1rem;\n    position: relative;\n    transition: height 300ms ease;\n    width: 100%;\n}\n\nToolbarRow.expanded {\n    height: calc(var(--toolbar-height) + var(--toolbar-drawer-height));\n}\n\n";
  styleInject$1(css$t);

  var Icons$1 = '/icons.svg';

  var ToolbarRow =
  /*#__PURE__*/
  function (_Component) {
    inherits(ToolbarRow, _Component);

    function ToolbarRow() {
      var _getPrototypeOf2;

      var _this;

      classCallCheck(this, ToolbarRow);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = possibleConstructorReturn(this, (_getPrototypeOf2 = getPrototypeOf(ToolbarRow)).call.apply(_getPrototypeOf2, [this].concat(args)));

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "onLeftSidebarValueChanged", function (value) {
        _this.props.setLeftSidebarOpen(!!value);
      });

      return _this;
    }

    createClass(ToolbarRow, [{
      key: "render",
      value: function render() {
        var leftSidebarToggle = [{
          value: 'studies',
          svgLink: "".concat(Icons$1, "#icon-studies"),
          svgWidth: 15,
          svgHeight: 13,
          bottomLabel: 'Series'
        }];
        var leftSidebarValue = this.props.leftSidebarOpen ? leftSidebarToggle[0].value : null;
        return React__default.createElement("div", {
          className: "ToolbarRow"
        }, React__default.createElement("div", {
          className: "pull-left m-t-1 p-y-1",
          style: {
            padding: '10px'
          }
        }, React__default.createElement(RoundedButtonGroup, {
          options: leftSidebarToggle,
          value: leftSidebarValue,
          onValueChanged: this.onLeftSidebarValueChanged
        })), React__default.createElement(ConnectedToolbarSection, null), React__default.createElement(ConnectedLayoutButton, null), React__default.createElement("div", {
          style: {
            marginLeft: '100px',
            display: 'inline-block'
          }
        }, React__default.createElement(ConnectedCineDialog, null)), React__default.createElement("div", {
          className: "pull-right m-t-1 rm-x-1"
        }));
      }
    }]);

    return ToolbarRow;
  }(React.Component);

  defineProperty(ToolbarRow, "propTypes", {
    leftSidebarOpen: propTypes.bool.isRequired,
    rightSidebarOpen: propTypes.bool.isRequired,
    setLeftSidebarOpen: propTypes.func,
    setRightSidebarOpen: propTypes.func
  });

  defineProperty(ToolbarRow, "defaultProps", {
    leftSidebarOpen: false,
    rightSidebarOpen: false
  });

  var setLeftSidebarOpen = function setLeftSidebarOpen(state) {
    return {
      type: 'SET_LEFT_SIDEBAR_OPEN',
      state: state
    };
  };
  var setRightSidebarOpen = function setRightSidebarOpen(state) {
    return {
      type: 'SET_RIGHT_SIDEBAR_OPEN',
      state: state
    };
  };

  var mapStateToProps$6 = function mapStateToProps(state) {
    return {
      leftSidebarOpen: state.ui.leftSidebarOpen,
      rightSidebarOpen: state.ui.rightSidebarOpen
    };
  };

  var mapDispatchToProps$3 = function mapDispatchToProps(dispatch) {
    return {
      setLeftSidebarOpen: function setLeftSidebarOpen$$1(state) {
        dispatch(setLeftSidebarOpen(state));
      },
      setRightSidebarOpen: function setRightSidebarOpen$$1(state) {
        dispatch(setRightSidebarOpen(state));
      }
    };
  };

  var ConnectedToolbarRow = connect(mapStateToProps$6, mapDispatchToProps$3)(ToolbarRow);

  var StudyLoadingMonitor =
  /*#__PURE__*/
  function (_Component) {
    inherits(StudyLoadingMonitor, _Component);

    function StudyLoadingMonitor() {
      classCallCheck(this, StudyLoadingMonitor);

      return possibleConstructorReturn(this, getPrototypeOf(StudyLoadingMonitor).apply(this, arguments));
    }

    createClass(StudyLoadingMonitor, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this = this;

        // TODO: This is pretty ugly. The thing is that the StudyLoadingListener
        // needs to update the Redux store, but shouldn't know that it exists.
        // I am therefore passing in some functions to update the store instead,
        // but this should definitely be cleaned up somehow.
        var options = {
          _setProgressData: function _setProgressData(progressId, progressData) {
            _this.props.setStudyLoadingProgress(progressId, progressData);
          },
          _clearProgressById: function _clearProgressById(progressId) {
            _this.props.clearStudyLoadingProgress(progressId);
          }
        };
        var StudyLoadingListener = OHIF$1.classes.StudyLoadingListener;
        this.studyLoadingListener = StudyLoadingListener.getInstance(options);
        this.studyLoadingListener.clear();
        this.studyLoadingListener.addStudies(this.props.studies);
      }
    }, {
      key: "render",
      value: function render() {
        return null;
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        // Destroy stack loading listeners when we close the viewer
        this.studyLoadingListener.clear();
      }
    }]);

    return StudyLoadingMonitor;
  }(React.Component);

  defineProperty(StudyLoadingMonitor, "propTypes", {
    studies: propTypes.array.isRequired,
    setStudyLoadingProgress: propTypes.func.isRequired,
    clearStudyLoadingProgress: propTypes.func.isRequired
  });

  var _OHIF$redux$actions = OHIF$1.redux.actions,
      _setStudyLoadingProgress = _OHIF$redux$actions.setStudyLoadingProgress,
      _clearStudyLoadingProgress = _OHIF$redux$actions.clearStudyLoadingProgress;

  var mapDispatchToProps$4 = function mapDispatchToProps(dispatch) {
    return {
      setStudyLoadingProgress: function setStudyLoadingProgress(progressId, progressData) {
        dispatch(_setStudyLoadingProgress(progressId, progressData));
      },
      clearStudyLoadingProgress: function clearStudyLoadingProgress(progressId) {
        dispatch(_clearStudyLoadingProgress(progressId));
      }
    };
  };

  var ConnectedStudyLoadingMonitor = connect(null, mapDispatchToProps$4)(StudyLoadingMonitor);

  var StudyPrefetcher$1 = OHIF$1.classes.StudyPrefetcher;

  var StudyPrefetcherComponent =
  /*#__PURE__*/
  function (_Component) {
    inherits(StudyPrefetcherComponent, _Component);

    function StudyPrefetcherComponent() {
      classCallCheck(this, StudyPrefetcherComponent);

      return possibleConstructorReturn(this, getPrototypeOf(StudyPrefetcherComponent).apply(this, arguments));
    }

    createClass(StudyPrefetcherComponent, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var studies$$1 = this.props.studies;
        this.studyPrefetcher = StudyPrefetcher$1.getInstance();
        this.studyPrefetcher.setStudies(studies$$1);
      }
    }, {
      key: "render",
      value: function render() {
        return null;
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        // Stop prefetching when we close the viewer
        this.studyPrefetcher.destroy();
      }
    }]);

    return StudyPrefetcherComponent;
  }(React.Component);

  defineProperty(StudyPrefetcherComponent, "propTypes", {
    studies: propTypes.array
  });

  var css$u = "#viewer {\n  background-color: black;\n  width: 100%;\n}\n\n.loadingTextDiv {\n  color: var(--text-secondary-color);\n  font-size: 30px;\n}\n\n";
  styleInject$1(css$u);

  var StackManager$1 = OHIF$1.utils.StackManager;
  /**
   * Inits OHIF Hanging Protocol's onReady.
   * It waits for OHIF Hanging Protocol to be ready to instantiate the ProtocolEngine
   * Hanging Protocol will use OHIF LayoutManager to render viewports properly
   */

  /*const initHangingProtocol = () => {
      // When Hanging Protocol is ready
      HP.ProtocolStore.onReady(() => {

          // Gets all StudyMetadata objects: necessary for Hanging Protocol to access study metadata
          const studyMetadataList = OHIF.viewer.StudyMetadataList.all();

          // Instantiate StudyMetadataSource: necessary for Hanging Protocol to get study metadata
          const studyMetadataSource = new OHIF.studies.classes.OHIFStudyMetadataSource();

          // Get prior studies map
          const studyPriorsMap = OHIF.studylist.functions.getStudyPriorsMap(studyMetadataList);

          // Creates Protocol Engine object with required arguments
          const ProtocolEngine = new HP.ProtocolEngine(layoutManager, studyMetadataList, studyPriorsMap, studyMetadataSource);

          // Sets up Hanging Protocol engine
          HP.setEngine(ProtocolEngine);
      });
  };*/

  OHIF$1.viewer.defaultTool = {
    left: 'wwwc',
    right: 'zoom',
    middle: 'pan'
  };
  OHIF$1.viewer.refLinesEnabled = true;
  /*const viewportUtils = OHIF.viewerbase.viewportUtils;

  OHIF.viewer.functionList = {
      toggleCineDialog: viewportUtils.toggleCineDialog,
      toggleCinePlay: viewportUtils.toggleCinePlay,
      clearTools: viewportUtils.clearTools,
      resetViewport: viewportUtils.resetViewport,
      invert: viewportUtils.invert
  };*/
  // Create the synchronizer used to update reference lines

  OHIF$1.viewer.updateImageSynchronizer = new cornerstoneTools$1.Synchronizer('cornerstonenewimage', cornerstoneTools$1.updateImageSynchronizer); // Metadata configuration

  var metadataProvider = new OHIF$1.cornerstone.MetadataProvider();
  cornerstone$3.metaData.addProvider(metadataProvider.provider.bind(metadataProvider));
  StackManager$1.setMetadataProvider(metadataProvider);

  var Viewer =
  /*#__PURE__*/
  function (_Component) {
    inherits(Viewer, _Component);

    function Viewer() {
      classCallCheck(this, Viewer);

      return possibleConstructorReturn(this, getPrototypeOf(Viewer).apply(this, arguments));
    }

    createClass(Viewer, [{
      key: "render",
      value: function render() {
        return React__default.createElement(React__default.Fragment, null, React__default.createElement(Header$2, {
          home: false
        }), React__default.createElement("div", {
          className: "viewerDialogs"
        }), React__default.createElement("div", {
          id: "viewer",
          className: "Viewer"
        }, React__default.createElement(ConnectedToolbarRow, null), React__default.createElement(ConnectedStudyLoadingMonitor, {
          studies: this.props.studies
        }), React__default.createElement(StudyPrefetcherComponent, {
          studies: this.props.studies
        }), React__default.createElement(ConnectedFlexboxLayout, {
          studies: this.props.studies
        })));
      }
    }]);

    return Viewer;
  }(React.Component);

  defineProperty(Viewer, "propTypes", {
    studies: propTypes.array
  });

  var createDisplaySets$1 = OHIF$1.utils.createDisplaySets;

  var ViewerRetrieveStudyData =
  /*#__PURE__*/
  function (_Component) {
    inherits(ViewerRetrieveStudyData, _Component);

    function ViewerRetrieveStudyData() {
      var _getPrototypeOf2;

      var _this;

      classCallCheck(this, ViewerRetrieveStudyData);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = possibleConstructorReturn(this, (_getPrototypeOf2 = getPrototypeOf(ViewerRetrieveStudyData)).call.apply(_getPrototypeOf2, [this].concat(args)));

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "state", {
        studies: null,
        error: null
      });

      return _this;
    }

    createClass(ViewerRetrieveStudyData, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        // TODO: Avoid using timepoints here
        //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };
        var _this$props = this.props,
            studyInstanceUids = _this$props.studyInstanceUids,
            seriesInstanceUids = _this$props.seriesInstanceUids,
            server = _this$props.server;
        var promise = OHIF$1.studies.retrieveStudiesMetadata(server, studyInstanceUids, seriesInstanceUids); // Render the viewer when the data is ready

        promise.then(function (studies$$1) {
          var updatedStudies = createDisplaySets$1(studies$$1);

          _this2.setState({
            studies: updatedStudies
          });
        }).catch(function (error) {
          _this2.setState({
            error: true
          });

          throw new Error(error);
        });
      }
    }, {
      key: "render",
      value: function render() {
        if (this.state.error) {
          return React__default.createElement("div", null, "Error: ", JSON.stringify(this.state.error));
        } else if (!this.state.studies) {
          return React__default.createElement("div", null, "Loading...");
        }

        return React__default.createElement(Viewer, {
          studies: this.state.studies
        });
      }
    }]);

    return ViewerRetrieveStudyData;
  }(React.Component);

  defineProperty(ViewerRetrieveStudyData, "propTypes", {
    studyInstanceUids: propTypes.array.isRequired,
    seriesInstanceUids: propTypes.array,
    server: propTypes.object
  });

  var isActive = function isActive(a) {
    return a.active === true;
  };

  var mapStateToProps$7 = function mapStateToProps(state) {
    var activeServer = state.servers.servers.find(isActive);
    return {
      server: activeServer
    };
  };

  var ConnectedViewerRetrieveStudyData = connect(mapStateToProps$7, null)(ViewerRetrieveStudyData);

  function ViewerRouting(_ref) {
    var match = _ref.match;
    var _match$params = match.params,
        studyInstanceUids = _match$params.studyInstanceUids,
        seriesInstanceUids = _match$params.seriesInstanceUids;
    var studyUIDs;
    var seriesUIDs;

    if (studyInstanceUids && !seriesInstanceUids) {
      studyUIDs = studyInstanceUids.split(';');
    } else if (studyInstanceUids && seriesInstanceUids) {
      studyUIDs = [match.params.studyInstanceUid];
      seriesUIDs = match.params.seriesInstanceUids.split(';');
    }

    return React__default.createElement(ConnectedViewerRetrieveStudyData, {
      studyInstanceUids: studyUIDs,
      seriesInstanceUids: seriesUIDs
    });
  }

  ViewerRouting.propTypes = {
    match: propTypes.shape({
      params: propTypes.shape({
        studyInstanceUids: propTypes.string.isRequired,
        seriesInstanceUids: propTypes.string
      })
    })
  };

  var strictUriEncode = function (str) {
  	return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {
  		return '%' + c.charCodeAt(0).toString(16).toUpperCase();
  	});
  };

  function encoderForArrayFormat(opts) {
  	switch (opts.arrayFormat) {
  		case 'index':
  			return function (key, value, index) {
  				return value === null ? [
  					encode(key, opts),
  					'[',
  					index,
  					']'
  				].join('') : [
  					encode(key, opts),
  					'[',
  					encode(index, opts),
  					']=',
  					encode(value, opts)
  				].join('');
  			};

  		case 'bracket':
  			return function (key, value) {
  				return value === null ? encode(key, opts) : [
  					encode(key, opts),
  					'[]=',
  					encode(value, opts)
  				].join('');
  			};

  		default:
  			return function (key, value) {
  				return value === null ? encode(key, opts) : [
  					encode(key, opts),
  					'=',
  					encode(value, opts)
  				].join('');
  			};
  	}
  }

  function parserForArrayFormat(opts) {
  	var result;

  	switch (opts.arrayFormat) {
  		case 'index':
  			return function (key, value, accumulator) {
  				result = /\[(\d*)\]$/.exec(key);

  				key = key.replace(/\[\d*\]$/, '');

  				if (!result) {
  					accumulator[key] = value;
  					return;
  				}

  				if (accumulator[key] === undefined) {
  					accumulator[key] = {};
  				}

  				accumulator[key][result[1]] = value;
  			};

  		case 'bracket':
  			return function (key, value, accumulator) {
  				result = /(\[\])$/.exec(key);
  				key = key.replace(/\[\]$/, '');

  				if (!result) {
  					accumulator[key] = value;
  					return;
  				} else if (accumulator[key] === undefined) {
  					accumulator[key] = [value];
  					return;
  				}

  				accumulator[key] = [].concat(accumulator[key], value);
  			};

  		default:
  			return function (key, value, accumulator) {
  				if (accumulator[key] === undefined) {
  					accumulator[key] = value;
  					return;
  				}

  				accumulator[key] = [].concat(accumulator[key], value);
  			};
  	}
  }

  function encode(value, opts) {
  	if (opts.encode) {
  		return opts.strict ? strictUriEncode(value) : encodeURIComponent(value);
  	}

  	return value;
  }

  function keysSorter(input) {
  	if (Array.isArray(input)) {
  		return input.sort();
  	} else if (typeof input === 'object') {
  		return keysSorter(Object.keys(input)).sort(function (a, b) {
  			return Number(a) - Number(b);
  		}).map(function (key) {
  			return input[key];
  		});
  	}

  	return input;
  }

  var extract = function (str) {
  	return str.split('?')[1] || '';
  };

  var parse$1 = function (str, opts) {
  	opts = objectAssign({arrayFormat: 'none'}, opts);

  	var formatter = parserForArrayFormat(opts);

  	// Create an object with no prototype
  	// https://github.com/sindresorhus/query-string/issues/47
  	var ret = Object.create(null);

  	if (typeof str !== 'string') {
  		return ret;
  	}

  	str = str.trim().replace(/^(\?|#|&)/, '');

  	if (!str) {
  		return ret;
  	}

  	str.split('&').forEach(function (param) {
  		var parts = param.replace(/\+/g, ' ').split('=');
  		// Firefox (pre 40) decodes `%3D` to `=`
  		// https://github.com/sindresorhus/query-string/pull/37
  		var key = parts.shift();
  		var val = parts.length > 0 ? parts.join('=') : undefined;

  		// missing `=` should be `null`:
  		// http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters
  		val = val === undefined ? null : decodeURIComponent(val);

  		formatter(decodeURIComponent(key), val, ret);
  	});

  	return Object.keys(ret).sort().reduce(function (result, key) {
  		var val = ret[key];
  		if (Boolean(val) && typeof val === 'object' && !Array.isArray(val)) {
  			// Sort object keys, not values
  			result[key] = keysSorter(val);
  		} else {
  			result[key] = val;
  		}

  		return result;
  	}, Object.create(null));
  };

  var stringify = function (obj, opts) {
  	var defaults = {
  		encode: true,
  		strict: true,
  		arrayFormat: 'none'
  	};

  	opts = objectAssign(defaults, opts);

  	var formatter = encoderForArrayFormat(opts);

  	return obj ? Object.keys(obj).sort().map(function (key) {
  		var val = obj[key];

  		if (val === undefined) {
  			return '';
  		}

  		if (val === null) {
  			return encode(key, opts);
  		}

  		if (Array.isArray(val)) {
  			var result = [];

  			val.slice().forEach(function (val2) {
  				if (val2 === undefined) {
  					return;
  				}

  				result.push(formatter(key, val2, result.length));
  			});

  			return result.join('&');
  		}

  		return encode(key, opts) + '=' + encode(val, opts);
  	}).filter(function (x) {
  		return x.length > 0;
  	}).join('&') : '';
  };

  var queryString = {
  	extract: extract,
  	parse: parse$1,
  	stringify: stringify
  };

  var createDisplaySets$2 = OHIF$1.utils.createDisplaySets;

  function parseQueryAndFetchStudies(query) {
    return new Promise(function (resolve, reject) {
      var url = query.url;

      if (!url) {
        reject(new Error('No URL was specified. Use ?url=$yourURL'));
      } // Define a request to the server to retrieve the study data
      // as JSON, given a URL that was in the Route


      var oReq = new XMLHttpRequest(); // Add event listeners for request failure

      oReq.addEventListener('error', function (error) {
        OHIF$1.log.warn('An error occurred while retrieving the JSON data');
        reject(error);
      }); // When the JSON has been returned, parse it into a JavaScript Object
      // and render the OHIF Viewer with this data

      oReq.addEventListener('load', function () {
        // Parse the response content
        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText
        if (!oReq.responseText) {
          OHIF$1.log.warn('Response was undefined');
          reject(new Error('Response was undefined'));
        }

        OHIF$1.log.info(JSON.stringify(oReq.responseText, null, 2));
        var data = JSON.parse(oReq.responseText);

        if (data.servers && query.studyInstanceUids) {
          var server = data.servers.dicomWeb[0];
          server.type = 'dicomWeb';
          var studyInstanceUids = query.studyInstanceUids.split(';');
          var seriesInstanceUids = [];
          OHIF$1.studies.retrieveStudiesMetadata(server, studyInstanceUids, seriesInstanceUids).then(function (studies$$1) {
            resolve(studies$$1);
          }, function (error) {
            reject(error);
          });
        } else {
          resolve(data.studies);
        }
      }); // Open the Request to the server for the JSON data
      // In this case we have a server-side route called /api/
      // which responds to GET requests with the study data

      OHIF$1.log.info("Sending Request to: ".concat(url));
      oReq.open('GET', url);
      oReq.setRequestHeader('Accept', 'application/json'); // Fire the request to the server

      oReq.send();
    });
  }

  var StandaloneRouting =
  /*#__PURE__*/
  function (_Component) {
    inherits(StandaloneRouting, _Component);

    function StandaloneRouting() {
      var _getPrototypeOf2;

      var _this;

      classCallCheck(this, StandaloneRouting);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = possibleConstructorReturn(this, (_getPrototypeOf2 = getPrototypeOf(StandaloneRouting)).call.apply(_getPrototypeOf2, [this].concat(args)));

      defineProperty(assertThisInitialized(assertThisInitialized(_this)), "state", {
        studies: null,
        error: null
      });

      return _this;
    }

    createClass(StandaloneRouting, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        var query = queryString.parse(this.props.location.search);
        parseQueryAndFetchStudies(query).then(function (studies$$1) {
          var updatedStudies = createDisplaySets$2(studies$$1);

          _this2.setState({
            studies: updatedStudies
          });
        }, function (error) {
          _this2.setState({
            error: error
          });
        });
      }
    }, {
      key: "render",
      value: function render() {
        if (this.state.error) {
          return React__default.createElement("div", null, "Error: ", JSON.stringify(this.state.error));
        } else if (!this.state.studies) {
          return React__default.createElement("div", null, "Loading...");
        }

        return React__default.createElement(Viewer, {
          studies: this.state.studies
        });
      }
    }]);

    return StandaloneRouting;
  }(React.Component);

  defineProperty(StandaloneRouting, "propTypes", {
    location: propTypes.object,
    store: propTypes.object
  });

  function IHEInvokeImageDisplay(_ref) {
    var match = _ref.match;
    var requestType = match.params.query.requestType;
    var studyInstanceUids; //let patientUids;

    var displayStudyList = false;

    if (requestType === "STUDY") {
      studyInstanceUids = match.params.query.studyUID.split(';');
    } else if (requestType === "STUDYBASE64") {
      var uids = this.params.query.studyUID;
      var decodedData = window.atob(uids);
      studyInstanceUids = decodedData.split(';');
    } else if (requestType === "PATIENT") {
      //patientUidspatientUids = this.params.query.patientID.split(';');
      displayStudyList = true;
    } else {
      displayStudyList = true;
    }

    if (displayStudyList) {
      return ''; //<StudyList patientUids={patientUids}/>);
    }

    return React__default.createElement(ViewerRetrieveStudyData, {
      studyInstanceUids: studyInstanceUids
    });
  }

  IHEInvokeImageDisplay.propTypes = {
    match: propTypes.shape({
      params: propTypes.shape({
        query: propTypes.shape({
          requestType: propTypes.string.isRequired,
          studyUID: propTypes.string,
          patientID: propTypes.string
        })
      })
    })
  };

  var css$v = "html,\nbody,\n#root {\n    background-color: black;\n    height: 100%;\n    width: 100%;\n    margin: 0;\n}\n\nbody {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    font-family: Roboto,OpenSans,HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;\n}\n";
  styleInject$1(css$v);

  var css$w = "/* Sizes */\n:root {\n    --top-bar-height: 40px;\n    --top-bar-expanded-height: 160px;\n    --toolbar-height: 78px;\n    --toolbar-drawer-height: 62px;\n    --left-sidebar-menu-width: 307px;\n    --right-sidebar-menu-width: 323px;\n    --study-list-padding: 8%;\n    --study-list-padding-medium-screen: 10px;\n}\n\n/* Fonts */\n:root {\n    --logo-font-family: \"Sanchez\";\n    --logo-font-weight: 300;\n}\n\n/* Transitions */\n:root {\n    --transition-duration: 0.3s;\n    --transition-effect: ease;\n    --sidebar-transition: all 0.3s ease;\n}\n\n/* Thicknesses */\n:root {\n    --viewport-border-thickness: 1px;\n    --ui-border-thickness: 1px;\n}\n";
  styleInject$1(css$w);

  var css$x = "/* \"Tide\" theme */\n/* TODO:\n- Convert the other themes to CSS Variables\n- Allow user to set default CSS theme in JS config\n- Export the themes as identical JS objects\n- For theme switcher, update root-level CSS properties via JS (https://medium.com/@_bengarrison/accessing-and-modifying-css-variables-with-javascript-2ccb735bbff0)\n */\n\n:root {\n    /* Interface UI Colors */\n    --default-color: #9CCEF9;\n    --hover-color: #ffffff;\n    --active-color: #20A5D6;\n    --ui-border-color: #44626F;\n    --ui-border-color-dark: #3C5D80;\n    --ui-border-color-active: #00a4d9;\n    --primary-background-color: #000000;\n    --box-background-color: #3E5975;\n\n    /* Common palette */\n    --ui-yellow: #E29E4A;\n    --ui-sky-blue: #6FBDE2;\n    /* State palette */\n    --ui-state-error: #FFCCCC;\n    --ui-state-error-border: #993333;\n    --ui-state-error-text: #661111;\n    --ui-gray-light: #516873;\n    --ui-gray: #263340;\n    --ui-gray-dark: #16202B;\n    --ui-gray-darker: #151A1F;\n    --ui-gray-darkest: #14202A;\n\n    /* Text Colors */\n    --text-color-active: #000000;\n    --text-primary-color: #ffffff;\n    --text-secondary-color: #91b9cd;\n    --large-numbers-color: #6fbde2;\n    --text-disabled-color: #878787;\n\n    --input-background-color: #2c363f;\n    --input-placeholder-color: #d3d3d3;\n\n    --table-hover-color: #2c363f;\n    --table-text-primary-color: #ffffff;\n    --table-text-secondary-color: #91b9cd;\n\n    --large-numbers-color:#6FBDE2;\n\n    --state-error: #FFCCCC;\n    --state-error-border: #FFCCCC;\n    --state-error-text: #FFCCCC;\n}\n";
  styleInject$1(css$x);

  var reload = function reload() {
    return window.location.reload();
  };
  /*function LoadingUser() {
      return (<div>Loading user...</div>);
  }*/


  var App =
  /*#__PURE__*/
  function (_Component) {
    inherits(App, _Component);

    function App() {
      classCallCheck(this, App);

      return possibleConstructorReturn(this, getPrototypeOf(App).apply(this, arguments));
    }

    createClass(App, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this = this;

        this.unlisten = this.props.history.listen(function (location, action) {
          if (_this.props.setContext) {
            _this.props.setContext(window.location.pathname);
          }
        });
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        this.unlisten();
      }
    }, {
      key: "render",
      value: function render() {
        var user = this.props.user;
        /*if (!user || user.expired) {
            // TODO: redirect to OAuth page if necessary
            return <Switch>
                <Route path="/callback" component={CallbackPage} />
                <Route exact path='/login' component={() => {
                    userManager.signinRedirect();
                }}/>
                <Route component={LoadingUser}/>
            </Switch>;
        }*/

        return React__default.createElement(Switch, null, React__default.createElement(Route, {
          exact: true,
          path: "/",
          component: StandaloneRouting
        }), React__default.createElement(Route, {
          exact: true,
          path: "/viewer",
          component: StandaloneRouting
        }), React__default.createElement(Route, {
          path: "/viewer/:studyInstanceUids",
          component: ViewerRouting
        }), React__default.createElement(Route, {
          path: "/study/:studyInstanceUid/series/:seriesInstanceUids",
          component: ViewerRouting
        }), React__default.createElement(Route, {
          path: "/IHEInvokeImageDisplay",
          component: IHEInvokeImageDisplay
        }), React__default.createElement(Route, {
          path: "/silent-refresh.html",
          onEnter: reload
        }), React__default.createElement(Route, {
          path: "/logout-redirect.html",
          onEnter: reload
        }), React__default.createElement(Route, {
          render: function render() {
            return React__default.createElement("div", null, " Sorry, this page does not exist. ");
          }
        }));
      }
    }]);

    return App;
  }(React.Component);

  defineProperty(App, "propTypes", {
    history: propTypes.object.isRequired,
    user: propTypes.object
  });

  var mapStateToProps$8 = function mapStateToProps(state) {
    return {};
    /*return {
        user: state.oidc.user,
    };*/
  };

  var ConnectedApp = connect(mapStateToProps$8, null)(App);
  var OHIFStandaloneViewer = ViewerbaseDragDropContext(withRouter(ConnectedApp));

  /*function metaDataProvider(type, imageId) {
    const metaData = cornerstoneWADOImageLoader.wadors.metaDataManager.get(
      imageId
    );

    if (!metaData) {
      return;
    }

    if (
      metaData[type] !== undefined &&
      metaData[type].Value !== undefined &&
      metaData[type].Value.length
    ) {
      return metaData[type].Value[0];
    }

    if (type === 'instance') {
      return metaData;
    }
  }

  cornerstone.metaData.addProvider(metaDataProvider);*/

  function _classCallCheck$d(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  function _defineProperties$3(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass$3(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties$3(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties$3(Constructor, staticProps);
    return Constructor;
  }

  function _defineProperty$4(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  function _inherits$d(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function");
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        writable: true,
        configurable: true
      }
    });
    if (superClass) _setPrototypeOf$2(subClass, superClass);
  }

  function _getPrototypeOf$2(o) {
    _getPrototypeOf$2 = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {
      return o.__proto__ || Object.getPrototypeOf(o);
    };
    return _getPrototypeOf$2(o);
  }

  function _setPrototypeOf$2(o, p) {
    _setPrototypeOf$2 = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
      o.__proto__ = p;
      return o;
    };

    return _setPrototypeOf$2(o, p);
  }

  function _assertThisInitialized$4(self) {
    if (self === void 0) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return self;
  }

  function _possibleConstructorReturn$d(self, call) {
    if (call && (typeof call === "object" || typeof call === "function")) {
      return call;
    }

    return _assertThisInitialized$4(self);
  }

  var commonjsGlobal$3 = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

  function commonjsRequire$1() {
    throw new Error('Dynamic requires are not currently supported by rollup-plugin-commonjs');
  }

  function createCommonjsModule$3(fn, module) {
    return module = {
      exports: {}
    }, fn(module, module.exports), module.exports;
  }
  /*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */

  /* eslint-disable no-unused-vars */


  var getOwnPropertySymbols$4 = Object.getOwnPropertySymbols;
  var hasOwnProperty$a = Object.prototype.hasOwnProperty;
  var propIsEnumerable$2 = Object.prototype.propertyIsEnumerable;

  function toObject$2(val) {
    if (val === null || val === undefined) {
      throw new TypeError('Object.assign cannot be called with null or undefined');
    }

    return Object(val);
  }

  function shouldUseNative$2() {
    try {
      if (!Object.assign) {
        return false;
      } // Detect buggy property enumeration order in older V8 versions.
      // https://bugs.chromium.org/p/v8/issues/detail?id=4118


      var test1 = new String('abc'); // eslint-disable-line no-new-wrappers

      test1[5] = 'de';

      if (Object.getOwnPropertyNames(test1)[0] === '5') {
        return false;
      } // https://bugs.chromium.org/p/v8/issues/detail?id=3056


      var test2 = {};

      for (var i = 0; i < 10; i++) {
        test2['_' + String.fromCharCode(i)] = i;
      }

      var order2 = Object.getOwnPropertyNames(test2).map(function (n) {
        return test2[n];
      });

      if (order2.join('') !== '0123456789') {
        return false;
      } // https://bugs.chromium.org/p/v8/issues/detail?id=3056


      var test3 = {};
      'abcdefghijklmnopqrst'.split('').forEach(function (letter) {
        test3[letter] = letter;
      });

      if (Object.keys(Object.assign({}, test3)).join('') !== 'abcdefghijklmnopqrst') {
        return false;
      }

      return true;
    } catch (err) {
      // We don't expect any of the above to throw, but better to be safe.
      return false;
    }
  }

  var objectAssign$2 = shouldUseNative$2() ? Object.assign : function (target, source) {
    var from;
    var to = toObject$2(target);
    var symbols;

    for (var s = 1; s < arguments.length; s++) {
      from = Object(arguments[s]);

      for (var key in from) {
        if (hasOwnProperty$a.call(from, key)) {
          to[key] = from[key];
        }
      }

      if (getOwnPropertySymbols$4) {
        symbols = getOwnPropertySymbols$4(from);

        for (var i = 0; i < symbols.length; i++) {
          if (propIsEnumerable$2.call(from, symbols[i])) {
            to[symbols[i]] = from[symbols[i]];
          }
        }
      }
    }

    return to;
  };
  /**
   * Copyright (c) 2013-present, Facebook, Inc.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */

  var ReactPropTypesSecret$3 = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';
  var ReactPropTypesSecret_1$2 = ReactPropTypesSecret$3;

  var printWarning$5 = function () {};

  if (process.env.NODE_ENV !== 'production') {
    var ReactPropTypesSecret$1$2 = ReactPropTypesSecret_1$2;
    var loggedTypeFailures$2 = {};

    printWarning$5 = function (text) {
      var message = 'Warning: ' + text;

      if (typeof console !== 'undefined') {
        console.error(message);
      }

      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };
  }
  /**
   * Assert that the values match with the type specs.
   * Error messages are memorized and will only be shown once.
   *
   * @param {object} typeSpecs Map of name to a ReactPropType
   * @param {object} values Runtime values that need to be type-checked
   * @param {string} location e.g. "prop", "context", "child context"
   * @param {string} componentName Name of the component for error messages.
   * @param {?Function} getStack Returns the component stack.
   * @private
   */


  function checkPropTypes$2(typeSpecs, values, location, componentName, getStack) {
    if (process.env.NODE_ENV !== 'production') {
      for (var typeSpecName in typeSpecs) {
        if (typeSpecs.hasOwnProperty(typeSpecName)) {
          var error; // Prop type validation may throw. In case they do, we don't want to
          // fail the render phase where it didn't fail before. So we log it.
          // After these have been cleaned up, we'll let them throw.

          try {
            // This is intentionally an invariant that gets caught. It's the same
            // behavior as without this statement except with a better message.
            if (typeof typeSpecs[typeSpecName] !== 'function') {
              var err = Error((componentName || 'React class') + ': ' + location + ' type `' + typeSpecName + '` is invalid; ' + 'it must be a function, usually from the `prop-types` package, but received `' + typeof typeSpecs[typeSpecName] + '`.');
              err.name = 'Invariant Violation';
              throw err;
            }

            error = typeSpecs[typeSpecName](values, typeSpecName, componentName, location, null, ReactPropTypesSecret$1$2);
          } catch (ex) {
            error = ex;
          }

          if (error && !(error instanceof Error)) {
            printWarning$5((componentName || 'React class') + ': type specification of ' + location + ' `' + typeSpecName + '` is invalid; the type checker ' + 'function must return `null` or an `Error` but returned a ' + typeof error + '. ' + 'You may have forgotten to pass an argument to the type checker ' + 'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and ' + 'shape all require an argument).');
          }

          if (error instanceof Error && !(error.message in loggedTypeFailures$2)) {
            // Only monitor this failure once because there tends to be a lot of the
            // same error.
            loggedTypeFailures$2[error.message] = true;
            var stack = getStack ? getStack() : '';
            printWarning$5('Failed ' + location + ' type: ' + error.message + (stack != null ? stack : ''));
          }
        }
      }
    }
  }

  var checkPropTypes_1$2 = checkPropTypes$2;

  var printWarning$1$2 = function () {};

  if (process.env.NODE_ENV !== 'production') {
    printWarning$1$2 = function (text) {
      var message = 'Warning: ' + text;

      if (typeof console !== 'undefined') {
        console.error(message);
      }

      try {
        // --- Welcome to debugging React ---
        // This error was thrown as a convenience so that you can use this stack
        // to find the callsite that caused this warning to fire.
        throw new Error(message);
      } catch (x) {}
    };
  }

  function emptyFunctionThatReturnsNull$2() {
    return null;
  }

  var factoryWithTypeCheckers$2 = function (isValidElement, throwOnDirectAccess) {
    /* global Symbol */
    var ITERATOR_SYMBOL = typeof Symbol === 'function' && Symbol.iterator;
    var FAUX_ITERATOR_SYMBOL = '@@iterator'; // Before Symbol spec.

    /**
     * Returns the iterator method function contained on the iterable object.
     *
     * Be sure to invoke the function with the iterable as context:
     *
     *     var iteratorFn = getIteratorFn(myIterable);
     *     if (iteratorFn) {
     *       var iterator = iteratorFn.call(myIterable);
     *       ...
     *     }
     *
     * @param {?object} maybeIterable
     * @return {?function}
     */

    function getIteratorFn(maybeIterable) {
      var iteratorFn = maybeIterable && (ITERATOR_SYMBOL && maybeIterable[ITERATOR_SYMBOL] || maybeIterable[FAUX_ITERATOR_SYMBOL]);

      if (typeof iteratorFn === 'function') {
        return iteratorFn;
      }
    }
    /**
     * Collection of methods that allow declaration and validation of props that are
     * supplied to React components. Example usage:
     *
     *   var Props = require('ReactPropTypes');
     *   var MyArticle = React.createClass({
     *     propTypes: {
     *       // An optional string prop named "description".
     *       description: Props.string,
     *
     *       // A required enum prop named "category".
     *       category: Props.oneOf(['News','Photos']).isRequired,
     *
     *       // A prop named "dialog" that requires an instance of Dialog.
     *       dialog: Props.instanceOf(Dialog).isRequired
     *     },
     *     render: function() { ... }
     *   });
     *
     * A more formal specification of how these methods are used:
     *
     *   type := array|bool|func|object|number|string|oneOf([...])|instanceOf(...)
     *   decl := ReactPropTypes.{type}(.isRequired)?
     *
     * Each and every declaration produces a function with the same signature. This
     * allows the creation of custom validation functions. For example:
     *
     *  var MyLink = React.createClass({
     *    propTypes: {
     *      // An optional string or URI prop named "href".
     *      href: function(props, propName, componentName) {
     *        var propValue = props[propName];
     *        if (propValue != null && typeof propValue !== 'string' &&
     *            !(propValue instanceof URI)) {
     *          return new Error(
     *            'Expected a string or an URI for ' + propName + ' in ' +
     *            componentName
     *          );
     *        }
     *      }
     *    },
     *    render: function() {...}
     *  });
     *
     * @internal
     */


    var ANONYMOUS = '<<anonymous>>'; // Important!
    // Keep this list in sync with production version in `./factoryWithThrowingShims.js`.

    var ReactPropTypes = {
      array: createPrimitiveTypeChecker('array'),
      bool: createPrimitiveTypeChecker('boolean'),
      func: createPrimitiveTypeChecker('function'),
      number: createPrimitiveTypeChecker('number'),
      object: createPrimitiveTypeChecker('object'),
      string: createPrimitiveTypeChecker('string'),
      symbol: createPrimitiveTypeChecker('symbol'),
      any: createAnyTypeChecker(),
      arrayOf: createArrayOfTypeChecker,
      element: createElementTypeChecker(),
      instanceOf: createInstanceTypeChecker,
      node: createNodeChecker(),
      objectOf: createObjectOfTypeChecker,
      oneOf: createEnumTypeChecker,
      oneOfType: createUnionTypeChecker,
      shape: createShapeTypeChecker,
      exact: createStrictShapeTypeChecker
    };
    /**
     * inlined Object.is polyfill to avoid requiring consumers ship their own
     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is
     */

    /*eslint-disable no-self-compare*/

    function is(x, y) {
      // SameValue algorithm
      if (x === y) {
        // Steps 1-5, 7-10
        // Steps 6.b-6.e: +0 != -0
        return x !== 0 || 1 / x === 1 / y;
      } else {
        // Step 6.a: NaN == NaN
        return x !== x && y !== y;
      }
    }
    /*eslint-enable no-self-compare*/

    /**
     * We use an Error-like object for backward compatibility as people may call
     * PropTypes directly and inspect their output. However, we don't use real
     * Errors anymore. We don't inspect their stack anyway, and creating them
     * is prohibitively expensive if they are created too often, such as what
     * happens in oneOfType() for any type before the one that matched.
     */


    function PropTypeError(message) {
      this.message = message;
      this.stack = '';
    } // Make `instanceof Error` still work for returned errors.


    PropTypeError.prototype = Error.prototype;

    function createChainableTypeChecker(validate) {
      if (process.env.NODE_ENV !== 'production') {
        var manualPropTypeCallCache = {};
        var manualPropTypeWarningCount = 0;
      }

      function checkType(isRequired, props, propName, componentName, location, propFullName, secret) {
        componentName = componentName || ANONYMOUS;
        propFullName = propFullName || propName;

        if (secret !== ReactPropTypesSecret_1$2) {
          if (throwOnDirectAccess) {
            // New behavior only for users of `prop-types` package
            var err = new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. ' + 'Use `PropTypes.checkPropTypes()` to call them. ' + 'Read more at http://fb.me/use-check-prop-types');
            err.name = 'Invariant Violation';
            throw err;
          } else if (process.env.NODE_ENV !== 'production' && typeof console !== 'undefined') {
            // Old behavior for people using React.PropTypes
            var cacheKey = componentName + ':' + propName;

            if (!manualPropTypeCallCache[cacheKey] && // Avoid spamming the console because they are often not actionable except for lib authors
            manualPropTypeWarningCount < 3) {
              printWarning$1$2('You are manually calling a React.PropTypes validation ' + 'function for the `' + propFullName + '` prop on `' + componentName + '`. This is deprecated ' + 'and will throw in the standalone `prop-types` package. ' + 'You may be seeing this warning due to a third-party PropTypes ' + 'library. See https://fb.me/react-warning-dont-call-proptypes ' + 'for details.');
              manualPropTypeCallCache[cacheKey] = true;
              manualPropTypeWarningCount++;
            }
          }
        }

        if (props[propName] == null) {
          if (isRequired) {
            if (props[propName] === null) {
              return new PropTypeError('The ' + location + ' `' + propFullName + '` is marked as required ' + ('in `' + componentName + '`, but its value is `null`.'));
            }

            return new PropTypeError('The ' + location + ' `' + propFullName + '` is marked as required in ' + ('`' + componentName + '`, but its value is `undefined`.'));
          }

          return null;
        } else {
          return validate(props, propName, componentName, location, propFullName);
        }
      }

      var chainedCheckType = checkType.bind(null, false);
      chainedCheckType.isRequired = checkType.bind(null, true);
      return chainedCheckType;
    }

    function createPrimitiveTypeChecker(expectedType) {
      function validate(props, propName, componentName, location, propFullName, secret) {
        var propValue = props[propName];
        var propType = getPropType(propValue);

        if (propType !== expectedType) {
          // `propValue` being instance of, say, date/regexp, pass the 'object'
          // check, but we can offer a more precise error message here rather than
          // 'of type `object`'.
          var preciseType = getPreciseType(propValue);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + preciseType + '` supplied to `' + componentName + '`, expected ') + ('`' + expectedType + '`.'));
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createAnyTypeChecker() {
      return createChainableTypeChecker(emptyFunctionThatReturnsNull$2);
    }

    function createArrayOfTypeChecker(typeChecker) {
      function validate(props, propName, componentName, location, propFullName) {
        if (typeof typeChecker !== 'function') {
          return new PropTypeError('Property `' + propFullName + '` of component `' + componentName + '` has invalid PropType notation inside arrayOf.');
        }

        var propValue = props[propName];

        if (!Array.isArray(propValue)) {
          var propType = getPropType(propValue);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected an array.'));
        }

        for (var i = 0; i < propValue.length; i++) {
          var error = typeChecker(propValue, i, componentName, location, propFullName + '[' + i + ']', ReactPropTypesSecret_1$2);

          if (error instanceof Error) {
            return error;
          }
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createElementTypeChecker() {
      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];

        if (!isValidElement(propValue)) {
          var propType = getPropType(propValue);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected a single ReactElement.'));
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createInstanceTypeChecker(expectedClass) {
      function validate(props, propName, componentName, location, propFullName) {
        if (!(props[propName] instanceof expectedClass)) {
          var expectedClassName = expectedClass.name || ANONYMOUS;
          var actualClassName = getClassName(props[propName]);
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + actualClassName + '` supplied to `' + componentName + '`, expected ') + ('instance of `' + expectedClassName + '`.'));
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createEnumTypeChecker(expectedValues) {
      if (!Array.isArray(expectedValues)) {
        process.env.NODE_ENV !== 'production' ? printWarning$1$2('Invalid argument supplied to oneOf, expected an instance of array.') : void 0;
        return emptyFunctionThatReturnsNull$2;
      }

      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];

        for (var i = 0; i < expectedValues.length; i++) {
          if (is(propValue, expectedValues[i])) {
            return null;
          }
        }

        var valuesString = JSON.stringify(expectedValues);
        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of value `' + propValue + '` ' + ('supplied to `' + componentName + '`, expected one of ' + valuesString + '.'));
      }

      return createChainableTypeChecker(validate);
    }

    function createObjectOfTypeChecker(typeChecker) {
      function validate(props, propName, componentName, location, propFullName) {
        if (typeof typeChecker !== 'function') {
          return new PropTypeError('Property `' + propFullName + '` of component `' + componentName + '` has invalid PropType notation inside objectOf.');
        }

        var propValue = props[propName];
        var propType = getPropType(propValue);

        if (propType !== 'object') {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type ' + ('`' + propType + '` supplied to `' + componentName + '`, expected an object.'));
        }

        for (var key in propValue) {
          if (propValue.hasOwnProperty(key)) {
            var error = typeChecker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret_1$2);

            if (error instanceof Error) {
              return error;
            }
          }
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createUnionTypeChecker(arrayOfTypeCheckers) {
      if (!Array.isArray(arrayOfTypeCheckers)) {
        process.env.NODE_ENV !== 'production' ? printWarning$1$2('Invalid argument supplied to oneOfType, expected an instance of array.') : void 0;
        return emptyFunctionThatReturnsNull$2;
      }

      for (var i = 0; i < arrayOfTypeCheckers.length; i++) {
        var checker = arrayOfTypeCheckers[i];

        if (typeof checker !== 'function') {
          printWarning$1$2('Invalid argument supplied to oneOfType. Expected an array of check functions, but ' + 'received ' + getPostfixForTypeWarning(checker) + ' at index ' + i + '.');
          return emptyFunctionThatReturnsNull$2;
        }
      }

      function validate(props, propName, componentName, location, propFullName) {
        for (var i = 0; i < arrayOfTypeCheckers.length; i++) {
          var checker = arrayOfTypeCheckers[i];

          if (checker(props, propName, componentName, location, propFullName, ReactPropTypesSecret_1$2) == null) {
            return null;
          }
        }

        return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` supplied to ' + ('`' + componentName + '`.'));
      }

      return createChainableTypeChecker(validate);
    }

    function createNodeChecker() {
      function validate(props, propName, componentName, location, propFullName) {
        if (!isNode(props[propName])) {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` supplied to ' + ('`' + componentName + '`, expected a ReactNode.'));
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createShapeTypeChecker(shapeTypes) {
      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];
        var propType = getPropType(propValue);

        if (propType !== 'object') {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type `' + propType + '` ' + ('supplied to `' + componentName + '`, expected `object`.'));
        }

        for (var key in shapeTypes) {
          var checker = shapeTypes[key];

          if (!checker) {
            continue;
          }

          var error = checker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret_1$2);

          if (error) {
            return error;
          }
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function createStrictShapeTypeChecker(shapeTypes) {
      function validate(props, propName, componentName, location, propFullName) {
        var propValue = props[propName];
        var propType = getPropType(propValue);

        if (propType !== 'object') {
          return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` of type `' + propType + '` ' + ('supplied to `' + componentName + '`, expected `object`.'));
        } // We need to check all keys in case some are required but missing from
        // props.


        var allKeys = objectAssign$2({}, props[propName], shapeTypes);

        for (var key in allKeys) {
          var checker = shapeTypes[key];

          if (!checker) {
            return new PropTypeError('Invalid ' + location + ' `' + propFullName + '` key `' + key + '` supplied to `' + componentName + '`.' + '\nBad object: ' + JSON.stringify(props[propName], null, '  ') + '\nValid keys: ' + JSON.stringify(Object.keys(shapeTypes), null, '  '));
          }

          var error = checker(propValue, key, componentName, location, propFullName + '.' + key, ReactPropTypesSecret_1$2);

          if (error) {
            return error;
          }
        }

        return null;
      }

      return createChainableTypeChecker(validate);
    }

    function isNode(propValue) {
      switch (typeof propValue) {
        case 'number':
        case 'string':
        case 'undefined':
          return true;

        case 'boolean':
          return !propValue;

        case 'object':
          if (Array.isArray(propValue)) {
            return propValue.every(isNode);
          }

          if (propValue === null || isValidElement(propValue)) {
            return true;
          }

          var iteratorFn = getIteratorFn(propValue);

          if (iteratorFn) {
            var iterator = iteratorFn.call(propValue);
            var step;

            if (iteratorFn !== propValue.entries) {
              while (!(step = iterator.next()).done) {
                if (!isNode(step.value)) {
                  return false;
                }
              }
            } else {
              // Iterator will provide entry [k,v] tuples rather than values.
              while (!(step = iterator.next()).done) {
                var entry = step.value;

                if (entry) {
                  if (!isNode(entry[1])) {
                    return false;
                  }
                }
              }
            }
          } else {
            return false;
          }

          return true;

        default:
          return false;
      }
    }

    function isSymbol(propType, propValue) {
      // Native Symbol.
      if (propType === 'symbol') {
        return true;
      } // 19.4.3.5 Symbol.prototype[@@toStringTag] === 'Symbol'


      if (propValue['@@toStringTag'] === 'Symbol') {
        return true;
      } // Fallback for non-spec compliant Symbols which are polyfilled.


      if (typeof Symbol === 'function' && propValue instanceof Symbol) {
        return true;
      }

      return false;
    } // Equivalent of `typeof` but with special handling for array and regexp.


    function getPropType(propValue) {
      var propType = typeof propValue;

      if (Array.isArray(propValue)) {
        return 'array';
      }

      if (propValue instanceof RegExp) {
        // Old webkits (at least until Android 4.0) return 'function' rather than
        // 'object' for typeof a RegExp. We'll normalize this here so that /bla/
        // passes PropTypes.object.
        return 'object';
      }

      if (isSymbol(propType, propValue)) {
        return 'symbol';
      }

      return propType;
    } // This handles more types than `getPropType`. Only used for error messages.
    // See `createPrimitiveTypeChecker`.


    function getPreciseType(propValue) {
      if (typeof propValue === 'undefined' || propValue === null) {
        return '' + propValue;
      }

      var propType = getPropType(propValue);

      if (propType === 'object') {
        if (propValue instanceof Date) {
          return 'date';
        } else if (propValue instanceof RegExp) {
          return 'regexp';
        }
      }

      return propType;
    } // Returns a string that is postfixed to a warning about an invalid type.
    // For example, "undefined" or "of type array"


    function getPostfixForTypeWarning(value) {
      var type = getPreciseType(value);

      switch (type) {
        case 'array':
        case 'object':
          return 'an ' + type;

        case 'boolean':
        case 'date':
        case 'regexp':
          return 'a ' + type;

        default:
          return type;
      }
    } // Returns class name of the object, if any.


    function getClassName(propValue) {
      if (!propValue.constructor || !propValue.constructor.name) {
        return ANONYMOUS;
      }

      return propValue.constructor.name;
    }

    ReactPropTypes.checkPropTypes = checkPropTypes_1$2;
    ReactPropTypes.PropTypes = ReactPropTypes;
    return ReactPropTypes;
  };

  function emptyFunction$2() {}

  var factoryWithThrowingShims$2 = function () {
    function shim(props, propName, componentName, location, propFullName, secret) {
      if (secret === ReactPropTypesSecret_1$2) {
        // It is still safe when called from React.
        return;
      }

      var err = new Error('Calling PropTypes validators directly is not supported by the `prop-types` package. ' + 'Use PropTypes.checkPropTypes() to call them. ' + 'Read more at http://fb.me/use-check-prop-types');
      err.name = 'Invariant Violation';
      throw err;
    }

    shim.isRequired = shim;

    function getShim() {
      return shim;
    } // Important!
    // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.


    var ReactPropTypes = {
      array: shim,
      bool: shim,
      func: shim,
      number: shim,
      object: shim,
      string: shim,
      symbol: shim,
      any: shim,
      arrayOf: getShim,
      element: shim,
      instanceOf: getShim,
      node: shim,
      objectOf: getShim,
      oneOf: getShim,
      oneOfType: getShim,
      shape: getShim,
      exact: getShim
    };
    ReactPropTypes.checkPropTypes = emptyFunction$2;
    ReactPropTypes.PropTypes = ReactPropTypes;
    return ReactPropTypes;
  };

  var propTypes$2 = createCommonjsModule$3(function (module) {
    /**
     * Copyright (c) 2013-present, Facebook, Inc.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE file in the root directory of this source tree.
     */
    if (process.env.NODE_ENV !== 'production') {
      var REACT_ELEMENT_TYPE = typeof Symbol === 'function' && Symbol.for && Symbol.for('react.element') || 0xeac7;

      var isValidElement = function (object) {
        return typeof object === 'object' && object !== null && object.$$typeof === REACT_ELEMENT_TYPE;
      }; // By explicitly using `prop-types` you are opting into new development behavior.
      // http://fb.me/prop-types-in-prod


      var throwOnDirectAccess = true;
      module.exports = factoryWithTypeCheckers$2(isValidElement, throwOnDirectAccess);
    } else {
      // By explicitly using `prop-types` you are opting into new production behavior.
      // http://fb.me/prop-types-in-prod
      module.exports = factoryWithThrowingShims$2();
    }
  });
  /**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */

  /** Used as the `TypeError` message for "Functions" methods. */

  var FUNC_ERROR_TEXT$1 = 'Expected a function';
  /** Used as references for various `Number` constants. */

  var NAN = 0 / 0;
  /** `Object#toString` result references. */

  var symbolTag$1 = '[object Symbol]';
  /** Used to match leading and trailing whitespace. */

  var reTrim = /^\s+|\s+$/g;
  /** Used to detect bad signed hexadecimal string values. */

  var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;
  /** Used to detect binary string values. */

  var reIsBinary = /^0b[01]+$/i;
  /** Used to detect octal string values. */

  var reIsOctal = /^0o[0-7]+$/i;
  /** Built-in method references without a dependency on `root`. */

  var freeParseInt = parseInt;
  /** Detect free variable `global` from Node.js. */

  var freeGlobal$1 = typeof commonjsGlobal$3 == 'object' && commonjsGlobal$3 && commonjsGlobal$3.Object === Object && commonjsGlobal$3;
  /** Detect free variable `self`. */

  var freeSelf$1 = typeof self == 'object' && self && self.Object === Object && self;
  /** Used as a reference to the global object. */

  var root$2 = freeGlobal$1 || freeSelf$1 || Function('return this')();
  /** Used for built-in method references. */

  var objectProto$b = Object.prototype;
  /**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */

  var objectToString$1 = objectProto$b.toString;
  /* Built-in method references for those with the same name as other `lodash` methods. */

  var nativeMax$1 = Math.max,
      nativeMin$1 = Math.min;
  /**
   * Gets the timestamp of the number of milliseconds that have elapsed since
   * the Unix epoch (1 January 1970 00:00:00 UTC).
   *
   * @static
   * @memberOf _
   * @since 2.4.0
   * @category Date
   * @returns {number} Returns the timestamp.
   * @example
   *
   * _.defer(function(stamp) {
   *   console.log(_.now() - stamp);
   * }, _.now());
   * // => Logs the number of milliseconds it took for the deferred invocation.
   */

  var now = function () {
    return root$2.Date.now();
  };
  /**
   * Creates a debounced function that delays invoking `func` until after `wait`
   * milliseconds have elapsed since the last time the debounced function was
   * invoked. The debounced function comes with a `cancel` method to cancel
   * delayed `func` invocations and a `flush` method to immediately invoke them.
   * Provide `options` to indicate whether `func` should be invoked on the
   * leading and/or trailing edge of the `wait` timeout. The `func` is invoked
   * with the last arguments provided to the debounced function. Subsequent
   * calls to the debounced function return the result of the last `func`
   * invocation.
   *
   * **Note:** If `leading` and `trailing` options are `true`, `func` is
   * invoked on the trailing edge of the timeout only if the debounced function
   * is invoked more than once during the `wait` timeout.
   *
   * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
   * until to the next tick, similar to `setTimeout` with a timeout of `0`.
   *
   * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
   * for details over the differences between `_.debounce` and `_.throttle`.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Function
   * @param {Function} func The function to debounce.
   * @param {number} [wait=0] The number of milliseconds to delay.
   * @param {Object} [options={}] The options object.
   * @param {boolean} [options.leading=false]
   *  Specify invoking on the leading edge of the timeout.
   * @param {number} [options.maxWait]
   *  The maximum time `func` is allowed to be delayed before it's invoked.
   * @param {boolean} [options.trailing=true]
   *  Specify invoking on the trailing edge of the timeout.
   * @returns {Function} Returns the new debounced function.
   * @example
   *
   * // Avoid costly calculations while the window size is in flux.
   * jQuery(window).on('resize', _.debounce(calculateLayout, 150));
   *
   * // Invoke `sendMail` when clicked, debouncing subsequent calls.
   * jQuery(element).on('click', _.debounce(sendMail, 300, {
   *   'leading': true,
   *   'trailing': false
   * }));
   *
   * // Ensure `batchLog` is invoked once after 1 second of debounced calls.
   * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });
   * var source = new EventSource('/stream');
   * jQuery(source).on('message', debounced);
   *
   * // Cancel the trailing debounced invocation.
   * jQuery(window).on('popstate', debounced.cancel);
   */


  function debounce(func, wait, options) {
    var lastArgs,
        lastThis,
        maxWait,
        result,
        timerId,
        lastCallTime,
        lastInvokeTime = 0,
        leading = false,
        maxing = false,
        trailing = true;

    if (typeof func != 'function') {
      throw new TypeError(FUNC_ERROR_TEXT$1);
    }

    wait = toNumber(wait) || 0;

    if (isObject$2(options)) {
      leading = !!options.leading;
      maxing = 'maxWait' in options;
      maxWait = maxing ? nativeMax$1(toNumber(options.maxWait) || 0, wait) : maxWait;
      trailing = 'trailing' in options ? !!options.trailing : trailing;
    }

    function invokeFunc(time) {
      var args = lastArgs,
          thisArg = lastThis;
      lastArgs = lastThis = undefined;
      lastInvokeTime = time;
      result = func.apply(thisArg, args);
      return result;
    }

    function leadingEdge(time) {
      // Reset any `maxWait` timer.
      lastInvokeTime = time; // Start the timer for the trailing edge.

      timerId = setTimeout(timerExpired, wait); // Invoke the leading edge.

      return leading ? invokeFunc(time) : result;
    }

    function remainingWait(time) {
      var timeSinceLastCall = time - lastCallTime,
          timeSinceLastInvoke = time - lastInvokeTime,
          result = wait - timeSinceLastCall;
      return maxing ? nativeMin$1(result, maxWait - timeSinceLastInvoke) : result;
    }

    function shouldInvoke(time) {
      var timeSinceLastCall = time - lastCallTime,
          timeSinceLastInvoke = time - lastInvokeTime; // Either this is the first call, activity has stopped and we're at the
      // trailing edge, the system time has gone backwards and we're treating
      // it as the trailing edge, or we've hit the `maxWait` limit.

      return lastCallTime === undefined || timeSinceLastCall >= wait || timeSinceLastCall < 0 || maxing && timeSinceLastInvoke >= maxWait;
    }

    function timerExpired() {
      var time = now();

      if (shouldInvoke(time)) {
        return trailingEdge(time);
      } // Restart the timer.


      timerId = setTimeout(timerExpired, remainingWait(time));
    }

    function trailingEdge(time) {
      timerId = undefined; // Only invoke if we have `lastArgs` which means `func` has been
      // debounced at least once.

      if (trailing && lastArgs) {
        return invokeFunc(time);
      }

      lastArgs = lastThis = undefined;
      return result;
    }

    function cancel() {
      if (timerId !== undefined) {
        clearTimeout(timerId);
      }

      lastInvokeTime = 0;
      lastArgs = lastCallTime = lastThis = timerId = undefined;
    }

    function flush() {
      return timerId === undefined ? result : trailingEdge(now());
    }

    function debounced() {
      var time = now(),
          isInvoking = shouldInvoke(time);
      lastArgs = arguments;
      lastThis = this;
      lastCallTime = time;

      if (isInvoking) {
        if (timerId === undefined) {
          return leadingEdge(lastCallTime);
        }

        if (maxing) {
          // Handle invocations in a tight loop.
          timerId = setTimeout(timerExpired, wait);
          return invokeFunc(lastCallTime);
        }
      }

      if (timerId === undefined) {
        timerId = setTimeout(timerExpired, wait);
      }

      return result;
    }

    debounced.cancel = cancel;
    debounced.flush = flush;
    return debounced;
  }
  /**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */


  function isObject$2(value) {
    var type = typeof value;
    return !!value && (type == 'object' || type == 'function');
  }
  /**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */


  function isObjectLike$1(value) {
    return !!value && typeof value == 'object';
  }
  /**
   * Checks if `value` is classified as a `Symbol` primitive or object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
   * @example
   *
   * _.isSymbol(Symbol.iterator);
   * // => true
   *
   * _.isSymbol('abc');
   * // => false
   */


  function isSymbol$1(value) {
    return typeof value == 'symbol' || isObjectLike$1(value) && objectToString$1.call(value) == symbolTag$1;
  }
  /**
   * Converts `value` to a number.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to process.
   * @returns {number} Returns the number.
   * @example
   *
   * _.toNumber(3.2);
   * // => 3.2
   *
   * _.toNumber(Number.MIN_VALUE);
   * // => 5e-324
   *
   * _.toNumber(Infinity);
   * // => Infinity
   *
   * _.toNumber('3.2');
   * // => 3.2
   */


  function toNumber(value) {
    if (typeof value == 'number') {
      return value;
    }

    if (isSymbol$1(value)) {
      return NAN;
    }

    if (isObject$2(value)) {
      var other = typeof value.valueOf == 'function' ? value.valueOf() : value;
      value = isObject$2(other) ? other + '' : other;
    }

    if (typeof value != 'string') {
      return value === 0 ? value : +value;
    }

    value = value.replace(reTrim, '');
    var isBinary = reIsBinary.test(value);
    return isBinary || reIsOctal.test(value) ? freeParseInt(value.slice(2), isBinary ? 2 : 8) : reIsBadHex.test(value) ? NAN : +value;
  }

  var lodash_debounce = debounce;

  function styleInject$2(css, ref) {
    if (ref === void 0) ref = {};
    var insertAt = ref.insertAt;

    if (!css || typeof document === 'undefined') {
      return;
    }

    var head = document.head || document.getElementsByTagName('head')[0];
    var style = document.createElement('style');
    style.type = 'text/css';

    if (insertAt === 'top') {
      if (head.firstChild) {
        head.insertBefore(style, head.firstChild);
      } else {
        head.appendChild(style);
      }
    } else {
      head.appendChild(style);
    }

    if (style.styleSheet) {
      style.styleSheet.cssText = css;
    } else {
      style.appendChild(document.createTextNode(css));
    }
  }

  var css$y = ".scroll {\n  height: 100%;\n  padding: 5px;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.scroll .scroll-holder {\n  height: calc(100% - 20px);\n  margin-top: 5px;\n  position: relative;\n  width: 12px;\n}\n.scroll .scroll-holder .imageSlider {\n  height: 12px;\n  left: 12px;\n  padding: 0;\n  position: absolute;\n  top: 0;\n  transform: rotate(90deg);\n  transform-origin: top left;\n  -webkit-appearance: none;\n  background-color: rgba(0,0,0,0);\n}\n.scroll .scroll-holder .imageSlider:focus {\n  outline: none;\n}\n.scroll .scroll-holder .imageSlider::-moz-focus-outer {\n  border: none;\n}\n.scroll .scroll-holder .imageSlider::-webkit-slider-runnable-track {\n  background-color: rgba(0,0,0,0);\n  border: none;\n  cursor: pointer;\n  height: 5px;\n  z-index: 6;\n}\n.scroll .scroll-holder .imageSlider::-moz-range-track {\n  background-color: rgba(0,0,0,0);\n  border: none;\n  cursor: pointer;\n  height: 2px;\n  z-index: 6;\n}\n.scroll .scroll-holder .imageSlider::-ms-track {\n  animate: 0.2s;\n  background: transparent;\n  border: none;\n  border-width: 15px 0;\n  color: rgba(0,0,0,0);\n  cursor: pointer;\n  height: 12px;\n  width: 100%;\n}\n.scroll .scroll-holder .imageSlider::-ms-fill-lower {\n  background: rgba(0,0,0,0);\n}\n.scroll .scroll-holder .imageSlider::-ms-fill-upper {\n  background: rgba(0,0,0,0);\n}\n.scroll .scroll-holder .imageSlider::-webkit-slider-thumb {\n  -webkit-appearance: none !important;\n  background-color: #163239;\n  border: none;\n  border-radius: 57px;\n  cursor: -webkit-grab;\n  height: 12px;\n  margin-top: -4px;\n  width: 39px;\n}\n.scroll .scroll-holder .imageSlider::-webkit-slider-thumb:active {\n  background-color: #20a5d6;\n  cursor: -webkit-grabbing;\n}\n.scroll .scroll-holder .imageSlider::-moz-range-thumb {\n  background-color: #163239;\n  border: none;\n  border-radius: 57px;\n  cursor: -moz-grab;\n  height: 12px;\n  width: 39px;\n  z-index: 7;\n}\n.scroll .scroll-holder .imageSlider::-moz-range-thumb:active {\n  background-color: #20a5d6;\n  cursor: -moz-grabbing;\n}\n.scroll .scroll-holder .imageSlider::-ms-thumb {\n  background-color: #163239;\n  border: none;\n  border-radius: 57px;\n  cursor: ns-resize;\n  height: 12px;\n  width: 39px;\n}\n.scroll .scroll-holder .imageSlider::-ms-thumb:active {\n  background-color: #20a5d6;\n}\n.scroll .scroll-holder .imageSlider::-ms-tooltip {\n  display: none;\n}\n@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {\n  .imageSlider {\n    left: 50px;\n  }\n}\n";
  styleInject$2(css$y);

  var ImageScrollbar =
  /*#__PURE__*/
  function (_PureComponent) {
    _inherits$d(ImageScrollbar, _PureComponent);

    function ImageScrollbar() {
      var _getPrototypeOf2;

      var _this;

      _classCallCheck$d(this, ImageScrollbar);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _possibleConstructorReturn$d(this, (_getPrototypeOf2 = _getPrototypeOf$2(ImageScrollbar)).call.apply(_getPrototypeOf2, [this].concat(args)));

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onChange", function (event) {
        var intValue = parseInt(event.target.value, 10);

        _this.props.onInputCallback(intValue);
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onKeyDown", function (event) {
        // We don't allow direct keyboard up/down input on the
        // image sliders since the natural direction is reversed (0 is at the top)
        // Store the KeyCodes in an object for readability
        var keys = {
          DOWN: 40,
          UP: 38
        }; // TODO: Enable scroll down / scroll up without depending on ohif-core

        if (event.which === keys.DOWN) {
          //OHIF.commands.run('scrollDown');
          event.preventDefault();
        } else if (event.which === keys.UP) {
          //OHIF.commands.run('scrollUp');
          event.preventDefault();
        }
      });

      return _this;
    }

    _createClass$3(ImageScrollbar, [{
      key: "render",
      value: function render() {
        if (this.props.max === 0) {
          return null;
        }

        this.style = {
          width: "".concat(this.props.height)
        };
        return React__default.createElement("div", {
          className: "scroll"
        }, React__default.createElement("div", {
          className: "scroll-holder"
        }, React__default.createElement("input", {
          className: "imageSlider",
          style: this.style,
          type: "range",
          min: "0",
          max: this.props.max,
          step: "1",
          value: this.props.value,
          onChange: this.onChange,
          onKeyDown: this.onKeyDown
        })));
      }
    }]);

    return ImageScrollbar;
  }(React.PureComponent);

  _defineProperty$4(ImageScrollbar, "propTypes", {
    value: propTypes$2.number.isRequired,
    max: propTypes$2.number.isRequired,
    height: propTypes$2.string.isRequired,
    onInputCallback: propTypes$2.func.isRequired
  });
  /**
   * Formats a patient name for display purposes
   */


  function formatPN(name) {
    if (!name) {
      return;
    } // Convert the first ^ to a ', '. String.replace() only affects
    // the first appearance of the character.


    var commaBetweenFirstAndLast = name.replace('^', ', '); // Replace any remaining '^' characters with spaces

    var cleaned = commaBetweenFirstAndLast.replace(/\^/g, ' '); // Trim any extraneous whitespace

    return cleaned.trim();
  }

  var moment = createCommonjsModule$3(function (module, exports) {
    (function (global, factory) {
      module.exports = factory();
    })(commonjsGlobal$3, function () {
      var hookCallback;

      function hooks() {
        return hookCallback.apply(null, arguments);
      } // This is done to register the method called with moment()
      // without creating circular dependencies.


      function setHookCallback(callback) {
        hookCallback = callback;
      }

      function isArray(input) {
        return input instanceof Array || Object.prototype.toString.call(input) === '[object Array]';
      }

      function isObject(input) {
        // IE8 will treat undefined and null as object if it wasn't for
        // input != null
        return input != null && Object.prototype.toString.call(input) === '[object Object]';
      }

      function isObjectEmpty(obj) {
        if (Object.getOwnPropertyNames) {
          return Object.getOwnPropertyNames(obj).length === 0;
        } else {
          var k;

          for (k in obj) {
            if (obj.hasOwnProperty(k)) {
              return false;
            }
          }

          return true;
        }
      }

      function isUndefined(input) {
        return input === void 0;
      }

      function isNumber(input) {
        return typeof input === 'number' || Object.prototype.toString.call(input) === '[object Number]';
      }

      function isDate(input) {
        return input instanceof Date || Object.prototype.toString.call(input) === '[object Date]';
      }

      function map(arr, fn) {
        var res = [],
            i;

        for (i = 0; i < arr.length; ++i) {
          res.push(fn(arr[i], i));
        }

        return res;
      }

      function hasOwnProp(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b);
      }

      function extend(a, b) {
        for (var i in b) {
          if (hasOwnProp(b, i)) {
            a[i] = b[i];
          }
        }

        if (hasOwnProp(b, 'toString')) {
          a.toString = b.toString;
        }

        if (hasOwnProp(b, 'valueOf')) {
          a.valueOf = b.valueOf;
        }

        return a;
      }

      function createUTC(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, true).utc();
      }

      function defaultParsingFlags() {
        // We need to deep clone this object.
        return {
          empty: false,
          unusedTokens: [],
          unusedInput: [],
          overflow: -2,
          charsLeftOver: 0,
          nullInput: false,
          invalidMonth: null,
          invalidFormat: false,
          userInvalidated: false,
          iso: false,
          parsedDateParts: [],
          meridiem: null,
          rfc2822: false,
          weekdayMismatch: false
        };
      }

      function getParsingFlags(m) {
        if (m._pf == null) {
          m._pf = defaultParsingFlags();
        }

        return m._pf;
      }

      var some;

      if (Array.prototype.some) {
        some = Array.prototype.some;
      } else {
        some = function (fun) {
          var t = Object(this);
          var len = t.length >>> 0;

          for (var i = 0; i < len; i++) {
            if (i in t && fun.call(this, t[i], i, t)) {
              return true;
            }
          }

          return false;
        };
      }

      function isValid(m) {
        if (m._isValid == null) {
          var flags = getParsingFlags(m);
          var parsedParts = some.call(flags.parsedDateParts, function (i) {
            return i != null;
          });
          var isNowValid = !isNaN(m._d.getTime()) && flags.overflow < 0 && !flags.empty && !flags.invalidMonth && !flags.invalidWeekday && !flags.weekdayMismatch && !flags.nullInput && !flags.invalidFormat && !flags.userInvalidated && (!flags.meridiem || flags.meridiem && parsedParts);

          if (m._strict) {
            isNowValid = isNowValid && flags.charsLeftOver === 0 && flags.unusedTokens.length === 0 && flags.bigHour === undefined;
          }

          if (Object.isFrozen == null || !Object.isFrozen(m)) {
            m._isValid = isNowValid;
          } else {
            return isNowValid;
          }
        }

        return m._isValid;
      }

      function createInvalid(flags) {
        var m = createUTC(NaN);

        if (flags != null) {
          extend(getParsingFlags(m), flags);
        } else {
          getParsingFlags(m).userInvalidated = true;
        }

        return m;
      } // Plugins that add properties should also add the key here (null value),
      // so we can properly clone ourselves.


      var momentProperties = hooks.momentProperties = [];

      function copyConfig(to, from) {
        var i, prop, val;

        if (!isUndefined(from._isAMomentObject)) {
          to._isAMomentObject = from._isAMomentObject;
        }

        if (!isUndefined(from._i)) {
          to._i = from._i;
        }

        if (!isUndefined(from._f)) {
          to._f = from._f;
        }

        if (!isUndefined(from._l)) {
          to._l = from._l;
        }

        if (!isUndefined(from._strict)) {
          to._strict = from._strict;
        }

        if (!isUndefined(from._tzm)) {
          to._tzm = from._tzm;
        }

        if (!isUndefined(from._isUTC)) {
          to._isUTC = from._isUTC;
        }

        if (!isUndefined(from._offset)) {
          to._offset = from._offset;
        }

        if (!isUndefined(from._pf)) {
          to._pf = getParsingFlags(from);
        }

        if (!isUndefined(from._locale)) {
          to._locale = from._locale;
        }

        if (momentProperties.length > 0) {
          for (i = 0; i < momentProperties.length; i++) {
            prop = momentProperties[i];
            val = from[prop];

            if (!isUndefined(val)) {
              to[prop] = val;
            }
          }
        }

        return to;
      }

      var updateInProgress = false; // Moment prototype object

      function Moment(config) {
        copyConfig(this, config);
        this._d = new Date(config._d != null ? config._d.getTime() : NaN);

        if (!this.isValid()) {
          this._d = new Date(NaN);
        } // Prevent infinite loop in case updateOffset creates new moment
        // objects.


        if (updateInProgress === false) {
          updateInProgress = true;
          hooks.updateOffset(this);
          updateInProgress = false;
        }
      }

      function isMoment(obj) {
        return obj instanceof Moment || obj != null && obj._isAMomentObject != null;
      }

      function absFloor(number) {
        if (number < 0) {
          // -0 -> 0
          return Math.ceil(number) || 0;
        } else {
          return Math.floor(number);
        }
      }

      function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion,
            value = 0;

        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
          value = absFloor(coercedNumber);
        }

        return value;
      } // compare two arrays, return the number of differences


      function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length),
            lengthDiff = Math.abs(array1.length - array2.length),
            diffs = 0,
            i;

        for (i = 0; i < len; i++) {
          if (dontConvert && array1[i] !== array2[i] || !dontConvert && toInt(array1[i]) !== toInt(array2[i])) {
            diffs++;
          }
        }

        return diffs + lengthDiff;
      }

      function warn(msg) {
        if (hooks.suppressDeprecationWarnings === false && typeof console !== 'undefined' && console.warn) {
          console.warn('Deprecation warning: ' + msg);
        }
      }

      function deprecate(msg, fn) {
        var firstTime = true;
        return extend(function () {
          if (hooks.deprecationHandler != null) {
            hooks.deprecationHandler(null, msg);
          }

          if (firstTime) {
            var args = [];
            var arg;

            for (var i = 0; i < arguments.length; i++) {
              arg = '';

              if (typeof arguments[i] === 'object') {
                arg += '\n[' + i + '] ';

                for (var key in arguments[0]) {
                  arg += key + ': ' + arguments[0][key] + ', ';
                }

                arg = arg.slice(0, -2); // Remove trailing comma and space
              } else {
                arg = arguments[i];
              }

              args.push(arg);
            }

            warn(msg + '\nArguments: ' + Array.prototype.slice.call(args).join('') + '\n' + new Error().stack);
            firstTime = false;
          }

          return fn.apply(this, arguments);
        }, fn);
      }

      var deprecations = {};

      function deprecateSimple(name, msg) {
        if (hooks.deprecationHandler != null) {
          hooks.deprecationHandler(name, msg);
        }

        if (!deprecations[name]) {
          warn(msg);
          deprecations[name] = true;
        }
      }

      hooks.suppressDeprecationWarnings = false;
      hooks.deprecationHandler = null;

      function isFunction(input) {
        return input instanceof Function || Object.prototype.toString.call(input) === '[object Function]';
      }

      function set(config) {
        var prop, i;

        for (i in config) {
          prop = config[i];

          if (isFunction(prop)) {
            this[i] = prop;
          } else {
            this['_' + i] = prop;
          }
        }

        this._config = config; // Lenient ordinal parsing accepts just a number in addition to
        // number + (possibly) stuff coming from _dayOfMonthOrdinalParse.
        // TODO: Remove "ordinalParse" fallback in next major release.

        this._dayOfMonthOrdinalParseLenient = new RegExp((this._dayOfMonthOrdinalParse.source || this._ordinalParse.source) + '|' + /\d{1,2}/.source);
      }

      function mergeConfigs(parentConfig, childConfig) {
        var res = extend({}, parentConfig),
            prop;

        for (prop in childConfig) {
          if (hasOwnProp(childConfig, prop)) {
            if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {
              res[prop] = {};
              extend(res[prop], parentConfig[prop]);
              extend(res[prop], childConfig[prop]);
            } else if (childConfig[prop] != null) {
              res[prop] = childConfig[prop];
            } else {
              delete res[prop];
            }
          }
        }

        for (prop in parentConfig) {
          if (hasOwnProp(parentConfig, prop) && !hasOwnProp(childConfig, prop) && isObject(parentConfig[prop])) {
            // make sure changes to properties don't modify parent config
            res[prop] = extend({}, res[prop]);
          }
        }

        return res;
      }

      function Locale(config) {
        if (config != null) {
          this.set(config);
        }
      }

      var keys;

      if (Object.keys) {
        keys = Object.keys;
      } else {
        keys = function (obj) {
          var i,
              res = [];

          for (i in obj) {
            if (hasOwnProp(obj, i)) {
              res.push(i);
            }
          }

          return res;
        };
      }

      var defaultCalendar = {
        sameDay: '[Today at] LT',
        nextDay: '[Tomorrow at] LT',
        nextWeek: 'dddd [at] LT',
        lastDay: '[Yesterday at] LT',
        lastWeek: '[Last] dddd [at] LT',
        sameElse: 'L'
      };

      function calendar(key, mom, now) {
        var output = this._calendar[key] || this._calendar['sameElse'];
        return isFunction(output) ? output.call(mom, now) : output;
      }

      var defaultLongDateFormat = {
        LTS: 'h:mm:ss A',
        LT: 'h:mm A',
        L: 'MM/DD/YYYY',
        LL: 'MMMM D, YYYY',
        LLL: 'MMMM D, YYYY h:mm A',
        LLLL: 'dddd, MMMM D, YYYY h:mm A'
      };

      function longDateFormat(key) {
        var format = this._longDateFormat[key],
            formatUpper = this._longDateFormat[key.toUpperCase()];

        if (format || !formatUpper) {
          return format;
        }

        this._longDateFormat[key] = formatUpper.replace(/MMMM|MM|DD|dddd/g, function (val) {
          return val.slice(1);
        });
        return this._longDateFormat[key];
      }

      var defaultInvalidDate = 'Invalid date';

      function invalidDate() {
        return this._invalidDate;
      }

      var defaultOrdinal = '%d';
      var defaultDayOfMonthOrdinalParse = /\d{1,2}/;

      function ordinal(number) {
        return this._ordinal.replace('%d', number);
      }

      var defaultRelativeTime = {
        future: 'in %s',
        past: '%s ago',
        s: 'a few seconds',
        ss: '%d seconds',
        m: 'a minute',
        mm: '%d minutes',
        h: 'an hour',
        hh: '%d hours',
        d: 'a day',
        dd: '%d days',
        M: 'a month',
        MM: '%d months',
        y: 'a year',
        yy: '%d years'
      };

      function relativeTime(number, withoutSuffix, string, isFuture) {
        var output = this._relativeTime[string];
        return isFunction(output) ? output(number, withoutSuffix, string, isFuture) : output.replace(/%d/i, number);
      }

      function pastFuture(diff, output) {
        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
        return isFunction(format) ? format(output) : format.replace(/%s/i, output);
      }

      var aliases = {};

      function addUnitAlias(unit, shorthand) {
        var lowerCase = unit.toLowerCase();
        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;
      }

      function normalizeUnits(units) {
        return typeof units === 'string' ? aliases[units] || aliases[units.toLowerCase()] : undefined;
      }

      function normalizeObjectUnits(inputObject) {
        var normalizedInput = {},
            normalizedProp,
            prop;

        for (prop in inputObject) {
          if (hasOwnProp(inputObject, prop)) {
            normalizedProp = normalizeUnits(prop);

            if (normalizedProp) {
              normalizedInput[normalizedProp] = inputObject[prop];
            }
          }
        }

        return normalizedInput;
      }

      var priorities = {};

      function addUnitPriority(unit, priority) {
        priorities[unit] = priority;
      }

      function getPrioritizedUnits(unitsObj) {
        var units = [];

        for (var u in unitsObj) {
          units.push({
            unit: u,
            priority: priorities[u]
          });
        }

        units.sort(function (a, b) {
          return a.priority - b.priority;
        });
        return units;
      }

      function zeroFill(number, targetLength, forceSign) {
        var absNumber = '' + Math.abs(number),
            zerosToFill = targetLength - absNumber.length,
            sign = number >= 0;
        return (sign ? forceSign ? '+' : '' : '-') + Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) + absNumber;
      }

      var formattingTokens = /(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
      var localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;
      var formatFunctions = {};
      var formatTokenFunctions = {}; // token:    'M'
      // padded:   ['MM', 2]
      // ordinal:  'Mo'
      // callback: function () { this.month() + 1 }

      function addFormatToken(token, padded, ordinal, callback) {
        var func = callback;

        if (typeof callback === 'string') {
          func = function () {
            return this[callback]();
          };
        }

        if (token) {
          formatTokenFunctions[token] = func;
        }

        if (padded) {
          formatTokenFunctions[padded[0]] = function () {
            return zeroFill(func.apply(this, arguments), padded[1], padded[2]);
          };
        }

        if (ordinal) {
          formatTokenFunctions[ordinal] = function () {
            return this.localeData().ordinal(func.apply(this, arguments), token);
          };
        }
      }

      function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
          return input.replace(/^\[|\]$/g, '');
        }

        return input.replace(/\\/g, '');
      }

      function makeFormatFunction(format) {
        var array = format.match(formattingTokens),
            i,
            length;

        for (i = 0, length = array.length; i < length; i++) {
          if (formatTokenFunctions[array[i]]) {
            array[i] = formatTokenFunctions[array[i]];
          } else {
            array[i] = removeFormattingTokens(array[i]);
          }
        }

        return function (mom) {
          var output = '',
              i;

          for (i = 0; i < length; i++) {
            output += isFunction(array[i]) ? array[i].call(mom, format) : array[i];
          }

          return output;
        };
      } // format date using native date object


      function formatMoment(m, format) {
        if (!m.isValid()) {
          return m.localeData().invalidDate();
        }

        format = expandFormat(format, m.localeData());
        formatFunctions[format] = formatFunctions[format] || makeFormatFunction(format);
        return formatFunctions[format](m);
      }

      function expandFormat(format, locale) {
        var i = 5;

        function replaceLongDateFormatTokens(input) {
          return locale.longDateFormat(input) || input;
        }

        localFormattingTokens.lastIndex = 0;

        while (i >= 0 && localFormattingTokens.test(format)) {
          format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
          localFormattingTokens.lastIndex = 0;
          i -= 1;
        }

        return format;
      }

      var match1 = /\d/; //       0 - 9

      var match2 = /\d\d/; //      00 - 99

      var match3 = /\d{3}/; //     000 - 999

      var match4 = /\d{4}/; //    0000 - 9999

      var match6 = /[+-]?\d{6}/; // -999999 - 999999

      var match1to2 = /\d\d?/; //       0 - 99

      var match3to4 = /\d\d\d\d?/; //     999 - 9999

      var match5to6 = /\d\d\d\d\d\d?/; //   99999 - 999999

      var match1to3 = /\d{1,3}/; //       0 - 999

      var match1to4 = /\d{1,4}/; //       0 - 9999

      var match1to6 = /[+-]?\d{1,6}/; // -999999 - 999999

      var matchUnsigned = /\d+/; //       0 - inf

      var matchSigned = /[+-]?\d+/; //    -inf - inf

      var matchOffset = /Z|[+-]\d\d:?\d\d/gi; // +00:00 -00:00 +0000 -0000 or Z

      var matchShortOffset = /Z|[+-]\d\d(?::?\d\d)?/gi; // +00 -00 +00:00 -00:00 +0000 -0000 or Z

      var matchTimestamp = /[+-]?\d+(\.\d{1,3})?/; // 123456789 123456789.123
      // any word (or two) characters or numbers including two/three word month in arabic.
      // includes scottish gaelic two word and hyphenated months

      var matchWord = /[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;
      var regexes = {};

      function addRegexToken(token, regex, strictRegex) {
        regexes[token] = isFunction(regex) ? regex : function (isStrict, localeData) {
          return isStrict && strictRegex ? strictRegex : regex;
        };
      }

      function getParseRegexForToken(token, config) {
        if (!hasOwnProp(regexes, token)) {
          return new RegExp(unescapeFormat(token));
        }

        return regexes[token](config._strict, config._locale);
      } // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript


      function unescapeFormat(s) {
        return regexEscape(s.replace('\\', '').replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (matched, p1, p2, p3, p4) {
          return p1 || p2 || p3 || p4;
        }));
      }

      function regexEscape(s) {
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
      }

      var tokens = {};

      function addParseToken(token, callback) {
        var i,
            func = callback;

        if (typeof token === 'string') {
          token = [token];
        }

        if (isNumber(callback)) {
          func = function (input, array) {
            array[callback] = toInt(input);
          };
        }

        for (i = 0; i < token.length; i++) {
          tokens[token[i]] = func;
        }
      }

      function addWeekParseToken(token, callback) {
        addParseToken(token, function (input, array, config, token) {
          config._w = config._w || {};
          callback(input, config._w, config, token);
        });
      }

      function addTimeToArrayFromToken(token, input, config) {
        if (input != null && hasOwnProp(tokens, token)) {
          tokens[token](input, config._a, config, token);
        }
      }

      var YEAR = 0;
      var MONTH = 1;
      var DATE = 2;
      var HOUR = 3;
      var MINUTE = 4;
      var SECOND = 5;
      var MILLISECOND = 6;
      var WEEK = 7;
      var WEEKDAY = 8; // FORMATTING

      addFormatToken('Y', 0, 0, function () {
        var y = this.year();
        return y <= 9999 ? '' + y : '+' + y;
      });
      addFormatToken(0, ['YY', 2], 0, function () {
        return this.year() % 100;
      });
      addFormatToken(0, ['YYYY', 4], 0, 'year');
      addFormatToken(0, ['YYYYY', 5], 0, 'year');
      addFormatToken(0, ['YYYYYY', 6, true], 0, 'year'); // ALIASES

      addUnitAlias('year', 'y'); // PRIORITIES

      addUnitPriority('year', 1); // PARSING

      addRegexToken('Y', matchSigned);
      addRegexToken('YY', match1to2, match2);
      addRegexToken('YYYY', match1to4, match4);
      addRegexToken('YYYYY', match1to6, match6);
      addRegexToken('YYYYYY', match1to6, match6);
      addParseToken(['YYYYY', 'YYYYYY'], YEAR);
      addParseToken('YYYY', function (input, array) {
        array[YEAR] = input.length === 2 ? hooks.parseTwoDigitYear(input) : toInt(input);
      });
      addParseToken('YY', function (input, array) {
        array[YEAR] = hooks.parseTwoDigitYear(input);
      });
      addParseToken('Y', function (input, array) {
        array[YEAR] = parseInt(input, 10);
      }); // HELPERS

      function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365;
      }

      function isLeapYear(year) {
        return year % 4 === 0 && year % 100 !== 0 || year % 400 === 0;
      } // HOOKS


      hooks.parseTwoDigitYear = function (input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
      }; // MOMENTS


      var getSetYear = makeGetSet('FullYear', true);

      function getIsLeapYear() {
        return isLeapYear(this.year());
      }

      function makeGetSet(unit, keepTime) {
        return function (value) {
          if (value != null) {
            set$1(this, unit, value);
            hooks.updateOffset(this, keepTime);
            return this;
          } else {
            return get(this, unit);
          }
        };
      }

      function get(mom, unit) {
        return mom.isValid() ? mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]() : NaN;
      }

      function set$1(mom, unit, value) {
        if (mom.isValid() && !isNaN(value)) {
          if (unit === 'FullYear' && isLeapYear(mom.year()) && mom.month() === 1 && mom.date() === 29) {
            mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value, mom.month(), daysInMonth(value, mom.month()));
          } else {
            mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
          }
        }
      } // MOMENTS


      function stringGet(units) {
        units = normalizeUnits(units);

        if (isFunction(this[units])) {
          return this[units]();
        }

        return this;
      }

      function stringSet(units, value) {
        if (typeof units === 'object') {
          units = normalizeObjectUnits(units);
          var prioritized = getPrioritizedUnits(units);

          for (var i = 0; i < prioritized.length; i++) {
            this[prioritized[i].unit](units[prioritized[i].unit]);
          }
        } else {
          units = normalizeUnits(units);

          if (isFunction(this[units])) {
            return this[units](value);
          }
        }

        return this;
      }

      function mod(n, x) {
        return (n % x + x) % x;
      }

      var indexOf;

      if (Array.prototype.indexOf) {
        indexOf = Array.prototype.indexOf;
      } else {
        indexOf = function (o) {
          // I know
          var i;

          for (i = 0; i < this.length; ++i) {
            if (this[i] === o) {
              return i;
            }
          }

          return -1;
        };
      }

      function daysInMonth(year, month) {
        if (isNaN(year) || isNaN(month)) {
          return NaN;
        }

        var modMonth = mod(month, 12);
        year += (month - modMonth) / 12;
        return modMonth === 1 ? isLeapYear(year) ? 29 : 28 : 31 - modMonth % 7 % 2;
      } // FORMATTING


      addFormatToken('M', ['MM', 2], 'Mo', function () {
        return this.month() + 1;
      });
      addFormatToken('MMM', 0, 0, function (format) {
        return this.localeData().monthsShort(this, format);
      });
      addFormatToken('MMMM', 0, 0, function (format) {
        return this.localeData().months(this, format);
      }); // ALIASES

      addUnitAlias('month', 'M'); // PRIORITY

      addUnitPriority('month', 8); // PARSING

      addRegexToken('M', match1to2);
      addRegexToken('MM', match1to2, match2);
      addRegexToken('MMM', function (isStrict, locale) {
        return locale.monthsShortRegex(isStrict);
      });
      addRegexToken('MMMM', function (isStrict, locale) {
        return locale.monthsRegex(isStrict);
      });
      addParseToken(['M', 'MM'], function (input, array) {
        array[MONTH] = toInt(input) - 1;
      });
      addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {
        var month = config._locale.monthsParse(input, token, config._strict); // if we didn't find a month name, mark the date as invalid.


        if (month != null) {
          array[MONTH] = month;
        } else {
          getParsingFlags(config).invalidMonth = input;
        }
      }); // LOCALES

      var MONTHS_IN_FORMAT = /D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;
      var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_');

      function localeMonths(m, format) {
        if (!m) {
          return isArray(this._months) ? this._months : this._months['standalone'];
        }

        return isArray(this._months) ? this._months[m.month()] : this._months[(this._months.isFormat || MONTHS_IN_FORMAT).test(format) ? 'format' : 'standalone'][m.month()];
      }

      var defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');

      function localeMonthsShort(m, format) {
        if (!m) {
          return isArray(this._monthsShort) ? this._monthsShort : this._monthsShort['standalone'];
        }

        return isArray(this._monthsShort) ? this._monthsShort[m.month()] : this._monthsShort[MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'][m.month()];
      }

      function handleStrictParse(monthName, format, strict) {
        var i,
            ii,
            mom,
            llc = monthName.toLocaleLowerCase();

        if (!this._monthsParse) {
          // this is not used
          this._monthsParse = [];
          this._longMonthsParse = [];
          this._shortMonthsParse = [];

          for (i = 0; i < 12; ++i) {
            mom = createUTC([2000, i]);
            this._shortMonthsParse[i] = this.monthsShort(mom, '').toLocaleLowerCase();
            this._longMonthsParse[i] = this.months(mom, '').toLocaleLowerCase();
          }
        }

        if (strict) {
          if (format === 'MMM') {
            ii = indexOf.call(this._shortMonthsParse, llc);
            return ii !== -1 ? ii : null;
          } else {
            ii = indexOf.call(this._longMonthsParse, llc);
            return ii !== -1 ? ii : null;
          }
        } else {
          if (format === 'MMM') {
            ii = indexOf.call(this._shortMonthsParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._longMonthsParse, llc);
            return ii !== -1 ? ii : null;
          } else {
            ii = indexOf.call(this._longMonthsParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._shortMonthsParse, llc);
            return ii !== -1 ? ii : null;
          }
        }
      }

      function localeMonthsParse(monthName, format, strict) {
        var i, mom, regex;

        if (this._monthsParseExact) {
          return handleStrictParse.call(this, monthName, format, strict);
        }

        if (!this._monthsParse) {
          this._monthsParse = [];
          this._longMonthsParse = [];
          this._shortMonthsParse = [];
        } // TODO: add sorting
        // Sorting makes sure if one month (or abbr) is a prefix of another
        // see sorting in computeMonthsParse


        for (i = 0; i < 12; i++) {
          // make the regex if we don't have it already
          mom = createUTC([2000, i]);

          if (strict && !this._longMonthsParse[i]) {
            this._longMonthsParse[i] = new RegExp('^' + this.months(mom, '').replace('.', '') + '$', 'i');
            this._shortMonthsParse[i] = new RegExp('^' + this.monthsShort(mom, '').replace('.', '') + '$', 'i');
          }

          if (!strict && !this._monthsParse[i]) {
            regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
            this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
          } // test the regex


          if (strict && format === 'MMMM' && this._longMonthsParse[i].test(monthName)) {
            return i;
          } else if (strict && format === 'MMM' && this._shortMonthsParse[i].test(monthName)) {
            return i;
          } else if (!strict && this._monthsParse[i].test(monthName)) {
            return i;
          }
        }
      } // MOMENTS


      function setMonth(mom, value) {
        var dayOfMonth;

        if (!mom.isValid()) {
          // No op
          return mom;
        }

        if (typeof value === 'string') {
          if (/^\d+$/.test(value)) {
            value = toInt(value);
          } else {
            value = mom.localeData().monthsParse(value); // TODO: Another silent failure?

            if (!isNumber(value)) {
              return mom;
            }
          }
        }

        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));

        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);

        return mom;
      }

      function getSetMonth(value) {
        if (value != null) {
          setMonth(this, value);
          hooks.updateOffset(this, true);
          return this;
        } else {
          return get(this, 'Month');
        }
      }

      function getDaysInMonth() {
        return daysInMonth(this.year(), this.month());
      }

      var defaultMonthsShortRegex = matchWord;

      function monthsShortRegex(isStrict) {
        if (this._monthsParseExact) {
          if (!hasOwnProp(this, '_monthsRegex')) {
            computeMonthsParse.call(this);
          }

          if (isStrict) {
            return this._monthsShortStrictRegex;
          } else {
            return this._monthsShortRegex;
          }
        } else {
          if (!hasOwnProp(this, '_monthsShortRegex')) {
            this._monthsShortRegex = defaultMonthsShortRegex;
          }

          return this._monthsShortStrictRegex && isStrict ? this._monthsShortStrictRegex : this._monthsShortRegex;
        }
      }

      var defaultMonthsRegex = matchWord;

      function monthsRegex(isStrict) {
        if (this._monthsParseExact) {
          if (!hasOwnProp(this, '_monthsRegex')) {
            computeMonthsParse.call(this);
          }

          if (isStrict) {
            return this._monthsStrictRegex;
          } else {
            return this._monthsRegex;
          }
        } else {
          if (!hasOwnProp(this, '_monthsRegex')) {
            this._monthsRegex = defaultMonthsRegex;
          }

          return this._monthsStrictRegex && isStrict ? this._monthsStrictRegex : this._monthsRegex;
        }
      }

      function computeMonthsParse() {
        function cmpLenRev(a, b) {
          return b.length - a.length;
        }

        var shortPieces = [],
            longPieces = [],
            mixedPieces = [],
            i,
            mom;

        for (i = 0; i < 12; i++) {
          // make the regex if we don't have it already
          mom = createUTC([2000, i]);
          shortPieces.push(this.monthsShort(mom, ''));
          longPieces.push(this.months(mom, ''));
          mixedPieces.push(this.months(mom, ''));
          mixedPieces.push(this.monthsShort(mom, ''));
        } // Sorting makes sure if one month (or abbr) is a prefix of another it
        // will match the longer piece.


        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);

        for (i = 0; i < 12; i++) {
          shortPieces[i] = regexEscape(shortPieces[i]);
          longPieces[i] = regexEscape(longPieces[i]);
        }

        for (i = 0; i < 24; i++) {
          mixedPieces[i] = regexEscape(mixedPieces[i]);
        }

        this._monthsRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._monthsShortRegex = this._monthsRegex;
        this._monthsStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');
        this._monthsShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');
      }

      function createDate(y, m, d, h, M, s, ms) {
        // can't just apply() to create a date:
        // https://stackoverflow.com/q/181348
        var date = new Date(y, m, d, h, M, s, ms); // the date constructor remaps years 0-99 to 1900-1999

        if (y < 100 && y >= 0 && isFinite(date.getFullYear())) {
          date.setFullYear(y);
        }

        return date;
      }

      function createUTCDate(y) {
        var date = new Date(Date.UTC.apply(null, arguments)); // the Date.UTC function remaps years 0-99 to 1900-1999

        if (y < 100 && y >= 0 && isFinite(date.getUTCFullYear())) {
          date.setUTCFullYear(y);
        }

        return date;
      } // start-of-first-week - start-of-year


      function firstWeekOffset(year, dow, doy) {
        var // first-week day -- which january is always in the first week (4 for iso, 1 for other)
        fwd = 7 + dow - doy,
            // first-week day local weekday -- which local weekday is fwd
        fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;
        return -fwdlw + fwd - 1;
      } // https://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday


      function dayOfYearFromWeeks(year, week, weekday, dow, doy) {
        var localWeekday = (7 + weekday - dow) % 7,
            weekOffset = firstWeekOffset(year, dow, doy),
            dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset,
            resYear,
            resDayOfYear;

        if (dayOfYear <= 0) {
          resYear = year - 1;
          resDayOfYear = daysInYear(resYear) + dayOfYear;
        } else if (dayOfYear > daysInYear(year)) {
          resYear = year + 1;
          resDayOfYear = dayOfYear - daysInYear(year);
        } else {
          resYear = year;
          resDayOfYear = dayOfYear;
        }

        return {
          year: resYear,
          dayOfYear: resDayOfYear
        };
      }

      function weekOfYear(mom, dow, doy) {
        var weekOffset = firstWeekOffset(mom.year(), dow, doy),
            week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1,
            resWeek,
            resYear;

        if (week < 1) {
          resYear = mom.year() - 1;
          resWeek = week + weeksInYear(resYear, dow, doy);
        } else if (week > weeksInYear(mom.year(), dow, doy)) {
          resWeek = week - weeksInYear(mom.year(), dow, doy);
          resYear = mom.year() + 1;
        } else {
          resYear = mom.year();
          resWeek = week;
        }

        return {
          week: resWeek,
          year: resYear
        };
      }

      function weeksInYear(year, dow, doy) {
        var weekOffset = firstWeekOffset(year, dow, doy),
            weekOffsetNext = firstWeekOffset(year + 1, dow, doy);
        return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;
      } // FORMATTING


      addFormatToken('w', ['ww', 2], 'wo', 'week');
      addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek'); // ALIASES

      addUnitAlias('week', 'w');
      addUnitAlias('isoWeek', 'W'); // PRIORITIES

      addUnitPriority('week', 5);
      addUnitPriority('isoWeek', 5); // PARSING

      addRegexToken('w', match1to2);
      addRegexToken('ww', match1to2, match2);
      addRegexToken('W', match1to2);
      addRegexToken('WW', match1to2, match2);
      addWeekParseToken(['w', 'ww', 'W', 'WW'], function (input, week, config, token) {
        week[token.substr(0, 1)] = toInt(input);
      }); // HELPERS
      // LOCALES

      function localeWeek(mom) {
        return weekOfYear(mom, this._week.dow, this._week.doy).week;
      }

      var defaultLocaleWeek = {
        dow: 0,
        // Sunday is the first day of the week.
        doy: 6 // The week that contains Jan 6th is the first week of the year.

      };

      function localeFirstDayOfWeek() {
        return this._week.dow;
      }

      function localeFirstDayOfYear() {
        return this._week.doy;
      } // MOMENTS


      function getSetWeek(input) {
        var week = this.localeData().week(this);
        return input == null ? week : this.add((input - week) * 7, 'd');
      }

      function getSetISOWeek(input) {
        var week = weekOfYear(this, 1, 4).week;
        return input == null ? week : this.add((input - week) * 7, 'd');
      } // FORMATTING


      addFormatToken('d', 0, 'do', 'day');
      addFormatToken('dd', 0, 0, function (format) {
        return this.localeData().weekdaysMin(this, format);
      });
      addFormatToken('ddd', 0, 0, function (format) {
        return this.localeData().weekdaysShort(this, format);
      });
      addFormatToken('dddd', 0, 0, function (format) {
        return this.localeData().weekdays(this, format);
      });
      addFormatToken('e', 0, 0, 'weekday');
      addFormatToken('E', 0, 0, 'isoWeekday'); // ALIASES

      addUnitAlias('day', 'd');
      addUnitAlias('weekday', 'e');
      addUnitAlias('isoWeekday', 'E'); // PRIORITY

      addUnitPriority('day', 11);
      addUnitPriority('weekday', 11);
      addUnitPriority('isoWeekday', 11); // PARSING

      addRegexToken('d', match1to2);
      addRegexToken('e', match1to2);
      addRegexToken('E', match1to2);
      addRegexToken('dd', function (isStrict, locale) {
        return locale.weekdaysMinRegex(isStrict);
      });
      addRegexToken('ddd', function (isStrict, locale) {
        return locale.weekdaysShortRegex(isStrict);
      });
      addRegexToken('dddd', function (isStrict, locale) {
        return locale.weekdaysRegex(isStrict);
      });
      addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config, token) {
        var weekday = config._locale.weekdaysParse(input, token, config._strict); // if we didn't get a weekday name, mark the date as invalid


        if (weekday != null) {
          week.d = weekday;
        } else {
          getParsingFlags(config).invalidWeekday = input;
        }
      });
      addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {
        week[token] = toInt(input);
      }); // HELPERS

      function parseWeekday(input, locale) {
        if (typeof input !== 'string') {
          return input;
        }

        if (!isNaN(input)) {
          return parseInt(input, 10);
        }

        input = locale.weekdaysParse(input);

        if (typeof input === 'number') {
          return input;
        }

        return null;
      }

      function parseIsoWeekday(input, locale) {
        if (typeof input === 'string') {
          return locale.weekdaysParse(input) % 7 || 7;
        }

        return isNaN(input) ? null : input;
      } // LOCALES


      var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');

      function localeWeekdays(m, format) {
        if (!m) {
          return isArray(this._weekdays) ? this._weekdays : this._weekdays['standalone'];
        }

        return isArray(this._weekdays) ? this._weekdays[m.day()] : this._weekdays[this._weekdays.isFormat.test(format) ? 'format' : 'standalone'][m.day()];
      }

      var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');

      function localeWeekdaysShort(m) {
        return m ? this._weekdaysShort[m.day()] : this._weekdaysShort;
      }

      var defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_');

      function localeWeekdaysMin(m) {
        return m ? this._weekdaysMin[m.day()] : this._weekdaysMin;
      }

      function handleStrictParse$1(weekdayName, format, strict) {
        var i,
            ii,
            mom,
            llc = weekdayName.toLocaleLowerCase();

        if (!this._weekdaysParse) {
          this._weekdaysParse = [];
          this._shortWeekdaysParse = [];
          this._minWeekdaysParse = [];

          for (i = 0; i < 7; ++i) {
            mom = createUTC([2000, 1]).day(i);
            this._minWeekdaysParse[i] = this.weekdaysMin(mom, '').toLocaleLowerCase();
            this._shortWeekdaysParse[i] = this.weekdaysShort(mom, '').toLocaleLowerCase();
            this._weekdaysParse[i] = this.weekdays(mom, '').toLocaleLowerCase();
          }
        }

        if (strict) {
          if (format === 'dddd') {
            ii = indexOf.call(this._weekdaysParse, llc);
            return ii !== -1 ? ii : null;
          } else if (format === 'ddd') {
            ii = indexOf.call(this._shortWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
          } else {
            ii = indexOf.call(this._minWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
          }
        } else {
          if (format === 'dddd') {
            ii = indexOf.call(this._weekdaysParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._shortWeekdaysParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._minWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
          } else if (format === 'ddd') {
            ii = indexOf.call(this._shortWeekdaysParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._weekdaysParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._minWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
          } else {
            ii = indexOf.call(this._minWeekdaysParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._weekdaysParse, llc);

            if (ii !== -1) {
              return ii;
            }

            ii = indexOf.call(this._shortWeekdaysParse, llc);
            return ii !== -1 ? ii : null;
          }
        }
      }

      function localeWeekdaysParse(weekdayName, format, strict) {
        var i, mom, regex;

        if (this._weekdaysParseExact) {
          return handleStrictParse$1.call(this, weekdayName, format, strict);
        }

        if (!this._weekdaysParse) {
          this._weekdaysParse = [];
          this._minWeekdaysParse = [];
          this._shortWeekdaysParse = [];
          this._fullWeekdaysParse = [];
        }

        for (i = 0; i < 7; i++) {
          // make the regex if we don't have it already
          mom = createUTC([2000, 1]).day(i);

          if (strict && !this._fullWeekdaysParse[i]) {
            this._fullWeekdaysParse[i] = new RegExp('^' + this.weekdays(mom, '').replace('.', '\\.?') + '$', 'i');
            this._shortWeekdaysParse[i] = new RegExp('^' + this.weekdaysShort(mom, '').replace('.', '\\.?') + '$', 'i');
            this._minWeekdaysParse[i] = new RegExp('^' + this.weekdaysMin(mom, '').replace('.', '\\.?') + '$', 'i');
          }

          if (!this._weekdaysParse[i]) {
            regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');
            this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
          } // test the regex


          if (strict && format === 'dddd' && this._fullWeekdaysParse[i].test(weekdayName)) {
            return i;
          } else if (strict && format === 'ddd' && this._shortWeekdaysParse[i].test(weekdayName)) {
            return i;
          } else if (strict && format === 'dd' && this._minWeekdaysParse[i].test(weekdayName)) {
            return i;
          } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {
            return i;
          }
        }
      } // MOMENTS


      function getSetDayOfWeek(input) {
        if (!this.isValid()) {
          return input != null ? this : NaN;
        }

        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();

        if (input != null) {
          input = parseWeekday(input, this.localeData());
          return this.add(input - day, 'd');
        } else {
          return day;
        }
      }

      function getSetLocaleDayOfWeek(input) {
        if (!this.isValid()) {
          return input != null ? this : NaN;
        }

        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return input == null ? weekday : this.add(input - weekday, 'd');
      }

      function getSetISODayOfWeek(input) {
        if (!this.isValid()) {
          return input != null ? this : NaN;
        } // behaves the same as moment#day except
        // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
        // as a setter, sunday should belong to the previous week.


        if (input != null) {
          var weekday = parseIsoWeekday(input, this.localeData());
          return this.day(this.day() % 7 ? weekday : weekday - 7);
        } else {
          return this.day() || 7;
        }
      }

      var defaultWeekdaysRegex = matchWord;

      function weekdaysRegex(isStrict) {
        if (this._weekdaysParseExact) {
          if (!hasOwnProp(this, '_weekdaysRegex')) {
            computeWeekdaysParse.call(this);
          }

          if (isStrict) {
            return this._weekdaysStrictRegex;
          } else {
            return this._weekdaysRegex;
          }
        } else {
          if (!hasOwnProp(this, '_weekdaysRegex')) {
            this._weekdaysRegex = defaultWeekdaysRegex;
          }

          return this._weekdaysStrictRegex && isStrict ? this._weekdaysStrictRegex : this._weekdaysRegex;
        }
      }

      var defaultWeekdaysShortRegex = matchWord;

      function weekdaysShortRegex(isStrict) {
        if (this._weekdaysParseExact) {
          if (!hasOwnProp(this, '_weekdaysRegex')) {
            computeWeekdaysParse.call(this);
          }

          if (isStrict) {
            return this._weekdaysShortStrictRegex;
          } else {
            return this._weekdaysShortRegex;
          }
        } else {
          if (!hasOwnProp(this, '_weekdaysShortRegex')) {
            this._weekdaysShortRegex = defaultWeekdaysShortRegex;
          }

          return this._weekdaysShortStrictRegex && isStrict ? this._weekdaysShortStrictRegex : this._weekdaysShortRegex;
        }
      }

      var defaultWeekdaysMinRegex = matchWord;

      function weekdaysMinRegex(isStrict) {
        if (this._weekdaysParseExact) {
          if (!hasOwnProp(this, '_weekdaysRegex')) {
            computeWeekdaysParse.call(this);
          }

          if (isStrict) {
            return this._weekdaysMinStrictRegex;
          } else {
            return this._weekdaysMinRegex;
          }
        } else {
          if (!hasOwnProp(this, '_weekdaysMinRegex')) {
            this._weekdaysMinRegex = defaultWeekdaysMinRegex;
          }

          return this._weekdaysMinStrictRegex && isStrict ? this._weekdaysMinStrictRegex : this._weekdaysMinRegex;
        }
      }

      function computeWeekdaysParse() {
        function cmpLenRev(a, b) {
          return b.length - a.length;
        }

        var minPieces = [],
            shortPieces = [],
            longPieces = [],
            mixedPieces = [],
            i,
            mom,
            minp,
            shortp,
            longp;

        for (i = 0; i < 7; i++) {
          // make the regex if we don't have it already
          mom = createUTC([2000, 1]).day(i);
          minp = this.weekdaysMin(mom, '');
          shortp = this.weekdaysShort(mom, '');
          longp = this.weekdays(mom, '');
          minPieces.push(minp);
          shortPieces.push(shortp);
          longPieces.push(longp);
          mixedPieces.push(minp);
          mixedPieces.push(shortp);
          mixedPieces.push(longp);
        } // Sorting makes sure if one weekday (or abbr) is a prefix of another it
        // will match the longer piece.


        minPieces.sort(cmpLenRev);
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);

        for (i = 0; i < 7; i++) {
          shortPieces[i] = regexEscape(shortPieces[i]);
          longPieces[i] = regexEscape(longPieces[i]);
          mixedPieces[i] = regexEscape(mixedPieces[i]);
        }

        this._weekdaysRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._weekdaysShortRegex = this._weekdaysRegex;
        this._weekdaysMinRegex = this._weekdaysRegex;
        this._weekdaysStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');
        this._weekdaysShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');
        this._weekdaysMinStrictRegex = new RegExp('^(' + minPieces.join('|') + ')', 'i');
      } // FORMATTING


      function hFormat() {
        return this.hours() % 12 || 12;
      }

      function kFormat() {
        return this.hours() || 24;
      }

      addFormatToken('H', ['HH', 2], 0, 'hour');
      addFormatToken('h', ['hh', 2], 0, hFormat);
      addFormatToken('k', ['kk', 2], 0, kFormat);
      addFormatToken('hmm', 0, 0, function () {
        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2);
      });
      addFormatToken('hmmss', 0, 0, function () {
        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2) + zeroFill(this.seconds(), 2);
      });
      addFormatToken('Hmm', 0, 0, function () {
        return '' + this.hours() + zeroFill(this.minutes(), 2);
      });
      addFormatToken('Hmmss', 0, 0, function () {
        return '' + this.hours() + zeroFill(this.minutes(), 2) + zeroFill(this.seconds(), 2);
      });

      function meridiem(token, lowercase) {
        addFormatToken(token, 0, 0, function () {
          return this.localeData().meridiem(this.hours(), this.minutes(), lowercase);
        });
      }

      meridiem('a', true);
      meridiem('A', false); // ALIASES

      addUnitAlias('hour', 'h'); // PRIORITY

      addUnitPriority('hour', 13); // PARSING

      function matchMeridiem(isStrict, locale) {
        return locale._meridiemParse;
      }

      addRegexToken('a', matchMeridiem);
      addRegexToken('A', matchMeridiem);
      addRegexToken('H', match1to2);
      addRegexToken('h', match1to2);
      addRegexToken('k', match1to2);
      addRegexToken('HH', match1to2, match2);
      addRegexToken('hh', match1to2, match2);
      addRegexToken('kk', match1to2, match2);
      addRegexToken('hmm', match3to4);
      addRegexToken('hmmss', match5to6);
      addRegexToken('Hmm', match3to4);
      addRegexToken('Hmmss', match5to6);
      addParseToken(['H', 'HH'], HOUR);
      addParseToken(['k', 'kk'], function (input, array, config) {
        var kInput = toInt(input);
        array[HOUR] = kInput === 24 ? 0 : kInput;
      });
      addParseToken(['a', 'A'], function (input, array, config) {
        config._isPm = config._locale.isPM(input);
        config._meridiem = input;
      });
      addParseToken(['h', 'hh'], function (input, array, config) {
        array[HOUR] = toInt(input);
        getParsingFlags(config).bigHour = true;
      });
      addParseToken('hmm', function (input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
        getParsingFlags(config).bigHour = true;
      });
      addParseToken('hmmss', function (input, array, config) {
        var pos1 = input.length - 4;
        var pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
        getParsingFlags(config).bigHour = true;
      });
      addParseToken('Hmm', function (input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
      });
      addParseToken('Hmmss', function (input, array, config) {
        var pos1 = input.length - 4;
        var pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
      }); // LOCALES

      function localeIsPM(input) {
        // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
        // Using charAt should be more compatible.
        return (input + '').toLowerCase().charAt(0) === 'p';
      }

      var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i;

      function localeMeridiem(hours, minutes, isLower) {
        if (hours > 11) {
          return isLower ? 'pm' : 'PM';
        } else {
          return isLower ? 'am' : 'AM';
        }
      } // MOMENTS
      // Setting the hour should keep the time, because the user explicitly
      // specified which hour they want. So trying to maintain the same hour (in
      // a new timezone) makes sense. Adding/subtracting hours does not follow
      // this rule.


      var getSetHour = makeGetSet('Hours', true);
      var baseConfig = {
        calendar: defaultCalendar,
        longDateFormat: defaultLongDateFormat,
        invalidDate: defaultInvalidDate,
        ordinal: defaultOrdinal,
        dayOfMonthOrdinalParse: defaultDayOfMonthOrdinalParse,
        relativeTime: defaultRelativeTime,
        months: defaultLocaleMonths,
        monthsShort: defaultLocaleMonthsShort,
        week: defaultLocaleWeek,
        weekdays: defaultLocaleWeekdays,
        weekdaysMin: defaultLocaleWeekdaysMin,
        weekdaysShort: defaultLocaleWeekdaysShort,
        meridiemParse: defaultLocaleMeridiemParse
      }; // internal storage for locale config files

      var locales = {};
      var localeFamilies = {};
      var globalLocale;

      function normalizeLocale(key) {
        return key ? key.toLowerCase().replace('_', '-') : key;
      } // pick the locale from the array
      // try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
      // substring from most specific to least, but move to the next array item if it's a more specific variant than the current root


      function chooseLocale(names) {
        var i = 0,
            j,
            next,
            locale,
            split;

        while (i < names.length) {
          split = normalizeLocale(names[i]).split('-');
          j = split.length;
          next = normalizeLocale(names[i + 1]);
          next = next ? next.split('-') : null;

          while (j > 0) {
            locale = loadLocale(split.slice(0, j).join('-'));

            if (locale) {
              return locale;
            }

            if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
              //the next array item is better than a shallower substring of this one
              break;
            }

            j--;
          }

          i++;
        }

        return globalLocale;
      }

      function loadLocale(name) {
        var oldLocale = null; // TODO: Find a better way to register and load all the locales in Node

        if (!locales[name] && 'object' !== 'undefined' && module && module.exports) {
          try {
            oldLocale = globalLocale._abbr;
            var aliasedRequire = commonjsRequire$1;
            aliasedRequire('./locale/' + name);
            getSetGlobalLocale(oldLocale);
          } catch (e) {}
        }

        return locales[name];
      } // This function will load locale and then set the global locale.  If
      // no arguments are passed in, it will simply return the current global
      // locale key.


      function getSetGlobalLocale(key, values) {
        var data;

        if (key) {
          if (isUndefined(values)) {
            data = getLocale(key);
          } else {
            data = defineLocale(key, values);
          }

          if (data) {
            // moment.duration._locale = moment._locale = data;
            globalLocale = data;
          } else {
            if (typeof console !== 'undefined' && console.warn) {
              //warn user if arguments are passed but the locale could not be set
              console.warn('Locale ' + key + ' not found. Did you forget to load it?');
            }
          }
        }

        return globalLocale._abbr;
      }

      function defineLocale(name, config) {
        if (config !== null) {
          var locale,
              parentConfig = baseConfig;
          config.abbr = name;

          if (locales[name] != null) {
            deprecateSimple('defineLocaleOverride', 'use moment.updateLocale(localeName, config) to change ' + 'an existing locale. moment.defineLocale(localeName, ' + 'config) should only be used for creating a new locale ' + 'See http://momentjs.com/guides/#/warnings/define-locale/ for more info.');
            parentConfig = locales[name]._config;
          } else if (config.parentLocale != null) {
            if (locales[config.parentLocale] != null) {
              parentConfig = locales[config.parentLocale]._config;
            } else {
              locale = loadLocale(config.parentLocale);

              if (locale != null) {
                parentConfig = locale._config;
              } else {
                if (!localeFamilies[config.parentLocale]) {
                  localeFamilies[config.parentLocale] = [];
                }

                localeFamilies[config.parentLocale].push({
                  name: name,
                  config: config
                });
                return null;
              }
            }
          }

          locales[name] = new Locale(mergeConfigs(parentConfig, config));

          if (localeFamilies[name]) {
            localeFamilies[name].forEach(function (x) {
              defineLocale(x.name, x.config);
            });
          } // backwards compat for now: also set the locale
          // make sure we set the locale AFTER all child locales have been
          // created, so we won't end up with the child locale set.


          getSetGlobalLocale(name);
          return locales[name];
        } else {
          // useful for testing
          delete locales[name];
          return null;
        }
      }

      function updateLocale(name, config) {
        if (config != null) {
          var locale,
              tmpLocale,
              parentConfig = baseConfig; // MERGE

          tmpLocale = loadLocale(name);

          if (tmpLocale != null) {
            parentConfig = tmpLocale._config;
          }

          config = mergeConfigs(parentConfig, config);
          locale = new Locale(config);
          locale.parentLocale = locales[name];
          locales[name] = locale; // backwards compat for now: also set the locale

          getSetGlobalLocale(name);
        } else {
          // pass null for config to unupdate, useful for tests
          if (locales[name] != null) {
            if (locales[name].parentLocale != null) {
              locales[name] = locales[name].parentLocale;
            } else if (locales[name] != null) {
              delete locales[name];
            }
          }
        }

        return locales[name];
      } // returns locale data


      function getLocale(key) {
        var locale;

        if (key && key._locale && key._locale._abbr) {
          key = key._locale._abbr;
        }

        if (!key) {
          return globalLocale;
        }

        if (!isArray(key)) {
          //short-circuit everything else
          locale = loadLocale(key);

          if (locale) {
            return locale;
          }

          key = [key];
        }

        return chooseLocale(key);
      }

      function listLocales() {
        return keys(locales);
      }

      function checkOverflow(m) {
        var overflow;
        var a = m._a;

        if (a && getParsingFlags(m).overflow === -2) {
          overflow = a[MONTH] < 0 || a[MONTH] > 11 ? MONTH : a[DATE] < 1 || a[DATE] > daysInMonth(a[YEAR], a[MONTH]) ? DATE : a[HOUR] < 0 || a[HOUR] > 24 || a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0) ? HOUR : a[MINUTE] < 0 || a[MINUTE] > 59 ? MINUTE : a[SECOND] < 0 || a[SECOND] > 59 ? SECOND : a[MILLISECOND] < 0 || a[MILLISECOND] > 999 ? MILLISECOND : -1;

          if (getParsingFlags(m)._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {
            overflow = DATE;
          }

          if (getParsingFlags(m)._overflowWeeks && overflow === -1) {
            overflow = WEEK;
          }

          if (getParsingFlags(m)._overflowWeekday && overflow === -1) {
            overflow = WEEKDAY;
          }

          getParsingFlags(m).overflow = overflow;
        }

        return m;
      } // Pick the first defined of two or three arguments.


      function defaults(a, b, c) {
        if (a != null) {
          return a;
        }

        if (b != null) {
          return b;
        }

        return c;
      }

      function currentDateArray(config) {
        // hooks is actually the exported moment object
        var nowValue = new Date(hooks.now());

        if (config._useUTC) {
          return [nowValue.getUTCFullYear(), nowValue.getUTCMonth(), nowValue.getUTCDate()];
        }

        return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()];
      } // convert an array to a date.
      // the array should mirror the parameters below
      // note: all values past the year are optional and will default to the lowest possible value.
      // [year, month, day , hour, minute, second, millisecond]


      function configFromArray(config) {
        var i,
            date,
            input = [],
            currentDate,
            expectedWeekday,
            yearToUse;

        if (config._d) {
          return;
        }

        currentDate = currentDateArray(config); //compute day of the year from weeks and weekdays

        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
          dayOfYearFromWeekInfo(config);
        } //if the day of the year is set, figure out what it is


        if (config._dayOfYear != null) {
          yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);

          if (config._dayOfYear > daysInYear(yearToUse) || config._dayOfYear === 0) {
            getParsingFlags(config)._overflowDayOfYear = true;
          }

          date = createUTCDate(yearToUse, 0, config._dayOfYear);
          config._a[MONTH] = date.getUTCMonth();
          config._a[DATE] = date.getUTCDate();
        } // Default to current date.
        // * if no year, month, day of month are given, default to today
        // * if day of month is given, default month and year
        // * if month is given, default only year
        // * if year is given, don't default anything


        for (i = 0; i < 3 && config._a[i] == null; ++i) {
          config._a[i] = input[i] = currentDate[i];
        } // Zero out whatever was not defaulted, including time


        for (; i < 7; i++) {
          config._a[i] = input[i] = config._a[i] == null ? i === 2 ? 1 : 0 : config._a[i];
        } // Check for 24:00:00.000


        if (config._a[HOUR] === 24 && config._a[MINUTE] === 0 && config._a[SECOND] === 0 && config._a[MILLISECOND] === 0) {
          config._nextDay = true;
          config._a[HOUR] = 0;
        }

        config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);
        expectedWeekday = config._useUTC ? config._d.getUTCDay() : config._d.getDay(); // Apply timezone offset from input. The actual utcOffset can be changed
        // with parseZone.

        if (config._tzm != null) {
          config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
        }

        if (config._nextDay) {
          config._a[HOUR] = 24;
        } // check for mismatching day of week


        if (config._w && typeof config._w.d !== 'undefined' && config._w.d !== expectedWeekday) {
          getParsingFlags(config).weekdayMismatch = true;
        }
      }

      function dayOfYearFromWeekInfo(config) {
        var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow;
        w = config._w;

        if (w.GG != null || w.W != null || w.E != null) {
          dow = 1;
          doy = 4; // TODO: We need to take the current isoWeekYear, but that depends on
          // how we interpret now (local, utc, fixed offset). So create
          // a now version of current config (take local/utc/offset flags, and
          // create now).

          weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(createLocal(), 1, 4).year);
          week = defaults(w.W, 1);
          weekday = defaults(w.E, 1);

          if (weekday < 1 || weekday > 7) {
            weekdayOverflow = true;
          }
        } else {
          dow = config._locale._week.dow;
          doy = config._locale._week.doy;
          var curWeek = weekOfYear(createLocal(), dow, doy);
          weekYear = defaults(w.gg, config._a[YEAR], curWeek.year); // Default to current week.

          week = defaults(w.w, curWeek.week);

          if (w.d != null) {
            // weekday -- low day numbers are considered next week
            weekday = w.d;

            if (weekday < 0 || weekday > 6) {
              weekdayOverflow = true;
            }
          } else if (w.e != null) {
            // local weekday -- counting starts from beginning of week
            weekday = w.e + dow;

            if (w.e < 0 || w.e > 6) {
              weekdayOverflow = true;
            }
          } else {
            // default to beginning of week
            weekday = dow;
          }
        }

        if (week < 1 || week > weeksInYear(weekYear, dow, doy)) {
          getParsingFlags(config)._overflowWeeks = true;
        } else if (weekdayOverflow != null) {
          getParsingFlags(config)._overflowWeekday = true;
        } else {
          temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);
          config._a[YEAR] = temp.year;
          config._dayOfYear = temp.dayOfYear;
        }
      } // iso 8601 regex
      // 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)


      var extendedIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;
      var basicIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;
      var tzRegex = /Z|[+-]\d\d(?::?\d\d)?/;
      var isoDates = [['YYYYYY-MM-DD', /[+-]\d{6}-\d\d-\d\d/], ['YYYY-MM-DD', /\d{4}-\d\d-\d\d/], ['GGGG-[W]WW-E', /\d{4}-W\d\d-\d/], ['GGGG-[W]WW', /\d{4}-W\d\d/, false], ['YYYY-DDD', /\d{4}-\d{3}/], ['YYYY-MM', /\d{4}-\d\d/, false], ['YYYYYYMMDD', /[+-]\d{10}/], ['YYYYMMDD', /\d{8}/], // YYYYMM is NOT allowed by the standard
      ['GGGG[W]WWE', /\d{4}W\d{3}/], ['GGGG[W]WW', /\d{4}W\d{2}/, false], ['YYYYDDD', /\d{7}/]]; // iso time formats and regexes

      var isoTimes = [['HH:mm:ss.SSSS', /\d\d:\d\d:\d\d\.\d+/], ['HH:mm:ss,SSSS', /\d\d:\d\d:\d\d,\d+/], ['HH:mm:ss', /\d\d:\d\d:\d\d/], ['HH:mm', /\d\d:\d\d/], ['HHmmss.SSSS', /\d\d\d\d\d\d\.\d+/], ['HHmmss,SSSS', /\d\d\d\d\d\d,\d+/], ['HHmmss', /\d\d\d\d\d\d/], ['HHmm', /\d\d\d\d/], ['HH', /\d\d/]];
      var aspNetJsonRegex = /^\/?Date\((\-?\d+)/i; // date from iso format

      function configFromISO(config) {
        var i,
            l,
            string = config._i,
            match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string),
            allowTime,
            dateFormat,
            timeFormat,
            tzFormat;

        if (match) {
          getParsingFlags(config).iso = true;

          for (i = 0, l = isoDates.length; i < l; i++) {
            if (isoDates[i][1].exec(match[1])) {
              dateFormat = isoDates[i][0];
              allowTime = isoDates[i][2] !== false;
              break;
            }
          }

          if (dateFormat == null) {
            config._isValid = false;
            return;
          }

          if (match[3]) {
            for (i = 0, l = isoTimes.length; i < l; i++) {
              if (isoTimes[i][1].exec(match[3])) {
                // match[2] should be 'T' or space
                timeFormat = (match[2] || ' ') + isoTimes[i][0];
                break;
              }
            }

            if (timeFormat == null) {
              config._isValid = false;
              return;
            }
          }

          if (!allowTime && timeFormat != null) {
            config._isValid = false;
            return;
          }

          if (match[4]) {
            if (tzRegex.exec(match[4])) {
              tzFormat = 'Z';
            } else {
              config._isValid = false;
              return;
            }
          }

          config._f = dateFormat + (timeFormat || '') + (tzFormat || '');
          configFromStringAndFormat(config);
        } else {
          config._isValid = false;
        }
      } // RFC 2822 regex: For details see https://tools.ietf.org/html/rfc2822#section-3.3


      var rfc2822 = /^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;

      function extractFromRFC2822Strings(yearStr, monthStr, dayStr, hourStr, minuteStr, secondStr) {
        var result = [untruncateYear(yearStr), defaultLocaleMonthsShort.indexOf(monthStr), parseInt(dayStr, 10), parseInt(hourStr, 10), parseInt(minuteStr, 10)];

        if (secondStr) {
          result.push(parseInt(secondStr, 10));
        }

        return result;
      }

      function untruncateYear(yearStr) {
        var year = parseInt(yearStr, 10);

        if (year <= 49) {
          return 2000 + year;
        } else if (year <= 999) {
          return 1900 + year;
        }

        return year;
      }

      function preprocessRFC2822(s) {
        // Remove comments and folding whitespace and replace multiple-spaces with a single space
        return s.replace(/\([^)]*\)|[\n\t]/g, ' ').replace(/(\s\s+)/g, ' ').replace(/^\s\s*/, '').replace(/\s\s*$/, '');
      }

      function checkWeekday(weekdayStr, parsedInput, config) {
        if (weekdayStr) {
          // TODO: Replace the vanilla JS Date object with an indepentent day-of-week check.
          var weekdayProvided = defaultLocaleWeekdaysShort.indexOf(weekdayStr),
              weekdayActual = new Date(parsedInput[0], parsedInput[1], parsedInput[2]).getDay();

          if (weekdayProvided !== weekdayActual) {
            getParsingFlags(config).weekdayMismatch = true;
            config._isValid = false;
            return false;
          }
        }

        return true;
      }

      var obsOffsets = {
        UT: 0,
        GMT: 0,
        EDT: -4 * 60,
        EST: -5 * 60,
        CDT: -5 * 60,
        CST: -6 * 60,
        MDT: -6 * 60,
        MST: -7 * 60,
        PDT: -7 * 60,
        PST: -8 * 60
      };

      function calculateOffset(obsOffset, militaryOffset, numOffset) {
        if (obsOffset) {
          return obsOffsets[obsOffset];
        } else if (militaryOffset) {
          // the only allowed military tz is Z
          return 0;
        } else {
          var hm = parseInt(numOffset, 10);
          var m = hm % 100,
              h = (hm - m) / 100;
          return h * 60 + m;
        }
      } // date and time from ref 2822 format


      function configFromRFC2822(config) {
        var match = rfc2822.exec(preprocessRFC2822(config._i));

        if (match) {
          var parsedArray = extractFromRFC2822Strings(match[4], match[3], match[2], match[5], match[6], match[7]);

          if (!checkWeekday(match[1], parsedArray, config)) {
            return;
          }

          config._a = parsedArray;
          config._tzm = calculateOffset(match[8], match[9], match[10]);
          config._d = createUTCDate.apply(null, config._a);

          config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);

          getParsingFlags(config).rfc2822 = true;
        } else {
          config._isValid = false;
        }
      } // date from iso format or fallback


      function configFromString(config) {
        var matched = aspNetJsonRegex.exec(config._i);

        if (matched !== null) {
          config._d = new Date(+matched[1]);
          return;
        }

        configFromISO(config);

        if (config._isValid === false) {
          delete config._isValid;
        } else {
          return;
        }

        configFromRFC2822(config);

        if (config._isValid === false) {
          delete config._isValid;
        } else {
          return;
        } // Final attempt, use Input Fallback


        hooks.createFromInputFallback(config);
      }

      hooks.createFromInputFallback = deprecate('value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), ' + 'which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are ' + 'discouraged and will be removed in an upcoming major release. Please refer to ' + 'http://momentjs.com/guides/#/warnings/js-date/ for more info.', function (config) {
        config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));
      }); // constant that refers to the ISO standard

      hooks.ISO_8601 = function () {}; // constant that refers to the RFC 2822 form


      hooks.RFC_2822 = function () {}; // date from string and format string


      function configFromStringAndFormat(config) {
        // TODO: Move this to another part of the creation flow to prevent circular deps
        if (config._f === hooks.ISO_8601) {
          configFromISO(config);
          return;
        }

        if (config._f === hooks.RFC_2822) {
          configFromRFC2822(config);
          return;
        }

        config._a = [];
        getParsingFlags(config).empty = true; // This array is used to make a Date, either with `new Date` or `Date.UTC`

        var string = '' + config._i,
            i,
            parsedInput,
            tokens,
            token,
            skipped,
            stringLength = string.length,
            totalParsedInputLength = 0;
        tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];

        for (i = 0; i < tokens.length; i++) {
          token = tokens[i];
          parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0]; // console.log('token', token, 'parsedInput', parsedInput,
          //         'regex', getParseRegexForToken(token, config));

          if (parsedInput) {
            skipped = string.substr(0, string.indexOf(parsedInput));

            if (skipped.length > 0) {
              getParsingFlags(config).unusedInput.push(skipped);
            }

            string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
            totalParsedInputLength += parsedInput.length;
          } // don't parse if it's not a known token


          if (formatTokenFunctions[token]) {
            if (parsedInput) {
              getParsingFlags(config).empty = false;
            } else {
              getParsingFlags(config).unusedTokens.push(token);
            }

            addTimeToArrayFromToken(token, parsedInput, config);
          } else if (config._strict && !parsedInput) {
            getParsingFlags(config).unusedTokens.push(token);
          }
        } // add remaining unparsed input length to the string


        getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;

        if (string.length > 0) {
          getParsingFlags(config).unusedInput.push(string);
        } // clear _12h flag if hour is <= 12


        if (config._a[HOUR] <= 12 && getParsingFlags(config).bigHour === true && config._a[HOUR] > 0) {
          getParsingFlags(config).bigHour = undefined;
        }

        getParsingFlags(config).parsedDateParts = config._a.slice(0);
        getParsingFlags(config).meridiem = config._meridiem; // handle meridiem

        config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);
        configFromArray(config);
        checkOverflow(config);
      }

      function meridiemFixWrap(locale, hour, meridiem) {
        var isPm;

        if (meridiem == null) {
          // nothing to do
          return hour;
        }

        if (locale.meridiemHour != null) {
          return locale.meridiemHour(hour, meridiem);
        } else if (locale.isPM != null) {
          // Fallback
          isPm = locale.isPM(meridiem);

          if (isPm && hour < 12) {
            hour += 12;
          }

          if (!isPm && hour === 12) {
            hour = 0;
          }

          return hour;
        } else {
          // this is not supposed to happen
          return hour;
        }
      } // date from string and array of format strings


      function configFromStringAndArray(config) {
        var tempConfig, bestMoment, scoreToBeat, i, currentScore;

        if (config._f.length === 0) {
          getParsingFlags(config).invalidFormat = true;
          config._d = new Date(NaN);
          return;
        }

        for (i = 0; i < config._f.length; i++) {
          currentScore = 0;
          tempConfig = copyConfig({}, config);

          if (config._useUTC != null) {
            tempConfig._useUTC = config._useUTC;
          }

          tempConfig._f = config._f[i];
          configFromStringAndFormat(tempConfig);

          if (!isValid(tempConfig)) {
            continue;
          } // if there is any input that was not parsed add a penalty for that format


          currentScore += getParsingFlags(tempConfig).charsLeftOver; //or tokens

          currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;
          getParsingFlags(tempConfig).score = currentScore;

          if (scoreToBeat == null || currentScore < scoreToBeat) {
            scoreToBeat = currentScore;
            bestMoment = tempConfig;
          }
        }

        extend(config, bestMoment || tempConfig);
      }

      function configFromObject(config) {
        if (config._d) {
          return;
        }

        var i = normalizeObjectUnits(config._i);
        config._a = map([i.year, i.month, i.day || i.date, i.hour, i.minute, i.second, i.millisecond], function (obj) {
          return obj && parseInt(obj, 10);
        });
        configFromArray(config);
      }

      function createFromConfig(config) {
        var res = new Moment(checkOverflow(prepareConfig(config)));

        if (res._nextDay) {
          // Adding is smart enough around DST
          res.add(1, 'd');
          res._nextDay = undefined;
        }

        return res;
      }

      function prepareConfig(config) {
        var input = config._i,
            format = config._f;
        config._locale = config._locale || getLocale(config._l);

        if (input === null || format === undefined && input === '') {
          return createInvalid({
            nullInput: true
          });
        }

        if (typeof input === 'string') {
          config._i = input = config._locale.preparse(input);
        }

        if (isMoment(input)) {
          return new Moment(checkOverflow(input));
        } else if (isDate(input)) {
          config._d = input;
        } else if (isArray(format)) {
          configFromStringAndArray(config);
        } else if (format) {
          configFromStringAndFormat(config);
        } else {
          configFromInput(config);
        }

        if (!isValid(config)) {
          config._d = null;
        }

        return config;
      }

      function configFromInput(config) {
        var input = config._i;

        if (isUndefined(input)) {
          config._d = new Date(hooks.now());
        } else if (isDate(input)) {
          config._d = new Date(input.valueOf());
        } else if (typeof input === 'string') {
          configFromString(config);
        } else if (isArray(input)) {
          config._a = map(input.slice(0), function (obj) {
            return parseInt(obj, 10);
          });
          configFromArray(config);
        } else if (isObject(input)) {
          configFromObject(config);
        } else if (isNumber(input)) {
          // from milliseconds
          config._d = new Date(input);
        } else {
          hooks.createFromInputFallback(config);
        }
      }

      function createLocalOrUTC(input, format, locale, strict, isUTC) {
        var c = {};

        if (locale === true || locale === false) {
          strict = locale;
          locale = undefined;
        }

        if (isObject(input) && isObjectEmpty(input) || isArray(input) && input.length === 0) {
          input = undefined;
        } // object construction must be done this way.
        // https://github.com/moment/moment/issues/1423


        c._isAMomentObject = true;
        c._useUTC = c._isUTC = isUTC;
        c._l = locale;
        c._i = input;
        c._f = format;
        c._strict = strict;
        return createFromConfig(c);
      }

      function createLocal(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, false);
      }

      var prototypeMin = deprecate('moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/', function () {
        var other = createLocal.apply(null, arguments);

        if (this.isValid() && other.isValid()) {
          return other < this ? this : other;
        } else {
          return createInvalid();
        }
      });
      var prototypeMax = deprecate('moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/', function () {
        var other = createLocal.apply(null, arguments);

        if (this.isValid() && other.isValid()) {
          return other > this ? this : other;
        } else {
          return createInvalid();
        }
      }); // Pick a moment m from moments so that m[fn](other) is true for all
      // other. This relies on the function fn to be transitive.
      //
      // moments should either be an array of moment objects or an array, whose
      // first element is an array of moment objects.

      function pickBy(fn, moments) {
        var res, i;

        if (moments.length === 1 && isArray(moments[0])) {
          moments = moments[0];
        }

        if (!moments.length) {
          return createLocal();
        }

        res = moments[0];

        for (i = 1; i < moments.length; ++i) {
          if (!moments[i].isValid() || moments[i][fn](res)) {
            res = moments[i];
          }
        }

        return res;
      } // TODO: Use [].sort instead?


      function min() {
        var args = [].slice.call(arguments, 0);
        return pickBy('isBefore', args);
      }

      function max() {
        var args = [].slice.call(arguments, 0);
        return pickBy('isAfter', args);
      }

      var now = function () {
        return Date.now ? Date.now() : +new Date();
      };

      var ordering = ['year', 'quarter', 'month', 'week', 'day', 'hour', 'minute', 'second', 'millisecond'];

      function isDurationValid(m) {
        for (var key in m) {
          if (!(indexOf.call(ordering, key) !== -1 && (m[key] == null || !isNaN(m[key])))) {
            return false;
          }
        }

        var unitHasDecimal = false;

        for (var i = 0; i < ordering.length; ++i) {
          if (m[ordering[i]]) {
            if (unitHasDecimal) {
              return false; // only allow non-integers for smallest unit
            }

            if (parseFloat(m[ordering[i]]) !== toInt(m[ordering[i]])) {
              unitHasDecimal = true;
            }
          }
        }

        return true;
      }

      function isValid$1() {
        return this._isValid;
      }

      function createInvalid$1() {
        return createDuration(NaN);
      }

      function Duration(duration) {
        var normalizedInput = normalizeObjectUnits(duration),
            years = normalizedInput.year || 0,
            quarters = normalizedInput.quarter || 0,
            months = normalizedInput.month || 0,
            weeks = normalizedInput.week || normalizedInput.isoWeek || 0,
            days = normalizedInput.day || 0,
            hours = normalizedInput.hour || 0,
            minutes = normalizedInput.minute || 0,
            seconds = normalizedInput.second || 0,
            milliseconds = normalizedInput.millisecond || 0;
        this._isValid = isDurationValid(normalizedInput); // representation for dateAddRemove

        this._milliseconds = +milliseconds + seconds * 1e3 + // 1000
        minutes * 6e4 + // 1000 * 60
        hours * 1000 * 60 * 60; //using 1000 * 60 * 60 instead of 36e5 to avoid floating point rounding errors https://github.com/moment/moment/issues/2978
        // Because of dateAddRemove treats 24 hours as different from a
        // day when working around DST, we need to store them separately

        this._days = +days + weeks * 7; // It is impossible to translate months into days without knowing
        // which months you are are talking about, so we have to store
        // it separately.

        this._months = +months + quarters * 3 + years * 12;
        this._data = {};
        this._locale = getLocale();

        this._bubble();
      }

      function isDuration(obj) {
        return obj instanceof Duration;
      }

      function absRound(number) {
        if (number < 0) {
          return Math.round(-1 * number) * -1;
        } else {
          return Math.round(number);
        }
      } // FORMATTING


      function offset(token, separator) {
        addFormatToken(token, 0, 0, function () {
          var offset = this.utcOffset();
          var sign = '+';

          if (offset < 0) {
            offset = -offset;
            sign = '-';
          }

          return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~offset % 60, 2);
        });
      }

      offset('Z', ':');
      offset('ZZ', ''); // PARSING

      addRegexToken('Z', matchShortOffset);
      addRegexToken('ZZ', matchShortOffset);
      addParseToken(['Z', 'ZZ'], function (input, array, config) {
        config._useUTC = true;
        config._tzm = offsetFromString(matchShortOffset, input);
      }); // HELPERS
      // timezone chunker
      // '+10:00' > ['10',  '00']
      // '-1530'  > ['-15', '30']

      var chunkOffset = /([\+\-]|\d\d)/gi;

      function offsetFromString(matcher, string) {
        var matches = (string || '').match(matcher);

        if (matches === null) {
          return null;
        }

        var chunk = matches[matches.length - 1] || [];
        var parts = (chunk + '').match(chunkOffset) || ['-', 0, 0];
        var minutes = +(parts[1] * 60) + toInt(parts[2]);
        return minutes === 0 ? 0 : parts[0] === '+' ? minutes : -minutes;
      } // Return a moment from input, that is local/utc/zone equivalent to model.


      function cloneWithOffset(input, model) {
        var res, diff;

        if (model._isUTC) {
          res = model.clone();
          diff = (isMoment(input) || isDate(input) ? input.valueOf() : createLocal(input).valueOf()) - res.valueOf(); // Use low-level api, because this fn is low-level api.

          res._d.setTime(res._d.valueOf() + diff);

          hooks.updateOffset(res, false);
          return res;
        } else {
          return createLocal(input).local();
        }
      }

      function getDateOffset(m) {
        // On Firefox.24 Date#getTimezoneOffset returns a floating point.
        // https://github.com/moment/moment/pull/1871
        return -Math.round(m._d.getTimezoneOffset() / 15) * 15;
      } // HOOKS
      // This function will be called whenever a moment is mutated.
      // It is intended to keep the offset in sync with the timezone.


      hooks.updateOffset = function () {}; // MOMENTS
      // keepLocalTime = true means only change the timezone, without
      // affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->
      // 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset
      // +0200, so we adjust the time as needed, to be valid.
      //
      // Keeping the time actually adds/subtracts (one hour)
      // from the actual represented time. That is why we call updateOffset
      // a second time. In case it wants us to change the offset again
      // _changeInProgress == true case, then we have to adjust, because
      // there is no such time in the given timezone.


      function getSetOffset(input, keepLocalTime, keepMinutes) {
        var offset = this._offset || 0,
            localAdjust;

        if (!this.isValid()) {
          return input != null ? this : NaN;
        }

        if (input != null) {
          if (typeof input === 'string') {
            input = offsetFromString(matchShortOffset, input);

            if (input === null) {
              return this;
            }
          } else if (Math.abs(input) < 16 && !keepMinutes) {
            input = input * 60;
          }

          if (!this._isUTC && keepLocalTime) {
            localAdjust = getDateOffset(this);
          }

          this._offset = input;
          this._isUTC = true;

          if (localAdjust != null) {
            this.add(localAdjust, 'm');
          }

          if (offset !== input) {
            if (!keepLocalTime || this._changeInProgress) {
              addSubtract(this, createDuration(input - offset, 'm'), 1, false);
            } else if (!this._changeInProgress) {
              this._changeInProgress = true;
              hooks.updateOffset(this, true);
              this._changeInProgress = null;
            }
          }

          return this;
        } else {
          return this._isUTC ? offset : getDateOffset(this);
        }
      }

      function getSetZone(input, keepLocalTime) {
        if (input != null) {
          if (typeof input !== 'string') {
            input = -input;
          }

          this.utcOffset(input, keepLocalTime);
          return this;
        } else {
          return -this.utcOffset();
        }
      }

      function setOffsetToUTC(keepLocalTime) {
        return this.utcOffset(0, keepLocalTime);
      }

      function setOffsetToLocal(keepLocalTime) {
        if (this._isUTC) {
          this.utcOffset(0, keepLocalTime);
          this._isUTC = false;

          if (keepLocalTime) {
            this.subtract(getDateOffset(this), 'm');
          }
        }

        return this;
      }

      function setOffsetToParsedOffset() {
        if (this._tzm != null) {
          this.utcOffset(this._tzm, false, true);
        } else if (typeof this._i === 'string') {
          var tZone = offsetFromString(matchOffset, this._i);

          if (tZone != null) {
            this.utcOffset(tZone);
          } else {
            this.utcOffset(0, true);
          }
        }

        return this;
      }

      function hasAlignedHourOffset(input) {
        if (!this.isValid()) {
          return false;
        }

        input = input ? createLocal(input).utcOffset() : 0;
        return (this.utcOffset() - input) % 60 === 0;
      }

      function isDaylightSavingTime() {
        return this.utcOffset() > this.clone().month(0).utcOffset() || this.utcOffset() > this.clone().month(5).utcOffset();
      }

      function isDaylightSavingTimeShifted() {
        if (!isUndefined(this._isDSTShifted)) {
          return this._isDSTShifted;
        }

        var c = {};
        copyConfig(c, this);
        c = prepareConfig(c);

        if (c._a) {
          var other = c._isUTC ? createUTC(c._a) : createLocal(c._a);
          this._isDSTShifted = this.isValid() && compareArrays(c._a, other.toArray()) > 0;
        } else {
          this._isDSTShifted = false;
        }

        return this._isDSTShifted;
      }

      function isLocal() {
        return this.isValid() ? !this._isUTC : false;
      }

      function isUtcOffset() {
        return this.isValid() ? this._isUTC : false;
      }

      function isUtc() {
        return this.isValid() ? this._isUTC && this._offset === 0 : false;
      } // ASP.NET json date format regex


      var aspNetRegex = /^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/; // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
      // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
      // and further modified to allow for strings containing both week and day

      var isoRegex = /^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;

      function createDuration(input, key) {
        var duration = input,
            // matching against regexp is expensive, do it on demand
        match = null,
            sign,
            ret,
            diffRes;

        if (isDuration(input)) {
          duration = {
            ms: input._milliseconds,
            d: input._days,
            M: input._months
          };
        } else if (isNumber(input)) {
          duration = {};

          if (key) {
            duration[key] = input;
          } else {
            duration.milliseconds = input;
          }
        } else if (!!(match = aspNetRegex.exec(input))) {
          sign = match[1] === '-' ? -1 : 1;
          duration = {
            y: 0,
            d: toInt(match[DATE]) * sign,
            h: toInt(match[HOUR]) * sign,
            m: toInt(match[MINUTE]) * sign,
            s: toInt(match[SECOND]) * sign,
            ms: toInt(absRound(match[MILLISECOND] * 1000)) * sign // the millisecond decimal point is included in the match

          };
        } else if (!!(match = isoRegex.exec(input))) {
          sign = match[1] === '-' ? -1 : 1;
          duration = {
            y: parseIso(match[2], sign),
            M: parseIso(match[3], sign),
            w: parseIso(match[4], sign),
            d: parseIso(match[5], sign),
            h: parseIso(match[6], sign),
            m: parseIso(match[7], sign),
            s: parseIso(match[8], sign)
          };
        } else if (duration == null) {
          // checks for null or undefined
          duration = {};
        } else if (typeof duration === 'object' && ('from' in duration || 'to' in duration)) {
          diffRes = momentsDifference(createLocal(duration.from), createLocal(duration.to));
          duration = {};
          duration.ms = diffRes.milliseconds;
          duration.M = diffRes.months;
        }

        ret = new Duration(duration);

        if (isDuration(input) && hasOwnProp(input, '_locale')) {
          ret._locale = input._locale;
        }

        return ret;
      }

      createDuration.fn = Duration.prototype;
      createDuration.invalid = createInvalid$1;

      function parseIso(inp, sign) {
        // We'd normally use ~~inp for this, but unfortunately it also
        // converts floats to ints.
        // inp may be undefined, so careful calling replace on it.
        var res = inp && parseFloat(inp.replace(',', '.')); // apply sign while we're at it

        return (isNaN(res) ? 0 : res) * sign;
      }

      function positiveMomentsDifference(base, other) {
        var res = {
          milliseconds: 0,
          months: 0
        };
        res.months = other.month() - base.month() + (other.year() - base.year()) * 12;

        if (base.clone().add(res.months, 'M').isAfter(other)) {
          --res.months;
        }

        res.milliseconds = +other - +base.clone().add(res.months, 'M');
        return res;
      }

      function momentsDifference(base, other) {
        var res;

        if (!(base.isValid() && other.isValid())) {
          return {
            milliseconds: 0,
            months: 0
          };
        }

        other = cloneWithOffset(other, base);

        if (base.isBefore(other)) {
          res = positiveMomentsDifference(base, other);
        } else {
          res = positiveMomentsDifference(other, base);
          res.milliseconds = -res.milliseconds;
          res.months = -res.months;
        }

        return res;
      } // TODO: remove 'name' arg after deprecation is removed


      function createAdder(direction, name) {
        return function (val, period) {
          var dur, tmp; //invert the arguments, but complain about it

          if (period !== null && !isNaN(+period)) {
            deprecateSimple(name, 'moment().' + name + '(period, number) is deprecated. Please use moment().' + name + '(number, period). ' + 'See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.');
            tmp = val;
            val = period;
            period = tmp;
          }

          val = typeof val === 'string' ? +val : val;
          dur = createDuration(val, period);
          addSubtract(this, dur, direction);
          return this;
        };
      }

      function addSubtract(mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds,
            days = absRound(duration._days),
            months = absRound(duration._months);

        if (!mom.isValid()) {
          // No op
          return;
        }

        updateOffset = updateOffset == null ? true : updateOffset;

        if (months) {
          setMonth(mom, get(mom, 'Month') + months * isAdding);
        }

        if (days) {
          set$1(mom, 'Date', get(mom, 'Date') + days * isAdding);
        }

        if (milliseconds) {
          mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding);
        }

        if (updateOffset) {
          hooks.updateOffset(mom, days || months);
        }
      }

      var add = createAdder(1, 'add');
      var subtract = createAdder(-1, 'subtract');

      function getCalendarFormat(myMoment, now) {
        var diff = myMoment.diff(now, 'days', true);
        return diff < -6 ? 'sameElse' : diff < -1 ? 'lastWeek' : diff < 0 ? 'lastDay' : diff < 1 ? 'sameDay' : diff < 2 ? 'nextDay' : diff < 7 ? 'nextWeek' : 'sameElse';
      }

      function calendar$1(time, formats) {
        // We want to compare the start of today, vs this.
        // Getting start-of-today depends on whether we're local/utc/offset or not.
        var now = time || createLocal(),
            sod = cloneWithOffset(now, this).startOf('day'),
            format = hooks.calendarFormat(this, sod) || 'sameElse';
        var output = formats && (isFunction(formats[format]) ? formats[format].call(this, now) : formats[format]);
        return this.format(output || this.localeData().calendar(format, this, createLocal(now)));
      }

      function clone() {
        return new Moment(this);
      }

      function isAfter(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);

        if (!(this.isValid() && localInput.isValid())) {
          return false;
        }

        units = normalizeUnits(units) || 'millisecond';

        if (units === 'millisecond') {
          return this.valueOf() > localInput.valueOf();
        } else {
          return localInput.valueOf() < this.clone().startOf(units).valueOf();
        }
      }

      function isBefore(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);

        if (!(this.isValid() && localInput.isValid())) {
          return false;
        }

        units = normalizeUnits(units) || 'millisecond';

        if (units === 'millisecond') {
          return this.valueOf() < localInput.valueOf();
        } else {
          return this.clone().endOf(units).valueOf() < localInput.valueOf();
        }
      }

      function isBetween(from, to, units, inclusivity) {
        var localFrom = isMoment(from) ? from : createLocal(from),
            localTo = isMoment(to) ? to : createLocal(to);

        if (!(this.isValid() && localFrom.isValid() && localTo.isValid())) {
          return false;
        }

        inclusivity = inclusivity || '()';
        return (inclusivity[0] === '(' ? this.isAfter(localFrom, units) : !this.isBefore(localFrom, units)) && (inclusivity[1] === ')' ? this.isBefore(localTo, units) : !this.isAfter(localTo, units));
      }

      function isSame(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input),
            inputMs;

        if (!(this.isValid() && localInput.isValid())) {
          return false;
        }

        units = normalizeUnits(units) || 'millisecond';

        if (units === 'millisecond') {
          return this.valueOf() === localInput.valueOf();
        } else {
          inputMs = localInput.valueOf();
          return this.clone().startOf(units).valueOf() <= inputMs && inputMs <= this.clone().endOf(units).valueOf();
        }
      }

      function isSameOrAfter(input, units) {
        return this.isSame(input, units) || this.isAfter(input, units);
      }

      function isSameOrBefore(input, units) {
        return this.isSame(input, units) || this.isBefore(input, units);
      }

      function diff(input, units, asFloat) {
        var that, zoneDelta, output;

        if (!this.isValid()) {
          return NaN;
        }

        that = cloneWithOffset(input, this);

        if (!that.isValid()) {
          return NaN;
        }

        zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;
        units = normalizeUnits(units);

        switch (units) {
          case 'year':
            output = monthDiff(this, that) / 12;
            break;

          case 'month':
            output = monthDiff(this, that);
            break;

          case 'quarter':
            output = monthDiff(this, that) / 3;
            break;

          case 'second':
            output = (this - that) / 1e3;
            break;
          // 1000

          case 'minute':
            output = (this - that) / 6e4;
            break;
          // 1000 * 60

          case 'hour':
            output = (this - that) / 36e5;
            break;
          // 1000 * 60 * 60

          case 'day':
            output = (this - that - zoneDelta) / 864e5;
            break;
          // 1000 * 60 * 60 * 24, negate dst

          case 'week':
            output = (this - that - zoneDelta) / 6048e5;
            break;
          // 1000 * 60 * 60 * 24 * 7, negate dst

          default:
            output = this - that;
        }

        return asFloat ? output : absFloor(output);
      }

      function monthDiff(a, b) {
        // difference in months
        var wholeMonthDiff = (b.year() - a.year()) * 12 + (b.month() - a.month()),
            // b is in (anchor - 1 month, anchor + 1 month)
        anchor = a.clone().add(wholeMonthDiff, 'months'),
            anchor2,
            adjust;

        if (b - anchor < 0) {
          anchor2 = a.clone().add(wholeMonthDiff - 1, 'months'); // linear across the month

          adjust = (b - anchor) / (anchor - anchor2);
        } else {
          anchor2 = a.clone().add(wholeMonthDiff + 1, 'months'); // linear across the month

          adjust = (b - anchor) / (anchor2 - anchor);
        } //check for negative zero, return zero if negative zero


        return -(wholeMonthDiff + adjust) || 0;
      }

      hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';
      hooks.defaultFormatUtc = 'YYYY-MM-DDTHH:mm:ss[Z]';

      function toString() {
        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
      }

      function toISOString(keepOffset) {
        if (!this.isValid()) {
          return null;
        }

        var utc = keepOffset !== true;
        var m = utc ? this.clone().utc() : this;

        if (m.year() < 0 || m.year() > 9999) {
          return formatMoment(m, utc ? 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]' : 'YYYYYY-MM-DD[T]HH:mm:ss.SSSZ');
        }

        if (isFunction(Date.prototype.toISOString)) {
          // native implementation is ~50x faster, use it when we can
          if (utc) {
            return this.toDate().toISOString();
          } else {
            return new Date(this.valueOf() + this.utcOffset() * 60 * 1000).toISOString().replace('Z', formatMoment(m, 'Z'));
          }
        }

        return formatMoment(m, utc ? 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]' : 'YYYY-MM-DD[T]HH:mm:ss.SSSZ');
      }
      /**
       * Return a human readable representation of a moment that can
       * also be evaluated to get a new moment which is the same
       *
       * @link https://nodejs.org/dist/latest/docs/api/util.html#util_custom_inspect_function_on_objects
       */


      function inspect() {
        if (!this.isValid()) {
          return 'moment.invalid(/* ' + this._i + ' */)';
        }

        var func = 'moment';
        var zone = '';

        if (!this.isLocal()) {
          func = this.utcOffset() === 0 ? 'moment.utc' : 'moment.parseZone';
          zone = 'Z';
        }

        var prefix = '[' + func + '("]';
        var year = 0 <= this.year() && this.year() <= 9999 ? 'YYYY' : 'YYYYYY';
        var datetime = '-MM-DD[T]HH:mm:ss.SSS';
        var suffix = zone + '[")]';
        return this.format(prefix + year + datetime + suffix);
      }

      function format(inputString) {
        if (!inputString) {
          inputString = this.isUtc() ? hooks.defaultFormatUtc : hooks.defaultFormat;
        }

        var output = formatMoment(this, inputString);
        return this.localeData().postformat(output);
      }

      function from(time, withoutSuffix) {
        if (this.isValid() && (isMoment(time) && time.isValid() || createLocal(time).isValid())) {
          return createDuration({
            to: this,
            from: time
          }).locale(this.locale()).humanize(!withoutSuffix);
        } else {
          return this.localeData().invalidDate();
        }
      }

      function fromNow(withoutSuffix) {
        return this.from(createLocal(), withoutSuffix);
      }

      function to(time, withoutSuffix) {
        if (this.isValid() && (isMoment(time) && time.isValid() || createLocal(time).isValid())) {
          return createDuration({
            from: this,
            to: time
          }).locale(this.locale()).humanize(!withoutSuffix);
        } else {
          return this.localeData().invalidDate();
        }
      }

      function toNow(withoutSuffix) {
        return this.to(createLocal(), withoutSuffix);
      } // If passed a locale key, it will set the locale for this
      // instance.  Otherwise, it will return the locale configuration
      // variables for this instance.


      function locale(key) {
        var newLocaleData;

        if (key === undefined) {
          return this._locale._abbr;
        } else {
          newLocaleData = getLocale(key);

          if (newLocaleData != null) {
            this._locale = newLocaleData;
          }

          return this;
        }
      }

      var lang = deprecate('moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.', function (key) {
        if (key === undefined) {
          return this.localeData();
        } else {
          return this.locale(key);
        }
      });

      function localeData() {
        return this._locale;
      }

      function startOf(units) {
        units = normalizeUnits(units); // the following switch intentionally omits break keywords
        // to utilize falling through the cases.

        switch (units) {
          case 'year':
            this.month(0);

          /* falls through */

          case 'quarter':
          case 'month':
            this.date(1);

          /* falls through */

          case 'week':
          case 'isoWeek':
          case 'day':
          case 'date':
            this.hours(0);

          /* falls through */

          case 'hour':
            this.minutes(0);

          /* falls through */

          case 'minute':
            this.seconds(0);

          /* falls through */

          case 'second':
            this.milliseconds(0);
        } // weeks are a special case


        if (units === 'week') {
          this.weekday(0);
        }

        if (units === 'isoWeek') {
          this.isoWeekday(1);
        } // quarters are also special


        if (units === 'quarter') {
          this.month(Math.floor(this.month() / 3) * 3);
        }

        return this;
      }

      function endOf(units) {
        units = normalizeUnits(units);

        if (units === undefined || units === 'millisecond') {
          return this;
        } // 'date' is an alias for 'day', so it should be considered as such.


        if (units === 'date') {
          units = 'day';
        }

        return this.startOf(units).add(1, units === 'isoWeek' ? 'week' : units).subtract(1, 'ms');
      }

      function valueOf() {
        return this._d.valueOf() - (this._offset || 0) * 60000;
      }

      function unix() {
        return Math.floor(this.valueOf() / 1000);
      }

      function toDate() {
        return new Date(this.valueOf());
      }

      function toArray() {
        var m = this;
        return [m.year(), m.month(), m.date(), m.hour(), m.minute(), m.second(), m.millisecond()];
      }

      function toObject() {
        var m = this;
        return {
          years: m.year(),
          months: m.month(),
          date: m.date(),
          hours: m.hours(),
          minutes: m.minutes(),
          seconds: m.seconds(),
          milliseconds: m.milliseconds()
        };
      }

      function toJSON() {
        // new Date(NaN).toJSON() === null
        return this.isValid() ? this.toISOString() : null;
      }

      function isValid$2() {
        return isValid(this);
      }

      function parsingFlags() {
        return extend({}, getParsingFlags(this));
      }

      function invalidAt() {
        return getParsingFlags(this).overflow;
      }

      function creationData() {
        return {
          input: this._i,
          format: this._f,
          locale: this._locale,
          isUTC: this._isUTC,
          strict: this._strict
        };
      } // FORMATTING


      addFormatToken(0, ['gg', 2], 0, function () {
        return this.weekYear() % 100;
      });
      addFormatToken(0, ['GG', 2], 0, function () {
        return this.isoWeekYear() % 100;
      });

      function addWeekYearFormatToken(token, getter) {
        addFormatToken(0, [token, token.length], 0, getter);
      }

      addWeekYearFormatToken('gggg', 'weekYear');
      addWeekYearFormatToken('ggggg', 'weekYear');
      addWeekYearFormatToken('GGGG', 'isoWeekYear');
      addWeekYearFormatToken('GGGGG', 'isoWeekYear'); // ALIASES

      addUnitAlias('weekYear', 'gg');
      addUnitAlias('isoWeekYear', 'GG'); // PRIORITY

      addUnitPriority('weekYear', 1);
      addUnitPriority('isoWeekYear', 1); // PARSING

      addRegexToken('G', matchSigned);
      addRegexToken('g', matchSigned);
      addRegexToken('GG', match1to2, match2);
      addRegexToken('gg', match1to2, match2);
      addRegexToken('GGGG', match1to4, match4);
      addRegexToken('gggg', match1to4, match4);
      addRegexToken('GGGGG', match1to6, match6);
      addRegexToken('ggggg', match1to6, match6);
      addWeekParseToken(['gggg', 'ggggg', 'GGGG', 'GGGGG'], function (input, week, config, token) {
        week[token.substr(0, 2)] = toInt(input);
      });
      addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {
        week[token] = hooks.parseTwoDigitYear(input);
      }); // MOMENTS

      function getSetWeekYear(input) {
        return getSetWeekYearHelper.call(this, input, this.week(), this.weekday(), this.localeData()._week.dow, this.localeData()._week.doy);
      }

      function getSetISOWeekYear(input) {
        return getSetWeekYearHelper.call(this, input, this.isoWeek(), this.isoWeekday(), 1, 4);
      }

      function getISOWeeksInYear() {
        return weeksInYear(this.year(), 1, 4);
      }

      function getWeeksInYear() {
        var weekInfo = this.localeData()._week;

        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
      }

      function getSetWeekYearHelper(input, week, weekday, dow, doy) {
        var weeksTarget;

        if (input == null) {
          return weekOfYear(this, dow, doy).year;
        } else {
          weeksTarget = weeksInYear(input, dow, doy);

          if (week > weeksTarget) {
            week = weeksTarget;
          }

          return setWeekAll.call(this, input, week, weekday, dow, doy);
        }
      }

      function setWeekAll(weekYear, week, weekday, dow, doy) {
        var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy),
            date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);
        this.year(date.getUTCFullYear());
        this.month(date.getUTCMonth());
        this.date(date.getUTCDate());
        return this;
      } // FORMATTING


      addFormatToken('Q', 0, 'Qo', 'quarter'); // ALIASES

      addUnitAlias('quarter', 'Q'); // PRIORITY

      addUnitPriority('quarter', 7); // PARSING

      addRegexToken('Q', match1);
      addParseToken('Q', function (input, array) {
        array[MONTH] = (toInt(input) - 1) * 3;
      }); // MOMENTS

      function getSetQuarter(input) {
        return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);
      } // FORMATTING


      addFormatToken('D', ['DD', 2], 'Do', 'date'); // ALIASES

      addUnitAlias('date', 'D'); // PRIORITY

      addUnitPriority('date', 9); // PARSING

      addRegexToken('D', match1to2);
      addRegexToken('DD', match1to2, match2);
      addRegexToken('Do', function (isStrict, locale) {
        // TODO: Remove "ordinalParse" fallback in next major release.
        return isStrict ? locale._dayOfMonthOrdinalParse || locale._ordinalParse : locale._dayOfMonthOrdinalParseLenient;
      });
      addParseToken(['D', 'DD'], DATE);
      addParseToken('Do', function (input, array) {
        array[DATE] = toInt(input.match(match1to2)[0]);
      }); // MOMENTS

      var getSetDayOfMonth = makeGetSet('Date', true); // FORMATTING

      addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear'); // ALIASES

      addUnitAlias('dayOfYear', 'DDD'); // PRIORITY

      addUnitPriority('dayOfYear', 4); // PARSING

      addRegexToken('DDD', match1to3);
      addRegexToken('DDDD', match3);
      addParseToken(['DDD', 'DDDD'], function (input, array, config) {
        config._dayOfYear = toInt(input);
      }); // HELPERS
      // MOMENTS

      function getSetDayOfYear(input) {
        var dayOfYear = Math.round((this.clone().startOf('day') - this.clone().startOf('year')) / 864e5) + 1;
        return input == null ? dayOfYear : this.add(input - dayOfYear, 'd');
      } // FORMATTING


      addFormatToken('m', ['mm', 2], 0, 'minute'); // ALIASES

      addUnitAlias('minute', 'm'); // PRIORITY

      addUnitPriority('minute', 14); // PARSING

      addRegexToken('m', match1to2);
      addRegexToken('mm', match1to2, match2);
      addParseToken(['m', 'mm'], MINUTE); // MOMENTS

      var getSetMinute = makeGetSet('Minutes', false); // FORMATTING

      addFormatToken('s', ['ss', 2], 0, 'second'); // ALIASES

      addUnitAlias('second', 's'); // PRIORITY

      addUnitPriority('second', 15); // PARSING

      addRegexToken('s', match1to2);
      addRegexToken('ss', match1to2, match2);
      addParseToken(['s', 'ss'], SECOND); // MOMENTS

      var getSetSecond = makeGetSet('Seconds', false); // FORMATTING

      addFormatToken('S', 0, 0, function () {
        return ~~(this.millisecond() / 100);
      });
      addFormatToken(0, ['SS', 2], 0, function () {
        return ~~(this.millisecond() / 10);
      });
      addFormatToken(0, ['SSS', 3], 0, 'millisecond');
      addFormatToken(0, ['SSSS', 4], 0, function () {
        return this.millisecond() * 10;
      });
      addFormatToken(0, ['SSSSS', 5], 0, function () {
        return this.millisecond() * 100;
      });
      addFormatToken(0, ['SSSSSS', 6], 0, function () {
        return this.millisecond() * 1000;
      });
      addFormatToken(0, ['SSSSSSS', 7], 0, function () {
        return this.millisecond() * 10000;
      });
      addFormatToken(0, ['SSSSSSSS', 8], 0, function () {
        return this.millisecond() * 100000;
      });
      addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {
        return this.millisecond() * 1000000;
      }); // ALIASES

      addUnitAlias('millisecond', 'ms'); // PRIORITY

      addUnitPriority('millisecond', 16); // PARSING

      addRegexToken('S', match1to3, match1);
      addRegexToken('SS', match1to3, match2);
      addRegexToken('SSS', match1to3, match3);
      var token;

      for (token = 'SSSS'; token.length <= 9; token += 'S') {
        addRegexToken(token, matchUnsigned);
      }

      function parseMs(input, array) {
        array[MILLISECOND] = toInt(('0.' + input) * 1000);
      }

      for (token = 'S'; token.length <= 9; token += 'S') {
        addParseToken(token, parseMs);
      } // MOMENTS


      var getSetMillisecond = makeGetSet('Milliseconds', false); // FORMATTING

      addFormatToken('z', 0, 0, 'zoneAbbr');
      addFormatToken('zz', 0, 0, 'zoneName'); // MOMENTS

      function getZoneAbbr() {
        return this._isUTC ? 'UTC' : '';
      }

      function getZoneName() {
        return this._isUTC ? 'Coordinated Universal Time' : '';
      }

      var proto = Moment.prototype;
      proto.add = add;
      proto.calendar = calendar$1;
      proto.clone = clone;
      proto.diff = diff;
      proto.endOf = endOf;
      proto.format = format;
      proto.from = from;
      proto.fromNow = fromNow;
      proto.to = to;
      proto.toNow = toNow;
      proto.get = stringGet;
      proto.invalidAt = invalidAt;
      proto.isAfter = isAfter;
      proto.isBefore = isBefore;
      proto.isBetween = isBetween;
      proto.isSame = isSame;
      proto.isSameOrAfter = isSameOrAfter;
      proto.isSameOrBefore = isSameOrBefore;
      proto.isValid = isValid$2;
      proto.lang = lang;
      proto.locale = locale;
      proto.localeData = localeData;
      proto.max = prototypeMax;
      proto.min = prototypeMin;
      proto.parsingFlags = parsingFlags;
      proto.set = stringSet;
      proto.startOf = startOf;
      proto.subtract = subtract;
      proto.toArray = toArray;
      proto.toObject = toObject;
      proto.toDate = toDate;
      proto.toISOString = toISOString;
      proto.inspect = inspect;
      proto.toJSON = toJSON;
      proto.toString = toString;
      proto.unix = unix;
      proto.valueOf = valueOf;
      proto.creationData = creationData;
      proto.year = getSetYear;
      proto.isLeapYear = getIsLeapYear;
      proto.weekYear = getSetWeekYear;
      proto.isoWeekYear = getSetISOWeekYear;
      proto.quarter = proto.quarters = getSetQuarter;
      proto.month = getSetMonth;
      proto.daysInMonth = getDaysInMonth;
      proto.week = proto.weeks = getSetWeek;
      proto.isoWeek = proto.isoWeeks = getSetISOWeek;
      proto.weeksInYear = getWeeksInYear;
      proto.isoWeeksInYear = getISOWeeksInYear;
      proto.date = getSetDayOfMonth;
      proto.day = proto.days = getSetDayOfWeek;
      proto.weekday = getSetLocaleDayOfWeek;
      proto.isoWeekday = getSetISODayOfWeek;
      proto.dayOfYear = getSetDayOfYear;
      proto.hour = proto.hours = getSetHour;
      proto.minute = proto.minutes = getSetMinute;
      proto.second = proto.seconds = getSetSecond;
      proto.millisecond = proto.milliseconds = getSetMillisecond;
      proto.utcOffset = getSetOffset;
      proto.utc = setOffsetToUTC;
      proto.local = setOffsetToLocal;
      proto.parseZone = setOffsetToParsedOffset;
      proto.hasAlignedHourOffset = hasAlignedHourOffset;
      proto.isDST = isDaylightSavingTime;
      proto.isLocal = isLocal;
      proto.isUtcOffset = isUtcOffset;
      proto.isUtc = isUtc;
      proto.isUTC = isUtc;
      proto.zoneAbbr = getZoneAbbr;
      proto.zoneName = getZoneName;
      proto.dates = deprecate('dates accessor is deprecated. Use date instead.', getSetDayOfMonth);
      proto.months = deprecate('months accessor is deprecated. Use month instead', getSetMonth);
      proto.years = deprecate('years accessor is deprecated. Use year instead', getSetYear);
      proto.zone = deprecate('moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/', getSetZone);
      proto.isDSTShifted = deprecate('isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information', isDaylightSavingTimeShifted);

      function createUnix(input) {
        return createLocal(input * 1000);
      }

      function createInZone() {
        return createLocal.apply(null, arguments).parseZone();
      }

      function preParsePostFormat(string) {
        return string;
      }

      var proto$1 = Locale.prototype;
      proto$1.calendar = calendar;
      proto$1.longDateFormat = longDateFormat;
      proto$1.invalidDate = invalidDate;
      proto$1.ordinal = ordinal;
      proto$1.preparse = preParsePostFormat;
      proto$1.postformat = preParsePostFormat;
      proto$1.relativeTime = relativeTime;
      proto$1.pastFuture = pastFuture;
      proto$1.set = set;
      proto$1.months = localeMonths;
      proto$1.monthsShort = localeMonthsShort;
      proto$1.monthsParse = localeMonthsParse;
      proto$1.monthsRegex = monthsRegex;
      proto$1.monthsShortRegex = monthsShortRegex;
      proto$1.week = localeWeek;
      proto$1.firstDayOfYear = localeFirstDayOfYear;
      proto$1.firstDayOfWeek = localeFirstDayOfWeek;
      proto$1.weekdays = localeWeekdays;
      proto$1.weekdaysMin = localeWeekdaysMin;
      proto$1.weekdaysShort = localeWeekdaysShort;
      proto$1.weekdaysParse = localeWeekdaysParse;
      proto$1.weekdaysRegex = weekdaysRegex;
      proto$1.weekdaysShortRegex = weekdaysShortRegex;
      proto$1.weekdaysMinRegex = weekdaysMinRegex;
      proto$1.isPM = localeIsPM;
      proto$1.meridiem = localeMeridiem;

      function get$1(format, index, field, setter) {
        var locale = getLocale();
        var utc = createUTC().set(setter, index);
        return locale[field](utc, format);
      }

      function listMonthsImpl(format, index, field) {
        if (isNumber(format)) {
          index = format;
          format = undefined;
        }

        format = format || '';

        if (index != null) {
          return get$1(format, index, field, 'month');
        }

        var i;
        var out = [];

        for (i = 0; i < 12; i++) {
          out[i] = get$1(format, i, field, 'month');
        }

        return out;
      } // ()
      // (5)
      // (fmt, 5)
      // (fmt)
      // (true)
      // (true, 5)
      // (true, fmt, 5)
      // (true, fmt)


      function listWeekdaysImpl(localeSorted, format, index, field) {
        if (typeof localeSorted === 'boolean') {
          if (isNumber(format)) {
            index = format;
            format = undefined;
          }

          format = format || '';
        } else {
          format = localeSorted;
          index = format;
          localeSorted = false;

          if (isNumber(format)) {
            index = format;
            format = undefined;
          }

          format = format || '';
        }

        var locale = getLocale(),
            shift = localeSorted ? locale._week.dow : 0;

        if (index != null) {
          return get$1(format, (index + shift) % 7, field, 'day');
        }

        var i;
        var out = [];

        for (i = 0; i < 7; i++) {
          out[i] = get$1(format, (i + shift) % 7, field, 'day');
        }

        return out;
      }

      function listMonths(format, index) {
        return listMonthsImpl(format, index, 'months');
      }

      function listMonthsShort(format, index) {
        return listMonthsImpl(format, index, 'monthsShort');
      }

      function listWeekdays(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdays');
      }

      function listWeekdaysShort(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysShort');
      }

      function listWeekdaysMin(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysMin');
      }

      getSetGlobalLocale('en', {
        dayOfMonthOrdinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal: function (number) {
          var b = number % 10,
              output = toInt(number % 100 / 10) === 1 ? 'th' : b === 1 ? 'st' : b === 2 ? 'nd' : b === 3 ? 'rd' : 'th';
          return number + output;
        }
      }); // Side effect imports

      hooks.lang = deprecate('moment.lang is deprecated. Use moment.locale instead.', getSetGlobalLocale);
      hooks.langData = deprecate('moment.langData is deprecated. Use moment.localeData instead.', getLocale);
      var mathAbs = Math.abs;

      function abs() {
        var data = this._data;
        this._milliseconds = mathAbs(this._milliseconds);
        this._days = mathAbs(this._days);
        this._months = mathAbs(this._months);
        data.milliseconds = mathAbs(data.milliseconds);
        data.seconds = mathAbs(data.seconds);
        data.minutes = mathAbs(data.minutes);
        data.hours = mathAbs(data.hours);
        data.months = mathAbs(data.months);
        data.years = mathAbs(data.years);
        return this;
      }

      function addSubtract$1(duration, input, value, direction) {
        var other = createDuration(input, value);
        duration._milliseconds += direction * other._milliseconds;
        duration._days += direction * other._days;
        duration._months += direction * other._months;
        return duration._bubble();
      } // supports only 2.0-style add(1, 's') or add(duration)


      function add$1(input, value) {
        return addSubtract$1(this, input, value, 1);
      } // supports only 2.0-style subtract(1, 's') or subtract(duration)


      function subtract$1(input, value) {
        return addSubtract$1(this, input, value, -1);
      }

      function absCeil(number) {
        if (number < 0) {
          return Math.floor(number);
        } else {
          return Math.ceil(number);
        }
      }

      function bubble() {
        var milliseconds = this._milliseconds;
        var days = this._days;
        var months = this._months;
        var data = this._data;
        var seconds, minutes, hours, years, monthsFromDays; // if we have a mix of positive and negative values, bubble down first
        // check: https://github.com/moment/moment/issues/2166

        if (!(milliseconds >= 0 && days >= 0 && months >= 0 || milliseconds <= 0 && days <= 0 && months <= 0)) {
          milliseconds += absCeil(monthsToDays(months) + days) * 864e5;
          days = 0;
          months = 0;
        } // The following code bubbles up values, see the tests for
        // examples of what that means.


        data.milliseconds = milliseconds % 1000;
        seconds = absFloor(milliseconds / 1000);
        data.seconds = seconds % 60;
        minutes = absFloor(seconds / 60);
        data.minutes = minutes % 60;
        hours = absFloor(minutes / 60);
        data.hours = hours % 24;
        days += absFloor(hours / 24); // convert days to months

        monthsFromDays = absFloor(daysToMonths(days));
        months += monthsFromDays;
        days -= absCeil(monthsToDays(monthsFromDays)); // 12 months -> 1 year

        years = absFloor(months / 12);
        months %= 12;
        data.days = days;
        data.months = months;
        data.years = years;
        return this;
      }

      function daysToMonths(days) {
        // 400 years have 146097 days (taking into account leap year rules)
        // 400 years have 12 months === 4800
        return days * 4800 / 146097;
      }

      function monthsToDays(months) {
        // the reverse of daysToMonths
        return months * 146097 / 4800;
      }

      function as(units) {
        if (!this.isValid()) {
          return NaN;
        }

        var days;
        var months;
        var milliseconds = this._milliseconds;
        units = normalizeUnits(units);

        if (units === 'month' || units === 'year') {
          days = this._days + milliseconds / 864e5;
          months = this._months + daysToMonths(days);
          return units === 'month' ? months : months / 12;
        } else {
          // handle milliseconds separately because of floating point math errors (issue #1867)
          days = this._days + Math.round(monthsToDays(this._months));

          switch (units) {
            case 'week':
              return days / 7 + milliseconds / 6048e5;

            case 'day':
              return days + milliseconds / 864e5;

            case 'hour':
              return days * 24 + milliseconds / 36e5;

            case 'minute':
              return days * 1440 + milliseconds / 6e4;

            case 'second':
              return days * 86400 + milliseconds / 1000;
            // Math.floor prevents floating point math errors here

            case 'millisecond':
              return Math.floor(days * 864e5) + milliseconds;

            default:
              throw new Error('Unknown unit ' + units);
          }
        }
      } // TODO: Use this.as('ms')?


      function valueOf$1() {
        if (!this.isValid()) {
          return NaN;
        }

        return this._milliseconds + this._days * 864e5 + this._months % 12 * 2592e6 + toInt(this._months / 12) * 31536e6;
      }

      function makeAs(alias) {
        return function () {
          return this.as(alias);
        };
      }

      var asMilliseconds = makeAs('ms');
      var asSeconds = makeAs('s');
      var asMinutes = makeAs('m');
      var asHours = makeAs('h');
      var asDays = makeAs('d');
      var asWeeks = makeAs('w');
      var asMonths = makeAs('M');
      var asYears = makeAs('y');

      function clone$1() {
        return createDuration(this);
      }

      function get$2(units) {
        units = normalizeUnits(units);
        return this.isValid() ? this[units + 's']() : NaN;
      }

      function makeGetter(name) {
        return function () {
          return this.isValid() ? this._data[name] : NaN;
        };
      }

      var milliseconds = makeGetter('milliseconds');
      var seconds = makeGetter('seconds');
      var minutes = makeGetter('minutes');
      var hours = makeGetter('hours');
      var days = makeGetter('days');
      var months = makeGetter('months');
      var years = makeGetter('years');

      function weeks() {
        return absFloor(this.days() / 7);
      }

      var round = Math.round;
      var thresholds = {
        ss: 44,
        // a few seconds to seconds
        s: 45,
        // seconds to minute
        m: 45,
        // minutes to hour
        h: 22,
        // hours to day
        d: 26,
        // days to month
        M: 11 // months to year

      }; // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize

      function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
      }

      function relativeTime$1(posNegDuration, withoutSuffix, locale) {
        var duration = createDuration(posNegDuration).abs();
        var seconds = round(duration.as('s'));
        var minutes = round(duration.as('m'));
        var hours = round(duration.as('h'));
        var days = round(duration.as('d'));
        var months = round(duration.as('M'));
        var years = round(duration.as('y'));
        var a = seconds <= thresholds.ss && ['s', seconds] || seconds < thresholds.s && ['ss', seconds] || minutes <= 1 && ['m'] || minutes < thresholds.m && ['mm', minutes] || hours <= 1 && ['h'] || hours < thresholds.h && ['hh', hours] || days <= 1 && ['d'] || days < thresholds.d && ['dd', days] || months <= 1 && ['M'] || months < thresholds.M && ['MM', months] || years <= 1 && ['y'] || ['yy', years];
        a[2] = withoutSuffix;
        a[3] = +posNegDuration > 0;
        a[4] = locale;
        return substituteTimeAgo.apply(null, a);
      } // This function allows you to set the rounding function for relative time strings


      function getSetRelativeTimeRounding(roundingFunction) {
        if (roundingFunction === undefined) {
          return round;
        }

        if (typeof roundingFunction === 'function') {
          round = roundingFunction;
          return true;
        }

        return false;
      } // This function allows you to set a threshold for relative time strings


      function getSetRelativeTimeThreshold(threshold, limit) {
        if (thresholds[threshold] === undefined) {
          return false;
        }

        if (limit === undefined) {
          return thresholds[threshold];
        }

        thresholds[threshold] = limit;

        if (threshold === 's') {
          thresholds.ss = limit - 1;
        }

        return true;
      }

      function humanize(withSuffix) {
        if (!this.isValid()) {
          return this.localeData().invalidDate();
        }

        var locale = this.localeData();
        var output = relativeTime$1(this, !withSuffix, locale);

        if (withSuffix) {
          output = locale.pastFuture(+this, output);
        }

        return locale.postformat(output);
      }

      var abs$1 = Math.abs;

      function sign(x) {
        return (x > 0) - (x < 0) || +x;
      }

      function toISOString$1() {
        // for ISO strings we do not use the normal bubbling rules:
        //  * milliseconds bubble up until they become hours
        //  * days do not bubble at all
        //  * months bubble up until they become years
        // This is because there is no context-free conversion between hours and days
        // (think of clock changes)
        // and also not between days and months (28-31 days per month)
        if (!this.isValid()) {
          return this.localeData().invalidDate();
        }

        var seconds = abs$1(this._milliseconds) / 1000;
        var days = abs$1(this._days);
        var months = abs$1(this._months);
        var minutes, hours, years; // 3600 seconds -> 60 minutes -> 1 hour

        minutes = absFloor(seconds / 60);
        hours = absFloor(minutes / 60);
        seconds %= 60;
        minutes %= 60; // 12 months -> 1 year

        years = absFloor(months / 12);
        months %= 12; // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js

        var Y = years;
        var M = months;
        var D = days;
        var h = hours;
        var m = minutes;
        var s = seconds ? seconds.toFixed(3).replace(/\.?0+$/, '') : '';
        var total = this.asSeconds();

        if (!total) {
          // this is the same as C#'s (Noda) and python (isodate)...
          // but not other JS (goog.date)
          return 'P0D';
        }

        var totalSign = total < 0 ? '-' : '';
        var ymSign = sign(this._months) !== sign(total) ? '-' : '';
        var daysSign = sign(this._days) !== sign(total) ? '-' : '';
        var hmsSign = sign(this._milliseconds) !== sign(total) ? '-' : '';
        return totalSign + 'P' + (Y ? ymSign + Y + 'Y' : '') + (M ? ymSign + M + 'M' : '') + (D ? daysSign + D + 'D' : '') + (h || m || s ? 'T' : '') + (h ? hmsSign + h + 'H' : '') + (m ? hmsSign + m + 'M' : '') + (s ? hmsSign + s + 'S' : '');
      }

      var proto$2 = Duration.prototype;
      proto$2.isValid = isValid$1;
      proto$2.abs = abs;
      proto$2.add = add$1;
      proto$2.subtract = subtract$1;
      proto$2.as = as;
      proto$2.asMilliseconds = asMilliseconds;
      proto$2.asSeconds = asSeconds;
      proto$2.asMinutes = asMinutes;
      proto$2.asHours = asHours;
      proto$2.asDays = asDays;
      proto$2.asWeeks = asWeeks;
      proto$2.asMonths = asMonths;
      proto$2.asYears = asYears;
      proto$2.valueOf = valueOf$1;
      proto$2._bubble = bubble;
      proto$2.clone = clone$1;
      proto$2.get = get$2;
      proto$2.milliseconds = milliseconds;
      proto$2.seconds = seconds;
      proto$2.minutes = minutes;
      proto$2.hours = hours;
      proto$2.days = days;
      proto$2.weeks = weeks;
      proto$2.months = months;
      proto$2.years = years;
      proto$2.humanize = humanize;
      proto$2.toISOString = toISOString$1;
      proto$2.toString = toISOString$1;
      proto$2.toJSON = toISOString$1;
      proto$2.locale = locale;
      proto$2.localeData = localeData;
      proto$2.toIsoString = deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)', toISOString$1);
      proto$2.lang = lang; // Side effect imports
      // FORMATTING

      addFormatToken('X', 0, 0, 'unix');
      addFormatToken('x', 0, 0, 'valueOf'); // PARSING

      addRegexToken('x', matchSigned);
      addRegexToken('X', matchTimestamp);
      addParseToken('X', function (input, array, config) {
        config._d = new Date(parseFloat(input, 10) * 1000);
      });
      addParseToken('x', function (input, array, config) {
        config._d = new Date(toInt(input));
      }); // Side effect imports

      hooks.version = '2.23.0';
      setHookCallback(createLocal);
      hooks.fn = proto;
      hooks.min = min;
      hooks.max = max;
      hooks.now = now;
      hooks.utc = createUTC;
      hooks.unix = createUnix;
      hooks.months = listMonths;
      hooks.isDate = isDate;
      hooks.locale = getSetGlobalLocale;
      hooks.invalid = createInvalid;
      hooks.duration = createDuration;
      hooks.isMoment = isMoment;
      hooks.weekdays = listWeekdays;
      hooks.parseZone = createInZone;
      hooks.localeData = getLocale;
      hooks.isDuration = isDuration;
      hooks.monthsShort = listMonthsShort;
      hooks.weekdaysMin = listWeekdaysMin;
      hooks.defineLocale = defineLocale;
      hooks.updateLocale = updateLocale;
      hooks.locales = listLocales;
      hooks.weekdaysShort = listWeekdaysShort;
      hooks.normalizeUnits = normalizeUnits;
      hooks.relativeTimeRounding = getSetRelativeTimeRounding;
      hooks.relativeTimeThreshold = getSetRelativeTimeThreshold;
      hooks.calendarFormat = getCalendarFormat;
      hooks.prototype = proto; // currently HTML5 input type only supports 24-hour formats

      hooks.HTML5_FMT = {
        DATETIME_LOCAL: 'YYYY-MM-DDTHH:mm',
        // <input type="datetime-local" />
        DATETIME_LOCAL_SECONDS: 'YYYY-MM-DDTHH:mm:ss',
        // <input type="datetime-local" step="1" />
        DATETIME_LOCAL_MS: 'YYYY-MM-DDTHH:mm:ss.SSS',
        // <input type="datetime-local" step="0.001" />
        DATE: 'YYYY-MM-DD',
        // <input type="date" />
        TIME: 'HH:mm',
        // <input type="time" />
        TIME_SECONDS: 'HH:mm:ss',
        // <input type="time" step="1" />
        TIME_MS: 'HH:mm:ss.SSS',
        // <input type="time" step="0.001" />
        WEEK: 'GGGG-[W]WW',
        // <input type="week" />
        MONTH: 'YYYY-MM' // <input type="month" />

      };
      return hooks;
    });
  });

  function formatDA(date) {
    var strFormat = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'MMM D, YYYY';

    if (!date) {
      return;
    }

    var dateAsMoment = moment(date, 'YYYYMMDD');
    return dateAsMoment.format(strFormat);
  }

  function formatTM(time) {
    var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'HH:mm:ss';

    if (!time) {
      return;
    } // DICOM Time is stored as HHmmss.SSS, where:
    //      HH 24 hour time:
    //      m mm    0..59   Minutes
    //      s ss    0..59   Seconds
    //      S SS SSS    0..999  Fractional seconds
    //
    // See MomentJS: http://momentjs.com/docs/#/parsing/string-format/


    var dateTime = moment(time, 'HHmmss.SSS');
    return dateTime.format(format);
  }

  function formatNumberPrecision(number, precision) {
    if (number !== null) {
      return parseFloat(number).toFixed(precision);
    }
  }

  function isValidNumber(value) {
    return typeof value === 'number' && !isNaN(value);
  }

  var helpers = {
    formatPN: formatPN,
    formatDA: formatDA,
    formatTM: formatTM,
    formatNumberPrecision: formatNumberPrecision,
    isValidNumber: isValidNumber
  };
  var css$1$1 = ".imageViewerViewport.empty ~ .ViewportOverlay {\n  display: none;\n}\n.ViewportOverlay {\n  color: #9ccef9;\n}\n.ViewportOverlay .overlay-element {\n  position: absolute;\n  font-weight: 400;\n  text-shadow: 1px 1px #000;\n  pointer-events: none;\n}\n.ViewportOverlay .top-left {\n  top: 20px;\n  left: 20px;\n}\n.ViewportOverlay .top-center {\n  top: 20px;\n  padding-top: 20px;\n  width: 100%;\n  text-align: center;\n}\n.ViewportOverlay .top-right {\n  top: 20px;\n  right: 20px;\n  text-align: right;\n}\n.ViewportOverlay .bottom-left {\n  bottom: 20px;\n  left: 20px;\n}\n.ViewportOverlay .bottom-right {\n  bottom: 20px;\n  right: 20px;\n  text-align: right;\n}\n.ViewportOverlay.controlsVisible .topright,\n.ViewportOverlay.controlsVisible .bottomright {\n  right: calc(20px + 19px);\n}\n.ViewportOverlay svg {\n  color: #9ccef9;\n  fill: #9ccef9;\n  stroke: #9ccef9;\n  background-color: transparent;\n  margin: 2px;\n  width: 18px;\n  height: 18px;\n}\n";
  styleInject$2(css$1$1);
  var formatPN$1 = helpers.formatPN,
      formatDA$1 = helpers.formatDA,
      formatNumberPrecision$1 = helpers.formatNumberPrecision,
      formatTM$1 = helpers.formatTM,
      isValidNumber$1 = helpers.isValidNumber;
  /*function getCompression(imageId) {
    const instance = cornerstone.metaData.get('instance', imageId);
    if (!instance) {
      return '';
    }

    if (
      instance.lossyImageCompression === '01' &&
      instance.lossyImageCompressionRatio !== ''
    ) {
      const compressionMethod = instance.lossyImageCompressionMethod || 'Lossy: ';
      const compressionRatio = formatNumberPrecision(
        instance.lossyImageCompressionRatio,
        2
      );
      return compressionMethod + compressionRatio + ' : 1';
    }

    return 'Lossless / Uncompressed';
  }

  function getImageDimensions(imageId) {
    const instance = cornerstone.metaData.get('instance', imageId);
    if (!instance) {
      return '';
    }

    return `${instance.columns} x ${instance.rows}`;
  }*/

  var ViewportOverlay =
  /*#__PURE__*/
  function (_PureComponent) {
    _inherits$d(ViewportOverlay, _PureComponent);

    function ViewportOverlay() {
      _classCallCheck$d(this, ViewportOverlay);

      return _possibleConstructorReturn$d(this, _getPrototypeOf$2(ViewportOverlay).apply(this, arguments));
    }

    _createClass$3(ViewportOverlay, [{
      key: "render",
      value: function render() {
        var zoom = this.props.viewport.scale * 100;
        var imageId = this.props.imageId; //const patientMetadata = cornerstone.metaData.get('patient', imageId);
        //const studyMetadata = cornerstone.metaData.get('study', imageId);
        //const seriesMetadata = cornerstone.metaData.get('generalSeriesModule', imageId);
        //const instanceMetadata = cornerstone.metaData.get('instance', imageId);

        var patientName = ''; //patientMetadata.name;

        var patientId = ''; //patientMetadata.id;

        /*const { studyDate, studyTime, studyDescription } = studyMetadata;
        const { seriesNumber, seriesDescription } = seriesMetadata;
        const { instanceNumber, frameTime, thickness, spacingBetweenSlices, sliceLocation } = instanceMetadata;*/
        //const frameRate = formatNumberPrecision(1000 / frameTime, 1);
        //const compression = getCompression(imageId);

        var windowWidth = this.props.viewport.voi.windowWidth || 0;
        var windowCenter = this.props.viewport.voi.windowCenter || 0;
        var wwwc = "W: ".concat(windowWidth.toFixed(0), " L: ").concat(windowCenter.toFixed(0));
        var imageIndex = this.props.stack.imageIds.indexOf(this.props.imageId) + 1;
        var numImages = this.props.stack.imageIds.length; //const imageDimensions = getImageDimensions(imageId);

        var studyDescription = '';
        var studyDate = null;
        var studyTime = null;
        var compression = null;
        var seriesNumber = null;
        var instanceNumber = null;
        var frameRate = null;
        var imageDimensions = null;
        var sliceLocation = null;
        var seriesDescription = null;
        var normal = React__default.createElement(React__default.Fragment, null, React__default.createElement("div", {
          className: "top-left overlay-element"
        }, React__default.createElement("div", null, formatPN$1(patientName)), React__default.createElement("div", null, patientId)), React__default.createElement("div", {
          className: "top-right overlay-element"
        }, React__default.createElement("div", null, studyDescription), React__default.createElement("div", null, formatDA$1(studyDate), " ", formatTM$1(studyTime))), React__default.createElement("div", {
          className: "bottom-right overlay-element"
        }, React__default.createElement("div", null, "Zoom: ", formatNumberPrecision$1(zoom, 0), "%"), React__default.createElement("div", {
          className: "compressionIndicator"
        }, compression), React__default.createElement("div", null, wwwc)), React__default.createElement("div", {
          className: "bottom-left overlay-element"
        }, React__default.createElement("div", null, "Ser: ".concat(seriesNumber)), React__default.createElement("div", null, numImages > 1 ? "Img: ".concat(instanceNumber, " ").concat(imageIndex, "/").concat(numImages) : ''), React__default.createElement("div", null, "".concat(formatNumberPrecision$1(frameRate, 2), " FPS"), React__default.createElement("div", null, imageDimensions), React__default.createElement("div", null, React__default.createElement("span", null, isValidNumber$1(sliceLocation) ? "Loc: ".concat(formatNumberPrecision$1(sliceLocation, 2), " mm") : ''), React__default.createElement("span", null, ''), React__default.createElement("span", null, '')), React__default.createElement("div", null, seriesDescription))));
        var rightOnly = React__default.createElement(React__default.Fragment, null, React__default.createElement("div", {
          className: "top-right overlay-element"
        }, React__default.createElement("div", null, formatPN$1(patientName)), React__default.createElement("div", null, patientId), React__default.createElement("div", null, studyDescription), React__default.createElement("div", null, formatDA$1(studyDate), " ", formatTM$1(studyTime))), React__default.createElement("div", {
          className: "bottom-right overlay-element"
        }, React__default.createElement("div", null, "Ser: ".concat(seriesNumber)), React__default.createElement("div", null, numImages > 1 ? "Img: ".concat(instanceNumber, " ").concat(imageIndex, "/").concat(numImages) : ''), React__default.createElement("div", null, "".concat(formatNumberPrecision$1(frameRate, 2), " FPS")), React__default.createElement("div", null, imageDimensions), React__default.createElement("div", null, seriesDescription), React__default.createElement("div", null, "Zoom: $", formatNumberPrecision$1(zoom, 0), "%"), React__default.createElement("div", {
          className: "compressionIndicator"
        }, compression), React__default.createElement("div", null, wwwc)));
        var leftOnly = React__default.createElement(React__default.Fragment, null, React__default.createElement("div", {
          className: "top-left overlay-element"
        }, React__default.createElement("div", null, formatPN$1(patientName)), React__default.createElement("div", null, patientId), React__default.createElement("div", null, studyDescription), React__default.createElement("div", null, formatDA$1(studyDate), " ", formatTM$1(studyTime))), React__default.createElement("div", {
          className: "bottom-left overlay-element"
        }, React__default.createElement("div", null, "Ser: ".concat(seriesNumber)), React__default.createElement("div", null, numImages > 1 ? "Img: ".concat(instanceNumber, " ").concat(imageIndex, "/").concat(numImages) : ''), React__default.createElement("div", null, "".concat(formatNumberPrecision$1(frameRate, 2), " FPS")), React__default.createElement("div", null, imageDimensions), React__default.createElement("div", null, seriesDescription), React__default.createElement("div", null, "Zoom: $", formatNumberPrecision$1(zoom, 0), "%"), React__default.createElement("div", {
          className: "compressionIndicator"
        }, compression), React__default.createElement("div", null, wwwc)));
        return React__default.createElement("div", {
          className: "ViewportOverlay"
        }, normal);
      }
    }]);

    return ViewportOverlay;
  }(React.PureComponent);

  ViewportOverlay.propTypes = {
    viewport: propTypes$2.object.isRequired,
    imageId: propTypes$2.string.isRequired,
    stack: propTypes$2.object.isRequired
  };
  var css$2$1 = ".imageViewerLoadingIndicator {\n  color: #91b9cd;\n}\n.faded {\n  opacity: 0.5;\n}\n.imageViewerErrorLoadingIndicator {\n  color: #e29e4a;\n}\n.imageViewerErrorLoadingIndicator p,\n.imageViewerErrorLoadingIndicator h4 {\n  padding: 4px 0;\n  text-align: center;\n  word-wrap: break-word;\n}\n.imageViewerErrorLoadingIndicator p {\n  font-size: 11pt;\n}\n.loadingIndicator {\n  background-color: rgba(0,0,0,0.75);\n  font-size: 18px;\n  height: 100%;\n  overflow: hidden;\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  width: 100%;\n  z-index: 1;\n}\n.loadingIndicator .indicatorContents {\n  font-size: 30px;\n  font-weight: 300;\n  position: absolute;\n  text-align: center;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 100%;\n}\n";
  styleInject$2(css$2$1);

  var LoadingIndicator =
  /*#__PURE__*/
  function (_PureComponent) {
    _inherits$d(LoadingIndicator, _PureComponent);

    function LoadingIndicator() {
      _classCallCheck$d(this, LoadingIndicator);

      return _possibleConstructorReturn$d(this, _getPrototypeOf$2(LoadingIndicator).apply(this, arguments));
    }

    _createClass$3(LoadingIndicator, [{
      key: "render",
      value: function render() {
        // TODO[react]: Pass this in as a prop reactively
        //const percentComplete = Session.get('CornerstoneLoadProgress' + this.viewportIndex);
        var percComplete;

        if (this.props.percentComplete && this.props.percentComplete !== 100) {
          percComplete = "".concat(this.props.percentComplete, "%");
        }

        return React__default.createElement(React__default.Fragment, null, this.props.error ? React__default.createElement("div", {
          className: "imageViewerErrorLoadingIndicator loadingIndicator"
        }, React__default.createElement("div", {
          className: "indicatorContents"
        }, React__default.createElement("h4", null, "Error Loading Image"), React__default.createElement("p", {
          className: "description"
        }, "An error has occurred."), React__default.createElement("p", {
          className: "details"
        }, this.props.error.message))) : React__default.createElement("div", {
          className: "imageViewerLoadingIndicator loadingIndicator"
        }, React__default.createElement("div", {
          className: "indicatorContents"
        }, React__default.createElement("p", null, "Loading... ", React__default.createElement("i", {
          className: "fa fa-spin fa-circle-o-notch fa-fw"
        }), ' ', percComplete))));
      }
    }]);

    return LoadingIndicator;
  }(React.PureComponent);

  _defineProperty$4(LoadingIndicator, "propTypes", {
    percentComplete: propTypes$2.number,
    error: propTypes$2.object
  });

  _defineProperty$4(LoadingIndicator, "defaultProps", {
    percentComplete: 0,
    error: null
  });

  var css$3$1 = ".ViewportOrientationMarkers {\n  pointer-events: none;\n  font-size: 15px;\n  color: #ccc;\n  line-height: 18px;\n}\n.ViewportOrientationMarkers .orientation-marker {\n  position: absolute;\n}\n.ViewportOrientationMarkers .top-mid {\n  top: 5px;\n  left: 50%;\n}\n.ViewportOrientationMarkers .left-mid {\n  top: 47%;\n  left: 5px;\n}\n";
  styleInject$2(css$3$1);
  /**
   * Computes the orientation labels on a Cornerstone-enabled Viewport element
   * when the viewport settings change (e.g. when a horizontal flip or a rotation occurs)
   *
   * @param imageId The Cornerstone ImageId
   * @param viewport The current viewport
   */

  function getOrientationMarkers(imageId, viewport, cornerstone, cornerstoneTools) {
    var imagePlane = cornerstone.metaData.get('imagePlane', imageId);

    if (!imagePlane || !imagePlane.rowCosines || !imagePlane.columnCosines) {
      return;
    }

    var rowString = cornerstoneTools.orientation.getOrientationString(imagePlane.rowCosines);
    var columnString = cornerstoneTools.orientation.getOrientationString(imagePlane.columnCosines);
    var oppositeRowString = cornerstoneTools.orientation.invertOrientationString(rowString);
    var oppositeColumnString = cornerstoneTools.orientation.invertOrientationString(columnString);
    var markers = {
      top: oppositeColumnString,
      left: oppositeRowString
    }; // If any vertical or horizontal flips are applied, change the orientation strings ahead of
    // the rotation applications

    if (viewport.vflip) {
      markers.top = cornerstoneTools.orientation.invertOrientationString(markers.top);
    }

    if (viewport.hflip) {
      markers.left = cornerstoneTools.orientation.invertOrientationString(markers.left);
    } // Swap the labels accordingly if the viewport has been rotated
    // This could be done in a more complex way for intermediate rotation values (e.g. 45 degrees)


    if (viewport.rotation === 90 || viewport.rotation === -270) {
      return {
        top: markers.left,
        left: cornerstoneTools.orientation.invertOrientationString(markers.top)
      };
    } else if (viewport.rotation === -90 || viewport.rotation === 270) {
      return {
        top: cornerstoneTools.orientation.invertOrientationString(markers.left),
        left: markers.top
      };
    } else if (viewport.rotation === 180 || viewport.rotation === -180) {
      return {
        top: cornerstoneTools.orientation.invertOrientationString(markers.top),
        left: cornerstoneTools.orientation.invertOrientationString(markers.left)
      };
    }

    return markers;
  }

  var ViewportOrientationMarkers =
  /*#__PURE__*/
  function (_PureComponent) {
    _inherits$d(ViewportOrientationMarkers, _PureComponent);

    function ViewportOrientationMarkers() {
      _classCallCheck$d(this, ViewportOrientationMarkers);

      return _possibleConstructorReturn$d(this, _getPrototypeOf$2(ViewportOrientationMarkers).apply(this, arguments));
    }

    _createClass$3(ViewportOrientationMarkers, [{
      key: "render",
      value: function render() {
        var _this$props = this.props,
            imageId = _this$props.imageId,
            viewport = _this$props.viewport,
            cornerstone = _this$props.cornerstone,
            cornerstoneTools = _this$props.cornerstoneTools;
        var markers = getOrientationMarkers(imageId, viewport, cornerstone, cornerstoneTools);

        if (!markers) {
          return '';
        }

        return React__default.createElement("div", {
          className: "ViewportOrientationMarkers noselect"
        }, React__default.createElement("div", {
          className: "top-mid orientation-marker"
        }, markers.top), React__default.createElement("div", {
          className: "left-mid orientation-marker"
        }, markers.left));
      }
    }]);

    return ViewportOrientationMarkers;
  }(React.PureComponent);

  ViewportOrientationMarkers.propTypes = {
    imageId: propTypes$2.string.isRequired,
    viewport: propTypes$2.object.isRequired
  };
  var css$4$1 = ".CornerstoneViewport {\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n\n.viewport-element {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  background-color: black;\n\n  /* Prevent the blue outline in Chrome when a viewport is selected */\n  outline: 0 !important;\n\n  /* Prevents the entire page from getting larger\n     when the magnify tool is near the sides/corners of the page */\n  overflow: hidden;\n}\n\n.viewportInstructions {\n  display: block;\n  font-size: 13px;\n  /*theme('color', '$textSecondaryColor')*/\n  color: #91b9cd;\n  line-height: 18px;\n  pointer-events: none; /* Necessary for drag/drop through to cornerstone element below */\n  text-align: center;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  margin: auto;\n  height: 20px;\n}\n\n/* These are some good CSS settings for a circular magnifying glass\n   Try removing the border-radius to make a square magnifying glass */\n.magnifyTool {\n  border: 4px white solid;\n  box-shadow: 2px 2px 10px #1e1e1e;\n  border-radius: 50%;\n  display: none;\n  cursor: none;\n}\n";
  styleInject$2(css$4$1);
  var EVENT_RESIZE = 'resize';

  function setToolsPassive(cornerstoneTools, tools) {
    tools.forEach(function (tool) {
      cornerstoneTools.setToolPassive(tool);
    });
  }

  function initializeTools(cornerstoneTools, tools) {
    Array.from(tools).forEach(function (tool) {
      var apiTool = cornerstoneTools["".concat(tool.name, "Tool")];

      if (apiTool) {
        cornerstoneTools.addTool(apiTool, tool.configuration);
      } else {
        throw new Error("Tool not found: ".concat(tool.name, "Tool"));
      }
    });
  }

  var CornerstoneViewport =
  /*#__PURE__*/
  function (_Component) {
    _inherits$d(CornerstoneViewport, _Component);

    function CornerstoneViewport(props) {
      var _this;

      _classCallCheck$d(this, CornerstoneViewport);

      _this = _possibleConstructorReturn$d(this, _getPrototypeOf$2(CornerstoneViewport).call(this, props));

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onContextMenu", function (event) {
        // Preventing the default behaviour for right-click is essential to
        // allow right-click tools to work.
        event.preventDefault();
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onWindowResize", function () {
        _this.debouncedResize();
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onImageRendered", function () {
        var viewport = _this.cornerstone.getViewport(_this.element);

        _this.setState({
          viewport: viewport
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onNewImage", function () {
        var image = _this.cornerstone.getImage(_this.element);

        _this.setState({
          imageId: image.imageId
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "setActiveTool", function (activeTool) {
        // TODO: allow this config as props
        var leftMouseTools = ['Bidirectional', 'Wwwc', 'Length', 'Angle', 'StackScroll'];
        setToolsPassive(_this.cornerstoneTools, leftMouseTools); // pan is the default tool for middle mouse button

        var isPanToolActive = activeTool === 'Pan';
        var panOptions = {
          mouseButtonMask: isPanToolActive ? [1, 4] : [4],
          isTouchActive: isPanToolActive
        };

        _this.cornerstoneTools.setToolActive('Pan', panOptions); // zoom is the default tool for right mouse button


        var isZoomToolActive = activeTool === 'Zoom';
        var zoomOptions = {
          mouseButtonMask: isZoomToolActive ? [1, 2] : [2],
          isTouchActive: isZoomToolActive
        };

        _this.cornerstoneTools.setToolActive('Zoom', zoomOptions);

        _this.cornerstoneTools.setToolActive(activeTool, {
          mouseButtonMask: 1,
          isTouchActive: true
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onStackScroll", function (event) {
        _this.setViewportActive();

        var element = event.currentTarget;

        var stackData = _this.cornerstoneTools.getToolState(element, 'stack');

        var stack = stackData.data[0];

        _this.hideExtraButtons();

        _this.setState({
          stack: stack
        });
        /*
        Temporarily removed because it didn't seem to be performing well
        if (this.props.setViewportSpecificData) {
          this.props.setViewportSpecificData({ stack });
        }*/

      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onImageLoaded", function () {
        _this.setState({
          numImagesLoaded: _this.state.numImagesLoaded + 1
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "startLoadingHandler", function () {
        clearTimeout(_this.loadHandlerTimeout);
        _this.loadHandlerTimeout = setTimeout(function () {
          _this.setState({
            isLoading: true
          });
        }, CornerstoneViewport.loadIndicatorDelay);
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "doneLoadingHandler", function () {
        clearTimeout(_this.loadHandlerTimeout);

        _this.setState({
          isLoading: false
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onMeasurementAddedOrRemoved", function () {
        console.log('onMeasurementAddedOrRemoved');
        /* const { toolType, measurementData } = event.detail;
         // TODO: Pass in as prop?
        const toolsOfInterest = ['Bidirectional'];
         this.hideExtraButtons();
         if (toolsOfInterest.includes(toolType)) {
          const image = cornerstone.getImage(this.element);
          const viewport = cornerstone.getViewport(this.element);
           const type = {
            cornerstonetoolsmeasurementadded: 'added',
            cornerstonetoolsmeasurementremoved: 'removed'
          };
          const action = type[event.type];
           if (action === 'added') {
            measurementData._id = guid();
            measurementData.viewport = cloneDeep(viewport);
          }
           this.props.measurementsAddedOrRemoved(
            action,
            image.imageId,
            toolType,
            measurementData
          );
        }*/
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "setViewportActive", function () {
        if (!_this.props.isActive && _this.props.setViewportActive) {
          _this.props.setViewportActive();
        }
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onMouseClick", function (event) {
        _this.setViewportActive();

        if (event.detail.event.which === 3) {
          _this.setState({
            toolContextMenuData: {
              eventData: event.detail,
              isTouchEvent: false
            }
          });
        }
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onTouchPress", function (event) {
        _this.setViewportActive();

        _this.setState({
          toolContextMenuData: {
            eventData: event.detail,
            isTouchEvent: true
          }
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onTouchStart", function () {
        _this.setViewportActive();
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "onCloseToolContextMenu", function () {
        _this.setState({
          toolContextMenuData: null
        });
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "imageSliderOnInputCallback", function (value) {
        _this.setViewportActive();

        var stack = _this.state.stack;
        stack.currentImageIdIndex = value;

        _this.setState({
          stack: stack
        });
        /*
        Temporarily removed because it didn't seem to be performing well
        if (this.props.setViewportSpecificData) {
          this.props.setViewportSpecificData({ stack });
        }*/
        // TODO: For some reason this isn't working?


        _this.scrollToIndex(_this.element, value);
      });

      _defineProperty$4(_assertThisInitialized$4(_assertThisInitialized$4(_this)), "hideExtraButtons", function () {
        if (_this.state.bidirectionalAddLabelShow === true) {
          _this.setState({
            bidirectionalAddLabelShow: false
          });
        }

        _this.setState({
          toolContextMenuData: null
        });
      });

      _this.cornerstone = props.cornerstone;
      _this.cornerstoneTools = props.cornerstoneTools;
      _this.scrollToIndex = _this.cornerstoneTools.import('util/scrollToIndex'); // TODO: Allow viewport as a prop

      var _stack = props.viewportData.stack;
      _this.state = {
        stack: _stack,
        displaySetInstanceUid: props.viewportData.displaySetInstanceUid,
        imageId: _stack.imageIds[0],
        viewportHeight: '100%',
        isLoading: false,
        numImagesLoaded: 0,
        error: null,
        viewport: _this.cornerstone.getDefaultViewport(null, undefined)
      };
      var loadHandlerManager = _this.cornerstoneTools.loadHandlerManager;
      loadHandlerManager.setStartLoadHandler(_this.startLoadingHandler);
      loadHandlerManager.setEndLoadHandler(_this.doneLoadingHandler);
      _this.debouncedResize = lodash_debounce(function () {
        try {
          _this.cornerstone.getEnabledElement(_this.element);
        } catch (error) {
          console.error(error);
          return;
        }

        _this.cornerstone.resize(_this.element, true);

        _this.setState({
          viewportHeight: "".concat(_this.element.clientHeight - 20, "px")
        });
      }, 300);
      return _this;
    }

    _createClass$3(CornerstoneViewport, [{
      key: "render",
      value: function render() {
        var _this2 = this;

        var isLoading = this.state.isLoading || this.state.numImagesLoaded < 1;
        var displayLoadingIndicator = isLoading || this.state.error;
        var className = 'CornerstoneViewport';

        if (this.props.isActive) {
          className += ' active';
        }

        return React__default.createElement("div", {
          className: className
        }, React__default.createElement("div", {
          className: "viewport-element",
          onContextMenu: this.onContextMenu,
          ref: function ref(input) {
            _this2.element = input;
          }
        }, displayLoadingIndicator && React__default.createElement(LoadingIndicator, {
          error: this.state.error
        }), React__default.createElement("canvas", {
          className: "cornerstone-canvas"
        }), React__default.createElement(ViewportOverlay, {
          stack: this.state.stack,
          viewport: this.state.viewport,
          imageId: this.state.imageId,
          numImagesLoaded: this.state.numImagesLoaded
        }), React__default.createElement(ViewportOrientationMarkers, {
          imageId: this.state.imageId,
          viewport: this.state.viewport,
          cornerstone: this.props.cornerstone,
          cornerstoneTools: this.props.cornerstoneTools
        })), React__default.createElement(ImageScrollbar, {
          onInputCallback: this.imageSliderOnInputCallback,
          max: this.state.stack.imageIds.length - 1,
          value: this.state.stack.currentImageIdIndex,
          height: this.state.viewportHeight
        }), this.props.children);
      }
    }, {
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this3 = this;

        var element = this.element;
        this.eventHandlerData = [{
          eventTarget: element,
          eventType: this.cornerstone.EVENTS.IMAGE_RENDERED,
          handler: this.onImageRendered
        }, {
          eventTarget: element,
          eventType: this.cornerstone.EVENTS.NEW_IMAGE,
          handler: this.onNewImage
        }, {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.STACK_SCROLL,
          handler: this.onStackScroll
        },
        /*{
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.MEASUREMENT_ADDED,
          handler: this.onMeasurementAddedOrRemoved
        },
        {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.MEASUREMENT_REMOVED,
          handler: this.onMeasurementAddedOrRemoved
        },*/
        {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.MOUSE_CLICK,
          handler: this.onMouseClick
        }, {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.MOUSE_DOWN,
          handler: this.onMouseClick
        }, {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.TOUCH_PRESS,
          handler: this.onTouchPress
        }, {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.TOUCH_START,
          handler: this.onTouchStart
        }, {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.DOUBLE_CLICK,
          handler: this.onDoubleClick
        }, {
          eventTarget: element,
          eventType: this.cornerstoneTools.EVENTS.DOUBLE_TAP,
          handler: this.onDoubleClick
        }, {
          eventTarget: window,
          eventType: EVENT_RESIZE,
          handler: this.onWindowResize
        }, {
          eventTarget: this.cornerstone.events,
          eventType: this.cornerstone.EVENTS.IMAGE_LOADED,
          handler: this.onImageLoaded
        }]; // Enable the DOM Element for use with Cornerstone

        this.cornerstone.enable(element, this.props.cornerstoneOptions); // Handle the case where the imageId isn't loaded correctly and the
        // imagePromise returns undefined
        // To test, uncomment the next line
        //let imageId = 'AfileThatDoesntWork'; // For testing only!

        var imageId = this.state.imageId;
        var imagePromise;

        try {
          imagePromise = this.cornerstone.loadAndCacheImage(imageId);
        } catch (error) {
          console.error(error);

          if (!imagePromise) {
            this.setState({
              error: error
            });
            return;
          }
        } // Load the first image in the stack


        imagePromise.then(function (image) {
          try {
            _this3.cornerstone.getEnabledElement(element);
          } catch (error) {
            // Handle cases where the user ends the session before the image is displayed.
            console.error(error);
            return;
          } // Set Soft Tissue preset for all images by default


          var viewport = _this3.cornerstone.getDefaultViewportForImage(element, image);

          viewport.voi = {
            windowWidth: 400,
            windowCenter: 40
          }; // Display the first image

          _this3.cornerstone.displayImage(element, image, viewport); // Clear any previous tool state


          _this3.cornerstoneTools.clearToolState(_this3.element, 'stack');
          /* Add the stack tool state to the enabled element, and
             add stack state managers for the stack tool, CINE tool, and reference lines
          */


          var stack = _this3.state.stack;

          _this3.cornerstoneTools.addStackStateManager(element, ['stack', 'playClip', 'referenceLines']);

          _this3.cornerstoneTools.addToolState(element, 'stack', stack);

          if (_this3.props.enableStackPrefetch) {
            _this3.cornerstoneTools.stackPrefetch.enable(_this3.element);
          }

          var tools = [{
            name: 'Bidirectional',
            configuration: {
              getMeasurementLocationCallback: _this3.bidirectionalToolLabellingCallback,
              shadow: true,
              drawHandlesOnHover: true
            }
          }, {
            name: 'Wwwc'
          }, {
            name: 'Zoom',
            configuration: {
              minScale: 0.3,
              maxScale: 25,
              preventZoomOutsideImage: true
            }
          }, {
            name: 'Length'
          }, {
            name: 'Angle'
          }, {
            name: 'Pan'
          }, {
            name: 'StackScroll'
          }, {
            name: 'PanMultiTouch'
          }, {
            name: 'ZoomTouchPinch'
          }, {
            name: 'StackScrollMouseWheel'
          }, {
            name: 'StackScrollMultiTouch'
          }];
          initializeTools(_this3.cornerstoneTools, tools);

          _this3.setActiveTool(_this3.props.activeTool);
          /* For touch devices, by default we activate:
            - Pinch to zoom
            - Two-finger Pan
            - Three (or more) finger Stack Scroll
          */


          _this3.cornerstoneTools.setToolActive('PanMultiTouch', {
            mouseButtonMask: 0,
            isTouchActive: true
          });

          _this3.cornerstoneTools.setToolActive('ZoomTouchPinch', {
            mouseButtonMask: 0,
            isTouchActive: true
          });

          _this3.cornerstoneTools.setToolActive('StackScrollMultiTouch', {
            mouseButtonMask: 0,
            isTouchActive: true
          }); // TODO: We should probably configure this somewhere else


          _this3.cornerstoneTools.stackPrefetch.setConfiguration({
            maxImagesToPrefetch: Infinity,
            preserveExistingPool: false,
            maxSimultaneousRequests: 6
          });
          /* For mouse devices, by default we turn on:
          - Stack scrolling by mouse wheel
          - Stack scrolling by keyboard up / down arrow keys
          - Pan with middle click
          - Zoom with right click
          */


          _this3.cornerstoneTools.setToolActive('StackScrollMouseWheel', {
            mouseButtonMask: 0,
            isTouchActive: true
          });

          _this3.eventHandlerData.forEach(function (data) {
            var eventTarget = data.eventTarget,
                eventType = data.eventType,
                handler = data.handler;
            eventTarget.addEventListener(eventType, handler);
          });

          _this3.setState({
            viewportHeight: "".concat(_this3.element.clientHeight - 20, "px")
          });
        }, function (error) {
          console.error(error);

          _this3.setState({
            error: error
          });
        });
      }
    }, {
      key: "onDoubleClick",
      value: function onDoubleClick() {
        console.log('onDoubleClick');
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        this.eventHandlerData.forEach(function (data) {
          var eventTarget = data.eventTarget,
              eventType = data.eventType,
              handler = data.handler;
          eventTarget.removeEventListener(eventType, handler);
        });
        var element = this.element; // Remove all tools for the destroyed element
        // TODO[cornerstoneTools]: Make this happen internally
        // toolManager.removeToolsForElement(element);
        // Clear the stack prefetch data
        // TODO[cornerstoneTools]: Make this happen internally

        this.cornerstoneTools.clearToolState(element, 'stackPrefetch'); // Disable the viewport element with Cornerstone
        // This also triggers the removal of the element from all available
        // synchronizers, such as the one used for reference lines.

        this.cornerstone.disable(element); // Try to stop any currently playing clips
        // Otherwise the interval will continuously throw errors
        // TODO[cornerstoneTools]: Make this happen internally

        try {
          var enabledElement = this.cornerstone.getEnabledElement(element);

          if (enabledElement) {
            this.cornerstoneTools.stopClip(element);
          }
        } catch (error) {//console.warn(error);
        }

        if (this.props.clearViewportSpecificData) {
          this.props.clearViewportSpecificData();
        }
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate(prevProps) {
        var _this4 = this; // TODO: Add a real object shallow comparison here?


        if (this.state.displaySetInstanceUid !== this.props.viewportData.displaySetInstanceUid) {
          var _this$props$viewportD = this.props.viewportData,
              displaySetInstanceUid = _this$props$viewportD.displaySetInstanceUid,
              studyInstanceUid = _this$props$viewportD.studyInstanceUid;
          var currentImageIdIndex = this.props.viewportData.stack.currentImageIdIndex; // Create shortcut to displaySet

          /*const study = OHIF.viewer.Studies.findBy({
                studyInstanceUid,
            });
             const displaySet = study.displaySets.find((set) => {
                return set.displaySetInstanceUid === displaySetInstanceUid;
            });*/

          var stack = this.props.viewportData.stack;
          var stackData = this.cornerstoneTools.getToolState(this.element, 'stack');
          var currentStack = stackData && stackData.data[0];

          if (!currentStack) {
            currentStack = {
              currentImageIdIndex: currentImageIdIndex,
              imageIds: stack.imageIds
            };
            this.cornerstoneTools.addStackStateManager(this.element, ['stack']);
            this.cornerstoneTools.addToolState(this.element, 'stack', currentStack);
          } else {
            // TODO: we should make something like setToolState by an ID
            currentStack.currentImageIdIndex = currentImageIdIndex;
            currentStack.imageIds = stack.imageIds;
          }

          var imageId = currentStack.imageIds[currentImageIdIndex];
          var viewportSpecificData = {
            displaySetInstanceUid: displaySetInstanceUid,
            studyInstanceUid: studyInstanceUid,
            stack: stack,
            imageId: imageId
          };
          this.setState(viewportSpecificData);
          /*
          Temporarily removed because it didn't seem to be performing well
          if (this.props.setViewportSpecificData) {
            this.props.setViewportSpecificData(viewportSpecificData);
          }*/

          this.cornerstoneTools.stackPrefetch.disable(this.element);
          this.cornerstone.loadAndCacheImage(imageId).then(function (image) {
            try {
              _this4.cornerstone.getEnabledElement(_this4.element);
            } catch (error) {
              // Handle cases where the user ends the session before the image is displayed.
              console.error(error);
              return;
            }

            var viewport = _this4.cornerstone.getDefaultViewportForImage(_this4.element, image); // Workaround for Cornerstone issue #304


            viewport.displayedArea.brhc = {
              x: image.width,
              y: image.height
            };

            _this4.cornerstone.displayImage(_this4.element, image, viewport);

            _this4.cornerstoneTools.stackPrefetch.enable(_this4.element);
          });
        }

        if (this.props.activeTool !== prevProps.activeTool) {
          this.setActiveTool(this.props.activeTool); // TODO: Why do we need to do this in v3?

          this.cornerstoneTools.setToolActive('StackScrollMouseWheel', {
            mouseButtonMask: 0,
            isTouchActive: true
          });
        }

        if (this.props.layout !== prevProps.layout) {
          this.debouncedResize();
        }

        if (this.props.enableStackPrefetch !== prevProps.enableStackPrefetch && this.props.enableStackPrefetch === true) {
          this.cornerstoneTools.stackPrefetch.enable(this.element);
        } else if (this.props.enableStackPrefetch !== prevProps.enableStackPrefetch && this.props.enableStackPrefetch === false) {
          this.cornerstoneTools.stackPrefetch.disable(this.element);
        }

        if (this.props.cineToolData.isPlaying !== prevProps.cineToolData.isPlaying) {
          if (this.props.cineToolData.isPlaying) {
            this.cornerstoneTools.playClip(this.element);
          } else {
            this.cornerstoneTools.stopClip(this.element);
          }
        }

        if (this.props.cineToolData.cineFrameRate !== prevProps.cineToolData.cineFrameRate) {
          if (this.props.cineToolData.isPlaying) {
            this.cornerstoneTools.playClip(this.element, this.props.cineToolData.cineFrameRate);
          } else {
            this.cornerstoneTools.stopClip(this.element, this.props.cineToolData.cineFrameRate);
          }
        }
      }
    }]);

    return CornerstoneViewport;
  }(React.Component);

  _defineProperty$4(CornerstoneViewport, "defaultProps", {
    activeTool: 'Wwwc',
    viewportData: {
      stack: {
        imageIds: [],
        currentImageIdIndex: 0
      }
    },
    isActive: false,
    cornerstoneOptions: {},
    enableStackPrefetch: true,
    cineToolData: {
      isPlaying: false,
      cineFrameRate: 24
    }
  });

  _defineProperty$4(CornerstoneViewport, "propTypes", {
    cornerstone: propTypes$2.object.isRequired,
    cornerstoneTools: propTypes$2.object.isRequired,
    children: propTypes$2.node,
    activeTool: propTypes$2.string,
    viewportData: propTypes$2.object.isRequired,
    measurementsAddedOrRemoved: propTypes$2.func,
    measurementsChanged: propTypes$2.func,
    isActive: propTypes$2.bool.isRequired,
    cornerstoneOptions: propTypes$2.object,
    setViewportActive: propTypes$2.func,
    setViewportSpecificData: propTypes$2.func,
    clearViewportSpecificData: propTypes$2.func,
    layout: propTypes$2.object,
    cineToolData: propTypes$2.object
  });

  _defineProperty$4(CornerstoneViewport, "loadIndicatorDelay", 45);

  var _OHIF$redux$actions$1 = OHIF$1.redux.actions,
      _setViewportActive = _OHIF$redux$actions$1.setViewportActive,
      _setViewportSpecificData = _OHIF$redux$actions$1.setViewportSpecificData,
      _clearViewportSpecificData = _OHIF$redux$actions$1.clearViewportSpecificData;

  var mapStateToProps$9 = function mapStateToProps(state, ownProps) {
    var activeButton = state.tools.buttons.find(function (tool) {
      return tool.active === true;
    }); // If this is the active viewport, enable prefetching.

    var viewportIndex = ownProps.viewportIndex; //.viewportData;

    var isActive = viewportIndex === state.viewports.activeViewportIndex;
    var viewportSpecificData = state.viewports.viewportSpecificData[viewportIndex] || {};
    return {
      layout: state.viewports.layout,
      isActive: isActive,
      activeTool: activeButton && activeButton.command,
      enableStackPrefetch: isActive,
      //stack: viewportSpecificData.stack,
      cineToolData: viewportSpecificData.cine,
      cornerstone: cornerstone$3,
      cornerstoneTools: cornerstoneTools$1
    };
  };

  var mapDispatchToProps$5 = function mapDispatchToProps(dispatch, ownProps) {
    var viewportIndex = ownProps.viewportIndex;
    return {
      setViewportActive: function setViewportActive() {
        dispatch(_setViewportActive(viewportIndex));
      },
      setViewportSpecificData: function setViewportSpecificData(data) {
        dispatch(_setViewportSpecificData(viewportIndex, data));
      },
      clearViewportSpecificData: function clearViewportSpecificData() {
        dispatch(_clearViewportSpecificData(viewportIndex));
      }
    };
  };

  var ConnectedCornerstoneViewport = connect(mapStateToProps$9, mapDispatchToProps$5)(CornerstoneViewport);

  function OHIFComponentPlugin(props) {
    return React__default.createElement(React__default.Fragment, null, props.children);
  }

  OHIFComponentPlugin.propTypes = {
    id: propTypes.string.isRequired,
    init: propTypes.func.isRequired,
    destroy: propTypes.func.isRequired,
    children: propTypes.node.isRequired
  };

  var StackManager$2 = OHIF$1.utils.StackManager;

  var OHIFCornerstoneViewportPlugin =
  /*#__PURE__*/
  function (_Component) {
    inherits(OHIFCornerstoneViewportPlugin, _Component);

    function OHIFCornerstoneViewportPlugin() {
      classCallCheck(this, OHIFCornerstoneViewportPlugin);

      return possibleConstructorReturn(this, getPrototypeOf(OHIFCornerstoneViewportPlugin).apply(this, arguments));
    }

    createClass(OHIFCornerstoneViewportPlugin, [{
      key: "render",
      value: function render() {
        var viewportIndex = this.props.viewportIndex;
        var _this$props$viewportD = this.props.viewportData,
            studies$$1 = _this$props$viewportD.studies,
            displaySet = _this$props$viewportD.displaySet;
        var studyInstanceUid = displaySet.studyInstanceUid,
            displaySetInstanceUid = displaySet.displaySetInstanceUid;
        var stack = OHIFCornerstoneViewportPlugin.getPluginViewportData(studies$$1, studyInstanceUid, displaySetInstanceUid);
        var viewportData = {
          studyInstanceUid: studyInstanceUid,
          displaySetInstanceUid: displaySetInstanceUid,
          stack: stack
        };
        var id = OHIFCornerstoneViewportPlugin.id,
            init = OHIFCornerstoneViewportPlugin.init,
            destroy = OHIFCornerstoneViewportPlugin.destroy;
        var pluginProps = {
          id: id,
          init: init,
          destroy: destroy
        };
        return React__default.createElement(OHIFComponentPlugin, pluginProps, React__default.createElement(ConnectedCornerstoneViewport, {
          viewportData: viewportData,
          viewportIndex: viewportIndex
        }));
      }
    }], [{
      key: "init",
      value: function init() {
        console.log('CornerstoneViewportPlugin init()');
      }
    }, {
      key: "destroy",
      value: function destroy() {
        console.log('CornerstoneViewportPlugin destroy()');
        StackManager$2.clearStacks();
      }
    }, {
      key: "getCornerstoneStack",
      value: function getCornerstoneStack(studies$$1, studyInstanceUid, displaySetInstanceUid) {
        // Create shortcut to displaySet
        var study = studies$$1.find(function (study) {
          return study.studyInstanceUid === studyInstanceUid;
        });
        var displaySet = study.displaySets.find(function (set) {
          return set.displaySetInstanceUid === displaySetInstanceUid;
        }); // Get stack from Stack Manager

        return StackManager$2.findOrCreateStack(study, displaySet);
      }
    }]);

    return OHIFCornerstoneViewportPlugin;
  }(React.Component);

  defineProperty(OHIFCornerstoneViewportPlugin, "propTypes", {
    studies: propTypes.object,
    displaySet: propTypes.object,
    viewportIndex: propTypes.number
  });

  defineProperty(OHIFCornerstoneViewportPlugin, "id", 'CornerstoneViewportPlugin');

  defineProperty(OHIFCornerstoneViewportPlugin, "getPluginViewportData", function (studies$$1, studyInstanceUid, displaySetInstanceUid) {
    var currentStack = OHIFCornerstoneViewportPlugin.getCornerstoneStack(studies$$1, studyInstanceUid, displaySetInstanceUid); // Clone the stack here so we don't mutate it later

    var stack = Object.assign({}, currentStack);
    stack.currentImageIdIndex = 0;
    return stack;
  });

  //import userManager from './userManager.js';
  //import Icons from "./images/icons.svg"

  var Icons$2 = 'icons.svg';
  var reducers$2 = OHIF$1.redux.reducers;
  reducers$2.ui = ui$1; //reducers.oidc = oidcReducer;

  var combined = combineReducers(reducers$2);
  var store = createStore(combined); //loadUser(store, userManager);

  var defaultButtons$1 = [{
    command: 'StackScroll',
    type: 'tool',
    text: 'Stack Scroll',
    svgUrl: "".concat(Icons$2, "#icon-tools-stack-scroll"),
    active: false
  }, {
    command: 'Zoom',
    type: 'tool',
    text: 'Zoom',
    svgUrl: "".concat(Icons$2, "#icon-tools-zoom"),
    active: false
  }, {
    command: 'Wwwc',
    type: 'tool',
    text: 'Levels',
    svgUrl: "".concat(Icons$2, "#icon-tools-levels"),
    active: true
  }, {
    command: 'Pan',
    type: 'tool',
    text: 'Pan',
    svgUrl: "".concat(Icons$2, "#icon-tools-pan"),
    active: false
  }, {
    command: 'Length',
    type: 'tool',
    text: 'Length',
    svgUrl: "".concat(Icons$2, "#icon-tools-measure-temp"),
    active: false
  },
  /*{
      command: 'Annotate',
      type: 'tool',
      text: 'Annotate',
      svgUrl: `${Icons}#icon-tools-measure-non-target`,
      active: false
  },*/
  {
    command: 'Angle',
    type: 'tool',
    text: 'Angle',
    iconClasses: 'fa fa-angle-left',
    active: false
  }, {
    command: 'Bidirectional',
    type: 'tool',
    text: 'Bidirectional',
    svgUrl: "".concat(Icons$2, "#icon-tools-measure-target"),
    active: false
  }, {
    command: 'reset',
    type: 'command',
    text: 'Reset',
    svgUrl: "".concat(Icons$2, "#icon-tools-reset"),
    active: false
  }];
  var buttonsAction = OHIF$1.redux.actions.setAvailableButtons(defaultButtons$1);
  store.dispatch(buttonsAction);
  var pluginAction = OHIF$1.redux.actions.addPlugin({
    id: 'cornerstone',
    type: 'viewport',
    component: OHIFCornerstoneViewportPlugin
  });
  store.dispatch(pluginAction);
  var servers$1 = {
    dicomWeb: [{
      "name": "DCM4CHEE",
      //"wadoUriRoot": "http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/wado",
      //"qidoRoot": "http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs",
      //"wadoRoot": "http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs",
      //"wadoUriRoot": "https://dcm4che.ohif.club/dcm4chee-arc/aets/DCM4CHEE/wado",
      //"qidoRoot": "https://dcm4che.ohif.club/dcm4chee-arc/aets/DCM4CHEE/rs",
      //"wadoRoot": "https://dcm4che.ohif.club/dcm4chee-arc/aets/DCM4CHEE/rs",
      "wadoUriRoot": "https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/wado",
      "qidoRoot": "https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs",
      "wadoRoot": "https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs",
      "qidoSupportsIncludeField": true,
      "imageRendering": "wadors",
      "thumbnailRendering": "wadors",
      "requestOptions": {
        "requestFromBrowser": true,
        "logRequests": true,
        "logResponses": false,
        "logTiming": true //"auth": "admin:admin"
        //"auth": "cloud:healthcare"

      }
    }]
  };
  OHIF$1.utils.addServers(servers$1, store); // TODO[react] Use a provider when the whole tree is React

  window.store = store;

  var App$1 =
  /*#__PURE__*/
  function (_Component) {
    inherits(App, _Component);

    function App() {
      classCallCheck(this, App);

      return possibleConstructorReturn(this, getPrototypeOf(App).apply(this, arguments));
    }

    createClass(App, [{
      key: "render",
      value: function render() {
        return React__default.createElement(Provider, {
          store: store
        }, React__default.createElement(BrowserRouter, {
          basename: this.props.routerBasename
        }, React__default.createElement(OHIFStandaloneViewer, null)));
      }
    }]);

    return App;
  }(React.Component);

  defineProperty(App$1, "propTypes", {
    routerBasename: propTypes.string
  });

  exports.App = App$1;

  Object.defineProperty(exports, '__esModule', { value: true });

}));
//# sourceMappingURL=index.umd.js.map
